

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Dean0731">
  <meta name="keywords" content="">
  
    <meta name="description" content="jdbc.driver&#x3D;com.mysql.jdbc.Driverjdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;dangdangjdbc.username&#x3D;rootjdbc.password&#x3D;root ---------------------------------------------------------------- class.forName(oracle">
<meta property="og:type" content="article">
<meta property="og:title" content="Dean0731&#39;s site">
<meta property="og:url" content="https://blog.dean0731.cn/2022/01/16/cnblog/jdbc/index.html">
<meta property="og:site_name" content="Dean0731&#39;s site">
<meta property="og:description" content="jdbc.driver&#x3D;com.mysql.jdbc.Driverjdbc.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;dangdangjdbc.username&#x3D;rootjdbc.password&#x3D;root ---------------------------------------------------------------- class.forName(oracle">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-16T12:20:07.080Z">
<meta property="article:modified_time" content="2021-01-12T11:11:15.000Z">
<meta property="article:author" content="Dean0731">
<meta name="twitter:card" content="summary_large_image">
  
  
  <title>Dean0731&#39;s site</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"blog.dean0731.cn","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Dean0731&#39; Site</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-01-16 20:20" pubdate>
        2022年1月16日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      18k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      153 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none"></h1>
            
            <div class="markdown-body">
              <p>jdbc.driver=com.mysql.jdbc.Driver<br />jdbc.url=jdbc:mysql://localhost:3306/dangdang<br />jdbc.username=root<br />jdbc.password=root</p>
<p>----------------------------------------------------------------</p>
<p>class.forName(oracle.jdbc.OracleDriver)<br />jdbc:oracle:thin:@localhost:1521:xe<br />"com.mysql.jdbc.Driver"<br />jdbc:mysql://localhost:3306/student</p>
<p>JDBC <br />一,JDBC内容<br />    接口:sun定义 java.sql 和javax.sql<br />    实现类:数据库厂商提供<br />二,jdbc使用<br />    1,如何使用jar<br />        --dos使用<br />            classpath中添加jar路径<br />    2,jdbc流程<br />        a:注册驱动类<br />        b:创建链接<br />        c:创建statement(不常用)<br />        d:执行sql<br />        e:处理结果<br />        f:释放资源statement 也要close<br />        get列时序号从1开始<br />    3,prepareStatementjava.sql statement子接口<br />        PrepareStatement ps =conn.prepareStatement(sql);<br />        ps.setxxx(1,name)<br />        ps.setxxx(2,password)<br />        ps.exq exu (使用午餐的构造)<br />        里面的参数不用拼接<br />        在执行前时插入<br />    4.两者区别<br />    state = com.cre...<br />    stat.execute(sql)<br />    不安全,有注入<br />    prep = conn.create..(sql)<br />    prep.execute()<br />    无sql注入,切性能更高<br />            服务器操作<br />            1检查权限,<br />            2检查语法<br />            3,sql转化为内部指令 前三是编译过程<br />            4,执行指令<br />            statement创建成功时不发送sql,执行时发送<br />            例:for(int i=0;i&lt;10;i++{<br />            stat.ex(insert...)  <br />            }<br />            prep 可只把setxxx写在for循环中<br />            只用编译一次即可,所以说也叫作预编译语句<br />    stat:异构sql<br />    prep:同构sql(只有参数不同<br />日期转换：日期转换 strDate --- util.Date---sql.Date<br />//插入或修改字段的类型是时间类型Date时，需要使用时间转换<br />//<br />1.设置格式，格式应与字符串相匹配。和数据库中to_date方法类似<br />SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");<br />//<br />2.strDate--util.Date<br />Date util<br />Date = format.parse(strDate);<br />//<br />3.util.Date---sql.Date<br />java.sql.Date date = new java.sql.Date(utilDate.getTime());</p>
<p><br />1.事务控制 <br />    JDBC默认的是自动的事务提交<br />    <br />相关API：控制事务提交的对象为连接 Connection<br />        <br />//设置事务提交方式为手动<br />        <br />conn.setAutoCommit(false)；//true---自动提交   false---手动提交<br />        <br />//事务提交<br />        conn.commit();<br />        <br />//事务回滚<br />        conn.rollback();</p>
<p>2.业务类方法的书写步骤<br />    <br />//1.获取Connection<br />    conn = JdbcUtil2.getConnection();<br />    <br />System.out.println("这是service获得连接："+conn);<br />    <br />//2.设置事务提交为手动提交<br />    conn.setAutoCommit(false);    <br />    <br />//3.调用DAO中的方法完成业务操作<br />    dao.insert(clazz);<br />    <br />//4.提交事务 or 回滚事务<br />    conn.commit();<br />    <br />conn.rollback</p>
<p>3.当前的事务控制存在问题<br />    <br />首先service层获得的连接与Dao不是一条 其次通过单例可以解决这样的问题，但是会存在线程不安全的情况。<br />    <br />为了解决线程安全，且可以控制事务的问题<br />    我们需要使用线程局部表变量，ThreadLocal<br />~~~</p>
<p>#### <br />九、线程局部变量</p>
<p>~~~java<br />线程局部变量，再多线程环境下，可以为每个使用该变量的线程 分配线程内部独有的 线程变量值。</p>
<p>1.API:<br />    ThreadLocal th = new ThreadLocal();<br />    <br />th.set（obj）;//往线程局部变量中设置<br />    <br />obj = th.get();//返回该线程局变量的值<br />    <br />th.remove()；//移除该线程局变量的值</p>
<p>2.作用：<br />    1）保证 同一个线程内部 使用相同的值<br />    2）保证不用线程使用不用的值</p>
<p>3.原理：<br />    当调用 set方法时，会将当前线程对象当做Key，将set中的参数当做value 放入到一个map集合中 ，这个集合由Thread进行管理的。<br />当使用get方法时，以当前线程为key来向该map集合取值。</p>
<p>4.使用ThreadLoacl来修改getConnection方法<br />    //创建连接的方法<br />    <br />private static ThreadLocal&lt;Connection&gt; th = new ThreadLocal&lt;Connection&gt;();<br />    <br />public static Connection getConnection(){<br />        <br />Connection conn = th.get();<br />        <br />if(conn==null){//如果为空就创建<br />            <br />//1.注册驱动<br />            <br />try {<br />                <br />Class.forName(p.getProperty("driver"));<br />            <br />//2.建立连接<br />                <br />conn = DriverManager.getConnection(p.getProperty("url"),p.getProperty("username"),p.getProperty("password"));<br />        <br />    //3.并把连接放入ThreadLocal<br />                <br />th.set(conn);<br />            </p>
<p>} catch (Exception e) {<br />                // TODO Auto-generated catch block<br />                <br />e.printStackTrace();<br />            }<br />        }<br />        <br />return conn;<br />    }</p>
<p>if(conn!=null){<br />    <br />        try {<br />                <br />conn.close();<br />                th.remove();<br />            } catch (SQLException e) {<br />            <br />    // TODO Auto-generated catch block<br />                e.printStackTrace();<br />            }<br />        }</p>
<p><br />注意：1)在控制事务时，dao内不要关闭连接<br />    <br />2)在关闭连接后，要清空线程局部变量中的废连接<br />~~~</p>
<p>#### <br />十、JDBC的</p>
<p>分层分包：</p>
<p>都在域名倒写的包下 比如 com.zzu.xjh</p>
<p><br />1）sql  存放了关于该项目相关的一些sql语句文档</p>
<p><br />2）conf 放置了配置文件</p>
<p><br />3）util 放置了该项目的工具类</p>
<p><br />4）test 放置了该项目相关的测试类</p>
<p><br />5）entity 放置了该项目的实体类</p>
<p><br />6）dao 放置该项目的DAO接口  在该包下应有一个impl包 里面放置 对应dao的实现类</p>
<p><br />7）service 放置该项目的service 接口  在该包下应有一个impl包 里面放置 对应service 的实现类</p>
<p><br />8）conroller/action 放置该项目的控制器</p>
<p><br />9）view （可能出现）</p>
<div class="cnblogs_Highlighter">
<div class="code-wrapper"><pre class="brush:java;gutter:true;">import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;



<p>public class JdbcTemplate&lt;T&gt; {<br>    /*<br>     * 专门完成增 删 改操作<br>     *<br>     * insert into t_user (id,name,password) values (suns_seq.nextval,?,?);<br>     *<br>     * jdbcTemplate.update(sql,new Object[]{“suns”,”123456”});<br>     *<br>     * delete from t_user where id = ?<br>     *<br>     * jdbcTemplate.delete(sql,new Object[]{1});<br>     *<br>     * update t_product set name=?,price=? where id = ?<br>     *<br>     * jdbcTemplate.update(sql,new Object[]{“suns”,10.2,1});<br>     *<br>     * 可变长参数  1 等同于数组<br>     *          2 只能放在参数表最后 ，只能有一个<br>     *<br>     *  “delete from t_user where id = 10”;<br>     *<br>     */<br>    public void update(String sql,Object… args){<br>        Connection conn = null;<br>        PreparedStatement pstmt = null;<br>        try{<br>            conn = JDBCUtil.getConnection();<br>            pstmt = conn.prepareStatement(sql);</p>
<pre><code class="hljs">        if(hasUpdateParam(args))&#123;
           for(int i=0;i&amp;lt;args.length;i++)&#123;
             pstmt.setObject(i+1,args[i]);
           &#125;
        &#125;   
        
        pstmt.executeUpdate();
    &#125;catch(Exception e)&#123;
        e.printStackTrace();
    &#125;finally&#123;
        JDBCUtil.close(null, pstmt);
    &#125;
    
&#125;

private boolean hasUpdateParam(Object... args) &#123;
    return args.length!=0;
&#125;


public List&amp;lt;T&amp;gt; query(String sql,RowMapper&amp;lt;T&amp;gt; rowMapper,Object... args)&#123;
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    List&amp;lt;T&amp;gt; rets = new ArrayList&amp;lt;T&amp;gt;();
    try&#123;
        conn = JDBCUtil.getConnection();
        pstmt = conn.prepareStatement(sql);
        if(hasUpdateParam(args))&#123;
             for(int i=0;i&amp;lt;args.length;i++)&#123;
            pstmt.setObject(i+1, args[i]);
          &#125;
        &#125;
        rs = pstmt.executeQuery();
        while(rs.next())&#123;
             T ret = rowMapper.mapRow(rs);
             rets.add(ret);
        &#125;
        return rets;
    &#125;catch(Exception e)&#123;
        e.printStackTrace();
        return null;
    &#125;finally&#123;
        JDBCUtil.close(null, pstmt, rs);
    &#125;
&#125;


public T queryForObject(String sql,RowMapper&amp;lt;T&amp;gt; rowMapper,Object... args)&#123;
    Connection conn = null;
    PreparedStatement pstmt = null;
    ResultSet rs = null;
    T ret = null;
    try&#123;
        conn = JDBCUtil.getConnection();
        pstmt = conn.prepareStatement(sql);
        if(hasUpdateParam(args))&#123;
             for(int i=0;i&amp;lt;args.length;i++)&#123;
            pstmt.setObject(i+1, args[i]);
          &#125;
        &#125;
        rs = pstmt.executeQuery();
        if(rs.next())&#123;
            ret = rowMapper.mapRow(rs);
        &#125;
        return ret;
    &#125;catch(Exception e)&#123;
        e.printStackTrace();
        return null;
    &#125;finally&#123;
        JDBCUtil.close(null, pstmt, rs);
    &#125;
&#125;
</code></pre></div>
<p>}<br /><br /><br></pre></p>
</div>
<p>　　</p>
<div class="cnblogs_code">
<div class="code-wrapper"><pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;

<p></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.DriverManager;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.PreparedStatement;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.ResultSet;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Properties;</p>
<p></span><span style="color: #008000;">/*</span><span style="color: #008000;"></p>
<ul>
<li>性能 效率 内存使用</li>
<li>维护性 （便于修改）</li>
<li>基本功能<br></span><span style="color: #008000;">*/</span></li>
</ul>
<p><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JDBCUtil {<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> Properties p = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Properties();<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ThreadLocal&lt;Connection&gt; tl = <span style="color: #0000ff;">new</span> ThreadLocal&lt;Connection&gt;<span style="color: #000000;">();</p>
<pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;
    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;1 读入Properties文件&lt;/span&gt;
      InputStream is = JDBCUtil.&lt;span style=&quot;color: #0000ff;&quot;&gt;class&lt;/span&gt;.getResourceAsStream(&quot;/jdbc.properties&quot;&lt;span style=&quot;color: #000000;&quot;&gt;);
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;2 传入Properties集合&lt;/span&gt;
      &lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;
        p.load(is);
    &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (IOException e) &#123;
        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();<br>        }<br>    }</p>
<div class="code-wrapper"><pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;创建连接&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; Connection getConnection() &lt;span style=&quot;color: #0000ff;&quot;&gt;throws&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; Exception&#123;
      Connection conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; tl.get();
      &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn==&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)&#123;
          Class.forName(p.getProperty(&lt;/span&gt;&quot;driver&quot;&lt;span style=&quot;color: #000000;&quot;&gt;));
          conn &lt;/span&gt;= DriverManager.getConnection(p.getProperty(&quot;url&quot;),p.getProperty(&quot;username&quot;),p.getProperty(&quot;password&quot;&lt;span style=&quot;color: #000000;&quot;&gt;));
          tl.set(conn);  
          &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; conn;
      &#125;
      &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; conn;
&#125;


&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;关闭资源&lt;/span&gt;
&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; close(Connection conn,PreparedStatement pstmt,ResultSet rs)&#123;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(rs!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;rs.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(pstmt!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;pstmt.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;conn.close();tl.remove();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;
&#125;

&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; close(Connection conn,PreparedStatement pstmt)&#123;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(pstmt!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;pstmt.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;
    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;conn.close();tl.remove();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;
&#125;
</code></pre></div>
<p>}</span></pre></p>
</div>
<p>&nbsp;</p>
<p>1:1,一般是双向关系<br />建实体类时,两边都建<br /> 但建表时只有一个外键,建在不主要一方<br /> 定义表时,定义外键,做唯一<br />     private Integer id;<br />    private String name;<br />    private String password;<br />    private Date birthday;<br />    private PassPort passport;<br />    ---------------------------<br />        private Integer id;<br />    private String serial;<br />    private Integer expire;<br />    private Person person;<br />    ----------------------------<br /> create table t_person(<br />id integer primary key,<br />name varchar(12),<br />password varchar(12),<br />birthday date<br />);<br />create table t_passport(<br />id integer primary key,<br />serial varchar(12),<br />expire varchar(12),<br />person_id integer unique references t_person(id) <br />);<br />--------------------------------------------------------------------------------------------<br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" &gt;<br />&lt;mapper namespace="com.dzf.dao.o2o.PersonDao"&gt;</p>
<p>    &lt;resultMap id="personResultMap" type="Person" &gt;<br />        &lt;id property="id" column="person_id"/&gt;<br />        &lt;result property="name" column="person_name"/&gt;<br />        &lt;result property="password" column="person_password"/&gt;<br />        &lt;result property="birthday" column="person_birthday"/&gt;<br />        &lt;!-- 当只有passport一个对象 --&gt;<br />        &lt;association property="passport" javaType="PassPort"&gt;<br />            &lt;id property="id" column="passport_id"&gt;&lt;/id&gt;<br />            &lt;result property="serial" column="passport_serial"/&gt;<br />            &lt;result property="expire" column="passport_expire"/&gt;<br />        &lt;/association&gt;<br />    &lt;/resultMap&gt;<br />     &lt;select id="queryPersonById" resultMap="personResultMap"&gt;<br />         select p.id as person_id,p.name as person_name,p.password as person_password,p.birthday as person_birthday<br />         ,pp.id as passport_id,pp.serial as passport_serial,pp.expire as passport_expire<br />         from t_person p inner join t_passport pp<br />         on p.id = pp.person_id<br />         where p.id = #{id}<br />     &lt;/select&gt;<br />&lt;/mapper&gt;</p>
<p>----------------------------------------------<br />n:1<br /> 多对一单向<br />private Integer id;<br />    private String name;<br />    private Double salary;<br />    private Dept dept;<br />private Integer id;<br />    private String code;<br />    private String name;<br />create  table t_employee(<br />  id integer primary key,<br />  name varchar(12),<br />  salary decimal(12,2),<br />  dept_id integer references t_dept(id)<br />  );<br />  create table t_dept(<br />  id integer primary key,<br />  code varchar(12),<br /> name varchar(12) <br /> );<br />&lt;resultMap id="employeeResultMap" type="Employee" &gt;<br />        &lt;id property="id" column="employee_id"/&gt;<br />        &lt;result property="name" column="employee_name"/&gt;<br />        &lt;result property="salary" column="employee_salary"/&gt;<br />        &lt;association property="dept" javaType="Dept"&gt;<br />            &lt;id property="id" column="dept_id"&gt;&lt;/id&gt;<br />            &lt;result property="code" column="dept_code"/&gt;<br />            &lt;result property="name" column="dept_name"/&gt;<br />        &lt;/association&gt;<br />    &lt;/resultMap&gt;<br />     &lt;select id="queryEmployeeByName" resultMap="employeeResultMap"&gt;<br />         select e.id as employee_id,e.name as employee_name,e.salary as employee_salary,<br />         d.id as dept_id,d.code as dept_code,d.name as dept_name<br />         from t_employee e inner join t_dept d<br />         on e.dept_id = d.id<br />         where e.name = #{name}<br />     &lt;/select&gt;<br /> &lt;select id="queryDeptById" resultType="Dept"&gt;<br />         select id,name,code<br />         from t_dept<br />         where id = #{id}<br />     &lt;/select&gt;<br />--------------------------------------------------------------------------------------------------------------<br />1:n单向(n:1注意更换时 表不用改,表天生是双向的,俩表就一外键,在多的一方)<br />private Integer id;<br />    private String name;<br />    private Double salary;<br />private Integer id;<br />    private String code;<br />    private String name;<br />    private List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;();记得初始化<br /> &lt;resultMap id ="deptResultMap" type="Dept" &gt;<br />          &lt;id property="id" column = "dept_id"/&gt;<br />          &lt;result property = "code" column="dept_code"/&gt;<br />          &lt;result property = "name" column="dept_name"/&gt;<br />          &lt;collection property="list" ofType="Employee"&gt;&lt;!-- 集合中元素类型 --&gt;<br />              &lt;id property="id" column="employee_id"/&gt;<br />            &lt;result property="name" column="employee_name"/&gt;<br />            &lt;result property="salary" column="employee_salary"/&gt;<br />          &lt;/collection&gt;<br />      &lt;/resultMap&gt;<br />      &lt;select id="queryDeptByName" resultMap="deptResultMap"&gt;<br />         select d.id as dept_id ,d.code as dept_code,d.name as dept_name,<br />         e.id as employee_id,e.name as employee_name,e.salary as employee_salary<br />         from t_dept d inner join t_employee e<br />         on d.id = e.dept_id<br />         where d.name = #{name}<br />     &lt;/select&gt;<br />&lt;select id="queryEmployeeById" resultType="Employee"&gt;<br />         select id,name,salary <br />         from t_employee<br />         where id= #{id}<br />     &lt;/select&gt;<br />-----------------------------------------------------------------------------------------------------------------<br />多对多双向,student,course<br />外键如何建?,不能建, <br />解决办法:引入第三张关系表</p>
<p>______________________________________________________________________</p>
<div class="cnblogs_code">
<div class="code-wrapper"><pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;
</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;

<p></span><span style="color: #008000;">/*</span><span style="color: #008000;"></p>
<ul>
<li><p>事务管理器 用于控制事务<br></span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TransactionManager {</p>
<p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> begin(){</p>
<pre><code class="hljs"> &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;
     Connection conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();
     conn.setAutoCommit(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
 &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125;
</code></pre></div>
<p> }</p>
<p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> commit(){</p>
<div class="code-wrapper"><pre><code class="hljs"> Connection conn &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;
     conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();
     conn.commit();
 &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;finally&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;
     JDBCUtil.close(conn, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
 &#125;
 
 
</code></pre></div>
<p> }</p>
<p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> rollback(){</p>
<div class="code-wrapper"><pre><code class="hljs"> Connection conn &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;;
 &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;
     conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();
     conn.rollback();
 &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;
     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;
</code></pre></div>
<p><span style="color: #000000;">            e.printStackTrace();</p>
<div class="code-wrapper"><pre><code class="hljs"> &#125;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;finally&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;
     JDBCUtil.close(conn, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;);
 &#125;
 
</code></pre></div>
<p> }</p>
</li>
</ul>
<p>}</span></pre></p>
</div>
<p>&nbsp;</p>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/01/16/cnblog/jdk1.8HashMap/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/01/16/cnblog/JAVA%20%E7%BA%BF%E7%A8%8B/">
                        <span class="hidden-mobile"></span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
