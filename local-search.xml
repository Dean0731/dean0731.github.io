<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E9%AB%98%E5%88%86%E8%BE%A8%E7%8E%87%E5%9B%BE%E5%83%8F%E5%BB%BA%E7%AD%91%E7%89%A9%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE%E9%9B%86%E5%88%B6%E4%BD%9C/"/>
    <url>/2022/01/16/cnblog/%E9%AB%98%E5%88%86%E8%BE%A8%E7%8E%87%E5%9B%BE%E5%83%8F%E5%BB%BA%E7%AD%91%E7%89%A9%E6%8F%90%E5%8F%96%E6%95%B0%E6%8D%AE%E9%9B%86%E5%88%B6%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<ol><li><h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">/dataset/<br>xxxx.tif  # 原始图像<br>image-3000<br>0.tif # 切割后的tif<br>1.tif<br>........<br>xxx_0.json # 生成的json文件也放在该文件夹下<br>xxx_1.json<br>.......<br>xxx_0_json # 调用labelme_json_to_dataset 0.json 生成的0_json文件夹<br>img.png # 原始图片的png格式<br>info.yaml<br>label.png # 标签图片<br>label_names.txt <br>label_viz.png<br>xxx_1_json<br>.......<br>0.png  # 将json文件夹中的label.png 提取出来<br>1.png <br>.......<br>label_0.tif # 将上边的png标签文件转换为tif格式<br></code></pre></td></tr></table></figure><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200105181946812-830608728.png"></p></li></ol><ol start="2"><li><h3 id="收集数据，高分辨率图像"><a href="#收集数据，高分辨率图像" class="headerlink" title="收集数据，高分辨率图像"></a>收集数据，高分辨率图像</h3><ol><li>无人机数据，航空数据等</li></ol></li><li><h3 id="图像切割，像素大小该为多少？"><a href="#图像切割，像素大小该为多少？" class="headerlink" title="图像切割，像素大小该为多少？"></a>图像切割，像素大小该为多少？</h3><ol><li><p>本数据集平均像素大小（40000*50000） tif格式，LZW压缩方式压缩</p></li><li><p>要考虑计算机显卡，目标建筑无尽量不被切割等问题，本利使用3000*3000</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># data:2020-01-04</span><br><span class="hljs-comment"># user:dean</span><br><span class="hljs-comment"># desc:图像切割脚本</span><br><span class="hljs-keyword">import</span> tifffile <span class="hljs-keyword">as</span> tiff  <span class="hljs-comment"># 也可使用pillow或opencv 但若图片过大时可能会出问题</span><br><span class="hljs-keyword">import</span> os<br>width = <span class="hljs-number">1500</span>*<span class="hljs-number">2</span>   <span class="hljs-comment"># 切割图像大小</span><br>height = <span class="hljs-number">1500</span>*<span class="hljs-number">2</span>  <span class="hljs-comment"># 切割图像大小</span><br>home = <span class="hljs-string">&quot;/media/dean/Document/AI_dataset/DOM/&quot;</span><br>file_name = <span class="hljs-string">&quot;裴庄村51-dom&quot;</span><br>image_dir = os.path.join(home,file_name)<br>image = os.path.join(image_dir,file_name+<span class="hljs-string">&quot;.tif&quot;</span>)<br>target_dir = os.path.join(image_dir,<span class="hljs-string">&quot;image-&quot;</span>+<span class="hljs-built_in">str</span>(width))  <span class="hljs-comment"># 切割后图片存储位置</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(target_dir):<br>    os.mkdir(target_dir)<br>img = tiff.imread(image)  <span class="hljs-comment"># 导入图片</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;导入图片完成&quot;</span>,img.shape) <span class="hljs-comment"># 原始图片大小</span><br>pic_width = img.shape[<span class="hljs-number">1</span>]<br>pic_height = img.shape[<span class="hljs-number">0</span>]<br>row_num = pic_width//width  <span class="hljs-comment"># 纵向切割数量</span><br>col_num = pic_height // height  <span class="hljs-comment"># 横向切割数量</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;开始进行切割，可切割总数为&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(col_num*row_num))<br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(col_num):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(row_num):<br>        num = j * row_num + i<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;正在进行第&#123;&#125;张切割&quot;</span>.<span class="hljs-built_in">format</span>(num + <span class="hljs-number">1</span>))<br>        row = i * width<br>        row_end = row + width<br>        col = j * height<br>        col_end = col + height<br>        <span class="hljs-comment"># print(col,col_end,row,row_end)</span><br>        cropped = img[col:col_end,row:row_end]<br>        name = <span class="hljs-string">&quot;&#123;&#125;_&#123;&#125;.tif&quot;</span>.<span class="hljs-built_in">format</span>(file_name,num)<br>        image_path = os.path.join(target_dir,name)<br>        tiff.imsave(image_path, cropped)<br></code></pre></td></tr></table></figure></li></ol></li><li><h3 id="标注工具-labelme"><a href="#标注工具-labelme" class="headerlink" title="标注工具 labelme"></a>标注工具 labelme</h3><ol><li><p>使用label标注每张图片</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install labelme  # 安装labelme<br></code></pre></td></tr></table></figure></li><li><p>每张图片标注后会生成对应name.json文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">labelme_json_to_dataset xxx.json <br></code></pre></td></tr></table></figure><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200104214517080-1595277771.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># data:2020-01-04</span><br><span class="hljs-comment"># user:dean</span><br><span class="hljs-comment"># desc:批量将json文件转为 label</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-built_in">dir</span> = <span class="hljs-string">r&quot;I:\人工智能数据\DOM\裴庄村51-dom\image-3000&quot;</span><br>files = [os.path.join(<span class="hljs-built_in">dir</span>,file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(<span class="hljs-built_in">dir</span>) <span class="hljs-keyword">if</span> file.endswith(<span class="hljs-string">&quot;.json&quot;</span>)]<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>    cmd = <span class="hljs-string">&quot;labelme_json_to_dataset &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(file)<br>    <span class="hljs-built_in">print</span>(cmd)<br>    os.system(cmd)<br></code></pre></td></tr></table></figure></li><li><p>将所有的json/label.png 提取到统一文件夹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># data:2020-01-04</span><br><span class="hljs-comment"># user:dean</span><br><span class="hljs-comment"># desc:将label文件夹中的laebl提取出来</span><br><span class="hljs-keyword">import</span> tifffile <span class="hljs-keyword">as</span> tiff<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> os<br>target_dir = <span class="hljs-string">r&quot;/media/dean/Document/AI_dataset/DOM/裴庄村51-dom/image-3000&quot;</span>  <span class="hljs-comment"># json_label 所在的文件夹</span><br>files = [os.path.join(target_dir,file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(target_dir)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> files:<br>    <span class="hljs-keyword">if</span> os.path.isdir(i):<br>        lables = os.listdir(i)<br>        <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> lables:<br>            <span class="hljs-keyword">if</span> file == <span class="hljs-string">&quot;label.png&quot;</span>:<br>                image_path = os.path.join(i, <span class="hljs-string">&quot;label.png&quot;</span>)<br>                imgae = Image.<span class="hljs-built_in">open</span>(image_path)<br>                parent_dir_name = os.path.basename(os.path.dirname(image_path))<br>                new_name = <span class="hljs-string">&quot;&#123;&#125;.png&quot;</span>.<span class="hljs-built_in">format</span>(parent_dir_name.split(<span class="hljs-string">&quot;_&quot;</span>)[<span class="hljs-number">1</span>])<br>                imgae.save(os.path.join(target_dir,new_name))<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第&#123;&#125;个文件夹&quot;</span>.<span class="hljs-built_in">format</span>(i))<br>                <span class="hljs-keyword">break</span>;<br></code></pre></td></tr></table></figure></li><li><p>将所有的label.png转换为tif格式 并转换为单通道黑白照片</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: change_format.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2020/1/4 20:41</span><br><span class="hljs-comment"># desc: 将png 标签转化为单通道 黑白标签 并转化为tif</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br>threshold = <span class="hljs-number">0</span><br>table = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>    <span class="hljs-keyword">if</span> i &gt; threshold:<br>        table.append(<span class="hljs-number">255</span>)<br>    <span class="hljs-keyword">else</span>:<br>        table.append(<span class="hljs-number">0</span>)<br>target_dir = <span class="hljs-string">r&quot;/media/dean/Document/AI_dataset/DOM/裴庄村51-dom/image-3000&quot;</span><br>files = [os.path.join(target_dir,file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> os.listdir(target_dir) <span class="hljs-keyword">if</span> file.endswith(<span class="hljs-string">&quot;.png&quot;</span>)]<br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:<br>    image_file_name = os.path.basename(file)<br>    num = image_file_name.split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">0</span>]<br>    image_file = Image.<span class="hljs-built_in">open</span>(file)  <span class="hljs-comment"># open colour image</span><br>    <span class="hljs-comment"># image_file = image_file.convert(&#x27;L&#x27;) # convert image to black and white</span><br>    image_file = image_file.point(table, <span class="hljs-string">&#x27;1&#x27;</span>)<br>    new_file = os.path.join(target_dir,<span class="hljs-string">&quot;&#123;&#125;.tif&quot;</span>.<span class="hljs-built_in">format</span>(num))<br>    image_file.save(new_file)<br>    <span class="hljs-built_in">print</span>(new_file)<br></code></pre></td></tr></table></figure></li><li><p>结束（根据需要提取相应数据即可）</p></li></ol></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/"/>
    <url>/2022/01/16/cnblog/%E9%9B%AA%E8%8A%B1%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="常见生成策略的优缺点对比"><a href="#常见生成策略的优缺点对比" class="headerlink" title="常见生成策略的优缺点对比"></a>常见生成策略的优缺点对比</h2><h3 id="方法一-用数据库的-auto-increment-来生成"><a href="#方法一-用数据库的-auto-increment-来生成" class="headerlink" title="方法一: 用数据库的 auto_increment 来生成"></a>方法一: 用数据库的 auto_increment 来生成</h3><p><strong>优点：</strong></p><ul><li>此方法使用数据库原有的功能，所以相对简单</li><li>能够保证唯一性</li><li>能够保证递增性</li><li>id 之间的步长是固定且可自定义的</li></ul><p><strong>缺点：</strong></p><ul><li>可用性难以保证：数据库常见架构是 一主多从 + 读写分离，生成自增ID是写请求 主库挂了就玩不转了</li><li>扩展性差，性能有上限：因为写入是单点，数据库主库的写性能决定ID的生成性能上限，并且 难以扩展</li></ul><p><strong>改进方案：</strong></p><ul><li>冗余主库，避免写入单点</li><li>数据水平切分，保证各主库生成的ID不重复</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/aHR0cHM6Ly9nYXZpbmxlZTEuZ2l0aHViLmlvLzIwMTcvMDYvMjgvJUU1JUI4JUI4JUU4JUE3JTgxJUU1JTg4JTg2JUU1JUI4JTgzJUU1JUJDJThGJUU1JTg1JUE4JUU1JUIxJTgwJUU1JTk0JUFGJUU0JUI4JTgwSUQlRTclOTQlOUYlRTYlODglOTAlRTclQUQlOTYlRTclOTUlQTUlRTUlOEYlOEElRTclQUUlOTclRTYlQjMlOTUlRTclOUElODQlRTUlQUYlQjklRTYlQUYlOTQvb3B0aW1pc2UwMS5wbmc" alt="方法一改进方案的结构图"></p><center>方法一改进方案的结构图</center><p>如上图所述，由1个写库变成3个写库，每个写库设置不同的 auto_increment 初始值，以及相同的增长步长，以保证每个数据库生成的ID是不同的（上图中DB 01生成0,3,6,9…，DB 02生成1,4,7,10，DB 03生成2,5,8,11…）</p><p>改进后的架构保证了可用性，但缺点是</p><ul><li>丧失了ID生成的“绝对递增性”：先访问DB 01生成0,3，再访问DB 02生成1，可能导致在非常短的时间内，ID生成不是绝对递增的（这个问题不大，目标是趋势递增，不是绝对递增</li><li>数据库的写压力依然很大，每次生成ID都要访问数据库</li></ul><p>为了解决这些问题，引出了以下方法：</p><h3 id="方法二：单点批量ID生成服务"><a href="#方法二：单点批量ID生成服务" class="headerlink" title="方法二：单点批量ID生成服务"></a>方法二：单点批量ID生成服务</h3><p>分布式系统之所以难，很重要的原因之一是“没有一个全局时钟，难以保证绝对的时序”，要想保证绝对的时序，还是只能使用单点服务，用本地时钟保证“绝对时序”。</p><p>数据库写压力大，是因为每次生成ID都访问了数据库，可以使用批量的方式降低数据库写压力。</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/aHR0cHM6Ly9nYXZpbmxlZTEuZ2l0aHViLmlvLzIwMTcvMDYvMjgvJUU1JUI4JUI4JUU4JUE3JTgxJUU1JTg4JTg2JUU1JUI4JTgzJUU1JUJDJThGJUU1JTg1JUE4JUU1JUIxJTgwJUU1JTk0JUFGJUU0JUI4JTgwSUQlRTclOTQlOUYlRTYlODglOTAlRTclQUQlOTYlRTclOTUlQTUlRTUlOEYlOEElRTclQUUlOTclRTYlQjMlOTUlRTclOUElODQlRTUlQUYlQjklRTYlQUYlOTQvb3B0aW1pc2UwMi5wbmc" alt="方法二的结构图"></p><center>方法二的结构图</center><p>如上图所述，数据库使用双master保证可用性，数据库中只存储当前ID的最大值，例如4。</p><p>ID生成服务假设每次批量拉取5个ID，服务访问数据库，将当前ID的最大值修改为4，这样应用访问ID生成服务索要ID，ID生成服务不需要每次访问数据库，就能依次派发0,1,2,3,4这些ID了。</p><p>当ID发完后，再将ID的最大值修改为11，就能再次派发6,7,8,9,10,11这些ID了，于是数据库的压力就降低到原来的1/6。</p><p><strong>优点：</strong></p><ul><li>保证了ID生成的绝对递增有序</li><li>大大的降低了数据库的压力，ID生成可以做到每秒生成几万几十万个</li></ul><p><strong>缺点：</strong></p><ul><li>服务仍然是单点</li><li>如果服务挂了，服务重启起来之后，继续生成ID可能会不连续，中间出现空洞（服务内存是保存着0,1,2,3,4，数据库中max-id是4，分配到3时，服务重启了，下次会从5开始分配，3和4就成了空洞，不过这个问题也不大）</li><li>虽然每秒可以生成几万几十万个ID，但毕竟还是有性能上限，无法进行水平扩展</li></ul><p><strong>改进方案</strong></p><ul><li>单点服务的常用高可用优化方案是“备用服务”，也叫“影子服务”，所以我们能用以下方法优化上述缺点：</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/aHR0cHM6Ly9nYXZpbmxlZTEuZ2l0aHViLmlvLzIwMTcvMDYvMjgvJUU1JUI4JUI4JUU4JUE3JTgxJUU1JTg4JTg2JUU1JUI4JTgzJUU1JUJDJThGJUU1JTg1JUE4JUU1JUIxJTgwJUU1JTk0JUFGJUU0JUI4JTgwSUQlRTclOTQlOUYlRTYlODglOTAlRTclQUQlOTYlRTclOTUlQTUlRTUlOEYlOEElRTclQUUlOTclRTYlQjMlOTUlRTclOUElODQlRTUlQUYlQjklRTYlQUYlOTQvb3B0aW1pc2UwMy5wbmc" alt="方法二改进方案的结构图"></p><center>方法二改进方案的结构图</center><p>如上图，对外提供的服务是主服务，有一个影子服务时刻处于备用状态，当主服务挂了的时候影子服务顶上。这个切换的过程对调用方是透明的，可以自动完成，常用的技术是 vip+keepalived。另外，id generate service 也可以进行水平扩展，以解决上述缺点，但会引发一致性问题。</p><h3 id="方法三：uuid-guid"><a href="#方法三：uuid-guid" class="headerlink" title="方法三：uuid / guid"></a>方法三：uuid / guid</h3><p>不管是通过数据库，还是通过服务来生成ID，业务方Application都需要进行一次远程调用，比较耗时。uuid是一种常见的本地生成ID的方法。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-type">UUID</span> <span class="hljs-type">uuid</span> = <span class="hljs-type">UUID</span>.randomUUID();<br></code></pre></td></tr></table></figure><p><strong>优点：</strong></p><ul><li>本地生成ID，不需要进行远程调用，时延低</li><li>扩展性好，基本可以认为没有性能上限</li></ul><p><strong>缺点：</strong></p><ul><li>无法保证趋势递增</li><li>uuid过长，往往用字符串表示，作为主键建立索引查询效率低，常见优化方案为“转化为两个uint64整数存储”或者“折半存储”（折半后不能保证唯一性）</li></ul><h3 id="方法四：取当前毫秒数"><a href="#方法四：取当前毫秒数" class="headerlink" title="方法四：取当前毫秒数"></a>方法四：取当前毫秒数</h3><p>uuid是一个本地算法，生成性能高，但无法保证趋势递增，且作为字符串ID检索效率低，有没有一种能保证递增的本地算法呢？- 取当前毫秒数是一种常见方案。</p><p><strong>优点：</strong></p><ul><li>本地生成ID，不需要进行远程调用，时延低</li><li>生成的ID趋势递增</li><li>生成的ID是整数，建立索引后查询效率高</li></ul><p><strong>缺点：</strong></p><ul><li>如果并发量超过1000，会生成重复的ID</li><li>这个缺点要了命了，不能保证ID的唯一性。当然，使用微秒可以降低冲突概率，但每秒最多只能生成1000000个ID，再多的话就一定会冲突了，所以使用微秒并不从根本上解决问题。</li></ul><h3 id="方法五：使用-Redis-来生成-id"><a href="#方法五：使用-Redis-来生成-id" class="headerlink" title="方法五：使用 Redis 来生成 id"></a>方法五：使用 Redis 来生成 id</h3><p>当使用数据库来生成ID性能不够要求的时候，我们可以尝试使用Redis来生成ID。这主要依赖于Redis是单线程的，所以也可以用生成全局唯一的ID。可以用Redis的原子操作 INCR 和 INCRBY 来实现。</p><p><strong>优点：</strong></p><ul><li>依赖于数据库，灵活方便，且性能优于数据库。</li><li>数字ID天然排序，对分页或者需要排序的结果很有帮助。</li></ul><p><strong>缺点：</strong></p><ul><li>如果系统中没有Redis，还需要引入新的组件，增加系统复杂度。</li><li>需要编码和配置的工作量比较大。</li></ul><h3 id="方法六：Twitter-开源的-Snowflake-算法"><a href="#方法六：Twitter-开源的-Snowflake-算法" class="headerlink" title="方法六：Twitter 开源的 Snowflake 算法"></a>方法六：Twitter 开源的 Snowflake 算法</h3><p>snowflake 是 twitter 开源的分布式ID生成算法，其核心思想为，一个long型的ID：</p><ul><li>41 bit 作为毫秒数 - 41位的长度可以使用69年</li><li>10 bit 作为机器编号 （5个bit是数据中心，5个bit的机器ID） - 10位的长度最多支持部署1024个节点</li><li>12 bit 作为毫秒内序列号 - 12位的计数顺序号支持每个节点每毫秒产生4096个ID序号</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20190726091202771.png" alt="img"></p><center>Snowflake图示</center><p>算法单机每秒内理论上最多可以生成1000*(2^12)，也就是400W的ID，完全能满足业务的需求。</p><p>该算法 java 版本的实现代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com;<br> <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SnowflakeIdGenerator</span> </span>&#123;<br>    <span class="hljs-comment">//================================================Algorithm&#x27;s Parameter=============================================</span><br>    <span class="hljs-comment">// 系统开始时间截 (UTC 2017-06-28 00:00:00)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> startTime = <span class="hljs-number">1498608000000L</span>;<br>    <span class="hljs-comment">// 机器id所占的位数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> workerIdBits = <span class="hljs-number">5L</span>;<br>    <span class="hljs-comment">// 数据标识id所占的位数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> dataCenterIdBits = <span class="hljs-number">5L</span>;<br>    <span class="hljs-comment">// 支持的最大机器id(十进制)，结果是31 (这个移位算法可以很快的计算出几位二进制数所能表示的最大十进制数)</span><br>    <span class="hljs-comment">// -1L 左移 5位 (worker id 所占位数) 即 5位二进制所能获得的最大十进制数 - 31</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> maxWorkerId = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; workerIdBits);<br>    <span class="hljs-comment">// 支持的最大数据标识id - 31</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> maxDataCenterId = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; dataCenterIdBits);<br>    <span class="hljs-comment">// 序列在id中占的位数</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> sequenceBits = <span class="hljs-number">12L</span>;<br>    <span class="hljs-comment">// 机器ID 左移位数 - 12 (即末 sequence 所占用的位数)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> workerIdMoveBits = sequenceBits;<br>    <span class="hljs-comment">// 数据标识id 左移位数 - 17(12+5)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> dataCenterIdMoveBits = sequenceBits + workerIdBits;<br>    <span class="hljs-comment">// 时间截向 左移位数 - 22(5+5+12)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> timestampMoveBits = sequenceBits + workerIdBits + dataCenterIdBits;<br>    <span class="hljs-comment">// 生成序列的掩码(12位所对应的最大整数值)，这里为4095 (0b111111111111=0xfff=4095)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> sequenceMask = -<span class="hljs-number">1L</span> ^ (-<span class="hljs-number">1L</span> &lt;&lt; sequenceBits);<br>    <span class="hljs-comment">//=================================================Works&#x27;s Parameter================================================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 工作机器ID(0~31)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> workerId;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 数据中心ID(0~31)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> dataCenterId;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 毫秒内序列(0~4095)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> sequence = <span class="hljs-number">0L</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 上次生成ID的时间截</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> lastTimestamp = -<span class="hljs-number">1L</span>;<br>    <span class="hljs-comment">//===============================================Constructors=======================================================</span><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 构造函数</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> workerId     工作ID (0~31)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> dataCenterId 数据中心ID (0~31)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SnowflakeIdGenerator</span><span class="hljs-params">(<span class="hljs-keyword">long</span> workerId, <span class="hljs-keyword">long</span> dataCenterId)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (workerId &gt; maxWorkerId || workerId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(String.format(<span class="hljs-string">&quot;Worker Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxWorkerId));<br>        &#125;<br>        <span class="hljs-keyword">if</span> (dataCenterId &gt; maxDataCenterId || dataCenterId &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(String.format(<span class="hljs-string">&quot;DataCenter Id can&#x27;t be greater than %d or less than 0&quot;</span>, maxDataCenterId));<br>        &#125;<br>        <span class="hljs-keyword">this</span>.workerId = workerId;<br>        <span class="hljs-keyword">this</span>.dataCenterId = dataCenterId;<br>    &#125;<br>    <span class="hljs-comment">// ==================================================Methods========================================================</span><br>    <span class="hljs-comment">// 线程安全的获得下一个 ID 的方法</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">long</span> <span class="hljs-title">nextId</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> timestamp = currentTime();<br>        <span class="hljs-comment">//如果当前时间小于上一次ID生成的时间戳: 说明系统时钟回退过 - 这个时候应当抛出异常</span><br>        <span class="hljs-keyword">if</span> (timestamp &lt; lastTimestamp) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<br>                    String.format(<span class="hljs-string">&quot;Clock moved backwards.  Refusing to generate id for %d milliseconds&quot;</span>, lastTimestamp - timestamp));<br>        &#125;<br>        <span class="hljs-comment">//如果是同一时间生成的，则进行毫秒内序列</span><br>        <span class="hljs-keyword">if</span> (lastTimestamp == timestamp) &#123;<br>            sequence = (sequence + <span class="hljs-number">1</span>) &amp; sequenceMask;<br>            <span class="hljs-comment">//毫秒内序列溢出 即 序列 &gt; 4095</span><br>            <span class="hljs-keyword">if</span> (sequence == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-comment">//阻塞到下一个毫秒,获得新的时间戳</span><br>                timestamp = blockTillNextMillis(lastTimestamp);<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">//时间戳改变，毫秒内序列重置</span><br>        <span class="hljs-keyword">else</span> &#123;<br>            sequence = <span class="hljs-number">0L</span>;<br>        &#125;<br>        <span class="hljs-comment">//上次生成ID的时间截</span><br>        lastTimestamp = timestamp;<br>        <span class="hljs-comment">//移位并通过或运算拼到一起组成64位的ID</span><br>        <span class="hljs-keyword">return</span> ((timestamp - startTime) &lt;&lt; timestampMoveBits) <span class="hljs-comment">//</span><br>                | (dataCenterId &lt;&lt; dataCenterIdMoveBits) <span class="hljs-comment">//</span><br>                | (workerId &lt;&lt; workerIdMoveBits) <span class="hljs-comment">//</span><br>                | sequence;<br>    &#125;<br>    <span class="hljs-comment">// 阻塞到下一个毫秒 即 直到获得新的时间戳</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">long</span> <span class="hljs-title">blockTillNextMillis</span><span class="hljs-params">(<span class="hljs-keyword">long</span> lastTimestamp)</span> </span>&#123;<br>        <span class="hljs-keyword">long</span> timestamp = currentTime();<br>        <span class="hljs-keyword">while</span> (timestamp &lt;= lastTimestamp) &#123;<br>            timestamp = currentTime();<br>        &#125;<br>        <span class="hljs-keyword">return</span> timestamp;<br>    &#125;<br>    <span class="hljs-comment">// 获得以毫秒为单位的当前时间</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">long</span> <span class="hljs-title">currentTime</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> System.currentTimeMillis();<br>    &#125;<br>    <span class="hljs-comment">//====================================================Test Case=====================================================</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SnowflakeIdGenerator idWorker = <span class="hljs-keyword">new</span> SnowflakeIdGenerator(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>            <span class="hljs-keyword">long</span> id = idWorker.nextId();<br>            <span class="hljs-comment">//System.out.println(Long.toBinaryString(id));</span><br>            System.out.println(id);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>来源:<a href="http://blog.csdn.net/u010398771/article/details/79765836">http://blog.csdn.net/u010398771/article/details/79765836</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E9%80%9A%E4%BF%A1/"/>
    <url>/2022/01/16/cnblog/%E9%80%9A%E4%BF%A1/</url>
    
    <content type="html"><![CDATA[<h1 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h1><p>生产者消费者</p><ul><li><p>一、使用同一个共享变量控制</p></li><li><ul><li>Synchronized、wait、notify</li><li>Lock、Condition</li><li>利用volatile</li><li>利用AtomicInteger</li></ul></li><li><p>二、PipedInputStream、PipedOutputStream</p></li><li><p>三、利用BlockingQueue</p></li></ul><h1 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h1><ul><li><p>管道（Pipe）：管道可用于具有亲缘关系进程间的通信，允许一个进程和另一个与它有共同祖先的进程之间进行通信。</p></li><li><p>命名管道（named pipe）：命名管道克服了管道没有名字的限制，因此，除具有管道所具有的功能外，它还允许无亲缘关系进程间的通信。命名管道在文件系统中有对应的文件名。命名管道通过命令mkfifo或系统调用mkfifo来创建。</p></li><li><p>信号（Signal）：信号是比较复杂的通信方式，用于通知接受进程有某种事件发生，除了用于进程间通信外，进程还可以发送信号给进程本身</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs java">OperateSignal operateSignalHandler = <span class="hljs-keyword">new</span> OperateSignal();<br>Signal sig = <span class="hljs-keyword">new</span> Signal(<span class="hljs-string">&quot;USR2&quot;</span>);<br>Signal.handle(sig, operateSignalHandler);<br></code></pre></td></tr></table></figure></li><li><p>消息（Message）队列：消息队列是消息的链接表，包括Posix消息队列system V消息队列。有足够权限的进程可以向队列中添加消息，被赋予读权限的进程则可以读走队列中的消息。消息队列克服了信号承载信息量少，管道只能承载无格式字节流以及缓冲区大小受限等缺限。</p></li><li><p>共享内存：使得多个进程可以访问同一块内存空间，是最快的可用IPC形式。是针对其他通信机制运行效率较低而设计的。往往与其它通信机制，如信号量结合使用，来达到进程间的同步及互斥。</p></li><li><p>内存映射（mapped memory）：内存映射允许任何多个进程间通信，每一个使用该机制的进程通过把一个共享的文件映射到自己的进程地址空间来实现它。Java 中有类 MappedByteBuffer实现内存映射</p></li><li><p>信号量（semaphore）：主要作为进程间以及同一进程不同线程之间的同步手段。</p></li><li><p>套接口（Socket）：更为一般的进程间通信机制，可用于不同机器之间的进程间通信。</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9C%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"/>
    <url>/2022/01/16/cnblog/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%9C%A8%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<ol><li>学习源码框架，为什么要从Mybatis框架入手？<ol><li>在 MyBatis 3.5.1 这个版中有 968 个类、 2770 个字段、 8422个方法、 42504 行代码、 186428个指令码。</li><li>其源码体量只有 Spring 的1/5，也是 Hibernate 的1/5。但在功能上这三个框架并无高低之分，但从源码轻量级来讲，入手MyBatis无疑是最容易的。</li><li>熟悉Mybatis的都知道，其源码里涉及到非常多的设计模式，当然也离不开阅读源码的技巧方法：</li><li>Mybatis源码的设计模式使用<ol><li>Builder模式:例如SqlSessionFactoryBuilder、XMLConfigBuilder、XMLMapperBuilder、XMLStatementBuilder、CacheBuilder；</li><li>工厂模式:例如SqlSessionFactory、ObjectFactory、MapperProxyFactory；</li><li>单例模式:例如ErrorContext和LogFactory；</li><li>代理模式:Mybatis实现的核心，比如MapperProxy、ConnectionLogger，用的jdk的动态代理；还有executor.loader包使用了cglib或者javassist达到延迟加载的效果；</li><li>组合模式:例如SqlNode和各个子类ChooseSqlNode等；</li><li>模板方法模式:例如BaseExecutor和SimpleExecutor，还有BaseTypeHandler和所有的子类例如IntegerTypeHandler；</li><li>适配器模式:例如Log的Mybatis接口和它对jdbc、log4j等各种日志框架的适配实现；</li><li>装饰者模式:例如Cache包中的cache.decorators子包中等各个装饰者的实现；</li><li>迭代器模式:例如迭代器模式PropertyTokenizer；</li></ol></li></ol></li><li>Spring源码中的设计模式使用<ol><li>工程模式：Spring中的BeanFactory就是简单工厂模式的体现，根据传入一个唯一的标识来获得Bean对象</li><li>单例模式：Spring依赖注入Bean实例默认是单例的。Spring的依赖注入（包括lazy-init方式）都是发生在AbstractBeanFactory的getBean里。getBean的doGetBean方法调用getSingleton进行bean的创建。</li><li>装饰器模式：Spring中用到的包装器模式在类名上有两种表现：一种是类名中含有Wrapper，另一种是类名中含有Decorator。</li><li>代理模式：AOP底层，就是动态代理模式的实现</li><li>观察者模式：Spring的事件驱动模型使用的是 观察者模式 ，Spring中Observer模式常用的地方是listener的实现。如：ApplicationContextEvent、ApplicationListener</li><li>策略模式：Spring框架的资源访问Resource接口。该接口提供了更强的资源访问能力，Spring 框架本身大量使用了 Resource 接口来访我们的回忆没有皱褶，你却用离开烫下句点 ——陈奕迅《淘汰》问底层资源。</li></ol></li></ol><p>UrlResource：访问网络资源的实现类。</p><p>ClassPathResource：访问类加载路径里资源的实现类。</p><p>FileSystemResource：访问文件系统里资源的实现类。</p><p>ServletContextResource：访问相对于 ServletContext 路径里的资源的实现类.</p><p>InputStreamResource：访问输入流资源的实现类。</p><p>ByteArrayResource：访问字节数组资源的实现类。</p><p>看源码技巧</p><p>1.先使用:先看官方文档快速掌握框架的基本使用</p><p>2.抓主线:找一个demo入手，顺藤摸瓜，快速静态看一遍框架的主线源码(抓大放小)，画出源码主流程图。切勿一开始就陷入源码的细枝末节，否则会把自己绕晕</p><p>3.画图做笔记:总结框架的一些核心功能点，从这些功能点入手。深入到源码的细节，边看源码边画源码走向图，并对关键源码的理解做 笔记，把源码里的闪光点都记录下来，后续借鉴到工作项目中。理解能力强的可以直接看静态源码，也可以边看源码边debug源码执行过 程，观察一些关键变量的值</p><p>4.整合总结:所有功能点的源码都分析完后，回到主流程图再梳理一遍，争取把自己画的所有图都在脑袋里做一个整合</p><p>5.静态看源码，作图，做笔记</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E7%BD%91%E9%A1%B5%E5%BC%95%E5%85%A5mathjax%EF%BC%8Clatex/"/>
    <url>/2022/01/16/cnblog/%E7%BD%91%E9%A1%B5%E5%BC%95%E5%85%A5mathjax%EF%BC%8Clatex/</url>
    
    <content type="html"><![CDATA[<p>Mathjax:2.x</p><p>整理一</p><div class="code-wrapper"><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/x-mathjax-config"&gt;MathJax.Hub.Config(&#123;    <span class="hljs-attr">showProcessingMessages: <span class="hljs-literal"><span class="hljs-literal">false,    <span class="hljs-attr">messageStyle: <span class="hljs-string"><span class="hljs-string">"none",    <span class="hljs-attr">extensions: [<span class="hljs-string"><span class="hljs-string">"tex2jax.js"],    <span class="hljs-attr">jax: [<span class="hljs-string"><span class="hljs-string">"input/TeX", <span class="hljs-string"><span class="hljs-string">"output/HTML-CSS"],    <span class="hljs-attr">tex2jax: &#123;        <span class="hljs-attr">inlineMath:  [ [<span class="hljs-string"><span class="hljs-string">"$", <span class="hljs-string"><span class="hljs-string">"$"] ],        <span class="hljs-attr">displayMath: [ [<span class="hljs-string"><span class="hljs-string">"$$",<span class="hljs-string"><span class="hljs-string">"$$"] ],        <span class="hljs-attr">skipTags: [<span class="hljs-string"><span class="hljs-string">'script', <span class="hljs-string"><span class="hljs-string">'noscript', <span class="hljs-string"><span class="hljs-string">'style', <span class="hljs-string"><span class="hljs-string">'textarea', <span class="hljs-string"><span class="hljs-string">'pre',<span class="hljs-string"><span class="hljs-string">'code',<span class="hljs-string"><span class="hljs-string">'a'],        <span class="hljs-attr">ignoreClass:<span class="hljs-string"><span class="hljs-string">"comment-content"    &#125;,    <span class="hljs-string"><span class="hljs-string">"HTML-CSS": &#123;        <span class="hljs-attr">availableFonts: [<span class="hljs-string"><span class="hljs-string">"STIX",<span class="hljs-string"><span class="hljs-string">"TeX"],        <span class="hljs-attr">showMathMenu: <span class="hljs-literal"><span class="hljs-literal">false    &#125;&#125;);MathJax.Hub.Queue([<span class="hljs-string"><span class="hljs-string">"Typeset",MathJax.Hub]);<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;<span class="hljs-tag">&lt;<span class="hljs-title">script <span class="hljs-attribute">src=<span class="hljs-value"><span class="hljs-string">"//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"&gt;<span class="javascript"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre></div><p>整理二</p><div class="code-wrapper"><pre><code class="javascript hljs">&lt;script type=<span class="hljs-string"><span class="hljs-string">"text/x-mathjax-config"&gt;<span class="hljs-keyword"><span class="hljs-keyword">var mathId = <span class="hljs-built_in"><span class="hljs-built_in">document.getElementById(<span class="hljs-string"><span class="hljs-string">"post-content");MathJax.Hub.Config(&#123;    <span class="hljs-attr">showProcessingMessages: <span class="hljs-literal"><span class="hljs-literal">false,    <span class="hljs-attr">messageStyle: <span class="hljs-string"><span class="hljs-string">"none",    <span class="hljs-attr">extensions: [<span class="hljs-string"><span class="hljs-string">"tex2jax.js"],    <span class="hljs-attr">jax: [<span class="hljs-string"><span class="hljs-string">"input/TeX", <span class="hljs-string"><span class="hljs-string">"output/HTML-CSS"],    <span class="hljs-attr">tex2jax: &#123;        <span class="hljs-attr">inlineMath:  [ [<span class="hljs-string"><span class="hljs-string">"$", <span class="hljs-string"><span class="hljs-string">"$"] ],        <span class="hljs-attr">displayMath: [ [<span class="hljs-string"><span class="hljs-string">"$$",<span class="hljs-string"><span class="hljs-string">"$$"] ],        <span class="hljs-attr">skipTags: [<span class="hljs-string"><span class="hljs-string">'script', <span class="hljs-string"><span class="hljs-string">'noscript', <span class="hljs-string"><span class="hljs-string">'style', <span class="hljs-string"><span class="hljs-string">'textarea', <span class="hljs-string"><span class="hljs-string">'pre',<span class="hljs-string"><span class="hljs-string">'code',<span class="hljs-string"><span class="hljs-string">'a'],        <span class="hljs-attr">ignoreClass:<span class="hljs-string"><span class="hljs-string">"comment-content"    &#125;,    <span class="hljs-string"><span class="hljs-string">"HTML-CSS": &#123;        <span class="hljs-attr">availableFonts: [<span class="hljs-string"><span class="hljs-string">"STIX",<span class="hljs-string"><span class="hljs-string">"TeX"],        <span class="hljs-attr">showMathMenu: <span class="hljs-literal"><span class="hljs-literal">false    &#125;&#125;);MathJax.Hub.Queue([<span class="hljs-string"><span class="hljs-string">"Typeset",MathJax.Hub,mathId]);<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;<span class="hljs-tag">&lt;<span class="hljs-title">script <span class="hljs-attribute">src=<span class="hljs-value"><span class="hljs-string">"//<span class="hljs-string">cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"&gt;<span class="javascript"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre></div><h2 id="articleHeader14">修复与Instantclick的冲突</h2><p>代码如下</p><p>适用于整理一的代码</p><div class="code-wrapper"><pre><code class="javascript hljs">&lt;script data-no-instant&gt;InstantClick.on(<span class="hljs-string"><span class="hljs-string">'change', <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function<span class="hljs-params"><span class="hljs-function">(<span class="hljs-params">isInitialLoad)&#123;    <span class="hljs-keyword"><span class="hljs-keyword">if (isInitialLoad === <span class="hljs-literal"><span class="hljs-literal">false) &#123;        <span class="hljs-keyword"><span class="hljs-keyword">if (<span class="hljs-keyword"><span class="hljs-keyword">typeof MathJax !== <span class="hljs-string"><span class="hljs-string">'undefined')&#123;            MathJax.Hub.Queue([<span class="hljs-string"><span class="hljs-string">"Typeset",MathJax.Hub]);        &#125;    &#125;&#125;);InstantClick.init();<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre></div><p>适用于整理二的代码</p><div class="widget-codetool">&nbsp;</div><div class="code-wrapper"><pre><code class="javascript hljs">&lt;script data-no-instant&gt;InstantClick.on(<span class="hljs-string"><span class="hljs-string">'change', <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function<span class="hljs-params"><span class="hljs-function">(<span class="hljs-params">isInitialLoad)&#123;    <span class="hljs-keyword"><span class="hljs-keyword">if (isInitialLoad === <span class="hljs-literal"><span class="hljs-literal">false) &#123;        <span class="hljs-keyword"><span class="hljs-keyword">if (<span class="hljs-keyword"><span class="hljs-keyword">typeof MathJax !== <span class="hljs-string"><span class="hljs-string">'undefined')&#123;            <span class="hljs-keyword"><span class="hljs-keyword">var mathId = <span class="hljs-built_in"><span class="hljs-built_in">document.getElementById(<span class="hljs-string"><span class="hljs-string">"post-content");            MathJax.Hub.Queue([<span class="hljs-string"><span class="hljs-string">"Typeset",MathJax.Hub,mathId]);        &#125;    &#125;&#125;);InstantClick.init();<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-title"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E5%8E%86%E5%8F%B2/"/>
    <url>/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E7%AE%97%E6%B3%95%E5%8E%86%E5%8F%B2/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191226151440384-62994965.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B_1/"/>
    <url>/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B_1/</url>
    
    <content type="html"><![CDATA[<h1 id="Keywords-Ubuntu-VOC-Object-detection"><a href="#Keywords-Ubuntu-VOC-Object-detection" class="headerlink" title="Keywords :Ubuntu,VOC,Object_detection"></a><strong>Keywords</strong> :Ubuntu,VOC,Object_detection</h1><h1 id="1，环境搭建"><a href="#1，环境搭建" class="headerlink" title="1，环境搭建"></a>1，环境搭建</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">使用anaconda3， 先安装<br>换源，若不然会非常慢 方式参考 https://www.cnblogs.com/Dean0731/p/11560371.html<br>export PATH=&quot;/usr/local/anaconda3/bin:$PATH&quot;<br>新建虚拟环境 本例python=3.5<br>进入环境本例安装的tensorflow=1.14.0<br>安装其他依赖包,pillow,lxml 等，亦可以等待报错时安装相应模块<br>    本例环境 windwos：python3.6+tensorflow-1.12<br>            windwos：python3.6+tensorflow-gpu-1.12+cuda8.0<br>                # 注意选择cuda版本 有最小计算能力 ，需要小于你显卡的计算能力，若不匹配的话 可能会忽略显卡的加速作用，而且很卡<br>                # 本例使用GT820m   2.1计算能力     cuda9.0 计算能力最小为3.7<br>                # 显卡计算能力查询 https://developer.nvidia.com/cuda-gpus<br>                # tensorflow---》cuda--》cudnn     https://tensorflow.google.cn/install/source<br>                #     python----决定tensorflow的版本<br>                # 先根据显卡选cuda<br>            linux：python3.5+tensorflow-1.14<br></code></pre></td></tr></table></figure><h1 id="2，下载数据"><a href="#2，下载数据" class="headerlink" title="2，下载数据"></a>2，下载数据</h1><ul><li>models:<a href="https://github.com/tensorflow/models.git">https://github.com/tensorflow/models.git</a>  使用git下载 或直接下载zip</li><li>VOC2012:链接: <a href="https://pan.baidu.com/s/12IP4iyL9hN5Dohzkm8wi7A">https://pan.baidu.com/s/12IP4iyL9hN5Dohzkm8wi7A</a> 提取码: q31q<br>也可到官网下载，比较慢 visual object classes 2012 一共20类别，一共5个文件夹<ul><li>JPEGImages存放图片；</li><li>Annotation存放对图片的标注信息（XML文件），即外包边框bounding box的位置信息；</li><li>SegmentationClass和SegmentationObject存放了图片的分割前景。</li><li>ImageSets是对图片集合的描述，分别对应了不同的竞赛任务，例如Layout表示图片中人体部位的数据，Main表示每个图片包含的分类信息（20个类别），Segmentation表示用于分割的数据，2007没有action，2012有了action数据，表示图片中人的动作。</li></ul></li></ul><p>注：train 训练集，trainval 训练集中的测试集，val 测试集</p><h1 id="3，models-部署"><a href="#3，models-部署" class="headerlink" title="3，models 部署"></a>3，models 部署</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 生成objection——detection/protos 下的py文件 models/research 目录下</span><br>linux protoc object_detection/protos/*.proto --python_out=. <br>windows Get-ChildItem object_detection/protos/*.proto | Resolve-Path -Relative | %&#123; protoc $_ --python_out=. &#125;<br><span class="hljs-comment"># 运行完成后，可以检查object_detection/protos/文件夹，如果每个proto文件都成了对应的以py为后缀的python源码，就说明编译成功了</span><br><span class="hljs-comment"># 添加环境</span><br><span class="hljs-comment">#    需要当前虚拟环境中进入在这2目录中(research,research/slim)python setup.py install  把object_detection等模块装入 </span><br><span class="hljs-comment">#    若还出现错误变量(报当前线程错误等)可试试添加环境变量：</span><br><span class="hljs-comment">#    export PYTHONPATH=$PYTHONPATH:/home/dzf/models/research:/home/dzf/models/research/slim</span><br><span class="hljs-comment">#    PYTHONPATH:上边两个目录    </span><br></code></pre></td></tr></table></figure><h1 id="4，生成数据"><a href="#4，生成数据" class="headerlink" title="4，生成数据"></a>4，生成数据</h1><ul><li><p>准备：VOC2012 解压后的数据  VOCdevkit</p><ul><li>models/research/objection_detection/create_pascal_tf_record.py  # 将数据转换为record 的文件</li><li>export_inference_graph.py  # 后边用到，将模型转换为应用</li><li>pascal_label_map.pbtxt  # 标签<br>修改create_pascal_tf_record.py 164行 <div class="code-wrapper"><pre><code class="hljs">          改为 data_dir, year, &#39;ImageSets&#39;, &#39;Main&#39;,FLAGS.set + &#39;.txt&#39; 对应文件目录</code></pre></div></li></ul></li><li><p>生成数据 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 可能需要pillow，lxml等包</span><br><span class="hljs-comment"># data_dir voc目录 即为解压后文件夹</span><br><span class="hljs-comment"># year 接收VOC2007 VOC2012</span><br><span class="hljs-comment"># set 表示使用train训练</span><br><span class="hljs-comment"># output_path 生成的文件路径</span><br><span class="hljs-comment"># 可能会报错  data/pascal_label_map.pbtxt 找不到 移到上级目录运行即可</span><br>python create_pascal_tf_record.py <br>--<span class="hljs-built_in">set</span>=train或val 表示时生成训练数据还是测试数据<br>--data_dir=.../VOCdevkit<br>--year=VOC2012 默认 VOC2007<br>--output_path=..../训练文件.record（pascal_train.record）<br>pascal_train.record  <span class="hljs-comment">#  生成的训练数据</span><br>pascal_val.record   <span class="hljs-comment"># 生成的测试数据</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="5，模型训练"><a href="#5，模型训练" class="headerlink" title="5，模型训练"></a>5，模型训练</h1><ul><li><p>models：在objection_detection/sample/config/xxxxxx.config   # models配置文件<br>包含训练次数，分类数，测试集，测试集标签，训练集，训练集标签的位置</p><div class="code-wrapper"><pre><code class="hljs">      重要：接其官方的训练结果 fine_tune_checkpoint: &quot;下载的他人models解压后的文件夹/model.ckpt&quot;          下载地址:https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md          注意下载的models要与你选择的model.config一致 本例为 [faster_rcnn_inception_resnet_v2_atrous_coco](http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_coco_2018_01_28.tar.gz)  加压后有文件夹faster_rcnn_inception_resnet_v2_atrous_coco_2018_1_29</code></pre></div></li><li><p>修改配置文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 指定接着训练的模型，若要重新开始注释本行，下行改为false即可</span><br>fine_tune_checkpoint: <span class="hljs-string">&quot;D:\\\\faster_rcnn_inception_resnet_v2_atrous_coco_2018_1_29\\model.ckpt&quot;</span><br>from_detection_checkpoint: true<br><span class="hljs-comment"># 训练集，训练集标签，测试集，测试集标签</span><br>input_path: <span class="hljs-string">&quot;D:\\\pascal_train.record&quot;</span><br>label_map_path: <span class="hljs-string">&quot;D:\\data\\pascal_label_map.pbtxt&quot;</span><br>input_path: <span class="hljs-string">&quot;D:\\models\\pascal_val.record&quot;</span><br>label_map_path: <span class="hljs-string">&quot;D:\\models\\pascal_label_map.pbtxt&quot;</span><br></code></pre></td></tr></table></figure></li><li><p>```python</p><h1 id="开始训练：cpu训练较慢，可在配置文件修改次数，若出现内存溢出，也可修改config中的图片大小600x1024，可改小一点"><a href="#开始训练：cpu训练较慢，可在配置文件修改次数，若出现内存溢出，也可修改config中的图片大小600x1024，可改小一点" class="headerlink" title="开始训练：cpu训练较慢，可在配置文件修改次数，若出现内存溢出，也可修改config中的图片大小600x1024，可改小一点"></a>开始训练：cpu训练较慢，可在配置文件修改次数，若出现内存溢出，也可修改config中的图片大小600x1024，可改小一点</h1><p>python legacy/train.py </p><div class="code-wrapper"><pre><code class="hljs">    --train_dir=/home/dzf/train # model # 输出目录    --pipeline_config_path=/home/dzf/dataset/models/faster_rcnn_inception_resnet_v2_atrous_coco.config # 配置文件</code></pre></div><h1 id="新版的models-是用的是object-detection-model-main-py-–model-dir-…"><a href="#新版的models-是用的是object-detection-model-main-py-–model-dir-…" class="headerlink" title="新版的models 是用的是object_detection/model_main.py –model_dir=….."></a>新版的models 是用的是object_detection/model_main.py –model_dir=…..</h1><h1 id="旧版的models-使用的是object-detection-train-py-–train-dir-…"><a href="#旧版的models-使用的是object-detection-train-py-–train-dir-…" class="headerlink" title="旧版的models 使用的是object_detection/train.py –train_dir=…"></a>旧版的models 使用的是object_detection/train.py –train_dir=…</h1><h1 id="注意形参名称改变了，本例使用的是新版的models但使用的是legacy-train-py"><a href="#注意形参名称改变了，本例使用的是新版的models但使用的是legacy-train-py" class="headerlink" title="注意形参名称改变了，本例使用的是新版的models但使用的是legacy/train.py"></a>注意形参名称改变了，本例使用的是新版的models但使用的是legacy/train.py</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>  <br><br><span class="hljs-comment"># 6，导出模型为pb文件</span><br><br>```python<br>python export_inference_graph.py <br><span class="hljs-attribute">--input_type</span>=image_tensor<br>    <span class="hljs-attribute">--pipeline_config_path</span>=/...../models/faster_rcnn_inception_resnet_v2_atrous_coco.config <br><span class="hljs-attribute">--trained_checkpoint_prefix</span>=/...../train/model.ckpt-10 <br><span class="hljs-attribute">--output_directory</span>=/..../train<br></code></pre></td></tr></table></figure></li></ul><p>注：上编的路径尽量使用绝对路径，不要使用相对路径和～符号 可能报错<br>生成frozen_inference_graph.pb文件 及其他文件</p><h1 id="7，使用pd文件检测图片"><a href="#7，使用pd文件检测图片" class="headerlink" title="7，使用pd文件检测图片"></a>7，使用pd文件检测图片</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> cv2<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> pathlib<br><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> six.moves.urllib <span class="hljs-keyword">as</span> urllib<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> tarfile<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">import</span> zipfile<br><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><span class="hljs-keyword">from</span> io <span class="hljs-keyword">import</span> StringIO<br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> display<br><br><span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> ops <span class="hljs-keyword">as</span> utils_ops<br><span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> label_map_util<br><span class="hljs-keyword">from</span> object_detection.utils <span class="hljs-keyword">import</span> visualization_utils <span class="hljs-keyword">as</span> vis_util<br><br><span class="hljs-comment"># patch tf1 into `utils.ops`</span><br>utils_ops.tf = tf.compat.v1<br><br><span class="hljs-comment"># Patch the location of gfile</span><br>tf.gfile = tf.io.gfile<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_model</span>(<span class="hljs-params">model_name</span>):</span><br>  <span class="hljs-comment"># here</span><br><span class="hljs-comment">#   base_url = &#x27;http://download.tensorflow.org/models/object_detection/&#x27;</span><br><span class="hljs-comment">#   model_file = model_name + &#x27;.tar.gz&#x27;</span><br><span class="hljs-comment">#   model_dir = tf.keras.utils.get_file(</span><br><span class="hljs-comment">#     fname=model_name, </span><br><span class="hljs-comment">#     origin=base_url + model_file,</span><br><span class="hljs-comment">#     untar=True)</span><br><br>  <span class="hljs-comment">#model_dir = pathlib.Path(&quot;ssd_mobilenet_v1_coco_2017_11_17&quot;)/&quot;saved_model&quot;</span><br>  <span class="hljs-comment">#model_dir = pathlib.Path(&quot;legacy/pb/pb56339&quot;)/&quot;saved_model&quot;</span><br>  model_dir = pathlib.Path(<span class="hljs-string">&quot;pb/pb1218&quot;</span>)/<span class="hljs-string">&quot;saved_model&quot;</span><br>  model = tf.saved_model.load(<span class="hljs-built_in">str</span>(model_dir))<br>  model = model.signatures[<span class="hljs-string">&#x27;serving_default&#x27;</span>]<br><br>  <span class="hljs-keyword">return</span> model<br><br><span class="hljs-comment"># List of the strings that is used to add correct label for each box.</span><br>PATH_TO_LABELS = <span class="hljs-string">&#x27;data/pascal_label_map.pbtxt&#x27;</span><br>category_index = label_map_util.create_category_index_from_labelmap(PATH_TO_LABELS, use_display_name=<span class="hljs-literal">True</span>)<br><br><span class="hljs-comment"># If you want to test the code with your images, just add path to the images to the TEST_IMAGE_PATHS.</span><br>PATH_TO_TEST_IMAGES_DIR = pathlib.Path(<span class="hljs-string">&#x27;test_images2&#x27;</span>)<br>TEST_IMAGE_PATHS = <span class="hljs-built_in">sorted</span>(<span class="hljs-built_in">list</span>(PATH_TO_TEST_IMAGES_DIR.glob(<span class="hljs-string">&quot;*.jpg&quot;</span>)))<br>TEST_IMAGE_PATHS<br>model_name = <span class="hljs-string">&#x27;ssd_mobilenet_v1_coco_2017_11_17&#x27;</span><br>detection_model = load_model(model_name)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run_inference_for_single_image</span>(<span class="hljs-params">model, image</span>):</span><br>  image = np.asarray(image)<br>  <span class="hljs-comment"># The input needs to be a tensor, convert it using `tf.convert_to_tensor`.</span><br>  input_tensor = tf.convert_to_tensor(image)<br>  <span class="hljs-comment"># The model expects a batch of images, so add an axis with `tf.newaxis`.</span><br>  input_tensor = input_tensor[tf.newaxis,...]<br><br>  <span class="hljs-comment"># Run inference</span><br>  output_dict = model(input_tensor)<br><br>  <span class="hljs-comment"># All outputs are batches tensors.</span><br>  <span class="hljs-comment"># Convert to numpy arrays, and take index [0] to remove the batch dimension.</span><br>  <span class="hljs-comment"># We&#x27;re only interested in the first num_detections.</span><br>  num_detections = <span class="hljs-built_in">int</span>(output_dict.pop(<span class="hljs-string">&#x27;num_detections&#x27;</span>))<br>  output_dict = &#123;key:value[<span class="hljs-number">0</span>, :num_detections].numpy() <br>                 <span class="hljs-keyword">for</span> key,value <span class="hljs-keyword">in</span> output_dict.items()&#125;<br>  output_dict[<span class="hljs-string">&#x27;num_detections&#x27;</span>] = num_detections<br><br>  <span class="hljs-comment"># detection_classes should be ints.</span><br>  output_dict[<span class="hljs-string">&#x27;detection_classes&#x27;</span>] = output_dict[<span class="hljs-string">&#x27;detection_classes&#x27;</span>].astype(np.int64)<br>   <br>  <span class="hljs-comment"># Handle models with masks:</span><br>  <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;detection_masks&#x27;</span> <span class="hljs-keyword">in</span> output_dict:<br>    <span class="hljs-comment"># Reframe the the bbox mask to the image size.</span><br>    detection_masks_reframed = utils_ops.reframe_box_masks_to_image_masks(<br>              output_dict[<span class="hljs-string">&#x27;detection_masks&#x27;</span>], output_dict[<span class="hljs-string">&#x27;detection_boxes&#x27;</span>],<br>               image.shape[<span class="hljs-number">0</span>], image.shape[<span class="hljs-number">1</span>])      <br>    detection_masks_reframed = tf.cast(detection_masks_reframed &gt; <span class="hljs-number">0.5</span>,<br>                                       tf.uint8)<br>    output_dict[<span class="hljs-string">&#x27;detection_masks_reframed&#x27;</span>] = detection_masks_reframed.numpy()<br>  <span class="hljs-built_in">print</span>(output_dict[<span class="hljs-string">&#x27;detection_boxes&#x27;</span>])<br>  <span class="hljs-built_in">print</span>(output_dict[<span class="hljs-string">&#x27;detection_classes&#x27;</span>])<br>  <span class="hljs-built_in">print</span>(output_dict[<span class="hljs-string">&#x27;detection_scores&#x27;</span>])<br>  <span class="hljs-keyword">return</span> output_dict<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show_inference</span>(<span class="hljs-params">model, image_path</span>):</span><br>  <span class="hljs-comment"># the array based representation of the image will be used later in order to prepare the</span><br>  <span class="hljs-comment"># result image with boxes and labels on it.</span><br>  image_np = np.array(Image.<span class="hljs-built_in">open</span>(image_path))<br>  <span class="hljs-comment"># Actual detection.</span><br>  output_dict = run_inference_for_single_image(model, image_np)<br>  <span class="hljs-comment"># Visualization of the results of a detection.</span><br>  vis_util.visualize_boxes_and_labels_on_image_array(<br>      image_np,<br>      output_dict[<span class="hljs-string">&#x27;detection_boxes&#x27;</span>],<br>      output_dict[<span class="hljs-string">&#x27;detection_classes&#x27;</span>],<br>      output_dict[<span class="hljs-string">&#x27;detection_scores&#x27;</span>],<br>      category_index,<br>      instance_masks=output_dict.get(<span class="hljs-string">&#x27;detection_masks_reframed&#x27;</span>, <span class="hljs-literal">None</span>),<br>      use_normalized_coordinates=<span class="hljs-literal">True</span>,<br>      line_thickness=<span class="hljs-number">8</span>)<br><br>  <span class="hljs-comment">#display(Image.fromarray(image_np))</span><br>  cv2.namedWindow(<span class="hljs-string">&quot;detection&quot;</span>, cv2.WINDOW_NORMAL)<br>  cv2.imshow(<span class="hljs-string">&quot;detection&quot;</span>, image_np)<br>  cv2.waitKey(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> image_path <span class="hljs-keyword">in</span> TEST_IMAGE_PATHS:<br>  show_inference(detection_model, image_path)<br><span class="hljs-comment"># 本例中在原始模型训练的基础上的训练一定次数 生成model.ckpt   之后转为pb文件 进行目标检测 没有检测框</span><br><span class="hljs-comment"># 若使用原始模型的pb文件 faster_rcnn_inception_resnet_v2_atrous_coco_2018_1_29/frozen_interence_inception.pb 可以显示检测框，至于什么原因还没有找到</span><br><br><span class="hljs-comment"># 对于上面所述的现象，我重新搭建了一次环境，上面的train，export 等过程，我都是将py文件复制都单独文件夹 进行操作，</span><br><span class="hljs-comment"># 本次搜有的操作都位于models中，将数据放入object_detection中等，可解决上述问题。但还是会出现某些图片不能检测的问题，也可能是由于训练测试过少的原因。</span><br><span class="hljs-comment"># 使用model_main.py 预测时可能效果较好</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B_0/"/>
    <url>/2022/01/16/cnblog/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B_0/</url>
    
    <content type="html"><![CDATA[<h1 id="目标检测"><a href="#目标检测" class="headerlink" title="目标检测"></a>目标检测</h1><ol><li>rcnn：根据颜色等特征，将图像分为许多小区域（一般情况下颜色相同的都是一类物体）<ol><li>合并区域，然后进行区域内的物体检测  即到卷积中进行预测（每个框一个卷积网络）</li><li>缺点：找到的框太多</li></ol></li><li>fast-rcnn:整张图片卷积得到特征图<ul><li>图片映射到特征图，</li></ul></li><li>faster-rcnn:RPN 层，根据标注中框的位置，让卷积网络自己学习框应该在哪  （在特征图上提取框）<ul><li>怎么学习？<ul><li>有基数128,256,512，3种方式</li></ul></li><li>对于一个像素点生成9个框，以他为中心<ul><li>128*256,256*128,128*128</li><li>256*512,512*256,256*256</li><li>512*512,512*1024,1024*512</li></ul></li></ul></li></ol><h2 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h2><ol><li><h4 id="或获途径"><a href="#或获途径" class="headerlink" title="或获途径"></a>或获途径</h4><ul><li>Benchmark是一个行业的基准（数据库，论文，源码，结果）。 face benchmark或<a href="http://human-pose.mpi-inf.mpg.de/#">MPII Human Pose Dataset</a></li><li>论文</li><li>论坛或者交流社区 如thinkface </li></ul></li><li><h4 id="处理"><a href="#处理" class="headerlink" title="处理"></a>处理</h4><ol><li>正样本：裁剪，根据标注把目标裁剪出来，例如人脸，可使用opencv工具</li><li>负样本：随便选择的框，可与正样本重叠，但不能太多 这个比例 成为 inception open union （Iou） 一般为0.3，小于0.3为负样本 大于0.7为正样本（当做遮蔽的数据），中间的舍弃</li></ol></li><li><h4 id="根据不同框架数据集格式生成数据集"><a href="#根据不同框架数据集格式生成数据集" class="headerlink" title="根据不同框架数据集格式生成数据集"></a>根据不同框架数据集格式生成数据集</h4></li></ol><h3 id="训练"><a href="#训练" class="headerlink" title="训练"></a>训练</h3><ol><li>Input Image 227*227*3</li><li>Conv1 <ol><li>num_output=96 特征图数量</li><li>kernel_size=11 卷积核大小</li><li>stride=4 滑动步长  </li><li>input:55*55*96</li></ol></li><li>relu</li><li>Pool<ol><li>kernel_size=3,</li><li>stride=2</li><li>input:27*27*96</li></ol></li><li>经过多层卷积，,激活，池化，（偶尔还有规范化）</li><li>全连接层 4096*1<ol><li>激活</li><li>drop</li></ol></li><li>全连接分类n*1</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E7%88%AC%E8%99%AB/"/>
    <url>/2022/01/16/cnblog/%E7%88%AC%E8%99%AB/</url>
    
    <content type="html"><![CDATA[<p>1，初识爬虫</p><p>import requests<br />from bs4 import BeautifulSoup<br />import os<br />url="https://www.58pic.com/"<br />response = requests.get(url)<br />response.encoding='utf8'<br /># print(response.text)<br />soup = BeautifulSoup(response.text,"html.parser")</p><p># div = soup.find(name="div",attrs="id:xxxxx") # 返回值都是对象 obj.text返回标签中的值文本<br /># div.find_all("li") # 查找里边的li标签<br /># 唯一的时候用find,多个使用find_all<br /># print(url.rsplit("/",maxsplit=1))  # rsplit 从后向前分割,maxsplit 指定分割次数<br />ret = soup.find_all(name="img")<br />for img in ret:<br />    src = img.get("src")<br />    if src:<br />        ret = requests.get("https:"+src)<br />        name = src.rsplit("/",maxsplit=1)[1]<br />        with open(os.path.join(os.path.join(os.getcwd(),"img"),name),"wb") as f:<br />            f.write(ret.content)<br /># 通过继承实现java的接口功能<br />"""<br />class A:<br />    def fun():<br />        raise NotImplementdError("子类没有实现父类方法")<br />class B():<br />    pass<br />obj=B()<br />obj.fun()<br />通过此方式实现调用方法报错,注意只有在(调用)的时候才会报错</p><p>"""</p><p># ==============================================<br />"""<br />1,直接通过request.get()获取页面没有携带请求信息,容易别反爬发现<br />2,因此需要携带数据,仿照浏览器<br />requests.get(<br />    url="xxx",<br />    headers={<br />        "user-agent":"浏览器信息"    一般情况下这个即可,若还不可以,使用浏览器访问,逐个加上请求头即可<br />    }<br />)</p><p>&nbsp;</p><p>登录爬虫<br />1,请求头<br />2,数据<br />header中 data={"phone":"xxxx".......} 返回ret</p><p>获取cookies<br />ret.cookies.get_dict()  cookies做为字典返回</p><p>下次发送数据时带上<br />headers中 cookies={xxx}或 ret.cookies.get_dict()  有的网站这样即可,但有的不行<br />cookies 是放在请求头中的<br />1,访问主页,生成cookies, 登录时提交cookie,使生效, 此时再次返回的数据还有cookie 但它是无用的cookies<br />2,自动登录github<br />    a,get主页,找到input 获取csrf_token<br />    b,发送数据 csrf 用户名,密码,cookies<br />    c,访问url,携带cookies<br />3,请求主页后,会在请求头加字段或html中加字段,登录时返回<br />    re.findall("xxx='(.*?)'",文本,re.S)[0] 获取第一个<br />"""<br /># =================================<br /># requests.get() 中没有data,不用传数据 post里边有<br /># 若在里边中加入 params={"k1":"v1"} 此时请求头把它转为?参数及嵌入url get post都有</p><p># data，传请求体<br /># requests.post(<br />#     ...,<br />#     data={'user': 'alex', 'pwd': '123'}<br /># )</p><p># GET / index http1.1\r\nhost: c1.com\r\n\r\nuser = alex &amp; pwd = 123<br /># json，传请求体<br /># requests.post(<br />#     ...,<br />#     json={'user': 'alex', 'pwd': '123'}<br /># )<br /># GET / index http1.1\r\nhost: c1.com\r\nContent - Type: application / json\r\n\r\n{"user": "alex", "pwd": 123}</p><p># 代理 proxies<br /># 无验证<br />proxie_dict = {<br />    "https:/xxxx":"yyy", # 为单独url设置代理<br />    "http": "61.172.249.96:80",<br />    "https": "http://61.185.219.126:3128",<br />}<br />ret = requests.get("https://www.proxy360.cn/Proxy", proxies=proxie_dict)</p><p># 验证代理<br />from requests.auth import HTTPProxyAuth</p><p>proxyDict = {<br />    'http': '77.75.105.165',<br />    'https': '77.75.106.165'<br />}<br />auth = HTTPProxyAuth('用户名', '密码')</p><p>r = requests.get("http://www.google.com",proxies = proxyDict, auth = auth)<br />print(r.text)<br /># 发送文件<br />file_dict = {<br />    'f1': open('定制文件名','xxxx.log', 'rb')<br />}<br />requests.request(<br />    method='POST',<br />    url='http://127.0.0.1:8000/test/',<br />    files=file_dict<br />)<br /># =======================================================<br /># 认证 auth<br /># 内部：用户名和密码，用户和密码加密，放在请求头中传给后台。例如:路由器登录弹窗<br /># - "用户:密码"<br /># - base64("用户:密码")<br /># - "Basic base64("用户 | 密码")"<br /># - 请求头：Authorization： "basic base64("用户 | 密码")"  我们使用时,构造这个请求头即可</p><p>from requests.auth import HTTPBasicAuth, HTTPDigestAuth # 通过该模块生成</p><p>ret = requests.get('https://api.github.com/user', auth=HTTPBasicAuth('wupeiqi', 'sdfasdfasdf'))<br />print(ret.text)<br /># =======================================================<br /># 超时时间 连接1s就返回<br /># ret = requests.get('http://google.com/', timeout=1)<br /># print(ret)<br /># 连接5s,连接上1秒返回<br /># ret = requests.get('http://google.com/', timeout=(5, 1))<br /># print(ret)<br /># =======================================================<br /># 允许重定向 allow_redirects ,访问百度,百度让你转到搜狐,你去还是不去,若不去,没有响应体,只有响应头<br />ret = requests.get('http://127.0.0.1:8000/test/', allow_redirects=False)<br />print(ret.text)<br /># =======================================================<br /># 大文件下载 若通过普通方式,文件过大内存放不下<br /># 设置stream为true表示一点一点下载,为false表示全部到内存<br />from contextlib import closing<br />with closing(requests.get('http://httpbin.org/get', stream=True)) as r1:<br /># 在此处理响应。<br /> for i in r1.iter_content():<br />    print(i)<br /># =======================================================<br /># 证书(公钥)<br />#   用户访问服务器的时候要携带公钥,公钥位于一个地方(服务方要使用,所以交钱),使用时自动下载了,系统帮你携带<br />#   自定义证书, 用户访问时需要下载证书,访问时携带<br />requests.get('http://127.0.0.1:8000/test/', cert="xxxx/xxx/xxx.pem") # 一个证书<br />requests.get('http://127.0.0.1:8000/test/', cert=("xxxx/xxx/xxx.pem", "xxx.xxx.xx.key")) # 前边证书,后边秘钥<br />requests.get('http://127.0.0.1:8000/test/', cert="xxxx/xxx/xxx.pem")<br /># =======================================================<br />session = requests.sessions()<br />session.get("xxxx") # 第一次访问<br />session.get("xxxx") # 第二次访问 可能第二次访问需要添加cookies,通过此方式不用每次手动添加<br /># =======================================================<br /># beautifulsoup https://www.cnbolg.com/wupeiqi/articles/6283017.html<br /># ======================================================<br />"""<br />轮询:实时刷新,定时器,获取实施效果<br />长轮询:把请求保存30s,最大就是30s,请求回去后再次请求,再被保存30s, 以此达到实施效果<br />$(function(){}) 通过此方式对于个更新的标签同样生效<br />直接写function()对于新的ajax添加的组件可能时间失效<br />绑定时间的时候使用委托式 on的方式</p><p>长轮询实现方式:队列<br />也可以使用webocket实现,但是兼容性不好<br />from flask import Flask,render_template,request,jsonify,session<br />import uuid<br />import queue</p><p>app = Flask(__name__)<br />app.secret_key = 'asdfasdfasd'</p><p><br />USERS = {<br />    '1':{'name':'贝贝','count':1},<br />    '2':{'name':'小东北','count':0},<br />    '3':{'name':'何伟明','count':0},<br />}</p><p>QUEQUE_DICT = {<br />    # 'asdfasdfasdfasdf':Queue()<br />}</p><p>@app.route('/user/list')<br />def user_list():<br />    user_uuid = str(uuid.uuid4())<br />    QUEQUE_DICT[user_uuid] = queue.Queue()</p><p>    session['current_user_uuid'] = user_uuid<br />    return render_template('user_list.html',users=USERS)</p><p>@app.route('/vote',methods=['POST'])<br />def vote():<br />    uid = request.form.get('uid')<br />    USERS[uid]['count'] += 1<br />    for q in QUEQUE_DICT.values():<br />        q.put(USERS)<br />    return "投票成功"</p><p><br />@app.route('/get/vote',methods=['GET'])<br />def get_vote():<br />    user_uuid = session['current_user_uuid']<br />    q = QUEQUE_DICT[user_uuid]</p><p>    ret = {'status':True,'data':None}<br />    try:<br />        users = q.get(timeout=5)<br />        ret['data'] = users<br />    except queue.Empty:<br />        ret['status'] = False</p><p>    return jsonify(ret)</p><p>&nbsp;</p><p>if __name__ == '__main__':<br />    app.run(host='192.168.13.253',threaded=True)<br />    # app.run(threaded=True)<br />"""</p><p># http请求包括请求头, 请求体   头之间使用\r\n 隔开, 请求头与请求体之间使用\r\n\r\n隔开<br /># 响应同理</p><p><br /># requests中 ContentType默认是:urlencode-form....<br /># request.POST 获取数据时会检测是不是url..这个类型<br /># data发送数据时<br /># data={1:"a",2,"b"}  ---&gt; \r\n\r\n1=a&amp;2=b contentType 就是默认的类型 使用post可获得数据<br /># data=json.dumps({1:"a",2,"b"}) ---&gt;\r\n\r\n{1:"a",2,"b"}<br /># data=b"abcd"    -&gt; \r\n\r\n'abcd'</p><p># json 发送<br /># json={1:"a",2,"b"} ----&gt;\r\n\r\n{1:"a",2,"b"},<br />#   请求头中会添加ContentType:application/json,data不会,<br />#   不是ContentType默认类型,使用post无法获取<br /># 使用request.body --&gt; {1:"a",2,"b"}<br />#   是字节,先转换为字符串,再反序列化--&gt;字典</p><p># 出现FormDATA或表单数据  就是 &amp;连接的第一种方式<br /># requestpayload json格式 直接是<br />#   json={1="a",2="b"}<br />#   或使用data =json.dumps({}) 这种方式,若有中文data =json.dumps(bytes({},encoding="utf8"),ensure_ascii=False)</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E2%80%9C%20%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%A8%A1%E5%9E%8B%E2%80%9C%EF%BC%88end-to-end%20learning%EF%BC%89/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%9A%84%E2%80%9C%20%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%A8%A1%E5%9E%8B%E2%80%9C%EF%BC%88end-to-end%20learning%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>　　相对于深度学习，传统机器学习的流程往往由多个独立的模块组成，比如在一个典型的自然语言处理（Natural Language Processing）问题中，包括分词、词性标注、句法分析、语义分析等多个独立步骤，每个步骤是一个独立的任务，其结果的好坏会影响到下一步骤，从而影响整个训练的结果，这是非端到端的。</p><p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://img2018.cnblogs.com/i-beta/1333782/202002/1333782-20200224145506941-1921508047.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p><br />　　而深度学习模型在训练过程中，从输入端（输入数据）到输出端会得到一个预测结果，与真实结果相比较会得到一个误差，这个误差会在模型中的每一层传递（反向传播），每一层的表示都会根据这个误差来做调整，直到模型收敛或达到预期的效果才结束，中间所有的操作都包含在神经网络内部，不再分成多个模块处理。由原始数据输入，到结果输出，从输入端到输出端，中间的神经网络自成一体（也可以当做黑盒子看待），这是端到端的。</p><p>　　两者相比，端到端的学习省去了在每一个独立学习任务执行之前所做的数据标注，为样本做标注的代价是昂贵的、易出错的。</p><p><br />文章来源：<a href="https://blog.csdn.net/viatorsun/article/details/81880679">https://blog.csdn.net/viatorsun/article/details/81880679</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/1333782-20200331103344054-1930408834.png"><br><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/1333782-20200331103351144-1070409244.png"><br><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/1333782-20200331103544598-1832126774.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_4_%E5%88%86%E5%B8%83%E5%BC%8FTensorflow/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_4_%E5%88%86%E5%B8%83%E5%BC%8FTensorflow/</url>
    
    <content type="html"><![CDATA[<h1 id="分布式Tensorflow"><a href="#分布式Tensorflow" class="headerlink" title="分布式Tensorflow"></a>分布式Tensorflow</h1><p>单机多卡（gpu）</p><p>多级多卡（分布式）</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191107220009574-108863312.png"></p><h2 id="自实现分布式"><a href="#自实现分布式" class="headerlink" title="自实现分布式"></a>自实现分布式</h2><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191107220024231-1197572017.png"></p><p>API：</p><p>​    1，创建一个tf.train.ClusterSpec，用于对集群的所有任务进行描述，该描述对于所有任务相同</p><p>​    2，tf.train.Server 创建ps，worker 并运行相应的计算任务</p><ul><li><p>​    cluster=tf.train.ClusterSpec({“ps”:ps_spec,”worker”:worker_spec})</p><p>​        ps_spec = [“ps0.example.com:port”,”ps2.example.com:port”] 对应 /job:ps/task:0,1</p><p>​        worker_spec=[“worker0.example.com:port”,…]   /job:worker/task:10</p></li><li><p>tf.train.Server(server_orcluster,job_name,task_index=None,protocol_None,config=None,start=True) 创建服务</p><ul><li>server_or_cluster：集群描述</li><li>job_name:任务类型名称</li><li>task_index:任务数</li><li>attributes:target  返回tfSession连接到此服务器的目标</li><li>method：join() 参数服务器，直到服务器等待接收参数任务关闭</li></ul></li><li><p>tf.device(device_name_or_function)</p><ul><li>选择指定设备或者设备函数</li><li>if device_name<ul><li>指定设备</li><li>例如 “/job:worker/tsak:0/cpu:0</li></ul></li><li>if function<ul><li>tf.train.replica_device_setter(worker_device=worker_device,cluster=cluster)</li><li>作用：通过此函数协调不同设备上的初始化操作</li><li>worker_device:为指定设备，“job/worker/task:0/cpu:0” or “/job:worker/task:0/gpu:0”</li><li>cluster:集群描述对象</li></ul></li><li>使用with tf.device() 使不同工作节点在不同设备上</li></ul></li></ul><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191107220042396-272399388.png"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191107220054505-681082343.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_3_%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_3_%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="验证码识别"><a href="#验证码识别" class="headerlink" title="验证码识别"></a>验证码识别</h1><p>1，分割</p><p>2，整体识别 一张图片n个字母   即不再是一个目标值，是n个</p><p>​    例：NZPP</p><p>​    N ——&gt;[0.01，0.02,0.03…….] 概率    N——-&gt;[0，0,0,0,1…….] one-hot编码</p><p>​    Z——–&gt;[0.01，0.02,0.03…….]         Z——-&gt;[0,1,0,0,0……]</p><p>​    最后得出n*26个概率 </p><p>​    交叉熵计算</p><p>​        目标值：[0,0,0,1……] [0,0,0,1……] [0,0,0,1……] [0,0,0,1……] </p><p>​        经过网络输出：[1.2,2.3,5.6……]</p><p>​        经过softmax得出概率：[0.01,0.02,…….]</p><p>​        损失：104 个目标值m与概率n值相乘 mlogn，one-hot由于很多为0   最可得出一个样本的损失值为：1log()+1log()+1log()+1log()=损失值</p><h2 id="验证码案例"><a href="#验证码案例" class="headerlink" title="验证码案例"></a>验证码案例</h2><p>1，处理数据 图片—–标签      图片路径–&gt;序号–&gt;验证码值—–&gt;转化为数字</p><p>使用tfrecords</p><p>2，识别验证码</p><ul><li><p>x = [100,20*80*3]</p><p>​    w=[20*80*3,4*26]     bias=[4*26]</p><p>​    y_predict = [100,4*26]（这得出概率值）</p></li><li><p>先把目标值[100,4] 转化为one_hot编码  —-&gt;[100,4,26] </p><p>​        Api：tf.ont_hot([[13,25,11,24],[….],[…]],depth=26,axis=2,on_value=1.0)</p><p>​        将目标值转化为[100,4*26]   与预测值交叉熵计算</p></li><li><p>梯度下降优化</p></li><li><p>精确值</p><p>tf.equal(tf.argmax(y_true,2),tf.argmax(y_predict,2))     [100,4,26]   2 —-&gt;26</p><p>再求平均值</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><br>FLAGS = tf.flags.FLAGS<br>tf.flags.DEFINE_string(<span class="hljs-string">&quot;captcha_dir&quot;</span>, <span class="hljs-string">&quot;dataPath/.tfrecords&quot;</span>, <span class="hljs-string">&quot;验证码文件路径&quot;</span>)<br>tf.flags.DEFINE_string(<span class="hljs-string">&quot;batch_size&quot;</span>, <span class="hljs-number">100</span>, <span class="hljs-string">&quot;每批次训练的样本数&quot;</span>)<br>tf.flags.DEFINE_string(<span class="hljs-string">&quot;letter_num&quot;</span>, <span class="hljs-number">26</span>, <span class="hljs-string">&quot;目标值的分类&quot;</span>)<br>tf.flags.DEFINE_string(<span class="hljs-string">&quot;label_num&quot;</span>, <span class="hljs-number">4</span>, <span class="hljs-string">&quot;目标值个数&quot;</span>)<br>tf.flags._FlagValuesWrapper<br><br><span class="hljs-comment"># 定义一个权重初始化函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">weight_variables</span>(<span class="hljs-params">shape</span>):</span><br>    weight = tf.Variable(tf.random_normal(mean=<span class="hljs-number">0.0</span>, stddev=<span class="hljs-number">1.0</span>, shape=shape), name=<span class="hljs-string">&quot;w&quot;</span>)<br>    <span class="hljs-keyword">return</span> weight<br><br><span class="hljs-comment"># 定义一个权重初始化函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bias_Variables</span>(<span class="hljs-params">shape</span>):</span><br>    bias = tf.Variable(tf.constant(<span class="hljs-number">0.0</span>, shape=shape), name=<span class="hljs-string">&quot;b&quot;</span>)<br>    <span class="hljs-keyword">return</span> bias<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_and_decode</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    读取数据API</span><br><span class="hljs-string">    :return:image_batch,label_batch</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1,构建文件队列</span><br>    file_queue = tf.train.start_queue_runners([FLAGS.captcha_dir])<br>    <span class="hljs-comment"># 2,构建阅读器，读取文件内容，默认一个样本</span><br>    reader = tf.TFRecordReader()<br>    <span class="hljs-comment"># 3,读取文件内容</span><br>    key, value = reader.read(file_queue)<br>    <span class="hljs-comment"># tfrecords 格式需要解析</span><br>    features = tf.parse_single_example(value, features=&#123;<br>        <span class="hljs-string">&quot;image&quot;</span>: tf.FixedLengthFeature([], tf.string),<br>        <span class="hljs-string">&quot;label&quot;</span>: tf.FixedLengthFeature([], tf.string),<br>    &#125;)<br>    <span class="hljs-comment"># 解析内容，字符串内容</span><br>    image = tf.decode_rwa(features[<span class="hljs-string">&quot;image&quot;</span>], tf.uint8)<br>    label = tf.decode_rwa(features[<span class="hljs-string">&quot;label&quot;</span>], tf.uint8)<br>    <span class="hljs-comment"># 改变形状</span><br>    image_reshape = tf.reshape(image, [<span class="hljs-number">20</span>, <span class="hljs-number">80</span>, <span class="hljs-number">3</span>])<br>    label_reshape = tf.reshape(label, [FLAGS.label_num])<br>    <span class="hljs-comment"># 进行批处理，每次读取的样本数，就是每次训练的样本数</span><br>    image_batch, label_batch = tf.train.batch([image_reshape, label_reshape], batch_size=FLAGS.batch_size,num_threads=<span class="hljs-number">1</span>, capacity=FLAGS.batch_size)<br>    <span class="hljs-keyword">return</span> image_batch, label_batch<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fc_model</span>(<span class="hljs-params">image</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    进行预测结果</span><br><span class="hljs-string">    :param image:特征值</span><br><span class="hljs-string">    :return:y_predict 【100,104】</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;model&quot;</span>):<br>        <span class="hljs-comment"># 转化图片为二维</span><br>        image_reshape = tf.reshape(image, [-<span class="hljs-number">1</span>, <span class="hljs-number">20</span> * <span class="hljs-number">80</span> * <span class="hljs-number">3</span>])<br>        <span class="hljs-comment"># 1,随机初始化权重，偏值</span><br>        weight = weight_variables([<span class="hljs-number">20</span> * <span class="hljs-number">80</span> * <span class="hljs-number">3</span>, FLAGS.label_num * FLAGS.letter_num])<br>        bias = bias_Variables([FLAGS.label_num * FLAGS.letter_num])<br>        <span class="hljs-comment"># 2,进行全连接层计算 没有使用卷积神经网络 [100,4*26]</span><br>        y_predict = tf.matmul(tf.cast(image_reshape, tf.float32), weight) + bias<br>        <span class="hljs-keyword">return</span> y_predict<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">transform_to_onthot</span>(<span class="hljs-params">label</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    将读取文件的目标值转化为ont-hot编码</span><br><span class="hljs-string">    :param label:【100,4】   【【1,2,3,4】,【5,6,7,8】.....】</span><br><span class="hljs-string">    :return:[100,4,26]</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    label_onehot = tf.one_hot(label, depth=FLAGS.letter_num, on_value=<span class="hljs-number">1.0</span>, asix=<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> label_onehot<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">captcharec</span>():</span><br>    <span class="hljs-string">&quot;&quot;&quot;验证码识别程序&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 1,读取验证码的数据文件</span><br>    image_batch, label_batch = read_and_decode()<br>    <span class="hljs-comment"># 2,输入图片特征数据建立模型，得出预测结果</span><br>    <span class="hljs-comment"># 一层全连接神经网络进行预测</span><br>    <span class="hljs-comment"># matrix【100,20,80,3】---》转化为二维*【20*80*3，4*26】+【4*26】=【100,104】</span><br>    y_predict = fc_model(image_batch)<br>    <span class="hljs-comment"># 3,转换目标值为ont-hot编码 [100,4,26]</span><br>    y_true = transform_to_onthot(label_batch)<br>    <span class="hljs-comment"># 4,交叉熵损失计算</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;sotf_cross&quot;</span>):<br>        <span class="hljs-comment"># y_true[100,4,26] ---&gt; [100,104]</span><br>        loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(<br>            labels=tf.reshape(y_true, [FLAGS.batch_size, FLAGS.label_num * FLAGS.letter_num]), logits=y_predict))<br>    <span class="hljs-comment"># 5,优化损失</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;opt&quot;</span>):<br>        train_op = tf.train.GradientDescentOptimizer(<span class="hljs-number">0.01</span>).minimize(loss)<br>    <span class="hljs-comment"># 6,准确率计算</span><br>    <span class="hljs-keyword">with</span> tf.variables_scope(<span class="hljs-string">&quot;acc&quot;</span>):<br>        <span class="hljs-comment"># 比较目标值与与与测试 4个位置是否全部相同, 三维比较  需要将预测值转换为三维</span><br>        equal_list = tf.equal(tf.argmax(y_true, <span class="hljs-number">2</span>),<br>                              tf.argmax(tf.reshape(y_predict, [FLAGS.batch_size, FLAGS.label_num, FLAGS.letter_num]),<span class="hljs-number">2</span>))<br>        accuracy = tf.reduce_mean(tf.cast(equal_list.tf.float32))<br>    <span class="hljs-comment"># 7,开启会话训练</span><br>    init_op = tf.golbal_variables_initilizer()<br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        sess.run(init_op)<br><br>        <span class="hljs-comment"># 定义线程协调器，开启线程</span><br>        coord = tf.train.Coordinator()<br>        <span class="hljs-comment"># 开启线程取读取文件</span><br>        threads = tf.train.start_queue_runners(sess, coord=coord)<br>        <span class="hljs-comment"># 训练</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5000</span>):<br>            sess.run(train_op)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d次准确率是：%f&quot;</span> % (i, accuracy.<span class="hljs-built_in">eval</span>()))<br>        <span class="hljs-comment"># 回收</span><br>        coord.request_stop()<br>        coord.join(threads)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_2_%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_2_%E6%B7%B1%E5%BA%A6%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="深度神经网络——-gt-卷积神经网络"><a href="#深度神经网络——-gt-卷积神经网络" class="headerlink" title="深度神经网络——&gt;卷积神经网络"></a>深度神经网络——&gt;卷积神经网络</h1><h2 id="1，卷积神经网络与简单神经网络的比较"><a href="#1，卷积神经网络与简单神经网络的比较" class="headerlink" title="1，卷积神经网络与简单神经网络的比较"></a>1，卷积神经网络与简单神经网络的比较</h2><h3 id="全连接网络的缺点："><a href="#全连接网络的缺点：" class="headerlink" title="全连接网络的缺点："></a>全连接网络的缺点：</h3><ul><li>参数太多，图片过大时，计算太多</li><li>没有利用像素之间位置信息</li><li>层数限制</li></ul><h2 id="2，卷积神经网络发展史"><a href="#2，卷积神经网络发展史" class="headerlink" title="2，卷积神经网络发展史"></a>2，卷积神经网络发展史</h2><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031161926668-625275542.png"></p><h2 id="3，卷积神经网络结构"><a href="#3，卷积神经网络结构" class="headerlink" title="3，卷积神经网络结构"></a>3，卷积神经网络结构</h2><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031161938616-1553094148.png"></p><ul><li><p>神经网络：输入层，隐藏层，输出层</p></li><li><p>卷积神经网络：隐藏层分为</p><p>​    卷积层过滤器：通过在原始图像上平移来提取特征，定义过滤器观察窗口（大小，步长）单位为像素</p><p>​        移动越过图片大小，例如步长过长，会导致最后一次越界，或不足（使用填充 0填充解决）</p><p>​        1，不越过，直接停止观察 （valid 取样面积小于总面积）</p><p>​        2，直接越过（same 取样面积和输入像素一致） </p><p>​        计算输入层—-》卷积层输出后大小</p><p>​        Filter数量K，大小F，步长S，零填充大小P（填充的0的层数，<font color="red">Tensor是根据大小，步长求得的</font>）</p><p>​        输入体积H*W*D   输出体积H1*W1*D1</p><p>​            H1=(H-F+2P)/S+1        </p><p>​            W1=(W-F+2P)/S+1</p><p>​            D1=K    </p></li></ul><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031161951465-477392615.png"></p><p>  ​    激活函数：增加网络的非线性分割的能力</p><p>  ​        sigmod f(x)=1/(1+e^(-x)) 计算量大，反向传播时 容易出现梯度爆炸</p><p>  ​        relu f(x)=max(0，x) 常用</p><p>  ​    数据经过多个filter后会变多</p><p>  ​    池化层：通过特征后稀疏参数来减少学习的参数，降低网络的复杂性。（最大池化和平均池化）</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031162003394-13030190.png"></p><p>  ​    全连接层：前面的卷积和池化相当于特征工程，后面的全连接相当于特征加权，“全连接层”起到了分类器的作用</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031162024180-1961480547.png"></p><h2 id="4，卷技网络API"><a href="#4，卷技网络API" class="headerlink" title="4，卷技网络API"></a>4，卷技网络API</h2><p>tf.nn.conv2d(input,filter,strides,padding,name)</p><ul><li>input:出入的张量[batch,height,weight,channel] float32,64</li><li>filter:指定过滤器[filter_height,filter_weight,图片通道数,filter 个数]</li><li>padding：same（填充，变化后height，width不变），valid（超出部分舍弃）</li></ul><p>tf.nn.relu(features,name) 激活函数</p><p>​    features:卷积后加上偏执的结果</p><p>tf.nn.max_pool(value,ksize,strides,padding,name)</p><p>​    value:4DTensor形状的【batch,height,weight,channels】</p><p>​    ksize:池化窗口大小  [1,ksize,ksize,1]</p><p>​    strides:步长大小 [1,strides,strides,1]</p><p>​    padding:</p><h2 id="5，手写数字识别"><a href="#5，手写数字识别" class="headerlink" title="5，手写数字识别"></a>5，手写数字识别</h2><p>图片比较大，类别多的时候使用定义过的网络例如googlenet</p><p>简单图片，自定义网络</p><p>一层卷积：</p><p>​    卷积：32个filter，5*5 1 SAME  bias =   32     输入:【None,28,28,1】输出：【None，28,28,32】</p><p>​    激活:【None,28,28,32】</p><p>​    池化：2*2 strides=2 SAME  bias =   64  输入:【None,28,28,1】输出：【None，14,14,32】</p><p>二层卷积：</p><p>​    卷积：64个filter，5*5 1 SAME  输入:【None,14,14,32】输出：【None，14,14,64】（64个过滤器 ，每层都是32个14*14相加）</p><p>​    激活：输出：【None，14,14,64】</p><p>​    池化：2*2 strides=2 SAM E  输入:【None,14,14,64】输出：【None，7,7,64】</p><p>全连接层FC</p><p>​    【None，7,7,64】—》【None，7*7*64】*【7*7*64，10】     ————-》【None，10】</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 定义一个权重初始化函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">weight_variables</span>(<span class="hljs-params">shape</span>):</span><br>    weight = tf.Variable(tf.random_normal(mean=<span class="hljs-number">0.0</span>, stddev=<span class="hljs-number">1.0</span>, shape=shape), name=<span class="hljs-string">&quot;w&quot;</span>)<br>    <span class="hljs-keyword">return</span> weight<br><br><br><span class="hljs-comment"># 定义一个权重初始化函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">bias_Variables</span>(<span class="hljs-params">shape</span>):</span><br>    bias = tf.Variable(tf.constant(<span class="hljs-number">0.0</span>, shape=shape), name=<span class="hljs-string">&quot;b&quot;</span>)<br>    <span class="hljs-keyword">return</span> bias<br><br><br><span class="hljs-comment"># 自定义卷积模型</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">model</span>():</span><br>    <span class="hljs-comment"># 1,准备占位符x [None,784] y_true[None,10]</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;data&quot;</span>):<br>        x = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, <span class="hljs-number">784</span>])<br>        y_true = tf.placeholder(tf.int32, [<span class="hljs-literal">None</span>, <span class="hljs-number">10</span>])<br>    <span class="hljs-comment"># 2,一层卷积 卷积5*5*1 32 strides=1, 激活 tf.nn.relu 池化</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;conv1&quot;</span>):<br>        <span class="hljs-comment"># 随机初始化权重</span><br>        weight_conv1 = weight_variables([<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">32</span>])  <span class="hljs-comment"># 32个过滤器， 1表示图片通道数</span><br>        <span class="hljs-comment"># 随机偏置</span><br>        bias_conv1 = bias_Variables([<span class="hljs-number">32</span>])<br>        <span class="hljs-comment"># 对x进行形状的改变【None，784】  ----》 【None,28,28,1】</span><br>        x_reshape = tf.reshape(x, [-<span class="hljs-number">1</span>, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>])<br>        <span class="hljs-comment"># [None,28,28,1]  -----&gt;[None,28,28,32]</span><br>        x_relu1 = tf.nn.relu(tf.nn.conv2d(x_reshape, weight_conv1, strides=[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], padding=<span class="hljs-string">&quot;SAME&quot;</span>) + bias_conv1)<br>        <span class="hljs-comment"># 池化 2*2 strides2 [None,28,28,32] ----&gt; [None,14,14,32]</span><br>        x_pool1 = tf.nn.max_pool(x_relu1, ksize=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], strides=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], padding=<span class="hljs-string">&quot;SAME&quot;</span>)<br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;conv2&quot;</span>):<br>        <span class="hljs-comment"># 3,二层卷积 卷积5*5*32 64 strides=1, 激活 tf.nn.relu 池化</span><br>        <span class="hljs-comment"># 初始化权重</span><br>        weight_conv2 = weight_variables([<span class="hljs-number">5</span>, <span class="hljs-number">5</span>, <span class="hljs-number">32</span>, <span class="hljs-number">64</span>])<br>        bias_conv2 = bias_Variables([<span class="hljs-number">64</span>])<br>        <span class="hljs-comment"># 卷积，激活</span><br>        <span class="hljs-comment"># [None,14,14,32] ---&gt;[None,14,14,64]</span><br>        x_relu2 = tf.nn.relu(tf.nn.conv2d(x_pool1, weight_conv2, strides=[<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], padding=<span class="hljs-string">&quot;SAME&quot;</span>) + bias_conv2)<br>        <span class="hljs-comment"># 池化[None,14,14,64] ---&gt;[None,7,7,64]</span><br>        x_pool2 = tf.nn.max_pool(x_relu2, ksize=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], strides=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>], padding=<span class="hljs-string">&quot;SAME&quot;</span>)<br>    <span class="hljs-comment"># 4,全连接层</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;fc&quot;</span>):<br>        <span class="hljs-comment"># 初始化权重</span><br>        weight_fc = weight_variables([<span class="hljs-number">7</span> * <span class="hljs-number">7</span> * <span class="hljs-number">64</span>, <span class="hljs-number">10</span>])<br>        bias_fc = bias_Variables([<span class="hljs-number">10</span>])<br>        <span class="hljs-comment"># 修改形状 [None,7,7,64] ---&gt;[None,7*7*64]</span><br>        x_fc_reshape = tf.reshape(x_pool2, [-<span class="hljs-number">1</span>, <span class="hljs-number">7</span> * <span class="hljs-number">7</span> * <span class="hljs-number">64</span>])<br>        <span class="hljs-comment"># 矩阵运算得出每个样本的10个结果</span><br>        y_predict = tf.matmul(x_fc_reshape, weight_fc) + bias_fc<br>    <span class="hljs-keyword">return</span> x, y_true, y_predict<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">conv_fc</span>():</span><br>    <span class="hljs-keyword">from</span> tensorflow.examples.tutorials.mnist <span class="hljs-keyword">import</span> input_data<br>    mnist = input_data.read_data_sets(<span class="hljs-string">r&quot;E:\人工智能\data\mnist_65000_28_28_simple_number&quot;</span>, one_hot=<span class="hljs-literal">True</span>)<br>    x, y_true, y_predict = model()<br>    <span class="hljs-comment"># 求出所有样本的损失，求平均值</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;soft_cross&quot;</span>):<br>        <span class="hljs-comment"># 求平均值交叉熵损失</span><br>        loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y_true, logits=y_predict))<br>    <span class="hljs-comment"># 梯度下降求出损失</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;optimizer&quot;</span>):<br>        train_op = tf.train.GradientDescentOptimizer(<span class="hljs-number">0.001</span>).minimize(loss)<br>    <span class="hljs-comment"># 计算准确率</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;acc&quot;</span>):<br>        equal_list = tf.equal(tf.argmax(y_true, <span class="hljs-number">1</span>), tf.argmax(y_predict, <span class="hljs-number">1</span>))<br>        accuracy = tf.reduce_mean(tf.cast(equal_list, tf.float32))<br>    init_op = tf.global_variables_initializer()<br>    <span class="hljs-comment"># 开启会话运行</span><br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        sess.run(init_op)<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):<br>            mnist_x, mnist_y = mnist.train.next_batch(<span class="hljs-number">200</span>)<br>            <span class="hljs-comment"># 运行训练</span><br>            sess.run(train_op, feed_dict=&#123;x: mnist_x, y_true: mnist_y&#125;)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;训练第%d的次，准确率为：%f&quot;</span> % (i, sess.run(accuracy, feed_dict=&#123;x: mnist_x, y_true: mnist_y&#125;)))<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191031162040297-1558445267.png"></p><p>GooglelNet API:tensorflow.contrib.slim.python.slim.nets.inception_v3 import inception_v3_base</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_1/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C_1/</url>
    
    <content type="html"><![CDATA[<h1 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h1><h2 id="感知机"><a href="#感知机" class="headerlink" title="感知机"></a>感知机</h2><p>解决分类问题</p><p><a href="http://playground.tensorflow.org/">http://playground.tensorflow.org</a><br><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152318582-1944379820.png"></p><h2 id="神经网络-1"><a href="#神经网络-1" class="headerlink" title="神经网络"></a>神经网络</h2><h4 id="定义"><a href="#定义" class="headerlink" title="定义:"></a>定义:</h4><p>​        在机器学习领域和认知科学领域,人工神经网络(artificial  neural network) 简称ann或类神经网络,一种放生物 神经网络的结构和功能的计算模型,用于对函数进行估计或近似.</p><h3 id="种类"><a href="#种类" class="headerlink" title="种类:"></a>种类:</h3><ul><li>​    基础神经网络:单层感受器,线性神经网络,BP神经网络,Hopfield神经网络</li><li>​    进阶神经网络:玻尔兹曼机,受限玻尔兹曼机,递归神经网络</li><li>​    <font color=#ff0000>深度神经网络:深度置信网络,卷积神将网络,循环神将网络,LSTM网络</font></li></ul><h3 id="神经网络的特点"><a href="#神经网络的特点" class="headerlink" title="神经网络的特点"></a>神经网络的特点</h3><ul><li>​    输入向量的维度和输入神经元的个数相同</li><li>​    每个链接都有权值</li><li>​    同一层神经元之间没有连接</li><li>​    有输入层,隐层,输出层组成</li><li>​    第N层与第N-1层的所有神经元链接,也叫全连接</li></ul><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152437873-1252384050.png"></p><h3 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h3><ul><li><p>​    结构(Architecture):神经网络中的权重,神经元等等</p></li><li><p>​    激活函数(Activity Rule)</p></li><li><p>​    学习规则(Learning Rule)学习规则指定了网络中的权重如何随着时间的推移而调整(反向传播算法)</p></li></ul><p>全连接层有多少个圆,最后就有多少输出</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152459162-803264136.png"></p><h2 id="神将网络API模块"><a href="#神将网络API模块" class="headerlink" title="神将网络API模块"></a>神将网络API模块</h2><ul><li>​    tf.nn:提供神经网络相关操作的支持,包括卷积操作(conv),池化操作(pooling),归一化,loss,分类操作,embedding,RNN,Evaluation. (底层一点)</li><li>​    tf.layers:主要提供高层的神经网络,主要和卷积线管的,对tf.nn的进一步封装(高级一点)</li><li>​    tf.contrib:tf.contrib.layers 提供够将计算图中的网络层,正则化,摘要操作,是构建计算图的高级操作,但是tf.contrib包不稳定以及一些实验代码</li></ul><h2 id="浅层人工神经网络模型"><a href="#浅层人工神经网络模型" class="headerlink" title="浅层人工神经网络模型"></a>浅层人工神经网络模型</h2><ul><li><p>​    softmax回归 (主要解决分类)</p><p>Si = e^i/(求和j^(e^j))</p></li></ul><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152510633-1274394108.png"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152522847-1035033309.png"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152528852-1571816292.png"></p><ul><li><p>​    损失计算api</p></li><li><p>​    其他api介绍</p></li></ul><h2 id="简单的神经网络实现手写数字识别"><a href="#简单的神经网络实现手写数字识别" class="headerlink" title="简单的神经网络实现手写数字识别"></a>简单的神经网络实现手写数字识别</h2><h3 id="1，API介绍"><a href="#1，API介绍" class="headerlink" title="1，API介绍"></a>1，API介绍</h3><ul><li><h4 id="全连接-从输入直接到输出"><a href="#全连接-从输入直接到输出" class="headerlink" title="全连接-从输入直接到输出"></a>全连接-从输入直接到输出</h4></li></ul><p>tf.matmul(a,b,name=None)+bias   特征加权</p><p>​    return:全连接结果，供交叉损失运算</p><p>不需要激活函数（因为是最后的输出）</p><ul><li><h4 id="SoftMax计算，交叉熵"><a href="#SoftMax计算，交叉熵" class="headerlink" title="SoftMax计算，交叉熵"></a>SoftMax计算，交叉熵</h4></li></ul><p>tf.nn.softmax_corss_entropy_with_logits(labels=None,logits=None,name=None) 计算logits和labels之间的交叉损失熵</p><p>​    labels:标签值（真实值）</p><p>​    logits:样本值:样本加权之后的值</p><p>​    return:返回损失函数列表</p><ul><li><h4 id="损失列表平均值计算"><a href="#损失列表平均值计算" class="headerlink" title="损失列表平均值计算"></a>损失列表平均值计算</h4></li></ul><p>tf.reduce_mean(input_tensor)</p><ul><li><h4 id="损失下降API"><a href="#损失下降API" class="headerlink" title="损失下降API"></a>损失下降API</h4></li></ul><p> tf.train.GradientDescentOptimizer(learning_rate) 梯度下降优化</p><p>​    learning_rate:学习率</p><p>​    minimize:最小优化损失</p><p>​    return:梯度下降op</p><h3 id="2，Minst手写数字识别"><a href="#2，Minst手写数字识别" class="headerlink" title="2，Minst手写数字识别"></a>2，Minst手写数字识别</h3><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152538384-1926625799.png"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191027152543041-1779288562.png"></p><ul><li><p>数据集 <a href="http://yann.lecun.com/exdb/mnist">http://yann.lecun.com/exdb/mnist</a> 55000训练集 10000测试集 每行包含两个部分，图片  标签</p></li><li><p>数据读取 </p><p>from tensorflow.example.tutorials.minst import imput_data</p><p>mnist = input_data.read_data_sets(FLAGS.data_dir,one_hot=True)  使用API读取</p></li><li><p>准确率计算</p><p>equal_list = tf.equal(tf.argmax(y,1),tf.argmax(y_label,1))  1表示按照列比较，返回一个None的 数值的列表，为1表示该样本预测正确，0错误</p><p>输入真实的结果（在本例中：每行是对应样本的一行ont_hot），和预测矩阵 每个样本的预测值</p><p>accuracy=tf.tf.reduce_mean(tf.cast(equal_list,tf.float32)) 准确率</p></li><li><p>简单实例深度神经网络</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">simplePictureRecoginze</span>():</span><br>    <span class="hljs-keyword">from</span> tensorflow.examples.tutorials.mnist <span class="hljs-keyword">import</span> input_data<br>    mnist = input_data.read_data_sets(<span class="hljs-string">r&quot;I:\人工智能数据\mnist_65000_28_28_simple_number&quot;</span>, one_hot=<span class="hljs-literal">True</span>)<br>    <span class="hljs-comment"># mnist.train.image 60000 行 784 列</span><br>    <span class="hljs-comment"># mnist.train.image[0]获取具体的一张图片</span><br>    <span class="hljs-comment"># mnist.train.labels 60000 行 10 列</span><br>    <span class="hljs-comment"># mnist.train.next_batch(50)  返回两个二维数组，50张图片，50张图片标签对应的ont_hot编码</span><br>    <span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br>    FLAGS=tf.flags.FLAGS<br>    tf.flags.DEFINE_integer(<span class="hljs-string">&quot;is_train&quot;</span>,<span class="hljs-number">1</span>,<span class="hljs-string">&quot;指定程序是预测还是训练&quot;</span>)<br>    tf.flags._FlagValuesWrapper<br>    <span class="hljs-comment"># 1,建立数据占位符x[None,748] y_true=[None,10]</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;data&quot;</span>):<br>        x = tf.placeholder(tf.float32, [<span class="hljs-literal">None</span>, <span class="hljs-number">784</span>])<br>        y_true = tf.placeholder(tf.int32, [<span class="hljs-literal">None</span>, <span class="hljs-number">10</span>])<br>    <span class="hljs-comment"># 2,建立全连接层的神经网络 w[784,10] b[10]</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;fc_model&quot;</span>):<br>        <span class="hljs-comment"># 随机初始化权重和偏执</span><br>        weight = tf.Variable(tf.random_normal([<span class="hljs-number">784</span>, <span class="hljs-number">10</span>], mean=<span class="hljs-number">0.0</span>, stddev=<span class="hljs-number">1.0</span>), name=<span class="hljs-string">&quot;w&quot;</span>)<br>        bias = tf.Variable(tf.constant(<span class="hljs-number">0.0</span>, shape=[<span class="hljs-number">10</span>]))<br><br>        <span class="hljs-comment"># 预测None个样本的输出结果 [None，784]*[784,10]+[10] = [None,10]</span><br>        y_predict = tf.matmul(x, weight) + bias<br>    <span class="hljs-comment"># 3,求出所有样本的损失，求平均值</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;soft_cross&quot;</span>):<br>        <span class="hljs-comment"># 求平均值交叉熵损失</span><br>        loss = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y_true, logits=y_predict))<br>    <span class="hljs-comment"># 4,梯度下降求出损失</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;optimizer&quot;</span>):<br>        train_op = tf.train.GradientDescentOptimizer(<span class="hljs-number">0.1</span>).minimize(loss)<br>    <span class="hljs-comment"># 5,计算准确率</span><br>    <span class="hljs-keyword">with</span> tf.variable_scope(<span class="hljs-string">&quot;acc&quot;</span>):<br>        equal_list = tf.equal(tf.argmax(y_true, <span class="hljs-number">1</span>), tf.argmax(y_predict, <span class="hljs-number">1</span>))<br>        accuracy = tf.reduce_mean(tf.cast(equal_list, tf.float32))<br>    <span class="hljs-comment"># 收集变量</span><br>    tf.summary.scalar(<span class="hljs-string">&quot;losses&quot;</span>,loss)<br>    tf.summary.scalar(<span class="hljs-string">&quot;acc&quot;</span>,accuracy)<br>    <span class="hljs-comment"># 高纬度变量收集</span><br>    tf.summary.histogram(<span class="hljs-string">&quot;weights&quot;</span>,weight)<br>    tf.summary.histogram(<span class="hljs-string">&quot;biases&quot;</span>,bias)<br><br>    <span class="hljs-comment"># 定义一个初始化变量的op</span><br>    init_op = tf.global_variables_initializer()<br>    <span class="hljs-comment"># 定义合并变量的op</span><br>    merge = tf.summary.merge_all()<br>    <span class="hljs-comment"># 创建saver保存模型</span><br>    save = tf.train.Saver()<br>    <span class="hljs-comment"># 开启会话训练</span><br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        sess.run(init_op)<br>        <span class="hljs-comment"># 迭代步数取训练，更新参数预测</span><br>        <span class="hljs-comment"># 建立events文件，写入</span><br>        events = <span class="hljs-string">r&quot;./summary&quot;</span><br>        model = <span class="hljs-string">r&quot;./Model/ckpt&quot;</span><br>        filewriter = tf.summary.FileWriter(events,graph=sess.graph)<br>        <span class="hljs-keyword">if</span> FLAGS.is_train  == <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2000</span>):<br>                <span class="hljs-comment"># 取出特征值，目标值</span><br>                mnist_x, mnist_y = mnist.train.next_batch(<span class="hljs-number">50</span>)<br>                feed_dict = &#123;x: mnist_x, y_true: mnist_y&#125;<br>                <span class="hljs-comment"># 运行训练</span><br>                sess.run(train_op, feed_dict=feed_dict)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;训练第%d的次，准确率为：%f&quot;</span>%(i,sess.run(accuracy,feed_dict=feed_dict)))<br>                <span class="hljs-comment"># 写入每部训练的值</span><br>                summary = sess.run(merge,feed_dict=feed_dict)<br>                filewriter.add_summary(summary,i)<br>            <span class="hljs-comment"># 保存模型</span><br>            save.save(sess, model)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-comment"># 加载模型</span><br>            save.restore(sess,model)<br>            <span class="hljs-comment"># 如果是0，做出预测</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>                <span class="hljs-comment"># 每次测试一张图片</span><br>                x_test,y_test = mnist.test.next_batch(<span class="hljs-number">1</span>)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;第%d张图片，手写数字目标是：%d，预测结果是：%d&quot;</span> % (i,<br>                    tf.argmax(y_test,<span class="hljs-number">1</span>).<span class="hljs-built_in">eval</span>(),<br>                    tf.argmax(sess.run(y_predict,feed_dict=&#123;x:x_test,y_true: y_test&#125;),<span class="hljs-number">1</span>).<span class="hljs-built_in">eval</span>())<br>                      )<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_Tensorflow_2_%E6%95%B0%E6%8D%AE_%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_Tensorflow_2_%E6%95%B0%E6%8D%AE_%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<h1 id="tensorflow-数据读取"><a href="#tensorflow-数据读取" class="headerlink" title="tensorflow 数据读取"></a>tensorflow 数据读取</h1><ul><li><h5 id="队列和线程"><a href="#队列和线程" class="headerlink" title="队列和线程"></a>队列和线程</h5></li><li><h5 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取,"></a>文件读取,</h5></li><li><h5 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h5></li></ul><p>问题:大文件读取,读取速度,</p><p>在tensorflow中真正的多线程</p><p>子线程读取数据 向队列放数据(如每次100个),主线程学习,不用全部数据读取后,开始学习</p><h2 id="队列与对垒管理器-线程与协调器"><a href="#队列与对垒管理器-线程与协调器" class="headerlink" title="队列与对垒管理器,线程与协调器"></a>队列与对垒管理器,线程与协调器</h2><h4 id="tf-FIFOQueue-capacity-None-dtypes-None-name-”fifo-queue”-先进先出队列"><a href="#tf-FIFOQueue-capacity-None-dtypes-None-name-”fifo-queue”-先进先出队列" class="headerlink" title="tf.FIFOQueue(capacity=None,dtypes=None,name=”fifo_queue”)  # 先进先出队列"></a>tf.FIFOQueue(capacity=None,dtypes=None,name=”fifo_queue”)  # 先进先出队列</h4><ul><li><p>dequeue() 出队方法</p></li><li><p>enqueue(vals,name=None) 入队方法</p></li><li><p>enqueue_many(vals,name=None) 多个入队</p></li><li><p>size(name=None) 还有对少数据</p></li></ul><h4 id="tf-RandomShuffleQueue-随机出队队列"><a href="#tf-RandomShuffleQueue-随机出队队列" class="headerlink" title="tf.RandomShuffleQueue()  # 随机出队队列"></a>tf.RandomShuffleQueue()  # 随机出队队列</h4><h4 id="tf-train-QueueRunner-queue-None-enqueue-ops-None"><a href="#tf-train-QueueRunner-queue-None-enqueue-ops-None" class="headerlink" title="tf.train.QueueRunner(queue=None,enqueue_ops=None)"></a>tf.train.QueueRunner(queue=None,enqueue_ops=None)</h4><ul><li><p>queue:队列</p></li><li><p>enqueue_ops:添加线程的队列操作列表,[op1,op2]*2 2表示指定两个线程</p></li><li><p>create_threads(sess,coord=None,start=False) 创建线程运行给定的入队操作</p></li><li><p>start:若为True线程自动启动,Fasle需手动start()</p></li><li><p>coord:线程协调器,后面线程管理器用到</p></li><li><p>return:返回线程实例</p></li></ul><h2 id="线程协调器"><a href="#线程协调器" class="headerlink" title="线程协调器"></a>线程协调器</h2><h3 id="tf-train-Coordinator"><a href="#tf-train-Coordinator" class="headerlink" title="tf.train.Coordinator()"></a>tf.train.Coordinator()</h3><ul><li><p>request_stop()</p></li><li><p>should_stop() 检查是否要求停止</p></li><li><p>join(threads=None,stop_grace_period_secs=120) 等待线程终止</p></li><li><p>return 返回线程协调器实例</p></li></ul><h2 id="同步-异步案例"><a href="#同步-异步案例" class="headerlink" title="同步,异步案例"></a>同步,异步案例</h2><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sync</span>():</span><br>    <span class="hljs-comment"># 模拟一下同步  先处理数据,然后取数据训练</span><br>    <span class="hljs-comment"># tensorflow中,运行操作有依赖性</span><br>    <span class="hljs-comment"># 1,首先定义队列</span><br>    Q = tf.FIFOQueue(<span class="hljs-number">3</span>,tf.float32)<br>    <span class="hljs-comment"># 放入数据 tensorflow 会把传入的数据当做张量 a=y 此时y不会当做列表  a=[x,] 此时a是list</span><br>    enq_many = Q.enqueue_many([[<span class="hljs-number">0.1</span>,<span class="hljs-number">0.2</span>,<span class="hljs-number">0.3</span>],])<br>    <span class="hljs-comment"># 2,定义读取数据,取数据过程, 入队,出队</span><br>    out_q = Q.dequeue() <span class="hljs-comment"># 虽然是个op 但取出来是数据</span><br>    data = out_q+<span class="hljs-number">1</span><br>    en_q = Q.enqueue(data)<br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        <span class="hljs-comment"># 初始化队列</span><br>        sess.run(enq_many)<br>        <span class="hljs-comment"># 处理数据</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):<br>            sess.run(en_q) <span class="hljs-comment"># 有依赖性,会运行out_q,data,qn_q</span><br>        <span class="hljs-comment"># 训练数据</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(Q.size().<span class="hljs-built_in">eval</span>()):<br>            <span class="hljs-built_in">print</span>(sess.run(Q.dequeue())) <span class="hljs-comment"># 33.2 33.3 34.1</span><br></code></pre></td></tr></table></figure><h1 id="模拟异步"><a href="#模拟异步" class="headerlink" title="模拟异步"></a>模拟异步</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">asyn</span>():</span><br>    <span class="hljs-comment"># 1,定义队列</span><br>    Q = tf.FIFOQueue(<span class="hljs-number">1000</span>,tf.float32)<br>    <span class="hljs-comment"># 2,定义子线程 操作</span><br>    var = tf.Variable(<span class="hljs-number">0.0</span>)<br>    <span class="hljs-comment"># 实现自增 tf.assign_add() # 主要作用是江var的值改变了</span><br>    data = tf.assign_add(var,tf.constant(<span class="hljs-number">1.0</span>))<br>    en_q = Q.enqueue(data)<br>    <span class="hljs-comment"># 3,定义队列管理器op,指定子线程该做什么</span><br>    qr = tf.train.QueueRunner(Q,enqueue_ops=[en_q]*<span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># 初始化变量op</span><br>    init = tf.global_variables_initializer()<br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        sess.run(init)<br>        <span class="hljs-comment"># 开启线程管理器</span><br>        coord = tf.train.Coordinator()<br>        <span class="hljs-comment"># 开启子线程</span><br>        threads = qr.create_threads(sess,start=<span class="hljs-literal">True</span>,coord=coord) <span class="hljs-comment"># coord指定管理器</span><br>        <span class="hljs-comment"># 主线程,不断取数据训练</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>): <span class="hljs-comment"># 300 次后主线程结束,sess释放,单子线程还在,会报错,需要回收子线程</span><br>            <span class="hljs-built_in">print</span>(sess.run(Q.dequeue()))<br>        coord.request_stop() <span class="hljs-comment"># 请求回收</span><br>        coord.join(threads) <span class="hljs-comment"># 等待回收</span><br></code></pre></td></tr></table></figure><h2 id="文件读取-1"><a href="#文件读取-1" class="headerlink" title="文件读取"></a>文件读取</h2><ul><li>构造文件列表,</li><li>构造文件队列,</li><li>阅读器 读取内容一行,</li><li>解码, </li><li>批处理</li></ul><h2 id="文件队列"><a href="#文件队列" class="headerlink" title="文件队列"></a>文件队列</h2><h3 id="tf-train-string-input-producer-string-tensor-None-shuffle-True-奖输出字符串输入到管道队列"><a href="#tf-train-string-input-producer-string-tensor-None-shuffle-True-奖输出字符串输入到管道队列" class="headerlink" title="tf.train.string_input_producer(string_tensor=None,shuffle=True) # 奖输出字符串输入到管道队列"></a>tf.train.string_input_producer(string_tensor=None,shuffle=True) # 奖输出字符串输入到管道队列</h3><ul><li><p>string_tensor 含有文件名的1阶张量</p></li><li><p>num_epochs:过几遍数据,默认无限</p></li><li><p>return:具有字符串的队列</p></li></ul><h2 id="文件阅读器"><a href="#文件阅读器" class="headerlink" title="文件阅读器"></a>文件阅读器</h2><ul><li>tf.TextLineReader # csv文件</li><li>tf.FixedLengthRecordReader(record_bytes=1024) # 二进制</li><li>tf.TFRecordReader # TfRecords 自带的文件格式</li></ul><h2 id="共同方法-read-file-queue"><a href="#共同方法-read-file-queue" class="headerlink" title="共同方法 read(file_queue)"></a>共同方法 read(file_queue)</h2><p>返回tensors元祖(key文件名字,value 默认的内容,一行,或字节)</p><h2 id="解码"><a href="#解码" class="headerlink" title="解码"></a>解码</h2><h3 id="tf-decode-csv-records-None-record-defaults-None-field-delim-”-”-name-None"><a href="#tf-decode-csv-records-None-record-defaults-None-field-delim-”-”-name-None" class="headerlink" title="tf.decode_csv(records=None,record_defaults=None,field_delim=”,”,name=None)"></a>tf.decode_csv(records=None,record_defaults=None,field_delim=”,”,name=None)</h3><ul><li><p>recodes:上边的value</p></li><li><p>field_delim:默认分隔符</p></li><li><p>record_defaults:指定每列类型,指定默认值</p></li><li><p>参数决定了张量的类型,并设置一个值,在字符串中缺少使用默认值</p></li></ul><h3 id="tf-decode-raw-bytes-out-type-None-little-endian-None-name-None"><a href="#tf-decode-raw-bytes-out-type-None-little-endian-None-name-None" class="headerlink" title="tf.decode_raw(bytes,out_type=None,little_endian=None,name=None)"></a>tf.decode_raw(bytes,out_type=None,little_endian=None,name=None)</h3><p>将字节转换为一个数字向量,字节为一字符类型的张量,与函数</p><h3 id="tf-FixLengthRecordReader"><a href="#tf-FixLengthRecordReader" class="headerlink" title="tf.FixLengthRecordReader"></a>tf.FixLengthRecordReader</h3><p>搭配使用,二进制读取为uint8格式</p><h2 id="管道批处理"><a href="#管道批处理" class="headerlink" title="管道批处理"></a>管道批处理</h2><h3 id="tf-train-batch"><a href="#tf-train-batch" class="headerlink" title="tf.train.batch()"></a>tf.train.batch()</h3><ul><li><p>tensors:包含张量的列表</p></li><li><p>batch_size:从队列汇总读取的批处理的大小</p></li><li><p>num_threads:进入队列的线程数</p></li><li><p>capacity:整数,队列的最大数量</p></li></ul><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span>  tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readcsv</span>(<span class="hljs-params">filelist</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    :param filelist:文件路径列表</span><br><span class="hljs-string">    :return:</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">import</span> os<br>    path = <span class="hljs-string">r&quot;E:\Workspace\PythonWorkSpace\Machine-Learning\asstes\temp&quot;</span><br>    file_name = os.listdir(path)<br>    file_list = [os.path.join(path, file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> file_name]<br>    <span class="hljs-comment"># 1,构造文件队列</span><br>    file_queue = tf.train.string_input_producer(file_list)<br>    <span class="hljs-comment"># 2,构造csv阅读器 读取队列数据</span><br>    reader = tf.TextLineReader()<br>    key,value=reader.read(file_queue)<br>    <span class="hljs-comment"># 3,对每行内容进行解码</span><br>    records = [[<span class="hljs-string">&quot;None&quot;</span>],[<span class="hljs-string">&quot;None&quot;</span>]] <span class="hljs-comment"># 指定第一列为字符串,默认值为None, 或指定为[1.0] 数字</span><br>    <span class="hljs-comment"># 单行读取</span><br>    first,second = tf.decode_csv(value,record_defaults=records) <span class="hljs-comment"># 返回就是n列,就是n个值接收</span><br>    <span class="hljs-comment"># 批量读取,每次取出的大小只与batch_size:有关 若大于总数,会重复取</span><br>    first_batch,second_batch = tf.train.batch([first,second],batch_size=<span class="hljs-number">6</span>,num_threads=<span class="hljs-number">1</span>,capacity=<span class="hljs-number">6</span>)<br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        <span class="hljs-comment"># 定义线程协调器</span><br>        coord = tf.train.Coordinator()<br>        threads = tf.train.start_queue_runners(sess,coord=coord)<br>        <span class="hljs-comment">#print(sess.run([first,second]))</span><br>        <span class="hljs-built_in">print</span>(sess.run([first_batch,second_batch]))<br>    coord.request_stop()<br>    coord.join(threads)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><h1 id="图像读取"><a href="#图像读取" class="headerlink" title="图像读取"></a>图像读取</h1><p>特征值:像素</p><p>黑白:单通道[0-255]  像素数</p><p>彩色:三通道:RGB      像素数*3</p><p>图片数字化</p><p>三要素:长度,宽度,通道数</p><p>3D张量 [200,200,1] [200,200,3]</p><p>图片特征要一样:像素要一样–&gt;大小相同     缩放图片</p><h1 id="图片文件读取"><a href="#图片文件读取" class="headerlink" title="图片文件读取"></a>图片文件读取</h1><h3 id="API"><a href="#API" class="headerlink" title="API:"></a>API:</h3><h4 id="图像读取器-tf-WholeFileReader"><a href="#图像读取器-tf-WholeFileReader" class="headerlink" title="图像读取器:tf.WholeFileReader"></a>图像读取器:tf.WholeFileReader</h4><ul><li><p>​    将文件的全部内容作为值输出的读取器</p></li><li><p>​    返回读取实例</p></li><li><p>​    read(file_queuse) 输出时一个文件名和该文件的值</p></li></ul><h4 id="图像解码器-tf-image-decode-jpeg-contents"><a href="#图像解码器-tf-image-decode-jpeg-contents" class="headerlink" title="图像解码器:tf.image.decode_jpeg(contents)"></a>图像解码器:tf.image.decode_jpeg(contents)</h4><ul><li><p>​    将jpeg编码为的图像解码为uint8张量</p></li><li><p>​    返回uint8张量 3D形状 [height,width,channels]</p></li><li><p>​    tf.image.decode_png(contents)</p></li><li><p>​    解码为uint8或uint16</p></li><li><p>​    返回3D形状    </p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">picread</span>():</span><br>    <span class="hljs-keyword">import</span> os<br>    <span class="hljs-keyword">import</span> os,tensorflow <span class="hljs-keyword">as</span> tf<br>    path = <span class="hljs-string">r&quot;D:\图片\壁纸\手机壁纸\people&quot;</span><br>    file_name = os.listdir(path)<br>    file_list = [os.path.join(path, file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> file_name]<br>    <span class="hljs-comment"># 1, 构造文件队列</span><br>    file_queue=tf.train.string_input_producer(file_list)<br>    <span class="hljs-comment"># 2, 构造文件读取器读取图片内容(默认一张)</span><br>    reader = tf.WholeFileReader()<br>    key,value=reader.read(file_queue)  <span class="hljs-comment"># value tensor(shape=(),dtype=string)</span><br>    <span class="hljs-comment"># 3, 对读取的图片数据进行解码</span><br>    image = tf.image.decode_jpeg(value)  <span class="hljs-comment"># tensor(shape=(?,?,?),dtype=uint8)</span><br>    <span class="hljs-comment"># 4, 处理图片大小统一</span><br>    image_resize = tf.image.resize_images(image,[<span class="hljs-number">1080</span>,<span class="hljs-number">2160</span>])  <span class="hljs-comment"># shape(1080,2160,?)</span><br>    <span class="hljs-comment"># 设置通道数,在批处理时要求形状必须固定</span><br>    image_resize.set_shape([<span class="hljs-number">1080</span>,<span class="hljs-number">2160</span>,<span class="hljs-number">3</span>])   <span class="hljs-comment"># 此时 shape(1080,2160,3)</span><br>    <span class="hljs-comment"># 5, 进行批处理</span><br>    image_batch = tf.train.batch([image_resize],batch_size=<span class="hljs-number">20</span>,num_threads=<span class="hljs-number">4</span>,capacity=<span class="hljs-number">20</span>) <span class="hljs-comment"># shape(20,1080,2160,3)</span><br><br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        <span class="hljs-comment"># 定义线程协调器</span><br>        coord = tf.train.Coordinator()<br>        threads = tf.train.start_queue_runners(sess, coord=coord)<br>        <span class="hljs-comment"># print(sess.run([image_resize])) #</span><br>        <span class="hljs-built_in">print</span>(sess.run([image_batch])) <span class="hljs-comment">#</span><br>        coord.request_stop()<br>        coord.join(threads)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure><h1 id="二进制文件处理"><a href="#二进制文件处理" class="headerlink" title="二进制文件处理"></a>二进制文件处理</h1><p>案例分析:<a href="https://www.cs.toronto.edu/~kriz/cifar.html">https://www.cs.toronto.edu/~kriz/cifar.html</a></p><p>CIFAR-10数据集:6000张32*32彩色图片 分为训练集文件,测试集文件</p><p>文件中每一行为(标签 像素值) 即为0-9  1024红色通道,1024绿色,1024蓝色    每行3072个字节    目标值+特征值</p><h1 id="TFRecords-分析-存取"><a href="#TFRecords-分析-存取" class="headerlink" title="TFRecords 分析,存取"></a>TFRecords 分析,存取</h1><ul><li>​    Tensorflow内置文件格式,二进制文件, 更好的利用内存,速度快,更好的赋值和移动</li><li>​    为了将二进制数据和标签 存储在同一个文件中</li><li>​    文件格式*.tfrecords</li><li>​    写入文件内容:Example协议块 —–&gt;类字典格式</li><li>​        每个example样本:{image:xxx,label:yyy}</li></ul><h2 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h2><h3 id="tf-python-io-TFRecordsWriter-path"><a href="#tf-python-io-TFRecordsWriter-path" class="headerlink" title="tf.python_io.TFRecordsWriter(path)"></a>tf.python_io.TFRecordsWriter(path)</h3><ul><li>​    path:TFrecords文件路径  </li><li>​    return:文件写入器</li><li>​    write(record):向文件中写入一个字符串记录.,就是一个example</li><li>​    close():关闭文件写入器</li></ul><p>一个样本—&gt;example</p><h3 id="tf-train-Example-features-None"><a href="#tf-train-Example-features-None" class="headerlink" title="tf.train.Example(features=None)"></a>tf.train.Example(features=None)</h3><ul><li>​    写入tfrecords文件</li><li>​    feature:tf.train.Features类型的特征实例</li><li>​    return:example协议块</li></ul><h4 id="tf-train-Features-feature-None"><a href="#tf-train-Features-feature-None" class="headerlink" title="tf.train.Features(feature=None)"></a>tf.train.Features(feature=None)</h4><ul><li>​        构建每个样本的信息键值对</li><li>​        feature:字典数据,key为名字,value为tf.train.Feature 实例</li><li>​        return:Features类型</li></ul><h4 id="tf-train-Feature-options"><a href="#tf-train-Feature-options" class="headerlink" title="tf.train.Feature(**options)"></a>tf.train.Feature(**options)</h4><p>​        **options:例如</p><p>​                bytes_list=tf.train.BytesList(value=[Bytes])</p><p>​                int64_list=tf.train.Int64List(value=[Value])</p><p>​                float_list=tf.train.FloatList(value=[Value])</p><h2 id="TfRecords读取"><a href="#TfRecords读取" class="headerlink" title="TfRecords读取"></a>TfRecords读取</h2><ul><li><div class="code-wrapper"><pre><code class="hljs"> 同文件阅读器流程,中间需要解析过程</code></pre></div></li><li><p>​    解析Tfrecords的example协议块</p></li><li><p>​    tf.parse_single_example(seralized,features=None,name=None)</p><ul><li>​        解析一个单一的example原型</li><li>​        seralized:标量字符串Tensor,一个序列化的Example</li><li>​        Features:dcit字典数据,键为读取的名字,值为 Fixed LenFeature</li><li>​        return:一个键值对组成的字典,键为读取的名字</li></ul></li><li><p>​    tf.FixedLengthFeature(shape.dtype)</p><ul><li>​        shape:输入数据的形状,一般不指定,为空列表</li><li>​        dtype:输入数据的类型,与存储金文件的类型一致,只能为float32,int64,string</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CifarRead</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    完成读取二进制文件,写进tfrecords,读取tfrecords</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self,filelist,tfrecords_path</span>):</span><br>        <span class="hljs-comment"># tfrecords文件路径</span><br>        self.tfrecords_path = tfrecords_path<br>        <span class="hljs-comment"># 文件列表(文件的目录)</span><br>        self.filelist = filelist<br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment"># 定义读取图片的属性</span><br>        self.height = <span class="hljs-number">32</span><br>        self.weight = <span class="hljs-number">32</span><br>        self.channel = <span class="hljs-number">3</span><br>        self.label_bytes = <span class="hljs-number">1</span><br>        self.image_bytes= self.height*self.weight*self.channel<br>        self.<span class="hljs-built_in">bytes</span> = self.image_bytes+self.label_bytes<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_and_decodes</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># 1, 构造文件队列</span><br>        file_queue = tf.train.string_input_producer(self.filelist)<br>        <span class="hljs-comment"># 2, 构造文件读取器,读取内容,每个人样本字节数</span><br>        reader = tf.FixedLengthRecordReader(self.<span class="hljs-built_in">bytes</span>)<br>        key,value = reader.read(file_queue) <span class="hljs-comment"># 此时shape() dtype=string</span><br>        <span class="hljs-comment"># 3, 解码内容</span><br>        label_image = tf.decode_raw(value,tf.uint8)  <span class="hljs-comment"># shape(?,) dtype=uint8 一维 图片与,目标值在一起</span><br>        <span class="hljs-comment"># 4,分割图片与标签数据 特征值和目标值 (本例数据中,目标值在前边,1,3072)</span><br>        label = tf.<span class="hljs-built_in">slice</span>(label_image,[<span class="hljs-number">0</span>],[self.label_bytes]) <span class="hljs-comment"># 切割出label ,slice(value,从哪读,读多少)</span><br>        image = tf.<span class="hljs-built_in">slice</span>(label_image,[self.label_bytes],[self.image_bytes])<br>        label = tf.cast(label,tf.int32)<br>        <span class="hljs-comment"># image = tf.cast(image,tf.float32) # 需要计算的话转为float32</span><br>        <span class="hljs-comment"># 5, 对图片数据进行形状改变,[3072]---&gt;[32,32,3]</span><br>        image_reshape = tf.reshape(image,[self.height,self.weight,self.channel])<br>        <span class="hljs-comment"># 6, 批处理数据</span><br>        image_batch,label_batch = tf.train.batch([image_reshape,label],batch_size=<span class="hljs-number">10</span>,num_threads=<span class="hljs-number">1</span>,capacity=<span class="hljs-number">10</span>)  <span class="hljs-comment"># shape(10,32,32,3) shape(10,1)</span><br>        <span class="hljs-keyword">return</span> image_batch,label_batch<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">write_to_tfrecords</span>(<span class="hljs-params">self,image_batch,label_batch</span>):</span><br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        将图片的特征值和目标值 存进tfrecords</span><br><span class="hljs-string">        :param image_batch: n张图片的目标值</span><br><span class="hljs-string">        :param label_batch: n张图片的目标值</span><br><span class="hljs-string">        :return: None</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-comment"># 1, 构造一个tfrecords文件,使用Tfrecords存储器</span><br>        writer = tf.python_io.TFRecordWriter(self.tfrecords_path)<br>        <span class="hljs-comment"># 2, 循环写入,每张图片都早example</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(image_batch.shape[<span class="hljs-number">0</span>]):<br>            <span class="hljs-comment"># 取出第i个图片的特征值和目标值</span><br>            image = image_batch[i] <span class="hljs-comment"># (32,32,3)</span><br>            label = label_batch[i] <span class="hljs-comment"># (10,1)</span><br>            <span class="hljs-comment"># 要转化为张量,张量值转化为字符串</span><br>            image = image.<span class="hljs-built_in">eval</span>().tostring()<br>            label = <span class="hljs-built_in">int</span>(label.<span class="hljs-built_in">eval</span>()[<span class="hljs-number">0</span>])<br>            <span class="hljs-comment"># 构造一个样本的example</span><br>            example = tf.train.Example(features=tf.train.Features(feature=&#123;<br>                <span class="hljs-string">&quot;image&quot;</span>:tf.train.Feature(bytes_list=tf.train.BytesList(value=[image])),<br>                <span class="hljs-string">&quot;label&quot;</span>:tf.train.Feature(int64_list=tf.train.Int64List(value=[label])),<br>            &#125;))<br>            <span class="hljs-comment"># 写入单独的样本</span><br>            writer.write(example.SerializeToString())<br>        <span class="hljs-comment"># 关闭</span><br>        writer.close()<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read_form_tfrecords</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-comment"># 1, 构造文件队列</span><br>        file_queue = tf.train.string_input_producer([<span class="hljs-string">r&quot;I:\人工智能数据\6000_32_32_图片集\cifar-10-batches-bin\all.tfrecords&quot;</span>])<br>        <span class="hljs-comment"># 2, 构造文件阅读器,读取内容 example value 为一个样本序列化的example</span><br>        reader = tf.TFRecordReader()<br>        key,value = reader.read(file_queue)<br>        <span class="hljs-comment"># 3, 解析example</span><br>        features = tf.parse_single_example(value,features=&#123;<br>            <span class="hljs-string">&quot;image&quot;</span>:tf.FixedLenFeature([],tf.string),<br>            <span class="hljs-string">&quot;label&quot;</span>:tf.FixedLenFeature([],tf.int64),<br>        &#125;)<br>            <span class="hljs-comment"># features[&quot;image&quot;] Tensor(shape=(),dtype=string)</span><br>            <span class="hljs-comment"># features[&quot;label&quot;] Tensor(shape=(),dtype=64)</span><br>        <span class="hljs-comment"># 4,解码内容 ,若内容时string 需要解码,是int64,string32 不需要解码</span><br>        image = tf.decode_raw(features[<span class="hljs-string">&quot;image&quot;</span>],tf.uint8)  <span class="hljs-comment"># Tensor(shape(?,) uint8)</span><br>        <span class="hljs-comment"># 固定形状</span><br>        image_reshape = tf.reshape(image,[self.height,self.weight,self.channel])<br>        label = features[<span class="hljs-string">&quot;label&quot;</span>]  <span class="hljs-comment"># Tensor(shape=(),int64)</span><br>        <span class="hljs-comment"># 5, 进行批处理</span><br>        image_batch,label_batch = tf.train.batch([image_reshape,label],batch_size=<span class="hljs-number">20</span>,num_threads=<span class="hljs-number">1</span>,capacity=<span class="hljs-number">10</span>)<br>        <span class="hljs-keyword">return</span> image_batch,label_batch<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">readBinary</span>():</span><br>    <span class="hljs-keyword">import</span> os<br>    <span class="hljs-comment"># 数据地址 https://www.cs.toronto.edu/~kriz/cifar.html</span><br>    path = <span class="hljs-string">r&quot;I:\人工智能数据\6000_32_32_图片集\cifar-10-batches-bin&quot;</span><br>    tfrecords = os.path.join(path,<span class="hljs-string">&quot;all.tfrecords&quot;</span>)<br>    file_name = os.listdir(path)<br>    <span class="hljs-comment"># 获取文件列表,并过滤 非bin文件</span><br>    filelist = [os.path.join(path,file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> file_name <span class="hljs-keyword">if</span> file[-<span class="hljs-number">3</span>:]==<span class="hljs-string">&quot;bin&quot;</span>]<br>    <span class="hljs-keyword">with</span> tf.Session() <span class="hljs-keyword">as</span> sess:<br>        c = CifarRead(filelist, tfrecords)<br>        <span class="hljs-comment"># 读取数据并存入tfrecords</span><br>        image_batch, label_batch = c.read_and_decodes()<br>        c.write_to_tfrecords(image_batch=image_batch, label_batch=label_batch)<br>        <span class="hljs-comment"># 从tfrercords中读取</span><br>        <span class="hljs-comment"># image_batch, label_batch = c.read_form_tfrecords()</span><br>        coord = tf.train.Coordinator()<br>        threads = tf.train.start_queue_runners(sess, coord=coord)<br>        <span class="hljs-built_in">print</span>(sess.run([image_batch,label_batch]))<br>        coord.request_stop()<br>        coord.join(threads)<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_Tensorflow_1/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_1_Tensorflow_1/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> 深度学习</span><span style="color: #008000;">#</span><span style="color: #008000;">   图像识别,自然语言处理</span><span style="color: #008000;">#</span><span style="color: #008000;">   机器学习                深度学习</span><span style="color: #008000;">#</span><span style="color: #008000;">   分类:神经网络(简单)      神经网络(深度)</span><span style="color: #008000;">#</span><span style="color: #008000;">   回归                    图像:卷积神经网络</span><span style="color: #008000;">#</span><span style="color: #008000;">                           自然语言处理:循环神经网络</span><span style="color: #008000;">#</span><span style="color: #008000;"> cpu:运行操作系统,处理业务,计算能力不是特别突出</span><span style="color: #008000;">#</span><span style="color: #008000;"> gpu:专门为计算设计的</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> tensorflow as tfa </span>= tf.constant(5.0<span style="color: #000000;">)b </span>= tf.constant(6.0<span style="color: #000000;">)sum1 </span>= tf.add(a,b) <span style="color: #008000;">#</span><span style="color: #008000;"> 在session外边打印时只能查看对象</span><span style="color: #008000;">#</span><span style="color: #008000;"> 程序的图 a,b,sum1也有graph</span>graph =<span style="color: #000000;"> tf.get_default_graph()</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(a.graph)</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(graph)</span><span style="color: #008000;">#</span><span style="color: #008000;"> session()运行默认的图,当运行的元素不是默认图的时候,会报错</span><span style="color: #000000;">with tf.Session() as sess:    </span><span style="color: #0000ff;">print</span>(sess.run(sum1)) <span style="color: #008000;">#</span><span style="color: #008000;"> 输出值</span><span style="color: #008000;">#</span><span style="color: #008000;"> 创建新的图</span>g =<span style="color: #000000;"> tf.Graph()with g.as_default():    c </span>= tf.constant(11.0<span style="color: #000000;">)    </span><span style="color: #0000ff;">print</span>(c.graph)  <span style="color: #008000;">#</span><span style="color: #008000;"> 与上边的图不同</span><p><span style="color: #008000;">#</span><span style="color: #008000;"> 图程序的空间,变量,线程等资源都在图中</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 会话运行图的程序,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.Session(graph=c) 指定图运行, 里边run的时候要注意</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   session.run的作用:启动整个图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   session.close:关闭,释放资源河</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> Session中的参数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.Session(config=tf.ConfigProto(log_device_placement=True))</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 交互式session:tf.InteractiveSession()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   调用后,不用Session() 不同run 直接a.eval()也可</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   其实只要有会话的上下文环境,就可以使用eval()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 会话的run()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> run(fetches,feed_dict=None,graph=None) 运行ops与tensor</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   fetches 需要run的内容 有多个时使用[]</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 不是op不能run 例:sum2 = 1+3</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   但 sum3=1+tf.constant(3.0) 可以run(sum3)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ========================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 实时提供数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> placeholder</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.placeholder(dtype,shape=None,name=None)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   plt = tf.placeholder(tf.float32,[2,3]) [None,3]也可</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   run(plt,feed_dict={plt:[[1,2,3],[4,5,6]]})</span><br>input1 = tf.placeholder(tf.float32)  <span style="color: #008000;">#</span><span style="color: #008000;"> 可以说是一个占位符,使用的时候需要传入值</span><br>input2 =<span style="color: #000000;"> tf.placeholder(tf.float32)</p><p>output </span>= input1*<span style="color: #000000;">input2<br>with tf.Session() as sess: </span><span style="color: #008000;">#</span><span style="color: #008000;"> 传值的时候使用feed_dict 字典 占位符对象作为键,值需要使用[] 包含</span><br>    <span style="color: #0000ff;">print</span>(sess.run(output,feed_dict={input1:[7],input2:[2.6<span style="color: #000000;">]}))<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> =============================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 张量tensor</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 将numpy中的数组封装为tensor类型</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensor:名字,shape,dtype</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   阶:维度</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   数据类型:tf.float32,64(其实没有意义,实际还是32) int8-64,uint8,string,bool</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   print(a.shape,a.name,a.op,a.graph)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   0维:() 1维:(n) 2维:(n,m) …</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ======================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> Numpy:reshape 把原来的数据直接修改</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensorflow中</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.reshape:创建新的张量 动态形状</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.Tensor.set_shape:更新Tensor的静态形状</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 静态形状 (当数量不确定时可以,切不能跨维度)</span><br>plt = tf.placeholder(tf.float32,[None,2])  <span style="color: #008000;">#</span><span style="color: #008000;"> shape=(?,2)</span><br>plt.set_shape([3,2])  <span style="color: #008000;">#</span><span style="color: #008000;"> shape=(3,2)</span><br>plt.set_shape([4,2])  <span style="color: #008000;">#</span><span style="color: #008000;"> 此时不能修改</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 动态形状 (注意元素个数不能改变,可跨维度)</span><br>new_plt=tf.reshape(plt,[2,3]) <span style="color: #008000;">#</span><span style="color: #008000;"> shape=(2,3)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ==========================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 有默认值的张量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.zero(shape,dtype=tf.float32,name=None) 全为0</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.ones(shape,dtype=float32,name=None) 全为1</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.constant(value,dtype=None,shape=None,name=None) 常量张量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.random_normal(shape,mean=0.0,stddev=1.0,dtype=float32,seed=None,name=None)  由正太分部的随机值组成的矩阵</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ==========================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 张量的类型变换</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.string_to_number(string_tensor,out_type=None,name=None) 等</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.cost(x,dtype,name=None) 万能转换</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   tf.cost(原来数据,新类型)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===========================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 数据拼接 a=[[1,2,3],[4,5,6]] b = [[7,8,9],[10,11,12]]</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.concat([a,b],axis=1) 合并后变为6列</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> api <a href="https://www.tensorflow.org/versions/r1.0/api_guides/python/math_ops">https://www.tensorflow.org/versions/r1.0/api_guides/python/math_ops</a></span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 变量op 可以持久化, 普通的张量op不行</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 变量op需要在会话中运行初始化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> name参数:在tensorboard中显示名字,可以让相同op名字的数据进行区分</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   设置后 Tensor(“Variable”) —-&gt;Tensor(“设置的name”)</span><br>a = tf.constant([1,2,3,4,5<span style="color: #000000;">])<br>random </span>= tf.random_normal([2,3],mean=0.0,stddev=1.0<span style="color: #000000;">)<br>var </span>= tf.Variable(initial_value=random,name=None,trainable=<span style="color: #000000;">None)<br></span><span style="color: #0000ff;">print</span><span style="color: #000000;">(a,var)<br>init </span>=<span style="color: #000000;"> tf.global_variables_initializer()<br>with tf.Session() as sess:<br>    sess.run(init)  </span><span style="color: #008000;">#</span><span style="color: #008000;"> 初始化op</span><br>    <span style="color: #0000ff;">print</span>(sess.run([a,var]))  <span style="color: #008000;">#</span><span style="color: #008000;"> 再次打印</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> ====================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 可视化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 模块:summary</span><br><span style="color: #000000;">with tf.Session() as sess:<br>    sess.run(init)<br>    filewriter </span>=  tf.summary.FileWriter(<span style="color: #800000;">“</span><span style="color: #800000;">.</span><span style="color: #800000;">“</span>,graph=<span style="color: #000000;">sess.graph)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 运行后生成文件,每次运行都会生成文件,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensorboard –logdir=”生成的文件所在的目录”    会启动一个服务器,访问即可</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===============================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 线性回归原理及实现</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 1,转备好特征和目标值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 2,建立模型 模型参数必须是变量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 3,求损失函数,误差  均方误差</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 4,梯度下降优化损失过程,指定学习率</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ========运算api</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.matmul(x,w) 矩阵运算</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.squqre(error) 平方 每个样本误差平方</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.reduce_mean(error) 每个列表平均值</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> ===========梯度下降api</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.train.GradientDescentOptimizer(learning_rate)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   minimize</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   返回梯度下降op</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ==============================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensorflow 实现简单的线性回归</span><br><span style="color: #0000ff;">import</span><span style="color: #000000;"> tensorflow as tf<br></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> myregression():<br>    </span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>    自实现一个线性回归预测<br>    </span><span style="color: #800000;">“””</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 1,准备数据, x 特征值[100,10] y目标值[100]</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 准备x</span><br>    x = tf.random_normal([100,1],mean=1.75,stddev=0.5,name=<span style="color: #800000;">“</span><span style="color: #800000;">x_data</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 准备y,自定义出实际的w,b</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 矩阵相乘必须是二维的</span><br>    y_true= tf.matmul(x,[[0.7]])+0.8<br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 2,建立模型</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 随机的权重与偏置,让进行优化</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 只能使用变量定义,trainable控制该变量 训练的时候是否要变化</span><br>    weight = tf.Variable(tf.random_normal([1,1],mean=0.0,stddev=0.75),trainable=<span style="color: #000000;">True)<br>    bias </span>= tf.Variable(0.0,name=<span style="color: #800000;">“</span><span style="color: #800000;">b</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br>    y_predcit </span>= tf.matmul(x,weight)+<span style="color: #000000;">bias<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3,建立损失函数,均方误差</span><br>    loss = tf.reduce_mean(tf.square(y_true-<span style="color: #000000;">y_predcit))<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 4,梯度下降优化损失</span><br>    youhua = tf.train.GradientDescentOptimizer(0.1)  <span style="color: #008000;">#</span><span style="color: #008000;"> 一般0-1之间不能太大,</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 也可2,3,10等 若太大可能会出现nan:梯度爆炸</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;">       解决方案:重新设计网络,调整学习率,使用梯度截断,使用激活函数</span><br>    train_op =<span style="color: #000000;"> youhua.minimize(loss)<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 收集tensor</span><br>    tf.summary.scalar(<span style="color: #800000;">“</span><span style="color: #800000;">losses</span><span style="color: #800000;">“</span>,loss) <span style="color: #008000;">#</span><span style="color: #008000;"> 在tensorborad中 scalars 会显示在学习的过程中loss的变化曲线</span><br>    tf.summary.histogram(<span style="color: #800000;">“</span><span style="color: #800000;">weights</span><span style="color: #800000;">“</span><span style="color: #000000;">,weight)<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 定义合并tensor的op</span><br>    merged=<span style="color: #000000;">tf.summary.merge_all()<br>    saver </span>=<span style="color: #000000;"> tf.train.Saver()</p><pre><code class="hljs">init &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; tf.global_variables_initializer()&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 会话运行&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">    with tf.Session() as sess:<br>        sess.run(init)<br>        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 打印不优化的train_op</span><br>        <span style="color: #0000ff;">print</span><span style="color: #000000;">(sess.run([weight,bias]))<br>        filewrite </span>= tf.summary.FileWriter(<span style="color: #800000;">“</span><span style="color: #800000;">.</span><span style="color: #800000;">“</span>,graph=<span style="color: #000000;">sess.graph)<br>        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 模型恢复</span><br>        <span style="color: #008000;">#</span><span style="color: #008000;"> 模型文件存在</span><br>        <span style="color: #008000;">#</span><span style="color: #008000;"> saver.restore(“sess”,”路径”)</span></p><div class="code-wrapper"><pre><code class="hljs">    &lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 循环运行优化&lt;/span&gt;    &lt;span style=&quot;color: #0000ff;&quot;&gt;for&lt;/span&gt; i &lt;span style=&quot;color: #0000ff;&quot;&gt;in&lt;/span&gt; range(1000&lt;span style=&quot;color: #000000;&quot;&gt;):        sess.run(train_op)        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 运行合并的tensor&lt;/span&gt;        summary =&lt;span style=&quot;color: #000000;&quot;&gt; sess.run(merged)        filewrite.add_summary(summary,i)        &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;print&lt;/span&gt;(&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;第&#123;&#125;次&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;.format(i),sess.run([weight, bias]))    saver.save(sess,&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;./reserve/model&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)</code></pre></div><p></span><span style="color: #0000ff;">if</span> <span style="color: #800080;"><strong>name</strong></span> ==<span style="color: #800000;">“</span><span style="color: #800000;"><strong>main</strong></span><span style="color: #800000;">“</span><span style="color: #000000;">:<br>    myregression()<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> ========================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensorflow变量作用域tf.variable_scope()创建指定名字的变量作用域</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 不同的部分放在不同的作用域下,tensorflowboard中graph 会更加清晰,作用分明</span><br>with tf.variable_scope(<span style="color: #800000;">“</span><span style="color: #800000;">name</span><span style="color: #800000;">“</span><span style="color: #000000;">):<br>    </span><span style="color: #0000ff;">pass</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> 增加变量显示</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   添加权重参数,损失值等在tensorborad中显示</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   1,收集变量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       tf.summary.scalar(name=””,tensir)收集对于损失函数和准确率等单值变量,name为变量值,tensor为值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       tf.summary.histogram(name=””,tensor) 收集高维度的变量参数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   2,合并变量写入事件文件</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       merged = tf.summary.merge_all()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       运行合并:summary=sess.run(merged) 每次迭代都需要运行</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       添加:FileWriter.add_summary(summary,i)i表示第几次迭代</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ========================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tensorflow变量作用域tf.variable_scope()创建指定名字的变量作用域</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 不同的部分放在不同的作用域下,graph 会更加清晰,作用分明</span><br>with tf.variable_scope(<span style="color: #800000;">“</span><span style="color: #800000;">name</span><span style="color: #800000;">“</span><span style="color: #000000;">):<br>    </span><span style="color: #0000ff;">pass</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 模型的保存与加载</span><br>saver = tf.train.Saver(var_list=None,max_to_keep=5<span style="color: #000000;">)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> var_list:指定要保存和还原的变量,作为一个dict或列表传递</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> max_to_keep:指示要保留的最近检查点文件的最大数量,创建新文件时,删除旧文件,保留最新的5个</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 文件格式:checkpoint文件</span><br>saver.save(<span style="color: #800000;">“</span><span style="color: #800000;">sess对象</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">路径/文件名字</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 第一次保存</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   checkpoint:记录模型名字,文件路径</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   name.data-00000-of-00001 数据存储文件</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   name.index name.meta</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 模型的加载</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   saver.restore(sess,”路径”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   在with放入会话中,开始优化前</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 自定义命令行参数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 1, 首先定义有哪些参数需要在运行时指定</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 2,程序当中获取定义的命令行参数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 名字,默认值,说明</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 以前的版本</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.app.flags.DEFINE_integer(“max_step”,100,”模型训练的步数”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf.app.flags.FLAGS.max_step 获取数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 新版</span><br>flags = tf.flags.FLAGS <span style="color: #008000;">#</span><span style="color: #008000;"> 定义对象</span><br>tf.flags.DEFINE_integer(<span style="color: #800000;">“</span><span style="color: #800000;">max_step</span><span style="color: #800000;">“</span>,100,<span style="color: #800000;">“</span><span style="color: #800000;">模型训练的步数</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br>tf.flags.DEFINE_string(</span><span style="color: #800000;">“</span><span style="color: #800000;">file_path</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“”</span>,<span style="color: #800000;">“</span><span style="color: #800000;">文件路径</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br>tf.flags._FlagValuesWrapper </span><span style="color: #008000;">#</span><span style="color: #008000;"> 初始化</span><br>flags.max_step=100 <span style="color: #008000;">#</span><span style="color: #008000;"> 修改 或获取</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 定义完成后  运行文件时 python  xx.py –max-step=500 即可传入,字符串需要加引号</span></pre></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_0_%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/"/>
    <url>/2022/01/16/cnblog/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0_0_%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="SVM损失函数"><a href="#SVM损失函数" class="headerlink" title="SVM损失函数"></a>SVM损失函数</h1><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191130102551220-61380614.png"></p><ul><li><p>L1 = max(0,5.1-3.2+1)+max(0,-1.7-3.2+1)     l2 = ……   损失函数:L=(L1+L2+L3)/3</p></li><li><p>当所有的分数几乎相同时:L=分类数-1   (就是max中的那个1.共有类数-1个)</p></li><li><p>为什么使用平均值?     无论分数如何变化loss不会改变</p></li><li><p>最优化w并不是唯一的,若w1对应loss为0,2*w 对应loss也为0</p><p>因此要选择正确的w      L=原来的L+λR(w)(正则项)    λ为超参数</p></li><li><p>常见的是L2正则化</p></li></ul><h1 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h1><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191130102547583-969485859.png"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191130102550514-1551560771.png"></p><h1 id="卷积神经网络"><a href="#卷积神经网络" class="headerlink" title="卷积神经网络"></a>卷积神经网络</h1><h2 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h2><ol><li>图片:32*32*3</li><li>卷积核:3*3*3 前两个 3是卷积核大小,后一个是图片通道数,指定步长后滑动一次生成 一个[x,y,1]</li><li>假设有n个卷积核,这样就生成[x,y,n]    缩小图片大小,厚度增加</li><li>参数:n个卷积核 n*3*3 +n(偏执)</li></ol><h2 id="池化"><a href="#池化" class="headerlink" title="池化:"></a>池化:</h2><ol><li>对于32*32*3的图片  —–&gt;28*28*64  卷积</li><li>28*28*64  ——-&gt; 14*14*64 池化</li><li>通常也有滤波器 2*2  每次滑动步长为2 意思就是不重叠         </li><li>池化方法通常是最大池化法:在2*2的4个值中选取最大的作为结果  没有参数,64的深度不变</li><li>通常使用最大池化,不是均值池化:因为它表示的是神经元在某一区域的感知,    (只可意会,不和言传)</li><li>一般不用0填充</li></ol><h1 id="激活函数"><a href="#激活函数" class="headerlink" title="激活函数"></a>激活函数</h1><p><img src="https://img2018.cnblogs.com/blog/1333782/201911/1333782-20191130102626518-774043186.png"></p><h2 id="批量归一化-Btach-Normalization"><a href="#批量归一化-Btach-Normalization" class="headerlink" title="批量归一化:Btach Normalization"></a>批量归一化:Btach Normalization</h2><p>（x-均值）/标准差    是的均值变为0</p><h2 id="正则化"><a href="#正则化" class="headerlink" title="正则化"></a>正则化</h2><p>dropout</p><h2 id="迁移学习"><a href="#迁移学习" class="headerlink" title="迁移学习"></a>迁移学习</h2><h2 id="深度学习框架"><a href="#深度学习框架" class="headerlink" title="深度学习框架"></a>深度学习框架</h2><p>caffe2—-》caffe2:文件形式，不用写代码，</p><p>torch—–》pytorch:动态图，定义，计算一起  科研型</p><p>theano—-》tensorflow：静态图，先定义图，后运行  产品类</p><p>keras：作为Tensorflow的高级应用程序接口   面向对象</p><h2 id="CNN框架"><a href="#CNN框架" class="headerlink" title="CNN框架"></a>CNN框架</h2><p>神经网络架构：AlexNet，VGGNet，GoogleNet，ResNet</p><p>其他的架构：NIN,WIDE ResNeT</p><p>leNet：数字识别领域</p><p>AlexNet：卷积，池化，归一化，在卷积，池化，全连接  与LeNet类似，只不过层数变多</p><p>Vgg 16 19</p><p>GoogleNet 22 没有全连接层</p><p>ResNet 152层 残差网络</p><p>1，CNN，卷积神经网络，是以卷积为核心的一大类网络。<br>2，LeNet、AlexNet、VGG、GoogLeNet，属于CNN。<br>3 ，RCNN、Fast RCNN、Faster RCNN、YOLO、YOLOv2、SSD，也属于CNN，但和2是另一条路线。<br>2和3的区别在于，2属于用于图像分类的CNN，3属于用于目标检测的CNN。</p><h1 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h1><p>…</p><h2 id="图像语义分割：一张图片上有不同类的物体，用方框画出"><a href="#图像语义分割：一张图片上有不同类的物体，用方框画出" class="headerlink" title="图像语义分割：一张图片上有不同类的物体，用方框画出"></a>图像语义分割：一张图片上有不同类的物体，用方框画出</h2><p>1，图像划分为n多小块（可能是每个像素就是一块，但复杂度高 ），分别识别属于那一类，然后合在一起 </p><p>​        对于相邻或重复的块，可以共享计算</p><p>2，全连接卷积网络</p><h1 id="分类定位"><a href="#分类定位" class="headerlink" title="分类定位"></a>分类定位</h1><p>知道物体数量</p><h1 id="对象识别：目标检测"><a href="#对象识别：目标检测" class="headerlink" title="对象识别：目标检测"></a>对象识别：目标检测</h1><p>使用框框框主一类事物</p><p>1，框框大小变化位置移动，以此寻找目标位置      计算量大</p><p>2，寻找点状n个点状候选区（1000-2000），经过卷积计算RCNN</p><p>3，fast-rcnn</p><p>4，ssd 图片分为nxn的网格，检测每个格中概率</p><p>5，mask rcnn</p><h1 id="PCA-主成分分析-降维方法"><a href="#PCA-主成分分析-降维方法" class="headerlink" title="PCA:主成分分析 降维方法"></a>PCA:主成分分析 降维方法</h1><h2 id="生成式模型：无监督学习的一种"><a href="#生成式模型：无监督学习的一种" class="headerlink" title="生成式模型：无监督学习的一种"></a>生成式模型：无监督学习的一种</h2><p>pixelRNNs</p><p>pixelCNNs</p><p>自编码器VAE</p><p>生成式对抗网络</p><h1 id="目标检测"><a href="#目标检测" class="headerlink" title="目标检测"></a>目标检测</h1><p>​    自动驾驶</p><p>​    人脸检测与识别</p><p>​    行为识别</p><p>​    目标计数</p><h2 id="实时目标检测"><a href="#实时目标检测" class="headerlink" title="实时目标检测"></a>实时目标检测</h2><p>​    目标分类，定位目标</p><p>​    实时性与性能 需要平衡</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/01/16/cnblog/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="第一章，汇编语言产生"><a href="#第一章，汇编语言产生" class="headerlink" title="第一章，汇编语言产生"></a>第一章，汇编语言产生</h1><p>1，机器语言与汇编语言一一对应    </p><p>2，汇编指令：Mov AX,BX  将寄存器BX，移入AX</p><p>3，寄存器：CUP中的存储器，注意不是CUP的缓存，</p><p>4，汇编–》编译器—》机器码01</p><p>5，汇编语言组成</p><ul><li>汇编指令，机器码的助记符</li><li>伪指令，编译器执行</li><li>其他符号，编译器识别</li></ul><p>6，一串机器码，可以使指令，也可以是数据，就看是cd，ds那个指向他</p><p>7，地址信息，读或写，数据信息</p><p>​    cup与所有内存之间：地址总线，数据总线，控制总线，每条线对应不同信息，指令与数据分开</p><p>8，总线</p><ul><li>地址总线：产品cpu通过它指定存储单元，地址总线有多少不同信息，就是CPU的寻址范围，64位CPU就是64个地址总线</li><li>数据总线：宽度决定传输速度，例如一次传8bit，16bit</li><li>控制总线：宽度表示控制能力</li></ul><p><img src="https://i.loli.net/2020/07/25/bCRA5rikJmp3lNz.png" alt="image-20200725222259680"></p><p><img src="https://i.loli.net/2020/07/25/Y1d2RiNo7vawDUj.png" alt="image-20200725222458172"></p><p>9，例</p><p>地址：0-7FFFH，为RAM</p><p>地址：8000H-9FFFH，为显存地址:当数据写入此处，就会显示</p><p>地址：A000H-FFFFH为各个ROM</p><p>10，8086CPU如下，8086,8088，龙芯，酷睿等都是类似分配</p><p><img src="https://i.loli.net/2020/07/25/iqv9rjlhLsHAxRo.png" alt="image-20200725222928292"></p><h1 id="第二章，寄存器（CPU工作原理）"><a href="#第二章，寄存器（CPU工作原理）" class="headerlink" title="第二章，寄存器（CPU工作原理）"></a>第二章，寄存器（CPU工作原理）</h1><h5 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h5><p>1，CPU：运算器，控制器，寄存器，内部总线相连接</p><p>2，8086cpu寄存器：共14个，有8个通用寄存器</p><ul><li><p>AX，BX，CX，DX，SI，DI，SP，BP，IP，CS，SS，DS，ES，PSW</p></li><li><p>所有寄存器16bit，16位的CPU，8086上一代8bit</p></li><li><p>AX,BX,CX,DX通用寄存器，可以分为两个独立的8位寄存器使用 AX–&gt;AH,AL</p></li><li><p><img src="https://i.loli.net/2020/07/25/sozLCrpQPYaydHj.png" alt="image-20200725224609858"></p></li><li><p><img src="https://i.loli.net/2020/07/25/EuDdMehgapoBbHR.png" alt="image-20200725224111847"></p><p><img src="https://i.loli.net/2020/07/25/9pmJAcEuqVeUPzs.png" alt="image-20200725224232240"></p></li><li><p><img src="https://i.loli.net/2020/07/25/9XGisLT6k5wIrSR.png" alt="image-20200725224722314"></p></li></ul><h5 id="字"><a href="#字" class="headerlink" title="字"></a>字</h5><p>寄存器中数据大多是n*8bit</p><h5 id="汇编指令"><a href="#汇编指令" class="headerlink" title="汇编指令"></a>汇编指令</h5><p><img src="https://i.loli.net/2020/08/15/DfC5oGe8OKpkHYM.png" alt="image-20200725225400234"></p><h5 id="物理地址"><a href="#物理地址" class="headerlink" title="物理地址"></a>物理地址</h5><h5 id="16位结构CPU"><a href="#16位结构CPU" class="headerlink" title="16位结构CPU"></a>16位结构CPU</h5><p>1，一次16bit数据</p><p>2，寄存器最大宽度16bit</p><p>3，寄存器运算器之间通路16bit</p><h5 id="8086CPU给出物理地址"><a href="#8086CPU给出物理地址" class="headerlink" title="8086CPU给出物理地址"></a>8086CPU给出物理地址</h5><p>1，20位地址总线，寻址1m</p><p>2，内部16位结构，寻址64kb</p><p>方法：</p><p><img src="https://i.loli.net/2020/07/25/abvQgVZFA4qmhru.png" alt="image-20200725232114587"></p><p>3，物理地址=段地址*16+偏移地址  因为是2进制</p><h5 id="段"><a href="#段" class="headerlink" title="段"></a>段</h5><p>1，内存并没有分段，分段是因为cup，内部不足，但因此使用分段管理内存</p><p>2，偏移地址16bit，因此每段64KB</p><p>3，CUP可以不痛段地址与偏移构成相同的物理地址</p><h5 id="段寄存器"><a href="#段寄存器" class="headerlink" title="段寄存器"></a>段寄存器</h5><p>8086:CS,DS,SS,ES</p><p>cs:指令段寄存器，ip指令偏移寄存器     —-》段，偏移</p><p><img src="https://i.loli.net/2020/07/25/ihnrBeypFt1HA8w.png" alt="image-20200725235034031"></p><h5 id="修改CS-IP"><a href="#修改CS-IP" class="headerlink" title="修改CS,IP"></a>修改CS,IP</h5><p>1，只能操作寄存器控制cpu，因此需要控制cs，ip</p><p>2，mov 传送指令，可修改ax，但不能cs，ip</p><p>3，jmp 2ae3：3  跳转的意思  此时cs 为2ae3，ip为3</p><h5 id="代码段"><a href="#代码段" class="headerlink" title="代码段"></a>代码段</h5><p>将n&lt;64kb的数据  —》代码段</p><p><img src="https://i.loli.net/2020/07/26/ErBHwPZYMzgovT8.png" alt=" "></p><p>将cs，ip指向该代码段，会认为是指令，才会执行，执行后ip = ip + 指令长度</p><p><img src="https://i.loli.net/2020/07/26/CIWhuMkljoKEOxe.png" alt="image-20200726003309179"></p><h1 id="第三章，寄存器"><a href="#第三章，寄存器" class="headerlink" title="第三章，寄存器"></a>第三章，寄存器</h1><h5 id="内存中的存储"><a href="#内存中的存储" class="headerlink" title="内存中的存储"></a>内存中的存储</h5><p>1，例：数字2000  （4E20H）</p><p><img src="https://i.loli.net/2020/07/26/xZP9zSgc8u3itDR.png" alt="image-20200726131206580"></p><p>任何两个连续单元，N,N+1，可以看做两个内存单元，也可以看做地址为N的字单元中的高位字节单元，低位字节单元</p><h5 id="DS与Address"><a href="#DS与Address" class="headerlink" title="DS与Address"></a>DS与Address</h5><p>DS：存放的数据的段地址，</p><p>1，执行指令时，自动取DS中数据为内存单元的段地址</p><p>2，mov al，[0]    将ds:0 <font color=red>内存单元</font>中的数据移入al</p><p>3，但不能直接把值移入ds  ，mov ds 1000H：错误的 8086cpu不支持放入段寄存器，硬件问题。只能数据 –》通用寄存器–》段寄存器</p><p><img src="https://i.loli.net/2020/07/26/mRW6huQBSJ32zOt.png" alt="image-20200726133154156"></p><h5 id="字的传送"><a href="#字的传送" class="headerlink" title="字的传送"></a>字的传送</h5><h5 id="mov，add，sub"><a href="#mov，add，sub" class="headerlink" title="mov，add，sub"></a>mov，add，sub</h5><p>1，mov</p><ul><li>mov 寄存器，数据</li><li>mov 寄存器，寄存器</li><li>mov 寄存器，内存</li><li>mov 内存，寄存器</li><li>mov 段寄存器，寄存器</li><li>mov 寄存器，段寄存器 ，也可以</li></ul><p><img src="https://i.loli.net/2020/07/26/VEDmhCQKBLv9x67.png" alt="image-20200726140431689"></p><h5 id="数据段"><a href="#数据段" class="headerlink" title="数据段"></a>数据段</h5><h5 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h5><p>push ax：将ax放入栈内存中</p><p>​    sp =sp-2</p><p>​    ss：sp 指向新地址</p><p>pop ax：从栈内存取数据到ax</p><p>1，cup如何知道某段内存是栈内存？</p><p>ss，栈顶段寄存器，sp栈顶偏移     ss：sp指向栈顶，栈为空时指向栈顶下一位，</p><p>出栈时只是修改索引，数据还未覆盖，由此可见，硬盘类似</p><p>2，cpu如何知道哪个是栈顶，栈底？从大地址向小地址写数据</p><p>3，<font color=red>语言中的函数，调用时就是申请一块栈内存，执行完，栈内存元素全部出栈，因此局部变量失效</font>，栈内存由编译器管理，堆内存有程序员管理</p><h5 id="栈顶越界"><a href="#栈顶越界" class="headerlink" title="栈顶越界"></a>栈顶越界</h5><p>1，cpu关心栈只关心栈顶指针在何处，当前要执行的指令是哪个</p><p>2，c,c++常会溢出</p><h5 id="POP-PUSH"><a href="#POP-PUSH" class="headerlink" title="POP,PUSH"></a>POP,PUSH</h5><p>1，栈空间，一段固定读取格式的内存</p><h5 id="栈段"><a href="#栈段" class="headerlink" title="栈段"></a>栈段</h5><p>1，可以将小于64kb的内存当做栈</p><p>2，认为10010H,1001FH 当做16字节栈，但cup只关心栈顶，不会关心栈段的大小</p><h1 id="第四章，第一个程序"><a href="#第四章，第一个程序" class="headerlink" title="第四章，第一个程序"></a>第四章，第一个程序</h1><p>汇编—》可执行</p><p>1，流程</p><ul><li><p>编写，</p></li><li><p>编译程序（masm.exe），产生目标文件 </p></li><li><p>连接程序（link.exe），生成可执行文件</p></li></ul><p>2，可执行程序组成</p><ul><li>程序，数据（程序中定义的数据）</li><li>描述信息，程序多大，占空间多大等</li></ul><p>3，执行过程</p><ul><li>按照可执行文件描述信息，将程序，数据加载到内存，设置cs，ip等</li></ul><p>4，汇编指令,伪指令</p><ul><li><p>segment …. ends：定义一个段，程序段，数据段等，一个程序有多个段</p></li><li><p>end：便已结束标记</p></li><li><p>assume：假设，将段指定为数据段，程序段等，伪指令指向程序开始等等</p><ul><li>```assembly<br>assume cs:codesg<br>codesg segment<br>start: mov ax 0123H<br>codesg ends<br>end<figure class="highlight x86asm"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><pre><code class="hljs x86asm"><br>![image-<span class="hljs-number">20200726160028404</span>](https://i<span class="hljs-number">.</span>loli<span class="hljs-number">.</span>net/<span class="hljs-number">2020</span>/<span class="hljs-number">07</span>/<span class="hljs-number">26</span>/vVnYwOU87I2xajB<span class="hljs-number">.</span>png)<br><br>##### 源程序<br><br><span class="hljs-number">1</span>，一个标号只带一个地址<br><br><span class="hljs-number">2</span>，codesg：给段的命名，最后会变为地址<br><br><span class="hljs-number">3</span>，程序返回，<br><br>- 返回使它运行的那个程序<br>  - <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>，<span class="hljs-number">4c00H</span><br>  - <span class="hljs-keyword">int</span> <span class="hljs-number">21H</span><br>  - 这两个规定的语句实现中断<br><br>##### 编辑源程序<br><br><span class="hljs-string">```</span>asm<br><span class="hljs-meta">assume</span> <span class="hljs-built_in">cs</span>:abc<br>abc <span class="hljs-meta">segment</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">2</span><br><span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">add</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">4c00H</span><br><span class="hljs-keyword">int</span> <span class="hljs-number">21H</span><br>abc ends<br>end<br></code></pre></td></tr></table></figure></li></ul></li></ul><p>masm 编译，link 链接 生成exe文件</p><p>“；”可以简化masm，link</p><p>ml：两部合起来</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># 有入口的文件<br>assume cs:abc<br>abc segment<br>start:mov ax,2<br>add ax,ax<br>add ax,ax<br>mov ax,4c00H<br>int 21H<br>abc ends<br>end start<br></code></pre></td></tr></table></figure><p>1，exe文件加载过程</p><p><img src="https://i.loli.net/2020/07/26/dMZRsrDHwSmQihj.png" alt="image-20200726181347006"></p><p>程序加载后，内存地址为ds：0</p><p>其中前256是dos与程序通信的，256向后是程序</p><h1 id="第五章，bx与loop"><a href="#第五章，bx与loop" class="headerlink" title="第五章，bx与loop"></a>第五章，bx与loop</h1><p>注意：在debug中[0]表示段地址的偏移地址，在masm中表示数值0</p><h5 id="bx"><a href="#bx" class="headerlink" title="bx"></a>bx</h5><p>mov bx ，0</p><p>mov ax，[bx]  ,此时[bx]表示以bx内容位偏移地址</p><p>1，将bx中的数据作为偏移地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">inc bx # 自加<br></code></pre></td></tr></table></figure><h5 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h5><p>1，loop 标号</p><ul><li>cx = cx-1</li><li>判断cx中的值，不为零转到标号执行处，若果为零则向下执行</li><li>cx中存放的一般是循环次数</li></ul><p>2，2^1000</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov ax,2<br>mov cx,11<br>s:add as,ax<br>loop s # s就是标号   判断cx，是否跳到标号<br></code></pre></td></tr></table></figure><p>3，越位赋值会可能出错 mov ax,[bx]</p><p>mov al,[bx]</p><p>mov ah,0</p><p>4，汇编语言中数字以字母开头，例如大于9fffh的，Afffh，需要在前边加0</p><p>5，使用deubg追踪循环</p><p>g 命令地址：相当于 debug中的段点</p><p>p :在循环时使用，会直接跳到循环结束，即自动完成循环过程</p><h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><p>在masm中</p><p>mov al，[0] 将0移入al</p><p>mov al，ds:[0] ，偏移为0的地址中内容放入al</p><p>mov al，[bx]，将bx为偏移地址的地址中的内容放入al</p><p>mov al，ds:[bx]，同上</p><h5 id="loop，bx联合应用"><a href="#loop，bx联合应用" class="headerlink" title="loop，bx联合应用"></a>loop，bx联合应用</h5><p>内存数值相加时的问题</p><p>例：ffff:0—ffff:b 12个字节相加，</p><p>问题：放入16位ax，会不会越界，8位如何放入16位寄存器</p><p>解决方法：使用中介，将8位数据放入16位中介寄存器ax，再相加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>mov,ax,0ffffh<br>mov,ds,ax # 设置段地址<br><br>mov dx,0 # 初始化累加寄存器<br>mov al,ds:[0]  # 赋值给中间寄存器<br>mov ah,0 # 设置高位为0，此时ax为0<br>add dx,ax # 累加<br>...<br>mov ax,4c00h<br>int 21h<br></code></pre></td></tr></table></figure><p>$sum =\sum\limits_{X=0}^{0bh}(ffffh*10h+X)$</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># 优化:使用循环，偏移地址应该递增<br>asume cs:code<br>code segment<br>mov ax,0ffffh<br>mov ds,ax<br>mov bx,0<br><br>mov dx,0<br><br>mov cx,12<br><br>s:mov al,[bx]<br>mov ah,0<br>add dx,ax<br>int bx<br>loop s<br>mov ax,4c00h<br>int 21h<br>code ends<br>end<br><br></code></pre></td></tr></table></figure><h5 id="段前缀"><a href="#段前缀" class="headerlink" title="段前缀"></a>段前缀</h5><p>ds就是段地址，也称为段前缀，<font color=red>ds是默认的段前缀</font>，其他还有cs，es等</p><h5 id="一段安全的空间"><a href="#一段安全的空间" class="headerlink" title="一段安全的空间"></a>一段安全的空间</h5><p>在PC中，0:200到0:2ff是安全的空间</p><p>段前缀的使用</p><p>在不同的段中操作时，一个ds需要多次更改，可能需要多个段寄存器，例如用es替代。效果更好</p><h1 id="第六章，包含多个段的程序"><a href="#第六章，包含多个段的程序" class="headerlink" title="第六章，包含多个段的程序"></a>第六章，包含多个段的程序</h1><h5 id="代码段中使用数据"><a href="#代码段中使用数据" class="headerlink" title="代码段中使用数据"></a>代码段中使用数据</h5><p>dw 0123h,0456h 定义字符型数据</p><p>db 45h,78h 定义字节型数据</p><p>当上面定义在cs中时，数据段地址就是代码段的段地址</p><p>dw在第一行定义，数据地址偏移为0,2,4,6….</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment <br>dw 0123h,0456h,0789h<br>start:mov bx,0<br>mov ax,0<br>mov cx,0<br>s:add ax,cs:[bx]<br>add bx 2<br>loop s<br>mov ax 4c00h<br>int 21h<br>code ends<br>end start<br># cup读指令的时候会从start开始，若不添加start，应为dw的存在，存放的是数据，无法转化为机器指令，程序无法执行<br># end的作用：通知编译器程序结束，告诉编译器程序入口在哪里，当不指定入口时，会按照上到下执行，因此若现定义数据，会把数据当做指令执行<br></code></pre></td></tr></table></figure><h5 id="代码段中使用栈"><a href="#代码段中使用栈" class="headerlink" title="代码段中使用栈"></a>代码段中使用栈</h5><p>问题：将上面程序中的数据逆序存放</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code:segment<br>dw 0123h,0456h,0789h<br>dw 0,0,0 # 定义数据当做栈空间<br><br>start :mov ax,cs<br>mov ss,ax   # 指定栈段<br>mov sp,32# 指定栈偏移，栈指针，操作时指针自动变<br>mov bx,0<br>mov cx,3# 循环次数<br><br>s:push cs:[bx] # 入栈数据<br>add bx,2<br>loop s<br><br>mov bx,0<br>mov cx,3<br><br>s0:pop cs:[bx]<br>add bx,2<br>loop s0<br><br>mov 4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h5 id="将数据，代码，栈放入不同的段"><a href="#将数据，代码，栈放入不同的段" class="headerlink" title="将数据，代码，栈放入不同的段"></a>将数据，代码，栈放入不同的段</h5><p>上面的逆序排放</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code,ds:data,ss:stack<br>data segment<br>dw 0123h,0456h,0789h<br>data ends<br>stack segment<br>dw 0,0,0<br>stack ends<br>code segment<br>start:mov ax,stack  # cs,ss,da 系统加载程序时会有系统指定加载的位置，cs 确定后，ds应该就是cs-2，ss=cs-1<br>  mov ss,ax<br>  mov sp,6  # 指定栈指针<br>  mov ax,data <br>  mov ds,ax # 数据段地址<br>  <br>  mov bx,0<br>  mov cx,3<br>  <br>  s:pop [bx]<br>  add bx,2<br>  loop s<br>  <br>  mov bx,0<br>  mov cs,8<br>  s0:pull [bx]<br>  add bx,2<br>  loop s0<br>  <br>  mov ax,4c00h<br>  int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h1 id="第七站，更灵活的定位内存地址的方法"><a href="#第七站，更灵活的定位内存地址的方法" class="headerlink" title="第七站，更灵活的定位内存地址的方法"></a>第七站，更灵活的定位内存地址的方法</h1><h5 id="and和or指令"><a href="#and和or指令" class="headerlink" title="and和or指令"></a>and和or指令</h5><ul><li>and<ul><li>两个都是1为1，其他是0 ，add al 10100010B</li><li>可以把寄存器某一位设置为0：and al,10111111B</li></ul></li><li>or<ul><li>有一个1就为1</li><li>使得寄存器某一位为1：or al,00000100B</li></ul></li></ul><h5 id="关于ASCII"><a href="#关于ASCII" class="headerlink" title="关于ASCII"></a>关于ASCII</h5><p>键盘按下a键：键盘产生61h，放入内存空间，编辑器软件从指定内存读取，送到显存中</p><h5 id="以字符形式给出的数据"><a href="#以字符形式给出的数据" class="headerlink" title="以字符形式给出的数据"></a>以字符形式给出的数据</h5><p>‘….’指明数据是以字符形式给出，编译器会转化为ASCII</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume ds:data<br>data segment<br>db &#x27;unix&#x27;  # db 75H,6EH,49H,58H<br>db &#x27;fork&#x27; # ...<br>data ends<br>code segment<br>start:mov al,&#x27;a&#x27; # mov al,61h<br>mov b1,&#x27;b&#x27;<br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h5 id="大小写转化问题"><a href="#大小写转化问题" class="headerlink" title="大小写转化问题"></a>大小写转化问题</h5><p>A：65，a：97</p><p>大写：第五位为0</p><p>小写：第五位为1</p><p>and 小写,11011111b</p><p>or   大写,00100000b</p><h5 id="bx-idata"><a href="#bx-idata" class="headerlink" title="[bx+idata]"></a>[bx+idata]</h5><p>mov ax,[bx+200]:将地址内数据放入ax，这个地址是bx中的值+200</p><p>mov ax,200[bx]    mov ax,[bx].200 </p><h5 id="用-bx-idata-方式进行数组的处理"><a href="#用-bx-idata-方式进行数组的处理" class="headerlink" title="用[bx+idata]方式进行数组的处理"></a>用[bx+idata]方式进行数组的处理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code,ds:data<br>data segment<br>db &#x27;BaSiC&#x27;<br>db &#x27;MinIX&#x27;<br>data ends<br><br>code segment<br>start:mov as,data<br>mov ds,ax<br>mov bx,0<br><br>mov cx,5<br>s:mov al,[bx]<br>and al,11011111b<br>mov [bx],al<br><br>mov al,[5+bx]   # 5[bx]<br>or al,00100000b<br>mov [5+bx],al<br><br>inc bx<br>loop s<br><br>code ends<br>end start<br></code></pre></td></tr></table></figure><h5 id="SI和DI"><a href="#SI和DI" class="headerlink" title="SI和DI"></a>SI和DI</h5><p>与bx类似的功能，但不能分为2个8位的使用，</p><p>bx不够用的问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs assembly"># 将数据复制到后边地址<br># ds:si 指向原数据<br># ds:di 指向目的地址<br>assume cs:code,ds:data<br>data segment<br>db &#x27;welcome to masm!&#x27;<br>db &#x27;...............&#x27;<br>data ends<br><br>code segment<br>start:mov ax,data<br>mov ds,ax<br>mov si,0<br>mov di,16<br>mov cs,8<br>s:mov ax,[si]<br>mov [di],ax<br>add si,2<br>add di,2<br>loop s<br><br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h5 id="bx-si-和-bx-di"><a href="#bx-si-和-bx-di" class="headerlink" title="[bx+si]和[bx+di]"></a>[bx+si]和[bx+di]</h5><p>两个功能类似</p><p>[bx+si] 表示一个内存单元，偏移地址为bx值+si值</p><h5 id="bx-si-idata-和-bx-di-idata"><a href="#bx-si-idata-和-bx-di-idata" class="headerlink" title="[bx+si+idata]和[bx+di+idata]"></a>[bx+si+idata]和[bx+di+idata]</h5><p>表示内存单元，偏移地址，</p><h5 id="不同寻址方式的灵活应用"><a href="#不同寻址方式的灵活应用" class="headerlink" title="不同寻址方式的灵活应用"></a>不同寻址方式的灵活应用</h5><ul><li>ds:[idata]     </li><li>[bx]</li><li>[bx+idata]</li><li>[bx+si]</li><li>[bx+si+idata]</li></ul><p>例：将数据段单词，开头变为大写</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code,ds:data<br>data segment<br>db &#x27;1.file    &#x27;<br>db &#x27;2.editable&#x27;<br>db &#x27;3.help    &#x27;<br>data ends<br>code segment<br>start:mov ax,data<br>mov ds,ax<br>mov bx,0<br><br>mov cx,3<br>s:mov al,[bx+2] # 把第二个字母放入al<br> add al,11011111b  # 修改字母，变为大写<br>mov [bx+3],al # 放回<br>add bx,10<br>loop s<br>mov ax,4c00h<br>int 21h<br>code ends<br>end start<br></code></pre></td></tr></table></figure><p>对于多层循环，需要其它寄存器记下外层cx的值，内层循环结束后恢复，不然会遇到死循环</p><p><font color=red>当寄存器不够时，需要使用内存了</font>,如使用栈，每层cx入栈 push cx，结束时出栈pop cx</p><h1 id="数据处理的基本问题"><a href="#数据处理的基本问题" class="headerlink" title="数据处理的基本问题"></a>数据处理的基本问题</h1><h5 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h5><ul><li><p>处理的数据在哪里</p></li><li><p>处理的数据有多少，多长</p></li></ul><p>寄存器：ax,bx,cx,dx    ah,al,bh,bj,ch,cl,dh,dl</p><p>sp（栈指针）,bp,  si（原数据地址）,di（目的数据地址）</p><p>段寄存器：ds（数据段），ss（栈段），cs（代码段），es（扩展段）</p><h5 id="bx-si-di-bp"><a href="#bx-si-di-bp" class="headerlink" title="bx,si,di,bp"></a>bx,si,di,bp</h5><ul><li>8086可以用[…]表达内存地址的寄存器：bx bp si di，[ax]是错误的</li><li>这几种不能任意组合<ul><li>bx，si</li><li>bx，di</li><li>bp，si</li><li>bp，di</li><li>其他的组合是错误的，例如：mov ax,[bp+si]</li></ul></li><li>在[…]使用bp，时段地址是ss，即bp就像是sp</li></ul><h5 id="机器指令处理的数据所在位置"><a href="#机器指令处理的数据所在位置" class="headerlink" title="机器指令处理的数据所在位置"></a>机器指令处理的数据所在位置</h5><p>指令执行前，数据所在位置：CUP,内存，端口</p><h5 id="汇编中数据位置的表达"><a href="#汇编中数据位置的表达" class="headerlink" title="汇编中数据位置的表达"></a>汇编中数据位置的表达</h5><ul><li><p>立即数：直接包含在机器指令中的数据，存在于指令缓冲区:mov ax,1 :b80100</p><ul><li>B8表示移动立即数到ax</li><li>指令寄存器：<ul><li>就是cpu读取一条指令</li><li>经过数据总线条指令存出入指令缓冲器</li><li>读取该指令要操作的数据，放入地址加法器</li><li>数据放入目的地址</li></ul></li></ul></li><li><p>寄存器 mov ax,bx:89D8</p></li><li><p>段地址和偏移地址</p><ul><li>mov ax,ds:[bp] 强制改变段地址</li></ul></li></ul><h5 id="寻址方式"><a href="#寻址方式" class="headerlink" title="寻址方式"></a>寻址方式</h5><p><img src="https://i.loli.net/2020/08/08/CTXy2hvfwgcbYP7.png" alt="image-20200808154051203"></p><h5 id="指令要处理的数据有多长"><a href="#指令要处理的数据有多长" class="headerlink" title="指令要处理的数据有多长"></a>指令要处理的数据有多长</h5><p>8086可操作byte，word，在机器指令中需要指明进行操作的是字符还是字节</p><ul><li>通过寄存器指名要处理的数据<ul><li>mov ax,bx</li></ul></li><li>X ptr指明内存长度<ul><li>mov word ptr ds:[0],1</li><li>inc word ptr [bx]</li><li>inc word ptr ds:[0]</li><li>add word ptr [bx],2</li><li>mov byte ptr ds:[0],1</li><li>等等，</li></ul></li><li>其他<ul><li>栈指令，操作时，默认都是按照字符操作</li></ul></li></ul><h5 id="寻址方式的总和应用"><a href="#寻址方式的总和应用" class="headerlink" title="寻址方式的总和应用"></a>寻址方式的总和应用</h5><ul><li>字符串在内存中就是数组</li><li>一般用[bx+idata+si]访问结构体<ul><li>bx表示结构体</li><li>idata表示某一个数据项</li><li>si表示数据项中每个元素</li><li>student.name[i]</li></ul></li></ul><h5 id="divide指令"><a href="#divide指令" class="headerlink" title="divide指令"></a>divide指令</h5><ul><li>除数：8位，16位，寄存器，内存都可以</li><li>被除数：默认ax，dx与ax<ul><li>除数8位，被除数16位（dx）</li><li>除数16位，被除数应该是32位（dx+ax）</li></ul></li><li>指令格式<ul><li>div 寄存器</li><li>div 内存单元<ul><li>div byte ptr ds:[0]<ul><li> al = ax/0地址的商</li><li>ah = ax/0地址余数</li></ul></li><li>div word ptr es:[0]<ul><li>ax = [(dx)*10000H+(ax)]/((ds)*16+0)的商</li><li>dx = [(dx)*10000H+(ax)]/((ds)*16+0)的余数</li></ul></li><li>div byte ptr [bx+si+8]<ul><li>al = (ax)/((ds)*16+bx+si+8)的商</li><li>ah = (ax)/((ds)*16+bx+si+8)的余数</li></ul></li><li>div word ptr [bx+si+8]<ul><li>ax = [dx*10000h+ax]/(ds*16+bx+si+8)的商</li><li>dx = [dx*10000h+ax]/(ds*16+bx+si+8)的余数</li></ul></li><li>最后结果覆盖原来被除数的位置</li></ul></li></ul></li></ul><h5 id="伪指令dd"><a href="#伪指令dd" class="headerlink" title="伪指令dd"></a>伪指令dd</h5><ul><li><p>定义dword，即double word</p></li><li><p>```assembly<br>data segment<br>db 1 # 01H<br>dw 1 # 0001H<br>dd 1 # 00000001H<br>data ends</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br>##### dup<br><br>- 同<span class="hljs-built_in">dw</span>,<span class="hljs-built_in">dd</span>,<span class="hljs-built_in">db</span>一样有编译器识别处理的符号，用来数据重复<br><br>- <span class="hljs-string">```</span>assembly<br>  <span class="hljs-built_in">db</span> <span class="hljs-number">3</span> dup(<span class="hljs-number">0</span>) # 定义了<span class="hljs-number">3</span>个字节<span class="hljs-number">0</span><br>  <span class="hljs-built_in">db</span> <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span><br>  <span class="hljs-built_in">db</span> <span class="hljs-number">3</span> dup(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br>  <span class="hljs-built_in">db</span> <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span><br>  <span class="hljs-built_in">db</span> <span class="hljs-number">2</span> dup(<span class="hljs-string">&#x27;abc,&#x27;</span>ABC)<br>  <span class="hljs-built_in">db</span> <span class="hljs-string">&#x27;abcABCabcABC&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">stack segment<br>dw 0,0,0,0,0,0...<br>stack ends<br>stack segment<br>db 200 dup(0)<br>stack ends<br></code></pre></td></tr></table></figure></li></ul><h1 id="第九章，转移指令的原理"><a href="#第九章，转移指令的原理" class="headerlink" title="第九章，转移指令的原理"></a>第九章，转移指令的原理</h1><p>8086CPU转移指令分类</p><ul><li>无条件转移指令 例jmp</li><li>条件转移指令</li><li>循环指令 例loop</li><li>过程</li><li>中断</li></ul><h5 id="操作符offset"><a href="#操作符offset" class="headerlink" title="操作符offset"></a>操作符offset</h5><p>由编译器处理的符号，取得标号的偏移地址吗，就标号所在地址</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">assume cs:code<br>code segment<br>start:mov ax.offset start  # 相当于mov ax,0<br>s:mov ax,offset s # 相当于mov ax,3<br>code ends<br>end start<br></code></pre></td></tr></table></figure><h5 id="jmp指令"><a href="#jmp指令" class="headerlink" title="jmp指令"></a>jmp指令</h5><ul><li>cs，ip<ul><li>可以只修改ip</li><li>也可以修改cs</li></ul></li><li>转移要求<ul><li>目的地址</li><li>转移的距离 （-128—-》127）段内跳转 <ul><li>jmp start  标号</li></ul></li></ul></li></ul><h5 id="依据位移进行jmp指令"><a href="#依据位移进行jmp指令" class="headerlink" title="依据位移进行jmp指令"></a>依据位移进行jmp指令</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movax,0123 # B8 23 01<br>mov as,ds:[0123]# A1 23 01<br>push ds:[0123]# FF 36 23 01<br></code></pre></td></tr></table></figure><p>jmp指令对应的机器码中没有目的地址，是相对于jmp所在指令的偏移</p><ul><li>jmp near ptr 标号 实现段内近转移：<ul><li>IP=IP+16位位移</li><li>near ptr 指明此处为16位位移，进行的是段内近转移</li><li>16位位移 = 标号处地址减去jmp指令后第一个字节地址</li></ul></li></ul><h5 id="转移的目的地址在指令中的jmp指令"><a href="#转移的目的地址在指令中的jmp指令" class="headerlink" title="转移的目的地址在指令中的jmp指令"></a>转移的目的地址在指令中的jmp指令</h5><ul><li>偏移地址是实际的地址</li><li><font color=red>段间转移，远转移</font></li><li>jmp fat ptr 标号：修改了cs:ip     —-&gt;EAXXXXYYYY</li></ul><h5 id="转移地址在寄存器中的jmp指令"><a href="#转移地址在寄存器中的jmp指令" class="headerlink" title="转移地址在寄存器中的jmp指令"></a>转移地址在寄存器中的jmp指令</h5><p>jmp 16位寄存器</p><p>jmp ax</p><h5 id="转移地址在内存中的jmp指令"><a href="#转移地址在内存中的jmp指令" class="headerlink" title="转移地址在内存中的jmp指令"></a>转移地址在内存中的jmp指令</h5><ul><li>jmp word ptr 内存</li><li>jmp dword ptr 内存，段之间转移，32位 高16位cs，低16位ip</li></ul><h5 id="jcxz指令"><a href="#jcxz指令" class="headerlink" title="jcxz指令"></a>jcxz指令</h5><ul><li>有条件转移</li><li>（-128–127）</li><li>机器码包含位移，而不是目的地址</li><li>jcxz 标号，<ul><li>cx=0 跳转，否则不跳转，向下执行</li><li>ip = ip+8位移<ul><li>负数用补码表示</li><li>有编译时编译器算出</li></ul></li></ul></li></ul><h5 id="loop指令"><a href="#loop指令" class="headerlink" title="loop指令"></a>loop指令</h5><ul><li>位移而不是目的地址</li><li>-128–127</li><li>与cx配合</li><li>都是编译器指令</li></ul><h5 id="根据位移进行转移的意义"><a href="#根据位移进行转移的意义" class="headerlink" title="根据位移进行转移的意义"></a>根据位移进行转移的意义</h5><p>使用位移可使程序在内存中任意位置调用</p><h5 id="编译器对转移位移超界的检测"><a href="#编译器对转移位移超界的检测" class="headerlink" title="编译器对转移位移超界的检测"></a>编译器对转移位移超界的检测</h5><p>编译时编译器会报错</p><h5 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h5><p>显存地址：B8000H-BFFFFH dos系统的显存地址</p><h1 id="第十章，Call和Ret指令"><a href="#第十章，Call和Ret指令" class="headerlink" title="第十章，Call和Ret指令"></a>第十章，Call和Ret指令</h1><p>都是修改cs，ip </p><h5 id="ret与retf"><a href="#ret与retf" class="headerlink" title="ret与retf"></a>ret与retf</h5><ul><li>ret使用栈中的数据，修改ip实现近转移</li><li>cpu执行ret时<ul><li>ip=ss*16+sp</li><li>sp=sp+2</li></ul></li><li>cpu执行retf时<ul><li>ip=ss*16+sp</li><li>sp=sp+2</li><li>cs=ss*16+sp</li><li>sp=sp+2</li></ul></li><li>ret执行后 ip=0，cs：ip指向代码段第一条指令</li><li>retf执行后，cs：ip指向代码段第一条指令</li></ul><h5 id="call"><a href="#call" class="headerlink" title="call"></a>call</h5><ul><li>与ret配合使用<ul><li>将ip，或cs，ip入栈</li><li>转移（jmp）</li></ul></li><li>不能短转移</li></ul><h5 id="位移转移的call"><a href="#位移转移的call" class="headerlink" title="位移转移的call"></a>位移转移的call</h5><ul><li><p>将当前标号入栈后，转到标号处执行</p><ul><li>sp =sp -2<ul><li>ss*16+sp=ip</li></ul></li><li>ip = ip+16位位移</li></ul></li><li><p>相当于进行push ip，jmp near ptr 标号</p></li></ul><h5 id="直接地址转移的call"><a href="#直接地址转移的call" class="headerlink" title="直接地址转移的call"></a>直接地址转移的call</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">call far ptr 标号<br>sp = sp -2<br>ss*16+sp=cs<br>sp = sp -2<br>ss*16+sp=ip<br><br>cs=标号所在段地址<br>ip=标号所在偏移地址<br></code></pre></td></tr></table></figure><p>相当于push cs，push ip，jmp fat ptr 标号</p><h5 id="寄存器转移的call"><a href="#寄存器转移的call" class="headerlink" title="寄存器转移的call"></a>寄存器转移的call</h5><p>sp =sp -2</p><p>ss *16+sp =ip</p><p>ip=16位寄存器</p><p>相当于push ip,jmp 16位寄存器</p><h5 id="转移地址在内存的call"><a href="#转移地址在内存的call" class="headerlink" title="转移地址在内存的call"></a>转移地址在内存的call</h5><ul><li>call word ptr 内存<ul><li>push ip</li><li>jmp word ptr 内存单元</li></ul></li><li>call dword ptr 内存<ul><li>push cs</li><li>push ip</li><li>jmp dword ptr 内存单元</li></ul></li></ul><h5 id="call与ret的配合使用"><a href="#call与ret的配合使用" class="headerlink" title="call与ret的配合使用"></a>call与ret的配合使用</h5><p>可以使用call与ret配合写子程序，就像是高级语言中的方法，使用call跳转，ret返回</p><h5 id="mul"><a href="#mul" class="headerlink" title="mul"></a>mul</h5><ul><li>乘法指令<ul><li>相乘的2位数位数需要相同</li><li>8位：AL中和8位寄存器或内存单元</li><li>16位：AX中和16位寄存器或内存单元</li></ul></li><li>结果<ul><li>2个8位：放在ax</li><li>2个16位：高位DX,低位AX</li></ul></li><li>mul reg,mul 内存单元<ul><li>mul byte ptr ds:[0]   ==(ax)=(al)*(ds*16+0)</li><li>mul word ptr [bx+si+8]<ul><li>(ax)=(ax)*((ds)*16+(bx)+(si)+8) 低8位</li><li>(dx)=(ax)*((ds)*16+(bx)+(si)+8)  高8位</li></ul></li></ul></li><li>例100*10<ul><li>mov al,100</li><li>mov b1,10</li><li>mul bl</li><li>ax = 1000(03E8H)</li></ul></li><li>100*10000<ul><li>mov ax,100</li><li>mov bx,10000</li><li>mul bx</li><li>ax=4240H</li><li>dx=000FH</li></ul></li></ul><h5 id="模块化程序设计"><a href="#模块化程序设计" class="headerlink" title="模块化程序设计"></a>模块化程序设计</h5><p>如何存储子程序参数，与返回值</p><ul><li><p>子程序计算N的3次方</p><ul><li><p>N存储位置</p><ul><li>寄存器</li></ul></li><li><p>结果存储位置</p><ul><li>dx，ax</li></ul></li><li><p>```assembly<br>bx = N ;型参<br>dx:ax=N^3</p><p>cube:mov ax,bx<br>mul bx<br>mul bx<br>ret</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br>##### 参数和结果传递问题<br><br>用寄存器存储参数与结果最常用的方法<br><br>##### 批量数据传递<br><br>传递的数据多的时候怎么办？使用内存,或者栈，高级语言就是栈<br><br><span class="hljs-string">```</span>assembly<br><span class="hljs-meta">assume</span> <span class="hljs-built_in">cs</span>:code<br>data <span class="hljs-meta">segment</span><br><span class="hljs-built_in">db</span> <span class="hljs-string">&#x27;conversation&#x27;</span><br>data ends<br>code <span class="hljs-meta">segment</span><br><span class="hljs-symbol">start:</span><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,data<br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">si</span>,<span class="hljs-number">0</span><span class="hljs-comment">;ds:si指向字符串所在空间首地址</span><br><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span>,<span class="hljs-number">12</span><span class="hljs-comment">;cx存放字符串长度</span><br><span class="hljs-keyword">call</span> capital<br><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">4c00h</span><br><span class="hljs-keyword">int</span> <span class="hljs-number">21h</span><br><span class="hljs-symbol">capital:</span><span class="hljs-keyword">and</span> <span class="hljs-built_in">byte</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">si</span>]:<span class="hljs-number">11011111b</span><br><span class="hljs-keyword">inc</span> <span class="hljs-built_in">si</span><br><span class="hljs-keyword">loop</span> capital<br><span class="hljs-keyword">ret</span><br>code ends<br>end start<br></code></pre></td></tr></table></figure></li></ul></li></ul><h5 id="寄存器冲突"><a href="#寄存器冲突" class="headerlink" title="寄存器冲突"></a>寄存器冲突</h5><p>上面的程序，当不知道字符串长度时，如何做</p><p>db ‘conversation’,’0’</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">capital:mov cl,[si]<br>mov ch,0<br>jcxz ok;若果cx=0,结束，若不是，接着处理<br>and byte ptr [si],11011111b<br>inc si<br>jmp short capital<br>ok:ret<br><br></code></pre></td></tr></table></figure><h1 id="第十一章，标志寄存器"><a href="#第十一章，标志寄存器" class="headerlink" title="第十一章，标志寄存器"></a>第十一章，标志寄存器</h1><h5 id="引言-1"><a href="#引言-1" class="headerlink" title="引言"></a>引言</h5><p><font color=red>计算机中的数据可以看做是有符号数，也可以是无符号数</font></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">00000001B</span> # 可看做无符号数<span class="hljs-number">1</span>，或有符号数+<span class="hljs-number">1</span><br><span class="hljs-attribute">10000001B</span> # 可看做无符号数<span class="hljs-number">129</span>，或有符号数-<span class="hljs-number">127</span><br></code></pre></td></tr></table></figure><p>flag标志寄存器与其它不同，其他是用来存放数据的，flag是按位起作用</p><p><img src="https://i.loli.net/2020/08/14/iNHkBbZIwnDoz9Y.png" alt="image-20200814142743401"></p><p><img src="https://i.loli.net/2020/08/14/wHo1yItCRslgEup.png" alt="image-20200814163851014"></p><p> 1,3,5,12,13,14,15在8086中没有使用</p><h5 id="ZF，零标志位"><a href="#ZF，零标志位" class="headerlink" title="ZF，零标志位"></a>ZF，零标志位</h5><ul><li>上一条指令结果为0，此时标志位ZF=1<ul><li>mov ax,1</li><li>sub ax,1</li><li>此时ax=0</li></ul></li><li>否则ZF=0 <ul><li>mov ax,2</li><li>sub ax,1</li><li>ax=1 </li></ul></li><li>add,sub,mul，inc 等等都是运算指令，mov push等都是传送指令</li></ul><h5 id="PF，奇偶标志位"><a href="#PF，奇偶标志位" class="headerlink" title="PF，奇偶标志位"></a>PF，奇偶标志位</h5><ul><li>指令执行后，结果中所有二进制中1的个数<ul><li>偶数，PF=1</li><li>奇数，PF=0 </li></ul></li></ul><h5 id="SF，符号标志位"><a href="#SF，符号标志位" class="headerlink" title="SF，符号标志位"></a>SF，符号标志位</h5><ul><li><p>指令执行后结果的正负情况</p></li><li><p>SF=1，结果为负</p></li><li><p>SF=0，结果为正</p></li><li><p>```assembly<br>mov al,10000001B<br>add al,1<br>;结果 al=100000010B<br>;有符号位 -12 6<br>;无符号位 130<br>;所以说该指令包含结果有2个</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br>  - SF标志，就是<span class="hljs-meta">CPU</span>对有符号数运算结果的一种记录，它记录数据正负，<span class="hljs-meta">Cpu</span>会影响SF标志位，但<span class="hljs-meta">Cpu</span>并不识别数据有无符号<br><br>- 但我们把数据当做无符号数，SF则无实际作用<br><br>  - <span class="hljs-string">```</span>assembly<br>    <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">10000001B</span><br>    <span class="hljs-keyword">add</span> <span class="hljs-built_in">al</span>,<span class="hljs-number">1</span><br>    <span class="hljs-comment">;结果为10000010B，SF=1</span><br>    <span class="hljs-comment">;如果指令是进行有符号运算，那么结果为负数，否则不用处理</span><br>    <span class="hljs-comment">;注意没有-0的说法，只有+0</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="CF，进位标志位"><a href="#CF，进位标志位" class="headerlink" title="CF，进位标志位"></a>CF，进位标志位</h5><p> 存储上一条指令执行后是否有数据进位,或借位（减 法）</p><ul><li>有进位 CF=CY=1</li><li>无进位 CF=NC=0</li></ul><p>减法</p><ul><li>97H-98H 在计算机中就是</li><li>197H-98H = FF，CY=1</li></ul><h5 id="OF，溢出标志位"><a href="#OF，溢出标志位" class="headerlink" title="OF，溢出标志位"></a>OF，溢出标志位</h5><p>超出了机器的范围 </p><ul><li>溢出是针对有符号位，正+正边负</li><li>进位是相对于无符号位，例如8位边9位</li><li>溢出时OF=OV=1</li></ul><p><font color=red>对于cpu的计算结果，若做有符号位观察，OF,SF，若看作无符号位观察CF</font></p><p><font color=red>总之，cpu计算时，不管有无符号，adc指令：结合符号位获取正确值</font></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ax,98d ; 0110 0010<br>add ax,99d ; 0110 0011<br><br>;1100 0101  C5 SF=1,OF=1,CF=0<br>;当做无符号位相加，C5<br>;当有符号位，首位为1，SF=1表示是负数，是-59的补码，<br></code></pre></td></tr></table></figure><h5 id="adc指令"><a href="#adc指令" class="headerlink" title="adc指令"></a>adc指令</h5><p>带进位加法指令，利用CF位记录值</p><p>adc ax,bx       ax = ax+bx+CF</p><p>add,配合adc可以解决这些问题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;1EF000h+201000h 高16位ax，低16位bx<br>mov ax,001EH<br>mov bx,0f000H<br>add bx,1000H ; 0000H cf=1<br>adc ax,0020H ; <br></code></pre></td></tr></table></figure><p>adc执行后也会可能产生进位</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;1E F000 1000h+ 20 1000 1EF0h 高位16ax，次高位16bx，cx低16位<br>;思路 低16位相加，然后次16位adc，高16位adc<br>mov ax,001EH<br>mov bx,0f000H<br>mov cx,1000H<br><br>add cx,1ef0h<br>adc bx,1000h<br>adc ax,0020h<br></code></pre></td></tr></table></figure><p>更大的数据可以放在栈或内存中</p><h5 id="sbb指令"><a href="#sbb指令" class="headerlink" title="sbb指令"></a>sbb指令</h5><p>带位减法指令</p><p>sbb ax,bx = &gt; ax= ax-bx-cf</p><p>与加法类似</p><h5 id="cmp指令"><a href="#cmp指令" class="headerlink" title="cmp指令"></a>cmp指令</h5><p>相当于减法指令，但不保存结果，仅仅对标志位进行设置</p><p>cmp ax,ax ===&gt;  此时ax不变，仅影响flag —》ZF=1,PF=1,SF=0,CF=0,OF=0</p><p><img src="https://i.loli.net/2020/08/14/NMzltF7Gkr5pguy.png" alt="image-20200814182305437"></p><p>有符号位比较</p><p>ZF</p><p>需要考虑OF,SF</p><ul><li>OF=0,SF=1 AH&lt;BH</li><li> OF=1,SF=1 AH&gt;BH</li><li>SF=0,OF=1 AH&lt;BH</li><li>OF=0,SF=0 AH&gt;BH</li></ul><h5 id="检测比较结果的条件转移指令"><a href="#检测比较结果的条件转移指令" class="headerlink" title="检测比较结果的条件转移指令"></a>检测比较结果的条件转移指令</h5><p>与cmp配合</p><p><img src="https://i.loli.net/2020/08/14/QZepGlMS7IxP26a.png" alt="image-20200814233016395"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">cmp ah,bh<br>je s<br>add ah,bh<br>jmp short ok<br>s:add ah,ah<br>ok:ret<br></code></pre></td></tr></table></figure><h5 id="DF标志和串传送指令"><a href="#DF标志和串传送指令" class="headerlink" title="DF标志和串传送指令"></a>DF标志和串传送指令</h5><ul><li><p>flag第10位，方向标志位</p></li><li><p>在串指令中，控制每次操作后si，di增减</p></li><li><p>DF=0,每次操作后递增</p></li><li><p>DF=1递减</p></li><li><p>movsb:以字节为单位传递，将ds:si指向的内存中的数据送入es:di</p><ul><li>es*16+di=ds*16+si</li><li>若DF=0,SI=SI+1,DI=DI+1</li><li>若DF=1;SI=SI-1,DI=DI-1</li></ul></li><li><p>movsw 以字为单位传送，即16位，si，di每次加减2</p></li><li><p>movsb,movsw与rep配合</p><ul><li>rep movsb ，根据cx的值重复n次</li></ul></li><li><p><font color=red>cld:设置DF=0,std设置DF=1</font></p></li><li><p>```assembly<br>assume cd:code<br>data segment<br>db ‘welcome to masm!’<br>db 16 dup(0)<br>data ends<br>code segment<br>start:mov cx,16</p><div class="code-wrapper"><pre><code class="hljs">cld;mov ax datamov ds,axmov si,0mov di,16mov es,axrep movsbmov ax,4c00hint 21h</code></pre></div><p>code ends<br>end start</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs x86asm"><br>##### <span class="hljs-keyword">pushf</span>和<span class="hljs-keyword">popf</span><br><span class="hljs-symbol"></span><br><span class="hljs-symbol">pushf:</span>将标志寄存器的值压入栈中<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">popf:</span>弹出到标志寄存器，出栈<br><br># 第十二章，内中断<br><br>##### 内中断的产生<br><br>外部中断：外部设备<br><br>内部中断：内部错误<br><br>软件中断，<span class="hljs-keyword">int</span> <span class="hljs-number">21h</span>等<br><br><span class="hljs-meta">CPU</span>中断优先权：<br><br>- 除法错误，溢出中断，软件中断<br>- 不可屏蔽中断<br>- 可屏蔽中断<br>- 单步中断<br><br>##### 中断处理程序<br><br>内存中有中断处理程序<br><br>##### 中断向量表<br><br>- 形式：序号 中断程序地址<br>- 地址用8bit，所以一共<span class="hljs-number">256</span>个中断程序<br><br>- <span class="hljs-keyword">int</span> 序号 就会调用中断处理程序<br>- 对于8086CUP，中断程序地址存放位置<span class="hljs-number">0000</span>：<span class="hljs-number">0000</span>---》<span class="hljs-number">0000</span>：03FF，段地址16bit，偏移地址16bit，<span class="hljs-number">32</span>\*<span class="hljs-number">256</span><br>- <span class="hljs-number">8086</span>中<span class="hljs-number">0</span>:<span class="hljs-number">200</span>-<span class="hljs-number">0</span>:<span class="hljs-number">300</span>安全的地址，因为并不是<span class="hljs-number">256</span>个程序都要用<br><br>##### 中断过程<br><br>找到中断程序地址，<span class="hljs-meta">CPU</span>设置<span class="hljs-built_in">cs</span>，<span class="hljs-built_in">ip</span>该过程为中断过程<br><br>中断过程：<br><br>- 取得中断类型码<br>- 标志寄存器入栈<br>- 设置标志寄存器的第八位TF,第九位IF为<span class="hljs-number">0</span><br>- <span class="hljs-built_in">CS</span>,<span class="hljs-built_in">IP</span>入栈<br>- 读入<span class="hljs-built_in">cs</span>，<span class="hljs-built_in">ip</span><br><br>##### 中断处理程序<br><br>- 保存用到的寄存器<br>- 处理中断<br>- 恢复寄存器<br>- 用<span class="hljs-keyword">iret</span>指令返回<br><br><span class="hljs-keyword">iret</span>：<span class="hljs-keyword">pop</span> <span class="hljs-built_in">ip</span>；<span class="hljs-keyword">pop</span> <span class="hljs-built_in">cs</span>；<span class="hljs-keyword">popf</span><br><br><span class="hljs-keyword">iret</span>和硬件自动完成中断过程配合使用<br><br>##### 除法错误中断处理<br><br>##### 编程处理<span class="hljs-number">0</span>号中断<br><br>发生除法溢出时，即结果比寄存器范围大，<span class="hljs-meta">Cpu</span>将转换为处理中断程序<br><br>中断向量表中该错误终端地址为<span class="hljs-number">0</span>号地址<br><br>可以自定义中断程序，修改中断向量表，此时会执行自己的中断程序<br><br><span class="hljs-string">```</span>assembly<br><span class="hljs-meta">assume</span> <span class="hljs-built_in">cs</span>:code<br>code <span class="hljs-meta">segment</span><br><span class="hljs-symbol">start:</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-built_in">cs</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ds</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">si</span>,offset do0<span class="hljs-comment">;设置自定义终端程序位置</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">0</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">es</span>,<span class="hljs-built_in">ax</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">di</span>,<span class="hljs-number">200h</span><span class="hljs-comment">;设置es:di位置</span><br><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">cx</span> offset do0end- offset do0<br><span class="hljs-keyword">cld</span> <span class="hljs-keyword">rep</span> <span class="hljs-keyword">movsb</span> <span class="hljs-comment">;中断程序写入内存</span><br><span class="hljs-comment">;设置中断向量表</span><br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">4c00h</span><br><span class="hljs-keyword">int</span> <span class="hljs-number">21h</span><br><span class="hljs-symbol">do0:</span><br>xxxxx<br><span class="hljs-keyword">mov</span> <span class="hljs-built_in">ax</span>,<span class="hljs-number">4c00h</span><br><span class="hljs-keyword">int</span> <span class="hljs-number">21h</span><br><span class="hljs-symbol">do0end:</span><span class="hljs-keyword">nop</span> <span class="hljs-comment">;占一个字节，无作用</span><br>code ends<br>end start<br></code></pre></td></tr></table></figure></li></ul><h5 id="单步中断"><a href="#单步中断" class="headerlink" title="单步中断"></a>单步中断</h5><p>CPU在执行一条指令后检测到TF=1，就会引发中断过程</p><p>单步中断的类型码为1，debug就是改变了1号中断的程序，改为debug的程序</p><h5 id="响应中断的特殊情况"><a href="#响应中断的特殊情况" class="headerlink" title="响应中断的特殊情况"></a>响应中断的特殊情况</h5><p>有时候遇到中断信号CPU也不会响应，</p><p>例如：</p><ul><li>SS:SP的设置过程，ss，sp需要同时改变，因此不能被中断<ul><li>mov设置ss：sp时也要连续</li></ul></li></ul><h1 id="第十三章，int指令"><a href="#第十三章，int指令" class="headerlink" title="第十三章，int指令"></a>第十三章，int指令</h1><h5 id="int指令"><a href="#int指令" class="headerlink" title="int指令"></a>int指令</h5><p>与call类似，int调用中断程序</p><h5 id="对int-iret与栈的深入理解"><a href="#对int-iret与栈的深入理解" class="headerlink" title="对int,iret与栈的深入理解"></a>对int,iret与栈的深入理解</h5><h5 id="BIOS与dos中断例程的安装"><a href="#BIOS与dos中断例程的安装" class="headerlink" title="BIOS与dos中断例程的安装"></a>BIOS与dos中断例程的安装</h5><ul><li>开机后CS:0FFFFH,IP=0, 该位置有一条跳转指令，执行后专区bios的硬件检测与初始化程序</li><li>初始化程序，将BIOS所支持的中断向量，即Bois提供的中断例程入口记录在中断向量表</li><li>完成后 int 19h进行操作系统的引导，将计算机交给操作系统<ul><li>dos病毒就是改变 int 19h的中断</li></ul></li></ul><h5 id="BIOS中断历程应用"><a href="#BIOS中断历程应用" class="headerlink" title="BIOS中断历程应用"></a>BIOS中断历程应用</h5><ul><li><p>int 10h中断的设置光标位置功能</p><ul><li>10h中包含多个子程序，通过ah，设置子程序的序号</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">mov ah,2 ;2号子程序<br>mov bh,0 ;0页<br>mov dh,5 ;5行<br>mov dl,12 ;12列<br>int 10h<br></code></pre></td></tr></table></figure></li><li><p>int 21h</p><ul><li>程序返回功能<ul><li>mov ah 4ch # 序号，程序返回的功能</li><li>mov al,0  # 返回值</li><li>int 21h</li></ul></li><li>光标显示字符功能</li></ul></li></ul><h1 id="第十四章，端口"><a href="#第十四章，端口" class="headerlink" title="第十四章，端口"></a>第十四章，端口</h1><h5 id="端口的读写"><a href="#端口的读写" class="headerlink" title="端口的读写"></a>端口的读写</h5><ul><li><p>访问内存</p><ul><li>mov ax,ds:[8]</li><li>cpu 通过地址线将地址8信息发出</li><li>cpu控制线发出内存读命令，选中存储器新编，通知他读数据</li><li>存储器将8单元数据通过数据线送入cpu</li></ul></li><li><p>当问端口</p><ul><li>使用in,out</li><li>in al,60h</li><li>地址总线60h发出</li><li>控制线发出端口度命令，端口芯片，通知读数据</li><li>端口芯片通过数据线传入cpu</li><li>8位端口al,16位ax<ul><li>in al，20h 读取20h端口一个字节</li><li>mov dx,3f8h</li><li>in al,dx 读取改端口一个字节</li></ul></li></ul></li></ul><h5 id="CMOS-RAM-芯片"><a href="#CMOS-RAM-芯片" class="headerlink" title="CMOS RAM 芯片"></a>CMOS RAM 芯片</h5><ul><li>包含一个实时钟和128存储单元的RAM</li><li>该芯片靠电池供电，不是电源</li><li>128单元中，内部时钟占用0-0dh，其他保存系统配置信息</li><li>芯片内部有2端口70h,71h，cup通过他们进行读写<ul><li>70h地址端口，要访问的RAM单元地址，</li><li>71h是数据端口，要读取或写入的数据</li><li>例：读取RAM 2号单元<ul><li>2送入 70h</li><li>从71 读取2单元内容</li></ul></li></ul></li></ul><h5 id="shl与shr指令"><a href="#shl与shr指令" class="headerlink" title="shl与shr指令"></a>shl与shr指令</h5><ul><li><p>逻辑移位指令，左移与右移</p></li><li><p>将寄存器或内存单元中数据左移，右移</p></li><li><p>shl</p><ul><li><p>数据左移</p></li><li><p>最后移出的写入CF</p></li><li><p>最低位0补充</p></li><li><p>若移位大于1，移动位数放在cl，不能直接用数字</p></li><li><p>```assembly<br>mov  al,01001000b<br>shl al,1<br>;al = 10010000b</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>- shr 相反的操作<br><br>##### CMOS RAM中存储时间信息<br><br>- 秒<span class="hljs-number">00</span>H,分<span class="hljs-number">02</span>h，时<span class="hljs-number">04</span>h，日<span class="hljs-number">07</span>h，月<span class="hljs-number">08</span>h，年，<span class="hljs-number">09</span>h<br><br>- BCD格式码存放<br>  - 四位<span class="hljs-number">01</span>表示<span class="hljs-number">1</span><span class="hljs-number">-9</span><br>  - <span class="hljs-number">0000</span><span class="hljs-number">-0</span>,<span class="hljs-number">0001</span><span class="hljs-number">-1</span>,<span class="hljs-number">0010</span><span class="hljs-number">-2</span>  ..... <span class="hljs-number">1001</span><span class="hljs-number">-9</span><br>  - 例如<span class="hljs-number">26</span>:<span class="hljs-number">0010</span>  <span class="hljs-number">0110</span><br><br># 第十五章，外中断<br><br>##### 接口芯片和端口<br><br>外设的出入不是直接送入内存，而是相关接口芯片的端口中<br><br>##### 外中断信息<br><br>- 可屏蔽<br>- 不可屏蔽<br>- 需要看IF位，IF=<span class="hljs-number">1</span>，指令执行后中断，否则不中断<br>- sti设置TF=<span class="hljs-number">1</span>,cli <span class="hljs-keyword">if</span>=<span class="hljs-number">0</span><br>- 不可屏蔽类型码固定是<span class="hljs-number">2</span><br>  - 标志位入栈，IF=<span class="hljs-number">0</span>,TF=<span class="hljs-number">0</span>,表示此程序不能被中断<br>  - cs，ip入栈<br>  - ....<br>- 外设几乎都是和屏蔽中断<br><br>##### PC键盘的处理过程<br><br>- 按下一个键<br>- 键盘芯片产生扫描码<br>- ![image<span class="hljs-number">-20200815161038632</span>](https:<span class="hljs-comment">//i.loli.net/2020/08/15/oxVv6yfcUPwMT4n.png)</span><br>- 送入主板接口芯片寄存器，寄存器端口<span class="hljs-number">60</span>h<br>- 松开时也会送入<br>- 到达<span class="hljs-number">60</span>h时，发送int <span class="hljs-number">9</span> 中断<br>- Bios int9中断例程，<br>  - 读取<span class="hljs-number">60</span>h端口扫描码<br>  - 是字符，将扫描码与ascii送入bios键盘缓冲区（因为有些操作在操作系统之前），缓冲区中 一个按键<span class="hljs-number">16</span>位 <span class="hljs-number">8</span>位扫描码，<span class="hljs-number">8</span>位ASCII<br>  - 是控制键，转换为状态字节，写入内存中存储状态的字节单元<br>- cpu检测到，若IF=<span class="hljs-number">1</span>，引发中断去执行int9<br><br>##### 编写int <span class="hljs-number">9</span> 中断例程<br><br>##### 安装新的int <span class="hljs-number">9</span>终端例程<br><br># 第十六章，直接定址表<br><br>##### 描述了单元长度的标号<br><br>```assembly<br>assume cs:<span class="hljs-keyword">code</span><br><span class="hljs-keyword">code</span> segment<br>a:db <span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<br>b:dw <span class="hljs-number">0</span><br>start :mov si,offset a;将a的偏移地址给si<br><span class="hljs-keyword">code</span> ends<br>end start<br>;若标号后边没有“:”他们可以同时描述内存地址与单元长度<br></code></pre></td></tr></table></figure></li></ul></li></ul><h5 id="在其他段中使用数据标号"><a href="#在其他段中使用数据标号" class="headerlink" title="在其他段中使用数据标号"></a>在其他段中使用数据标号</h5><p>有“:”的地址标号只能在代码段使用</p><p>若要使用数据标号访问数据，需要assume 将寄存器与段对应</p><p>例如上面的数据，访问12345678中的1  需要设置ds，si</p><p>若使用a,则mov  ax,[0]即可不用管ds，因为assume ds:data</p><ul><li><p>存储地址</p><ul><li>```assembly<br>data segment<br>a db 1,2,3,4,5,6,7,8<br>b dw 0<br>c dw offset a,seg a,offset b,seg b ;<br>c dd a,b ;32bit存储地址<br>data ends<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs clean"><br>##### 直接定址表<br><br>##### 程序入口地址的直接定址表<br><br># 第十七章，BIOS键盘的输入磁盘读写<br><br>##### int <span class="hljs-number">9</span> 中断对键盘输入的处理<br><br>键盘缓区<span class="hljs-number">15</span>个字单元，存储扫描码，ascii<br><br>##### int <span class="hljs-number">16</span> 读取键盘缓冲区<br><br>```assembly<br>mov ah,<span class="hljs-number">0</span><br>int <span class="hljs-number">16</span>h <br>;从键盘缓冲区读取一个，并删除它<br>; ah=扫描码，al=Ascii<br></code></pre></td></tr></table></figure></li></ul></li></ul><p>int 16h的0号功能</p><ul><li>检测缓冲区是否有数据</li><li>没有继续上一步</li><li>读取缓冲区第一个字</li><li>送入ax</li><li>缓冲区已读取那个字删除</li></ul><p>int  9向缓冲区写数据，int16h读数据，编程接受用户输入时，就是int16h</p><h5 id="字符串的输入"><a href="#字符串的输入" class="headerlink" title="字符串的输入"></a>字符串的输入</h5><ul><li>要求<ul><li>能够输入</li><li>输入时显示</li><li>可以删除</li></ul></li><li>使用栈</li></ul><h5 id="int-13h"><a href="#int-13h" class="headerlink" title="int 13h"></a>int 13h</h5><p>柱面号，磁道号，扇区号</p><p>读取：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">ah = int 13h ;功能号，2表示读取，3表示写入<br>al=读取扇区数<br>ch=磁道号<br>cl=扇区号<br>dh=磁头号<br>dl=驱动号 0：软驱A，1：软驱B   80h：硬盘C，81h：硬盘D<br>ex:bx 向此区域读入数据<br><br>ah=0,al = 读入的扇区数<br>ah=出错代码<br></code></pre></td></tr></table></figure><p>写入同上</p><ul><li>直接写入可能覆盖数据，危险</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/"/>
    <url>/2022/01/16/cnblog/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="梯度下降算法"><a href="#梯度下降算法" class="headerlink" title="梯度下降算法"></a>梯度下降算法</h1><ol><li><h3 id="梯度"><a href="#梯度" class="headerlink" title="梯度"></a>梯度</h3><ol><li>函数上某一点的梯度是 向量，就是函数变化增加最快的地方。具体来说，对于函数f(x,y)，在点(x0，y0)沿着梯度向量的方向  : (df/dx0,df/dy0)的转置. 可以最快速度到达最大值.</li></ol></li><li><h3 id="梯度下降算法-1"><a href="#梯度下降算法-1" class="headerlink" title="梯度下降算法"></a>梯度下降算法</h3><ol><li><p>损失函数:  J(w)</p></li><li><p>w的梯度将是损失函数上升最快的方向,最小化loss ,反向即可 J(w_old) —-&gt;J(w_old- k * ▽w_old的梯度)—-&gt;J(w_new)</p></li><li><p>方法 : 主要区别是每一次更新样本参数使用的样本个数是不同的</p><ol><li><p>批量梯度下降</p><ul><li><p>使用全部数据进行参数更新</p></li><li><p>w = w-k * ▽J(w)</p></li><li><p>```python<br>for i in range(nb_epochs):</p><div class="code-wrapper"><pre><code class="hljs">params_grad = evaluate_gradient(loss_function,data,params)params = params - learning_rate * pramas_grad </code></pre></div><figure class="highlight reasonml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><pre><code class="hljs reasonml"><br>   - 每次更新梯度使用全部数据 ,最后梯度可为<span class="hljs-number">0</span><br><br><span class="hljs-number">2.</span> 随机梯度下降<br><br>   - w = w - k \* ▽ <span class="hljs-constructor">J(<span class="hljs-params">w</span>;<span class="hljs-params">xi</span>;<span class="hljs-params">yi</span>)</span><br><br>   - 使用一个样本更新模型,速度快<br><br>   - ```python<br>     <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nb_epochs):<br>     np.random.shuffle(data)<br>     <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> data:<br>     params_grad = evalute<span class="hljs-constructor">_gradient(<span class="hljs-params">loss_function</span>,<span class="hljs-params">example</span>,<span class="hljs-params">params</span>)</span><br>     params = params - leaning_rate<span class="hljs-operator"> * </span>params_grad<br></code></pre></td></tr></table></figure></li><li><p>学习率需要逐渐减少,否则无法收敛</p></li></ul></li><li><p>小批量梯度下降</p><ul><li><p>w = w - k * ▽J(w;xi:i+m;yi:i+m)   每次更新从训练集选取m个样本学习 m小于总体个数</p></li><li><p>```python<br>for i in range(pb_epochs):</p><div class="code-wrapper"><pre><code class="hljs">np.random.shuffle(data)for batch in get_batch(data,batch_size=50):    params_grad = evalute_gradient(loss_function,batch,params)    params = params - leaning_rate * params_grad</code></pre></div><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-number">3</span>. <span class="hljs-comment">### 问题</span><br><br>   <span class="hljs-number">1</span>. 合适的学习率很难找<br>   <span class="hljs-number">2</span>. 跟新每次的学习率方式很难,需要设置阈值,跟新学习率,不能自适应数据集的特点<br>   <span class="hljs-number">3</span>. 模型搜友的参数每次跟新都是使用相同的学习率, 对于稀疏数据等效果不好<br>   <span class="hljs-number">4</span>. 对于非凸函数,容易陷入次忧的局部极值中<br><br><span class="hljs-number">4</span>. <span class="hljs-comment">### 优化梯度下降</span><br><br>   <span class="hljs-number">1</span>. SGD<br><br>   <span class="hljs-number">2</span>. Momentum<br><br>      - 基于动量的算法<br><br>      - 前几次的梯度会参与到本次梯度的计算<br><br>        - 原来:w = w - learning_rate \* dw<br><br>        - 现在:<br><br>          v = alpha \* v - learning_rate *dw<br><br>          w = w+v <br><br>        - v 是初始速度,alpha是指数衰减系数,也叫作动量参数 常见设置为<span class="hljs-number">0.9</span><br><br>        - 理解为 上次梯度与这次相同,那么下次下降速度幅度会加大,从而加速收敛<br><br>   <span class="hljs-number">3</span>. Nesterov Momentum<br><br>      - 先对参数进行估计,然后使用估计后的参数来计算误差<br><br>      - 学习率ε 初始参数 θ 初始速率v 栋梁衰减参数 α<br><br>      - 过程:<br><br>        - 从训练集中随机抽取m个样本,及他们的标签<br><br>        - 计算梯度和误差 ,跟新速度v和参数α<br><br>          ![](https:<span class="hljs-regexp">//img</span>2018.cnblogs.com<span class="hljs-regexp">/blog/</span><span class="hljs-number">1333782</span><span class="hljs-regexp">/201912/</span><span class="hljs-number">1333782</span>-<span class="hljs-number">20191215140930344</span>-<span class="hljs-number">1956258480</span>.png)<br><br>   <span class="hljs-number">4</span>. AdaGrad<br><br>      - 自适应为各个参数分配不同的学习率<br>   - ![](https:<span class="hljs-regexp">//img</span>2018.cnblogs.com<span class="hljs-regexp">/blog/</span><span class="hljs-number">1333782</span><span class="hljs-regexp">/201912/</span><span class="hljs-number">1333782</span>-<span class="hljs-number">20191215141117132</span>-<span class="hljs-number">1181412474</span>.png)<br>      - 需要全局学习率<br>      - Adadelta<br>      - ![](https:<span class="hljs-regexp">//img</span>2018.cnblogs.com<span class="hljs-regexp">/blog/</span><span class="hljs-number">1333782</span><span class="hljs-regexp">/201912/</span><span class="hljs-number">1333782</span>-<span class="hljs-number">20191215141159380</span>-<span class="hljs-number">2038058318</span>.png)<br><br>   <span class="hljs-number">5</span>. RMSProp<br>   <br>   <span class="hljs-number">6</span>. Adam<br>   <br><span class="hljs-number">5</span>. <span class="hljs-comment">### 学习率的设定</span><br><br>   <span class="hljs-comment">### ![](https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191215141214323-642811660.png)</span><br><br>   学习率的设定<br><br>   ```python<br>   global_step = tf.Variable(<span class="hljs-number">0</span>,trainble=False)<br>   starter_learning = <span class="hljs-number">0.1</span> <span class="hljs-comment"># 初始学习率为0.1</span><br>   <span class="hljs-comment"># 每隔10000次学习率变为原来的0.96</span><br>   learning_rate =  tf.exponential_dacay(starter_learning_rate,\<br>                                         global_setp,<span class="hljs-number">10000</span>,<span class="hljs-number">0.96</span>,staircase=True) <br>   optimizer = tf.GradientDescent(learning_rate)<br>   optimizer.minimize(...my_loss...,global_step=global_setp)<br></code></pre></td></tr></table></figure></li></ul></li></ol></li></ol></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%9C%AA%E4%B8%8A%E4%BC%A0_ngrok%E6%90%AD%E5%BB%BA/"/>
    <url>/2022/01/16/cnblog/%E6%9C%AA%E4%B8%8A%E4%BC%A0_ngrok%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">yum install gcc mercurial git bzr subversion golang golang-pkg-windows-amd64 golang-pkg-windows-386 -y<br></code></pre></td></tr></table></figure><h1 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/inconshreveable/ngrok.git<br></code></pre></td></tr></table></figure><h1 id="安装证书"><a href="#安装证书" class="headerlink" title="安装证书"></a>安装证书</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd ngrok  <br>mkdir cert <br>cd cert<br>export NGROK_DOMAIN=&quot;ngrok.dean0731.top&quot;<br>openssl genrsa -out rootCA.key 2048<br>openssl req -x509 -new -nodes -key rootCA.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -days 5000 -out rootCA.pem<br>openssl genrsa -out device.key 2048<br>openssl req -new -key device.key -subj &quot;/CN=$NGROK_DOMAIN&quot; -out device.csr<br>openssl x509 -req -in device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days 5000<br></code></pre></td></tr></table></figure><h1 id="替换证书"><a href="#替换证书" class="headerlink" title="替换证书"></a>替换证书</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">cp rootCA.pem ../assets/client/tls/ngrokroot.crt<br>cp device.crt ../assets/server/tls/snakeoil.crt<br>cp device.key ../assets/server/tls/snakeoil.key<br></code></pre></td></tr></table></figure><h1 id="编译服务端与客户端"><a href="#编译服务端与客户端" class="headerlink" title="编译服务端与客户端"></a>编译服务端与客户端</h1><p>切回ngrok目录，（GOARCH=386是32位软件，GOARCH=amd64是64位软件）</p><p>生成在ngrok/bin下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;!--linux服务端/客户端--&gt;<br><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=386 make release-server<br><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=amd64 make release-server<br><br><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=386 make release-client<br><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=amd64 make release-client<br><br>&lt;!--Mac OS服务端/客户端--&gt;<br><span class="hljs-attribute">GOOS</span>=darwin <span class="hljs-attribute">GOARCH</span>=386 make release-server<br><span class="hljs-attribute">GOOS</span>=darwin <span class="hljs-attribute">GOARCH</span>=amd64 make release-server<br><br><span class="hljs-attribute">GOOS</span>=darwin <span class="hljs-attribute">GOARCH</span>=386 make release-client<br><span class="hljs-attribute">GOOS</span>=darwin <span class="hljs-attribute">GOARCH</span>=amd64 make release-client<br><br><br>&lt;!--windows服务端/客户端--&gt;<br><span class="hljs-attribute">GOOS</span>=windows <span class="hljs-attribute">GOARCH</span>=386 make release-server<br><span class="hljs-attribute">GOOS</span>=windows <span class="hljs-attribute">GOARCH</span>=amd64 make release-server<br><br><span class="hljs-attribute">GOOS</span>=windows <span class="hljs-attribute">GOARCH</span>=386 make release-client<br><span class="hljs-attribute">GOOS</span>=windows <span class="hljs-attribute">GOARCH</span>=amd64 make release-client<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">GOOS</span>=linux <span class="hljs-attribute">GOARCH</span>=amd64 make release-server<br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">GOOS</span>=windows <span class="hljs-attribute">GOARCH</span>=amd64 make release-client<br></code></pre></td></tr></table></figure><h1 id="启动服务端"><a href="#启动服务端" class="headerlink" title="启动服务端"></a>启动服务端</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./bin/ngrokd -domain=&quot;ngrok.dean0731.top&quot; -httpAddr=&quot;:60080&quot; -httpsAddr=&quot;:60443&quot; -tunnelAddr=&quot;:64443&quot;<br></code></pre></td></tr></table></figure><h1 id="启动客户端"><a href="#启动客户端" class="headerlink" title="启动客户端"></a>启动客户端</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ngrok.cfg<br>&lt;!--配置服务端连接地址，也就是基础域名。端口则与服务端-tunnelAddr配置相同--&gt;<br>server_addr: &quot;ngrok.dean0731.top:64443&quot;  <br>trust_host_root_certs: false<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">ngrok -config=ngrok.cfg -log=ngrok.log -subdomain=first 8080<br>-config指向配置文件，-log存放日志文件位置，-subdomain为自定义的域名前缀，8080为本地端口号。<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%97%A0%E7%BA%BF%E6%8A%80%E6%9C%AF/"/>
    <url>/2022/01/16/cnblog/%E6%97%A0%E7%BA%BF%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="电磁波"><a href="#电磁波" class="headerlink" title="电磁波"></a>电磁波</h1><ul><li><p>电磁波：λ波长Xf频率=v速度</p></li><li><p>低频到高频</p><ul><li>3HZ：波长计算可得10万公里</li><li>低频：不能穿过大气层，波长可达几公里</li><li>3000HZ：FM广播</li><li>1000 000HZ：AM广播</li><li>4G蜂窝网络：10cm-50cm</li><li>2.4GHZ周围：12cm</li><li>5GHZ周围: 6CM</li><li>5G：毫米到厘米</li><li>红外线：700nm到毫米，看不见了</li><li>可见光：780-360nm 红橙黄绿青蓝紫</li><li>紫外线：又看不见了</li><li> x光，</li><li>伽马射线10的20HZ：不到10皮米 1皮米=10负12米</li></ul></li><li><p>常用的：nKHZ——-&gt;300GHZ，300亿赫兹 ，超过300Ghz，进入到光，射线的领域</p></li><li><p>频率高，波长短，单位时间接受的数据量多，穿透性差，距离短，所以5G基站多</p></li></ul><h1 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h1><ul><li><p>模拟信号：函数图像，</p><ul><li>调频，调幅模拟声波信号，例如大，小振幅表示0,1，高低频率表示0,1</li><li>细节保留完好，还原度高，但容易受到干扰，长距离不好</li></ul></li><li><p>数字信号：0,1</p><ul><li>可通过中继器消除干扰</li><li>移幅，移频，移相</li><li>细节丢失，但可以增加采样率提高</li></ul></li><li><p>非跳频：电波在单一信道，持续发送数据，易受到干扰，易被拦截</p></li><li><p>跳频：例如，n个数据包，第一个在1信道，第二个在3信道，第三个在2信道发送。需要按照预设的模型</p><div class="code-wrapper"><pre><code class="hljs">多个设备，在同一时间，不同信道通信</code></pre></div></li></ul><h1 id="wifi"><a href="#wifi" class="headerlink" title="wifi"></a>wifi</h1><ul><li>wifi：2.4GHZ—–&gt;2.4835ghz, 80MHZ<ul><li>中间分为不同信道，不同网络，不同设备使用</li><li>根据标准，每个信道频宽在1MHZ -&gt;160MHZ 不等</li><li>数据混合发送，再解开：傅里叶变换，逆变 </li><li> 5GH:5.15GHZ—–&gt;5.85GHZ</li></ul></li><li>wifi历史 <ul><li>802.11：技术标准 1999年</li><li>802.11a/WIFI1     5GHZ      最大54mbps</li><li>802.11b/WIFI2     2.4GHZ   最大11mbps</li><li>802.11g/WIFI3     2.4GHZ   最大54mbps        2003年  通过OFDM实现：正交，频分，复</li><li>802.11n/WIFI4     2.4GHZ/5GHZ 288mbps/600mbps 2009年<ul><li>2.4GHZ 信道20MHZ,可用信道十多个</li><li>5GHZ 信道40MHZ,可用信道十多个</li></ul></li><li>802.11ac/WIFI5     5GHZ           1.6Gmbps        2013    信道160mhz     机械硬盘速度</li><li>802.11ax/WIFI6    5GHZ/2.4GHZ       3.5Gmbps-9.6Gmbps    2019    </li></ul></li></ul><h1 id="蓝牙"><a href="#蓝牙" class="headerlink" title="蓝牙"></a>蓝牙</h1><ul><li><p>蓝牙：点对点微型网络，基础数据传输，降低功耗</p><ul><li>2.4GHZ-2.4835GHZ</li><li>蓝牙在83.5MHZ—&gt;分为79个信道，采用FHSS跳频，抗干扰能力强</li></ul></li><li><p>蓝牙历史：</p><ul><li>1.0    90年代末        10m    单工，用蓝牙耳机就不能传文件    </li><li>1.2    2003    0.7mpbs    </li><li>2.0    2004    2-3mpbs        双工，用蓝牙耳机就能传文件    </li><li>2.1                  20-30m    降低功耗2-3mw</li><li>3.0    2009    24mpbs    利用wifi技术提速，但没人用<ul><li>  2010    wifi利用蓝牙技术，出现了wifi直连，又扩展到热点</li></ul></li><li>4.0    2010    24mpbs    100m    功耗更低ble</li><li>5.0    2016    提速    300m    进一步功耗更低，可同时2耳机，或音响，蓝牙信标室内定位，打破8终端限制</li></ul></li><li><p>蓝牙协议栈：</p><p>例如键盘的按键数据经过：蓝牙主机：应用程序-》高层协议-》主机接口-》 蓝牙模块：主机控制器-》链路管理…等等再到天线发射</p></li><li><p>蓝牙规范：让所有蓝牙设备能通信</p><ul><li>立体声规范</li><li>打电话蓝牙耳机规范</li><li>打印机规范</li><li>蓝牙键盘鼠标规范等等</li></ul></li></ul><p>程序员在编写应用时调用规范即可，</p><p>任何声音都是模拟信号，采样：把模拟信号中的数据尽可能采样为数字信号</p><p>打电话时：说话产生模拟信号—》转化为数字信号—》放大—–》传输—》反转化为模拟<br>蓝牙的电话：蓝牙收模拟信号–》转为数字–》协议栈–》手机–》反向处理–》数字信号–》传输，因此延迟</p><h1 id="设备分类"><a href="#设备分类" class="headerlink" title="设备分类"></a>设备分类</h1><ul><li>蓝牙设备，对应主机需要有蓝牙模块</li><li>2.4GHZ的自己的无线，但需要接收器</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/"/>
    <url>/2022/01/16/cnblog/%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1 id="行级锁"><a href="#行级锁" class="headerlink" title="行级锁"></a>行级锁</h1><ul><li><p>共享锁S（读锁）：其他事务可以继续加锁，但是不能加排它锁</p></li><li><p>排它锁X（写锁）：其他事务不能继续加锁</p></li><li><p>共享锁共享锁兼容，其他冲突</p></li></ul><h1 id="表级锁"><a href="#表级锁" class="headerlink" title="表级锁"></a>表级锁</h1><ul><li>意向锁<ul><li>意向共享锁：想要获取表中的几行的共享锁</li><li>意向排它锁：想要获取表中的几行的排它锁</li></ul></li></ul><p><img src="https://i.loli.net/2020/08/28/F32NoPR7dmpMEjW.jpg" alt="为什么开发人员必须要了解数据库锁？"></p><h1 id="自增长锁"><a href="#自增长锁" class="headerlink" title="自增长锁"></a>自增长锁</h1><ul><li>提升并发插入性能</li><li>Sql执行完就释放</li></ul><h1 id="记录锁"><a href="#记录锁" class="headerlink" title="记录锁"></a>记录锁</h1><ul><li>索引加锁</li></ul><h1 id="间隙锁"><a href="#间隙锁" class="headerlink" title="间隙锁"></a>间隙锁</h1><ul><li>锁定一个范围，会阻塞插入间隙锁，防止幻读<ul><li>inset user values（1，”name’’）</li><li>inset user values（6，”name’’）</li><li>此时1-6中间没有记录，会给1-6 中间添加间隙锁</li></ul></li></ul><h1 id="next-key"><a href="#next-key" class="headerlink" title="next-key"></a>next-key</h1><ul><li>记录锁加间隙锁</li></ul><h1 id="插入意向锁"><a href="#插入意向锁" class="headerlink" title="插入意向锁"></a>插入意向锁</h1><h1 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h1><ul><li><p>多版本并发控制技术。在 InnoDB 中，在每一行记录的后面增加两个隐藏列，记录创建版本号和删除版本号。通过版本号和行锁，从而提高数据库系统并发性能。</p></li><li><p>对于读操作可以分为两种读：</p><ul><li>快照读：读取的历史数据，简单的 select 语句，不加锁，MVCC 实现可重复读，使用的是 MVCC 机制读取 undo 中的已经提交的数据。所以它的读取是非阻塞的。</li><li>当前读：需要加锁的语句，update，insert，delete，select…for update(手动加锁)</li></ul></li></ul><h1 id="如何防止死锁"><a href="#如何防止死锁" class="headerlink" title="如何防止死锁"></a>如何防止死锁</h1><ul><li>以固定的顺序访问表和行。交叉访问更容易造成事务等待回路。</li><li>尽量避免大事务，占有的资源锁越多，越容易出现死锁。建议拆成小事务。</li><li>降低隔离级别。如果业务允许(上面也分析了，某些业务并不能允许)，将隔离级别调低也是较好的选择，比如将隔离级别从 RR 调整为 RC，可以避免掉很多因为 gap 锁造成的死锁。</li><li>为表添加合理的索引。防止没有索引出现表锁，出现死锁的概率会突增。</li></ul><p><img src="https://i.loli.net/2020/08/28/XrdatJTz27USQi9.png" alt="img"></p><p><img src="https://i.loli.net/2020/08/28/wfFAJk4X2qcOpzC.jpg" alt="为什么开发人员必须要了解数据库锁？"></p><ul><li>原子性：Atomicity</li><li>一致性：Consistency</li><li>持久性：Durability</li><li>隔离性：Isolation<ul><li>读未提交：事物并行时可以看到位提交的操作</li><li>读已提交：与上边对比，</li><li>可重复读</li><li>串行化<ul><li>事务串行执行</li><li>脏读：读得到未提交数据</li><li>不可重复读：一个事务中2次查询结果出现不同，update，delete</li><li>幻读：与上面类似，重点在于insert</li></ul></li></ul></li></ul><p><img src="https://i.loli.net/2020/08/28/oBMQ5WSgxK9A6Lt.jpg" alt="为什么开发人员必须要了解数据库锁？"></p><h1 id="乐观锁悲观锁"><a href="#乐观锁悲观锁" class="headerlink" title="乐观锁悲观锁"></a>乐观锁悲观锁</h1><p>悲观锁：就是前面的共享锁，排他锁</p><ul><li><p>在对记录进行修改前，先尝试为该记录加上排他锁</p></li><li><p>如果加锁失败，说明该记录正在被修改，那么当前查询可能要等待或者抛出异常。具体响应方式由开发者根据实际需要决定。</p></li><li><p>如果成功加锁，那么就可以对记录做修改，事务完成后就会解锁了。</p></li><li><p>期间如果有其他对该记录做修改或加排他锁的操作，都会等待解锁或直接抛出异常。</p></li></ul><p>乐观锁</p><ul><li>不需要锁机制，认为操作时没有线程修改数据，只在更新数据的时候判断</li><li>冲突检测，数据更新</li><li>CAS(compareAndSet)是一项乐观锁技术，当多个线程尝试使用CAS同时更新同一个变量时，只有其中一个线程能更新变量的值，而其它线程都失败，失败的线程并不会被挂起，而是被告知这次竞争中失败，并可以再次尝试。java实现的自旋锁：<a href="https://dean0731.top/post/7">https://dean0731.top/post/7</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/"/>
    <url>/2022/01/16/cnblog/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<table><thead><tr><th>名称</th><th>最好</th><th>平均</th><th>最坏</th><th>空间</th><th>稳定性</th><th>类别</th></tr></thead><tbody><tr><td>冒泡排序</td><td>$ O(n) $</td><td>$ O(n^2) $</td><td>$ O(n^2) $</td><td>$ O(1) $</td><td>是</td><td>交换排序</td></tr><tr><td>选择排序</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(1)$</td><td>否</td><td>选择排序</td></tr><tr><td>插入排序</td><td>$O(n)$</td><td>$o(n^2)$</td><td>$o(n^2)$</td><td>$o(1)$</td><td>是</td><td>插入排序</td></tr><tr><td>希尔排序</td><td>$O(n)$</td><td>$o(n^{1~3})$</td><td>$o(n^2)$</td><td>$o(1)$</td><td>否</td><td>插入排序</td></tr><tr><td>归并排序</td><td>$O(nlog_2n)$</td><td>$o(nlog_2n)$</td><td>$o(nlog_2n)$</td><td>$o(n)$</td><td>是</td><td></td></tr><tr><td>快速排序</td><td>$O(nlog_2n)$</td><td>$o(nlog_2n)$</td><td>$o(n^2)$</td><td>$o(nlog_2n)$</td><td>否</td><td>交换排序</td></tr><tr><td>基数排序</td><td>$O(d(n+r))$</td><td>$d=最大的数的位数,r为基数10，o(d(n+r))$</td><td>$o(d(n+r))$</td><td>$o(n+r)$</td><td>是</td><td></td></tr><tr><td>堆排序</td><td>$O(nlog_2n)$</td><td>$o(nlog_2n)$</td><td>$o(nlog_2n)$</td><td>$o(1)$</td><td>否</td><td>选择排序</td></tr><tr><td>计数排序</td><td></td><td>$k=最大的数值，O(n+k)$</td><td></td><td>$o(n+k)$</td><td>是</td><td></td></tr><tr><td>桶排序</td><td>$n=M,o(n)$</td><td>$O(n+nlog_2n-nlog_2M)$</td><td></td><td>$o(n+M)$</td><td>是</td><td></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 冒泡排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bubbleSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[])</span> </span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i =<span class="hljs-number">0</span> ; i&lt;arr.length-<span class="hljs-number">1</span> ; i++) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span> ; j&lt;arr.length-<span class="hljs-number">1</span>-i ; j++) &#123;<br>            <span class="hljs-keyword">if</span>(arr[j]&gt;arr[j+<span class="hljs-number">1</span>]) &#123;<br>                <span class="hljs-keyword">int</span> temp = arr[j];<br>                arr[j]=arr[j+<span class="hljs-number">1</span>];<br>                arr[j+<span class="hljs-number">1</span>]=temp;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//选择排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">selectSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[])</span></span>&#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; arr.length-<span class="hljs-number">1</span>; i++)&#123;<br>        <span class="hljs-keyword">int</span> min = i;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = i+<span class="hljs-number">1</span>; j &lt;arr.length ;j++)&#123;<br>            <span class="hljs-keyword">if</span>(arr[j]&lt;arr[min])&#123;<br>                min = j;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(min!=i)&#123;<br>            <span class="hljs-keyword">int</span> temp = arr[min];<br>            arr[min] = arr[i];<br>            arr[i] = temp;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 插入排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">insertsort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[])</span></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;arr.length;i++) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=i;j&gt;<span class="hljs-number">0</span>&amp;&amp;(arr[j]&lt;arr[j-<span class="hljs-number">1</span>]);j--) &#123;<br>            <span class="hljs-keyword">int</span> temp=arr[j];<br>            arr[j]=arr[j-<span class="hljs-number">1</span>];<br>            arr[j-<span class="hljs-number">1</span>]=temp;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 希尔排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shellSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[])</span></span>&#123;<br>    <span class="hljs-keyword">int</span> gap = arr.length;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>        gap /= <span class="hljs-number">2</span>;   <span class="hljs-comment">//增量每次减半</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; gap; i++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = i + gap; j &lt; arr.length; j += gap) &#123;<span class="hljs-comment">//这个循环里其实就是一个插入排序</span><br>                <span class="hljs-keyword">int</span> temp = arr[j];<br>                <span class="hljs-keyword">int</span> k = j - gap;<br>                <span class="hljs-keyword">while</span> (k &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[k] &gt; temp) &#123;<br>                    arr[k + gap] = arr[k];<br>                    k -= gap;<br>                &#125;<br>                arr[k + gap] = temp;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (gap == <span class="hljs-number">1</span>)<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 归并排序</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] mergeSort(<span class="hljs-keyword">int</span> arr[], <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r) &#123;<br>    <span class="hljs-keyword">if</span> (l == r)<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] &#123; arr[l] &#125;;<br>    <span class="hljs-keyword">int</span> mid = l + (r - l) / <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">int</span>[] leftArr = mergeSort(arr, l, mid); <span class="hljs-comment">//左有序数组</span><br>    <span class="hljs-keyword">int</span>[] rightArr = mergeSort(arr, mid + <span class="hljs-number">1</span>, r); <span class="hljs-comment">//右有序数组</span><br>    <span class="hljs-keyword">int</span>[] newNum = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[leftArr.length + rightArr.length]; <span class="hljs-comment">//新有序数组</span><br>    <span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>, i = <span class="hljs-number">0</span>, j = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (i &lt; leftArr.length &amp;&amp; j &lt; rightArr.length) &#123;<br>        newNum[m++] = leftArr[i] &lt; rightArr[j] ? leftArr[i++] : rightArr[j++];<br>    &#125;<br>    <span class="hljs-keyword">while</span> (i &lt; leftArr.length)<br>        newNum[m++] = leftArr[i++];<br>    <span class="hljs-keyword">while</span> (j &lt; rightArr.length)<br>        newNum[m++] = rightArr[j++];<br>    <span class="hljs-keyword">return</span> newNum;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 快速排序</span><br>public <span class="hljs-keyword">static</span> int[] <span class="hljs-function"><span class="hljs-title">quickSort</span>(<span class="hljs-params">int arr[],int start,int end</span>)</span> &#123;<br>    int pivot = arr[start];<br>    int i = start;<br>    int j = end;<br>    <span class="hljs-keyword">while</span> (i&lt;j) &#123;<br>        <span class="hljs-keyword">while</span> ((i&lt;j)&amp;&amp;(arr[j]&gt;pivot)) &#123;<br>            j--;<br>        &#125;<br>        <span class="hljs-keyword">while</span> ((i&lt;j)&amp;&amp;(arr[i]&lt;pivot)) &#123;<br>            i++;<br>        &#125;<br>        <span class="hljs-keyword">if</span> ((arr[i]==arr[j])&amp;&amp;(i&lt;j)) &#123;<br>            i++;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            int temp = arr[i];<br>            arr[i] = arr[j];<br>            arr[j] = temp;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (i-<span class="hljs-number">1</span>&gt;start) arr=quickSort(arr,start,i-<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">if</span> (j+<span class="hljs-number">1</span>&lt;end) arr=quickSort(arr,j+<span class="hljs-number">1</span>,end);<br>    <span class="hljs-keyword">return</span> (arr);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 基数排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">radixSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] arr, <span class="hljs-keyword">int</span> d)</span></span>&#123; <span class="hljs-comment">//d表示最大的数有多少位</span><br>    <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> n = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> m = <span class="hljs-number">1</span>; <span class="hljs-comment">//控制键值排序依据在哪一位</span><br>    <span class="hljs-keyword">int</span>[][]temp = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>][arr.length]; <span class="hljs-comment">//数组的第一维表示可能的余数0-9</span><br>    <span class="hljs-keyword">int</span>[]order = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">//数组orderp[i]用来表示该位是i的数的个数</span><br>    <span class="hljs-keyword">while</span>(m &lt;= d) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) &#123;<br>            <span class="hljs-keyword">int</span> lsd = ((arr[i] / n) % <span class="hljs-number">10</span>);<br>            temp[lsd][order[lsd]] = arr[i];<br>            order[lsd]++;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>            <span class="hljs-keyword">if</span>(order[i] != <span class="hljs-number">0</span>)<br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; order[i]; j++) &#123;<br>                    arr[k] = temp[i][j];<br>                    k++;<br>                &#125;<br>            order[i] = <span class="hljs-number">0</span>;<br>        &#125;<br>        n *= <span class="hljs-number">10</span>;<br>        k = <span class="hljs-number">0</span>;<br>        m++;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 堆排序</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] heapSort(<span class="hljs-keyword">int</span>[] array) &#123;<br>     <span class="hljs-comment">//这里元素的索引是从0开始的,所以最后一个非叶子结点array.length/2 - 1</span><br>     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = array.length / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>         adjustHeap(array, i, array.length);  <span class="hljs-comment">//调整堆</span><br>     &#125;<br><br>     <span class="hljs-comment">// 上述逻辑，建堆结束</span><br>     <span class="hljs-comment">// 下面，开始排序逻辑</span><br>     <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = array.length - <span class="hljs-number">1</span>; j &gt; <span class="hljs-number">0</span>; j--) &#123;<br>         <span class="hljs-comment">// 元素交换,作用是去掉大顶堆</span><br>         <span class="hljs-comment">// 把大顶堆的根元素，放到数组的最后；换句话说，就是每一次的堆调整之后，都会有一个元素到达自己的最终位置</span><br>         swap(array, <span class="hljs-number">0</span>, j);<br>         <span class="hljs-comment">// 元素交换之后，毫无疑问，最后一个元素无需再考虑排序问题了。</span><br>         <span class="hljs-comment">// 接下来我们需要排序的，就是已经去掉了部分元素的堆了，这也是为什么此方法放在循环里的原因</span><br>         <span class="hljs-comment">// 而这里，实质上是自上而下，自左向右进行调整的</span><br>         adjustHeap(array, <span class="hljs-number">0</span>, j);<br>     &#125;<br>     <span class="hljs-keyword">return</span> array;<br> &#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 整个堆排序最关键的地方</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> array 待组堆</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> i 起始结点</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> length 堆的长度</span><br><span class="hljs-comment">     */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">adjustHeap</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] array, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> length)</span> </span>&#123;<br>    <span class="hljs-comment">// 先把当前元素取出来，因为当前元素可能要一直移动</span><br>    <span class="hljs-keyword">int</span> temp = array[i];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; k &lt; length; k = <span class="hljs-number">2</span> * k + <span class="hljs-number">1</span>) &#123;  <span class="hljs-comment">//2*i+1为左子树i的左子树(因为i是从0开始的),2*k+1为k的左子树</span><br>        <span class="hljs-comment">// 让k先指向子节点中最大的节点</span><br>        <span class="hljs-keyword">if</span> (k + <span class="hljs-number">1</span> &lt; length &amp;&amp; array[k] &lt; array[k + <span class="hljs-number">1</span>]) &#123;  <span class="hljs-comment">//如果有右子树,并且右子树大于左子树</span><br>            k++;<br>        &#125;<br>        <span class="hljs-comment">//如果发现结点(左右子结点)大于根结点，则进行值的交换</span><br>        <span class="hljs-keyword">if</span> (array[k] &gt; temp) &#123;<br>            swap(array, i, k);<br>            <span class="hljs-comment">// 如果子节点更换了，那么，以子节点为根的子树会受到影响,所以，循环对子节点所在的树继续进行判断</span><br>            i  =  k;<br>        &#125; <span class="hljs-keyword">else</span> &#123;  <span class="hljs-comment">//不用交换，直接终止循环</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 交换元素</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> arr</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> a 元素的下标</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> b 元素的下标</span><br><span class="hljs-comment">     */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">swap</span><span class="hljs-params">(<span class="hljs-keyword">int</span>[] arr, <span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> temp = arr[a];<br>    arr[a] = arr[b];<br>    arr[b] = temp;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 计数排序</span><br>public <span class="hljs-keyword">static</span> int[] <span class="hljs-function"><span class="hljs-title">countSort</span>(<span class="hljs-params">int arr[]</span>)</span>&#123;<br>    int b[] = <span class="hljs-keyword">new</span> int[arr.length];<br>    int max = arr[<span class="hljs-number">0</span>],min = arr[<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">for</span>(int i:arr)&#123;<br>        <span class="hljs-keyword">if</span>(i&gt;max)&#123;<br>            max=i;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(i&lt;min)&#123;<br>            min=i;<br>        &#125;<br>    &#125;<span class="hljs-comment">//这里k的大小是要排序的数组中，元素大小的极值差+1</span><br>    int k=max-min+<span class="hljs-number">1</span>;<br>    int c[]=<span class="hljs-keyword">new</span> int[k];<br>    <span class="hljs-keyword">for</span>(int i=<span class="hljs-number">0</span>;i&lt;arr.length;++i)&#123;<br>        c[arr[i]-min]+=<span class="hljs-number">1</span>;<span class="hljs-comment">//优化过的地方，减小了数组c的大小</span><br>    &#125;<br>    <span class="hljs-keyword">for</span>(int i=<span class="hljs-number">1</span>;i&lt;c.length;++i)&#123;<br>        c[i]=c[i]+c[i-<span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-keyword">for</span>(int i=arr.length-<span class="hljs-number">1</span>;i&gt;=<span class="hljs-number">0</span>;--i)&#123;<br>        b[--c[arr[i]-min]]=arr[i];<span class="hljs-comment">//按存取的方式取出c的元素</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> b;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 桶排序</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">bucketSort</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arr[])</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> n=arr.length;<br>    <span class="hljs-keyword">int</span> bask[][]=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>][n];<br>    <span class="hljs-keyword">int</span> index[]=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>];<br>    <span class="hljs-keyword">int</span> max=Integer.MIN_VALUE;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++) &#123;<br>        max=max&gt;(Integer.toString(arr[i]).length())?max:(Integer.toString(arr[i]).length());<br>    &#125;<br>    String str;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=max-<span class="hljs-number">1</span>;i&gt;=<span class="hljs-number">0</span>;i--) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;n;j++) &#123;<br>            str=<span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">if</span>(Integer.toString(arr[j]).length()&lt;max) &#123;<br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=<span class="hljs-number">0</span>;k&lt;max-Integer.toString(arr[j]).length();k++)<br>                    str+=<span class="hljs-string">&quot;0&quot;</span>;<br>            &#125;<br>            str+=Integer.toString(arr[j]);<br>            bask[str.charAt(i)-<span class="hljs-string">&#x27;0&#x27;</span>][index[str.charAt(i)-<span class="hljs-string">&#x27;0&#x27;</span>]++]=arr[j];<br>        &#125;<br>        <span class="hljs-keyword">int</span> pos=<span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">0</span>;j&lt;<span class="hljs-number">10</span>;j++) &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=<span class="hljs-number">0</span>;k&lt;index[j];k++) &#123;<br>                arr[pos++]=bask[j][k];<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>;x&lt;<span class="hljs-number">10</span>;x++)index[x]=<span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
    <url>/2022/01/16/cnblog/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="bitmap和布隆过滤器"><a href="#bitmap和布隆过滤器" class="headerlink" title="bitmap和布隆过滤器"></a>bitmap和布隆过滤器</h2><p><strong>海量整数中是否存在某个值–bitmap</strong></p><p>​        在一个程序中，经常有让我们判断一个集合中是否存在某个数的case；大多数情况下，只需要用map或是list这样简单的数据结构，如果使用的是高级语言，还能乘上快车调用几个封装好的api，加几个if else，两三行代码就可以在控制台看自己“完美”而又“健壮”的代码跑起来了。</p><p>​        但是，事无完美，在高并发环境下，所有的case都会极端化，如果这是一个十分庞大的集合（给这个庞大一个具体的值吧，一个亿），简单的一个hash map，不考虑链表所需的指针内存空间，一亿个int类型的整数，就需要380多M（4byte × 10 ^8），十亿的话就是4个G，不考虑性能，光算算这内存开销，即使现在满地都是128G的服务器，也不好吃下这一壶。</p><p>bitmap则使用位数代表数的大小，bit中存储的0或者1来标识该整数是否存在，具体模型如下：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/6ZZpbBqmTH27iaamFEVCBF9iaJMMF23bnyNb1qok0e5feQEHcKsZh3KfGL8z3QpJpiaNf7KpXUSvJo5OCUo5e8icyg/0" alt="img"></p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img">这是一个能标识0-9的“bitmap”，其中4321这四个数存在</p><p>​        计算一下bitmap的内存开销，如果是1亿以内的数据查找，我们只需要1亿个bit = 12MB左右的内存空间，就可以完成海量数据查找了，是不是极其诱人的一个内存缩减，以下为Java实现的bitmap代码：</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBitMap</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] bytes;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> initSize;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyBitMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        initSize = size / (<span class="hljs-number">8</span>) + <span class="hljs-number">1</span>;<br>        bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[initSize];<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> number)</span> </span>&#123;<br>        <span class="hljs-comment">//相当于对一个数字进行右移动3位，相当于除以8</span><br>        <span class="hljs-keyword">int</span> index = number &gt;&gt; <span class="hljs-number">3</span>;<br>        <span class="hljs-comment">//相当于 number % 8 获取到byte[index]的位置</span><br>        <span class="hljs-keyword">int</span> position = number &amp; <span class="hljs-number">0x07</span>;<br>        <span class="hljs-comment">//进行|或运算  参加运算的两个对象只要有一个为1，其值为1。</span><br>        bytes[index] |= <span class="hljs-number">1</span> &lt;&lt; position;<br>    &#125;<br> <br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">contain</span><span class="hljs-params">(<span class="hljs-keyword">int</span> number)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> index = number &gt;&gt; <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">int</span> position = number &amp; <span class="hljs-number">0x07</span>;<br>        <span class="hljs-keyword">return</span> (bytes[index] &amp; (<span class="hljs-number">1</span> &lt;&lt; position)) != <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        MyBitMap myBitMap = <span class="hljs-keyword">new</span> MyBitMap(<span class="hljs-number">32</span>);<br>        myBitMap.set(<span class="hljs-number">30</span>);<br>        myBitMap.set(<span class="hljs-number">13</span>);<br>        myBitMap.set(<span class="hljs-number">24</span>);<br>        System.out.println(myBitMap.contain(<span class="hljs-number">2</span>));<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>​        使用简单的byte数组和位运算，就能做到时间与空间的完美均衡，是不是美美哒，wrong！试想一下，如果我们明确这是一个一亿以内，但是数量级只有10的集合，我们使用bitmap，同样需要开销12M的数据，如果是10亿以内的数据，开销就会涨到120M，bitmap的空间开销永远是和他的数据取值范围挂钩的，只有在海量数据下，他才能够大显身手。</p><p>​        再说说刚刚提到的那个极端case，假设这个数据量在一千万，但是取值范围好死不死就在十个亿以内，那我们不可避免还是要面对120M的开销，有方法应对么？</p><h2 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h2><p>​        如果面对笔者说的以上问题，我们结合一下常规的解决方案，譬如说hash一下，我将十亿以内的某个数据，hash成一亿内的某个值，再去bitmap中查怎么样，如下图，布隆过滤器就是这么干的：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/6ZZpbBqmTH27iaamFEVCBF9iaJMMF23bnyPE4B1XURg6DWwMNOrJfeOvrv6pbkv81HW53FDrUCz8rOt16gdtJ6YQ/0" alt="img"></p><p>利用多个hash算法得到的值，减小hash碰撞的概率</p><p>​        像上面的图注所说，我们可以利用多个hash算法减小碰撞概率，但只要存在碰撞，就一定会有错误判断，我们无法百分百确定一个值是否真的存在，但是hash算法的魅力在于，我不能确定你是否存在，但是我可以确定你是否真的不存在，这也就是以上的实现为什么称之“过滤器”的原因了。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%B7%A5%E5%85%B7/"/>
    <url>/2022/01/16/cnblog/%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<p><strong>关键词</strong>：乱码，编译，集合，正则</p><p><img src="https://i.loli.net/2020/11/08/FczZuTbl9UAgtMf.png" alt="微信图片_202011081339421"><img src="https://i.loli.net/2020/11/08/E5DdkyWqpCFo6aR.png" alt="image-20201108134446849"></p><p><img src="https://i.loli.net/2020/11/08/RL9SX864jqdNacZ.png" alt="微信图片_20201108133942"></p><p><img src="https://i.loli.net/2020/11/08/zdCV4hL6gB1PSOw.jpg" alt="微信图片_202011081339422"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%B1%8F%E5%B9%95%E6%8A%80%E6%9C%AF/"/>
    <url>/2022/01/16/cnblog/%E5%B1%8F%E5%B9%95%E6%8A%80%E6%9C%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="显示器"><a href="#显示器" class="headerlink" title="显示器"></a>显示器</h1><ul><li>LCD：实惠</li><li>OLED：效果好，价格贵，容易烧屏</li><li>HDR</li></ul><h1 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h1><ul><li>屏幕像素个数</li></ul><h1 id="PPI"><a href="#PPI" class="headerlink" title="PPI"></a>PPI</h1><ul><li>像素密集程度，边长一英寸的正方形中像素个数，<ul><li>手机：300以上</li><li>电脑：200以上</li></ul></li></ul><p>屏幕效果：分辨率，ppi，与视距 结合</p><h1 id="亮度"><a href="#亮度" class="headerlink" title="亮度"></a>亮度</h1><ul><li>单位：nits<ul><li>一平方米范围，一个烛光的亮度</li><li>LCD:200-500nits</li><li>真实世界：15000nits</li></ul></li></ul><h1 id="色域"><a href="#色域" class="headerlink" title="色域"></a>色域</h1><p>显示的色彩范围</p><h1 id="屏幕"><a href="#屏幕" class="headerlink" title="屏幕"></a>屏幕</h1><ul><li>fps：每秒计算机产生画面数量</li><li>屏幕刷新率：硬件指标，60HZ就是每秒60次刷新屏幕<ul><li>fps&lt;60：例如ftp是15，则每张图片显示4次</li><li>fps&gt;60：画面会被有规律的抛弃掉</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6/"/>
    <url>/2022/01/16/cnblog/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="线程与进程"><a href="#线程与进程" class="headerlink" title="线程与进程"></a>线程与进程</h1><ul><li>java默认2个线程，main,gc</li><li><font color=red>真实的线程时底层C++调用的，并不是java</font></li><li>cup核心数，就是<font color=red>并行</font>的线程数</li><li>单核CUP，要多线程并行，就是用并发实现宏观并行</li><li>线程状态<ul><li>New</li><li>running</li><li>blocked</li><li>waiting</li><li>time_waiting</li><li>terminal</li></ul></li><li>wait与sleep<ul><li>来自不同的类</li><li>都会释放cup，但wait释放锁，即释放资源，sleep不释放</li><li>wait只在同步代码块，sleep任意</li></ul></li><li><font color=red>线程是一个资源类，没有任何附属操作，OOP编程</font><ul><li>资源类包含属性，方法</li><li>资源类方法同步</li><li>启动线程操作资源类</li></ul></li></ul><h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><ul><li><p>Syncronized与Lock</p><ul><li>Lock可判断锁状态，终止等待</li><li>Lock必须手动释放，否则死锁</li><li>Lock可控制是否是公平锁，默认非公平锁<ul><li>线程获取锁本来是先来后到，但若是非公平锁，则允许线程插队</li></ul></li><li>Lock适合锁大量代码块</li></ul></li><li><p>可重入锁</p><ul><li><p>不区分读写操作时使用</p></li><li><p>公平，非公平，可插队（默认）</p></li><li><p>线程进入资源类方法1时加获取锁，方法2调用方法2，又要获取锁，也可获取，因为是重入锁</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>&#123;&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">get2</span><span class="hljs-params">()</span></span>&#123;&#125;<br><span class="hljs-comment">// 两个线程调用同一个对象的get1，get2，一个线程会被阻塞，应为锁的是this，即锁是同一个对象，只能给一个线程，</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>&#123;get2)&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">get2</span><span class="hljs-params">()</span></span>&#123;&#125;<br><span class="hljs-comment">// 线程调用get(),由于是一个线程调用get，get2，可重入此时起作用，否则就是自己锁死自己</span><br><span class="hljs-comment">// 也可理解威武</span><br></code></pre></td></tr></table></figure></li><li><p>sync ,reentLock都是可重入</p></li><li><p>```<br>线程block状态：  遇到 synchrizoned 线程会进入阻塞状态，此时不会响应中断，不会被打断<br>线程waiting状态：   由代码执行到达watiing 例如 reentrantlock ，会相应中断，因此该锁可以中断</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><br>- 可重入读写锁<br><br>  - 使用时调用读锁，或写锁使用<br>  - 写锁（独占锁），即写的时候其它不能写，其它不能读<br>  - 读锁（共享锁），读的时候其它不能写，其它可以读<br>  - 无锁，无限制<br>  - 读操作与写操作分离时使用<br><br>- 可重入读锁<br><br>- 可重入写锁<br><br><span class="hljs-meta"># 集合安全</span><br><br>```java<br>List&lt;Integer&gt; <span class="hljs-number">1</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();<br>List&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-type">Vector</span>&lt;&gt;(); <span class="hljs-comment">// 同步sync</span><br>List&lt;Integer&gt; l = Collections.synchronizedList(<span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;()); <span class="hljs-comment">// 同步sync</span><br>List&lt;Integer&gt; l = <span class="hljs-keyword">new</span> <span class="hljs-type">CopyOnWriteArrayList</span>&lt;&gt;(); <span class="hljs-comment">// Lock锁 JUC里面的</span><br><br>Set&lt;Integer&gt; s = <span class="hljs-keyword">new</span> <span class="hljs-type">HashSet</span>&lt;&gt;(); <span class="hljs-comment">// 就是hashmap的键</span><br>Set&lt;Integer&gt;  s= Collections.synchronizedSet(<span class="hljs-keyword">new</span> <span class="hljs-type">HashSet</span>&lt;&gt;());<span class="hljs-comment">// 同步sync</span><br>Set&lt;Integer&gt;  s= <span class="hljs-keyword">new</span> <span class="hljs-type">CopyOnWriteArraySet</span>&lt;&gt;();<span class="hljs-comment">// Lock 锁 JUC里面的</span><br><br><br><span class="hljs-comment">// -----------------------------</span><br>Map&lt;<span class="hljs-keyword">String</span>,<span class="hljs-keyword">String</span>&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-type">HashMap</span>&lt;<span class="hljs-keyword">String</span>,<span class="hljs-keyword">String</span>&gt;(<span class="hljs-number">16</span>,<span class="hljs-number">0.75</span>f);<br>Map&lt;<span class="hljs-keyword">String</span>,<span class="hljs-keyword">String</span>&gt; map2 = <span class="hljs-keyword">new</span> <span class="hljs-type">Hashtable</span>&lt;&gt;();<span class="hljs-comment">// 同步sync</span><br>Map&lt;<span class="hljs-keyword">String</span>,<span class="hljs-keyword">String</span>&gt; map = Collections.synchronizedMap(<span class="hljs-keyword">new</span> <span class="hljs-type">HashMap</span>&lt;&gt;());<span class="hljs-comment">// 同步sync</span><br>Map&lt;<span class="hljs-keyword">String</span>,<span class="hljs-keyword">String</span>&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-type">ConcurrentHashMap</span>&lt;&gt;();<span class="hljs-comment">//分段Lock锁，锁定某一段 JUC里面的</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//BlockingQueue 实现类都是用了Lock的，即线程安全的</span><br>BlockingQueue&lt;Integer&gt; q = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;Integer&gt;(<span class="hljs-number">10</span>);<br>BlockingQueue&lt;Integer&gt; q = <span class="hljs-keyword">new</span> LinkedBlockingDeque&lt;Integer&gt;();<br><span class="hljs-comment">// 同步队列，只能存放一个元素</span><br>BlockingQueue&lt;Integer&gt; q = <span class="hljs-keyword">new</span> SynchronousQueue&lt;Integer&gt;();<br>BlockingQueue&lt;Integer&gt; q = (BlockingQueue&lt;Integer&gt;) <span class="hljs-keyword">new</span> ConcurrentLinkedQueue&lt;Integer&gt;();<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/16/t1l6oKBZqVYfMJj.png" alt="image-20200916160400661"></p><h1 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h1><ul><li>节约资源</li><li>控制最大并发数</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 本质就是ThreadPoolExecutor(7各参数)</span><br>Executors.newSingleThreadExecutor();<br>Executors.newFixedThreadPool(<span class="hljs-number">5</span>);<br>Executors.newCachedThreadPool();<br><span class="hljs-comment">// 推荐手动创建</span><br>ExecutorService s = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<br>    <span class="hljs-number">2</span>, <span class="hljs-comment">// 一直开着的上数量</span><br>    Runtime.getRuntime().availableProcessors(),<span class="hljs-comment">// 最大线程数，一般就是CUP核心数</span><br>    <span class="hljs-number">3</span>, <span class="hljs-comment">// 等待</span><br>    TimeUnit.SECONDS, <span class="hljs-comment">// 单位</span><br>    <span class="hljs-keyword">new</span> LinkedBlockingDeque&lt;&gt;(<span class="hljs-number">3</span>),<span class="hljs-comment">// 等待队列 最多同时开启max+cap个线程</span><br>    Executors.defaultThreadFactory(), <span class="hljs-comment">// 默认线程工厂</span><br>    <span class="hljs-comment">// 拒绝策略，有四种</span><br>    <span class="hljs-comment">//new ThreadPoolExecutor.AbortPolicy() //线程超过max+cap,又来任务，抛出异常</span><br>    <span class="hljs-comment">//new ThreadPoolExecutor.CallerRunsPolicy() //线程超过max+cap，线程池不受理，来源线程执行</span><br>    <span class="hljs-comment">//new ThreadPoolExecutor.DiscardPolicy() //线程超过max+cap，又来任务，不抛出异常，但丢弃任务</span><br>    <span class="hljs-keyword">new</span> ThreadPoolExecutor.DiscardOldestPolicy() <span class="hljs-comment">//线程超过max+cap，又来任务，尝试与第一个任务竞争，竞争失败，不抛异常，但还丢弃任务</span><br><br></code></pre></td></tr></table></figure><h1 id="函数式接口，简化编程模型"><a href="#函数式接口，简化编程模型" class="headerlink" title="函数式接口，简化编程模型"></a>函数式接口，简化编程模型</h1><ul><li><p>Function：转换型接口，给定一个类型，转为另一个</p><ul><li><p>可以用lambda</p></li><li><p>```java<br>Function&lt;String,Integer&gt; f = str-&gt;{return str.length();};<br>System.out.print(function.apply(“abc”));</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br>- Predicate：断定型接口<br><br>  - 只能返回<span class="hljs-built_in">boolean</span>类型<br><br>    ```java<br>    Predicate&lt;<span class="hljs-keyword">String</span>&gt; p = <span class="hljs-built_in">str</span>-&gt;&#123;<span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>.isEmpty();&#125;;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>Supplier：供给型接口，用于产生数据</p><ul><li>没有参数，只有返回值</li></ul></li><li><p>Consumer：消费型接口，用于处理传入的数据</p><ul><li>没有返回值</li></ul></li></ul><h1 id="Stream流计算"><a href="#Stream流计算" class="headerlink" title="Stream流计算"></a>Stream流计算</h1><ul><li>数据——》存储，计算<ul><li>集合，mysql用于存储</li><li>计算都是流</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;String&gt; l = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>l.stream()<br>        .filter(str-&gt;&#123;<span class="hljs-keyword">return</span> str.length()&gt;=<span class="hljs-number">2</span>;&#125;) <span class="hljs-comment">// 断定型</span><br>        .map(str-&gt;&#123;<span class="hljs-keyword">return</span> str.toLowerCase();&#125;) <span class="hljs-comment">// 转换型</span><br>        .sorted((str1,str2)-&gt;str1.compareTo(str2)) <span class="hljs-comment">// 排序</span><br>        .limit(<span class="hljs-number">1</span>) <span class="hljs-comment">// 只输出1个</span><br>        .forEach(System.out::println);<br></code></pre></td></tr></table></figure><h1 id="ForkJoin"><a href="#ForkJoin" class="headerlink" title="ForkJoin"></a>ForkJoin</h1><ul><li>并行执行任务</li><li>大量数据使用<ul><li>forkjoinpool</li></ul></li></ul><p><img src="https://i.loli.net/2020/09/16/9GDPQ8ECy6WUxRo.png" alt="image-20200916180321049"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ForkJoinDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecursiveTask</span>&lt;<span class="hljs-title">Long</span>&gt;</span>&#123;<br>    <span class="hljs-keyword">private</span> Long start;<br>    <span class="hljs-keyword">private</span> Long end;<br>    <span class="hljs-keyword">private</span> Long temp=<span class="hljs-number">100000L</span>; <span class="hljs-comment">// 临界值</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ForkJoinDemo</span><span class="hljs-params">()</span></span>&#123;<br><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ForkJoinDemo</span><span class="hljs-params">(Long start, Long end)</span></span>&#123;<br>        <span class="hljs-keyword">this</span>.start = start;<br>        <span class="hljs-keyword">this</span>.end = end;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> Long <span class="hljs-title">compute</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(end-start &lt; temp)&#123;<br>            Long sum = <span class="hljs-number">0L</span>;<br>            <span class="hljs-keyword">for</span>(Long i = start; i &lt;= end; i++)&#123;<br>                sum += i;<br>            &#125;<br>            <span class="hljs-keyword">return</span> sum;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            Long mid = (start + end)/<span class="hljs-number">2</span>;<br>            ForkJoinDemo f1 = <span class="hljs-keyword">new</span> ForkJoinDemo(start,mid);<br>            f1.fork(); <span class="hljs-comment">//任务压入队列</span><br>            ForkJoinDemo f2 = <span class="hljs-keyword">new</span> ForkJoinDemo(mid+<span class="hljs-number">1</span>,end);<br>            f2.fork();<br>            <span class="hljs-keyword">return</span> f1.join()+f2.join();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>        <span class="hljs-comment">// 1 加到10亿</span><br>        <span class="hljs-comment">// 方法一 for循环累加</span><br>        <span class="hljs-comment">// 方法二</span><br>        ForkJoinPool pool = <span class="hljs-keyword">new</span> ForkJoinPool();<br>        ForkJoinTask&lt;Long&gt; submit = pool.submit(<span class="hljs-keyword">new</span> ForkJoinDemo(<span class="hljs-number">1L</span>,<span class="hljs-number">10_0000_0000L</span>));<span class="hljs-comment">// 提交任务</span><br>        System.out.println(submit.get());<br>        <span class="hljs-comment">// 方法三 最快</span><br>        LongStream.range(<span class="hljs-number">0L</span>,<span class="hljs-number">10_0000_0000L</span>).parallel().reduce(<span class="hljs-number">0</span>,Long::sum);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args[])</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>    CompletableFuture&lt;Void&gt; completableFuture = CompletableFuture.runAsync(()-&gt;&#123;<br>        System.out.println(<span class="hljs-string">&quot;com1执行&quot;</span>);<span class="hljs-comment">// 耗时操作</span><br>    &#125;);<br>    System.out.println(completableFuture.get()); <span class="hljs-comment">// null</span><br><br>    CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(()-&gt;&#123;<br>        System.out.println(<span class="hljs-string">&quot;com2执行&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>; <span class="hljs-comment">// 有返回值</span><br>    &#125;);<br><br>    completableFuture2.whenComplete((t,u)-&gt;&#123;<br>        System.out.println(<span class="hljs-string">&quot;t=&gt;&quot;</span>+t); <span class="hljs-comment">// 正常执行的返回结果</span><br>        System.out.println(<span class="hljs-string">&quot;u=&gt;&quot;</span>+u); <span class="hljs-comment">// 错误信息</span><br>    &#125;).exceptionally((e)-&gt;&#123;<br>        System.out.println(e.getMessage());<span class="hljs-comment">//</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">500</span>; <span class="hljs-comment">// 出错了返回的结果</span><br>    &#125;);<br>    System.out.println(completableFuture2.get());<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h1><p>不存在的东西，是一种约定</p><ul><li>线程解锁前，把共享变量立刻刷新回主存</li><li>加锁前，读取主存最新值到工作内存</li><li>加锁，解锁是同一把锁</li><li>8种指令成对出现</li></ul><p><img src="https://i.loli.net/2020/09/16/CRtclPSLp8x1JHO.png" alt="image-20200916191631727"><img src="https://i.loli.net/2020/09/16/kT5tdLcjEXgv6Gb.png" alt="image-20200916191748437"></p><p>程序不知道主存中的值被修改了。</p><h1 id="Volatile"><a href="#Volatile" class="headerlink" title="Volatile"></a>Volatile</h1><ul><li><p>可见性，上述例子中flag 设置为volatile即可，</p></li><li><p>不保证原子性，在不使用锁的时候，使用原子类可解决原子性问题</p><ul><li>这些原子类与操作系统有关系，在内存中修改值</li><li>Unsafe类，特殊的存在,java的后门，通过它可以操作内存</li></ul></li><li><p>禁止指令重排</p><ul><li><p>你的程序，计算机并不是按照你写的执行</p></li><li><p>源码-》编译器优化重排-》指令并行重排-》内存系统重排-》执行</p></li><li><p><img src="https://i.loli.net/2020/09/16/fPtWAaIg8V5zUNK.png" alt="image-20200916193722473"></p></li><li><p><img src="https://i.loli.net/2020/09/16/SWOzYjcvm8dHuLw.png" alt="image-20200916193934308"></p></li></ul></li></ul><h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p><a href="https://blog.dean0731.top/post/8">https://blog.dean0731.top/post/8</a></p><h1 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">AtomicInteger num = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">2020</span>);<br><span class="hljs-comment">// 比较并交换 cup的并发原语,即能直接操作内存</span><br>num.compareAndSet(<span class="hljs-number">2020</span>,<span class="hljs-number">2021</span>);<br>System.out.println(num.get());<br>num.getAndIncrement();<br></code></pre></td></tr></table></figure><ul><li>比较工作内存与主存中的值，是期望的，执行操作，如果不是，一直循环<ul><li>循环耗时</li><li>一次只能一个共享变量</li><li>ABA问题</li></ul></li></ul><h1 id="原子引用"><a href="#原子引用" class="headerlink" title="原子引用"></a>原子引用</h1><p>带版本号的原子操作</p><h1 id="自旋锁"><a href="#自旋锁" class="headerlink" title="自旋锁"></a>自旋锁</h1><p>CAS实现自旋锁</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpinLock</span></span>&#123;<br>    AtomicReference&lt;Thread&gt; f = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;();<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">// f 可以说就是当前线程， f为空， f就变为当前线程， 其他线程来拿锁的时候不为空，一直循环</span><br>        <span class="hljs-keyword">while</span>(!f.compareAndSet(<span class="hljs-keyword">null</span>,Thread.currentThread()))&#123;<br><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">// 释放锁，</span><br>        f.compareAndSet(Thread.currentThread(),<span class="hljs-keyword">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><p>排查死锁</p><ul><li>jsp -l 可查看运行中的java程序</li><li>jstack 进程号 查看该程序的堆栈信息</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <url>/2022/01/16/cnblog/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="1，线程基础"><a href="#1，线程基础" class="headerlink" title="1，线程基础"></a>1，线程基础</h2><p>1，继承Thread方式的线程</p><ul><li>当需要再此启动一个线程时，需要再创建对象，不能重复使用。</li></ul><p>2，推荐的创建线程方式：继承Runnalbe，使用Thread类</p><ul><li><p>1.5之前就这两种</p></li><li><p>callable 第三种</p><ul><li><p>可以有返回值  call()</p></li><li><p>可以抛出异常</p></li><li><p>支持泛型返回值</p></li><li><p>需要借助FutureTask， 如获取返回值的时候</p></li><li><p>```java<br>class MyThread implements Callable{</p><div class="code-wrapper"><pre><code class="hljs">public Object call() throws Exception&#123;    ....    return null;&#125;</code></pre></div><p>}</p><p>MyThread thread = new MyThread();<br>FutureTask f = new FutureTask(thread);<br>new Thread(f).start();<br>new Thread(f).start(); // 反复执行不会执行，需要定义新的task<br>try{</p><div class="code-wrapper"><pre><code class="hljs">Object ret = f.get();// get()为返回值,会阻塞主线程执行</code></pre></div><p>}catch(InterruptedException){</p><p>}catch(Execution e){</p><p>}</p><figure class="highlight awk"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><pre><code class="hljs awk">    <br>    <br>    <br>    ![image-<span class="hljs-number">20200906142542954</span>](https:<span class="hljs-regexp">//i</span>.loli.net<span class="hljs-regexp">/2020/</span><span class="hljs-number">09</span><span class="hljs-regexp">/06/</span>n7BGHetabZgmRjE.png)<br><br>- 线程池 第四种方式<br><br>  - 提高速度，降低资源消耗<br>  - 便于线程管理：核心池大小，最大线程数，没任务多长时间终止<br><br>  ```java<br>  <span class="hljs-regexp">//</span>Executors 工具类<br>  <span class="hljs-regexp">//</span>ExecutorService 接口<br>  ExecutorService service = Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br>  ThreadPoolExecutor executor = (ThreadPoolExecutor)service;<br>  executor.setxxx() <span class="hljs-regexp">//</span>设置参数<br>  service.execute(Runnable);<br>  service.submit(Callable);<br>  service.shutdown();<br></code></pre></td></tr></table></figure></li></ul></li></ul><p>3，Thread常用方法</p><table><thead><tr><th>getPriority()</th><th>setPrioority(1,5,10)</th><th></th></tr></thead><tbody><tr><td>currentThread() 静态方法</td><td>getName()</td><td>setName()</td></tr><tr><td>yield() 释放cup执行权,变为就绪状态</td><td>join():在A线程中B.join() ,A就阻塞，B执行完到A</td><td></td></tr><tr><td>stop() :过时方法，强制结束线程</td><td>sleep(ms)</td><td>isAlive()</td></tr></tbody></table><p>4，线程分类</p><p>守护线程，用户线程</p><p>守护线程服务用户线程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">thread.setDaemon(<span class="hljs-keyword">true</span>) <span class="hljs-comment">//设置为守护线程</span><br></code></pre></td></tr></table></figure><ul><li>最简单程序main主线程与gc回收线程</li><li>若没有用户线程jvm则结束</li></ul><p>5，线程生命周期</p><ul><li>NEW : 创建对象</li><li>RUNNABLE ：运行 start</li><li>BLOCKED：阻塞 sleep，join，等待同步锁，wait，suspend:过时方法</li><li>WAITING：wait()</li><li>TIMED-WAITING：wait(time)</li><li>TERMINATED：stop，exception，run结束</li></ul><p>阻塞—》就绪：sleep，join结束获取同步锁，notify，resume：过时方法</p><p>6，注意</p><ul><li>wait：阻塞，会释放锁，必须在synchronized内</li><li>sleep：阻塞，不会释放锁，任何时候可以</li></ul><p><font color=red>wait,notify,notifyall,必须在同步方法快内，方法内，不能使用lock，他们调用时是锁对象.wait，要注意 此时syn(锁对象)，两个所对象必须相同</font></p><h2 id="2，线程同步"><a href="#2，线程同步" class="headerlink" title="2，线程同步"></a>2，线程同步</h2><ul><li><p>sync</p><ul><li><p>与wait搭配，notify搭配，若与Lock搭配会造成异常</p></li><li><p>多用while，不用if</p></li><li><p>同步代码块，synchronized 自动锁</p></li><li><p>要求所有相乘同一把锁 synchronized(obj) obj是同一个对象，或同一个类</p></li><li><p>同步方法：当方法内容全部需要同步时 </p></li><li><p>非静态方法锁即时this 需要注意</p></li><li><p>静态方法时，锁时当前类本身</p></li></ul></li><li><p>Lock ：接口 1.5之后</p><ul><li><p>condition </p></li><li><p>能够手动开启同步，结束同步，手动锁，指定睡眠，指定唤醒</p></li><li><p>实现类</p><ul><li>ReentrantLock：功能与synchronized，可重入锁</li><li>ReentrantReadWriteLock.ReadLock，有读锁的线程可以共享该方法，几乎相当于没加锁</li><li>ReentrantReadWriteLock.WriteLock，其他线程不共享该方法</li></ul></li><li><p>```java<br>ReentrantLock lock = new ReentrantLock();<br>final Condition flag1=lock.newCondition();<br>final Condition flag2=lock.newCondition();<br>try{<br>   lock.lock();</p><div class="code-wrapper"><pre><code class="hljs">flag1.await();   ...</code></pre></div><p>}finally{</p><div class="code-wrapper"><pre><code class="hljs">lock.unlock();</code></pre></div><p>}<br>flag2.singal();</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs scss"><br># 3，线程通信<br><br>定制化通信：<br><br>```java<br><span class="hljs-comment">/* 例：</span><br><span class="hljs-comment">* 切菜</span><br><span class="hljs-comment">* 炒菜</span><br><span class="hljs-comment">* 上菜</span><br><span class="hljs-comment">* 同时10道菜</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">// 这里就不能用sync，需要定制化通信（唤醒睡眠的线程）</span><br><span class="hljs-comment">// 顺序：线程 操作 资源类</span><br>Cooking<br>    Lock<br>    condation flag1，flag2，flag3<br>    cut()<br>    cooking()<br>    gaving()<br>Cooking<br>    new thread(()-&gt;&#123;<br>        for(int i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)<br>            cooking<span class="hljs-selector-class">.cut</span>();<br>    &#125;)<span class="hljs-selector-class">.start</span>()<br>    new thread(()-&gt;&#123;<br>        for(int i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)<br>            cooking<span class="hljs-selector-class">.cooking</span>();<br>    &#125;)<span class="hljs-selector-class">.start</span>()<br>    new thread(()-&gt;&#123;<br>        for(int i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)<br>            cooking<span class="hljs-selector-class">.giving</span>();<br>    &#125;)<span class="hljs-selector-class">.start</span>()<br><br></code></pre></td></tr></table></figure></li></ul></li><li><p>lambda表达式</p></li><li><p>接口可写静态方法实现，</p></li><li><p>普通方法实现，加default 关键字即可</p></li></ul><h1 id="4，JUC工具类"><a href="#4，JUC工具类" class="headerlink" title="4，JUC工具类"></a>4，JUC工具类</h1><p>数据库中读写一般不是同步的</p><p>JUC中读写都是同步的，即读写同步，因为JVM线程必须加锁，否则不安全，比数据库严格</p><ul><li><p>ReentraReadWriteLock：读写锁，写程序优先</p></li><li><p>CountDownLatch：计数器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">CountDown count = <span class="hljs-keyword">new</span> CountDown(<span class="hljs-number">10</span>);<br>count.await();  <span class="hljs-comment">// 到此方法时会判断count里面的数值，为0时继续主线程，适用于秒杀业务</span><br></code></pre></td></tr></table></figure></li><li><p>CyclicBarrier：循环栅栏，多个线程处于同一状态时，才继续CyclicBarrier任务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">CyclicBarrier = cyc = <span class="hljs-keyword">new</span> CyclicBarrier(<span class="hljs-number">7</span>,任务)<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>;i++)<br>        <span class="hljs-keyword">new</span> Thread()&#123;<br>        ()-&gt;&#123;<br>            xxxxx<br>            cyc.await();    <br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li><li><p>Semaphere：信号灯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">Sempahere s= <span class="hljs-keyword">new</span> Semaphere(<span class="hljs-number">3</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">7</span>;i++)<br>        <span class="hljs-keyword">new</span> Thread()&#123;<br>        ()-&gt;&#123;<br>            s.acquire();<span class="hljs-comment">// 资源不够时会阻塞</span><br>            xxxx<br>            s.release();<span class="hljs-comment">// 表示释放了资源</span><br>             <br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%9C%A8linux%E8%BF%90%E8%A1%8CTensorflow%E4%BB%A3%E7%A0%81%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2022/01/16/cnblog/%E5%9C%A8linux%E8%BF%90%E8%A1%8CTensorflow%E4%BB%A3%E7%A0%81%E6%89%80%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<p>1，OSError: Unable to open file (file locking disabled on this file system (use HDF5_USE_FILE_LOCKING environment variable to override), errno = 38, error message = 'Function not implemented')</p><p>进入环境变量配置 在~/.brashrc 中添加&nbsp;<code class="language-bash hljs"><span class="hljs-built_in">export HDF5_USE_FILE_LOCKING=<span class="hljs-string">'FALSE'</span></span></code></p><p><span class="hljs-built_in"><span class="hljs-string">2，导入自定义模块出错</span></span></p><p><span class="hljs-built_in"><span class="hljs-string">确定自己写的包名不要与系统中的重复</span></span></p><p><span class="hljs-built_in"><span class="hljs-string">3，路径问题</span></span></p><p><span class="hljs-built_in"><span class="hljs-string">最好使用&ldquo;/&rdquo;,不要使用&lsquo;\&rsquo;</span></span></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E6%A8%A1%E6%9D%BF/"/>
    <url>/2022/01/16/cnblog/%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E6%A8%A1%E6%9D%BF/</url>
    
    <content type="html"><![CDATA[<h1 id="java"><a href="#java" class="headerlink" title="java"></a>java</h1><ul><li>vue-element-admin <a href="https://panjiachen.github.io/vue-element-admin-site/zh/">https://panjiachen.github.io/vue-element-admin-site/zh/</a> 前端<ul><li>el-admin <a href="https://el-admin.vip/">https://el-admin.vip/</a> 前后端分离，前端就是基于上边</li></ul></li><li>ant design pro <a href="https://beta-pro.ant.design/index-cn">https://beta-pro.ant.design/index-cn</a><h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%8F%AC%E5%9B%9E%E7%8E%87%EF%BC%8C%E5%87%86%E7%A1%AE%E7%8E%87/"/>
    <url>/2022/01/16/cnblog/%E5%8F%AC%E5%9B%9E%E7%8E%87%EF%BC%8C%E5%87%86%E7%A1%AE%E7%8E%87/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200101160126031-1153550382.png"></p><p>引用来源：肖潇. 基于深度学习的遥感图像处理系统的设计与实现[D].北京邮电大学,2019.</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%AF%A6%E8%A7%A3/"/>
    <url>/2022/01/16/cnblog/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<ol><li><p>反向传播</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191216122801491-1176775701.png"></p><ol><li>下降的幅度与斜率大小成正比,越到最小点时,每步应越来越小,防止调过头</li><li>某一点导数大小即可表现为 w的变化幅度  w - k * ▽J(w)</li><li>▽J(w)为正表示向左走 w变小  ,为负表示向右走 w会变大</li></ol></li><li><p>简单数字识别案例中</p><ol><li><p>对于一张图片,输入图片特征,经过隐藏层, 转化为10维向量,经过sigmod ,rule后—–&gt;(对应的概率值)</p></li><li><p>此时假设为bad network</p><p>0.1 1————————–1</p><p>0.2  2————————–2 假设为真实值</p><p>0.8  3————————–3</p></li><li><p>此时需要做的就是提高0.2的值,减少其他   (但应该注意,增加2的激活值,比减少1的激活值重要)</p></li><li><p>变动的大小与 目标值与现在值之间的差成正比</p></li><li><p>0.2(激活值) = w0*a1+w0*a2+…….+b 增加激活值</p><ol><li>增加b</li><li>改变权重<ol><li>并不是要增加所有的w,</li><li>每个w对应的a较大时,此时w对激活值的影响较大,把影响大的成为正,小的成为负</li><li>对于0.1 0.8 的变化 也会的到正负变化 综合之后,即可得到上层激活值的变化趋势,</li><li>再次循环,计算上一层</li></ol></li><li>改变上一层激活值a</li></ol></li><li><p>迭代一步,对每一个样本计算,求出权重变化值, 求平均   ,修改权重 再次迭代 ,速度较慢</p></li><li><p>因此划分为小批量,此时迭代一步的数量就是batch的数量 不断循环</p></li></ol></li></ol><p>参考:</p><p><a href="https://www.bilibili.com/video/av16144388?from=search&amp;seid=41428351275121069">https://www.bilibili.com/video/av16144388?from=search&amp;seid=41428351275121069</a></p><p><a href="https://www.bilibili.com/video/av16577449?p=1">https://www.bilibili.com/video/av16577449?p=1</a></p><p><a href="https://zhuanlan.zhihu.com/p/25081671">https://zhuanlan.zhihu.com/p/25081671</a></p><p><a href="http://colah.github.io/posts/2015-08-Backprop/">http://colah.github.io/posts/2015-08-Backprop/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/01/16/cnblog/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-comment">// 修改后的单例模式</span><br> <br><span class="hljs-comment">// 使用线程同步创建，防止进程切换重复创建线程，</span><br><span class="hljs-comment">// 设置volatile关键字修饰，使读取singleton对象时能够获取最新状态</span><br><span class="hljs-comment">// 修改构造方法，防止反射创建对象</span><br><span class="hljs-comment">// 修改readResolve方法，防止反序列化对象时重新创建对象</span><br><span class="hljs-comment">// 重写克隆方法，防止对象克隆</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Singleton2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span>, <span class="hljs-title">Cloneable</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton2 singleton;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton2</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (singleton != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;对象已被创建&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton2 <span class="hljs-title">getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (singleton == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">synchronized</span> (singleton) &#123;<br>                <span class="hljs-keyword">if</span> (singleton == <span class="hljs-keyword">null</span>)<br>                    singleton = <span class="hljs-keyword">new</span> Singleton2();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> singleton;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> Object <span class="hljs-title">readResolve</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> singleton;<br>    &#125;<br> <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> Object <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> CloneNotSupportedException </span>&#123;<br>        <span class="hljs-keyword">return</span> getInstance();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 还可以创建</span><br>Constructor&lt;Singleton2&gt; con = Singleton2.class.getDeclaredConstructor(<span class="hljs-keyword">null</span>);<br>con.setAccessible(<span class="hljs-keyword">true</span>);<br>Singleton2 s1 = con.newInstance();<br>Singleton2 s2 = con.newInstance();<br>System.out.println(s1);<br>System.out.println(s2);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 枚举方式,可以完全防止反射</span><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">Singleton2</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span>,<span class="hljs-title">Cloneable</span></span>&#123;<br>    Singleton2;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Singleton2 <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> Singleton2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"/>
    <url>/2022/01/16/cnblog/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">AService</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AService</span></span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">fly</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;fly......&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// jdk自带动态代理实现方式</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDKHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InvocationHandler</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> Object obj;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        <span class="hljs-comment">// proxy是生成的代理类对象 </span><br>        System.out.println(<span class="hljs-string">&quot;开始时间：&quot;</span>+System.currentTimeMillis());<br>        Object ret = method.invoke(obj,args);<br>        System.out.println(<span class="hljs-string">&quot;结束时间：&quot;</span>+System.currentTimeMillis());<br>        <span class="hljs-keyword">return</span> ret; <span class="hljs-comment">// 返回原方法的结果</span><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JDKHandler</span><span class="hljs-params">(Object obj)</span></span>&#123;<br>        <span class="hljs-keyword">this</span>.obj = obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// cglib方式</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CglibHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">MethodInterceptor</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Object obj, Method method, Object[] args, MethodProxy proxy)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        <span class="hljs-comment">// proxy 是代理的方法对象</span><br>        System.out.println(<span class="hljs-string">&quot;开始时间：&quot;</span>+System.currentTimeMillis());<br>        Object ret = proxy.invokeSuper(obj,args); <span class="hljs-comment">// 注意此处是invokSuper</span><br>        System.out.println(<span class="hljs-string">&quot;结束时间：&quot;</span>+System.currentTimeMillis());<br>        <span class="hljs-keyword">return</span> ret<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        AService service = <span class="hljs-keyword">new</span> AServiceImpl();<br>        AService proxy = (AService) Proxy.newProxyInstance(<br>            AService.class.getClassLoader(),<br>            service.getClass().getInterfaces(),<br>            <span class="hljs-comment">// 此处是子类实现的接口，根据子类获取，不能根据接口类获取</span><br>            <span class="hljs-comment">// Aservice.class.getInterfaces() 错误</span><br>            <span class="hljs-comment">// AserviceImpl.class.getInterfaces()</span><br>            <span class="hljs-keyword">new</span> JDKHandler(service));<br>        proxy.fly();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer();<br>        enhancer.setSuperclass(AServiceImpl.class);<span class="hljs-comment">// 此处是子类，不是接口，要注意</span><br>        enhancer.setCallback(<span class="hljs-keyword">new</span> CglibHandler());<br>        ((AServiceImpl) enhancer.create()).fly();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/"/>
    <url>/2022/01/16/cnblog/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="Nodejs入门"><a href="#Nodejs入门" class="headerlink" title="Nodejs入门"></a>Nodejs入门</h1><p>目标： 控制台输出字符串、使用函数、进行模块化编程</p><h2 id="快速入门-Hello-World"><a href="#快速入门-Hello-World" class="headerlink" title="快速入门-Hello World"></a>快速入门-Hello World</h2><p>1、创建文件夹 nodejs<br>2、创建 helloworld.js</p><blockquote><p>类似于java中的<code>System.out.println(&quot;&quot;)</code></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Hello World!!!&#x27;</span>)<br></code></pre></td></tr></table></figure><p>运行：<code>node helloworld.js</code></p><p>结果：hello world!!!</p><p>3、打开命令行终端：Ctrl + Shift + y</p><p>浏览器的内核包括两部分核心：</p><ul><li>DOM渲染引擎；</li><li>java script 解析器（js引擎）</li><li>js运行在浏览器内核中的js引擎内部</li></ul><h2 id="Node-实现请求响应"><a href="#Node-实现请求响应" class="headerlink" title="Node - 实现请求响应"></a>Node - 实现请求响应</h2><p>1、创建 httpserver.js ；</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导入模块是require 就类似于</span><br><span class="hljs-keyword">import</span> java.io <span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-comment">// 1: 创建一个httpserver服务</span><br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request,response</span>)</span>&#123;    <br>    <span class="hljs-comment">// 浏览器怎么认识hello server!!!     </span><br>    response.writeHead(<span class="hljs-number">200</span>,&#123;<span class="hljs-string">&#x27;Content-type&#x27;</span>:<span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;); <br>    <span class="hljs-comment">//这句话的含义是：告诉浏览器将    </span><br>    <span class="hljs-comment">// 以text-plain去解析hello server 这段数据。    </span><br>    <span class="hljs-comment">// 给浏览器输出内容    </span><br>    response.end(<span class="hljs-string">&quot;&lt;strong&gt;hello server!!!&lt;/strong&gt;&quot;</span>);<br>&#125;).listen(<span class="hljs-number">8888</span>);<br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;你启动的服务是：http://localhpst:8888以启动成功!!&quot;</span>);<br><span class="hljs-comment">// 2: 监听一端口8888</span><br><span class="hljs-comment">// 3: 启动运行服务 node httpserver.js</span><br><span class="hljs-comment">// 4: 在浏览器访问http://localhost:8888</span><br></code></pre></td></tr></table></figure><p>2、运行服务器程序；</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">httpserver</span>.js<br></code></pre></td></tr></table></figure><p>3、服务器启动成功后，在浏览器中输入：<a href="http://localhost:8888/">http://localhost:8888/</a> 查看webserver成功运行，并输出html页面<br>4、停止服务：ctrl + c</p><h2 id="Node-操作MYSQL数据库"><a href="#Node-操作MYSQL数据库" class="headerlink" title="Node-操作MYSQL数据库"></a>Node-操作MYSQL数据库</h2><p>参考：<a href="https://www.npmjs.com/package/mysql">https://www.npmjs.com/package/mysql</a></p><p>1：安装mysql依赖</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> mysql<br></code></pre></td></tr></table></figure><p>2：定义db.js进行操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//1: 导入mysql依赖包,  mysql属于第三方的模块就类似于 java.sql一样的道理</span><br><span class="hljs-keyword">var</span> mysql = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;mysql&quot;</span>);<br><span class="hljs-comment">// 1: 创建一个mysql的Connection对象</span><br><span class="hljs-comment">// 2: 配置数据连接的信息 </span><br><span class="hljs-keyword">var</span> connection =mysql.createConnection(&#123;    <br>    <span class="hljs-attr">host</span>:<span class="hljs-string">&quot;127.0.0.1&quot;</span>,    <br>    <span class="hljs-attr">port</span>:<span class="hljs-number">3306</span>,    <br>    <span class="hljs-attr">user</span>:<span class="hljs-string">&quot;root&quot;</span>,    <br>    <span class="hljs-attr">password</span>:<span class="hljs-string">&quot;mkxiaoer&quot;</span>,    <br>    <span class="hljs-attr">database</span>:<span class="hljs-string">&quot;testdb&quot;</span>&#125;);<br><span class="hljs-comment">// 3：开辟连接</span><br>connection.connect();<br><span class="hljs-comment">// 4: 执行</span><br>curdconnection.query(<span class="hljs-string">&quot;select * from kss_user&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error,results,fields</span>)</span>&#123;    <br>    <span class="hljs-comment">// 如果查询出错，直接抛出    </span><br>    <span class="hljs-keyword">if</span>(error)<span class="hljs-keyword">throw</span> error;    <br>    <span class="hljs-comment">// 查询成功    </span><br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;results = &quot;</span>,results);<br>&#125;);<br><span class="hljs-comment">// 5: 关闭连接connection.end();</span><br><span class="hljs-comment">// 最后一步：运行node db.js 查看效果</span><br></code></pre></td></tr></table></figure><p>3：新建数据库:<code>db_test</code>和表<code>kss_user</code>表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/* Navicat MySQL Data Transfer Source Server         : localhost </span><br><span class="hljs-comment">Source Server Type    : MySQL </span><br><span class="hljs-comment">Source Server Version : 60011 Source </span><br><span class="hljs-comment">Host           : localhost:3306 </span><br><span class="hljs-comment">Source Schema         : testdb </span><br><span class="hljs-comment">Target Server Type    : MySQL </span><br><span class="hljs-comment">Target Server Version : 60011 </span><br><span class="hljs-comment">File Encoding         : 65001 </span><br><span class="hljs-comment">Date: 20/01/2021 21:38:55</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">SET</span> NAMES utf8mb4;<span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><span class="hljs-comment">-- ------------------------------ Table structure for kss_user-- ----------------------------</span><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `kss_user`;<br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `kss_user`  (  <br>`id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,  <br>`name` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8 <span class="hljs-keyword">COLLATE</span> utf8_general_ci <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,  <br><span class="hljs-keyword">PRIMARY</span> KEY (`id`) <span class="hljs-keyword">USING</span> BTREE) ENGINE <span class="hljs-operator">=</span> InnoDB <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> <span class="hljs-operator">=</span> utf8 <span class="hljs-keyword">COLLATE</span> <span class="hljs-operator">=</span> utf8_general_ci ROW_FORMAT <span class="hljs-operator">=</span> Compact;<br><span class="hljs-comment">-- ------------------------------ Records of kss_user-- ----------------------------</span><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `kss_user` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;学相伴&#x27;</span>);<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `kss_user` <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">2</span>, <span class="hljs-string">&#x27;广东&#x27;</span>);<span class="hljs-keyword">SET</span> FOREIGN_KEY_CHECKS <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>4、运行db.js</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">db</span><br></code></pre></td></tr></table></figure><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/20/kuangstudydb338258-faa1-4693-96db-a889c8f2ea7b.png" alt="img"></p><blockquote><p><strong>如果想开发更复杂的基于Node.js的应用程序后台，需要进一步学习Node.js的Web开发相关框架 express，art-template、koa等</strong></p></blockquote><h1 id="ES6的概述"><a href="#ES6的概述" class="headerlink" title="ES6的概述"></a>ES6的概述</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/kuangstudy023c8ce1-5c21-4952-a3fc-279f8f5de5d9.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/kuangstudy058c82ce-044a-4010-a53e-22ea025a12aa.png" alt="img"></p><p>编程语言JavaScript是ECMAScript的实现和扩展 。ECMAScript是由ECMA（一个类似W3C的标准组织）参与进行标准化的语法规范。ECMAScript定义了：</p><ul><li>[语言语法] – 语法解析规则、关键字、语句、声明、运算符等。</li><li>[类型]– 布尔型、数字、字符串、对象等。</li><li>[原型和继承]</li><li>内建对象和函数的</li><li>[标准库] – [JSON]、[Math]、[数组方法]、[对象自省方法]等。</li></ul><p>ECMAScript标准不定义HTML或CSS的相关功能，也不定义类似DOM（文档对象模型）的[Web API]，这些都在独立的标准中进行定义。ECMAScript涵盖了各种环境中JS的使用场景，无论是浏览器环境还是类似[node.js]的非浏览器环境。</p><p>ECMAScript标准的历史版本分别是1、2、3、5。</p><p>那么为什么没有第4版？其实，在过去确实曾计划发布提出巨量新特性的第4版，但最终却因想法太过激进而惨遭废除（这一版标准中曾经有一个极其复杂的支持泛型和类型推断的内建静态类型系统）。</p><p>ES4饱受争议，当标准委员会最终停止开发ES4时，其成员同意发布一个相对谦和的ES5版本，随后继续制定一些更具实质性的新特性。这一明确的协商协议最终命名为“Harmony”，因此，ES5规范中包含这样两句话</p><p>ECMAScript是一门充满活力的语言，并在不断进化中。</p><p>未来版本的规范中将持续进行重要的技术改进</p><p>2009年发布的改进版本ES5，引入了[Object.create()]、[Object.defineProperty()]、[getters]和[setters]、[严格模式]以及[JSON]对象。</p><p>ES6: 是JavaScript语言的下一代标准，2015年6月正式发布。它的目标，是使得JavaScript语言可以用来编写复杂的大型应用程序，成为企业级开发语言。</p><p><strong>小结</strong>：ECMAScript是前端js的语法规范；可以应用在各种js环境中。如：浏览器或者node.js环境。<br>它有很多版本：es1/2/3/5/6，很多新特性，可以在js环境中使用这些新特性。</p><h2 id="ES6的语法：let和const命令"><a href="#ES6的语法：let和const命令" class="headerlink" title="ES6的语法：let和const命令"></a>ES6的语法：let和const命令</h2><blockquote><p>变量和常量的严格区分。</p></blockquote><p><strong>核心代码：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 1： 在javascrit定义数据类型只有一种标识 - var        </span><br><span class="hljs-comment">// 灵活拷问：js有数据类型吗？         </span><br><span class="hljs-comment">// 有，string,number,Object, boolean, undefined         </span><br><span class="hljs-comment">// 什么是语言：电脑内存中，人通过代码和电脑沟通。         </span><br><span class="hljs-keyword">let</span> name = <span class="hljs-string">&quot;zhangsan&quot;</span>;         <br><span class="hljs-keyword">let</span> age = <span class="hljs-number">100</span>;         <br><span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;            <br><span class="hljs-comment">//js被骂没常量         </span><br><span class="hljs-keyword">const</span> PI = <span class="hljs-built_in">Math</span>.PI;         <br><span class="hljs-comment">// 修改会报错         </span><br><span class="hljs-comment">//PI = 1245;         </span><br><span class="hljs-built_in">console</span>.log(PI)         <br><span class="hljs-comment">//var或造成变量穿透         </span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">5</span>;i++)&#123;             <br>             <span class="hljs-built_in">console</span>.log(i);         <br>&#125;;         <br> <span class="hljs-comment">//console.log(&quot;===这里就是变量穿透===&gt;&quot; + i)    </span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/kuangstudyd20c3a12-464d-46d2-93b9-27065ab9ac38.png" alt="img"></p><p><strong>小结</strong>:let : 可变变量 const 是常量  var：最原始。</p><h2 id="ES6的语法：模板字符串"><a href="#ES6的语法：模板字符串" class="headerlink" title="ES6的语法：模板字符串"></a>ES6的语法：模板字符串</h2><p>以前： 我们都是使用 ‘’ 或者 “” 来把字符串套起来</p><p>现在： `` 【反引号】</p><p>第一个用途：基本的字符串格式化。将表达式嵌入字符串中进行拼接。用${}来界定。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//es5    </span><br><span class="hljs-keyword">let</span> name = <span class="hljs-string">&#x27;itcast&#x27;</span>    <br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;hello &#x27;</span> + name)    <br><span class="hljs-comment">//es6    </span><br><span class="hljs-keyword">const</span> name = <span class="hljs-string">&#x27;itcast&#x27;</span>    <br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">`hello <span class="hljs-subst">$&#123;name&#125;</span>`</span>) <br><span class="hljs-comment">//hello itcast</span><br></code></pre></td></tr></table></figure><p>第二个用途：在ES5时我们通过反斜杠()来做多行字符串或者字符串一行行拼接。ES6反引号(``)直接搞定。</p><ul><li>新建一个<code>espro6\demo02.html</code>如下：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> username = <span class="hljs-string">&quot;张三&quot;</span>;        <br><span class="hljs-keyword">var</span> age = <span class="hljs-number">30</span>;       <br><span class="hljs-comment">// 1: 原始的做法就是去拼接字符串        </span><br><span class="hljs-keyword">var</span> str = <span class="hljs-string">&quot;我名字叫 &quot;</span> + username+<span class="hljs-string">&quot;,年龄是: &quot;</span>+age;        <br><span class="hljs-built_in">console</span>.log(str);         <br><span class="hljs-comment">// 2:用模板字符串来拯救 注意：这里是 `（飘键） (tab键盘的上面那个键)        </span><br><span class="hljs-comment">// jdk1.9         </span><br><span class="hljs-keyword">var</span> str2 = <span class="hljs-string">`我名字叫 <span class="hljs-subst">$&#123;username&#125;</span>,年龄是: <span class="hljs-subst">$&#123;age&#125;</span>`</span>;        <br><span class="hljs-built_in">console</span>.log(str2);    <br></code></pre></td></tr></table></figure><h2 id="ES6的语法：函数默认参数与箭头函数"><a href="#ES6的语法：函数默认参数与箭头函数" class="headerlink" title="ES6的语法：函数默认参数与箭头函数"></a>ES6的语法：函数默认参数与箭头函数</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html">// 默认参数 给参数列表设定初始值        <br>function add(a =100,b=100) &#123;            <br>console.log(a,b);            <br>&#125;       <br>// 执行方法，会用默认值填充，打印出来100,200        <br>add();        <br>// 覆盖默认值打印  结果是1，2              <br>add(1,2);    <br></code></pre></td></tr></table></figure><p>箭头函数简化函数的定义，可以让我们不用使用function关键字</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs html">/*箭头函数最直观的三个特点。    <br>1不需要function关键字来创建函数   <br>2省略return关键字   <br>3继承当前上下文的 this 关键字<br>*/<br>// 箭头函数        <br>// 它也是一种函数的定义，它简化定义仅此而已。        <br>// 步骤：1：去掉function  2: 括号后面加箭头。        <br>// 1:声明式的定义        <br>function add ()&#123;        &#125;;       <br>// 2:表达式的定义        <br>var add2 = function()&#123;        &#125;             <br>// 3:箭头函数的定义        <br>var sum = (a = 100,b = 300)=&gt;&#123;            <br>    console.log(a+b);        &#125;;        <br>// 这里执行箭头函数        <br>sum(50,50);        <br>// 这里执行箭头函数       <br>sum();        <br>// 这里执行箭头函数       <br>sum(400);   <br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs html">// 箭头函数       <br>// 它也是一种函数的定义，它简化定义仅此而已。        <br>// 步骤：1：去掉function  2: 括号后面加箭头。        <br>// 无参数的函数       <br>//var sum = function()&#123;        <br>//&#125;        <br>// 箭头改造如下        <br>//var sum = ()=&gt;&#123;&#125;        <br>// 有参数       <br>// 第一种情况  一个参数的如下        <br>//var sum2 = function(a)&#123;        //&#125;;        <br>// 箭头改造如下        <br>var sum2 = (a)=&gt;&#123;&#125;;        <br>var sum2 = a=&gt;&#123;    return a;        &#125;;        <br>// 第二种情况 二个参数的以上,记住括号一定要加        <br>//var sum3 = function(a,b)&#123;        <br>//    return a + b;       <br>//&#125;;        <br>// 箭头改造如下        <br>var sum3 = (a,b)=&gt;&#123;            return a + b;        &#125;;        <br>// 第三种情况，如果没有逻辑体，只有返回值可以简化如下        <br>//var sum4 = function(a,b)&#123;        <br>//    <br>return a + b;        //&#125;;        <br>// 箭头改造如下        <br>var sum4 = (a,b)=&gt;a+b        <br>// 执行        <br>console.log(sum2(100));        <br>console.log(sum3(100,100));        <br>console.log(sum4(100,100));    <br></code></pre></td></tr></table></figure><h2 id="ES6的语法：对象初始化简写"><a href="#ES6的语法：对象初始化简写" class="headerlink" title="ES6的语法：对象初始化简写"></a>ES6的语法：对象初始化简写</h2><p><font color=red><b>核心代码</b></font></p><blockquote><p>它是指：如果一个对象中的key和value的名字一样的情况下可以定义成一个。</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">person</span>(<span class="hljs-params">name, age</span>) </span>&#123;        <br><span class="hljs-comment">//return &#123;name:name,age:age&#125;;        </span><br><span class="hljs-comment">// 对象简写        </span><br><span class="hljs-keyword">return</span> &#123; name, age &#125;;    &#125;;    <br><span class="hljs-comment">// 调用和执行    </span><br><span class="hljs-keyword">var</span> json = person(<span class="hljs-string">&quot;小花花美美&quot;</span>, <span class="hljs-number">20</span>);   <br><span class="hljs-built_in">console</span>.log(json.name, json.age);    <br><span class="hljs-comment">//========================= 实战应用 =========================    </span><br><span class="hljs-comment">//&lt;button onclick=&quot;login()&quot;&gt;登录&lt;/button&gt;    </span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>) </span>&#123;        <br><span class="hljs-keyword">var</span> username = $(<span class="hljs-string">&quot;#username&quot;</span>).val();        <br><span class="hljs-keyword">var</span> password = $(<span class="hljs-string">&quot;#password&quot;</span>).val();        <br><span class="hljs-comment">// 发送ajax        </span><br>$.ajax(&#123;            <br><span class="hljs-attr">type</span>: <span class="hljs-string">&quot;post&quot;</span>,            <br><span class="hljs-comment">// 对象简写           </span><br><span class="hljs-attr">data</span>: &#123; username, password &#125;,            <br><span class="hljs-comment">// 原始写分            </span><br><span class="hljs-comment">//data:&#123;username:username,password:password&#125;,            </span><br><span class="hljs-function"><span class="hljs-title">success</span>(<span class="hljs-params"></span>)</span> &#123;           <br>&#125;        <br>&#125;);    <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ES6的语法：对象解构"><a href="#ES6的语法：对象解构" class="headerlink" title="ES6的语法：对象解构"></a>ES6的语法：对象解构</h2><p><font color=red><b>核心代码</b></font></p><blockquote><p> 对象解构 —- es6提供一些获取快捷获取对象属性和行为方式</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">        </span><br><span class="javascript">    <span class="hljs-comment">// 对象解构 --- es6提供一些获取快捷获取对象属性和行为方式        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> person = &#123;           </span><br><span class="javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;zhangsan&#x27;</span>,            </span><br><span class="javascript">        <span class="hljs-attr">age</span>:<span class="hljs-number">32</span>,            </span><br><span class="javascript">        <span class="hljs-attr">language</span>:<span class="hljs-string">&quot;cn&quot;</span>,            </span><br><span class="javascript">        <span class="hljs-comment">// 函数也有处理            </span></span><br><span class="javascript">        <span class="hljs-comment">/* </span></span><br><span class="hljs-comment"><span class="javascript">        say:function()&#123;                </span></span><br><span class="hljs-comment"><span class="javascript">        console.log(this.name+&quot;年龄是：&quot; + this.age);            </span></span><br><span class="hljs-comment"><span class="javascript">        &#125;  </span></span><br><span class="hljs-comment"><span class="javascript">        */</span>           </span><br><span class="javascript">        <span class="hljs-comment">/* </span></span><br><span class="hljs-comment"><span class="javascript">        say:()=&gt;&#123;               </span></span><br><span class="hljs-comment"><span class="javascript">        console.log(this.name+&quot;年龄是：&quot; + this.age);           </span></span><br><span class="hljs-comment"><span class="javascript">        &#125; </span></span><br><span class="hljs-comment"><span class="javascript">        */</span>            </span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-title">say</span>(<span class="hljs-params"></span>)</span>&#123;               </span><br><span class="javascript">            <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">this</span>.name+<span class="hljs-string">&quot;年龄是：&quot;</span> + <span class="hljs-built_in">this</span>.age);           </span><br><span class="javascript">        &#125;        </span><br><span class="javascript">    &#125;;       </span><br><span class="javascript">    <span class="hljs-comment">// ===========================传统的做法========================        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> name = person.name;        </span><br><span class="javascript">    <span class="hljs-keyword">var</span> age = person.age;        </span><br><span class="javascript">    person.say();       </span><br><span class="javascript">    <span class="hljs-comment">// ===========================对象解构做法========================        </span></span><br><span class="javascript">    <span class="hljs-comment">//es6的做法 前提：默认情况name,age必须是jsonkey.        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> &#123;name,age&#125; = person;       </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(name,age);        </span><br><span class="javascript">    <span class="hljs-comment">// 可以用冒号取小名        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> &#123;name,age,<span class="hljs-attr">language</span>:lan&#125; = person;        </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(name,age,lan);    </span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ES6的语法：传播操作符【…】"><a href="#ES6的语法：传播操作符【…】" class="headerlink" title="ES6的语法：传播操作符【…】"></a>ES6的语法：传播操作符【…】</h2><blockquote><p>把一个对象的属性传播到另外一个对象中</p></blockquote><p><strong>Spread Operator</strong></p><p><font color=red><b>核心代码</b></font></p><p>双击<code>espro6\demo08.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">        </span><br><span class="javascript">    <span class="hljs-comment">// 1： 定义一个对象        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> person1 = &#123;            </span><br><span class="javascript">        <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;小飞飞&#x27;</span>,            </span><br><span class="javascript">        <span class="hljs-attr">age</span>: <span class="hljs-number">16</span>,        </span><br><span class="javascript">    &#125;;        </span><br><span class="javascript">    <span class="hljs-comment">// 2： 对象解构        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> &#123;name,age&#125; = person1;        </span><br><span class="javascript">    <span class="hljs-comment">// =========================== ... 对象融合=====================        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> person2 = &#123;            </span><br><span class="javascript">        ...person1,            </span><br><span class="javascript">        <span class="hljs-attr">gender</span>:<span class="hljs-number">1</span>,            </span><br><span class="javascript">        <span class="hljs-attr">tel</span>:<span class="hljs-number">13478900</span>       </span><br><span class="javascript">    &#125;;        </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(person2);        </span><br><span class="javascript">    <span class="hljs-comment">// =========================== ... 对象取值=====================       </span></span><br><span class="javascript">    <span class="hljs-comment">// ... 对象取值        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> person3 = &#123;            </span><br><span class="javascript">        <span class="hljs-attr">name</span>:<span class="hljs-string">&quot;李四&quot;</span>,            </span><br><span class="javascript">        <span class="hljs-attr">gender</span>:<span class="hljs-number">1</span>,            </span><br><span class="javascript">        <span class="hljs-attr">tel</span>:<span class="hljs-string">&quot;11111&quot;</span>,            </span><br><span class="javascript">        <span class="hljs-attr">address</span>:<span class="hljs-string">&#x27;广州&#x27;</span>        </span><br><span class="javascript">    &#125;;        </span><br><span class="javascript">    <span class="hljs-comment">// ...person4 把剩下没取走给我。        </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> &#123;name,gender,...person4&#125; = person3;       </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(name)       </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(age)        </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(person4)        </span><br><span class="javascript">    <span class="hljs-comment">// =================场景分析 -----伪代码========================       </span></span><br><span class="javascript">    <span class="hljs-comment">// 模拟后台：异步查询返回用户数据 如下：        </span></span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findUsers</span>(<span class="hljs-params"></span>)</span>&#123;            </span><br><span class="javascript">        $.get(<span class="hljs-string">&quot;xxxxx&quot;</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>)</span>&#123;                </span><br><span class="javascript">            <span class="hljs-keyword">var</span> res = &#123;                   </span><br><span class="javascript">                <span class="hljs-attr">pages</span>:<span class="hljs-number">11</span>,                    </span><br><span class="javascript">                <span class="hljs-attr">pageSize</span>:<span class="hljs-number">10</span>,                    </span><br><span class="javascript">                <span class="hljs-attr">pageNo</span>:<span class="hljs-number">1</span>,                    </span><br><span class="javascript">                <span class="hljs-attr">firstFlag</span>:<span class="hljs-literal">true</span>,                    </span><br><span class="javascript">                <span class="hljs-attr">lastFlag</span>:<span class="hljs-literal">false</span>,                   </span><br><span class="javascript">                <span class="hljs-attr">total</span>:<span class="hljs-number">123</span>,                    </span><br><span class="javascript">                <span class="hljs-attr">data</span>:[&#123;&#125;,&#123;&#125;,&#123;&#125;,&#123;&#125;],                </span><br><span class="javascript">            &#125;;                </span><br><span class="javascript">            <span class="hljs-comment">// ==========================对象 ... 取值===============                </span></span><br><span class="javascript">            <span class="hljs-keyword">var</span> &#123;<span class="hljs-attr">data</span>:users,...pagesjon&#125; = res;                </span><br><span class="javascript">            <span class="hljs-comment">//等价于                </span></span><br><span class="javascript">            <span class="hljs-comment">/*  </span></span><br><span class="hljs-comment"><span class="javascript">            var users = res.data;                  </span></span><br><span class="hljs-comment"><span class="javascript">            var pagesjon = &#123;                    </span></span><br><span class="hljs-comment"><span class="javascript">            res = &#123;                        </span></span><br><span class="hljs-comment"><span class="javascript">            pages:11,                        </span></span><br><span class="hljs-comment"><span class="javascript">            pageSize:10,                        </span></span><br><span class="hljs-comment"><span class="javascript">            pageNo:1,                        </span></span><br><span class="hljs-comment"><span class="javascript">            firstFlag:true,                        </span></span><br><span class="hljs-comment"><span class="javascript">            lastFlag:false,                       </span></span><br><span class="hljs-comment"><span class="javascript">            total:123,                    </span></span><br><span class="hljs-comment"><span class="javascript">            &#125;; */</span>            </span><br><span class="javascript">        &#125;)        </span><br><span class="javascript">    &#125;    </span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="ES6的语法：数组map和reduce方法使用-了解"><a href="#ES6的语法：数组map和reduce方法使用-了解" class="headerlink" title="ES6的语法：数组map和reduce方法使用(了解)"></a>ES6的语法：数组map和reduce方法使用(<strong>了解</strong>)</h2><p><strong style="font-size:24px">map()</strong></p><p>方法可以将原数组中的所有元素通过一个函数进行处理并放入到一个新数组中并返回该新数组。</p><p>举例：有一个字符串数组，希望转为int数组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/*********************************map*********************/</span>        <br><span class="hljs-keyword">let</span> arr = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;-5&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>];        <br><span class="hljs-built_in">console</span>.log(arr)       <br><span class="hljs-comment">// 1:数据类型的更改 map自身循环的功能        </span><br><span class="hljs-comment">// 2:map方法可以将原数组中的所有元素通过一个函数进行处理并放入到一个新数组中并返回该新数组。        </span><br><span class="hljs-keyword">var</span> newarr = arr.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>&#123;            <br><span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(value) * <span class="hljs-number">2</span>;        <br>&#125;);        <br><span class="hljs-comment">/*         </span><br><span class="hljs-comment">// 箭头简化01        </span><br><span class="hljs-comment">var newarr = arr.map(value=&gt;&#123;            </span><br><span class="hljs-comment">return parseInt(value) * 2;       </span><br><span class="hljs-comment">&#125;);        </span><br><span class="hljs-comment">// 箭头简化02        </span><br><span class="hljs-comment">var newarr = arr.map(value =&gt; parseInt(value) * 2);        </span><br><span class="hljs-comment">*/</span>        <br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;原数组：&quot;</span>, arr);        <br><span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;map的newarr数组：&quot;</span>, newarr); <span class="hljs-comment">// 2 40 -10 6  </span><br><span class="hljs-comment">/*********************************end map*********************/</span>   <br><span class="hljs-comment">/*********************************reduce*********************/</span>        <br><span class="hljs-comment">//reduce 计算方法        </span><br><span class="hljs-keyword">let</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];        <br><span class="hljs-keyword">var</span> result = arr2.reduce(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b);        <br><span class="hljs-built_in">console</span>.log(result);       <br><span class="hljs-comment">/*********************************end reduce*********************/</span><br><br></code></pre></td></tr></table></figure><p><strong style="font-size:24px">reduce()</strong></p><p>reduce(function(),初始值（可选）) ：</p><p>接收一个函数（必须）和一个初始值（可选），该函数接收两个参数：</p><ul><li>第一个参数是上一次reduce处理的结果</li><li>第二个参数是数组中要处理的下一个元素<br>reduce() 会从左到右依次把数组中的元素用reduce处理，并把处理的结果作为下次reduce的第一个参数。如果是 第一次，会把前两个元素作为计算参数，或者把用户指定的初始值作为起始参数</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">        </span><br><span class="javascript">    <span class="hljs-comment">/*********************************reduce*********************/</span>        </span><br><span class="javascript">    <span class="hljs-comment">//reduce 计算方法         </span></span><br><span class="javascript">    <span class="hljs-keyword">let</span> arr2 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>];        </span><br><span class="javascript">    <span class="hljs-comment">// 箭头写法 -- 1到10相加         </span></span><br><span class="javascript">    <span class="hljs-keyword">var</span> result = arr2.reduce(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b);        </span><br><span class="javascript">    <span class="hljs-comment">// 原始写法  -- 1到10相加        </span></span><br><span class="javascript">    <span class="hljs-comment">//var result = arr2.reduce(function(a,b)&#123;        </span></span><br><span class="javascript">    <span class="hljs-comment">//    return a+b;        </span></span><br><span class="javascript">    <span class="hljs-comment">//</span></span><br><span class="javascript">    &#125;)        </span><br><span class="javascript">    <span class="hljs-built_in">console</span>.log(result);       </span><br><span class="javascript">    <span class="hljs-comment">/*********************************end reduce*********************/</span>    </span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="NPM包管理器"><a href="#NPM包管理器" class="headerlink" title="NPM包管理器"></a>NPM包管理器</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>官方网站：<a href="https://www.npmjs.com/">https://www.npmjs.com/</a><br>NPM全称Node Package Manager，是Node.js包管理工具，是全球最大的模块生态系统，里面所有的模块都是开源免费的；也是Node.js的包管理工具，相当于前端的Maven 。</p><h2 id="使用npm管理项目"><a href="#使用npm管理项目" class="headerlink" title="使用npm管理项目"></a>使用npm管理项目</h2><p>1、创建文件夹npm</p><p>2、项目初始化</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">建立一个空文件夹，在命令提示符进入该文件夹  执行命令初始化</span><br>npm init<br><span class="hljs-meta">#</span><span class="bash">按照提示输入相关信息，如果是用默认值则直接回车即可。</span><br><span class="hljs-meta">#</span><span class="bash">name: 项目名称</span><br><span class="hljs-meta">#</span><span class="bash">version: 项目版本号</span><br><span class="hljs-meta">#</span><span class="bash">description: 项目描述</span><br><span class="hljs-meta">#</span><span class="bash">keywords: &#123;Array&#125;关键词，便于用户搜索到我们的项目</span><br><span class="hljs-meta">#</span><span class="bash">最后会生成package.json文件，这个是包的配置文件，相当于maven的pom.xml</span><br><span class="hljs-meta">#</span><span class="bash">我们之后也可以根据需要进行修改。</span><br><span class="hljs-meta">#</span><span class="bash">如果想直接生成 package.json 文件，那么可以使用命令npm init -y</span><br></code></pre></td></tr></table></figure><h2 id="修改npm镜像"><a href="#修改npm镜像" class="headerlink" title="修改npm镜像"></a>修改npm镜像</h2><p>1、修改npm镜像</p><blockquote><p>NPM官方的管理的包都是从 <a href="http://npmjs.com下载的,但是这个网站在国内速度很慢./">http://npmjs.com下载的，但是这个网站在国内速度很慢。</a></p><p>这里推荐使用淘宝 NPM 镜像 <a href="http://npm.taobao.org/">http://npm.taobao.org/</a></p><p>淘宝 NPM 镜像是一个完整 npmjs.com 镜像，同步频率目前为 10分钟一次，以保证尽量与官方服务同步。</p></blockquote><p>2、设置镜像地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">经过下面的配置，以后所有的</span> <br>npm install 都会经过淘宝的镜像地址下载<br>npm config set registry https://registry.npm.taobao.org <br><span class="hljs-meta">#</span><span class="bash">查看npm配置信息</span><br>npm config list<br></code></pre></td></tr></table></figure><h2 id="npm-install"><a href="#npm-install" class="headerlink" title="npm install"></a>npm install</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">使用</span> <br>npm install 安装依赖包的最新版，<br><span class="hljs-meta">#</span><span class="bash">模块安装的位置：项目目录\node_modules</span><br><span class="hljs-meta">#</span><span class="bash">安装会自动在项目目录下添加 package-lock.json文件，这个文件帮助锁定安装包的版本</span><br><span class="hljs-meta">#</span><span class="bash">同时package.json 文件中，依赖包会被添加到dependencies节点下，类似maven中的 &lt;dependencies&gt;</span><br>npm install jquery<br><span class="hljs-meta">#</span><span class="bash">如果安装时想指定特定的版本</span><br>npm install jquery@2.1.x<br><span class="hljs-meta">#</span><span class="bash">devDependencies节点：开发时的依赖包，项目打包到生产环境的时候不包含的依赖</span><br><span class="hljs-meta">#</span><span class="bash">使用 -D参数将依赖添加到devDependencies节点</span><br>npm install --save-dev eslint<br><span class="hljs-meta">#</span><span class="bash">或</span><br>npm install -D eslint<br><span class="hljs-meta">#</span><span class="bash">全局安装</span><br><span class="hljs-meta">#</span><span class="bash">Node.js全局安装的npm包和工具的位置：用户目录\AppData\Roaming\npm\node_modules</span><br><span class="hljs-meta">#</span><span class="bash">一些命令行工具常使用全局安装的方式</span><br>npm install -g webpack<br><span class="hljs-meta">#</span><span class="bash">npm管理的项目在备份和传输的时候一般不携带node_modules文件夹</span><br>npm install <br><span class="hljs-meta">#</span><span class="bash">根据package.json中的配置下载依赖，初始化项目</span><br></code></pre></td></tr></table></figure><h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">更新包（更新到最新版本）</span><br>npm update 包名<br><span class="hljs-meta">#</span><span class="bash">全局更新</span><br>npm update -g 包名<br><span class="hljs-meta">#</span><span class="bash">卸载包</span><br>npm uninstall 包名<br><span class="hljs-meta">#</span><span class="bash">全局卸载</span><br>npm uninstall -g 包名<br></code></pre></td></tr></table></figure><h1 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>ES6的某些高级语法在浏览器环境甚至是Node.js环境中无法执行。</p><p>Babel是一个广泛使用的转码器，可以将ES6代码转为ES5代码，从而在现有环境执行执行。</p><p>这意味着，你可以现在就用 ES6 编写程序，而不用担心现有环境是否支持。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>安装命令行转码工具</p><blockquote><p>Babel提供babel-cli工具，用于命令行转码。它的安装命令如下：</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g babel-cli<br><span class="hljs-meta">#</span><span class="bash">查看是否安装成功</span><br>babel --version<br></code></pre></td></tr></table></figure><h2 id="Babel的使用"><a href="#Babel的使用" class="headerlink" title="Babel的使用"></a>Babel的使用</h2><p>1、创建babel文件夹</p><p>2、初始化项目</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> init -y<br></code></pre></td></tr></table></figure><p>3、创建文件 src/example.js ，下面是一段ES6代码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">// 转码前<br>// 定义数据<br>let input = [1, 2, 3]<br>// 将数组的每个元素 +1<br>input = input.map(item =&gt; item + 1)console.log(input)<br></code></pre></td></tr></table></figure><p>4、配置 .babelrc</p><blockquote><p>Babel的配置文件是.babelrc，存放在项目的根目录下，该文件用来设置转码规则和插件，基本格式如下。</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;    <span class="hljs-attr">&quot;presets&quot;</span>: [],    <span class="hljs-attr">&quot;plugins&quot;</span>: []&#125;<br></code></pre></td></tr></table></figure><p>presets字段设定转码规则，将es2015规则加入 .babelrc：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;    <span class="hljs-attr">&quot;presets&quot;</span>: [<span class="hljs-string">&quot;es2015&quot;</span>],    <span class="hljs-attr">&quot;plugins&quot;</span>: []&#125;<br></code></pre></td></tr></table></figure><p>5、安装转码器，在项目中安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save-dev babel-preset-es2015<br></code></pre></td></tr></table></figure><p>6、转码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> npm install --save-dev csv-loader xml-loader</span><br><span class="hljs-meta">#</span><span class="bash"> 转码结果写入一个文件</span><br>mkdir dist1<br><span class="hljs-meta">#</span><span class="bash"> --out-file 或 -o 参数指定输出文件</span><br>babel src/example.js --out-file dist1/compiled.js<br><span class="hljs-meta">#</span><span class="bash"> 或者</span><br>babel src/example.js -o dist1/compiled.js<br><span class="hljs-meta">#</span><span class="bash"> 整个目录转码</span><br>mkdir dist2<br><span class="hljs-meta">#</span><span class="bash"> --out-dir 或 -d 参数指定输出目录</span><br>babel src --out-dir dist2<br><span class="hljs-meta">#</span><span class="bash"> 或者</span><br>babel src -d dist2<br></code></pre></td></tr></table></figure><h2 id="自定义脚本"><a href="#自定义脚本" class="headerlink" title="自定义脚本"></a>自定义脚本</h2><p>1、改写package.json</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;    // ...   <br>    &quot;scripts&quot;: &#123;        <br>    // ...        <br>    &quot;build&quot;:  &quot;babel src\\example.js -o dist\\compiled.js&quot;   <br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><p>2、转码的时候，执行下面的命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir dist<br>npm run build<br></code></pre></td></tr></table></figure><h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p><strong>模块化产生的背景</strong></p><p>随着网站逐渐变成”互联网应用程序”，嵌入网页的Javascript代码越来越庞大，越来越复杂。</p><p>Javascript模块化编程，已经成为一个迫切的需求。理想情况下，开发者只需要实现核心的业务逻辑，其他都可以加载别人已经写好的模块。但是，Javascript不是一种模块化编程语言，它不支持”类”（class），包（package）等概念，也不支持”模块”（module）。</p><p><strong>模块化规范</strong></p><ul><li>CommonJS模块化规范</li><li>ES6模块化规范</li></ul><h2 id="CommonJS规范"><a href="#CommonJS规范" class="headerlink" title="CommonJS规范"></a>CommonJS规范</h2><blockquote><p>每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。</p></blockquote><p>1、创建“module”文件夹</p><p>2、创建 mokuai-common-js/四则运算.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 定义成员：</span><br><span class="hljs-keyword">const</span> sum = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;    <br>    <span class="hljs-keyword">return</span> a + b<br>&#125;<br><span class="hljs-keyword">const</span> subtract = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;    <br>    <span class="hljs-keyword">return</span> a - b<br>&#125;<br><span class="hljs-keyword">const</span> multiply = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;    <br>    <span class="hljs-keyword">return</span> a * b<br>&#125;<br><span class="hljs-keyword">const</span> divide = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;    <br>    <span class="hljs-keyword">return</span> a / b<br>&#125;<br></code></pre></td></tr></table></figure><p>3、导出模块中的成员</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 导出成员：</span><br><span class="hljs-built_in">module</span>.exports = &#123;    <br>    <span class="hljs-attr">sum</span>: sum,    <br>    <span class="hljs-attr">subtract</span>: <br>    subtract,    <br>    <span class="hljs-attr">multiply</span>: multiply,    <br>    <span class="hljs-attr">divide</span>: divide<br>&#125;<br></code></pre></td></tr></table></figure><p>简写</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//简写</span><br><span class="hljs-built_in">module</span>.exports = &#123;    sum,    subtract,    multiply,    divide&#125;<br></code></pre></td></tr></table></figure><p>4、创建 mokuai-common-js/引入模块.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//引入模块，注意：当前路径必须写 </span><br><span class="hljs-keyword">const</span> m = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./四则运算.js&#x27;</span>)<br><span class="hljs-built_in">console</span>.log(m)<br><span class="hljs-keyword">const</span> r1 = m.sum(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-keyword">const</span> r2 = m.subtract(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-built_in">console</span>.log(r1,r2)<br></code></pre></td></tr></table></figure><p>5、运行程序</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">引入模块.js</span><br></code></pre></td></tr></table></figure><p><strong>CommonJS使用 exports 和require 来导出、导入模块。</strong></p><h2 id="ES6模块化规范"><a href="#ES6模块化规范" class="headerlink" title="ES6模块化规范"></a>ES6模块化规范</h2><p><strong>ES6使用 export 和 import 来导出、导入模块。</strong></p><p>1、创建 mokuai-es6 文件夹</p><p>2、创建 src/userApi.js 文件，导出模块</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getList</span>(<span class="hljs-params"></span>) </span>&#123;    <br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;获取数据列表&#x27;</span>)<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params"></span>) </span>&#123;    <br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;保存数据&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>3、创建 src/userComponent.js文件，导入模块</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//只取需要的方法即可，多个方法用逗号分隔</span><br><span class="hljs-keyword">import</span> &#123; getList, save &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./userApi.js&#x27;</span><br>getList()<br>save()<br></code></pre></td></tr></table></figure><blockquote><p><strong>注意：这时的程序无法运行的，因为ES6的模块化无法在Node.js中执行，需要用Babel编辑成ES5后再执行。</strong></p></blockquote><p>4、初始化项目</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> init -y<br></code></pre></td></tr></table></figure><p>5、配置 .babelrc</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;    <span class="hljs-attr">&quot;presets&quot;</span>: [<span class="hljs-string">&quot;es2015&quot;</span>],    <span class="hljs-attr">&quot;plugins&quot;</span>: []&#125;<br></code></pre></td></tr></table></figure><p>6、安装转码器，在项目中安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save-dev babel-preset-es2015<br></code></pre></td></tr></table></figure><p>7、定义运行脚本，package.json中增加”build”</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;    <span class="hljs-comment">// ...    &quot;scripts&quot;: &#123;       &quot;build&quot;: &quot;babel src -d dist&quot;    &#125;&#125;</span><br></code></pre></td></tr></table></figure><p>8、执行命令转码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run build<br></code></pre></td></tr></table></figure><p>9、运行程序</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">node dist/userComponent.js<br></code></pre></td></tr></table></figure><h2 id="ES6模块化写法2"><a href="#ES6模块化写法2" class="headerlink" title="ES6模块化写法2"></a>ES6模块化写法2</h2><p>1、创建 src/userApi2.js ，导出模块</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    <br>    <span class="hljs-function"><span class="hljs-title">getList</span>(<span class="hljs-params"></span>)</span> &#123;        <br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;获取数据列表2&#x27;</span>)    <br>     &#125;,    <br>    <span class="hljs-function"><span class="hljs-title">save</span>(<span class="hljs-params"></span>)</span> &#123;        <br>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;保存数据2&#x27;</span>)    <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>2、创建 src/userComponent2.js，导入模块</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> user <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./userApi2.js&quot;</span>user.getList()user.save()<br></code></pre></td></tr></table></figure><p>3、执行命令转码</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-builtin-name">run</span> build<br></code></pre></td></tr></table></figure><p>4、运行程序</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-keyword">node</span> <span class="hljs-title">dist</span>/userComponent2.js<br></code></pre></td></tr></table></figure><h1 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h1><h2 id="什么是Webpack"><a href="#什么是Webpack" class="headerlink" title="什么是Webpack"></a>什么是Webpack</h2><p>Webpack 是一个前端资源加载/打包工具。它将根据模块的依赖关系进行静态分析，然后将这些模块按照指定的规则生成对应的静态资源。</p><p>从图中我们可以看出，Webpack 可以将多种静态资源 js、css、less 转换成一个静态文件，减少了页面的请求。</p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/20/kuangstudy18ef915c-fcab-43a4-abb8-4c1b3cb9f38c.png" alt="img"></p><h2 id="Webpack安装"><a href="#Webpack安装" class="headerlink" title="Webpack安装"></a>Webpack安装</h2><p>1、全局安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g webpack webpack-cli<br></code></pre></td></tr></table></figure><p>2、安装后查看版本号</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">webpack -v<br></code></pre></td></tr></table></figure><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>1、创建webpack文件夹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm init -y<br></code></pre></td></tr></table></figure><p>2、创建src文件夹</p><p>3、src下创建common.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">exports</span>.info = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>&#123;    <br>    <span class="hljs-built_in">document</span>.write(str);<br>&#125;<br></code></pre></td></tr></table></figure><p>4、src下创建utils.js</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">exports.add = function (a, b) &#123;    <br>return a + b;<br>&#125;<br></code></pre></td></tr></table></figure><p>5、src下创建main.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> common = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./common&#x27;</span>);<br><span class="hljs-keyword">const</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils&#x27;</span>);<br>common.info(<span class="hljs-string">&#x27;Hello world!&#x27;</span> + utils.add(<span class="hljs-number">100</span>, <span class="hljs-number">200</span>));<br></code></pre></td></tr></table></figure><h3 id="JS打包"><a href="#JS打包" class="headerlink" title="JS打包"></a>JS打包</h3><p>1、webpack目录下创建配置文件webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>); <br><span class="hljs-comment">//Node.js内置模块</span><br><span class="hljs-built_in">module</span>.exports = &#123;    <br>    <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./src/main.js&#x27;</span>, <br>    <span class="hljs-comment">//配置入口文件    </span><br>    <span class="hljs-attr">output</span>: &#123;        <br>        <span class="hljs-attr">path</span>: path.resolve(__dirname, <span class="hljs-string">&#x27;./dist&#x27;</span>), <br>        <span class="hljs-comment">//输出路径，__dirname：当前文件所在路径        </span><br>        <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;bundle.js&#x27;</span> <br>        <span class="hljs-comment">//输出文件    </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>以上配置的意思是：读取当前项目目录下src文件夹中的main.js（入口文件）内容，分析资源依赖，把相关的js文件打包，打包后的文件放入当前目录的dist文件夹下，打包后的js文件名为bundle.js</p></blockquote><p>2、命令行执行编译命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">webpack --mode=development<br><span class="hljs-meta">#</span><span class="bash">执行后查看bundle.js 里面包含了上面两个js文件的内容并进行了代码压缩</span><br><span class="hljs-meta">#</span><span class="bash"> 实时打包</span>   <br>webpack -w<br></code></pre></td></tr></table></figure><p>也可以配置项目的npm运行命令，修改package.json文件</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-string">&quot;scripts&quot;</span>: &#123;    <br>    <span class="hljs-comment">//...,    </span><br>    <span class="hljs-attr">&quot;dev&quot;</span>: <span class="hljs-string">&quot;webpack --mode=development&quot;</span> <br>&#125;<br></code></pre></td></tr></table></figure><p>运行npm命令执行打包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm run dev<br></code></pre></td></tr></table></figure><p>3、webpack目录下创建index.html ， 引用bundle.js</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;dist/bundle.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>4、浏览器中查看index.html</p><h2 id="Css打包"><a href="#Css打包" class="headerlink" title="Css打包"></a>Css打包</h2><p>1、安装style-loader和 css-loader</p><blockquote><p>Webpack 本身只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。</p><p>Loader 可以理解为是模块和资源的转换器。</p><p>首先我们需要安装相关Loader插件</p><ul><li>css-loader 是将 css 装载到 javascript</li><li>style-loader 是让 javascript 认识css</li></ul></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save-dev style-loader css-loader<br></code></pre></td></tr></table></figure><p>2、修改webpack.config.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;path&quot;</span>); <br><span class="hljs-comment">//Node.js内置模块</span><br><span class="hljs-built_in">module</span>.exports = &#123;    <br>    <span class="hljs-comment">//...,    </span><br>    <span class="hljs-attr">output</span>:&#123;       <br>        <span class="hljs-comment">//其他配置    </span><br>    &#125;,    <br>    <span class="hljs-attr">module</span>: &#123;        <br>        <span class="hljs-attr">rules</span>: [              <br>            &#123;                  <br>                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,   <br>                <span class="hljs-comment">//打包规则应用到以css结尾的文件上                </span><br>                use: [<span class="hljs-string">&#x27;style-loader&#x27;</span>, <span class="hljs-string">&#x27;css-loader&#x27;</span>]            <br>            &#125;          <br>        ]      <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>3、<strong>在src文件夹</strong>创建style.css</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">body</span>&#123;    <span class="hljs-attribute">background</span>:pink;&#125;<br></code></pre></td></tr></table></figure><p>4、修改main.js，在第一行引入style.css</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./style.css&#x27;</span>);<br></code></pre></td></tr></table></figure><p>5、运行编译命令</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">npm <span class="hljs-builtin-name">run</span> dev    <br></code></pre></td></tr></table></figure><p>6、浏览器中查看index.html ， 看看背景是不是变成粉色啦？</p><blockquote><p>把这些知识都学习完毕了，那我们之后学习 Vue 就轻松啦！这些都是现在前端工程师的基础！</p></blockquote><h1 id="Vue-element-admin"><a href="#Vue-element-admin" class="headerlink" title="Vue-element-admin"></a>Vue-element-admin</h1><p><a href="http://panjiachen.github.io/vue-element-admin">vue-element-admin</a> 是一个后台前端解决方案，它基于 <a href="https://github.com/vuejs/vue">vue</a> 和 <a href="https://github.com/ElemeFE/element">element-ui</a>实现。它使用了最新的前端技术栈，内置了 i18 国际化解决方案，动态路由，权限验证，提炼了典型的业务模型，提供了丰富的功能组件，它可以帮助你快速搭建企业级中后台产品原型。相信不管你的需求是什么，本项目都能帮助到你。</p><p>官网地址：<a href="https://panjiachen.github.io/vue-element-admin-site/zh/">https://panjiachen.github.io/vue-element-admin-site/zh/</a></p><p>==<strong>运行工程和编译工程</strong>==</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 克隆项目</span><br>git clone https://github.com/PanJiaChen/vue-element-admin.git<br><span class="hljs-meta">#</span><span class="bash"> 进入项目目录</span><br>cd vue-element-admin<br><span class="hljs-meta">#</span><span class="bash"> 安装依赖</span><br>npm install<br><span class="hljs-meta">#</span><span class="bash"> 建议不要用 cnpm 安装 会有各种诡异的bug 可以通过如下操作解决 npm 下载速度慢的问题</span><br>npm install --registry=https://registry.npm.taobao.org<br><span class="hljs-meta">#</span><span class="bash"> 本地开发 启动项目</span><br>npm run dev<br></code></pre></td></tr></table></figure><p><strong>注意如果老是安装失败：</strong></p><ul><li>请删除 node-modules 然后执行npm install</li><li>或者换个网络</li></ul><p>启动完成后会自动打开浏览器访问 <a href="http://localhost:9527/">http://localhost:9527</a>， 你看到下面的页面就代表操作成功了。</p><p><strong>小结</strong></p><p>nodejs项目几要素</p><ul><li>package.json (npm init \ npmt init -y)</li><li>node_modules (npm install -g jquery/npm iinstall jquery)</li><li>运行是使用：查看官网提供 几乎所有的nodejs都启动和打包都是如下：<ul><li>npm run dev （开发运行）</li><li>npm run build (打包)</li></ul></li></ul><h1 id="探究：package-json"><a href="#探究：package-json" class="headerlink" title="探究：package.json"></a>探究：package.json</h1><p>1：在发布项目或者拷贝项目的时候，<code>node_moudles</code>其实是没意义的。因为它仅仅在开发和打包的时候使用</p><p>2：如果托管代码其实没必要，为什么。因为你package.json文件中已经记录了这些模块坐标。我们可以直接使用<code>npm install</code> 去重新安装和生成<code>node-modules</code> 。所以的nodejs项目下载以后第一个要执行的命令都是<code>npm install</code>的原因也就是如此。</p><p>3：这也就是为什么官方不提供<code>node-modules</code>的原因。因为你可以直接用<code>npm install</code> 去下载</p><p>文章来源:<a href="https://www.kuangstudy.com/">https://www.kuangstudy.com/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/"/>
    <url>/2022/01/16/cnblog/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="前后端分离"><a href="#前后端分离" class="headerlink" title="前后端分离"></a>前后端分离</h1><ul><li><p>前端项目，后端项目</p></li><li><p>前端调用不一致，点击链接—》前端页面—》ajax–》后端接口</p><ul><li><p>封装了请求 ajax ajaxio，request</p><ul><li>每个ajax等请求对应后端一个接口 请求中url:user/add —-&gt;后端/user/add</li></ul></li><li><p>找到配置</p><figure class="highlight properties"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># .environment</span><br><span class="hljs-attr">VUE_APP_BASE_API</span>=<span class="hljs-string">&quot;http://ip:8080&quot; # 后端地址</span><br></code></pre></td></tr></table></figure></li><li><p>Springboot 后端接口 ， 前端调用，vue渲染</p></li></ul></li></ul><p>步骤：</p><ul><li>页面点击–》向前端发送请求，前端路由找到</li><li>前端对应请求，执行操作，向后端拿数据</li><li>显示</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%88%A4%E6%96%ADgpu%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8/"/>
    <url>/2022/01/16/cnblog/%E5%88%A4%E6%96%ADgpu%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;"># 查看Keras 是否可使用gpu<br />from keras import backend as Kgpu =K.tensorflow_backend._get_available_gpus()print(gpu)</pre></div></div><p>　</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;"># 查看tensorflow是否可使用gpuimport tensorflow as tfprint(tf.test.is_gpu_available())</pre></div></div><p>　　</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%E4%B8%8E%E7%94%A8%E6%88%B7%E7%BA%BF%E7%A8%8B/"/>
    <url>/2022/01/16/cnblog/%E5%86%85%E6%A0%B8%E7%BA%BF%E7%A8%8B%E4%B8%8E%E7%94%A8%E6%88%B7%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img2020.cnblogs.com/blog/1333782/202009/1333782-20200916220914937-1542746825.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_5_%E5%86%B3%E7%AD%96%E6%A0%91_%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/"/>
    <url>/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_5_%E5%86%B3%E7%AD%96%E6%A0%91_%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> 决策树,随机森林</span><span style="color: #008000;">#</span><span style="color: #008000;"> 决策树结构:if-then</span><span style="color: #008000;">#</span><span style="color: #008000;"> 信息熵:</span><span style="color: #008000;">#</span><span style="color: #008000;">   例:第一届世界杯32支球队 每个队伍冠军概率1/32</span><span style="color: #008000;">#</span><span style="color: #008000;">               可得 log32(程序员认为的log一般都默认是以2为底) = -(1/32*log(1/32)+1/32*log(1/32).....)</span><span style="color: #008000;">#</span><span style="color: #008000;">           2018 第21届世界杯根据历史数据获胜概率不同   log32  &gt; -(1/4*log(1/4)+1/4*log(1/4).....)</span><span style="color: #008000;">#</span><span style="color: #008000;">           几个log的和即为信息熵,   当概率变化时  log的和是小于log(n)的</span><span style="color: #008000;">#</span><span style="color: #008000;"> 信息熵与不确定性是相联系的</span><span style="color: #008000;">#</span><span style="color: #008000;">   H(X)= -(P(X1)log(P(X1))+P(X2)log(P(X2))......)   概率相同时为log(n)</span><span style="color: #008000;">#</span><span style="color: #008000;">       信息熵越大表示 几率均等,不确定性大</span><span style="color: #008000;">#</span><span style="color: #008000;"> 决策树的划分依据:信息增益 (最大值对应的特征即为重要特征)</span><span style="color: #008000;">#</span><span style="color: #008000;">   当得知一个特征条件之后,减少的信息熵的大小 (构建决策树时,放在前边)</span><span style="color: #008000;">#</span><span style="color: #008000;">   得知x特征的信息,是的类y的信息的不确定性减少的程度</span><span style="color: #008000;">#</span><span style="color: #008000;">   Ck表示某个类的样本数,即某类目标值的数量</span><span style="color: #008000;">#</span><span style="color: #008000;">       g(D,A) 特征A对数据集D的信息增益g(D,A)</span><span style="color: #008000;">#</span><span style="color: #008000;">       H(D) 数据集的信息熵 (根据目标值求) H(D) = -((|C1|/|D|)/log(|C1|/|D|)+(|C2|/|D|)/log(|C2|/|D|)+......)</span><span style="color: #008000;">#</span><span style="color: #008000;">       H(D,A) 给定条件下D的信息熵 H(D,A) = -( (|Di|/|D|)*H(Di) )</span><span style="color: #008000;">#</span><span style="color: #008000;">           例:特征A为年龄,有青年,中年,老年  H(D,A) 表示为 -( 青年占所有的比例*H(青年)+ 中年,老年 )</span><span style="color: #008000;">#</span><span style="color: #008000;">                       H(青年) = 值看青年的数据集    根据目标值  = - ( (目标值1/所有青年数)log(目标值1/所有青年数)+....)</span><span style="color: #008000;">#</span><span style="color: #008000;">    即可根据此 生成决策树</span><span style="color: #008000;">#</span><span style="color: #008000;"> 常用算法 (有的使用基尼系数(不在分析实现方法),有的使用信息增益)</span><span style="color: #008000;">#</span><span style="color: #008000;">   ID3 使用信息增益最大的原则</span><span style="color: #008000;">#</span><span style="color: #008000;">   C45 信使用息增益比最大的准则</span><span style="color: #008000;">#</span><span style="color: #008000;">   CART</span><span style="color: #008000;">#</span><span style="color: #008000;">       回归树:平方误差最小</span><span style="color: #008000;">#</span><span style="color: #008000;">       分类树 基尼系数(划分更加仔细,可以指定数的深度等等) 最小的准则 在skleran中选择划分的默认原则</span><span style="color: #008000;">#</span><span style="color: #008000;"> API</span><span style="color: #008000;">#</span><span style="color: #008000;">   sklearn.tree.DecisionTreeClassifier(Criterion='gini',max_depth=None,random_state=None)</span><span style="color: #008000;">#</span><span style="color: #008000;">   决策树分类器</span><span style="color: #008000;">#</span><span style="color: #008000;">   criterion:默认是gini系数,也可选择信息增益的熵entroy</span><span style="color: #008000;">#</span><span style="color: #008000;">   max_depth:树的深度大小</span><span style="color: #008000;">#</span><span style="color: #008000;">   random_state:随机数种子</span><span style="color: #008000;">#</span><span style="color: #008000;">   method:</span><span style="color: #008000;">#</span><span style="color: #008000;">   decision_path:返回决策树的路径</span><span style="color: #008000;">#</span><span style="color: #008000;"> API sklearn.tree.export_graphviz() 导出DOT格式</span><span style="color: #008000;">#</span><span style="color: #008000;">   tree.export_grahviz(estimator,out_file="",features_names=[])</span><span style="color: #008000;">#</span><span style="color: #008000;">   将dot转换为图片格式</span><span style="color: #008000;">#</span><span style="color: #008000;">   sudo apt-get install graphviz</span><span style="color: #008000;">#</span><span style="color: #008000;">   dot -Tpng tree.dot -o tree.png</span><span style="color: #008000;">#</span><span style="color: #008000;"> ==================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 案例:泰坦尼克号------&gt;根据游客的信息,判断游客是否存活</span><span style="color: #008000;">#</span><span style="color: #008000;"> 数据:http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt</span><span style="color: #008000;">#</span><span style="color: #008000;">       age 项有空缺</span><span style="color: #008000;">#</span><span style="color: #008000;">   "row.names","pclass","survived","name","age","embarked","home.dest","room","ticket","boat","sex"</span><span style="color: #008000;">#</span><span style="color: #008000;">   "1","1st",1,"Allen, Miss Elisabeth Walton",29.0000,"Southampton","St Louis, MO","B-5","24160 L221","2","female"</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> decision():    </span><span style="color: #0000ff;">import</span><span style="color: #000000;"> pandas as pd    </span><span style="color: #800000;">"""</span><span style="color: #800000;">    决策树    :return:     </span><span style="color: #800000;">"""</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 1,获取数据</span>    taitan =pd.read_csv(<span style="color: #800000;">"</span><span style="color: #800000;">http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">)    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 2,处理数据,获取特征值与目标值</span>    x = taitan[[<span style="color: #800000;">'</span><span style="color: #800000;">pclass</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">age</span><span style="color: #800000;">'</span>,<span style="color: #800000;">'</span><span style="color: #800000;">sex</span><span style="color: #800000;">'</span><span style="color: #000000;">]]    y </span>= taitan[<span style="color: #800000;">'</span><span style="color: #800000;">survived</span><span style="color: #800000;">'</span><span style="color: #000000;">]    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 3,处理缺失值</span>    x[<span style="color: #800000;">'</span><span style="color: #800000;">age</span><span style="color: #800000;">'</span>].fillna(x[<span style="color: #800000;">'</span><span style="color: #800000;">age</span><span style="color: #800000;">'</span>].mean(),inplace=True) <span style="color: #008000;">#</span><span style="color: #008000;"> inplace 表示填补</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 4,分割数据</span>    <span style="color: #0000ff;">from</span> sklearn.model_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> train_test_split    x_train,x_test,y_train,y_test </span>= train_test_split(x,y,test_size=0.25<span style="color: #000000;">)<pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 5,特征处理 (对于类别的)使用one-hot编码(将数据转换为数字的形式:例如性别,使用0,1代替)&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;from&lt;/span&gt; sklearn.feature_extraction &lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; DictVectorizerdict &lt;/span&gt;= DictVectorizer(sparse=&lt;span style=&quot;color: #000000;&quot;&gt;False)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; to_dict() 把原来的 数据转换为 [&#123;&#39;sex&#39;:&quot;male&quot;&#125;,&#123;&#125;]格式&lt;/span&gt;x_train = dict.fit_transform(x_train.to_dict(orient=&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;records&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;))x_test &lt;/span&gt;= dict.transform(x_test.to_dict(orient=&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;records&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;))&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 6,决策树处理&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;from&lt;/span&gt; sklearn.tree &lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; DecisionTreeClassifierdec &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; DecisionTreeClassifier()&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; dec = DecisionTreeClassifier(max_depth=5)&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">    dec.fit(x_train,y_train)<br>    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">“</span><span style="color: #800000;">准确率:</span><span style="color: #800000;">“</span><span style="color: #000000;">,dec.score(x_test,y_test))<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 导出决策树结构</span><br>    <span style="color: #0000ff;">from</span> sklearn.tree <span style="color: #0000ff;">import</span><span style="color: #000000;"> export_graphviz<br>    export_graphviz(dec,out_file</span>=<span style="color: #800000;">“</span><span style="color: #800000;">./tree.dot</span><span style="color: #800000;">“</span>,feature_names=[<span style="color: #800000;">“</span><span style="color: #800000;">age</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">pclass=1st</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">pclass=2nd</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">pclass=3rd</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">女性</span><span style="color: #800000;">“</span>,<span style="color: #800000;">“</span><span style="color: #800000;">男性</span><span style="color: #800000;">“</span><span style="color: #000000;">])<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 优点</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   简单的理解和解释 树木可视化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   不需要归一化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 缺点(太过于详细,有些异常点)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   创建的树不能很好的适用于测试集:过拟合</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 改进</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   减枝cart算法 (指定叶子属性:例如若到达该叶子的样本数少于5,就不要了)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   随机森林</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ==========================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 集成学习方法—-随机森林</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   集成学习方法:多个分类器或模型组合</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   什么是随机森林:包含多个分类器,最后的结果取众数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   随机森林的过程,优势(n个样本,m个特征</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       单个树的建立过程:</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">           1,随机在n个中抽取一个样本,重复n次 样本可能重复</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">           2,随机在m个特征中选出M个特征 M&lt;m</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       建立10个树,样本,特征大多不同   随机又放回的抽样 bootstrap抽样</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> API sklearn.ensemble.RandomForestClassifier(n_estimators=10,criterion=”gini” 使用基尼系数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ,max_depth=None,bootstrap=True,random_state=None)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   n_estimators:数量个数默认是10 一般是120,200,300,500,800,1200</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   max_features=”auto” 决策树最大的特征数量,(选取的特征太多,容易过拟合)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   auto:特征数开方,sprt=auto,log2,None</span><br><span style="color: #0000ff;">def</span><span style="color: #000000;"> random_forest():<br>    </span><span style="color: #0000ff;">import</span><span style="color: #000000;"> pandas as pd<br>    </span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>   随机森林<br>    :return:<br>    </span><span style="color: #800000;">“””</span><span style="color: #000000;"><br>    taitan </span>=pd.read_csv(<span style="color: #800000;">“</span><span style="color: #800000;"><a href="http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt">http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt</a></span><span style="color: #800000;">“</span><span style="color: #000000;">)<br>    x </span>= taitan[[<span style="color: #800000;">‘</span><span style="color: #800000;">pclass</span><span style="color: #800000;">‘</span>,<span style="color: #800000;">‘</span><span style="color: #800000;">age</span><span style="color: #800000;">‘</span>,<span style="color: #800000;">‘</span><span style="color: #800000;">sex</span><span style="color: #800000;">‘</span><span style="color: #000000;">]]<br>    y </span>= taitan[<span style="color: #800000;">‘</span><span style="color: #800000;">survived</span><span style="color: #800000;">‘</span><span style="color: #000000;">]<br>    x[</span><span style="color: #800000;">‘</span><span style="color: #800000;">age</span><span style="color: #800000;">‘</span>].fillna(x[<span style="color: #800000;">‘</span><span style="color: #800000;">age</span><span style="color: #800000;">‘</span>].mean(),inplace=<span style="color: #000000;">True)<br>    </span><span style="color: #0000ff;">from</span> sklearn.model_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> train_test_split,GridSearchCV<br>    x_train,x_test,y_train,y_test </span>= train_test_split(x,y,test_size=0.25<span style="color: #000000;">)<br>    </span><span style="color: #0000ff;">from</span> sklearn.feature_extraction <span style="color: #0000ff;">import</span><span style="color: #000000;"> DictVectorizer<br>    dict </span>= DictVectorizer(sparse=<span style="color: #000000;">False)<br>    x_train </span>= dict.fit_transform(x_train.to_dict(orient=<span style="color: #800000;">“</span><span style="color: #800000;">records</span><span style="color: #800000;">“</span><span style="color: #000000;">))<br>    x_test </span>= dict.transform(x_test.to_dict(orient=<span style="color: #800000;">“</span><span style="color: #800000;">records</span><span style="color: #800000;">“</span><span style="color: #000000;">))<br>    </span><span style="color: #0000ff;">from</span> sklearn.ensemble <span style="color: #0000ff;">import</span><span style="color: #000000;"> RandomForestClassifier<br>    rf </span>=<span style="color: #000000;"> RandomForestClassifier()<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 网格搜索与交叉验证</span><br>    gc =GridSearchCV(rf,param_grid={<span style="color: #800000;">“</span><span style="color: #800000;">n_estimators</span><span style="color: #800000;">“</span>:[120,200,300,500,800,1200],<span style="color: #800000;">“</span><span style="color: #800000;">max_depth</span><span style="color: #800000;">“</span>:[5,8,15,25,30]},cv=2<span style="color: #000000;">)<br>    gc.fit(x_train,y_train)<br>    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">“</span><span style="color: #800000;">随机森林准确率</span><span style="color: #800000;">“</span><span style="color: #000000;">,gc.score(x_test,y_test))<br>    </span><span style="color: #0000ff;">print</span>(<span style="color: #800000;">“</span><span style="color: #800000;">随机森林选择的参数模型</span><span style="color: #800000;">“</span><span style="color: #000000;">,gc.best_params_)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 极好的准确率,有效使用在大数据,不需要降维</span><br><span style="color: #0000ff;">if</span> <span style="color: #800080;"><strong>name</strong></span> ==<span style="color: #800000;">“</span><span style="color: #800000;"><strong>main</strong></span><span style="color: #800000;">“</span><span style="color: #000000;">:<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;">decision()</span><br>    random_forest()</pre></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_4_k%E8%BF%91%E9%82%BB_%E8%B4%9D%E5%8F%B6%E6%96%AF_%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0/"/>
    <url>/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_4_k%E8%BF%91%E9%82%BB_%E8%B4%9D%E5%8F%B6%E6%96%AF_%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #000000;">机器学习常用算法k近邻算法  求出未知点 与周围最近的 k个点的距离  查看这k个点中大多数是哪一类  根号((x已知</span>-x未知)^2+(y已知-y未知)^2<span style="color: #000000;">)  即平面间2点距离公式  收异常点影响较大,因此需要做标准化处理  API:sklearn.neighbors.KNeighborsClassifier(n_neighbors</span>=5,algorithm=<span style="color: #800000;">"</span><span style="color: #800000;">auto</span><span style="color: #800000;">"</span><span style="color: #000000;">)      algorithm:{</span><span style="color: #800000;">"</span><span style="color: #800000;">auto</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">ball_tree</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">kd_tree</span><span style="color: #800000;">"</span>,<span style="color: #800000;">"</span><span style="color: #800000;">brute</span><span style="color: #800000;">"</span><span style="color: #000000;">}          效率不同          ball_tree:会使用BallTree          kd_tree:会使用KdTree          auto:尝试根据传递的fit方法的值决定最适合的算法      n_neighbors: 邻居数,默认为5处理:  时间特征:需要转为年,月,日,时,分,秒 ,当做几个新的特征处理,并不是全部要加入,要根据结果选择加入  目标值:可以去掉某些目标值</span><span style="color: #0000ff;">from</span> sklearn.neighbors <span style="color: #0000ff;">import</span><span style="color: #000000;"> KNeighborsClassifier</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> knnCls():    </span><span style="color: #800000;">"""</span><span style="color: #800000;">    预测鸢尾花的种类    :return:    </span><span style="color: #800000;">"""</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 读取数据</span>    <span style="color: #0000ff;">from</span> sklearn.datasets <span style="color: #0000ff;">import</span><span style="color: #000000;"> load_iris    iris </span>=<span style="color: #000000;"> load_iris()    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(iris.feature_names)    </span><span style="color: #0000ff;">print</span>(iris.data[0:5<span style="color: #000000;">,:])    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(iris.data)<pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 处理数据&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 1,缩小数据  对于csv中的数据可使用 data.query(&quot;id&amp;gt;8 &amp;amp; money &amp;lt;2000&quot;) 等过滤掉一些数据&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 2,时间处理&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   time_value = pd.to_datetime(data中的时间列,unit=&quot;s&quot;) unit 表示时间最小的单位&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;        time_value格式为 1970-01-01 00:00:00 注意不能单独获取年月日&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   time_value=pd.DatatimeIndex(time_value) 此时转换为字典格式的时间&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   增加特征,例如年相同,就不能当做特征&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;       data[&#39;day&#39;] = time_value.day,weekday,hour等不建议使用 此方式&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;           建议使用data.loc[&quot;day&quot;] = xxx&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;       pandas使用data.drop([&quot;time&quot;],axis=1) 删除原来的时间戳,&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;       数组使用np.delete(data,[1,2,3等列],axis=1) 删除原来的时间戳&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 3,目标值处理&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     目标值过多,单有的目标值数量太少,可以忽略&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     分组求和,本例中 可表示为 把数量少于n个的种类删除(虽然本类中目标值只有3个,其实不用删除,只为演示效果)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     group = data.groupby(&quot;目标值列名&quot;).count()&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     此时返回结果 列数不变,目标值列名列为所有的目标值,其他列不再是值,而是分组后该组的个数&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     tf = group[group[&#39;非目标值列列名&#39;]&amp;gt;n].reset_index()&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     data = data[data[目标列列名].isin(tf.目标列列名)]&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     取出目标值 y =data[&quot;目标列&quot;]&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     取出目标值 x =data.drop([&quot;目标列&quot;],axis=1)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;     x_train,y_train,x_test,y_test数据分割 train_test_spilt&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 特征工程(标准化)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   x_train 进行fit_transform&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   注意 也需要对 x_test进行标准化,注意使用 transform即可, 即 使用 训练集的参数进行标准化&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;   标准化对数据最后结果影响很大&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 算法处理&lt;/span&gt;knn = KNeighborsClassifier(n_neighbors=5&lt;span style=&quot;color: #000000;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; fit ,predict,score&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">    knn.fit(x_train,y_train)<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 得出结果</span><br>    y_predict = knn.predict(x_test) <span style="color: #008000;">#</span><span style="color: #008000;"> 得出预测目标值</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 得出准确率</span><br>    knn.score(x_test,y_test) <span style="color: #008000;">#</span><span style="color: #008000;"> 也可以使用y_predict与y_test 得出</span><br>    <span style="color: #0000ff;">return</span><span style="color: #000000;"> None<br>问题1:k的取值问题,很大,很小?<br>    很大:易受异常点影响<br>    很小:容易受k值(数量)波动<br>性能问题:每一个未知数来都需要与全部数据进行计算<br>    很费时间<br>调参:n_neighbors 的合适值</p><p>优点:易于理解,易实现,无需参数(算法里边的参数)估计,无需训练<br>缺点:计算慢,耗内存,必须有k</p><p>朴素(条件独立)贝叶斯算法 (需要学习概率相关内容)<br>概率:<br>  条件概率:P(A1,A2</span>|B) = P(A1|B)<em>P(A2|<span style="color: #000000;">B)  A1,A2 不能相互影响  应该是条件独立<br>  联合概率 P(A,B) </span>= P(A)</em><span style="color: #000000;">P(B)<br>例:常用与对于文章的分类<br>  每个文章会计算属于每个分类的概率,比较数据那个的概率较大,就是该分类<br>P(科技</span>|<span style="color: #000000;">文章1)  文档<br>P(科技</span>|<span style="color: #000000;">词1,词2…..)  文档:词1,词2….  (多个条件下 x的概率)<br>朴素贝叶斯</span>-<span style="color: #000000;">贝叶斯公式<br /><img src="https://img2018.cnblogs.com/blog/1333782/201910/1333782-20191005115818655-2067406970.png" alt="" /></span></pre></p><p>&nbsp;</p><div class="code-wrapper"><pre><span style="color: #000000;"></span></pre></div><p>&nbsp;P(A|B)=P(B|A)P(A)/P(B)</p><div class="code-wrapper"><pre>=====================================<span style="color: #000000;">个人体会:例 有两个箱子 A:两黑,两白球 B两黑球,1白球  随机从两个盒子中拿出一个球,是白球, 求是从A中拿出的概率  P(A</span>|白) = (P(白|A)P(A))/P(白) = 0.5*0.5/(1/2*1/2+1/2*1/3)=7/12<span style="color: #000000;">  P(B</span>|白) = (P(白|B)P(B))/P(白) = 1/3*0.5/(1/2*1/2+1/2*2/3)=5/12<br />贝叶斯推导:<a href="https://www.cnblogs.com/lliuye/p/9178090.html">https://www.cnblogs.com/lliuye/p/9178090.html</a>=====================================<span style="color: #000000;">  求在包含这些词的情况下是科技类的概率</span>=在科技分类下这些词(这个文档)出现的概率*科技类的概率/<span style="color: #000000;">在所有文档中,这些词的概率  P(C</span>|W)=(P(W|C)P(C))/<span style="color: #000000;">P(W)      W为给定文档的特征值(频数统计,预测文档提供),C为文档类别      可理解为:P(C</span>|F1,F2.....)=(P(F1,F2..|C)P(C))/<span style="color: #000000;">P(F1,F2,....)  P(C):每个文档类别的概率(某类文档数</span>/<span style="color: #000000;">文档总数)  P(W</span>|<span style="color: #000000;">C):给定列别下 特征(词)的概率      P(F1</span>|C) = Ni/<span style="color: #000000;">N (表示该次出现在科技文章中的概率)   F1,F2.....的概率乘积  表示 科技类文章中这些词都出现的概率          Ni为F1词在c类所有文档中出现的次数,(科技类文章中改词的次数)          N为c类文档下所有词的总和 .(科技类文章中 所有的词 和)  有些情况下得到文章属于某类的概率为0,不合理      解决办法:拉普拉斯平滑系数  P(F1</span>|C) = (Ni+a)/N+<span style="color: #000000;">am          a:指定系数一般为1,m为训练文档中出现的特征词的个数算法API sklearn.native_bayes.MultinomiaNB  sklearn.native_bayes.MultinomiaNB(alpha</span>=1.0<span style="color: #000000;">) 拉普拉斯平滑系数,不属于超参数例:新闻分类</span><span style="color: #0000ff;">from</span> sklearn.datasets <span style="color: #0000ff;">import</span><span style="color: #000000;"> fetch_20newsgroups</span><span style="color: #0000ff;">from</span> sklearn.model_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> train_test_split</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> naviebayes():    </span><span style="color: #800000;">"""</span><span style="color: #800000;">    朴素贝叶斯进行文章分类    :return:    </span><span style="color: #800000;">"""</span>    <span style="color: #008000;">#</span><span style="color: #008000;"> 加载数据,进行分割</span>    news = fetch_20newsgroups(subset=<span style="color: #800000;">"</span><span style="color: #800000;">all</span><span style="color: #800000;">"</span><span style="color: #000000;">)    x_train,x_test,y_train,y_test </span>= train_test_split(news.data,news.target,test_size=0.25<span style="color: #000000;">)    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 生成文章特征词</span>    <span style="color: #0000ff;">from</span> sklearn.feature_extraction.text <span style="color: #0000ff;">import</span><span style="color: #000000;"> TfidfVectorizer    </span><span style="color: #0000ff;">from</span> sklearn.metrics.classification <span style="color: #0000ff;">import</span><span style="color: #000000;"> classification_report    tf </span>=<span style="color: #000000;"> TfidfVectorizer()<pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;以训练集中词的列表进行 每篇文章重要性统计&lt;/span&gt;x_train =&lt;span style=&quot;color: #000000;&quot;&gt; tf.fit_transform(x_train)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; print(tf.get_feature_names()) # 全部文章中所有的词&lt;/span&gt;x_test =&lt;span style=&quot;color: #000000;&quot;&gt; tf.transform(x_test)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 朴素贝叶斯进行评估&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;from&lt;/span&gt; sklearn.naive_bayes &lt;span style=&quot;color: #0000ff;&quot;&gt;import&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; MultinomialNBmlt &lt;/span&gt;= MultinomialNB(alpha=1.0&lt;span style=&quot;color: #000000;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;print(x_train) # .toarray 可转化为二维数组&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;(0, 122986)    0.1189432263044612 # 第一篇文章中 feature_names下标122986的这个词 出现的频率(0, 139798)    0.25782353561208343(0, 117722)    0.12774899257629055&lt;/span&gt;&lt;span style=&quot;color: #800000;&quot;&gt;&quot;&quot;&quot;&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;mlt.fit(x_train,y_train)y_predict &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; mlt.predict(x_test)&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;print&lt;/span&gt;(classification_report(y_test,y_predict,target_names=&lt;span style=&quot;color: #000000;&quot;&gt;news.target_names))&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; 算出准确率,由于文章词的数量确定,数据的正确性,因此 准确率不易提高&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;#&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; print(mlt.score(x_test,y_test))&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">优点:<br>  发源于古典数学,有稳定的分类效率<br>  速度快,效率高<br>  对数据缺失不敏感,常用于文本分类<br>缺点:<br>  前提是一个词的出现与另一个无关,当词之间出现关联时,效果不好<br></span><span style="color: #0000ff;">if</span> <span style="color: #800080;"><strong>name</strong></span> == <span style="color: #800000;">“</span><span style="color: #800000;"><strong>main</strong></span><span style="color: #800000;">“</span><span style="color: #000000;">:<br>    </span><span style="color: #008000;">#</span><span style="color: #008000;"> knnCls()</span><br><span style="color: #000000;">    naviebayes()<br>    </span><span style="color: #0000ff;">pass</span><span style="color: #000000;"><br>模型评估(不仅靠准确率,还有召回率)<br>  准确率:estimator.score() 最常见是预测结果的准确率,即百分比<br>  混淆矩阵<br>准确率 </span>35%,但召回率 75%<br><span style="color: #800000;">“””</span><span style="color: #800000;">                         预测结果<br>                         正例(猫)   假例(不是猫)<br>真实结果    20正例(猫)       真正例(15)     伪反例(5)<br>真实结果    80假例(不是猫)    伪正例(60)     真反例(20)<br></span><span style="color: #800000;">“””</span><span style="color: #000000;"><br>  精确率:预测为正例的样本中,真正例的比例<br>  召回率:真实值正例中,预测为正例的比例 </span>15/20<span style="color: #000000;"> 越高越好<br>其他分类标准F1</span>-<span style="color: #000000;">SCORE 反映了模型的稳健性<br>  F1 </span>= 2<em>精确率</em>召回率/(精确率+<span style="color: #000000;">召回率)<br>API sklearn.metrics.classification_reportly(y_true,y_pred,target_names</span>=<span style="color: #000000;">None)<br>  y_true:真实目标值<br>  y_pred:估计器预测目标值<br>  terget_names:目标类别名称<br>  </span><span style="color: #0000ff;">return</span><span style="color: #000000;">:每个类(目标值)的精确率与召回率<br>模型选择与调优<br>  交叉验证:让别评估模型更加准确<br>      训练集分为n份:训练集(n</span>-1)份+<span style="color: #000000;">验证集1份 得出一个准确率 模型一<br>      再次训练集分为n份:训练集(n</span>-1)份+<span style="color: #000000;">验证集1份(就是修改验证集,可能此时第一份为验证集) 得出一个准确率 模型二<br>      ….. 依次进行 得出n个准确率   求平均 即可以作为可信一点的模型结果<br>      分为n份就称为n折交叉验证<br>  网格搜索(超参数搜索):调参数(k近邻)<br>      与交叉验证组合k </span>= 3,5,7<span style="color: #000000;"> 10折交叉验证<br>          k</span>=3 时的平均,k=<span style="color: #000000;">5的平均…  比较即可得出比较可信的k值<br>      当有两个找参数时:两两组合<br>  API sklearn.model_selection.GridSearchCV(estimator,param_grid</span>=none,cv=<span style="color: #000000;">None)<br>      estimator:估计器(knn) 此时估计器中不用再写超参数<br>      param_grid:估计参数 {</span><span style="color: #800000;">“</span><span style="color: #800000;">n_neighbors</span><span style="color: #800000;">“</span>:[1,2,3,4,5<span style="color: #000000;">]}<br>      cv:几折交叉验证<br>          不用 knn.fit predict<br>      此时返回的实例<br>          fit(x_train,y_train):输入训练数据<br>          score(x_test,y_test):准确率<br>          best_score_:在交叉验证中最好的结果<br>          best_estimator_:在交叉验证中最好的参数模型<br>          cv_results_:每次交叉验证后验证集集准确率和训练集准确率(验证集平均值)<br></span><span style="color: #0000ff;">from</span> sklearn.model_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> GridSearchCV<br>gc </span>= GridSearchCV(KNeighborsClassifier(),param_grid={<span style="color: #800000;">“</span><span style="color: #800000;">n_neighbors</span><span style="color: #800000;">“</span>:[1,2,3,4,5<span style="color: #000000;">]})<br>gc.fit(x_train,y_train)</span></pre></p></div><p>&nbsp;</p><div class="code-wrapper"><pre>机器学习常用算法<br /><span style="font-family: 'Consolas';">k</span>近邻算法<br />  求出未知点 与周围最近的 <span style="font-family: 'Consolas';">k</span>个点的距离<br />  查看这<span style="font-family: 'Consolas';">k</span>个点中大多数是哪一类<br />  根号<span style="font-family: 'Consolas';">((x</span>已知<span style="font-family: 'Consolas';">-x</span>未知<span style="font-family: 'Consolas';">)^</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">+(y</span>已知<span style="font-family: 'Consolas';">-y</span>未知<span style="font-family: 'Consolas';">)^</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">)  </span>即平面间<span style="font-family: 'Consolas';">2</span>点距离公式<br />  收异常点影响较大<span style="font-family: 'Consolas';">,</span>因此需要做标准化处理<br />  <span style="font-family: 'Consolas';">API:sklearn.neighbors.KNeighborsClassifier(</span><span style="color: #660099; font-family: 'Consolas';">n_neighbors</span><span style="font-family: 'Consolas';">=</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">,</span><span style="color: #660099; font-family: 'Consolas';">algorithm</span><span style="font-family: 'Consolas';">=</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"auto"</span><span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">      algorithm:{</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"auto"</span><span style="font-family: 'Consolas';">,</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"ball_tree"</span><span style="font-family: 'Consolas';">,</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"kd_tree"</span><span style="font-family: 'Consolas';">,</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"brute"</span><span style="font-family: 'Consolas';">}<br /></span>效率不同<br />          <span style="font-family: 'Consolas';">ball_tree:</span>会使用<span style="font-family: 'Consolas';">BallTree<br /></span><span style="font-family: 'Consolas';">          kd_tree:</span>会使用<span style="font-family: 'Consolas';">KdTree<br /></span><span style="font-family: 'Consolas';">          auto:</span>尝试根据传递的<span style="font-family: 'Consolas';">fit</span>方法的值决定最适合的算法<br />      <span style="font-family: 'Consolas';">n_neighbors: </span>邻居数<span style="font-family: 'Consolas';">,</span>默认为<span style="font-family: 'Consolas';">5<br /></span>处理<span style="font-family: 'Consolas';">:<br /></span>时间特征<span style="font-family: 'Consolas';">:</span>需要转为年<span style="font-family: 'Consolas';">,</span>月<span style="font-family: 'Consolas';">,</span>日<span style="font-family: 'Consolas';">,</span>时<span style="font-family: 'Consolas';">,</span>分<span style="font-family: 'Consolas';">,</span>秒 <span style="font-family: 'Consolas';">,</span>当做几个新的特征处理<span style="font-family: 'Consolas';">,</span>并不是全部要加入<span style="font-family: 'Consolas';">,</span>要根据结果选择加入<br />  目标值<span style="font-family: 'Consolas';">:</span>可以去掉某些目标值<br /><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.neighbors </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">KNeighborsClassifier<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">def </span><span style="font-family: 'Consolas';">knnCls():<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">"""<br /></span><span style="color: #808080; font-style: italic; font-family: '標楷體';">预测鸢</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">尾花的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">种类<br /></span><span style="color: #808080; font-weight: bold; font-family: 'Consolas';">:return</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">:<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    """<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    # </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">读</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">取</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.datasets </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">load_iris<br /></span><span style="font-family: 'Consolas';">    iris = load_iris()<br /></span><span style="color: #000080; font-family: 'Consolas';">print</span><span style="font-family: 'Consolas';">(iris.feature_names)<br /></span><span style="color: #000080; font-family: 'Consolas';">print</span><span style="font-family: 'Consolas';">(iris.data[</span><span style="color: #0000ff; font-family: 'Consolas';">0</span><span style="font-family: 'Consolas';">:</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">,:])<br /></span><span style="color: #000080; font-family: 'Consolas';">print</span><span style="font-family: 'Consolas';">(iris.data)<br /></span><span style="font-family: 'Consolas';"><br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">处</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">理</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># 1,</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">缩</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">小</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据  </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">对</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">于</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">csv</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">中的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据可使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> data.query("id&gt;8 &amp; money &lt;2000") </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">等</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">过滤</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">掉一些</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># 2,</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间处</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">理<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#   time_value = pd.to_datetime(data</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">中的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,unit="s") unit </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">表示</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">最小的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">单</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">位<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#        time_value</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">格式</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">为</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> 1970-01-01 00:00:00 </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">注意不能</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">单独获</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">取年月日<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#   time_value=pd.DatatimeIndex(time_value) </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">此</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时转换为</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">字典格式的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#   </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">增加特征</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">例如年相同</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">就不能</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">当</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">做特征<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#       data['day'] = time_value.day,weekday,hour</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">等不建</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">议</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">使用 此方式<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#           </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">建</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">议</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">data.loc["day"] = xxx<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #       pandas</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">data.drop(["time"],axis=1) </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">删</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">除原</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">来</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">戳</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #       </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数组</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">np.delete(data,[1,2,3</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">等列</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">],axis=1) </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">删</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">除原</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">来</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时间</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">戳<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># 3,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值处</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">理<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#     </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值过</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">多</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">单</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">有的目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">量太少</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">可以忽略<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#     </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">分</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">组</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">求和</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">本例中 可表示</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">为 </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">把</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">量少于</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">n</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">个</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">种类删</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">除</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">(</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">虽</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">然本</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">类</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">中目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">只有</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">3</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">个</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">其</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">实</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">不用</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">删</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">除</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">只</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">为</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">演示效果</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     group = data.groupby("</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列名</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">").count()<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">此</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">时</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">返回</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">结</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">果 列</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">不</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">变</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列名列</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">为</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">所有的目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">其他列不再是</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">值</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">而是分</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">组</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">后</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">该组</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">个数<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#     tf = group[group['</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">非目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列列名</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">']&gt;n].reset_index()<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     data = data[data[</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列列名</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">].isin(tf.</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列列名</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">)]<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">取出目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> y =data["</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">"]<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">取出目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> x =data.drop(["</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">列</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">"],axis=1)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #     x_train,y_train,x_test,y_test</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据分割</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> train_test_spilt<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    # </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">特征工程</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">(</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">准化</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #   x_train </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">fit_transform<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    #   </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">注意 也需要</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">对</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> x_test</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">准化</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">注意使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"> transform</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">即可</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">, </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">即 使用 </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">训练</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">集的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">参数进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">准化<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#   </span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">准化</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">对数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据最后</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">结</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">果影</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">响</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">很大<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">算法</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">处</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">理<br /></span><span style="font-family: 'Consolas';">knn = KNeighborsClassifier(</span><span style="color: #660099; font-family: 'Consolas';">n_neighbors</span><span style="font-family: 'Consolas';">=</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># fit ,predict,score<br /></span><span style="font-family: 'Consolas';">knn.fit(x_train,y_train)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">得出</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">结</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">果<br /></span><span style="color: #808080; font-family: 'Consolas';">y_predict </span><span style="font-family: 'Consolas';">= knn.predict(x_test) </span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">得出</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">预测</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">目</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">标值<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">得出准确率<br /></span><span style="font-family: 'Consolas';">knn.score(x_test,y_test) </span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">也可以使用</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">y_predict</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">与</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">y_test </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">得出<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">return None<br /></span>问题<span style="font-family: 'Consolas';">1:k</span>的取值问题<span style="font-family: 'Consolas';">,</span>很大<span style="font-family: 'Consolas';">,</span>很小<span style="font-family: 'Consolas';">?<br /></span>很大<span style="font-family: 'Consolas';">:</span>易受异常点影响<br />    很小<span style="font-family: 'Consolas';">:</span>容易受<span style="font-family: 'Consolas';">k</span>值<span style="font-family: 'Consolas';">(</span>数量<span style="font-family: 'Consolas';">)</span>波动<br />性能问题<span style="font-family: 'Consolas';">:</span>每一个未知数来都需要与全部数据进行计算<br />    很费时间<br />调参<span style="font-family: 'Consolas';">:n_neighbors </span>的合适值<br /><br />优点<span style="font-family: 'Consolas';">:</span>易于理解<span style="font-family: 'Consolas';">,</span>易实现<span style="font-family: 'Consolas';">,</span>无需参数<span style="font-family: 'Consolas';">(</span>算法里边的参数<span style="font-family: 'Consolas';">)</span>估计<span style="font-family: 'Consolas';">,</span>无需训练<span style="font-family: 'Consolas';">\<br /></span>缺点<span style="font-family: 'Consolas';">:</span>计算慢<span style="font-family: 'Consolas';">,</span>耗内存<span style="font-family: 'Consolas';">,</span>必须有<span style="font-family: 'Consolas';">k<br /></span><span style="font-family: 'Consolas';"><br /></span>朴素<span style="font-family: 'Consolas';">(</span>条件独立<span style="font-family: 'Consolas';">)</span>贝叶斯算法 <span style="font-family: 'Consolas';">(</span>需要学习概率相关内容<span style="font-family: 'Consolas';">)<br /></span>概率<span style="font-family: 'Consolas';">:<br /></span>条件概率<span style="font-family: 'Consolas';">:P(A1,A2|B) = P(A1|B)*P(A2|B)  A1,A2 </span>不能相互影响  应该是条件独立<br />  联合概率 <span style="font-family: 'Consolas';">P(A,B) = P(A)*P(B)<br /></span>例<span style="font-family: 'Consolas';">:</span>常用与对于文章的分类<br />  每个文章会计算属于每个分类的概率<span style="font-family: 'Consolas';">,</span>比较数据那个的概率较大<span style="font-family: 'Consolas';">,</span>就是该分类<br /><span style="font-family: 'Consolas';">P(</span>科技<span style="font-family: 'Consolas';">|</span>文章<span style="font-family: 'Consolas';">1)  </span>文档<br /><span style="font-family: 'Consolas';">P(</span>科技<span style="font-family: 'Consolas';">|</span>词<span style="font-family: 'Consolas';">1,</span>词<span style="font-family: 'Consolas';">2.....)  </span>文档<span style="font-family: 'Consolas';">:</span>词<span style="font-family: 'Consolas';">1,</span>词<span style="font-family: 'Consolas';">2....  (</span>多个条件下 <span style="font-family: 'Consolas';">x</span>的概率<span style="font-family: 'Consolas';">)<br /></span>朴素贝叶斯<span style="font-family: 'Consolas';">-</span>贝叶斯公式<br /><span style="font-family: 'Consolas';">=====================================<br /></span>个人体会<span style="font-family: 'Consolas';">:</span>例 有两个箱子 <span style="font-family: 'Consolas';">A:</span>两黑<span style="font-family: 'Consolas';">,</span>两白球 <span style="font-family: 'Consolas';">B</span>两黑球<span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">1</span>白球<br />  随机从两个盒子中拿出一个球<span style="font-family: 'Consolas';">,</span>是白球<span style="font-family: 'Consolas';">, </span>求是从<span style="font-family: 'Consolas';">A</span>中拿出的概率<br />  <span style="font-family: 'Consolas';">P(A|</span>白<span style="font-family: 'Consolas';">) = (P(</span>白<span style="font-family: 'Consolas';">|A)P(A))/P(</span>白<span style="font-family: 'Consolas';">) = </span><span style="color: #0000ff; font-family: 'Consolas';">0.5</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">0.5</span><span style="font-family: 'Consolas';">/(</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">+</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">)=</span><span style="color: #0000ff; font-family: 'Consolas';">7</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">12<br /></span><span style="font-family: 'Consolas';">P(B|</span>白<span style="font-family: 'Consolas';">) = (P(</span>白<span style="font-family: 'Consolas';">|B)P(B))/P(</span>白<span style="font-family: 'Consolas';">) = </span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">0.5</span><span style="font-family: 'Consolas';">/(</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">+</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">*</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">)=</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">12<br /></span><span style="font-family: 'Consolas';">=====================================<br /></span>求在包含这些词的情况下是科技类的概率<span style="font-family: 'Consolas';">=</span>在科技分类下这些词<span style="font-family: 'Consolas';">(</span>这个文档<span style="font-family: 'Consolas';">)</span>出现的概率<span style="font-family: 'Consolas';">*</span>科技类的概率<span style="font-family: 'Consolas';">/</span>在所有文档中<span style="font-family: 'Consolas';">,</span>这些词的概率<br />  <span style="font-family: 'Consolas';">P(C|W)=(P(W|C)P(C))/P(W)<br /></span><span style="font-family: 'Consolas';">      W</span>为给定文档的特征值<span style="font-family: 'Consolas';">(</span>频数统计<span style="font-family: 'Consolas';">,</span>预测文档提供<span style="font-family: 'Consolas';">),C</span>为文档类别<br />      可理解为<span style="font-family: 'Consolas';">:P(C|F1,F2.....)=(P(F1,F2..|C)P(C))/P(F1,F2,....)<br /></span><span style="font-family: 'Consolas';">  P(C):</span>每个文档类别的概率<span style="font-family: 'Consolas';">(</span>某类文档数<span style="font-family: 'Consolas';">/</span>文档总数<span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">  P(W|C):</span>给定列别下 特征<span style="font-family: 'Consolas';">(</span>词<span style="font-family: 'Consolas';">)</span>的概率<br />      <span style="font-family: 'Consolas';">P(F1|C) = Ni/N (</span>表示该次出现在科技文章中的概率<span style="font-family: 'Consolas';">)   F1,F2.....</span>的概率乘积  表示 科技类文章中这些词都出现的概率<br />          <span style="font-family: 'Consolas';">Ni</span>为<span style="font-family: 'Consolas';">F1</span>词在<span style="font-family: 'Consolas';">c</span>类所有文档中出现的次数<span style="font-family: 'Consolas';">,(</span>科技类文章中改词的次数<span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">          N</span>为<span style="font-family: 'Consolas';">c</span>类文档下所有词的总和 <span style="font-family: 'Consolas';">.(</span>科技类文章中 所有的词 和<span style="font-family: 'Consolas';">)<br /></span>有些情况下得到文章属于某类的概率为<span style="font-family: 'Consolas';">0,</span>不合理<br />      解决办法<span style="font-family: 'Consolas';">:</span>拉普拉斯平滑系数  <span style="font-family: 'Consolas';">P(F1|C) = (Ni+a)/N+am<br /></span><span style="font-family: 'Consolas';">          a:</span>指定系数一般为<span style="font-family: 'Consolas';">1,m</span>为训练文档中出现的特征词的个数<br />算法<span style="font-family: 'Consolas';">API sklearn.native_bayes.MultinomiaNB<br /></span><span style="font-family: 'Consolas';">  sklearn.native_bayes.MultinomiaNB(</span><span style="color: #660099; font-family: 'Consolas';">alpha</span><span style="font-family: 'Consolas';">=</span><span style="color: #0000ff; font-family: 'Consolas';">1.0</span><span style="font-family: 'Consolas';">) </span>拉普拉斯平滑系数<span style="font-family: 'Consolas';">,</span>不属于超参数<br />例<span style="font-family: 'Consolas';">:</span>新闻分类<br /><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.datasets </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">fetch_20newsgroups<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.model_selection </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">train_test_split<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">def </span><span style="font-family: 'Consolas';">naviebayes():<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">"""<br /></span><span style="color: #808080; font-style: italic; font-family: 'Batang';">朴素</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">贝</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">叶斯</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行文章分</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">类<br /></span><span style="color: #808080; font-weight: bold; font-family: 'Consolas';">:return</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">:<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    """<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">    # </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">加</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">载数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行分割<br /></span><span style="font-family: 'Consolas';">news = fetch_20newsgroups(</span><span style="color: #660099; font-family: 'Consolas';">subset</span><span style="font-family: 'Consolas';">=</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"all"</span><span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">    x_train,x_test,y_train,y_test = train_test_split(news.data,news.target,</span><span style="color: #660099; font-family: 'Consolas';">test_size</span><span style="font-family: 'Consolas';">=</span><span style="color: #0000ff; font-family: 'Consolas';">0.25</span><span style="font-family: 'Consolas';">)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">生成文章特征</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">词<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.feature_extraction.text </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">TfidfVectorizer<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.metrics.classification </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">classification_report<br /></span><span style="font-family: 'Consolas';">    tf = TfidfVectorizer()<br /></span><span style="font-family: 'Consolas';"><br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">以</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">训练</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">集中</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">词</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的列表</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行 每篇文章重要性</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">统计<br /></span><span style="font-family: 'Consolas';">x_train = tf.fit_transform(x_train)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># print(tf.get_feature_names()) # </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">全部文章中所有的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">词<br /></span><span style="font-family: 'Consolas';">x_test = tf.transform(x_test)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">朴素</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">贝</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">叶斯</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">进</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">行</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">评</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">估<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.naive_bayes </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">MultinomialNB<br /></span><span style="font-family: 'Consolas';">    mlt = MultinomialNB(</span><span style="color: #660099; font-family: 'Consolas';">alpha</span><span style="font-family: 'Consolas';">=</span><span style="color: #0000ff; font-family: 'Consolas';">1.0</span><span style="font-family: 'Consolas';">)<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">#print(x_train) # .toarray </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">可</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">转</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">化</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">为</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">二</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">维数组<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"""<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    (0, 122986)    0.1189432263044612 # </span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">第一篇文章中</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';"> feature_names</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">下</span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">标</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">122986</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">的</span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">这个词 </span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">出</span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">现</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">的</span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">频</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">率</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';"><br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    (0, 139798)    0.25782353561208343<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    (0, 117722)    0.12774899257629055<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    """<br /></span><span style="font-family: 'Consolas';">mlt.fit(x_train,y_train)<br /></span><span style="font-family: 'Consolas';">    y_predict = mlt.predict(x_test)<br /></span><span style="color: #000080; font-family: 'Consolas';">print</span><span style="font-family: 'Consolas';">(classification_report(y_test,y_predict,</span><span style="color: #660099; font-family: 'Consolas';">target_names</span><span style="font-family: 'Consolas';">=news.target_names))<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># </span><span style="color: #808080; font-style: italic; font-family: 'Batang';">算出准确率</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">由于文章</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">词</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">的</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">量确定</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: '標楷體';">数</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">据的正确性</span><span style="color: #808080; font-style: italic; font-family: 'Consolas';">,</span><span style="color: #808080; font-style: italic; font-family: 'Batang';">因此 准确率不易提高<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># print(mlt.score(x_test,y_test))<br /></span>优点<span style="font-family: 'Consolas';">:<br /></span>发源于古典数学<span style="font-family: 'Consolas';">,</span>有稳定的分类效率<br />  速度快<span style="font-family: 'Consolas';">,</span>效率高<br />  对数据缺失不敏感<span style="font-family: 'Consolas';">,</span>常用于文本分类<br />缺点<span style="font-family: 'Consolas';">:<br /></span>前提是一个词的出现与另一个无关<span style="font-family: 'Consolas';">,</span>当词之间出现关联时<span style="font-family: 'Consolas';">,</span>效果不好<br /><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">if </span><span style="font-family: 'Consolas';">__name__ == </span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"__main__"</span><span style="font-family: 'Consolas';">:<br /></span><span style="color: #808080; font-style: italic; font-family: 'Consolas';"># knnCls()<br /></span><span style="font-family: 'Consolas';">naviebayes()<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">pass<br /></span>模型评估<span style="font-family: 'Consolas';">(</span>不仅靠准确率<span style="font-family: 'Consolas';">,</span>还有召回率<span style="font-family: 'Consolas';">)<br /></span>准确率<span style="font-family: 'Consolas';">:estimator.score() </span>最常见是预测结果的准确率<span style="font-family: 'Consolas';">,</span>即百分比<br />  混淆矩阵<br />准确率 <span style="color: #0000ff; font-family: 'Consolas';">35</span><span style="font-family: 'Consolas';">%,</span>但召回率 <span style="color: #0000ff; font-family: 'Consolas';">75</span><span style="font-family: 'Consolas';">%<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"""                         </span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">预测结</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">果<br /></span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">                         正例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">猫</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">)   </span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">假例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">不是猫</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">)<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">真实结</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">果</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    20</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">正例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">猫</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">)       </span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">真</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">正例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(15)     </span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">伪</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">反例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(5)<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">真实结</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">果</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">    80</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">假例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">不是猫</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">)    </span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">伪</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">正例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(60)     </span><span style="color: #008080; font-weight: bold; font-family: 'Arial';">真</span><span style="color: #008080; font-weight: bold; font-family: 'BatangChe';">反例</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">(20)<br /></span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"""<br /></span>精确率<span style="font-family: 'Consolas';">:</span>预测为正例的样本中<span style="font-family: 'Consolas';">,</span>真正例的比例<br />  召回率<span style="font-family: 'Consolas';">:</span>真实值正例中<span style="font-family: 'Consolas';">,</span>预测为正例的比例 <span style="color: #0000ff; font-family: 'Consolas';">15</span><span style="font-family: 'Consolas';">/</span><span style="color: #0000ff; font-family: 'Consolas';">20 </span>越高越好<br />其他分类标准<span style="font-family: 'Consolas';">F1-SCORE </span>反映了模型的稳健性<br />  <span style="font-family: 'Consolas';">F1 = </span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">*</span>精确率<span style="font-family: 'Consolas';">*</span>召回率<span style="font-family: 'Consolas';">/(</span>精确率<span style="font-family: 'Consolas';">+</span>召回率<span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">API sklearn.metrics.classification_reportly(y_true,y_pred,</span><span style="color: #660099; font-family: 'Consolas';">target_names</span><span style="font-family: 'Consolas';">=</span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">None</span><span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">  y_true:</span>真实目标值<br />  <span style="font-family: 'Consolas';">y_pred:</span>估计器预测目标值<br />  <span style="font-family: 'Consolas';">terget_names:</span>目标类别名称<br />  <span style="color: #000080; font-weight: bold; font-family: 'Consolas';">return</span><span style="font-family: 'Consolas';">:</span>每个类<span style="font-family: 'Consolas';">(</span>目标值<span style="font-family: 'Consolas';">)</span>的精确率与召回率<br />模型选择与调优<br />  交叉验证<span style="font-family: 'Consolas';">:</span>让别评估模型更加准确<br />      训练集分为<span style="font-family: 'Consolas';">n</span>份<span style="font-family: 'Consolas';">:</span>训练集<span style="font-family: 'Consolas';">(n-</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">)</span>份<span style="font-family: 'Consolas';">+</span>验证集<span style="font-family: 'Consolas';">1</span>份 得出一个准确率 模型一<br />      再次训练集分为<span style="font-family: 'Consolas';">n</span>份<span style="font-family: 'Consolas';">:</span>训练集<span style="font-family: 'Consolas';">(n-</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">)</span>份<span style="font-family: 'Consolas';">+</span>验证集<span style="font-family: 'Consolas';">1</span>份<span style="font-family: 'Consolas';">(</span>就是修改验证集<span style="font-family: 'Consolas';">,</span>可能此时第一份为验证集<span style="font-family: 'Consolas';">) </span>得出一个准确率 模型二<br />      <span style="font-family: 'Consolas';">..... </span>依次进行 得出<span style="font-family: 'Consolas';">n</span>个准确率   求平均 即可以作为可信一点的模型结果<br />      分为<span style="font-family: 'Consolas';">n</span>份就称为<span style="font-family: 'Consolas';">n</span>折交叉验证<br />  网格搜索<span style="font-family: 'Consolas';">(</span>超参数搜索<span style="font-family: 'Consolas';">):</span>调参数<span style="font-family: 'Consolas';">(k</span>近邻<span style="font-family: 'Consolas';">)<br /></span>与交叉验证组合<span style="font-family: 'Consolas';">k = </span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">7 10</span>折交叉验证<br />          <span style="font-family: 'Consolas';">k=</span><span style="color: #0000ff; font-family: 'Consolas';">3 </span>时的平均<span style="font-family: 'Consolas';">,k=</span><span style="color: #0000ff; font-family: 'Consolas';">5</span>的平均<span style="font-family: 'Consolas';">...  </span>比较即可得出比较可信的<span style="font-family: 'Consolas';">k</span>值<br />      当有两个找参数时<span style="font-family: 'Consolas';">:</span>两两组合<br />  <span style="font-family: 'Consolas';">API sklearn.model_selection.GridSearchCV(estimator,</span><span style="color: #660099; font-family: 'Consolas';">param_grid</span><span style="font-family: 'Consolas';">=none,</span><span style="color: #660099; font-family: 'Consolas';">cv</span><span style="font-family: 'Consolas';">=</span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">None</span><span style="font-family: 'Consolas';">)<br /></span><span style="font-family: 'Consolas';">      estimator:</span>估计器<span style="font-family: 'Consolas';">(knn) </span>此时估计器中不用再写超参数<br />      <span style="font-family: 'Consolas';">param_grid:</span>估计参数 <span style="font-family: 'Consolas';">{</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"n_neighbors"</span><span style="font-family: 'Consolas';">:[</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">4</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">]}<br /></span><span style="font-family: 'Consolas';">      cv:</span>几折交叉验证<br />          不用 <span style="font-family: 'Consolas';">knn.fit predict<br /></span>此时返回的实例<br />          <span style="font-family: 'Consolas';">fit(x_train,y_train):</span>输入训练数据<br />          <span style="font-family: 'Consolas';">score(x_test,y_test):</span>准确率<br />          <span style="font-family: 'Consolas';">best_score_:</span>在交叉验证中最好的结果<br />          <span style="font-family: 'Consolas';">best_estimator_:</span>在交叉验证中最好的参数模型<br />          <span style="font-family: 'Consolas';">cv_results_:</span>每次交叉验证后验证集集准确率和训练集准确率<span style="font-family: 'Consolas';">(</span>验证集平均值<span style="font-family: 'Consolas';">)<br /></span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">from </span><span style="font-family: 'Consolas';">sklearn.model_selection </span><span style="color: #000080; font-weight: bold; font-family: 'Consolas';">import </span><span style="font-family: 'Consolas';">GridSearchCV<br /></span><span style="font-family: 'Consolas';">gc = GridSearchCV(KNeighborsClassifier(),</span><span style="color: #660099; font-family: 'Consolas';">param_grid</span><span style="font-family: 'Consolas';">={</span><span style="color: #008080; font-weight: bold; font-family: 'Consolas';">"n_neighbors"</span><span style="font-family: 'Consolas';">:[</span><span style="color: #0000ff; font-family: 'Consolas';">1</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">2</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">3</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">4</span><span style="font-family: 'Consolas';">,</span><span style="color: #0000ff; font-family: 'Consolas';">5</span><span style="font-family: 'Consolas';">]})<br /></span><span style="font-family: 'Consolas';">gc.fit(x_train,y_train)<br /></span></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_3_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%A6%82%E8%BF%B0/"/>
    <url>/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_3_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%A6%82%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> 机器学习_概述</span><span style="color: #008000;">#</span><span style="color: #008000;">   数据类型:连续性,离散型</span><span style="color: #008000;">#</span><span style="color: #008000;">   算法分类</span><span style="color: #008000;">#</span><span style="color: #008000;">       监督学习(特征值+目标值):(预测)</span><span style="color: #008000;">#</span><span style="color: #008000;">           分类: k近邻算法 贝叶斯 决策树与随机森林 逻辑递归 神经网络</span><span style="color: #008000;">#</span><span style="color: #008000;">           回归: 线性回归 岭回归</span><span style="color: #008000;">#</span><span style="color: #008000;">           标注: 隐马尔可夫模型(不做要求)</span><span style="color: #008000;">#</span><span style="color: #008000;">       无监督学习(只有特征值)</span><span style="color: #008000;">#</span><span style="color: #008000;">           聚类: k-means</span><span style="color: #008000;">#</span><span style="color: #008000;">   机器学习流程</span><span style="color: #008000;">#</span><span style="color: #008000;">       建立模型:(根据数据类型划分应用种类)  模型:算法+数据</span><span style="color: #008000;">#</span><span style="color: #008000;">       1,获取数据</span><span style="color: #008000;">#</span><span style="color: #008000;">       2,明确问题</span><span style="color: #008000;">#</span><span style="color: #008000;">       3,数据的基本处理:(pd:缺失值,合并表.....)</span><span style="color: #008000;">#</span><span style="color: #008000;">       4,特征工程(特征处理),重要</span><span style="color: #008000;">#</span><span style="color: #008000;">       5,找到合适的算法去预测</span><span style="color: #008000;">#</span><span style="color: #008000;">           不合格 -----&gt;换算法,特征工程再处理</span><span style="color: #008000;">#</span><span style="color: #008000;">       6,模型的评估,判定效果</span><span style="color: #008000;">#</span><span style="color: #008000;"> ---------------------------------------------------------</span><span style="color: #008000;">#</span><span style="color: #008000;"> 数据集概述</span><span style="color: #0000ff;">from</span> sklearn.datasets <span style="color: #0000ff;">import</span><span style="color: #000000;"> load_iris,fetch_20newsgroups,load_boston</span><span style="color: #0000ff;">from</span> sklearn.model_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> train_test_split</span><span style="color: #008000;">#</span><span style="color: #008000;">   测试集:75%</span><span style="color: #008000;">#</span><span style="color: #008000;">   测试集:25% 评估模型是否有效</span><span style="color: #008000;">#</span><span style="color: #008000;">   数据划分API:sklearn.model_selection.train_test_split  可把数据分为测试集,与训练集</span><span style="color: #008000;">#</span><span style="color: #008000;">   数据集API:sklearn.datasets</span><span style="color: #008000;">#</span><span style="color: #008000;">       data.load_*() 获取小规模数据,数据包含在datasets中</span><span style="color: #008000;">#</span><span style="color: #008000;">       data.fetch_*(data_home=None)</span><span style="color: #008000;">#</span><span style="color: #008000;">           获取大规模数据,从网络中下载data_home表示下载目录 默认 ~/scikit_learn_data/</span><span style="color: #008000;">#</span><span style="color: #008000;">       上边返回的数据类型是datasets.base.Bunch(字典格式)</span><span style="color: #008000;">#</span><span style="color: #008000;">           data:特征数据数组 [n_sample*n_features]二维数组</span><span style="color: #008000;">#</span><span style="color: #008000;">           target:标签数组,是n_sample的一维数组 numpy.ndarray数组(按照标签转换后的值)</span><span style="color: #008000;">#</span><span style="color: #008000;">           DESC:数据描述</span><span style="color: #008000;">#</span><span style="color: #008000;">           feature_names:特征名,新闻数据,手写数据,回归数据没有</span><span style="color: #008000;">#</span><span style="color: #008000;">           target_names:标签名(目标值)</span><span style="color: #008000;">#</span><span style="color: #008000;"> =================================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 分类数据集</span><span style="color: #008000;">#</span><span style="color: #008000;"> 导入获取数据集</span><span style="color: #008000;">#</span><span style="color: #008000;"> iris = load_iris()  # 字典格式Bunch</span><span style="color: #008000;">#</span><span style="color: #008000;"> sklearn.model_selection.train.test_split(*arrays,**options)</span><span style="color: #008000;">#</span><span style="color: #008000;"> x_train,x_test,y_train,y_test=train_test_split(x=iris.data,y=iris.target,test_size=0.25)</span><span style="color: #800000;">"""</span><span style="color: #800000;">x:数据集的特征值 (通常有多个)y:数据集的标签值test_size:测试集大小,一般为float,集测试集所占比例默认75% random_state:随机种子,不同的种子,会造成不同的采样结果return 训练集,测试集,训练标签,测试标签  (接受时注意顺序不要改变)</span><span style="color: #800000;">"""</span><span style="color: #008000;">#</span><span style="color: #008000;"> -----  分类大数据集 ------------------</span><span style="color: #008000;">#</span><span style="color: #008000;"> sklearn.datasets.fetch_20newsgroups(data_home=None,subset="train")</span><span style="color: #008000;">#</span><span style="color: #008000;">   subset:"train" 或者 "test","all"</span><span style="color: #008000;">#</span><span style="color: #008000;"> new = fetch_20newsgroups(data_home=None,subset="all")  # 默认~/scikit_learn_data/</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(type(new))</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(new.target)</span><span style="color: #008000;">#</span><span style="color: #008000;"> ==========================================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 回归数据集</span><span style="color: #008000;">#</span><span style="color: #008000;"> sklearn.datasets.load_boston()</span><span style="color: #008000;">#</span><span style="color: #008000;"> bos = load_boston()</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(bos.data.shape)</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(bos.feature_names)</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(bos.target)</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(bos.DESCR)</span><span style="color: #008000;">#</span><span style="color: #008000;"> ========================================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 转换器</span><span style="color: #008000;">#</span><span style="color: #008000;">   :fit_transform = fit(负责产生均值,方差等数据) + transform(根据产生的方差等转换数据)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 预估器estimator :一类实现了算法的API</span><span style="color: #008000;">#</span><span style="color: #008000;">   分类估计器</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.neighbors k近邻</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.naive_bayes 贝叶斯</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.linear_model.LogisticRegression 逻辑回归</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.tree    决策树与随机森林</span><span style="color: #008000;">#</span><span style="color: #008000;">   回归的估计器</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.linear_model.LinearRegression 线性回归</span><span style="color: #008000;">#</span><span style="color: #008000;">       sklearn.linear_model.Ridge 岭回归</span></pre></div></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_2_%E7%89%B9%E5%BE%81%E5%A4%84%E7%90%86/"/>
    <url>/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_2_%E7%89%B9%E5%BE%81%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> 特征处理</span><span style="color: #008000;">#</span><span style="color: #008000;"> 特征预处理:通过统计方法将数据转换为算法需要的数据</span><span style="color: #008000;">#</span><span style="color: #008000;"> 数值型数据:标准缩放</span><span style="color: #008000;">#</span><span style="color: #008000;">           规依法,标准化(常用,适用于当前大数据),缺失值处理(删除,填补中位数平均数,通常按照列填补)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 类别型数据:ont-hot编码</span><span style="color: #008000;">#</span><span style="color: #008000;"> 时间类型:时间的切分</span><span style="color: #008000;">#</span><span style="color: #008000;"> 特征处理API sklearn.preprocessing</span><span style="color: #008000;">#</span><span style="color: #008000;"> ==============================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 归一化:对数据变化---&gt;默认[0,1]之间</span><span style="color: #800000;">"""</span><span style="color: #800000;">new = (old-min)/(max-min)  max,min 为某列最大值最小值new2 = new*(mx-mi)+mi mx mi 为指定的区间默认new2 即为转换后的值MinScalar(feature_range=(0,1)...) 缩放函数</span><span style="color: #800000;">"""</span><span style="color: #008000;">#</span><span style="color: #008000;"> 当数据的n个特征同等重要的时候,要进行归一化,</span><span style="color: #008000;">#</span><span style="color: #008000;"> 使得某一个特征对最终结果不会造成更大的影响(其实主要与算法有关,)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 容易受异常点影响,容易更改max,min的值</span><span style="color: #0000ff;">from</span> sklearn.preprocessing <span style="color: #0000ff;">import</span><span style="color: #000000;"> MinMaxScalermatrix </span>=<span style="color: #000000;"> [        [</span>90,2,10,9000<span style="color: #000000;">],        [</span>60,4,15,45<span style="color: #000000;">],        [</span>75,3,13,46<span style="color: #000000;">],    ]</span><span style="color: #0000ff;">def</span><span style="color: #000000;"> mm():    </span><span style="color: #800000;">"""</span><span style="color: #800000;">    归一化处理    :return:    </span><span style="color: #800000;">"""</span><span style="color: #000000;"><pre><code class="hljs">mms &lt;/span&gt;= MinMaxScaler(feature_range=(2,3&lt;span style=&quot;color: #000000;&quot;&gt;))data &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; mms.fit_transform(matrix)&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;print&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(data)</code></pre></div><p></span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[[3.         2.         2.         2.        ]<br> [2.         3.         3.         2.83333333]<br> [2.5        2.5        2.6        3.        ]]<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> ================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 标准化(常用):使得某一特征不会对结果造成太大影响</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> new=(old-平均)/标准差 对每一列来说</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 标准差 = 方差开平方</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 方差:考量数据的稳定性</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 处理后每个特征平均为0,方差为1,标准差为1</span><br><span style="color: #0000ff;">from</span> sklearn.preprocessing <span style="color: #0000ff;">import</span><span style="color: #000000;"> StandardScaler<br></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> ss():<br>    s </span>=<span style="color: #000000;"> StandardScaler()<br>    data </span>=<span style="color: #000000;"> s.fit_transform(matrix)<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> =======================================</span><br><span style="color: #0000ff;">from</span> sklearn.preprocessing <span style="color: #0000ff;">import</span><span style="color: #000000;"> Imputer<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 填补NaN, 按照 mean, 列填补</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 数据中的缺失值要为 numpy.nan 类型 若不是 replace() 替换掉</span><br><span style="color: #0000ff;">import</span><span style="color: #000000;"> numpy as np<br>[[</span>90, 2, 10, 9000<span style="color: #000000;">],<br>[np.nan, </span>4, 15, 45<span style="color: #000000;">],]<br>Imputer(missing_values</span>=<span style="color: #800000;">“</span><span style="color: #800000;">NaN</span><span style="color: #800000;">“</span>,strategy=<span style="color: #800000;">“</span><span style="color: #800000;">mean</span><span style="color: #800000;">“</span>,axis=<span style="color: #000000;">0)<br>Imputer(missing_values</span>=<span style="color: #800000;">“</span><span style="color: #800000;">nan</span><span style="color: #800000;">“</span>,strategy=<span style="color: #800000;">“</span><span style="color: #800000;">mean</span><span style="color: #800000;">“</span>,axis=<span style="color: #000000;">0)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> ======================================================</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> 数据降维(注意不是数组的行数,列数)  指的是减少特征的数量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 主要方法:特征选择,主成分分析</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 特征选择的原因:冗余,噪音</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 方式:</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;">   过滤式(主要过滤方差),例如方差为0的,或很小的 就可以过滤</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;">   嵌入式(正则化,决策树),</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;">   包裹式</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;">   神经网络</span><br><span style="color: #0000ff;">from</span> sklearn.feature_selection <span style="color: #0000ff;">import</span><span style="color: #000000;"> VarianceThreshold</p><p></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> var():<br>    vt </span>= VarianceThreshold(threshold=0.0) <span style="color: #008000;">#</span><span style="color: #008000;"> threshold 根据情况获取</span><br>    data =<span style="color: #000000;"> vt.fit_transform([<br>        [0,</span>2,0,3<span style="color: #000000;">],<br>        [0,</span>1,4,3<span style="color: #000000;">],<br>        [0,</span>1,1,3<span style="color: #000000;">],<br>    ])<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data)<br></span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[[2 0]  # 去掉了方差为0的列<br> [1 4]<br> [1 1]]<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 主成分分析</span><br><span style="color: #0000ff;">from</span> sklearn.decomposition <span style="color: #0000ff;">import</span><span style="color: #000000;"> PCA<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> PCA 分析,简化数据集的技术, 使数据压缩,减少数据维数(特征数量), 损失少量数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 特征数量过多的时候,考虑要不要使用使用PCA,(图片可能有上万个特征)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 特征数量很少的时候,可以不使用</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> PCA(n_components=) n_components</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   小数:指定保留的信息量 0-1之间 一般为0.90-0.95之间</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   整数:指定减少的特征数量(但自己通常不知道减少多少,因此不常使用)</span><br><span style="color: #0000ff;">def</span><span style="color: #000000;"> pca():<br>    </span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>    主成分分析<br>    :return:<br>    </span><span style="color: #800000;">“””</span><span style="color: #000000;"><br>    pc</span>=PCA(n_components=0.92<span style="color: #000000;">)<br>    data </span>=<span style="color: #000000;"> pc.fit_transform([<br>        [</span>2,8,4,5<span style="color: #000000;">],<br>        [</span>6,3,0,8<span style="color: #000000;">],<br>        [</span>5,4,9,1<span style="color: #000000;">],<br>    ])<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data)<br></span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[[ 1.28620952e-15  3.82970843e+00]<br> [ 5.74456265e+00 -1.91485422e+00]<br> [-5.74456265e+00 -1.91485422e+00]]<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> =======================================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 数据降维案例:用户对物品类别的喜好程度细分降维</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 数据:<a href="https://www.kaggle.com/c/instacart-market-basket-analysis/data">https://www.kaggle.com/c/instacart-market-basket-analysis/data</a></span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   products.csv:商品信息</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   order_products_prior.csv:订单与商品信息</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   orders.csv:用户订单信息</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   aisles.csv:商品所属具体物品类别</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   首先表合并</span><br><span style="color: #0000ff;">import</span><span style="color: #000000;"> pandas as pd<br>data </span>= pd.read_csv(<span style="color: #800000;">“</span><span style="color: #800000;">E:\data\example\orders.csv</span><span style="color: #800000;">“</span><span style="color: #000000;">)<br></span><span style="color: #0000ff;">print</span>(data.head(10<span style="color: #000000;">))<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> data2 = pd.read_csv(“”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> new=pd.merge(data2,data2,on=[‘product_id’,’product_id’]) # 合并 两张表 on 表示以那个键合并</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 可再次合并</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ———–</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   交叉表(特殊的分组工具)</span><br>cross = pd.crosstab(data[<span style="color: #800000;">‘</span><span style="color: #800000;">user_id</span><span style="color: #800000;">‘</span>],data[<span style="color: #800000;">‘</span><span style="color: #800000;">type</span><span style="color: #800000;">‘</span>]) <span style="color: #008000;">#</span><span style="color: #008000;"> 第一个是行数据,第二个是列数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 第一列 为 user_id ,第一行为 物品类型</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   然后是 每个 user 买的各种物品的数量</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   显示了 用户 与他买的物品种类个数之间的关系</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   可使用pca降维 去掉无关项,  然后给算法使用</span></p><p><span style="color: #0000ff;">if</span> <span style="color: #800080;"><strong>name</strong></span>==<span style="color: #800000;">“</span><span style="color: #800000;"><strong>main</strong></span><span style="color: #800000;">“</span>:<span style="color: #0000ff;">pass</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> mm()</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> ss()</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> var()</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> pca()</span></pre></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_1_%E5%88%9D%E8%AF%86_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%BB%8B%E7%BB%8D_%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E5%92%8C%E6%96%87%E6%9C%AC%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96/"/>
    <url>/2022/01/16/cnblog/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD_1_%E5%88%9D%E8%AF%86_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E4%BB%8B%E7%BB%8D_%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B%E5%92%8C%E6%96%87%E6%9C%AC%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> 人工智能:预测,分类</span><span style="color: #008000;">#</span><span style="color: #008000;"> 人工智能:</span><span style="color: #008000;">#</span><span style="color: #008000;">   自动的工作</span><span style="color: #008000;">#</span><span style="color: #008000;">   机器学习(包含深度学习)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 以前的限制因素:计算能力,数据,算法发展</span><span style="color: #008000;">#</span><span style="color: #008000;"> 用途:</span><span style="color: #008000;">#</span><span style="color: #008000;">   图像识别</span><span style="color: #008000;">#</span><span style="color: #008000;">       识别图片中不同的地方(医学CT) 不用人工识别</span><span style="color: #008000;">#</span><span style="color: #008000;">       图片艺术化(可以替代ps)</span><span style="color: #008000;">#</span><span style="color: #008000;">       无人驾驶</span><span style="color: #008000;">#</span><span style="color: #008000;">       人脸识别</span><span style="color: #008000;">#</span><span style="color: #008000;">   自然语言处理</span><span style="color: #008000;">#</span><span style="color: #008000;">       语音识别</span><span style="color: #008000;">#</span><span style="color: #008000;">       自动写报告</span><span style="color: #008000;">#</span><span style="color: #008000;">   传统预测</span><span style="color: #008000;">#</span><span style="color: #008000;">       性能评估</span><span style="color: #008000;">#</span><span style="color: #008000;">       NLP</span><span style="color: #008000;">#</span><span style="color: #008000;">       推荐系统</span><span style="color: #008000;">#</span><span style="color: #008000;"> 机器学习的数据:文件格式,csv(逗号分隔值)</span><span style="color: #008000;">#</span><span style="color: #008000;">   不使用数据库:</span><span style="color: #008000;">#</span><span style="color: #008000;">       1,性能瓶颈,数量过多,2,3GB 读取慢</span><span style="color: #008000;">#</span><span style="color: #008000;">       2,数据格式不符合机器学习要求的格式</span><span style="color: #008000;">#</span><span style="color: #008000;"> pandas:读取工具,速度非常快</span><span style="color: #008000;">#</span><span style="color: #008000;"> sklearn:对于特征的处理提供了强大的接口</span><span style="color: #008000;">#</span><span style="color: #008000;"> numpy:(释放了GIL) 速度快</span><p><span style="color: #008000;">#</span><span style="color: #008000;"> 数据集</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   kaggle ,大数据竞赛平台</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   UCI,覆盖面广</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   scikit-learn,数据量小,方便学习</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> 常用数据集的结构组成:特征值+目标值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> dataFrame:行锁引,列索引</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"> 身高 体重 肤色,头发长度   (特征值)               目标值<br>1                                                 男  女<br>2<br>有些数据集可以没有目标值<br>dataFrame:缺失值,数据转换<br>机器学习:重复值 不需要去重<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 特征工程</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   是什么:将原始数据转换为更好的代表预测模型的潜在问题特征的过程,提高预测效果</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   意义:直接影响预测结果</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   scikit-learn库介绍:包含许多机器学习算法实现</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       pip install scikit-learn即可 需要先安装 numpy,pandas等库</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   数据特征的提取</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 特征值化  —&gt; 转化为数字</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===========================================================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 对字典进行特征抽取</span><br><span style="color: #0000ff;">from</span> sklearn.feature_extraction <span style="color: #0000ff;">import</span><span style="color: #000000;"> DictVectorizer<br></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> dictvec():<br>    </span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>    字典数据抽取<br>    :return: None<br>    </span><span style="color: #800000;">“””</span><br>    <span style="color: #008000;">#</span><span style="color: #008000;"> 实例化</span><br>    dict = DictVectorizer(sparse=<span style="color: #000000;">False)<br>    data </span>=<span style="color: #000000;"> dict.fit_transform([<br>        {</span><span style="color: #800000;">“</span><span style="color: #800000;">city</span><span style="color: #800000;">“</span>: <span style="color: #800000;">“</span><span style="color: #800000;">北京</span><span style="color: #800000;">“</span>, <span style="color: #800000;">“</span><span style="color: #800000;">templature</span><span style="color: #800000;">“</span>: 100<span style="color: #000000;">},<br>        {</span><span style="color: #800000;">“</span><span style="color: #800000;">city</span><span style="color: #800000;">“</span>: <span style="color: #800000;">“</span><span style="color: #800000;">天津</span><span style="color: #800000;">“</span>, <span style="color: #800000;">“</span><span style="color: #800000;">templature</span><span style="color: #800000;">“</span>: 30<span style="color: #000000;">},<br>        {</span><span style="color: #800000;">“</span><span style="color: #800000;">city</span><span style="color: #800000;">“</span>: <span style="color: #800000;">“</span><span style="color: #800000;">上海</span><span style="color: #800000;">“</span>, <span style="color: #800000;">“</span><span style="color: #800000;">templature</span><span style="color: #800000;">“</span>: 60<span style="color: #000000;">},<br>                        ])<br>    </span><span style="color: #0000ff;">print</span>(dict.get_feature_names()) <span style="color: #008000;">#</span><span style="color: #008000;"> [‘city=上海’, ‘city=北京’, ‘city=天津’, ‘templature’]</span><br>    <span style="color: #0000ff;">print</span>(data)  <span style="color: #008000;">#</span><span style="color: #008000;"> 矩阵</span></p><p><span style="color: #800000;">“””</span><span style="color: #800000;"><br>  (0, 1)    1.0<br>  (0, 3)    100.0<br>  (1, 2)    1.0<br>  (1, 3)    30.0<br>  (2, 0)    1.0<br>  (2, 3)    60.0<br>[‘city=上海’, ‘city=北京’, ‘city=天津’, ‘templature’] feature_names<br>[[  0.   1.   0. 100.] One-hot编码  对于每条数据,若属于摸个特征标记为1,否则为0<br> [  0.   0.   1.  30.]<br> [  1.   0.   0.  60.]]<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 注意:把字典中一些类别的一些数据转化为特征,对于数字类型不进行转换</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       对于数组类型,若有特征值,需要转换为字典  (切转化时选择有效的特征值)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> DictVectorizer(Sparse=True,….) 默认转化为矩阵,改为false变为数组</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   DictVectorizer.fit_transform(X) X 为字典或迭代器  返回一个sparse矩阵</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   DictVectorizer.inverse_transform(X) X 数组或sparse  返回一个之前的格式</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   DictVectorizer.get_feature_names() 返回类别类型</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   DictVectorizer.trasnsform(X) 按照原先的标准转换</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===========================================================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 对文本进行抽取</span><br><span style="color: #0000ff;">from</span> sklearn.feature_extraction.text <span style="color: #0000ff;">import</span><span style="color: #000000;"> CountVectorizer<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> jieba<br></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> countvec():<br>    cv </span>= CountVectorizer()  <span style="color: #008000;">#</span><span style="color: #008000;"> 里边没有参数</span><br>    res =<span style="color: #000000;"> cv.fit_transform([ # 传入的需要是 空格分开的词的形式,因此对于中文需要处理<br>        </span><span style="color: #800000;">“</span><span style="color: #800000;">life is short,I like python,life is too long</span><span style="color: #800000;">“</span>,<span style="color: #008000;">#</span><span style="color: #008000;"> 每个看做短文章</span><br>        <span style="color: #800000;">“</span><span style="color: #800000;">a is the first of alphabet</span><span style="color: #800000;">“</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">“</span> <span style="color: #800000;">“</span>.join(list(jieba.cut(<span style="color: #800000;">“</span><span style="color: #800000;">下载jieba-0.39.zip然后解压。记住路径。cmd进入命令输入界面，首先cd到我们刚刚解压文件的路径。%这一步有问题就百度cd完以后，python setup.py install然后就会出现安装进度条，结束。确定有没有安装成功，进入任意一个prompt输入import jieba，看看有没有提示报错。如果没有，就是安装成功了。</span><span style="color: #800000;">“</span><span style="color: #000000;">))),<br>    ])<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(cv.get_feature_names())<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(res.toarray())<br></span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[‘39’, ‘alphabet’, ‘cd’, ‘cmd’, ‘first’, ‘import’, ‘install’, ‘is’, ‘jieba’, ‘life’, ‘like’, ‘long’, ‘of’, ‘prompt’, ‘py’, ‘python’, ‘setup’, ‘short’, ‘the’, ‘too’, ‘zip’, ‘一个’, ‘一步’, ‘下载’, ‘以后’, ‘任意’, ‘出现’, ‘刚刚’, ‘命令’, ‘如果’, ‘安装’, ‘就是’, ‘成功’, ‘我们’, ‘报错’, ‘提示’, ‘文件’, ‘有没有’, ‘没有’, ‘然后’, ‘界面’, ‘百度’, ‘看看’, ‘确定’, ‘结束’, ‘解压’, ‘记住’, ‘路径’, ‘输入’, ‘进入’, ‘进度条’, ‘问题’, ‘首先’]<br>[[0 0 0 0 0 0 0 2 0 2 1 1 0 0 0 1 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0<br>  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]<br> [0 1 0 0 1 0 0 1 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0<br>  0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]<br> [1 0 2 1 0 1 1 0 2 0 0 0 0 1 1 1 1 0 0 0 1 1 1 1 1 1 1 1 1 1 3 1 2 1 1 1<br>  1 2 1 2 1 1 1 1 1 2 1 2 2 2 1 1 1]]<br>统计每个词在文章中出现的次数<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 文本特征抽取:Count    文本分类(词的不同) 情感分析</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 单个字母,汉字,符号不统计  英文他们没有具体的代表性,因此 汉字 需要分词 pip install jieba</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> import jieba jieba.cut(“xxxxxx”) 返回值是词语生成器 list(ret)转换为list   “ “.join(list)转为空格隔开的字符串</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> 对于一些常用的词语 ‘我们’ 等 不能很好地区分 ———–&gt;tf idf (朴素贝叶斯也要使用)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf:term frequency 词的频率   出现的次数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> idf:逆文档的频率inverse document frequecy log(总文档数量/该词出现的文档数量)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> tf*idf —-&gt;重要性 得出改次在该文档中的重要性</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 每篇文档每个词都有重要性,不同文章的同一个词重要性不同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 如果一个文章中的 一个词在文章中重要性高,没其文章中低——&gt;改词可用于区分分类</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 语法</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> TfidfVectorizer(stop_words=None,…..)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   返回权重矩阵</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   TfidfVectorizer.fit_transform(X) 可迭代对象,返回sparse矩阵</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   TfidfVectorizer.inverse_transform(X) 反向</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   TfidfVectorizer.get_feature_names() 单词列表</span><br><span style="color: #0000ff;">from</span> sklearn.feature_extraction.text <span style="color: #0000ff;">import</span><span style="color: #000000;"> TfidfVectorizer<br></span><span style="color: #0000ff;">def</span><span style="color: #000000;"> tfidfvec():<br>    tfidf </span>=<span style="color: #000000;"> TfidfVectorizer()<br>    data </span>=<span style="color: #000000;"> tfidf.fit_transform([<br>        </span><span style="color: #800000;">“</span><span style="color: #800000;">life is short,I like python,life is too long</span><span style="color: #800000;">“</span>,<span style="color: #008000;">#</span><span style="color: #008000;"> 每个看做短文章</span><br>        <span style="color: #800000;">“</span><span style="color: #800000;">a is the first of alphabet</span><span style="color: #800000;">“</span><span style="color: #000000;">,<br>        </span><span style="color: #800000;">“</span> <span style="color: #800000;">“</span>.join(list(jieba.cut(<span style="color: #800000;">“</span><span style="color: #800000;">下载jieba-0.39.zip然后解压。记住路径。cmd进入命令输入界面，首先cd到我们刚刚解压文件的路径。%这一步有问题就百度cd完以后，python setup.py install然后就会出现安装进度条，结束。确定有没有安装成功，进入任意一个prompt输入import jieba，看看有没有提示报错。如果没有，就是安装成功了。</span><span style="color: #800000;">“</span><span style="color: #000000;">))),<br>    ])<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(tfidf.get_feature_names())<br>    </span><span style="color: #0000ff;">print</span><span style="color: #000000;">(data.toarray())<br></span><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[‘39’, ‘alphabet’, ‘cd’, ‘cmd’, ‘first’, ‘import’, ‘install’, ‘is’, ‘jieba’, ‘life’, ‘like’, ‘long’, ‘of’, ‘prompt’, ‘py’, ‘python’, ‘setup’, ‘short’, ‘the’, ‘too’, ‘zip’, ‘一个’, ‘一步’, ‘下载’, ‘以后’, ‘任意’, ‘出现’, ‘刚刚’, ‘命令’, ‘如果’, ‘安装’, ‘就是’, ‘成功’, ‘我们’, ‘报错’, ‘提示’, ‘文件’, ‘有没有’, ‘没有’, ‘然后’, ‘界面’, ‘百度’, ‘看看’, ‘确定’, ‘结束’, ‘解压’, ‘记住’, ‘路径’, ‘输入’, ‘进入’, ‘进度条’, ‘问题’, ‘首先’]</p><h1 id="返回权重矩阵-显示每个文章的特征值-每行代表一篇文章-每列表示一个词-在该文章中的重要性-是否存在-若存在显示为重要性-不存在为0"><a href="#返回权重矩阵-显示每个文章的特征值-每行代表一篇文章-每列表示一个词-在该文章中的重要性-是否存在-若存在显示为重要性-不存在为0" class="headerlink" title="返回权重矩阵,显示每个文章的特征值(每行代表一篇文章,每列表示一个词,在该文章中的重要性),是否存在,若存在显示为重要性,不存在为0"></a>返回权重矩阵,显示每个文章的特征值(每行代表一篇文章,每列表示一个词,在该文章中的重要性),是否存在,若存在显示为重要性,不存在为0</h1><p>[[0.         0.         0.         0.         0.         0.<br>  0.         0.46088245 0.         0.60600504 0.30300252 0.30300252<br>  0.         0.         0.         0.23044123 0.         0.30300252<br>  0.         0.30300252 0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.        ]<br> [0.         0.46735098 0.         0.         0.46735098 0.<br>  0.         0.35543247 0.         0.         0.         0.<br>  0.46735098 0.         0.         0.         0.         0.<br>  0.46735098 0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.         0.<br>  0.         0.         0.         0.         0.        ]<br> [0.11353496 0.         0.22706991 0.11353496 0.         0.11353496<br>  0.11353496 0.         0.22706991 0.         0.         0.<br>  0.         0.11353496 0.11353496 0.08634626 0.11353496 0.<br>  0.         0.         0.11353496 0.11353496 0.11353496 0.11353496<br>  0.11353496 0.11353496 0.11353496 0.11353496 0.11353496 0.11353496<br>  0.34060487 0.11353496 0.22706991 0.11353496 0.11353496 0.11353496<br>  0.11353496 0.22706991 0.11353496 0.22706991 0.11353496 0.11353496<br>  0.11353496 0.11353496 0.11353496 0.22706991 0.11353496 0.22706991<br>  0.22706991 0.22706991 0.11353496 0.11353496 0.11353496]]<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> =============================================================================================</span><br><span style="color: #0000ff;">if</span> <span style="color: #800080;"><strong>name</strong></span>==<span style="color: #800000;">“</span><span style="color: #800000;"><strong>main</strong></span><span style="color: #800000;">“</span><span style="color: #000000;">:<br></span><span style="color: #008000;">#</span><span style="color: #008000;">   dictvec()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">     countvec()</span><br><span style="color: #000000;">    tfidfvec()<br>    </span><span style="color: #0000ff;">pass</span></pre></div></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/01/16/cnblog/%E4%B8%BB%E9%A2%98%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h1><p>你可以配置在<code>window.cnblogsConfig</code>里。</p><p>!&gt; Url 类型的配置，请尽量配置支持 Https 的地址！</p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>例如我原配置为：</p><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-built_in">window</span>.cnblogsConfig = &#123;</span><br><span class="javascript">        <span class="hljs-attr">GhVersions</span>    : <span class="hljs-string">&#x27;v1.2.2&#x27;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogUser</span>      : <span class="hljs-string">&quot;userName&quot;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogAvatar</span>    : <span class="hljs-string">&quot;https://xxxx.png&quot;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogStartDate</span> : <span class="hljs-string">&quot;2016-11-17&quot;</span>,</span><br><span class="javascript">    &#125;</span><br><span class="javascript">&lt;script&gt;</span><br></code></pre></td></tr></table></figure><p>我需要新增关于主页图片的配置：<code>homeTopImg</code></p><p>新增配置为：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-built_in">window</span>.cnblogsConfig = &#123;</span><br><span class="javascript">        <span class="hljs-attr">GhVersions</span>    : <span class="hljs-string">&#x27;v1.2.2&#x27;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogUser</span>      : <span class="hljs-string">&quot;userName&quot;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogAvatar</span>    : <span class="hljs-string">&quot;https://xxxx.png&quot;</span>,</span><br><span class="javascript">        <span class="hljs-attr">blogStartDate</span> : <span class="hljs-string">&quot;2016-11-17&quot;</span>,</span><br><span class="javascript">        <span class="hljs-attr">homeTopImg</span>    : [</span><br><span class="javascript">            <span class="hljs-string">&quot;https://x1.jpg&quot;</span>,</span><br><span class="javascript">            <span class="hljs-string">&quot;https://x2.jpg&quot;</span>,</span><br><span class="javascript">            <span class="hljs-string">&quot;https://x3.jpg&quot;</span>,</span><br><span class="javascript">        ],</span><br><span class="javascript">    &#125;</span><br><span class="javascript">&lt;script&gt;</span><br></code></pre></td></tr></table></figure><p>?&gt; JavaScript 对象是被命名值的容器。值以名称:值对的方式来书写（名称和值由冒号分隔）。</p><h2 id="仓库配置"><a href="#仓库配置" class="headerlink" title="仓库配置"></a>仓库配置</h2><h3 id="GhUserName-GitHub用户"><a href="#GhUserName-GitHub用户" class="headerlink" title="GhUserName - GitHub用户"></a>GhUserName - GitHub用户</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>BNDong</code></li></ul><p>GitHub用户名(不是昵称)，注意大小写。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">GhUserName</span>: <span class="hljs-string">&#x27;BNDong&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="GhRepositories-GitHub仓库"><a href="#GhRepositories-GitHub仓库" class="headerlink" title="GhRepositories - GitHub仓库"></a>GhRepositories - GitHub仓库</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>Cnblogs-Theme-SimpleMemory</code></li></ul><p>GitHub主题仓库名称。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">GhRepositories</span>: <span class="hljs-string">&#x27;Cnblogs-Theme-SimpleMemory&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="GhVersions-主题版本"><a href="#GhVersions-主题版本" class="headerlink" title="GhVersions - 主题版本"></a>GhVersions - 主题版本</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>v1.1.2</code></li></ul><p>GitHub发布版本或提交哈希值，根据版本加载代码。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">GhVersions</span>: <span class="hljs-string">&#x27;v1.1.2&#x27;</span>,<br>    <span class="hljs-comment">// or</span><br>    <span class="hljs-attr">GhVersions</span>: <span class="hljs-string">&#x27;d2c2e52cfef...38998f0e&#x27;</span>, <span class="hljs-comment">// 全哈希值，不要使用七位的部分哈希值</span><br>&#125;<br></code></pre></td></tr></table></figure><p>!&gt; 不推荐使用哈希值加载代码；使用哈希值要明确使用的哈希值所在的大版本中，保证设置的兼容性！</p><h2 id="基础信息配置"><a href="#基础信息配置" class="headerlink" title="基础信息配置"></a>基础信息配置</h2><h3 id="blogUser-用户昵称"><a href="#blogUser-用户昵称" class="headerlink" title="blogUser - 用户昵称"></a>blogUser - 用户昵称</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>[默认抓取博客园用户名]</code></li></ul><p>用户昵称。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">blogUser</span>: <span class="hljs-string">&#x27;BNDong&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="blogAvatar-用户头像"><a href="#blogAvatar-用户头像" class="headerlink" title="blogAvatar - 用户头像"></a>blogAvatar - 用户头像</h3><ul><li>类型：<code>Url</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>用户头像图片Url。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">blogAvatar</span>: <span class="hljs-string">&#x27;https://pic.cnblogs.com/avatar/1065454/20161119225202.png&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="blogStartDate-入园时间"><a href="#blogStartDate-入园时间" class="headerlink" title="blogStartDate - 入园时间"></a>blogStartDate - 入园时间</h3><ul><li>类型：<code>Date</code></li><li>默认值：<code>2019-01-01</code></li></ul><p>入园时间，年-月-日，入园时间查看方法：鼠标停留园龄时间上，会显示入园时间。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">blogStartDate</span>: <span class="hljs-string">&#x27;2019-01-01&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="网站配置"><a href="#网站配置" class="headerlink" title="网站配置"></a>网站配置</h2><h3 id="webpageTitleOnblur-失去焦点标签文字"><a href="#webpageTitleOnblur-失去焦点标签文字" class="headerlink" title="webpageTitleOnblur - 失去焦点标签文字"></a>webpageTitleOnblur - 失去焦点标签文字</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>(oﾟvﾟ)ノ Hi</code></li></ul><p>当页面失去焦点，页面title显示的文字。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">webpageTitleOnblur</span>: <span class="hljs-string">&#x27;(oﾟvﾟ)ノ Hi&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="webpageTitleOnblurTimeOut-失去焦点变化延时"><a href="#webpageTitleOnblurTimeOut-失去焦点变化延时" class="headerlink" title="webpageTitleOnblurTimeOut - 失去焦点变化延时"></a>webpageTitleOnblurTimeOut - 失去焦点变化延时</h3><ul><li>类型：<code>Number</code></li><li>默认值：<code>500</code></li></ul><p>当页面失去焦点，页面title变化的延时时间，单位毫秒。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">webpageTitleOnblurTimeOut</span>: <span class="hljs-number">500</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="webpageTitleFocus-获取焦点标签文字"><a href="#webpageTitleFocus-获取焦点标签文字" class="headerlink" title="webpageTitleFocus - 获取焦点标签文字"></a>webpageTitleFocus - 获取焦点标签文字</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>(*´∇｀*) 欢迎回来！</code></li></ul><p>当页面获取焦点，页面title显示的文字；显示后，延时恢复原title。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">webpageTitleFocus</span>: <span class="hljs-string">&#x27;(*´∇｀*) 欢迎回来！&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="webpageTitleFocusTimeOut-获取焦点变化延时"><a href="#webpageTitleFocusTimeOut-获取焦点变化延时" class="headerlink" title="webpageTitleFocusTimeOut - 获取焦点变化延时"></a>webpageTitleFocusTimeOut - 获取焦点变化延时</h3><ul><li>类型：<code>Number</code></li><li>默认值：<code>1000</code></li></ul><p>当页面获取焦点，页面title变化的延时时间，单位毫秒。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">webpageTitleFocusTimeOut</span>: <span class="hljs-number">1000</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="webpageIcon-网站图标"><a href="#webpageIcon-网站图标" class="headerlink" title="webpageIcon - 网站图标"></a>webpageIcon - 网站图标</h3><ul><li>类型：<code>Url</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>网站图标图片Url。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">webpageIcon</span>: <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/blog_logo.webp&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="字体图标扩展"><a href="#字体图标扩展" class="headerlink" title="字体图标扩展"></a>字体图标扩展</h2><h3 id="fontIconExtend-字体图标库扩展"><a href="#fontIconExtend-字体图标库扩展" class="headerlink" title="fontIconExtend - 字体图标库扩展"></a>fontIconExtend - 字体图标库扩展</h3><ul><li>类型：<code>Url</code></li><li>相关文档：<a href="https://bndong.github.io/Cnblogs-Theme-SimpleMemory/v1.1/#/Docs/Customization/fonticon">字体图标库</a></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>字体图标库扩展Css的Url。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">fontIconExtend</span>: <span class="hljs-string">&quot;//at.alicdn.com/t/font_543384_ezv3l7gd9r7.css&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="菜单配置"><a href="#菜单配置" class="headerlink" title="菜单配置"></a>菜单配置</h2><h3 id="menuCustomList-菜单数据"><a href="#menuCustomList-菜单数据" class="headerlink" title="menuCustomList - 菜单数据"></a>menuCustomList - 菜单数据</h3><ul><li>类型：<code>Object</code></li><li>相关文档：<a href="https://bndong.github.io/Cnblogs-Theme-SimpleMemory/v1.1/#/Docs/Customization/fonticon">字体图标库</a></li><li>默认值：<code>&#123;&#125;</code></li></ul><p>自定义菜单数据，显示在默认数据下方。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">menuCustomList</span>: &#123;<br>        <span class="hljs-string">&quot;title1&quot;</span>: &#123; <span class="hljs-comment">// 标题</span><br>            <span class="hljs-string">&quot;data&quot;</span>: [ <span class="hljs-comment">// 列表数据 [&#x27;列表&#x27;, &#x27;链接&#x27;]</span><br>                [<span class="hljs-string">&#x27;我的博客1&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客2&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客3&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客4&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客5&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>            ],<br>            <span class="hljs-string">&quot;icon&quot;</span>: <span class="hljs-string">&quot;icon-brush_fill&quot;</span> <span class="hljs-comment">// 配置图标，参考文档：定制化/字体图标库</span><br>        &#125;,<br>        <span class="hljs-string">&quot;title2&quot;</span>: &#123; <span class="hljs-comment">// 标题</span><br>            <span class="hljs-string">&quot;data&quot;</span>: [ <span class="hljs-comment">// 列表数据 [&#x27;列表&#x27;, &#x27;链接&#x27;]</span><br>                [<span class="hljs-string">&#x27;我的博客6&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客7&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客8&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客9&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>                [<span class="hljs-string">&#x27;我的博客10&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>            ],<br>            <span class="hljs-string">&quot;icon&quot;</span>: <span class="hljs-string">&quot;icon-brush_fill&quot;</span> <span class="hljs-comment">// 配置图标，参考文档：定制化/字体图标库</span><br>        &#125;,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="menuNavList-菜单导航"><a href="#menuNavList-菜单导航" class="headerlink" title="menuNavList - 菜单导航"></a>menuNavList - 菜单导航</h3><p>?&gt; 版本 &gt;= v1.1.2</p><ul><li>类型：<code>Array</code></li><li>默认值：<code>[]</code></li></ul><p>自定义菜单导航，显示在默认导航下方。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">menuNavList</span>: [ <span class="hljs-comment">// 列表数据 [&#x27;导航名称&#x27;, &#x27;链接&#x27;]</span><br>        [<span class="hljs-string">&#x27;我的博客1&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>        [<span class="hljs-string">&#x27;我的博客2&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong/&#x27;</span>],<br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="menuUserInfoBgImg-菜单个人信息背景图片"><a href="#menuUserInfoBgImg-菜单个人信息背景图片" class="headerlink" title="menuUserInfoBgImg - 菜单个人信息背景图片"></a>menuUserInfoBgImg - 菜单个人信息背景图片</h3><p>?&gt; 版本 &gt;= v1.1.5</p><ul><li>类型：<code>Url</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>菜单个人信息背景图片设置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">menuUserInfoBgImg</span>: <span class="hljs-string">&#x27;https://xxx,jpg&#x27;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="进度条配置"><a href="#进度条配置" class="headerlink" title="进度条配置"></a>进度条配置</h2><h3 id="progressBar"><a href="#progressBar" class="headerlink" title="progressBar"></a>progressBar</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    id      : &#x27;top-progress-bar&#x27;, <span class="hljs-comment">// 请勿修改该值</span><br>    color   : &#x27;#<span class="hljs-number">77</span>b6ff&#x27;,<br>    height  : &#x27;<span class="hljs-number">2</span>px&#x27;,<br>    duration: <span class="hljs-number">0.2</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>进度条配置，显示在页面顶部。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">progressBar</span>: &#123;<br>         <span class="hljs-attr">color</span>   : <span class="hljs-string">&#x27;#77b6ff&#x27;</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Loading配置"><a href="#Loading配置" class="headerlink" title="Loading配置"></a>Loading配置</h2><h3 id="loading"><a href="#loading" class="headerlink" title="loading"></a>loading</h3><ul><li>类型：<code>Object</code></li><li>相关文档：<a href="https://bndong.github.io/Cnblogs-Theme-SimpleMemory/v1.1/#/Docs/Customization/loading">Loading</a></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    rebound: &#123;<br>        tension: <span class="hljs-number">16</span>,<br>        friction: <span class="hljs-number">5</span>,<br>    &#125;,<br>    spinner: &#123;<br>        id: &#x27;spinner&#x27;,<br>        radius: <span class="hljs-number">90</span>,<br>        sides: <span class="hljs-number">3</span>,<br>        depth: <span class="hljs-number">4</span>,<br>        colors: &#123;<br>            background: &#x27;#f0f0f0&#x27;,<br>            stroke: &#x27;#<span class="hljs-number">272633</span>&#x27;,<br>            base: <span class="hljs-literal">null</span>,<br>            child: &#x27;#<span class="hljs-number">272633</span>&#x27;,<br>        &#125;,<br>        alwaysForward: <span class="hljs-literal">true</span>, <span class="hljs-comment">// When false the spring will reverse normally.</span><br>        restAt: <span class="hljs-number">0.5</span>,         <span class="hljs-comment">// A number from 0.1 to 0.9 || null for full rotation</span><br>        renderBase: <span class="hljs-literal">false</span>,<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>页面加载loading。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">loading</span>: &#123;<br>         <span class="hljs-attr">rebound</span>: &#123;<br>             <span class="hljs-attr">tension</span>: <span class="hljs-number">16</span>,<br>         &#125;,<br>         <span class="hljs-attr">spinner</span>: &#123;<br>             <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;spinner&#x27;</span>,<br>             <span class="hljs-attr">radius</span>: <span class="hljs-number">90</span>,<br>         &#125;<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="页面动效配置"><a href="#页面动效配置" class="headerlink" title="页面动效配置"></a>页面动效配置</h2><h3 id="homeTopAnimationRendered-是否渲染主页banner动效"><a href="#homeTopAnimationRendered-是否渲染主页banner动效" class="headerlink" title="homeTopAnimationRendered - 是否渲染主页banner动效"></a>homeTopAnimationRendered - 是否渲染主页banner动效</h3><ul><li>类型：<code>Boolean</code></li><li>默认值：<code>true</code></li></ul><p>是否渲染主页banner动效。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">homeTopAnimationRendered</span>: <span class="hljs-literal">true</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="homeTopAnimation-主页banner动效配置"><a href="#homeTopAnimation-主页banner动效配置" class="headerlink" title="homeTopAnimation - 主页banner动效配置"></a>homeTopAnimation - 主页banner动效配置</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    radius: <span class="hljs-number">15</span>,<br>    density: <span class="hljs-number">0.2</span>,<br>    color: &#x27;rgba(<span class="hljs-number">255</span>,255,255, .2)&#x27;, <span class="hljs-comment">// 颜色设置，“random” 为随机颜色</span><br>    clearOffset: <span class="hljs-number">0.3</span>,<br>&#125;<br></code></pre></td></tr></table></figure><p>主页banner动效配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">homeTopAnimation</span>: &#123;<br>         <span class="hljs-attr">color</span>   : <span class="hljs-string">&#x27;random&#x27;</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="essayTopAnimationRendered-是否渲染文章页banner动效"><a href="#essayTopAnimationRendered-是否渲染文章页banner动效" class="headerlink" title="essayTopAnimationRendered - 是否渲染文章页banner动效"></a>essayTopAnimationRendered - 是否渲染文章页banner动效</h3><ul><li>类型：<code>Boolean</code></li><li>默认值：<code>true</code></li></ul><p>是否渲染文章页banner动效。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayTopAnimationRendered</span>: <span class="hljs-literal">true</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="essayTopAnimation-文章页banner动效配置"><a href="#essayTopAnimation-文章页banner动效配置" class="headerlink" title="essayTopAnimation - 文章页banner动效配置"></a>essayTopAnimation - 文章页banner动效配置</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    triW : <span class="hljs-number">14</span>,<br>    triH : <span class="hljs-number">20</span>,<br>    neighbours : [<span class="hljs-string">&quot;side&quot;</span>, <span class="hljs-string">&quot;top&quot;</span>, <span class="hljs-string">&quot;bottom&quot;</span>],<br>    speedTrailAppear : <span class="hljs-number">.1</span>,<br>    speedTrailDisappear : <span class="hljs-number">.1</span>,<br>    speedTriOpen : <span class="hljs-number">1</span>,<br>    trailMaxLength : <span class="hljs-number">30</span>,<br>    trailIntervalCreation : <span class="hljs-number">100</span>,<br>    delayBeforeDisappear : <span class="hljs-number">2</span>,<br>    colorsRandom: <span class="hljs-literal">false</span>, <span class="hljs-comment">// v1.2.4 是否开启随机颜色</span><br>    colors: [<br>        &#x27;#<span class="hljs-number">96</span>EDA6&#x27;, &#x27;#<span class="hljs-number">5</span>BC6A9&#x27;,<br>        &#x27;#<span class="hljs-number">38668</span>C&#x27;, &#x27;#<span class="hljs-number">374</span>D84&#x27;,<br>        &#x27;#BED5CB&#x27;, &#x27;#<span class="hljs-number">62</span>ADC6&#x27;,<br>        &#x27;#<span class="hljs-number">8</span>EE5DE&#x27;, &#x27;#<span class="hljs-number">304E7</span>B&#x27;<br>    ]<br>&#125;<br></code></pre></td></tr></table></figure><p>文章页banner动效配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayTopAnimation</span>: &#123;<br>        <span class="hljs-attr">triW</span> : <span class="hljs-number">14</span>,<br>        <span class="hljs-attr">triH</span> : <span class="hljs-number">20</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="bgAnimationRendered-是否渲染页面背景动效"><a href="#bgAnimationRendered-是否渲染页面背景动效" class="headerlink" title="bgAnimationRendered - 是否渲染页面背景动效"></a>bgAnimationRendered - 是否渲染页面背景动效</h3><ul><li>类型：<code>Boolean</code></li><li>默认值：<code>true</code></li></ul><p>是否渲染页面背景动效。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">bgAnimationRendered</span>: <span class="hljs-literal">true</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="backgroundAnimation-页面背景动效配置"><a href="#backgroundAnimation-页面背景动效配置" class="headerlink" title="backgroundAnimation - 页面背景动效配置"></a>backgroundAnimation - 页面背景动效配置</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    colorSaturation: <span class="hljs-string">&quot;60%&quot;</span>,<br>    colorBrightness: <span class="hljs-string">&quot;50%&quot;</span>,<br>    colorAlpha: <span class="hljs-number">0.5</span>,<br>    colorCycleSpeed: <span class="hljs-number">5</span>,<br>    verticalPosition: <span class="hljs-string">&quot;random&quot;</span>,<br>    horizontalSpeed: <span class="hljs-number">200</span>,<br>    ribbonCount: <span class="hljs-number">3</span>,<br>    strokeSize: <span class="hljs-number">0</span>,<br>    parallaxAmount: <span class="hljs-number">-0.2</span>,<br>    animateSections: <span class="hljs-literal">true</span><br>&#125;<br></code></pre></td></tr></table></figure><p>页面背景动效配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">backgroundAnimation</span>: &#123;<br>        <span class="hljs-attr">colorSaturation</span>: <span class="hljs-string">&quot;60%&quot;</span>,<br>        <span class="hljs-attr">colorBrightness</span>: <span class="hljs-string">&quot;50%&quot;</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="主页配置"><a href="#主页配置" class="headerlink" title="主页配置"></a>主页配置</h2><h3 id="homeTopImg-主页banner图片"><a href="#homeTopImg-主页banner图片" class="headerlink" title="homeTopImg - 主页banner图片"></a>homeTopImg - 主页banner图片</h3><ul><li>类型：<code>Array</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">[<br>    <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/home_top_bg.webp&quot;</span><br>]<br></code></pre></td></tr></table></figure><p>主页banner图片Url，推荐尺寸&gt;= 1920*1080，支持多张，每次刷新随机设置一张。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">homeTopImg</span>: [<br>        <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/home_top_bg.webp&quot;</span>,<br>        <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/home_top_bg.webp&quot;</span><br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="homeBannerText-主页banner上的标语"><a href="#homeBannerText-主页banner上的标语" class="headerlink" title="homeBannerText - 主页banner上的标语"></a>homeBannerText - 主页banner上的标语</h3><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>主页banner上的标语，设置此选项会固定显示文字，默认为空，自动获取一句。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">homeBannerText</span>: <span class="hljs-string">&quot;好好学习，天天向上！&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="homeBannerTextType-标语获取源"><a href="#homeBannerTextType-标语获取源" class="headerlink" title="homeBannerTextType - 标语获取源"></a>homeBannerTextType - 标语获取源</h3><p>?&gt; 版本 &gt;= v1.1.3</p><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;jinrishici&quot;</code></li></ul><p>主页 banner 上的标语获取源，默认为 <code>jinrishici</code> 每次刷新随机获取一句古诗词。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">homeBannerTextType</span>: <span class="hljs-string">&quot;one&quot;</span>,<br>&#125;<br><br><span class="hljs-comment">/** 所有可配置项</span><br><span class="hljs-comment">jinrishici：每次刷新随机获取一句古诗词。</span><br><span class="hljs-comment">one：每日获取一句话</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="文章页配置"><a href="#文章页配置" class="headerlink" title="文章页配置"></a>文章页配置</h2><h3 id="essayTopImg-文章页banner图片"><a href="#essayTopImg-文章页banner图片" class="headerlink" title="essayTopImg - 文章页banner图片"></a>essayTopImg - 文章页banner图片</h3><ul><li>类型：<code>Array</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json">[<br>    <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/nothome_top_bg.webp&quot;</span><br>]<br></code></pre></td></tr></table></figure><p>文章页banner图片Url，推荐尺寸&gt;= 1920*600，支持多张，每次刷新随机设置一张。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayTopImg</span>: [<br>        <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/nothome_top_bg.webp&quot;</span>,<br>        <span class="hljs-string">&quot;https://gitee.com/dbnuo/Cnblogs-Theme-SimpleMemory/raw/master/img/webp/nothome_top_bg.webp&quot;</span><br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="essaySuffix-文章后缀配置"><a href="#essaySuffix-文章后缀配置" class="headerlink" title="essaySuffix - 文章后缀配置"></a>essaySuffix - 文章后缀配置</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    codeImgUrl   : &#x27;&#x27;, <span class="hljs-comment">// &gt;= v1.1.5 左侧图片设置，不配置使用 window.cnblogsConfig.blogAvatar</span><br>    aboutHtml    : &#x27;&#x27;, <span class="hljs-comment">// 关于博主，不配置使用默认</span><br>    copyrightHtml: &#x27;&#x27;, <span class="hljs-comment">// 版权声明，不配置使用默认</span><br>    supportHtml  : &#x27;&#x27;,  <span class="hljs-comment">// 声援博主，不配置使用默认</span><br>&#125;<br></code></pre></td></tr></table></figure><p>文章后缀配置，不配置使用默认。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essaySuffix</span>: &#123;<br>        <span class="hljs-attr">aboutHtml</span>: <span class="hljs-string">&quot;I am a good person&quot;</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="代码高亮配置"><a href="#代码高亮配置" class="headerlink" title="代码高亮配置"></a>代码高亮配置</h2><h3 id="使用博客园默认高亮"><a href="#使用博客园默认高亮" class="headerlink" title="使用博客园默认高亮"></a>使用博客园默认高亮</h3><h4 id="essayCodeHighlightingType"><a href="#essayCodeHighlightingType" class="headerlink" title="essayCodeHighlightingType"></a>essayCodeHighlightingType</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;cnblogs&quot;</code></li></ul><p>使用博客园代码高亮样式，介意加载速度的可以使用此配置。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayCodeHighlightingType</span>: <span class="hljs-string">&quot;cnblogs&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="essayCodeHighlighting"><a href="#essayCodeHighlighting" class="headerlink" title="essayCodeHighlighting"></a>essayCodeHighlighting</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>当使用博客园代码高亮样式时，此配置不会对渲染产生影响。</p><h3 id="使用-highlightjs"><a href="#使用-highlightjs" class="headerlink" title="使用 highlightjs"></a>使用 highlightjs</h3><ul><li>相关文档：<a href="https://bndong.github.io/Cnblogs-Theme-SimpleMemory/v1.1/#/Docs/Guide/highlight">highlight</a></li></ul><h4 id="essayCodeHighlightingType-1"><a href="#essayCodeHighlightingType-1" class="headerlink" title="essayCodeHighlightingType"></a>essayCodeHighlightingType</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;cnblogs&quot;</code></li></ul><p>使用<code>highlightjs</code>插件渲染代码高亮。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayCodeHighlightingType</span>: <span class="hljs-string">&quot;highlightjs&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="essayCodeHighlighting-1"><a href="#essayCodeHighlighting-1" class="headerlink" title="essayCodeHighlighting"></a>essayCodeHighlighting</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>highlightjs 代码高亮主题：<a href="https://highlightjs.org/static/demo/">demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayCodeHighlighting</span>: <span class="hljs-string">&quot;a11y-dark&quot;</span>,<br>&#125;<br><br><span class="hljs-comment">/** 所有可配置项</span><br><span class="hljs-comment">default、a11y-dark、a11y-light、agate、an-old-hope、androidstudio、arduino-light、arta、ascetic</span><br><span class="hljs-comment">、atelier-cave-dark、atelier-cave-light、atelier-dune-dark、atelier-dune-light、atelier-estuary-dark</span><br><span class="hljs-comment">、atelier-estuary-light、atelier-forest-dark、atelier-forest-light、atelier-heath-dark</span><br><span class="hljs-comment">、atelier-heath-light、atelier-lakeside-dark、atelier-lakeside-light、atelier-plateau-dark、atelier-plateau-light</span><br><span class="hljs-comment">、atelier-savanna-dark、atelier-savanna-light、atelier-seaside-dark、atelier-seaside-light</span><br><span class="hljs-comment">、atelier-sulphurpool-dark、atelier-sulphurpool-light、atom-one-dark-reasonable、atom-one-dark、atom-one-light</span><br><span class="hljs-comment">、brown-paper、codepen-embed、color-brewer、darcula、dark、darkula、docco、dracula、far</span><br><span class="hljs-comment">、foundation、github-gist、github、gml、googlecode、grayscale、gruvbox-dark、gruvbox-light、hopscotch</span><br><span class="hljs-comment">、hybrid、idea、ir-black、isbl-editor-dark、isbl-editor-light、kimbie.dark、kimbie.light、lightfair</span><br><span class="hljs-comment">、magula、mono-blue、monokai-sublime、monokai、nord、obsidian、ocean、paraiso-dark、paraiso-light、pojoaque</span><br><span class="hljs-comment">、purebasic、qtcreator_dark、qtcreator_light、railscasts、rainbow、routeros、school-book、shades-of-purple</span><br><span class="hljs-comment">、solarized-dark、solarized-light、sunburst、tomorrow-night-blue、tomorrow-night-bright</span><br><span class="hljs-comment">、tomorrow-night-eighties、tomorrow-night、tomorrow、vs、vs2015、xcode、xt256、zenburn</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h3 id="使用-prettify"><a href="#使用-prettify" class="headerlink" title="使用 prettify"></a>使用 prettify</h3><h4 id="essayCodeHighlightingType-2"><a href="#essayCodeHighlightingType-2" class="headerlink" title="essayCodeHighlightingType"></a>essayCodeHighlightingType</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;cnblogs&quot;</code></li></ul><p>使用<code>prettify</code>插件渲染代码高亮。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayCodeHighlightingType</span>: <span class="hljs-string">&quot;prettify&quot;</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="essayCodeHighlighting-2"><a href="#essayCodeHighlighting-2" class="headerlink" title="essayCodeHighlighting"></a>essayCodeHighlighting</h4><ul><li>类型：<code>String</code></li><li>默认值：<code>&quot;&quot;</code></li></ul><p>prettify 代码高亮主题（需梯子访问）：<a href="https://rawgit.com/google/code-prettify/master/styles/index.html">demo</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">essayCodeHighlighting</span>: <span class="hljs-string">&quot;obsidian&quot;</span>,<br>&#125;<br><br><span class="hljs-comment">/** 所有可配置项</span><br><span class="hljs-comment">prettify、desert、sunburst、obsidian、doxy</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="页脚配置"><a href="#页脚配置" class="headerlink" title="页脚配置"></a>页脚配置</h2><h3 id="footerStyle-页脚样式"><a href="#footerStyle-页脚样式" class="headerlink" title="footerStyle - 页脚样式"></a>footerStyle - 页脚样式</h3><p>?&gt; 版本 &gt;= v1.1.8</p><ul><li>类型：<code>Int</code></li><li>默认值：<code>2</code></li></ul><p>页脚样式：</p><p>footerStyle: 1</p><p><img src="../../Images/footer_01.png" alt="footer_01"></p><p>footerStyle: 2</p><p><img src="../../Images/footer_02.png" alt="footer_02"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">footerStyle</span>: <span class="hljs-number">1</span>,<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="bottomBlogroll-友情链接"><a href="#bottomBlogroll-友情链接" class="headerlink" title="bottomBlogroll - 友情链接"></a>bottomBlogroll - 友情链接</h3><ul><li>类型：<code>Array</code></li><li>默认值：<code>[]</code></li></ul><p>友情链接。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">bottomBlogroll</span>: [ <span class="hljs-comment">// 友情链接，[[链接名,链接]....]</span><br>        [<span class="hljs-string">&quot;申请坑位&quot;</span>, <span class="hljs-string">&#x27;https://msg.cnblogs.com/send/BNDong&#x27;</span>],<br>        [<span class="hljs-string">&quot;申请坑位&quot;</span>, <span class="hljs-string">&#x27;https://msg.cnblogs.com/send/BNDong&#x27;</span>],<br>        [<span class="hljs-string">&quot;申请坑位&quot;</span>, <span class="hljs-string">&#x27;https://msg.cnblogs.com/send/BNDong&#x27;</span>],<br>        [<span class="hljs-string">&quot;申请坑位&quot;</span>, <span class="hljs-string">&#x27;https://msg.cnblogs.com/send/BNDong&#x27;</span>],<br>        [<span class="hljs-string">&quot;申请坑位&quot;</span>, <span class="hljs-string">&#x27;https://msg.cnblogs.com/send/BNDong&#x27;</span>],<br>    ],<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="bottomText-页脚标语"><a href="#bottomText-页脚标语" class="headerlink" title="bottomText - 页脚标语"></a>bottomText - 页脚标语</h3><ul><li>类型：<code>Object</code></li><li>默认值：</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    icon: <span class="hljs-string">&quot;❤️&quot;</span>,<br>    left : <span class="hljs-string">&quot;&quot;</span>,<br>    right: <span class="hljs-string">&quot;&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>页脚标语。</p><p>?&gt; v1.1.4 版本之前不配置使用默认标语，v1.1.4 版本及以后不配置不会显示。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">bottomText</span>: &#123;<br>        <span class="hljs-attr">left</span> : <span class="hljs-string">&quot;好好学习&quot;</span>,<br>        <span class="hljs-attr">right</span>: <span class="hljs-string">&quot;天天向上&quot;</span>,<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="控制台输出"><a href="#控制台输出" class="headerlink" title="控制台输出"></a>控制台输出</h2><h3 id="consoleList"><a href="#consoleList" class="headerlink" title="consoleList"></a>consoleList</h3><ul><li>类型：<code>Array</code></li><li>默认值：<code>[]</code></li></ul><p>控制台输出。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">window</span>.cnblogsConfig = &#123;<br>    <span class="hljs-attr">consoleList</span>: [<br>         [<span class="hljs-string">&#x27;BNDong CNBlogs&#x27;</span>, <span class="hljs-string">&#x27;https://www.cnblogs.com/bndong&#x27;</span>],<br>         [<span class="hljs-string">&#x27;BNDong GitHub&#x27;</span>, <span class="hljs-string">&#x27;https://github.com/BNDong&#x27;</span>],<br>         [<span class="hljs-string">&#x27;BNDong Email&#x27;</span>, <span class="hljs-string">&#x27;dbuo@foxmail.com&#x27;</span>],<br>    ],<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/%E4%B8%8E%E6%88%96%E9%9D%9E%E8%BF%90%E7%AE%97/"/>
    <url>/2022/01/16/cnblog/%E4%B8%8E%E6%88%96%E9%9D%9E%E8%BF%90%E7%AE%97/</url>
    
    <content type="html"><![CDATA[<h1 id="与：and"><a href="#与：and" class="headerlink" title="与：and"></a>与：and</h1><ul><li>and -&gt; 有0出0，全1出1</li><li>例如：<ul><li>1 ，1–—&gt;1 </li><li>1 ，0 ––&gt;0 </li><li>0 ，1––&gt;0 </li><li>0 ，0—–&gt;0</li></ul></li></ul><h1 id="或：or"><a href="#或：or" class="headerlink" title="或：or"></a>或：or</h1><ul><li>or -&gt; 有1出1，全0出0 </li><li>例如：<ul><li>1 ，1–&gt;1</li><li>1 ，0–&gt;1 </li><li>0 ，1–&gt;1</li><li>0 ，0–&gt;0</li></ul></li></ul><h1 id="非：not"><a href="#非：not" class="headerlink" title="非：not"></a>非：not</h1><ul><li>not -&gt;有1出0，有0出1 </li><li>例如：<ul><li>1 –&gt;0 </li><li>0–&gt;1</li></ul></li></ul><h1 id="与非：nand"><a href="#与非：nand" class="headerlink" title="与非：nand"></a>与非：nand</h1><ul><li>nand -&gt;先按与的操作，然后结果取反 </li><li>例如：<ul><li>1 ，1–&gt;0 </li><li>1 ，0–&gt;1 </li><li>0 ，1–&gt;1 </li><li>0 ，0–&gt;1</li></ul></li></ul><h1 id="或非：nor"><a href="#或非：nor" class="headerlink" title="或非：nor"></a>或非：nor</h1><ul><li>nor -&gt;先按或的操作，然后结果取反 </li><li>例如：<ul><li>1 ，1–&gt;0 </li><li>1 ，0–&gt;0 </li><li>0 ，1–&gt;0 </li><li>0 ，0–&gt;1</li></ul></li></ul><h1 id="异或：xor"><a href="#异或：xor" class="headerlink" title="异或：xor"></a>异或：xor</h1><ul><li>xor  -&gt;相异为1，相同为0     </li><li>例如：<ul><li>1 ，1–&gt;0     </li><li>1 ，0–&gt;1    </li><li>0 ，1–&gt;1    </li><li>0 ，0–&gt;0</li></ul></li></ul><h1 id="同或：xnor"><a href="#同或：xnor" class="headerlink" title="同或：xnor"></a>同或：xnor</h1><ul><li>xnor  -&gt;相同为1，相异为0    </li><li>例如：<ul><li>1 ，1–&gt;1     </li><li>1 ，0–&gt;0    </li><li>0 ，1–&gt;0    </li><li>0 ，0–&gt;1</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/WordPress%E6%96%B0%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E6%97%B6%E6%8F%90%E7%A4%BA%E2%80%9C%E6%82%A8%E7%9A%84%E5%AF%86%E7%A0%81%E9%87%8D%E8%AE%BE%E9%93%BE%E6%8E%A5%E6%97%A0%E6%95%88%E2%80%9D/"/>
    <url>/2022/01/16/cnblog/WordPress%E6%96%B0%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C%E6%97%B6%E6%8F%90%E7%A4%BA%E2%80%9C%E6%82%A8%E7%9A%84%E5%AF%86%E7%A0%81%E9%87%8D%E8%AE%BE%E9%93%BE%E6%8E%A5%E6%97%A0%E6%95%88%E2%80%9D/</url>
    
    <content type="html"><![CDATA[<blockquote><p>在使用Wordpress密码找回功能及新用户注册邮件中的重置密码链接时，Wordpress提示&ldquo;您的密码重设链接无效，请在下方请求新链接。&rdquo;、&ldquo;该key似乎无效&rdquo;、&ldquo;invalid key&rdquo;。</p></blockquote><p><img style="display: block; margin-left: auto; margin-right: auto;" src="http://img.blog.csdn.net/20170227095303226?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxNDU1OTgwNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></p><blockquote><p>这个其实不是wordpress的问题，邮箱收到邮件后，会将密码重置链接地址及其前后的&ldquo;&lt;&gt;&rdquo;一起当成链接地址生成超链接，点击此超链接后，由于传给wordpress的参数不对（多了个&gt;），例如把鼠标移到下图的红色框的连接上，并看到浏览器左下角的URL提示连接，会发现多了一个&ldquo;&gt;&rdquo;，所以wordpress提示密码重设链接无效。</p></blockquote><p><img src="http://img.blog.csdn.net/20170227095342398?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxNDU1OTgwNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="" /></p><p>&emsp;&emsp;此问题主要影响忘记密码时的找回密码功能及新用户注册时，系统给新用户发送的密码设置功能。可通过以下两个步骤解决此问题：</p><p>&nbsp;</p><ul><li>解决找回密码时提示&ldquo;您的密码重设链接无效&rdquo;：</li></ul><p>&emsp;&emsp;打开WP根目录下的 wp-login.php，找到如下代码（374行左右）：</p><div class="cnblogs_code"><div class="code-wrapper"><pre>$message .= '&lt;' . network_site_url("wp-login.php?action=rp&amp;key=$key&amp;login=" . rawurlencode($user_login), 'login') . "&gt;\r\n";</pre></div></div><div><div>&emsp;&emsp;修改为：</div><div><div class="cnblogs_code"><div class="code-wrapper"><pre>$message .= network_site_url("wp-login.php?action=rp&amp;key=$key&amp;login=" . rawurlencode($user_login), 'login') . "\r\n";</pre></div></div></div><div><p>&emsp;&emsp;即去掉两个尖括号即可。</p><p>&nbsp;</p></div></div><ul><li>解决新用户注册时，点击邮件中的重置密码链接提示&ldquo;您的密码重设链接无效&rdquo;：</li></ul><p>&nbsp;&emsp;&emsp;打开WP安装目录下的/wp-includes/pluggable.php，找到如下代码（1741行左右）：</p><div class="cnblogs_code"><div class="code-wrapper"><pre>$message .= '&lt;' . network_site_url("wp-login.php?action=rp&amp;key=$key&amp;login=" . rawurlencode($user-&gt;user_login), 'login') . "&gt;\r\n\r\n";</pre></div></div><p>&emsp;&emsp;修改为：</p><div class="cnblogs_code"><div class="code-wrapper"><pre>$message .= network_site_url("wp-login.php?action=rp&amp;key=$key&amp;login=" . rawurlencode($user-&gt;user_login), 'login') . "\r\n\r\n";</pre></div></div><p>&emsp;&emsp;以上修改后，用户收到的密码重置及新用户收到的密码设置邮件将不会再包含&ldquo;&lt;&gt;&rdquo;,用户再邮箱中点击链接后即可正常重置或者设置密码。以上修改涉及到Wordpress源代码的修改，每次升级Wordpress后修改会被覆盖，必须重新进行以上修改。</p><p>&emsp;&emsp;另一种解决方式：把下面的代码加入当前主题的functions.php里面就可以了。</p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /></a></span></div><div class="code-wrapper"><pre>/*** 修复WordPress找回密码提示&ldquo;抱歉，该key似乎无效&rdquo;问题 */ function reset_password_message( $message, $key ) { if ( strpos($_POST['user_login'], '@') ) { $user_data = get_user_by('email', trim($_POST['user_login']));} else { $login = trim($_POST['user_login']); $user_data = get_user_by('login', $login);} $user_login = $user_data-&gt;user_login; $msg = __('有人要求重设如下帐号的密码：'). "\r\n\r\n"; $msg .= network_site_url() . "\r\n\r\n"; $msg .= sprintf(__('用户名：%s'), $user_login) . "\r\n\r\n"; $msg .= __('若这不是您本人要求的，请忽略本邮件，一切如常。') . "\r\n\r\n"; $msg .= __('要重置您的密码，请打开下面的链接：'). "\r\n\r\n"; $msg .= network_site_url("wp-login.php?action=rp&amp;key=$key&amp;login=" . rawurlencode($user_login), 'login') ; return $msg;}add_filter('retrieve_password_message', reset_password_message, null, 2);</pre></div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /></a></span></div></div><div>&nbsp;</div><p>&emsp;&emsp;这种办法的缺点是，每次换主题都要重新把代码添加到主题的function.php文件中。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/vue%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/"/>
    <url>/2022/01/16/cnblog/vue%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="VUE基本介绍"><a href="#VUE基本介绍" class="headerlink" title="VUE基本介绍"></a>VUE基本介绍</h1><p>构建界面的渐进式框架，替代jstl,el表达式等</p><h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><figure class="highlight html"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--&#123;&#123;&#125;&#125;插值表达式 --&gt;</span><br>    &#123;&#123;messgae&#125;&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-comment">&lt;!--引入文件 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,<span class="hljs-comment">//绑定vue的作用范围</span></span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;<span class="hljs-comment">//</span></span><br><span class="javascript">        <span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;Hello&#x27;</span></span><br><span class="javascript">    &#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><h5 id="基本数据与渲染指令"><a href="#基本数据与渲染指令" class="headerlink" title="基本数据与渲染指令"></a>基本数据与渲染指令</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--v-bind指令 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-bind:title</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span><br>    &#123;&#123;content&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-comment">&lt;!--简写方式--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">:title</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span><br>    &#123;&#123;content&#125;&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">    <span class="hljs-attr">conten</span>:<span class="hljs-string">&#x27;标题&#x27;</span>，</span><br><span class="javascript">    <span class="hljs-attr">message</span>:<span class="hljs-string">&#x27;时间&#x27;</span>+<span class="hljs-keyword">new</span> Data().toLocalString()</span><br><span class="javascript">&#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="双向数据绑定"><a href="#双向数据绑定" class="headerlink" title="双向数据绑定"></a>双向数据绑定</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--单向绑定--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">v-bind:value</span>=<span class="hljs-string">&#x27;searchMap.keyWord&#x27;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--双向绑定，修改后原数据也会变化s--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;text&#x27;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&#x27;searchMap.keyWord&#x27;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>&#123;&#123;searchMap.keyWord&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">        <span class="hljs-attr">searchMap</span>:&#123;</span><br><span class="javascript">            <span class="hljs-attr">keyWord</span>:<span class="hljs-string">&#x27;Dean&#x27;</span></span><br><span class="javascript">        &#125;</span><br><span class="javascript">    &#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--vue绑定事件--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">&#x27;search()&#x27;</span>&gt;</span>查询<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--简写，可不加括号--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&#x27;search()&#x27;</span>&gt;</span>查询<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">        </span><br><span class="javascript">    &#125;,</span><br><span class="javascript">    <span class="hljs-attr">methods</span>:&#123;<span class="hljs-comment">//定义方法</span></span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-title">search</span>(<span class="hljs-params"></span>)</span>&#123;alert(<span class="hljs-string">&#x27;search...&#x27;</span>)&#125;。</span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-title">f1</span>(<span class="hljs-params"></span>)</span>&#123;alert(<span class="hljs-string">&#x27;f1&#x27;</span>)&#125;</span><br><span class="javascript">    &#125;</span><br><span class="javascript">    </span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;save&quot;</span> <span class="hljs-attr">v-on:submit.prevent</span>=<span class="hljs-string">&#x27;onSubmit&#x27;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&#x27;user.name&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span><br>         保存   <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--点击后不提交，而是执行方法--&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">    <span class="hljs-attr">user</span>:&#123;&#125;    </span><br><span class="javascript">    &#125;，</span><br><span class="javascript">    <span class="hljs-attr">methods</span>:&#123;</span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-title">soSubmit</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="javascript">    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">this</span>.user.name)&#123;</span><br><span class="javascript">                </span><br><span class="javascript">&#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="javascript">                </span><br><span class="javascript">            &#125;</span><br><span class="javascript">&#125;</span><br><span class="javascript">&#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="条件渲染"><a href="#条件渲染" class="headerlink" title="条件渲染"></a>条件渲染</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&#x27;ok&#x27;</span>/&gt;</span> 是否同意<br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&#x27;ok&#x27;</span>&gt;</span>ok<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">v-else</span>&gt;</span>not ok<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">        <span class="hljs-attr">ok</span>:<span class="hljs-literal">false</span></span><br><span class="javascript">    &#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;n in 10&quot;</span>&gt;</span>&#123;&#123;n&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--index索引值从0开始，必须在n后边--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(n,index) in 10&quot;</span>&gt;</span>&#123;&#123;n&#125;&#125;-&#123;&#123;index&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;user in users&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;user.id&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">  <span class="hljs-attr">users</span>:[</span><br><span class="javascript">            &#123;<span class="hljs-attr">id</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Dean&#x27;</span>&#125;,</span><br><span class="javascript">            &#123;<span class="hljs-attr">id</span>:<span class="hljs-number">1</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Dean&#x27;</span>&#125;,</span><br><span class="javascript">        ]      </span><br><span class="javascript">    &#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;&#125;,</span><br><span class="javascript">    <span class="hljs-attr">components</span>:&#123;</span><br><span class="javascript">        <span class="hljs-comment">// 组件名字</span></span><br><span class="javascript">        <span class="hljs-string">&#x27;Navbar&#x27;</span>:&#123;</span><br><span class="javascript">            <span class="hljs-comment">// 组件内容</span></span><br><span class="javascript">            <span class="hljs-attr">template</span>:<span class="hljs-string">&#x27;&lt;ul&gt;&lt;li&gt;首页&lt;/li&gt;&lt;/ul&gt;&#x27;</span></span><br><span class="javascript">        &#125;</span><br><span class="javascript">    &#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">Navbar</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Navbar</span>&gt;</span><br><span class="hljs-comment">&lt;!--定义全局组件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">Vue。component(<span class="hljs-string">&#x27;Navbar&#x27;</span>,&#123;</span><br><span class="javascript">    <span class="hljs-attr">template</span>:<span class="hljs-string">&#x27;xxx&#x27;</span></span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h1><p>渲染之前created，之后mounted</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">        </span><br><span class="javascript">    &#125;</span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-title">created</span>(<span class="hljs-params"></span>)</span>&#123;&#125;,</span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-title">mounted</span>(<span class="hljs-params"></span>)</span>&#123;&#125; </span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/a&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">router-link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&quot;/b&quot;</span>&gt;</span>xx<span class="hljs-tag">&lt;/<span class="hljs-name">router-link</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;vue.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;vue.router.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-keyword">const</span> routes=[</span><br><span class="javascript">        &#123;<span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/a&#x27;</span>,<span class="hljs-attr">component</span>:定义的template&#125;，</span><br><span class="javascript">    ]</span><br><span class="javascript">    <span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> VueRouter(&#123;routes&#125;)</span><br><span class="javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&#x27;#app&#x27;</span>,</span><br><span class="javascript">    router</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h1><ul><li><p>独立于Vue的项目，与Vue一起使用实现ajax请求</p></li><li><p>应用场景</p><p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20200527173459273.png" alt="image-20200527173459273"></p></li><li><p>使用</p><ul><li>引入vue.js,axios.min.js</li><li>编写axios代码</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript"><span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript"><span class="hljs-attr">data</span>:&#123;<span class="hljs-comment">//定义变量初始值</span></span><br><span class="javascript"><span class="hljs-comment">//定义变量</span></span><br><span class="javascript">        <span class="hljs-attr">userlist</span>:[]</span><br><span class="javascript">        </span><br><span class="javascript">&#125;,</span><br><span class="javascript"><span class="hljs-function"><span class="hljs-title">created</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-comment">//调用定义方法</span></span><br><span class="javascript"><span class="hljs-built_in">this</span>.getUserList()</span><br><span class="javascript">&#125;,</span><br><span class="javascript"><span class="hljs-attr">methods</span>:&#123;<span class="hljs-comment">//编写具体方法</span></span><br><span class="javascript"><span class="hljs-function"><span class="hljs-title">getUserList</span>(<span class="hljs-params"></span>)</span>&#123;</span><br><span class="javascript">            axios.get(<span class="hljs-string">&quot;http://xxxx&quot;</span>)</span><br><span class="javascript">            .then(<span class="hljs-comment">//请求成功执行</span></span><br><span class="javascript">                <span class="hljs-function"><span class="hljs-params">response</span>=&gt;</span>&#123;  <span class="hljs-comment">//箭头函数</span></span><br><span class="javascript">                <span class="hljs-comment">//response 就是返回的数据</span></span><br><span class="javascript">                    <span class="hljs-built_in">this</span>.userList= response.data</span><br><span class="javascript">                &#125;</span><br><span class="javascript">            ) </span><br><span class="javascript">            .catch(同上)<span class="hljs-comment">//请求失败</span></span><br><span class="javascript">        &#125;</span><br><span class="javascript">&#125;</span><br><span class="javascript">&#125;)</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="element-ui"><a href="#element-ui" class="headerlink" title="element-ui"></a>element-ui</h1><p>饿了么提供的组件库，各种效果,</p><p><a href="http://element-cn.eleme.io/">http://element-cn.eleme.io</a></p><h1 id="node-js"><a href="#node-js" class="headerlink" title="node.js"></a>node.js</h1><ul><li>java需要jdk，javascript需要nodejs</li><li>可模拟服务器如tomcat</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> http=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br>http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request,response</span>)</span>&#123;<br>    response.writeHead(<span class="hljs-number">200</span>,&#123;<span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;text/plain&#x27;</span>&#125;);;<br>    response.end(<span class="hljs-string">&#x27;Hello Server&#x27;</span>)<br>&#125;).listen(<span class="hljs-number">8888</span>);<br><br></code></pre></td></tr></table></figure><h1 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h1><p>类似于java中的maven，</p><p>详细见：<a href="https://www.cnblogs.com/Dean0731/p/12956891.html">https://www.cnblogs.com/Dean0731/p/12956891.html</a></p><h1 id="babel"><a href="#babel" class="headerlink" title="babel"></a>babel</h1><p>转码器,将es6转化为es5</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 第一步</span><br>npm install --g babel-cli<br>babel --version<br><span class="hljs-meta">#</span><span class="bash"> 第二步，创建js</span><br><span class="hljs-meta">#</span><span class="bash"> 第三部，创建<span class="hljs-string">&#x27;.babelrc&#x27;</span>文件,名字固定</span><br>&#123;<br>&quot;presets&quot;:[&quot;es2015&quot;],<br>&quot;plugins&quot;:[]<br>&#125;<br><span class="hljs-meta">#</span><span class="bash"> 第四部，安装转码器</span><br>npm install --s babel-preset-es2015<br><span class="hljs-meta">#</span><span class="bash"> 第五步, 文件夹转码</span><br>babel src --out-dir dist2<br>babel src -d dist<br><span class="hljs-meta">#</span><span class="bash"> 文件转码</span><br>babel xxx.js -o| --out-file yy.js<br><br></code></pre></td></tr></table></figure><h1 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h1><ol><li><p>是什么？</p><ul><li>后端：controller，service，mapper，类与类之间调用叫做模块化</li><li>前端：js与js之间的调用</li></ul></li><li><p>es6模块化</p><p>不能再nodejs运行，需要babel转化为es5</p><h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 01.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getList</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br><span class="hljs-comment">// 02.js</span><br><span class="hljs-keyword">import</span> &#123;getList&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./01.js&#x27;</span><br>getList() <span class="hljs-comment">//调用</span><br></code></pre></td></tr></table></figure><h6 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 01.js</span><br><span class="hljs-keyword">export</span>  <span class="hljs-keyword">default</span>&#123;<br>    <span class="hljs-function"><span class="hljs-title">getList</span>(<span class="hljs-params"></span>)</span>&#123;&#125;,<br>    <span class="hljs-function"><span class="hljs-title">update</span>(<span class="hljs-params"></span>)</span>&#123;&#125;<br>&#125;<br><span class="hljs-comment">// 02.js</span><br><span class="hljs-keyword">import</span> m <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./01.js&#x27;</span><br>m.getList()<br></code></pre></td></tr></table></figure></li><li><p>es5模块化</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 01.js</span><br><span class="hljs-keyword">const</span> sum = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(a)+<span class="hljs-built_in">parseInt</span>(b)<br>&#125;<br><span class="hljs-keyword">const</span> subtract = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a,b</span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseInt</span>(a)-<span class="hljs-built_in">parseInt</span>(b)<br>&#125;<br><span class="hljs-comment">// 简写</span><br><span class="hljs-built_in">module</span>.exports=&#123;<br>    sum,subtract<br>&#125;<br><span class="hljs-built_in">module</span>.exports=&#123;<br>    <span class="hljs-attr">sum</span>:sum,<br>    <span class="hljs-attr">sub</span>:subtract<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 02.js</span><br><span class="hljs-keyword">const</span> m = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;01.js&#x27;</span>)<br>m.sum(a,b)<br></code></pre></td></tr></table></figure><h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><p>静态资源打包工具，将静态资源打包为一个</p><p>例：1.js 2.js 3.css —-&gt;webpack —-&gt;folder.js ,减少页面请求次数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g webpack webpack-cli<br></code></pre></td></tr></table></figure><h6 id="js打包"><a href="#js打包" class="headerlink" title="js打包"></a>js打包</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//01.js</span><br>xxxx<br><span class="hljs-comment">//02.js</span><br>xxxx<br><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">const</span> x = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;01.js&#x27;</span>)<br><span class="hljs-keyword">const</span> y = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;02.js&#x27;</span>)<br>x.zzz<br>y.zzzz<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// webpack.config.js 固定名字</span><br><span class="hljs-keyword">const</span> path=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>) <span class="hljs-comment">// Nodejs内置模块</span><br><span class="hljs-built_in">module</span>.exports=&#123;<br>    <span class="hljs-attr">entry</span>:<span class="hljs-string">&#x27;main.js&#x27;</span>,<span class="hljs-comment">//配置入口文件</span><br>    <span class="hljs-attr">output</span>:&#123;<br>        <span class="hljs-attr">path</span>:path.resolve(__dirname,<span class="hljs-string">&#x27;dist&#x27;</span>), <span class="hljs-comment">// 输出路径</span><br>        <span class="hljs-attr">filename</span>:<span class="hljs-string">&#x27;bundle.js&#x27;</span> <span class="hljs-comment">//文件名</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">webpack # 有黄色警告 一行显示<br>webpack --mode=production<br>webpack --mode=none<br>webpack --mode=development # 没有警告,多行显示<br></code></pre></td></tr></table></figure><h6 id="css打包"><a href="#css打包" class="headerlink" title="css打包"></a>css打包</h6><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css">// <span class="hljs-number">01</span><span class="hljs-selector-class">.css</span><br>xxxx<br>// <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.js</span>中<br>require(&#x27;<span class="hljs-number">01</span><span class="hljs-selector-class">.css</span>&#x27;)<br>// 安装css加载器<br>npm install -s style-loader css-loader<br>// 修改webpack配置文件<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path=<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>) <span class="hljs-comment">// Nodejs内置模块</span><br><span class="hljs-built_in">module</span>.exports=&#123;<br>    <span class="hljs-attr">entry</span>:<span class="hljs-string">&#x27;main.js&#x27;</span>,<span class="hljs-comment">//配置入口文件</span><br>    <span class="hljs-attr">output</span>:&#123;<br>        <span class="hljs-attr">path</span>:path.resolve(__dirname,<span class="hljs-string">&#x27;dist&#x27;</span>), <span class="hljs-comment">// 输出路径</span><br>        <span class="hljs-attr">filename</span>:<span class="hljs-string">&#x27;bundle.js&#x27;</span> <span class="hljs-comment">//文件名</span><br>    &#125;，<br>    <span class="hljs-attr">module</span>:&#123;<br>    <span class="hljs-attr">rules</span>:[<br>    &#123;<br>    <span class="hljs-attr">test</span>:<span class="hljs-regexp">/\.css$/</span>,<span class="hljs-comment">//打包规则应用到css结尾的文件</span><br>    use:[<span class="hljs-string">&#x27;style-loader&#x27;</span>,<span class="hljs-string">&#x27;css-loader&#x27;</span>]<br>&#125;<br>    ]<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 重新打包即可</span><br></code></pre></td></tr></table></figure><h1 id="后台模板vue-admin-template"><a href="#后台模板vue-admin-template" class="headerlink" title="后台模板vue-admin-template"></a>后台模板vue-admin-template</h1><ul><li>下载，解压到工作区，<a href="https://github.com/PanJiaChen/vue-element-admin">https://github.com/PanJiaChen/vue-element-admin</a></li><li>进入目录 npm install 安装依赖</li><li>启动 npm run dev</li></ul><p>注：后台=接口(java)+管理员界面(nodejs)，前台：用户界面(nodejs)</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/vue/"/>
    <url>/2022/01/16/cnblog/vue/</url>
    
    <content type="html"><![CDATA[<h1 id="VUE"><a href="#VUE" class="headerlink" title="VUE"></a>VUE</h1><ul><li>javascript的封装库,就像jquery</li><li>MVVM model-view-viewmodel<ul><li>用户-view-view-model-model后台</li></ul></li><li>数据双向绑定,数据变化,视图变化,手动视图变化,数据也会变化</li><li>单页面应用,即不会跳转,全都是自定义组件</li></ul><h1 id="VUE-属性介绍"><a href="#VUE-属性介绍" class="headerlink" title="VUE 属性介绍"></a>VUE 属性介绍</h1><ul><li>```js<br>Vue vm = new Vue({<div class="code-wrapper"><pre><code class="hljs">el:&quot;#app&quot;,data:&#123;    message:&quot;xxx&quot;&#125;,methods:&#123;say: function()&#123;&#125;&#125;,mounted()&#123;axios.get(&quot;url&quot;).then(response=&gt;&#123;consoole.log(response.data)&#125;)&#125;,data()&#123;return &#123;    info:&#123;        name:null, // 解决前边需要info.name会不存在的情况    &#125;&#125;&#125;</code></pre></div>});<figure class="highlight haml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs haml"><br>-<span class="ruby"> <span class="hljs-symbol">el:</span>绑定的dom id</span><br><span class="ruby"></span><br>-<span class="ruby"> <span class="hljs-symbol">data:</span>数据,用于数据绑定</span><br><span class="ruby"></span><br>  -<span class="ruby"> v-<span class="hljs-symbol">bind:</span>title=<span class="hljs-string">&quot;title&quot;</span></span><br><span class="ruby"></span>  -<span class="ruby"> v-model用于在表单上的双向绑定</span><br><span class="ruby"></span><br>-<span class="ruby"> <span class="hljs-symbol">method:</span>方法,用于绑定</span><br><span class="ruby"></span><br>  -<span class="ruby"> v-<span class="hljs-symbol">on:</span>click=<span class="hljs-string">&quot;say&quot;</span></span><br><span class="ruby"></span><br>-<span class="ruby"> template</span><br><span class="ruby"></span><br>-<span class="ruby"> render</span><br><span class="ruby"></span><br>-<span class="ruby"> watch</span><br><span class="ruby"></span><br>-<span class="ruby"> mounted()<span class="hljs-symbol">:</span>钩子函数</span><br><span class="ruby"></span><br>  异步加载,闪烁问题,<br><br>  ```html<br>  &lt;style&gt;<br>      [v-clock]&#123;<br>          display:none;<br>      &#125;<br>  <br>  &lt;/style&gt;<br>  &lt;div v-clock&gt;<br>      <br>  &lt;/div&gt;<br></code></pre></td></tr></table></figure></li></ul><h1 id="组件定义"><a href="#组件定义" class="headerlink" title="组件定义"></a>组件定义</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">Vue.component(<span class="hljs-string">&quot;biaoqianname&quot;</span>,<br>              &#123;<span class="hljs-attr">template</span>:<span class="hljs-string">&#x27;&lt;li&gt;hello&lt;/li&gt;&#x27;</span>&#125;<br>             )<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210210113357207.png" alt="image-20210210113357207"></p><h1 id="网络通信"><a href="#网络通信" class="headerlink" title="网络通信"></a>网络通信</h1><ul><li><p>AXIOS,异步通信框架,实现ajax</p></li><li><p>```js<br>Vue vm = new Vue({</p><div class="code-wrapper"><pre><code class="hljs">el:&quot;#app&quot;,data:&#123;    message:&quot;xxx&quot;&#125;,methods:&#123;say: function()&#123;&#125;&#125;,mounted()&#123;axios.get(&quot;url&quot;).then(response=&gt;&#123;consoole.log(response.data)&#125;)&#125;,data()&#123;return &#123;    info:&#123;        name:null, // 解决前边需要info.name会不存在的情况    &#125;&#125;&#125;</code></pre></div><p>});</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><br><span class="hljs-comment"># 计算属性,内容分发</span><br><br>```<span class="javascript">js</span><br><span class="javascript">Vue vm = <span class="hljs-keyword">new</span> Vue(&#123;</span><br><span class="javascript">    <span class="hljs-attr">el</span>:<span class="hljs-string">&quot;#app&quot;</span>,</span><br><span class="javascript">    <span class="hljs-attr">data</span>:&#123;</span><br><span class="javascript">        <span class="hljs-attr">message</span>:<span class="hljs-string">&quot;xxx&quot;</span></span><br><span class="javascript">    &#125;,</span><br><span class="javascript">    <span class="hljs-attr">methods</span>:&#123;<span class="hljs-attr">say</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;&#125;&#125;, <span class="hljs-comment">//&#123;&#123;say()&#125;&#125;</span></span><br><span class="javascript">    <span class="hljs-attr">computed</span>:&#123;<span class="hljs-attr">say2</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;&#125;&#125;<span class="hljs-comment">//&#123;&#123;say()&#125;&#125; 调用方式不同,将不经常变化的结果缓存</span></span><br><span class="javascript">&#125;);</span><br></code></pre></td></tr></table></figure></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210210121902355.png" alt="image-20210210121902355"></p><p> <img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210210122009383.png" alt="image-20210210122009383"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210210122315196.png" alt="image-20210210122315196"></p><h1 id="自定义事件分发"><a href="#自定义事件分发" class="headerlink" title="自定义事件分发"></a>自定义事件分发</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210210125725987.png" alt="image-20210210125725987"></p><h1 id="Vue-cli"><a href="#Vue-cli" class="headerlink" title="Vue-cli"></a>Vue-cli</h1><p>脚手架,快速生成vue项目模板</p><ul><li>统一目录结构</li><li>本地调试</li><li>热部署</li><li>单元测水,集成打包上线</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g vue-cli # 安装脚手架<br>vue init webpack myproject # 初始化项目<br>npm install # 安装依赖软件包<br>npm run dev # 打包启动<br></code></pre></td></tr></table></figure><p>main.js 程序的入口, 里边是导入的模块,例如vue模块,以及自己写的模块等</p><p>index.html 固定不变的</p><p>index.js 一般是路由的入口</p><h1 id="Vue-router"><a href="#Vue-router" class="headerlink" title="Vue router"></a>Vue router</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">npm install vue-router --save-dev<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./router/index&quot;</span><br><br><span class="hljs-keyword">new</span> Vue(&#123;<br>    <span class="hljs-attr">el</span>: <span class="hljs-string">&#x27;#app&#x27;</span>,<br>    router,<br>    <span class="hljs-attr">component</span>:APP<br>&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>&lt;div&gt;<br>    &lt;router-link tp=&quot;/content&quot;&gt;content&lt;/router-link&gt;<br>    &lt;router-view&gt;&lt;/router-view&gt;用于展示跳转的内容<br>    <br>    &lt;/div&gt;<br>&lt;/template&gt;<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vue">// content.vue<br>&lt;template&gt;<br>&lt;h1&gt;<br>        内容显示<br>    &lt;/h1&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>    export default&#123;<br>        name: &quot;Content&quot; // 组件名字<br>    &#125;<br>&lt;/script&gt;<br>&lt;style scoped&gt;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// index.js 路由对象的配置,导出</span><br><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue&quot;</span><br><span class="hljs-keyword">import</span> VueRouter <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue-router&quot;</span><br><span class="hljs-keyword">import</span> Content <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;content&quot;</span><br><span class="hljs-comment">// 显示声明</span><br>Vue.use(VueRouter)<br><span class="hljs-keyword">export</span> defalut <span class="hljs-keyword">new</span> VueRouter(&#123;<br>    <span class="hljs-attr">routes</span>:[<br>        &#123;<br>            <span class="hljs-attr">path</span>:<span class="hljs-string">&#x27;/content&#x27;</span>,<br>            <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;content&#x27;</span><br>            <span class="hljs-attr">componment</span>:Content,<br>        &#125;<br>    ]<br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="实践应用"><a href="#实践应用" class="headerlink" title="实践应用"></a>实践应用</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install vue-cli<br>vue init webpack myvue<br>npm insatll vue-router --save-dev<br>npm install element-ui -S<br>npm install sass-loader node-sass --save-dev<br>npm install<br>npm run dev<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/vps--SSR%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/"/>
    <url>/2022/01/16/cnblog/vps--SSR%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>下载安装脚本：</p><p>https://raw.githubusercontent.com/zhou894267028/ziyong/zhou-Linux-SSR/ssr.sh</p><p>chmod +x ssr.sh</p><p>bash ssr.sh</p><p><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/1706650186.png" data-fancybox="gallery" data-type="image" data-caption="1.png"><img src="http://wenziju.com/usr/uploads/2020/02/1706650186.png" alt="1.png" width="871" height="806" class="block" title="1.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/2866123008.png" data-fancybox="gallery" data-type="image" data-caption="2.png"><img src="http://wenziju.com/usr/uploads/2020/02/2866123008.png" alt="2.png" class="block" title="2.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/688087391.png" data-fancybox="gallery" data-type="image" data-caption="3.png"><img src="http://wenziju.com/usr/uploads/2020/02/688087391.png" alt="3.png" class="block" title="3.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/2132978974.png" data-fancybox="gallery" data-type="image" data-caption="4.png"><img src="http://wenziju.com/usr/uploads/2020/02/2132978974.png" alt="4.png" class="block" title="4.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/1254412047.png" data-fancybox="gallery" data-type="image" data-caption="5.png"><img src="http://wenziju.com/usr/uploads/2020/02/1254412047.png" alt="5.png" class="block" title="5.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/4096829493.png" data-fancybox="gallery" data-type="image" data-caption="6.png"><img src="http://wenziju.com/usr/uploads/2020/02/4096829493.png" alt="6.png" class="block" title="6.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/540824237.png" data-fancybox="gallery" data-type="image" data-caption="7.png"><img src="http://wenziju.com/usr/uploads/2020/02/540824237.png" alt="7.png" class="block" title="7.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/1999123496.png" data-fancybox="gallery" data-type="image" data-caption="8.png"><img src="http://wenziju.com/usr/uploads/2020/02/1999123496.png" alt="8.png" class="block" title="8.png" /></a></p><p><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/1579403427.png" data-fancybox="gallery" data-type="image" data-caption="9.png"><img src="http://wenziju.com/usr/uploads/2020/02/1579403427.png" alt="9.png" class="block" title="9.png" /></a><a class="light-link" href="http://wenziju.com/usr/uploads/2020/02/3856550369.png" data-fancybox="gallery" data-type="image" data-caption="10.png"><img src="http://wenziju.com/usr/uploads/2020/02/3856550369.png" alt="10.png" class="block" title="10.png" /></a></p><p>&nbsp;</p><p>使用：</p><p>1，下载Windows的客户端&nbsp;<a href="https://wenziju.com/usr/uploads/2020/02/2914197768.rar">SSR.rar</a></p><p>2，解压后根据服务端的信息配置一个ssr中的服务</p><p>3，在浏览器中配置代理地址，一般都是127.0.0.1:安装时的端口</p><p>知识介绍：</p><p>GFW 长城防火墙</p><p>　　检测方式：流量头，判断特征，判断ip，端口，数据量大小和长短，tcp长连接时长，被动监听，主动嗅探</p><p>1，软件翻墙</p><p>　　1，早期vpn ---&gt; 正向代理，现在vpn ----&gt; 端对端加密</p><p>　　2，shadow socks，及衍生品SSR,V 2Ray Trojan 本地服务器加密流量，发送远程服务器，再转发，</p><p>　　加密：加密方式多种多样，aes-256-cfb ，Vmess</p><p>　　<em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">协议：shadow socks，shadow socksR，shadow socket ，v 2ray clash，surge，</em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">前两个是协议，但也有同名软件，有的软件支持协议多，有的效率高，有的协议新</em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">只能代理应用层的代理，一般没有底层权限，一些系统软件无法使用</em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">2，硬件翻墙</em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">1，可理解为将翻墙软件放到路由器，但路由器cup一般，用来加密，解密....</em></em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">2，软路由器：改装的路由器，或电脑改装，但比较贵，配置繁琐，维护繁琐</em></em></em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em></em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">3，网关翻墙：推荐</em></em></em></em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"> 　　1，通过一台计算机安装软件当做网关，实现路由功能，windows的clash，mac surge</em></em></em></em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em></em></em></em></em></em></em></em></em></em></em><em id="__mceDel">线路：</em></p><p><em id="__mceDel"></em><em id="__mceDel"><em id="__mceDel">1，现在我们的普通线路</em></em></p><p><em id="__mceDel"><em id="__mceDel"></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">2，新的线路</em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">新线路：</em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">cn2：电信的下一代网络，有qos，反正就是速度快点，比较贵</em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">BGP:边界网关协议，可以自动识别移动联通电信，会自动切换</em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">google：gcp</em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">亚马逊：aws</em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">微软：azure</em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">香港：pccw</em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em></em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">国际专线：iplc 价格奇贵，不过GFW</em></em></em></em></em></em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em></em></em></em></em></em></em></em></em><em id="__mceDel">VPS还是机场</em></p><p><em id="__mceDel">　　</em><em id="__mceDel"><em id="__mceDel">VPS: 自己搭建</em></em></p><p><em id="__mceDel"><em id="__mceDel">　　　　</em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">主机：Linode，Vultr，搬 瓦 工，Bandwagon，</em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　　　</em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">选软件：前边的翻墙软件&nbsp; &nbsp;&nbsp;</em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">例：trojan：https://tlanyan.me/trojan-tutorial/#tutorial</em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">　　</em></em></em></em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">机场：别人搭建的vps</em></em></em></em></em></em></p><p><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"><em id="__mceDel"></em></em></em></em></em></em><em id="__mceDel">推荐：</em></p><p><em id="__mceDel">　　大多数人使用：shado wsocks&nbsp;</em></p><p><em id="__mceDel">　　</em><em id="__mceDel"><em id="__mceDel">vps：比较安全v 2ary</em></em></p><p><em id="__mceDel"><em id="__mceDel">　　</em></em><em id="__mceDel"><em id="__mceDel"><em id="__mceDel">速度：trojan</em></em></em></p><p>&nbsp;</p><p>SSR介绍</p><p><img src="https://img2020.cnblogs.com/blog/1333782/202008/1333782-20200803132625134-1146373069.png" alt="" loading="lazy" /></p><p>&nbsp;</p><p>SSR客户端启动后会会开启：127.0.0.1:1080</p><p>其他软件代理方式如迅雷，浏览器：直连，<em id="__mceDel">系统代理，<em id="__mceDel">自定义代理</em></em></p><p>SSR软件的代理方式：</p><p>　　直连模式：此时无系统代理，电脑中软件默认都是系统代理，即没有代理，因此使用时，在每个软件中需要手动指定代理，</p><p>　　pac模式：不会修改系统代理，<em id="__mceDel">针对浏览器的，访问时，请求经过pac文件，决定是否到客户端代理，相比全局模式速度快一点，</em><em id="__mceDel">其他软件，相当于使用系统代理，即没有代理，若需要，还需要手动配置</em></p><p>　　全局模式：会修改系统代理，所有软件不用指定代理，即默认使用系统代理，<em id="__mceDel">所有流量经过代理客户端，有它进行判断，可能会慢一点</em></p><p>　　代理规则：<em id="__mceDel">是否绕过局域网以及大陆内部</em></p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Veno%20File%20Manager/"/>
    <url>/2022/01/16/cnblog/Veno%20File%20Manager/</url>
    
    <content type="html"><![CDATA[<p style="text-align: left;">&nbsp;VFM（Veno File Manager）是一个极简且美观的多用户网盘程序，使用简单而灵活的文件管理器，因此比较轻量，也是多用户，通过它可在线将文件发送给您的客户，每个用户使用专用文件夹，也可以仅将其作为个人文件私有云。从任何设备进行访问，直观的管理面板和常规设置，自定义你的标识Logo等。</p><p style="text-align: left;">环境：服务器（nginx，apache）需要支持PHP，推荐使用LAMP,LNMP等集成开发环境。apache自带伪静态，nginx配置如下所示。</p><p style="text-align: left;">安装：使用时需将所有VFM文件复制到网站根目录即可。</p><p style="text-align: left;">权限：/vfm-admin/config.php、/users/users.php、/uploads设置为777权限默认登录管理的用户名是 admin 密码是 password ，无需数据库。</p><p style="text-align: left;">nginx伪静态如下，若不破配置，下载文件会出错。</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:bash;gutter:true;">location / {  　　if (!-e $request_filename){    　　　　rewrite download/(.*)/sh/(.*)$ /vfm-admin/vfm-downloader.php?q=$1&amp;sh=$2 last;  　　}  　　rewrite download/(.*)/h/(.*)$ /vfm-admin/vfm-downloader.php?q=$1&amp;h=$2 last;  　　rewrite download/zip/(.*)/n/(.*)$ /vfm-admin/vfm-downloader.php?zip=$1&amp;n=$2 last;}</pre></div></div><p style="text-align: left;">官方网站：https://filemanager.veno.it/</p><p style="text-align: left;">官方在线demo：http://filemanager.veno.it/demo/</p><p style="text-align: left;">下载地址：https://codecanyon.net/item/veno-file-manager-host-and-share-files/6114247</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/UUID/"/>
    <url>/2022/01/16/cnblog/UUID/</url>
    
    <content type="html"><![CDATA[<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>UUID，是Universally Unique Identifier的缩写，UUID出现的目的，是为了让分布式系统可以不借助中心节点，就可以生成UUID来标识一些唯一的信息；</p><p>GUID，是Globally Unique Identifier的缩写，跟UUID是同一个东西，只是来源于微软。</p><h4 id="规范定义"><a href="#规范定义" class="headerlink" title="规范定义"></a>规范定义</h4><p>UUID来自于IETF发布的一个规范：<a href="https://link.jianshu.com/?t=http://www.ietf.org/rfc/rfc4122.txt">A Universally Unique IDentifier (UUID) URN Namespace</a>。</p><p>UUID来源于OSF的DCE规范，也就是RFC4122的前身</p><p>GUID来源于微软，注意RFC4122的作者之一是微软员工</p><p>下面摘录一下，RFC4144中的Abstract</p><figure class="highlight csharp"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function">This specification defines a Uniform Resource Name <span class="hljs-keyword">namespace</span> <span class="hljs-keyword">for</span></span><br><span class="hljs-function"><span class="hljs-title">UUIDs</span> (<span class="hljs-params">Universally Unique IDentifier</span>), also known <span class="hljs-keyword">as</span> <span class="hljs-title">GUIDs</span> (<span class="hljs-params">Globally</span></span><br><span class="hljs-params"><span class="hljs-function">Unique IDentifier</span>).  A UUID <span class="hljs-keyword">is</span> 128 bits <span class="hljs-built_in">long</span>, <span class="hljs-keyword">and</span> can guarantee</span><br><span class="hljs-function">uniqueness across space <span class="hljs-keyword">and</span> time.  UUIDs were originally used <span class="hljs-keyword">in</span> the</span><br><span class="hljs-function">Apollo Network Computing System <span class="hljs-keyword">and</span> later <span class="hljs-keyword">in</span> the Open Software</span><br><span class="hljs-function">Foundation&#x27;<span class="hljs-title">s</span> (<span class="hljs-params">OSF</span>) Distributed Computing <span class="hljs-title">Environment</span> (<span class="hljs-params">DCE</span>), <span class="hljs-keyword">and</span> then</span><br><span class="hljs-function"><span class="hljs-keyword">in</span> Microsoft Windows platforms.</span><br><span class="hljs-function"></span><br><span class="hljs-function">This specification <span class="hljs-keyword">is</span> derived <span class="hljs-keyword">from</span> the DCE specification <span class="hljs-keyword">with</span> the</span><br><span class="hljs-function">kind permission of the <span class="hljs-title">OSF</span> (<span class="hljs-params">now known <span class="hljs-keyword">as</span> The Open Group</span>).</span><br><span class="hljs-function">Information <span class="hljs-keyword">from</span> earlier versions of the DCE specification have been</span><br><span class="hljs-function">incorporated <span class="hljs-keyword">into</span> <span class="hljs-keyword">this</span> document.</span><br></code></pre></td></tr></table></figure><p>1个UUID是1个16字节（128位）的数字；为了方便阅读，通常将UUID表示成如下的方式：</p><p>123e4567-e89b-12d3-a456-426655440000</p><p>1个UUID被连字符分为五段，形式为8-4-4-4-12的32个字符。</p><p>其中的字母是16进制表示，大小写无关。</p><h2 id="二、不同的版本"><a href="#二、不同的版本" class="headerlink" title="二、不同的版本"></a>二、不同的版本</h2><p>UUID本身也经过了<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Universally_unique_identifier#Variants_and_versions">多个版本的演化</a>，每个版本的算法都不同。</p><h4 id="标准格式"><a href="#标准格式" class="headerlink" title="标准格式"></a>标准格式</h4><p>UUID的格式是这样的：xxxxxxxx-xxxx-Mxxx-Nxxx-xxxxxxxxxxxx</p><p>N那个位置，只会是8,9,a,b</p><p>M那个位置，代表版本号，由于UUID的标准实现有5个版本，所以只会是1,2,3,4,5</p><h4 id="各个版本简介"><a href="#各个版本简介" class="headerlink" title="各个版本简介"></a>各个版本简介</h4><h5 id="版本1：基于时间的UUID"><a href="#版本1：基于时间的UUID" class="headerlink" title="版本1：基于时间的UUID"></a>版本1：基于时间的UUID</h5><p>通过当前时间戳、机器MAC地址生成；</p><p>由于在算法中使用了MAC地址，这个版本的UUID可以保证在全球范围的唯一性。</p><p>但与此同时，因为它暴露了电脑的MAC地址和生成这个UUID的时间，这就是这个版本UUID被诟病的地方。</p><p>在python里面的使用的例子：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&gt;&gt;&gt; import uuid<br>&gt;&gt;&gt; uuid.uuid1()<br>UUID(<span class="hljs-string">&#x27;444b5cc0-ae5d-11e6-8d22-28924a431726&#x27;</span>)<br>&gt;&gt;&gt; uuid.uuid1()<br>UUID(<span class="hljs-string">&#x27;46a9bf21-ae5d-11e6-9549-28924a431726&#x27;</span>)<br></code></pre></td></tr></table></figure><p>其中，最后的12个字符<code>28924a431726</code>就是我电脑网卡的MAC地址</p><h5 id="版本2：DCE安全的UUID"><a href="#版本2：DCE安全的UUID" class="headerlink" title="版本2：DCE安全的UUID"></a>版本2：DCE安全的UUID</h5><p>DCE安全的UUID和基于时间的UUID算法相同，但会把时间戳的前4位置换为POSIX的UID或GID。</p><p>不过，在UUID的规范里面没有明确地指定，所以基本上所有的UUID实现都不会实现这个版本。</p><h5 id="版本3：基于名字空间的UUID（MD5）"><a href="#版本3：基于名字空间的UUID（MD5）" class="headerlink" title="版本3：基于名字空间的UUID（MD5）"></a>版本3：基于名字空间的UUID（MD5）</h5><p>由用户指定1个namespace和1个具体的字符串，通过MD5散列，来生成1个UUID；</p><p>根据规范描述，这个版本的存在是为了向后兼容?平时这个版本我们也很少用到</p><p>在python里面的使用的例子：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&gt;&gt;&gt; import uuid<br>&gt;&gt;&gt; uuid.uuid3(uuid.NAMESPACE_DNS, <span class="hljs-string">&quot;myString&quot;</span>)<br>UUID(<span class="hljs-string">&#x27;21fc48e5-63f0-3849-8b9d-838a012a5936&#x27;</span>)<br>&gt;&gt;&gt; uuid.uuid3(uuid.NAMESPACE_DNS, <span class="hljs-string">&quot;myString&quot;</span>)<br>UUID(<span class="hljs-string">&#x27;21fc48e5-63f0-3849-8b9d-838a012a5936&#x27;</span>)<br></code></pre></td></tr></table></figure><p>在java中使用的例子</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(UUID<span class="hljs-selector-class">.nameUUIDFromBytes</span>(&quot;myString&quot;<span class="hljs-selector-class">.getBytes</span>(&quot;UTF-<span class="hljs-number">8</span>&quot;))<span class="hljs-selector-class">.toString</span>());<br></code></pre></td></tr></table></figure><p>Java只支持生成版本3和版本4的UUID</p><h5 id="版本4：基于随机数的UUID"><a href="#版本4：基于随机数的UUID" class="headerlink" title="版本4：基于随机数的UUID"></a>版本4：基于随机数的UUID</h5><p>根据随机数，或者伪随机数生成UUID。这种UUID产生重复的概率是可以计算出来的，但随机的东西就像是买彩票：你指望它发财是不可能的，但狗屎运通常会在不经意中到来。这个版本应该是平时大家无意中用得最多的版本了；</p><p>在python里面使用的例子：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&gt;&gt;&gt; import uuid<br>&gt;&gt;&gt; uuid.uuid4()<br>UUID(<span class="hljs-string">&#x27;e584539d-a334-4f15-9819-88d73fcf707d&#x27;</span>)<br>&gt;&gt;&gt; uuid.uuid4()<br>UUID(<span class="hljs-string">&#x27;76ec02cc-1b1d-4ad3-bd09-a4f6d67c7af4&#x27;</span>)<br></code></pre></td></tr></table></figure><p>以及Java中大家最熟悉的：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(UUID<span class="hljs-selector-class">.randomUUID</span>()<span class="hljs-selector-class">.toString</span>());<br></code></pre></td></tr></table></figure><h5 id="版本5：基于名字空间的UUID（SHA1）"><a href="#版本5：基于名字空间的UUID（SHA1）" class="headerlink" title="版本5：基于名字空间的UUID（SHA1）"></a>版本5：基于名字空间的UUID（SHA1）</h5><p>和版本3一样，不过散列函数换成了SHA1</p><p>在python里面的使用的例子：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby">&gt;&gt;&gt; import uuid<br>&gt;&gt;&gt; uuid.uuid5(uuid.NAMESPACE_DNS, <span class="hljs-string">&quot;myString&quot;</span>)<br>UUID(<span class="hljs-string">&#x27;cd086011-6aac-5a06-a94a-0b67c59649ba&#x27;</span>)<br>&gt;&gt;&gt; uuid.uuid5(uuid.NAMESPACE_DNS, <span class="hljs-string">&quot;myString&quot;</span>)<br>UUID(<span class="hljs-string">&#x27;cd086011-6aac-5a06-a94a-0b67c59649ba&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="三、UUID的应用"><a href="#三、UUID的应用" class="headerlink" title="三、UUID的应用"></a>三、UUID的应用</h2><p>从几个版本的定义来看，感觉都不是特别完美，可能版本4是平时用得最多的，但是在现实的业务场景中，考虑到可读性、唯一性、长度，我们一般也不会选择UUID当做数据库的主键。</p><p>至于其他场景的应用，可以结合具体的场景，来使用各个版本的实现。</p><h2 id="四、UUID和各个编程语言"><a href="#四、UUID和各个编程语言" class="headerlink" title="四、UUID和各个编程语言"></a>四、UUID和各个编程语言</h2><ul><li>微软：<a href="https://link.jianshu.com/?t=http://msdn.microsoft.com/en-us/library/system.guid(v=vs.110).aspx">http://msdn.microsoft.com/en-us/library/system.guid(v=vs.110).aspx</a></li><li>Linux：<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Util-linux">http://en.wikipedia.org/wiki/Util-linux</a></li><li>Android：<a href="https://link.jianshu.com/?t=http://developer.android.com/reference/java/util/UUID.html">http://developer.android.com/reference/java/util/UUID.html</a></li><li>PHP：<a href="https://link.jianshu.com/?t=http://php.net/manual/en/function.uniqid.php#94959">http://php.net/manual/en/function.uniqid.php#94959</a></li><li>MySQL:<a href="https://link.jianshu.com/?t=http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-functions.html#function_uuid">http://dev.mysql.com/doc/refman/5.1/en/miscellaneous-functions.html#function_uuid</a></li><li>Java：<a href="https://link.jianshu.com/?t=http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html">http://docs.oracle.com/javase/7/docs/api/java/util/UUID.html</a></li><li>nodejs - <a href="https://link.jianshu.com/?t=https://github.com/broofa/node-uuid">https://github.com/broofa/node-uuid</a></li></ul><h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><ul><li><a href="https://link.jianshu.com/?t=https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_3_.28MD5_hash_and_namespace.29">https://en.wikipedia.org/wiki/Universally_unique_identifier#Version_3_.28MD5_hash_and_namespace.29</a></li><li><a href="https://link.jianshu.com/?t=https://github.com/simongong/js-stackoverflow-highest-votes/blob/master/questions1-10/how-to-create-a-UUID-in-javascript.md">https://github.com/simongong/js-stackoverflow-highest-votes/blob/master/questions1-10/how-to-create-a-UUID-in-javascript.md</a></li><li><a href="https://link.jianshu.com/?t=http://www.blogjava.net/feelyou/archive/2008/10/14/234320.html">http://www.blogjava.net/feelyou/archive/2008/10/14/234320.html</a></li></ul><p>来源：<a href="https://www.jianshu.com/p/d77f3ef0868a">https://www.jianshu.com/p/d77f3ef0868a</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Ubuntu%20%E6%9B%B4%E6%94%B9%E8%BD%AF%E4%BB%B6%E6%BA%90/"/>
    <url>/2022/01/16/cnblog/Ubuntu%20%E6%9B%B4%E6%94%B9%E8%BD%AF%E4%BB%B6%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h2 id="1，备份-etc-apt-sources-list"><a href="#1，备份-etc-apt-sources-list" class="headerlink" title="1，备份 /etc/apt/sources.list"></a>1，备份 /etc/apt/sources.list</h2><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">sudo cp /etc/apt/sources.list  /etc/apt/sources.list.backup  <br></code></pre></td></tr></table></figure><h2 id="2，删除原内容，改为："><a href="#2，删除原内容，改为：" class="headerlink" title="2，删除原内容，改为："></a>2，删除原内容，改为：</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse<br>deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse<br></code></pre></td></tr></table></figure><h2 id="3，更新"><a href="#3，更新" class="headerlink" title="3，更新"></a>3，更新</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Typora%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/"/>
    <url>/2022/01/16/cnblog/Typora%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="LaTeX编辑数学公式基本语法元素"><a href="#LaTeX编辑数学公式基本语法元素" class="headerlink" title="LaTeX编辑数学公式基本语法元素"></a>LaTeX编辑数学公式基本语法元素</h1><h2 id="LaTeX中的数学模式有两种形式"><a href="#LaTeX中的数学模式有两种形式" class="headerlink" title="LaTeX中的数学模式有两种形式:"></a>LaTeX中的数学模式有两种形式:</h2><ul><li><p>inline 和 display。</p><ul><li>前者是指在正文插入行间数学公式,后者独立排列,可以有或没有编号。</li></ul></li><li><p>行间公式(inline)</p><ul><li>用$将公式括起来。</li></ul></li><li><p>块间公式(displayed)</p><ul><li>用$$将公式括起来是无编号的形式</li><li>还有[…..]的无编号独立公式形式但Markdown好像不支持。</li><li>块间元素默认是居中显示的。</li></ul></li></ul><h2 id="各类希腊字母编辑表"><a href="#各类希腊字母编辑表" class="headerlink" title="各类希腊字母编辑表"></a>各类希腊字母编辑表</h2><p><img src="https://img-blog.csdnimg.cn/20181104140244618.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5ZGF5X2Q=,size_16,color_FFFFFF,t_70" alt="希腊字母编辑表"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625212904441-554542957.png"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625212932605-1732823111.png"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625212941269-1382661531.png"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625212948912-513780346.png"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625212956496-1425718002.png"><br><img src="https://img2020.cnblogs.com/blog/1333782/202006/1333782-20200625213005652-128589564.png"></p><ul><li><h2 id="上下标、根号、省略号"><a href="#上下标、根号、省略号" class="headerlink" title="上下标、根号、省略号"></a>上下标、根号、省略号</h2><ul><li>下标：x_i:$x_i$</li><li>上标：x^2: $x^2$</li><li>注意：上下标如果多于一个字母或者符号，需要用一对{}括起来 x_{i1}: $x_{i1}$ $x^{at}$</li><li>根号: \sqrt[n]{5}:  $\sqrt[n]{5}$    </li><li>省略号：\cdots:  $\cdots$</li></ul></li><li><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><ul><li><p>基本运算符+ - * ÷</p><ul><li><p>求和: </p><ul><li>\sum_1^n: $\sum_1^n$</li><li>\sum_{x,y}: $\sum_{x,y}$</li></ul></li><li><p>积分:</p><ul><li>\int_1^n: $\int_1^n$</li></ul></li><li><p>极限</p><ul><li>lim_{x \to \infy}: $lim_{x \to \infty}$</li></ul></li><li><p>行列式</p><ul><li><p>```markdown<br>$$<br>X=\left|</p><div class="code-wrapper"><pre><code class="hljs">\begin&#123;matrix&#125;    x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; \cdots &amp; x_&#123;1d&#125;\\    x_&#123;21&#125; &amp; x_&#123;22&#125; &amp; \cdots &amp; x_&#123;2d&#125;\\    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\    x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; \cdots &amp; x_&#123;1d&#125;\\\end&#123;matrix&#125;</code></pre></div><p>\right|<br>$$</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs taggerscript"><br>    $$<br>    X=<span class="hljs-symbol">\l</span>eft|<br>    <span class="hljs-symbol">\b</span>egin&#123;matrix&#125;<br>    x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; <span class="hljs-symbol">\c</span>dots &amp; x_&#123;1d&#125;<span class="hljs-symbol">\\</span><br>    x_&#123;21&#125; &amp; x_&#123;22&#125; &amp; <span class="hljs-symbol">\c</span>dots &amp; x_&#123;2d&#125;<span class="hljs-symbol">\\</span><br>    <span class="hljs-symbol">\v</span>dots &amp; <span class="hljs-symbol">\v</span>dots &amp; <span class="hljs-symbol">\d</span>dots &amp; <span class="hljs-symbol">\v</span>dots <span class="hljs-symbol">\\</span><br>    x_&#123;11&#125; &amp; x_&#123;12&#125; &amp; <span class="hljs-symbol">\c</span>dots &amp; x_&#123;1d&#125;<span class="hljs-symbol">\\</span><br>    <span class="hljs-symbol">\e</span>nd&#123;matrix&#125;<br>    <span class="hljs-symbol">\r</span>ight|<br>    $$<br><br>- 矩阵<br><br>  - ```markdown<br>    $$<br>    <span class="hljs-symbol">\b</span>egin&#123;matrix&#125; <br>    1 &amp; x &amp; x^2<span class="hljs-symbol">\\</span> <br>    1 &amp; y &amp; y^2<span class="hljs-symbol">\\</span> <br>    1 &amp; z &amp; z^2<span class="hljs-symbol">\\</span> <br>    <span class="hljs-symbol">\e</span>nd&#123;matrix&#125;<br>    $$<br></code></pre></td></tr></table></figure><p>$$<br>\begin{matrix} </p><div class="code-wrapper"><pre><code class="hljs">1 &amp; x &amp; x^2\\ 1 &amp; y &amp; y^2\\ 1 &amp; z &amp; z^2\\ \end&#123;matrix&#125;</code></pre></div><p>$$</p></li></ul></li></ul></li></ul></li><li><h2 id="箭头"><a href="#箭头" class="headerlink" title="箭头"></a>箭头</h2><ul><li><img src="https://img-blog.csdnimg.cn/20181104140310286.JPG?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhcHB5ZGF5X2Q=,size_16,color_FFFFFF,t_70" alt="img"></li></ul></li><li><h2 id="分段函数"><a href="#分段函数" class="headerlink" title="分段函数"></a>分段函数</h2><ul><li><p>```markdown<br>$$<br>f(n)=</p><div class="code-wrapper"><pre><code class="hljs">\begin&#123;cases&#125;    n/2, &amp; \text&#123;if $n$ is even&#125;\\    3n+1,&amp; \text&#123;if $n$ is odd&#125;\end&#123;cases&#125;</code></pre></div><p>$$</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>    <span class="hljs-variable">$$</span> f(n)= \<span class="hljs-keyword">begin</span>&#123;cases&#125; n/<span class="hljs-number">2</span>, &amp; \text&#123;if <span class="hljs-variable">$n</span><span class="hljs-variable">$ </span>is even&#125;\\ <span class="hljs-number">3</span>n+<span class="hljs-number">1</span>,&amp; \text&#123;if <span class="hljs-variable">$n</span><span class="hljs-variable">$ </span>is odd&#125; \<span class="hljs-keyword">end</span>&#123;cases&#125; <span class="hljs-variable">$$</span><br><br>- <span class="hljs-comment">## 方程组</span><br><br>  - ```markdown<br>    <span class="hljs-variable">$$</span><br>    \left\&#123;<br>    \<span class="hljs-keyword">begin</span>&#123;array&#125;&#123;c&#125;<br>    a_1x+b_1y+c_1z=d_1\\<br>    a_2x+b_2y+c_2z=d_2\\<br>    a_3x+b_3y+c_3z=d_3<br>    \<span class="hljs-keyword">end</span>&#123;array&#125;<br>    \right.<br>    <span class="hljs-variable">$$</span><br></code></pre></td></tr></table></figure><p>$$ \left{ \begin{array}{c}     a_1x+b_1y+c_1z=d_1\     a_2x+b_2y+c_2z=d_2\     a_3x+b_3y+c_3z=d_3 \end{array} \right. $$</p></li></ul></li><li><h2 id="常用公式"><a href="#常用公式" class="headerlink" title="常用公式"></a>常用公式</h2><ul><li><p>线性模型</p><ul><li><p>```markdown<br>$$</p><div class="code-wrapper"><pre><code class="hljs">h(\theta) = \sum_&#123;j=0&#125; ^n \theta_j x_j</code></pre></div><p>$$</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gams"><br>    <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span> h(\theta) = \sum_&#123;j=<span class="hljs-number">0</span>&#125; ^n \theta_j x_j <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><br><br>- 均方误差<br><br>  - ```markdown<br>    <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><br>    J(\theta) = \<span class="hljs-built_in">frac</span>&#123;<span class="hljs-number">1</span>&#125;&#123;<span class="hljs-number">2</span>m&#125;\sum_&#123;i=<span class="hljs-number">0</span>&#125;^m(y^i - h_\theta(x^i))^<span class="hljs-number">2</span><br>    <span class="hljs-symbol">$</span><span class="hljs-symbol">$</span><br></code></pre></td></tr></table></figure><p>$$ J(\theta) = \frac{1}{2m}\sum_{i=0}^m(y^i - h_\theta(x^i))^2 $$</p></li></ul></li><li><p>求积公式</p><ul><li><p>```markdown<br>$$</p><div class="code-wrapper"><pre><code class="hljs">H_c=\sum_&#123;l_1+\dots +l_p&#125;\prod^p_&#123;i=1&#125; \binom&#123;n_i&#125;&#123;l_i&#125;</code></pre></div><p>$$</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><br>    <span class="hljs-symbol">\$</span>$ H_c=<span class="hljs-symbol">\s</span>um_&#123;l_1+<span class="hljs-symbol">\d</span>ots +l_p&#125;<span class="hljs-symbol">\p</span>rod^p_&#123;i=1&#125; <span class="hljs-symbol">\b</span>inom&#123;n_i&#125;&#123;l_i&#125; <span class="hljs-symbol">\$</span>$<br><br>- 批量梯度下降<br><br>  - ```markdown<br>    $$<br>    <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\p</span>artial J(<span class="hljs-symbol">\t</span>heta)&#125;&#123;<span class="hljs-symbol">\p</span>artial<span class="hljs-symbol">\t</span>heta_j&#125; = -<span class="hljs-symbol">\f</span>rac1m<span class="hljs-symbol">\s</span>um_&#123;i=0&#125;^m(y^i - h_<span class="hljs-symbol">\t</span>heta(x^i))x^i_j<br>    $$<br></code></pre></td></tr></table></figure><p>$$ \frac{\partial J(\theta)}{\partial\theta_j} = -\frac1m\sum_{i=0}^m(y^i -     h_\theta(x^i))x^i_j $$</p></li></ul></li><li><p>推导过程</p><ul><li>```markdown<br>$$<br>\begin{align}<div class="code-wrapper"><pre><code class="hljs">\frac&#123;\partial J(\theta)&#125;&#123;\partial\theta_j&#125;&amp; = -\frac1m\sum_&#123;i=0&#125;^m(y^i - h_\theta(x^i)) \frac&#123;\partial&#125;&#123;\partial\theta_j&#125;(y^i-h_\theta(x^i))\\&amp; = -\frac1m\sum_&#123;i=0&#125;^m(y^i-h_\theta(x^i)) \frac&#123;\partial&#125;&#123;\partial\theta_j&#125;(\sum_&#123;j=0&#125;^n\theta_j x^i_j-y^i)\\&amp;=-\frac1m\sum_&#123;i=0&#125;^m(y^i -h_\theta(x^i)) x^i_j</code></pre></div>\end{align}<br>$$<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><br>      $$<br>      <span class="hljs-symbol">\b</span>egin&#123;align&#125;<br>      <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\p</span>artial J(<span class="hljs-symbol">\t</span>heta)&#125;&#123;<span class="hljs-symbol">\p</span>artial<span class="hljs-symbol">\t</span>heta_j&#125;<br>      &amp; = -<span class="hljs-symbol">\f</span>rac1m<span class="hljs-symbol">\s</span>um_&#123;i=0&#125;^m(y^i - h_<span class="hljs-symbol">\t</span>heta(x^i)) <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\p</span>artial&#125;&#123;<span class="hljs-symbol">\p</span>artial<span class="hljs-symbol">\t</span>heta_j&#125;(y^i-h_<span class="hljs-symbol">\t</span>heta(x^i))<span class="hljs-symbol">\\</span><br>      &amp; = -<span class="hljs-symbol">\f</span>rac1m<span class="hljs-symbol">\s</span>um_&#123;i=0&#125;^m(y^i-h_<span class="hljs-symbol">\t</span>heta(x^i)) <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\p</span>artial&#125;&#123;<span class="hljs-symbol">\p</span>artial<span class="hljs-symbol">\t</span>heta_j&#125;(<span class="hljs-symbol">\s</span>um_&#123;j=0&#125;^n<span class="hljs-symbol">\t</span>heta_j x^i_j-y^i)<span class="hljs-symbol">\\</span><br>      &amp;=-<span class="hljs-symbol">\f</span>rac1m<span class="hljs-symbol">\s</span>um_&#123;i=0&#125;^m(y^i -h_<span class="hljs-symbol">\t</span>heta(x^i)) x^i_j<br>      <span class="hljs-symbol">\e</span>nd&#123;align&#125;<br>      $$<br><br>- ## 字符下标<br><br>  - ```markdown<br>    $$<br>    <span class="hljs-symbol">\m</span>ax <span class="hljs-symbol">\l</span>imits_&#123;a&lt;x&lt;b&#125;<span class="hljs-symbol">\&#123;</span>f(x)<span class="hljs-symbol">\&#125;</span><br>    $$<br></code></pre></td></tr></table></figure></li></ul><p>$$ \max \limits_{a&lt;x&lt;b}{f(x)}     $$</p></li></ul></li><li><p>end</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Thinkphp/"/>
    <url>/2022/01/16/cnblog/Thinkphp/</url>
    
    <content type="html"><![CDATA[<h1 id="thinkphp：mvc模式"><a href="#thinkphp：mvc模式" class="headerlink" title="thinkphp：mvc模式"></a>thinkphp：mvc模式</h1><h2 id="1，thinkphp的安装配置"><a href="#1，thinkphp的安装配置" class="headerlink" title="1，thinkphp的安装配置"></a>1，thinkphp的安装配置</h2><ol><li><p>条件</p><ol><li>PHP&gt;=5.4.0</li><li>PDO MbString CURL PHP Externsion</li><li>Mysql</li><li>Apache或Nginx</li></ol></li><li><p>安装：</p><ul><li><p>composer</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">composer config -g repo.packagist composer https://packagist.phpcomposer.com<br>composer create-project --prefer-dist topthink/think think_composer<br></code></pre></td></tr></table></figure></li><li><p>git</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/top-think/think.git<br></code></pre></td></tr></table></figure></li><li><p>直接到thinkphp官网下载稳定版 5.0.24</p></li><li><p>5.0.24 直接访问public文件夹即可</p><p>6.0版本访问时会报错</p></li></ul></li><li><p>目录结构</p><ol><li><p>application 所有的应用  目录</p><ol><li>index 前台逻辑<ol><li>controller 模块的控制层</li><li>model 新建</li><li>view 新建</li></ol></li><li>admin 后台逻辑</li><li>command.php 控制台的配置文件</li><li>common.php 项目的公用文件，通用函数一般放在这里</li><li>config.php 应用配置文件 admin,index 都是用它</li><li>database.php 数据库</li><li>route.php url</li><li>tags.php 应用行为扩展文件， 埋下了很多钩子</li></ol></li><li><p>extend 第三方库</p></li><li><p>public 网站根目录，都是允许访问的</p><ol><li><p>favicon.ico 网站图标</p></li><li><p>index.php 所有请求的入口文件，都要经过index转发</p></li><li><p>rebots.txt 爬虫允许文件</p></li><li><p>router.php 内置的启动文件，若没有apache ,只安装了php</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">php -s localhost:9090 router.php<br></code></pre></td></tr></table></figure></li><li><p>static 静态文件</p></li></ol></li><li><p>runtime 日志，缓存，编译文件</p></li><li><p>thinkphp 框架文件</p><ol><li>base.php 定义常量</li><li>composer.json composer文件</li><li>console.php 控制台的入口文件</li><li>convention.php 框架默认配置文件</li><li>helper.php 助手函数,例如：Config.php —&gt;config()</li><li>lang 语言包</li><li>library 框架核心<ol><li>traits 扩展</li><li>think 框架核心</li></ol></li><li>PHPunit.xml 测试文件</li><li>start.php 框架启动文件</li></ol></li><li><p>tpl 默认模板</p><ol><li>default_index.tpl 控制器模板文件</li><li>dispatch_jump.tpl </li><li>page_trace.tpl 调试模板文件</li><li>think_exception.tpl 异常模板文件</li></ol></li><li><p>vendor composer 安装过程生成的目录，composer 安装的库会在这里</p></li></ol></li><li><p>目录和文件开发规范</p><ol><li><p><font color=red>目录使用小写加下划线</font></p></li><li><p>所有类库函数名以“.php”结尾</p></li><li><p>namespace app/index/controller; 要指明所在目录</p></li><li><p>不要使用上下划线开头</p></li><li><p>定义常量</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">define(<span class="hljs-string">&#x27;APP_PATH&#x27;</span>,<span class="hljs-string">&#x27;dev&#x27;</span>)<br></code></pre></td></tr></table></figure></li><li><p>表和字段不能以下划线开头，命名使用下划线隔开</p></li><li><p><font>顶级命名空间是app，尽量不要修改</font></p></li></ol></li><li><p>模块</p><ol><li><p>修改网站根目录为public</p></li><li><p>修改.htaccess</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">IfModule</span> <span class="hljs-attr">mod_rewrite.c</span>&gt;</span><br>  Options +FollowSymlinks -Multiviews<br>  RewriteEngine On<br><br>  RewriteCond %&#123;REQUEST_FILENAME&#125; !-d<br>  RewriteCond %&#123;REQUEST_FILENAME&#125; !-f<br>  RewriteRule ^(.*)$ index.php?/$1 [QSA,PT,L]<br><span class="hljs-tag">&lt;/<span class="hljs-name">IfModule</span>&gt;</span><br># 最后一行加？<br></code></pre></td></tr></table></figure></li><li><p>此时访问localhost 即访问的是 app/controller/index/ 文件中的index控制器方法</p><ol><li><p>在app下建立admin\controller/Index.php 访问时使用../admin/index/index 即可</p></li><li><p>注意common模块 不能直接使用</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">index</span>\<span class="hljs-title">controller</span>;<br><span class="hljs-keyword">use</span> <span class="hljs-title">app</span>\<span class="hljs-title">common</span>\<span class="hljs-title">controller</span>\<span class="hljs-title">Index</span> <span class="hljs-title">as</span> <span class="hljs-title">commonIndex</span>;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;this is index Index index&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">common</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable">$common</span> = <span class="hljs-keyword">new</span> commonIndex();<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$common</span>-&gt;index();<br>&#125;<br><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><p>配置</p><p>dump(config()); thinkphp的配置信息  /thinkphp/convention.php  全局配置</p><ol><li><p>在public中增加常量定义</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment">//定义配置文件目录</span><br>define(<span class="hljs-string">&#x27;CONF_PATH&#x27;</span>, <span class="hljs-keyword">__DIR__</span> . <span class="hljs-string">&#x27;/../conf/&#x27;</span>);  <span class="hljs-comment">//当前文件夹的上级文件夹下的</span><br></code></pre></td></tr></table></figure></li><li><p>在/conf/中建立config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">return</span> [<br><span class="hljs-string">&#x27;app_author&#x27;</span>=&gt;<span class="hljs-string">&#x27;Dean&#x27;</span>,<br><span class="hljs-string">&#x27;app_email&#x27;</span> =&gt;<span class="hljs-string">&#x27;1028968939@qq.com&#x27;</span>,<br>    <span class="hljs-string">&#x27;app_debug&#x27;</span>=&gt;<span class="hljs-literal">true</span>, <span class="hljs-comment">// 显示报错信息</span><br>]<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>此时dump后会新增</p></li><li><p>若要修改原有的值，通命名替换即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = [<span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;a&#x27;</span>]<br><span class="hljs-variable">$b</span> = [<span class="hljs-string">&#x27;user&#x27;</span>=&gt;<span class="hljs-string">&#x27;b&#x27;</span>]<br>dump(array_merge(<span class="hljs-variable">$a</span>,<span class="hljs-variable">$b</span>)) <span class="hljs-comment"># user 为b</span><br></code></pre></td></tr></table></figure></li><li><p>扩展配置</p><ol><li>/conf/extra 建立</li><li>里边建立的xxx.php 都可作为配置文件</li><li>注意数据库database.php 放在extra中可以，放在conf下也可以  比较特殊</li><li>convention -》config-》conf下一级文件-》extra目录下</li></ol></li></ol></li><li><p>场景配置</p><ol><li>在应用配置中添加 ‘app_state’    =&gt;    ‘home’</li><li>建立文件/conf/home.php</li></ol></li><li><p>模块配置</p><ol><li>为每个模块配置</li><li>建立/conf/模块名文件夹/config.php</li><li>还可以建立/conf/模块名/extra</li></ol></li><li><p>动态配置</p></li></ol>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 在controller中生效</span><br><span class="hljs-comment"># 给controller添加构造方法</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>    config(<span class="hljs-string">&#x27;controller&#x27;</span>,<span class="hljs-string">&#x27;indexController&#x27;</span>); <span class="hljs-comment"># 整个controll生效，放在方法中，只在方法中生效</span><br>&#125;<br></code></pre></td></tr></table></figure><ol start="10"><li><p>Config和助手函数config</p><ol><li><p>Config ： /thinkphp/library/think/Config.php</p><ol><li>range():调整作用域</li><li>parse():解析</li><li>load():加载配置</li><li>has():检测配置是否存在</li><li>get():获取配置</li><li>set():设置配置</li><li>reset():重置配置参数</li></ol></li><li><p>```php</p><?php    namespace app\admin\controller;    class Index{        public function index(){            dump(config());            dump(\think\Congig::get()) # 或use \think\Config            dump(Config::get('app_author')) # 获取对应值 config('app_author')            config('xxx','yyy') # 设置值，设置失败为NULL            config('xxx2','yyy2','scope')  # 指定作用域，获取时也要指定，否则为空            Config::has(xxx)  # xxx为null或不存在都是false  # config(?xxx)        }    }?><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-number">11</span>. 环境变量的配置和使用<br><br>    <span class="hljs-number">1</span>. ```php<br>       <span class="hljs-meta">&lt;?php</span><br>       <span class="hljs-keyword">namespace</span> <span class="hljs-title">app</span>\<span class="hljs-title">admin</span>\<span class="hljs-title">controller</span>;<br>       <span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">ENV</span><br>       <span class="hljs-title">class</span> <span class="hljs-title">Index</span>&#123;<br>       <span class="hljs-title">public</span> <span class="hljs-title">function</span> <span class="hljs-title">index</span>()&#123;<br>       <span class="hljs-title">dump</span>($<span class="hljs-title">_ENV</span>); <span class="hljs-comment"># 系统变量   若数组为空 在php.ini 修改 variables_order = &#x27;EGPCS&#x27;</span><br>                   dump(<span class="hljs-variable">$_ENV</span>(<span class="hljs-string">&#x27;email&#x27;</span>)) <span class="hljs-comment"># 获取，若未定义会报错</span><br>                   ENV::get(<span class="hljs-string">&quot;email&quot;</span>) <span class="hljs-comment"># 此方式未定义 不报错返回NULL</span><br>                   ENV::get(<span class="hljs-string">&quot;email&quot;</span>,<span class="hljs-string">&quot;default&quot;</span>) <span class="hljs-comment">#</span><br>                   ENV::get(<span class="hljs-string">&quot;database_hostname&quot;</span>) <span class="hljs-comment">#  可使用点语法</span><br>       &#125;<br>       &#125;<br>       <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>/.env文件  </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">email</span>=<span class="hljs-string">1028968939@qq.com</span><br><span class="hljs-attr">name</span>=<span class="hljs-string">Dean</span><br><span class="hljs-attr">status</span>=<span class="hljs-string">dev</span><br><span class="hljs-comment"># 在环境变量中都变PHP_大写</span><br><span class="hljs-attr">[database]</span><br><span class="hljs-attr">hostname</span>=<span class="hljs-string">127.0.0.1</span><br><span class="hljs-comment"># 名字便为 PHP_DATABASE_HOSTNAME</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># config.php</span><br><span class="hljs-string">&#x27;app_status&#x27;</span>=&gt;Env::get(<span class="hljs-string">&#x27;app_status&#x27;</span>,<span class="hljs-string">&#x27;dev&#x27;</span>),<br></code></pre></td></tr></table></figure></li></ol></li></ol><h2 id="2，URL和路由"><a href="#2，URL和路由" class="headerlink" title="2，URL和路由"></a>2，URL和路由</h2><ol><li><p>入口文件</p><ol><li><p>单入口文件</p><ol><li>安全监测</li></ol></li><li><p>请求过滤  .htacccess  所有的请求经过public/index.php </p></li></ol></li><li><p>入口文件绑定</p><ol><li><p>```php</p><h1 id="public-index-php"><a href="#public-index-php" class="headerlink" title="public/index.php"></a>public/index.php</h1><p>define(‘BIND_MODULE’,’admin’)<br>#此时访问localhost –&gt;/public/index.php—&gt;admin/(index)/(index) 默认</p><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><br><span class="hljs-number">2.</span> ```php<br>   <span class="hljs-meta"># config.php</span><br>   <span class="hljs-string">&#x27;auto_bind_module&#x27;</span> =&gt; <span class="hljs-literal">true</span> <span class="hljs-meta"># 开启入口文件自动绑定</span><br></code></pre></td></tr></table></figure><p>此时建立/public/api.php  访问时—》/app/ap/controller/Index/index()</p></li><li><p>路由</p><ol><li><p>```php</p><h1 id="config-php"><a href="#config-php" class="headerlink" title="config.php"></a>config.php</h1><p>‘url_route_on’    =&gt; true,<br>‘url_route_must’    =&gt;    false,# 所有url都是用路由</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><br>```php<br><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-comment">#/conf/route.php</span><br>    <span class="hljs-keyword">return</span> [<br>    <span class="hljs-string">&#x27;news/:id&#x27;</span> =&gt;<span class="hljs-string">&#x27;index/index/info&#x27;</span><br>]<br>    <span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">info</span>(<span class="hljs-params"><span class="hljs-variable">$id</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    url(<span class="hljs-string">&quot;index/index/info&quot;</span>,[<span class="hljs-string">&#x27;id&#x27;</span>=&gt;<span class="hljs-variable">$id</span>])  <span class="hljs-comment"># 本方法的路由</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-variable">$id</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>pathinfo 方法结束后剩余的路径信息</p><p>例如：index/index/index/a/b/c/d/e.html</p><p>param(): a–&gt;b,c-&gt;d  会传入这两个路径参数</p></li></ol></li></ol></li></ol><h2 id="3，请求和响应"><a href="#3，请求和响应" class="headerlink" title="3，请求和响应"></a>3，请求和响应</h2><ol><li><p>请求对象request</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$request</span> = request();<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Request</span><br><span class="hljs-title">Request</span>::<span class="hljs-title">instance</span>();<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Request</span><br><span class="hljs-title">public</span> <span class="hljs-title">function</span> <span class="hljs-title">index</span>(<span class="hljs-title">Request</span> $<span class="hljs-title">request</span>)&#123;# 建议方式<br>    <br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$request</span>-&gt;domain();<span class="hljs-comment"># 域名信息</span><br><span class="hljs-variable">$request</span>-&gt;pathionfo(); <span class="hljs-comment"># 路径信息 xxx/yyy/zz.html  &quot;.html&quot;为了安全 后缀可修改</span><br><span class="hljs-variable">$request</span>-&gt;path(); <span class="hljs-comment"># xxx/yyy/zzz</span><br><span class="hljs-variable">$request</span>-&gt;method(); <span class="hljs-comment"># 请求类型</span><br><span class="hljs-variable">$request</span>-&gt;isGet(); <span class="hljs-comment"># boolean</span><br><span class="hljs-variable">$request</span>-&gt;isPost(); <span class="hljs-comment"># boolean</span><br><span class="hljs-variable">$request</span>-&gt;isAjax();<span class="hljs-comment"># boolean </span><br><span class="hljs-variable">$request</span>-&gt;get() <span class="hljs-comment"># 数组返回，5.0之后 get不包含pathinfo中的值</span><br><span class="hljs-variable">$request</span>-&gt;param(); <span class="hljs-comment"># 合并</span><br><span class="hljs-comment">#post同理</span><br><span class="hljs-variable">$request</span>-&gt;session(); <span class="hljs-comment"># 数组</span><br>session(<span class="hljs-string">&#x27;name&#x27;</span>,<span class="hljs-string">&#x27;dean&#x27;</span>);<br><span class="hljs-comment">#使用session 在convention.php中找到session，复制到config.php,删除httponly，secure</span><br><span class="hljs-variable">$request</span>-&gt;cookie();<br>cookie(<span class="hljs-string">&#x27;email&#x27;</span>,<span class="hljs-string">&#x27;xxxx&#x27;</span>);<br><span class="hljs-variable">$request</span>-&gt;param(<span class="hljs-string">&#x27;xxx&#x27;</span>); <span class="hljs-comment"># 获取路径参数</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 获取模块 控制器 操作</span><br><span class="hljs-variable">$request</span>-&gt;module(); <span class="hljs-comment"># 获取模块 index admin等</span><br><span class="hljs-variable">$request</span>-&gt;controller();<br><span class="hljs-variable">$request</span>-&gt;action();<br><span class="hljs-variable">$request</span>-&gt;url() <span class="hljs-comment"># /index/index/xxxxxx.html?id=10 包含参数</span><br><span class="hljs-variable">$request</span>-&gt;baseUrl() <span class="hljs-comment"># /index/index/xxxxxx.html 不包含参数</span><br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># input</span><br><span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&quot;id&quot;</span>) <span class="hljs-comment"># 从param()中取值  默认是get的</span><br><span class="hljs-variable">$request</span>-&gt;get(<span class="hljs-string">&quot;id&quot;</span>)<br><span class="hljs-comment"># --------------------</span><br><span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&quot;post.id&quot;</span>) <span class="hljs-comment"># 取出post中的id</span><br><span class="hljs-variable">$request</span>-&gt;post(<span class="hljs-string">&quot;id&quot;</span>)<br><span class="hljs-comment"># ---------------------</span><br><span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&quot;不存在&quot;</span>) <span class="hljs-comment"># NULL</span><br><span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&quot;不存在&quot;</span>,<span class="hljs-string">&#x27;default&#x27;</span>);<br><span class="hljs-variable">$request</span>-&gt;input(xxx,<span class="hljs-number">100</span>,<span class="hljs-string">&#x27;intval&#x27;</span>); <span class="hljs-comment"># &quot;trim&quot;  过滤空格</span><br><span class="hljs-comment"># 若xxx存在，即为原来格式 不存在 会将xxx换为 int ，转换失败则为默认值为0</span><br><span class="hljs-comment"># -----------------------------</span><br><span class="hljs-variable">$request</span>-&gt;input(<span class="hljs-string">&quot;session.xxxx&quot;</span>); <span class="hljs-comment"># 获取session的值</span><br><span class="hljs-comment"># ----------------------------</span><br><span class="hljs-comment"># 还可以获取put，path，file，delete,patch等</span><br></code></pre></td></tr></table></figure></li><li><p>响应对象Response</p><ol><li><p>```php<br>$res = xxxxx<br>Config::set(‘default_return_type’,’xml’);<br>return $res; # 经过改变格式的res可直接返回，若res为对象不能直返回</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><br>## <span class="hljs-number">4</span>，视图和模板<br><br><span class="hljs-number">1.</span> 视图<span class="hljs-keyword">view</span><br><br>   <span class="hljs-number">1.</span> ```php<br>      # 默认 app/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">view</span>/<span class="hljs-keyword">index</span>(控制器名)/<span class="hljs-keyword">index</span>.html<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>()<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>(&quot;upload&quot;) # app/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">view</span>/<span class="hljs-keyword">index</span>/upload.html<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>(&quot;public/upload&quot;) # app/<span class="hljs-keyword">index</span>/<span class="hljs-keyword">view</span>/<span class="hljs-built_in">public</span>/upload.html<br>      # &quot;./&quot;表示<span class="hljs-built_in">public</span><br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>(&quot;./upload.html&quot;) # /<span class="hljs-built_in">public</span>/upload.html<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">view</span>(&quot;./html/upload.html&quot;) #/<span class="hljs-built_in">public</span>/html/upload.html<br></code></pre></td></tr></table></figure></li><li><p>```php<br>return view(“index”,[</p><div class="code-wrapper"><pre><code class="hljs">&#39;email&#39;    =&gt; &#39;1028968939@qq.com&#39;,  # 在html中 &#123;$email&#125;获取&#39;user&#39;    =&gt;    &#39;Dean&#39;,</code></pre></div><p>],[</p><div class="code-wrapper"><pre><code class="hljs">&#39;STATIC&#39;    =&gt;    &#39;当前是static的替换内容&#39;, # html中 STATIC 直接会替换</code></pre></div><p>])</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><br><span class="hljs-number">3</span>. ```php<br>   <span class="hljs-keyword">use</span> <span class="hljs-title">think</span>\<span class="hljs-title">Controller</span>;<br>   <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span></span>&#123;<br>       <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span>(<span class="hljs-params"></span>)</span>&#123;<br>           <span class="hljs-comment"># fetch 中第二个参数，第三个参数与view相同，html获取方也相同</span><br>           <span class="hljs-keyword">$this</span>-&gt;assign(<span class="hljs-string">&quot;xx&quot;</span>,<span class="hljs-string">&quot;yy&quot;</span>); <span class="hljs-comment"># 也可传值</span><br>           <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;fetch(<span class="hljs-string">&#x27;upload&#x27;</span>);<span class="hljs-comment"># /app/index/view/index/upload.html</span><br>           <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;display(<span class="hljs-string">&quot;xx&#123;email&#125;xxx&quot;</span>,[<br>               <span class="hljs-string">&#x27;email&#x27;</span>=&gt;<span class="hljs-string">&#x27;zzz&#x27;</span><br>           ]); <span class="hljs-comment"># 不使用模板，直接显示字符串，不建议</span><br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>模板变量输出，替换，赋值</p><ol><li><p>```php<br>use think\Controller;<br>class Index extends Controller{</p><div class="code-wrapper"><pre><code class="hljs">public function index()&#123;    return $this-&gt;fetch(&#39;index&#39;,[        &#39;email&#39;    =&gt;    &#39;xxx&#39;,    ]);&#125;</code></pre></div><p>}</p><h1 id="email-—-gt"><a href="#email-—-gt" class="headerlink" title="{$email}  —&gt; "></a>{$email}  —&gt; <?php echo $email;?></h1><h1 id="“-”-可在配置文件中修改template，避免与前端框架冲突"><a href="#“-”-可在配置文件中修改template，避免与前端框架冲突" class="headerlink" title="“{}” 可在配置文件中修改template，避免与前端框架冲突"></a>“{}” 可在配置文件中修改template，避免与前端框架冲突</h1><h1 id="email-有空格php-不识别"><a href="#email-有空格php-不识别" class="headerlink" title="{ $email } 有空格php 不识别"></a>{ $email } 有空格php 不识别</h1><p>$this-&gt;view-&gt;key = ‘value’; # 也可传值， 获取方式与上边相同<br>View::share(‘key’,’value’); # 也可以</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><br><span class="hljs-number">2</span>. ```php<br>   <span class="hljs-meta"># 配置文件中</span><br>   &#x27;view_replace_str&#x27;=&gt;[<br>       &#x27;xxx&#x27;=&gt;&#x27;yyy&#x27;,<br>   ]<br>   <span class="hljs-meta"># 在html中所有xxx都会替换为yyy</span><br>   <span class="hljs-meta"># 默认的替换</span><br>      <span class="hljs-meta"># __URL__  /当前模块名、控制器名</span><br>      <span class="hljs-meta"># __STSTIC__ /static   /public下边的static 用来代替静态文件地址</span><br>      <span class="hljs-meta"># __JS__ /static/js</span><br>      <span class="hljs-meta"># __CSS__ /static/css</span><br>      <span class="hljs-meta"># __ROOT__ </span><br></code></pre></td></tr></table></figure></li><li><p>模板中使用系统变量，原生标签</p><ol><li><p>```php<br>use think\Controller;<br>class Index extends Controller{</p><div class="code-wrapper"><pre><code class="hljs">public function index()&#123;    $_SERVER; # 系统变量    return $this-&gt;fetch(&#39;index&#39;);&#125;</code></pre></div><p>}</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">```html</span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.server.HTTP_POST&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 系统变量--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.env.PHP_STATUS&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 环境变量--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.session.email&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- session--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.cookie.email&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- cookie--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.get.id&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- get--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.post.id&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- post--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.request.id&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- request--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.const.APP_PATH&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 常量--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$Think.APP_PATH&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 常量--&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>```html</p><!-- 在html中使用php  不建议使用--><?php    echo xxx;?><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xl"><br><span class="hljs-number">4</span>. 模板变量<br><br>   <span class="hljs-number">1</span>. ```php<br>      $<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>assgin(<span class="hljs-string">&quot;email&quot;</span>,<span class="hljs-string">&#x27;xxx&#x27;</span>);<br>      $<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>assgin(<span class="hljs-string">&quot;time&quot;</span>,<span class="hljs-built_in">time</span>());<br>      $<span class="hljs-function"><span class="hljs-title">this</span>-&gt;</span>assgin(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&#x27;dean&#x27;</span>);<br></code></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$email|md5&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-comment">&lt;!-- 加密变量--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$email|substr=0,8&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-comment">&lt;!-- 字符串截取--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$time|date=&quot;Y-m-d&quot;,###&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-comment">&lt;!-- 时间格式化, ### 是占位符--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$email|md5|strtoupper&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$a+$b&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-comment">&lt;!-- 支持数字的加减乘除--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>&#123;$email|default=&quot;xxxx&quot;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><span class="hljs-comment">&lt;!--控制器未定义显示默认值--&gt;</span><br>&#123;literal&#125;&#123;$email&#125;&#123;/literal&#125; <span class="hljs-comment">&lt;!--不进行编译--&gt;</span><br>&#123;/* php模板的注释 */&#125;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>循环标签</p><ol><li><p>```php<br>$list = [</p><div class="code-wrapper"><pre><code class="hljs">&#39;user1&#39;    =&gt;[&#39;name&#39;    =&gt;    &#39;a&#39;],&#39;user2&#39;    =&gt;[&#39;name&#39;    =&gt;    &#39;b&#39;],&#39;user3&#39;    =&gt;[&#39;name&#39;    =&gt;    &#39;c&#39;],</code></pre></div><p>]</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">```html</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;volist name=&quot;list&quot; id=&quot;vo&quot; offset=&quot;2&quot; length=&quot;1&quot; mod=&quot;3&quot; empty=&quot;xxx&quot; key=&quot;i&quot;&#125;</span><span class="xml"> <span class="hljs-comment">&lt;!--从第三个开始,遍历1次,若list为空，显示empty的值，empty不接受html标签，但接受控制器变量--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$mod&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 0 ,1，2 间隔输出--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$i&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!-- 内置变量从1开始, 有上边key控制，可修改--&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$vo.name&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>  <span class="hljs-comment">&lt;!-- 输出abc三个--&gt;</span></span><br><span class="xml"></span><span class="hljs-template-tag">&#123;/<span class="hljs-name">volist</span>&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>```html<br>{foreach $list as vo}</p><div class="code-wrapper"><pre><code class="hljs">&lt;p&gt;&#123;$vo.name&#125;&lt;/p&gt;</code></pre></div><p>{/foreach}<br>{foreach name=”list” item=”vo” key=”key”}</p><div class="code-wrapper"><pre><code class="hljs">&lt;p&gt;&#123;$key&#125;&lt;/p&gt; &lt;!--获取键,默认是key，通过key修改--&gt;&lt;p&gt;&#123;$vo.name&#125;&lt;/p&gt;</code></pre></div><p>{/foreach}</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">3. ```html</span><br><span class="xml">   </span><span class="hljs-template-variable">&#123;for start=&quot;1&quot; end=&quot;10&quot; step=&quot;2&quot; name=&quot;i&quot;&#125;</span><span class="xml"></span><br><span class="xml">   <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span></span><span class="hljs-template-variable">&#123;$i&#125;</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <span class="hljs-comment">&lt;!--通过name控制--&gt;</span></span><br><span class="xml">   </span><span class="hljs-template-tag">&#123;/<span class="hljs-name">for</span>&#125;</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>比较标签</p><ol><li><p>```html<br>{eq name=”a” value=”10”} <!-- a 是变量 不用$ ,value中使用变量时加$--></p><div class="code-wrapper"><pre><code class="hljs">&lt;p&gt;&lt;/p&gt;</code></pre></div><p>{else}</p><div class="code-wrapper"><pre><code class="hljs">&lt;p&gt;&lt;/p&gt;</code></pre></div><p>{/eq}</p><!--下边用法相同--><p>{neq}<br>{equal}={eq}<br>{notequal}={neq}<br>{gt} <!--大于--><br>{lt} <!--大于--><br>{egt} <!--大于等于--><br>{elt} <!--小于等于--></p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xquery"><br><span class="hljs-number">7</span>. 条件标签<br><br>   <span class="hljs-number">1</span>. ```html<br>      &#123;<span class="hljs-keyword">switch</span><span class="hljs-built_in"> name</span> = <span class="hljs-string">&quot;Think.get.level&quot;</span>&#125;<br>      &#123;<span class="hljs-keyword">case</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">&quot;1&quot;</span>&#125;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>普通会员<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>      &#123;<span class="hljs-keyword">case</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">&quot;2&quot;</span>&#125;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>vip会员<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>      &#123;<span class="hljs-keyword">case</span> <span class="hljs-keyword">value</span>=<span class="hljs-string">&quot;3|4|5&quot;</span>&#125;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>svip会员<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>      &#123;<span class="hljs-keyword">default</span> /&#125;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>游客<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br>      &#123;/<span class="hljs-keyword">switch</span>&#125;<br></code></pre></td></tr></table></figure></li><li><p>```html<br>{range name=”Think.get.level” value=”1,2,3,4” type=”in|或者是notin|between|notbetween”}</p><div class="code-wrapper"><pre><code class="hljs">&lt;!--level 在value中--&gt;</code></pre></div><p>{else /}</p><div class="code-wrapper"><pre><code class="hljs">&lt;!--level 不在value中--&gt;</code></pre></div><p>{/range}</p><!--type为between时value前2个有效，包含开头结尾--><!--效果与上边相同--><p>{in name=”Think.get.level” value=”1,2,3”}<br>{else/}<br>{/in}<br>{notin},{bwtween},{notbwtween}<br>{define name=”APP_PATH”} <!--变量是否定义--><br>{if condition=”($Think.get.level==1) AND () OR()”}<br>{else/}<br>{/if}</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">8. 模板的包含和继承</span><br><span class="xml"></span><br><span class="xml">   1. ```html</span><br><span class="xml">      <span class="hljs-comment">&lt;!--nav.html--&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span></span><br><span class="xml">          <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span><br><span class="xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span><br><span class="xml">      </span><br><span class="xml">      <span class="hljs-comment">&lt;!--其他地方使用--&gt;</span></span><br><span class="xml">      </span><span class="hljs-template-variable">&#123;include file=&quot;xxxxx/nav&quot; /&#125;</span><br></code></pre></td></tr></table></figure></li><li><p>```html</p><!--base.html--><!DOCTYPE html><html><head>    <title>{block name="title"}模板{/block}</title></head><body>    {block name="body"}内容{/block}</body></html><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"></span><br><span class="xml">```html</span><br><span class="xml"></span><span class="hljs-template-variable">&#123;extend file=&quot;xxxx/base&quot; /&#125;</span><span class="xml"></span><br><span class="xml"></span><span class="hljs-template-variable">&#123;block name=&quot;title&quot;&#125;</span><span class="xml">新的页面标题</span><span class="hljs-template-variable">&#123;__block__&#125;</span><span class="hljs-template-tag">&#123;/<span class="hljs-name">block</span>&#125;</span><span class="xml"></span><br><span class="xml"><span class="hljs-comment">&lt;!--可以获取被继承的模板中的原内容--&gt;</span></span><br></code></pre></td></tr></table></figure><ol><li><p>conf/config.php  在template 中添加 </p><ol><li>‘layout_on’ =&gt;    true </li><li>‘layout_name’  =&gt; ‘layout’</li></ol></li><li><p>开启后默认找的文件变为 /app/index/view/layout.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html">xxx<br>&#123;__CONTENT__&#125;  <br>xxx<br><span class="hljs-comment">&lt;!-- 只能有一个坑，因此其他需要修改的地方 通过参数传入即可--&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>此时原来/app/index/view/index/index.html 中内容随机</p></li><li><p>访问对应页面时替换地方的内容就会被替换，</p></li><li><p>前台一般使用继承，后态layout加继承</p></li></ol></li></ol></li></ol></li></ol><h2 id="5，扩展内容"><a href="#5，扩展内容" class="headerlink" title="5，扩展内容"></a>5，扩展内容</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/tensorflow%EF%BC%8Ckeras%EF%BC%8Ccuda%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/"/>
    <url>/2022/01/16/cnblog/tensorflow%EF%BC%8Ckeras%EF%BC%8Ccuda%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img2020.cnblogs.com/blog/1333782/202004/1333782-20200421123108356-9953470.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2020.cnblogs.com/blog/1333782/202004/1333782-20200421123244337-2087103820.png" alt="" /></p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/tensorflow%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84/"/>
    <url>/2022/01/16/cnblog/tensorflow%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[<h1 class="md-end-block md-heading"><span class="md-plain">自定义网络层</span></h1><p class="md-end-block md-p"><span class="md-plain">自定义层需要继承tf.keras.layers.Layer类，重写init,build,call</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span>_<span>_<span class="md-plain">init<span>_<span>_<span class="md-plain">,执行与输入无关的初始化</span></span></span></span></span></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">build，了解输入张量的形状，定义需要什么输入</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">call，进行正向计算</span></p></li></ul><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-keyword">class <span class="cm-def">MyDense(<span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">layers.<span class="cm-property">Layer):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">__init__(<span class="cm-variable-2">self,<span class="cm-variable">units): <span class="cm-comment"># units 神经元个数<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super().<span class="cm-property">__init__() <span class="cm-comment"># 必须写<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">units = <span class="cm-variable">units<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">build(<span class="cm-variable-2">self,<span class="cm-variable">input_shape):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">w = <span class="cm-variable-2">self.<span class="cm-property">add_variable(<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">name=<span class="cm-string">"w",<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">shape=[<span class="cm-variable">input_shape[<span class="cm-operator">-<span class="cm-number">1],<span class="cm-variable-2">self.<span class="cm-property">units],<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">initializer = <span class="cm-variable">tf.<span class="cm-property">initializers.<span class="cm-property">RandomNormal()<br /><span> &nbsp; &nbsp; &nbsp;  )<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">b = <span class="cm-variable-2">self.<span class="cm-property">add_variable(<span class="cm-variable">name=<span class="cm-string">"b",<span class="cm-variable">shape=[<span class="cm-variable-2">self.<span class="cm-property">units],<span class="cm-variable">initializer = <span class="cm-variable">tf.<span class="cm-property">initializers.<span class="cm-property">Zeros()) <span class="cm-comment"># b一般是全0<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">call(<span class="cm-variable-2">self,<span class="cm-builtin">input):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># wx+b<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-builtin">input <span class="cm-operator">@ <span class="cm-variable-2">self.<span class="cm-property">w <span class="cm-operator">+ <span class="cm-variable-2">self.<span class="cm-property">b<br /><span> &nbsp;  <span class="cm-tab">    <span class="cm-keyword">return <span class="cm-variable">tf.<span class="cm-property">nn.<span class="cm-property">relu(<span class="cm-builtin">input <span class="cm-operator">@ <span class="cm-variable-2">self.<span class="cm-property">w <span class="cm-operator">+ <span class="cm-variable-2">self.<span class="cm-property">b)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">自定义模型类</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-keyword">class <span class="cm-def">MyModel(<span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">Model):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">__init__(<span class="cm-variable-2">self):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">super().<span class="cm-property">__init__()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc1 = <span class="cm-variable">MyDense(<span class="cm-number">512)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc2 = <span class="cm-variable">MyDense(<span class="cm-number">256)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc3 = <span class="cm-variable">MyDense(<span class="cm-number">128)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc4 = <span class="cm-variable">MyDense(<span class="cm-number">10)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">def <span class="cm-def">call(<span class="cm-variable-2">self,<span class="cm-builtin">input):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc1.<span class="cm-property">out = <span class="cm-variable-2">self.<span class="cm-property">fc1(<span class="cm-builtin">input)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc2.<span class="cm-property">out = <span class="cm-variable-2">self.<span class="cm-property">fc2(<span class="cm-variable-2">self.<span class="cm-property">fc1.<span class="cm-property">out)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc3.<span class="cm-property">out = <span class="cm-variable-2">self.<span class="cm-property">fc3(<span class="cm-variable-2">self.<span class="cm-property">fc2.<span class="cm-property">out)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable-2">self.<span class="cm-property">fc4.<span class="cm-property">out = <span class="cm-variable-2">self.<span class="cm-property">fc4(<span class="cm-variable-2">self.<span class="cm-property">fc3.<span class="cm-property">out)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable-2">self.<span class="cm-property">fc4.<span class="cm-property">out<br /><span><span class="cm-variable">myModel = <span class="cm-variable">MyModel()<br /><span><span class="cm-variable">myModel.<span class="cm-property">build(<span class="cm-variable">input_shape=(<span class="cm-keyword">None,<span class="cm-number">784))<br /><span><span class="cm-variable">myModel.<span class="cm-property">summary()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h6 class="md-end-block md-heading"><span class="md-plain">注：</span></h6><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 模型保存<br /><span><span class="cm-comment"># 1，保存模型<br /><span><span class="cm-comment"># model.save("xxx.h5")<br /><span><span class="cm-comment"># tensorflow.keras.models.load_model("xxxx.h5")<br /><span><span>​<br /><span><span class="cm-comment"># 2，保存权重参数<br /><span><span class="cm-comment"># model.save_weights("xxxx.ckpt")<br /><span><span class="cm-comment"># model.load_weights("xxxx.ckpt")<br /><span><span>​<br /><span><span class="cm-comment"># 3，save_model 此时保存的模型具有平台无关性,移植性好 1.15及之后版本<br /><span><span class="cm-comment"># tensorflow.keras.models.save_model(model,"foldername")  生成文件夹，里面有pb文件<br /><span><span class="cm-comment"># tensorflow.keras.models.load_model(&ldquo;foldername&rdquo;) <br /><span class="cm-tab-wrap-hack"><span class="cm-comment">#<span class="cm-tab">   此时只导入的只有model结构与weight参数  model.compile还需要自己写</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p><span class="cm-tab-wrap-hack"><span class="cm-comment">&nbsp;</span></span></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Tensorflow%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F/"/>
    <url>/2022/01/16/cnblog/Tensorflow%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>1,通过设置环境变量”TF_CPP_MIN_LOG_LEVEL”控制log级别</p><p>Level    Level for Humans    Level Description<br>0    DEBUG    all messages are logged (Default)<br>1    INFO    INFO messages are not printed<br>2    WARNING    INFO and WARNING messages are not printed<br>3    ERROR    INFO, WARNING, and ERROR messages are not printed</p><p>永久设置:加入环境变量TF_CPP_MIN_LOG_LEVEL=1</p><p>临时设置:os.environ[‘TF_CPP_MIN_LOG_LEVEL’]=’1’</p><p>2.通过 tf.logging 模块进行设置 – 推荐</p><p>tf.logging.set_verbosity(tf.logging.ERROR)</p><p>tf.logging.ERROR可以换成 {DEBUG, INFO, WARN, ERROR, FATAL} 中的任何一个。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Tensorflow2.0/"/>
    <url>/2022/01/16/cnblog/Tensorflow2.0/</url>
    
    <content type="html"><![CDATA[<p>Tensorflow2.0</p><ol><li><h1 id="Tensorflow-简介"><a href="#Tensorflow-简介" class="headerlink" title="Tensorflow 简介"></a>Tensorflow 简介</h1><ol><li><h3 id="Tensorflow是什么"><a href="#Tensorflow是什么" class="headerlink" title="Tensorflow是什么"></a>Tensorflow是什么</h3><ol><li><h4 id="Google开源软件库"><a href="#Google开源软件库" class="headerlink" title="Google开源软件库"></a>Google开源软件库</h4><ol><li>采用数据流图,用于数值计算</li><li>支持多平台 GPU CPU 移动设备</li><li>最初用于深度学习,变得通用</li></ol></li><li><h4 id="数据流图"><a href="#数据流图" class="headerlink" title="数据流图"></a>数据流图</h4><ol><li>节点—处理数据</li><li>线—节点之间的输入输出关系</li><li>线上运输张量</li><li>节点被分配到各种计算设备上运行</li></ol></li><li><h4 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h4><ol><li>高度的灵活性</li><li>真正的可移植性</li><li>产品与科研结合</li><li>自动求微分</li><li>多语言支持</li><li>性能最优化</li></ol></li></ol></li><li><h3 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h3><ol><li><h4 id="历史版本"><a href="#历史版本" class="headerlink" title="历史版本"></a>历史版本</h4><ol><li>2015年11月:首次发布</li><li>2015年12月:支持GPU python3.3(v0.6)</li><li>2016年4月:分布式tensorflow(v0.8)</li><li>2016年11月:支持windows(v0.11)</li><li>2017年2月:性能改进,API稳定性(v1.0)</li><li>2017年4月:Keras集成(v1.1)</li><li>2017年8月:高级API,预算估计器,更多模型,初始TPU支持(v1.3)</li><li>2017年11月:Eager execution和Tensorflow Lite(v1.5)</li><li>2018年3月:TF hub(与训练的库),Tensorflow.js Tensorflow Extended(TFX)</li><li>2018年5月:新入门内容 Cloud TPU模块与管道(v1.6)</li><li>2018年6月:新的分布式策略API:概率编程工具,Tensorflow Probability(v1.8)</li><li>2018年8月:Cloud Big Table 集成(v1.10)</li><li>2018年10月:侧重可用性的API改进(v1.12)</li><li>2019年:tensorflow2.0</li></ol></li><li><h4 id="Tensorflow1-0————–主要特性"><a href="#Tensorflow1-0————–主要特性" class="headerlink" title="Tensorflow1.0————–主要特性"></a>Tensorflow1.0————–主要特性</h4><ol><li>XLA:Accelerate Linear Algebra<ol><li>提升速度58倍</li><li>可以在移动设备运行</li></ol></li><li>引入更高级的API——-tf.layers/tf.metrics/tf.losses/tf.keras</li><li>Tensorflow 调试器</li><li>支持docker,引入tensorflow serving服务</li></ol></li><li><h4 id="Tensorflow1-0———————架构"><a href="#Tensorflow1-0———————架构" class="headerlink" title="Tensorflow1.0———————架构"></a>Tensorflow1.0———————架构</h4><p>Kears,Estimator,Datasets,Layers,Distribution engine</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223172955331-1983219976.png"></p></li></ol></li></ol></li></ol><div class="code-wrapper"><pre><code class="hljs">  4. #### Tensorflow2.0----------------------主要特性     1. 使用tf.keras和eager mode进行更加简单的模型构建     2. 鲁棒的跨平台部署     3. 强大的研究实验     4. 清除了不推荐使用的API和减少了重复来简化PI  5. #### Tensorflow2.0------------------------架构     ![](https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173009368-1172955030.png)  6. #### Tensorflow2.0--------简化的模型开发流程     1. 使用tf.data加载数据     2. 使用tf.keras构建模型,也可以使用premade estimator来验证模型        1. 使用tensorflow hub 进行迁移学习     3. 使用eager mode 进行运行和调试     4. 使用分发策略进行分布式训练     5. 导出到SavedModel     6. 使用Tensorflow Serve,Tensorflow  Lite,Tensorflow.js部署模型  7. #### Tensorflow2.0-----------强大的跨平台能力     1. Tensorflow服务        1. 直接通过Http/REST或GRPC/协议缓冲区     2. Tensorflow Lite----------可部署在Android ios和其他嵌入式设备     3. Tensorflow.js------可在javascript中部署模型     4. 其他语言        1. c,java,go,c#等  8. #### Tensorflow2.0------------强大的研究实现     1. keras功能和子类API,允许创建一些复杂的拓扑结构     2. 自定义训练逻辑,使用tf.GradientTape和tf.custom_gradient进行更细力度的控制     3. 低层API自始至终可以与高层结合使用,完全的可定制     4. 高级扩展:Ragged Tensors,Tensor2Tensor等</code></pre></div><ol start="3"><li><h3 id="Tensorflow-vs-Pytorch"><a href="#Tensorflow-vs-Pytorch" class="headerlink" title="Tensorflow vs Pytorch"></a>Tensorflow vs Pytorch</h3><ol><li><h4 id="入门时间"><a href="#入门时间" class="headerlink" title="入门时间"></a>入门时间</h4><ol><li><p>Tensorflow 1.*</p><ol><li>静态图</li><li>学习额外概念<ol><li>图,会话,变量,占位符等</li></ol></li><li>写样板代码</li></ol></li><li><p>Tensorflow 2.*</p><ol><li>动态图</li><li>Eager mode避免1.0缺点,直接集成在python中</li></ol></li><li><p>Pytorch</p><ol><li>动态图</li><li>Numpy的扩展,直接集成在python中</li></ol></li><li><p>静态图效率高,动态图容易调试</p></li><li><p>代码示例 1+$\frac{1}{2}$+ $\frac{1}{2^2}$+…..+$\frac{1}{2^{50}}$</p><ol><li><p>```python</p><h1 id="python"><a href="#python" class="headerlink" title="python"></a>python</h1><p>x = 0<br>y = 1<br>for iteration in range(50):</p><div class="code-wrapper"><pre><code class="hljs">x = x + yy = y / 2</code></pre></div><p>print(x)</p><figure class="highlight llvm"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><pre><code class="hljs llvm"><br><span class="hljs-number">2</span>. ```python<br>   # Pytorch<br>   import torch<br>   <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> tf.<span class="hljs-keyword">constant</span>(<span class="hljs-number">0</span>.)<br>   y <span class="hljs-operator">=</span> tf.<span class="hljs-keyword">constant</span>(<span class="hljs-number">1</span>.)<br>   for iteration in range(<span class="hljs-number">50</span>):<br>       <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> + y<br>       y <span class="hljs-operator">=</span> y / <span class="hljs-number">2</span><br>   print(<span class="hljs-keyword">x</span>)<br></code></pre></td></tr></table></figure></li><li><p>```python</p><h1 id="tensorflow1"><a href="#tensorflow1" class="headerlink" title="tensorflow1.*"></a>tensorflow1.*</h1><p>import tensorflow as tf<br>x = tf.constant(0.)<br>y = tf.constant(1.)<br>add_op = x.assgin(x+y)<br>div_op = y.assgin(y/2)<br>with tf.Session() as sess:</p><div class="code-wrapper"><pre><code class="hljs">sess.run(tf.golbal_variables_initializers())for iteration in range(50):    sess.run(add_op)    sess.run(dic_op) print(x.eval()) # sess.eval(x)</code></pre></div><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vim"><br><span class="hljs-number">4</span>. ```<span class="hljs-keyword">python</span><br>   # tensorflow2.*<br>   import tensorflow <span class="hljs-keyword">as</span> <span class="hljs-keyword">tf</span><br>   <span class="hljs-keyword">x</span> = <span class="hljs-keyword">tf</span>.constant(<span class="hljs-number">0</span>.)<br>   <span class="hljs-keyword">y</span> = <span class="hljs-keyword">tf</span>.constant(<span class="hljs-number">1</span>.)<br>   <span class="hljs-keyword">for</span> iteration in <span class="hljs-built_in">range</span>(<span class="hljs-number">50</span>)<br>   <span class="hljs-keyword">x</span> = <span class="hljs-keyword">x</span> + <span class="hljs-keyword">y</span><br>       <span class="hljs-keyword">y</span> = <span class="hljs-keyword">y</span> / <span class="hljs-number">2</span><br>   <span class="hljs-keyword">print</span>(<span class="hljs-keyword">x</span>.numpy())<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><h4 id="图创建和调试"><a href="#图创建和调试" class="headerlink" title="图创建和调试"></a>图创建和调试</h4><ol><li>Tensorflow 1.*<ol><li>静态图,难以调试,学习tfdbg调试</li></ol></li><li>Tensorflow 2.*与pytorch<ol><li>动态图,python自带的调试工具</li></ol></li></ol></li><li><h4 id="全面性"><a href="#全面性" class="headerlink" title="全面性"></a>全面性</h4><ol><li>Pythorch缺少<ol><li>沿维翻转张量(np.flip,np.flipud,np.fliplr)</li><li>检查无穷与非数值张量(np.is_nan,np.is_inf)</li><li>快速傅里叶变换(np.fft)</li></ol></li><li>随着时间变化,越来越接近</li></ol></li><li><h4 id="序列化和部署"><a href="#序列化和部署" class="headerlink" title="序列化和部署"></a>序列化和部署</h4><ol><li> Tensorflow支持更加广泛</li><li>图保存为protocol buffer</li><li>跨语言</li><li>跨平台</li><li>Pytorch支持比较简单</li></ol></li></ol></li><li><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><ol><li><p>本地配置</p><ol><li>Virtualenv 安装或anaconda3</li><li>GPU环境配置</li></ol></li><li><p>云端配置</p><ol><li><p>为什么在云端配置</p><ol><li>规格统一,节省自己的机器</li><li>有直接配置好的镜像</li></ol></li><li><p>云环境</p><ol><li><p>Google Cloud,Amazon</p></li><li><p>实战</p><ol><li><p>从0配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">            # ubuntu 18.04<br>            sudo apt-get install python3 # 安装python3<br>            sudo apt-get install python # 安装python3<br>            sudo apt-get install software-properties-common<br>            sudo apt-add-repository universe  # 奖pip所在源加入ubuntu<br>            sudo apt-get update<br>            sudo apt-get install python-pip<br>            sudo apt-get install python3-pip<br>            sudo pip3 install -U virtualenv # 或使用anaconda3<br>            # 创建虚拟环境<br>            mkdir environment &amp;&amp; cd environment<br>            virtualenv --system-site-packages -p python3 ./tf_py3<br>            source tf_py3/bin/activate # 激活环境<br>            pip install tensorflow<br>            # pip install tensorflow==2.0.0<br>            pip install numpy pandas matplotlib sklearn jupyter<br>            # 配置jupyter<br>            # 修改为静态ip配置,端口<br>            jupyter notebook --generate-config # 家目录生成配置文件 .jupyter<br>            c = get_config()<br>            c.NotebookApp.ip = &quot;*&quot;<br>            c.NotebookAPP.open_borwser = False<br>            c.NotebookAPP.post = 6006<br>            c.NotebookApp.allow_remote_access = True<br>            # 可使用token设置密码 供以后使用<br>            deactivate # 退出环境<br>            <br>            <br>            # 配置gpu环境<br>            # https://tensorflow.google.cn/install/gpu<br>            # 找到ubuntu18.04 复制为安装脚本执行即可<br>            # 可能会出现版本号不对应错误 libnvinfer-dev 将脚本中最后一条命令修改后运行libnvinfer-dev-5.1.5-1+cuda10.1 即可成功<br>            nvidia-smi # 查看GPU信息<br>            # tensorflow-gpu安装与cpu版类似<br>tf.test.is_gpu_available() # 判断gpu可用与否<br></code></pre></td></tr></table></figure></li><li><p>从镜像配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 云端的系统镜像直接有开发环境</span><br><span class="hljs-meta">#</span><span class="bash"> 升级tensorflow 版本</span><br>pip install --upgrade tensorflow-gpu==2.0.0<br>pip3 install --upgrade tensorflow-gpu==2.0.0<br></code></pre></td></tr></table></figure></li></ol></li></ol></li></ol></li></ol></li><li><h1 id="Tensorflow-keras-实战"><a href="#Tensorflow-keras-实战" class="headerlink" title="Tensorflow keras 实战"></a>Tensorflow keras 实战</h1><ol><li><h3 id="keras是什么"><a href="#keras是什么" class="headerlink" title="keras是什么"></a>keras是什么</h3><ol><li>基于python的高级神经网络API</li><li>Francois Chollet2014-2015编写</li><li>以Tensorflow CNTK,或Theano为后端运行,keras必须有后端才可以<ol><li>后端可以切换,现在多用tensorflow</li></ol></li><li>及方便用于快速试验</li></ol></li><li><h3 id="tf-keras是什么"><a href="#tf-keras是什么" class="headerlink" title="tf.keras是什么"></a>tf.keras是什么</h3><ol><li>Tensorflow 对kerasAPI规范的实现</li><li>相对于tensorflow为后端的keras,Tensorflow-keras与tensorflow结合更紧密</li><li>实现在tf.keras下</li></ol></li><li><h3 id="Tf-keras与keras的"><a href="#Tf-keras与keras的" class="headerlink" title="Tf-keras与keras的"></a>Tf-keras与keras的</h3><ol><li><h4 id="联系"><a href="#联系" class="headerlink" title="联系"></a>联系</h4><ol><li>基于同一套API<ol><li>keras程序可转化为tf.keras</li><li>反之可能不成立,tf.keras有其它特性</li></ol></li><li>相同的JSON与hdf5模型序列化格式和语义</li></ol></li><li><h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><ol><li>Tf.keras全面支持eager mode<ol><li>只使用keras.Sequential和keras.Model时没影响</li><li>自定义Model内部运算逻辑时会有影响<ol><li>T低层API可以使用keras的model.fit等抽象法</li><li>适用于研究人员</li></ol></li></ol></li><li>Tf.keras支持基于tf.data的模型训练</li><li>Tf.keras支持TPU训练</li><li>Tf.keras支持tf.distribution中的分布式策略</li><li>其他特性<ol><li>Tf.keras可以与Tensorflow中的estimator集成</li><li>Tf.keras可以保存为SavedModel</li></ol></li></ol></li></ol></li><li><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><ol><li><h4 id="分类问题与回归问题"><a href="#分类问题与回归问题" class="headerlink" title="分类问题与回归问题"></a>分类问题与回归问题</h4><ol><li>分类问题:输出类型是概率分布</li><li>回归问题:输出是一个是数值</li></ol></li><li><h4 id="目标函数"><a href="#目标函数" class="headerlink" title="目标函数"></a>目标函数</h4><ol><li><p>参数逐步调整</p></li><li><p>目标函数帮助衡量模型好坏</p></li><li><p>分类问题</p><ol><li><p>要衡量目标类别与当前预测的差距</p><ol><li>三分类问题输出:[0.2,0.7,0.1]</li><li>真是类别:2-&gt;ont_hot-&gt;[0,0,1]</li></ol></li><li><p>One_hot编码,把正整数变为向量表达</p><ol><li>生成一个长度不小于正整数的向量,只有正整数的位置处为1,其余位置都为0</li></ol></li><li><p>平方差损失<br>$$<br>\frac{1}{n} \sum_{x,y}\frac{1}{2}(y-Model(x))^2<br>$$</p></li><li><p>交叉熵损失<br>$$<br>\frac{1}{n}\sum_{x,y}yln(Model(x))<br>$$</p></li></ol></li><li><p>回归问题</p><ol><li>预测值与真实值的差距</li><li>平方差损失</li><li>绝对值损失</li></ol></li></ol></li></ol></li><li><h3 id="Tf框架-keras-回调函数"><a href="#Tf框架-keras-回调函数" class="headerlink" title="Tf框架:keras,回调函数"></a>Tf框架:keras,回调函数</h3><ol><li><h3 id="keras搭建模型"><a href="#keras搭建模型" class="headerlink" title="keras搭建模型"></a>keras搭建模型</h3><ol><li>```python<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="coding:utf-8"></a>coding:utf-8</h1><h1 id="file-tf-keras-classification-model-py"><a href="#file-tf-keras-classification-model-py" class="headerlink" title="file: tf_keras_classification_model.py"></a>file: tf_keras_classification_model.py</h1><h1 id="author-Dean"><a href="#author-Dean" class="headerlink" title="author: Dean"></a>author: Dean</h1><h1 id="contact-x31-x30-x32-x38-57-54-56-57-51-57-x40-113-x71-x2e-99-x6f-109"><a href="#contact-x31-x30-x32-x38-57-54-56-57-51-57-x40-113-x71-x2e-99-x6f-109" class="headerlink" title="contact: &#x31;&#x30;&#x32;&#x38;&#57;&#54;&#56;&#57;&#51;&#57;&#x40;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;"></a>contact: <a href="mailto:&#x31;&#x30;&#x32;&#x38;&#57;&#54;&#56;&#57;&#51;&#57;&#x40;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;">&#x31;&#x30;&#x32;&#x38;&#57;&#54;&#56;&#57;&#51;&#57;&#x40;&#113;&#x71;&#x2e;&#99;&#x6f;&#109;</a></h1><h1 id="time-2019-12-17-11-47"><a href="#time-2019-12-17-11-47" class="headerlink" title="time: 2019/12/17 11:47"></a>time: 2019/12/17 11:47</h1><h1 id="desc-keras模型搭建"><a href="#desc-keras模型搭建" class="headerlink" title="desc: keras模型搭建"></a>desc: keras模型搭建</h1>import matplotlib as mpl<br>import matplotlib.pyplot as plt<br>import numpy as np<br>import sklearn<br>import pandas as pd<br>import os,sys,time<br>import tensorflow as tf<br>from tensorflow import keras<h1 id="import-keras"><a href="#import-keras" class="headerlink" title="import keras"></a>import keras</h1>def showVersion():<div class="code-wrapper"><pre><code class="hljs">print((tf.__version__))print(sys.version_info)for module in mpl, np, pd, sklearn, tf, keras:    print(module.__name__,module.__version__)</code></pre></div>class_names = [‘T-shirt’,’Trouser’,’Pullover’,’Dress’,<div class="code-wrapper"><pre><code class="hljs">           &#39;Coat&#39;, &#39;Sandal&#39;, &#39;Shirt&#39;, &#39;Sneaker&#39;,           &#39;Bag&#39;, &#39;Ankle boot&#39;           ]</code></pre></div>fashion_mnist = keras.datasets.fashion_mnist<br>(x_train_all,y_train_all),(x_test,y_test) = fashion_mnist.load_data()<br>x_valid, x_train = x_train_all[:5000], x_train_all[5000:]<br>y_valid, y_train = y_train_all[:5000], y_train_all[5000:]<br>def showDataShape():<div class="code-wrapper"><pre><code class="hljs">print(x_valid.shape, y_valid.shape)print(x_train.shape, y_train.shape)print(x_test.shape, y_test.shape)</code></pre></div>def show_single_image(img_arr):<div class="code-wrapper"><pre><code class="hljs"> plt.imshow(img_arr,cmap=&quot;binary&quot;) plt.show()</code></pre></div>def show_images(n_rows, n_cols, x_data, y_data, class_names):<div class="code-wrapper"><pre><code class="hljs">assert len(x_data) == len(y_data)assert n_rows * n_cols &lt; len(x_data)plt.figure(figsize = (n_cols * 1.4, n_rows * 1.6))for row in range(n_rows):    for col in range(n_cols):        index = n_cols * row + col        plt.subplot(n_rows, n_cols, index+1)        plt.imshow(x_data[index], cmap=&quot;binary&quot;,interpolation=&quot;nearest&quot;)        plt.axis(&quot;off&quot;)        plt.title(class_names[y_data[index]])plt.show()</code></pre></div>def nn():<div class="code-wrapper"><pre><code class="hljs">model = keras.models.Sequential()   #  keras.Sequential() 好像与此一样model.add(keras.layers.Flatten(input_shape=[28,28]))model.add(keras.layers.Dense(300,activation=&quot;relu&quot;))model.add(keras.layers.Dense(100,activation=&quot;relu&quot;))  # relu : y = max(0,x)model.add(keras.layers.Dense(10,activation=&quot;softmax&quot;))&quot;&quot;&quot;或model = keras.models.Sequential([    keras.layers.Flatten(input_shape=[28,28]),    keras.layers.Dense(300,activation=&quot;relu&quot;),    keras.layers.Dense(100,activation=&quot;relu&quot;),    keras.layers.Dense(10,activation=&quot;softmax&quot;)])&quot;&quot;&quot;# softmax : x = [x1, x2, x3],#   y = [e^x1/sum, e^x2/sum,e^x3/sum]   sum = e^x1+e^x2+e^x3model.compile(loss=&quot;sparse_categorical_crossentropy&quot;,              optimizer = &quot;adam&quot;,  # 若loss太低,可能是算法的问题,换用优化过的梯度下降算法              metrics = [&#39;accuracy&#39;])# model.summary()  # 显示模型信息history = model.fit(x_train,y_train,epochs=10,validation_data=(x_valid,y_valid))# history.history  # 中间结果 jsonreturn history</code></pre></div>def plot_learning_curves(history):<div class="code-wrapper"><pre><code class="hljs">pd.DataFrame(history.history).plot(figsize=(8,5))plt.grid(True)plt.gca().set_ylim(0,1)plt.show()</code></pre></div>if <strong>name</strong> ==”<strong>main</strong>“:<div class="code-wrapper"><pre><code class="hljs">pass# show_single_image(x_train[0])# showVersion()# show_images(3,5,x_train,y_train,class_names)history = nn()plot_learning_curves(history)</code></pre></div><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs css"><br>   <br><br><span class="hljs-number">2</span>. ```python<br>   # coding:utf-<span class="hljs-number">8</span><br>   # file: tf_keras_classification_model_normalizer.py<br>   # author: Dean<br>   # contact: <span class="hljs-number">1028968939</span>@qq.com<br>   # time: <span class="hljs-number">2019</span>/<span class="hljs-number">12</span>/<span class="hljs-number">17</span> <span class="hljs-number">11</span>:<span class="hljs-number">47</span><br>   # desc: 归一化提高准确率<br>   <br>   import matplotlib as mpl<br>   import matplotlib.pyplot as plt<br>   import numpy as np<br>   import sklearn<br>   import pandas as pd<br>   import os,sys,time<br>   import tensorflow as tf<br>   from tensorflow import keras<br>   def <span class="hljs-built_in">showVersion</span>():<br>       <span class="hljs-built_in">print</span>((tf.__version__))<br>       <span class="hljs-built_in">print</span>(sys.version_info)<br>       for module in mpl, np, pd, sklearn, tf, keras:<br>           <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br>   <br>   class_names = [<span class="hljs-string">&#x27;T-shirt&#x27;</span>,<span class="hljs-string">&#x27;Trouser&#x27;</span>,<span class="hljs-string">&#x27;Pullover&#x27;</span>,<span class="hljs-string">&#x27;Dress&#x27;</span>,<br>                  <span class="hljs-string">&#x27;Coat&#x27;</span>, <span class="hljs-string">&#x27;Sandal&#x27;</span>, <span class="hljs-string">&#x27;Shirt&#x27;</span>, <span class="hljs-string">&#x27;Sneaker&#x27;</span>,<br>                  <span class="hljs-string">&#x27;Bag&#x27;</span>, <span class="hljs-string">&#x27;Ankle boot&#x27;</span><br>                  ]<br>   <br>   fashion_mnist = keras.datasets.fashion_mnist<br>   (x_train_all,y_train_all),(x_test,y_test) = fashion_mnist.<span class="hljs-built_in">load_data</span>()<br>   x_valid, x_train = x_train_all[:<span class="hljs-number">5000</span>], x_train_all[<span class="hljs-number">5000</span>:]<br>   y_valid, y_train = y_train_all[:<span class="hljs-number">5000</span>], y_train_all[<span class="hljs-number">5000</span>:]<br>   # 归一化处理 x = (x-u) / std   x-减去均值/方差  : 均值是<span class="hljs-number">0</span>方差是<span class="hljs-number">1</span>的正态分布<br>   from sklearn.preprocessing import StandardScaler<br>   scaler = <span class="hljs-built_in">StandardScaler</span>()<br>   # x_train:[None,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>] ----&gt;[None, <span class="hljs-number">784</span>] ------&gt;[None, <span class="hljs-number">28</span>, <span class="hljs-number">28</span>]<br>   x_train_scaled = scaler.<span class="hljs-built_in">fit_transform</span>(x_train.<span class="hljs-built_in">astype</span>(np.float32).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br>   x_valid_scaled = scaler.<span class="hljs-built_in">transform</span>(x_valid.<span class="hljs-built_in">astype</span>(np.float32).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)  # 使用训练集的均值,方差<br>   x_test_scaled = scaler.<span class="hljs-built_in">transform</span>(x_test.<span class="hljs-built_in">astype</span>(np.float32).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).<span class="hljs-built_in">reshape</span>(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br>   <br>   def <span class="hljs-built_in">nn</span>():<br>       model = keras.models.<span class="hljs-built_in">Sequential</span>()   #  keras.<span class="hljs-built_in">Sequential</span>() 好像与此一样<br>       model.<span class="hljs-built_in">add</span>(keras.layers.<span class="hljs-built_in">Flatten</span>(input_shape=[<span class="hljs-number">28</span>,<span class="hljs-number">28</span>]))<br>       model.<span class="hljs-built_in">add</span>(keras.layers.<span class="hljs-built_in">Dense</span>(<span class="hljs-number">300</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>))<br>       model.<span class="hljs-built_in">add</span>(keras.layers.<span class="hljs-built_in">Dense</span>(<span class="hljs-number">100</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>))  # relu : y = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>,x)<br>       model.<span class="hljs-built_in">add</span>(keras.layers.<span class="hljs-built_in">Dense</span>(<span class="hljs-number">10</span>,activation=<span class="hljs-string">&quot;softmax&quot;</span>))<br>   <br>       model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;sparse_categorical_crossentropy&quot;</span>,<br>                     optimizer = <span class="hljs-string">&quot;adam&quot;</span>,  # 若loss太低,可能是算法的问题,换用优化过的梯度下降算法<br>                     metrics = [<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>       history = model.<span class="hljs-built_in">fit</span>(x_train_scaled,y_train,epochs=<span class="hljs-number">10</span>,validation_data=(x_valid_scaled,y_valid))<br>       model.<span class="hljs-built_in">evaluate</span>(x_test_scaled,y_test)  # 验证集验证<br>       return history<br>   <br>   def <span class="hljs-built_in">plot_learning_curves</span>(history):<br>       pd.<span class="hljs-built_in">DataFrame</span>(history.history).<span class="hljs-built_in">plot</span>(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<br>       plt.<span class="hljs-built_in">grid</span>(True)<br>       plt.<span class="hljs-built_in">gca</span>().<span class="hljs-built_in">set_ylim</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>       plt.<span class="hljs-built_in">show</span>()<br>   if __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>       pass<br>       history = <span class="hljs-built_in">nn</span>()<br>       <span class="hljs-built_in">plot_learning_curves</span>(history)<br></code></pre></td></tr></table></figure></li></ol></li><li><h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><ol><li><p>module: tf.keras.callbacks(本文中只有重要的几个)</p><ul><li><p>EarlyStopping:提起终止训练</p></li><li><p>ModelCheckpoint:每隔一段时间保存模型</p></li><li><p>TensorBoard:可在训练过程中图形化显示</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_keras_classification_model_callbacks.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/17 11:47</span><br><span class="hljs-comment"># desc: 回调函数</span><br><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showVersion</span>():</span><br>    <span class="hljs-built_in">print</span>((tf.__version__))<br>    <span class="hljs-built_in">print</span>(sys.version_info)<br>    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> mpl, np, pd, sklearn, tf, keras:<br>        <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br><br>class_names = [<span class="hljs-string">&#x27;T-shirt&#x27;</span>,<span class="hljs-string">&#x27;Trouser&#x27;</span>,<span class="hljs-string">&#x27;Pullover&#x27;</span>,<span class="hljs-string">&#x27;Dress&#x27;</span>,<br>               <span class="hljs-string">&#x27;Coat&#x27;</span>, <span class="hljs-string">&#x27;Sandal&#x27;</span>, <span class="hljs-string">&#x27;Shirt&#x27;</span>, <span class="hljs-string">&#x27;Sneaker&#x27;</span>,<br>               <span class="hljs-string">&#x27;Bag&#x27;</span>, <span class="hljs-string">&#x27;Ankle boot&#x27;</span><br>               ]<br><br>fashion_mnist = keras.datasets.fashion_mnist<br>(x_train_all,y_train_all),(x_test,y_test) = fashion_mnist.load_data()<br>x_valid, x_train = x_train_all[:<span class="hljs-number">5000</span>], x_train_all[<span class="hljs-number">5000</span>:]<br>y_valid, y_train = y_train_all[:<span class="hljs-number">5000</span>], y_train_all[<span class="hljs-number">5000</span>:]<br><br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><br>x_train_scaled = scaler.fit_transform(x_train.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br>x_valid_scaled = scaler.transform(x_valid.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)  <span class="hljs-comment"># 使用训练集的均值,方差</span><br>x_test_scaled = scaler.transform(x_test.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nn</span>():</span><br>    model = keras.models.Sequential()   <span class="hljs-comment">#  keras.Sequential() 好像与此一样</span><br>    model.add(keras.layers.Flatten(input_shape=[<span class="hljs-number">28</span>,<span class="hljs-number">28</span>]))<br>    model.add(keras.layers.Dense(<span class="hljs-number">300</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>))<br>    model.add(keras.layers.Dense(<span class="hljs-number">100</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>))  <span class="hljs-comment"># relu : y = max(0,x)</span><br>    model.add(keras.layers.Dense(<span class="hljs-number">10</span>,activation=<span class="hljs-string">&quot;softmax&quot;</span>))<br><br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;sparse_categorical_crossentropy&quot;</span>,<br>                  optimizer = <span class="hljs-string">&quot;adam&quot;</span>,  <span class="hljs-comment"># 若loss太低,可能是算法的问题,换用优化过的梯度下降算法</span><br>                  metrics = [<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><br>    <span class="hljs-comment"># Tensorboard,EarlyStopping,ModelCheckpoint</span><br>    <span class="hljs-comment"># 相对路径可能会报错，另外注意tf2.0以上版本，使用tensorboard时命令行路径不能有中文，最好是进入事件文件所在文件夹 --logdir=. 报错可能小，一般报错都是因为中文路径问题，还有就是--logdir的问题，相对，绝对路径问题(好像是这样，出错时多试试即可，宗旨，少使用中文，logdir=.)</span><br>    logdir = <span class="hljs-string">r&quot;D:\desktop\Workspace\PythonWorkSpace\Tensorflow2.0\Tensorflow2.0_谷歌\callbacks&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(logdir):<br>        os.mkdir(logdir)<br>    output_model_file = os.path.join(logdir,<span class="hljs-string">&quot;fashion_mnist_model.h5&quot;</span>)<br>    callbacks = [<br>        keras.callbacks.TensorBoard(logdir),<br>        keras.callbacks.ModelCheckpoint(output_model_file,save_best_only = <span class="hljs-literal">True</span>),  <span class="hljs-comment"># 默认保存最近一次训练,True表示保存效果最好的</span><br>        keras.callbacks.EarlyStopping(patience = <span class="hljs-number">5</span>, min_delta = <span class="hljs-number">1e-3</span>)  <span class="hljs-comment"># 提前结束 当阈值低于1e-3时记录一次,5次后停止</span><br>    ]<br>    history = model.fit(x_train_scaled,y_train,epochs=<span class="hljs-number">10</span>,<br>                        validation_data=(x_valid_scaled,y_valid),<br>                        callbacks = callbacks)<br>    model.evaluate(x_test_scaled,y_test)  <span class="hljs-comment"># 验证集验证</span><br>    <span class="hljs-keyword">return</span> history<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history</span>):</span><br>    pd.DataFrame(history.history).plot(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.gca().set_ylim(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>    plt.show()<br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    history = nn()<br>    plot_learning_curves(history)<br></code></pre></td></tr></table></figure></li></ul></li></ol></li></ol></li><li><h3 id="图像分类-房价预测"><a href="#图像分类-房价预测" class="headerlink" title="图像分类,房价预测"></a>图像分类,房价预测</h3></li><li><h3 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h3><ol><li><p>分类问题,回归问题,损失函数</p></li><li><p>神经网络,激活函数,批量归一化,Dropout</p><ol><li><p>Min-max 归一化:  $x*=\frac{x-min}{max-min}$</p></li><li><p>Z-score归一化:  $x*= \frac{x-\mu}{\sigma}$</p></li><li><p>批归一化:将输入的归一化扩展到每层激活值上,每层的输出是下一层的输入,都做归一化</p></li><li><p>归一化可以加速训练,<font color="red">一定程度上缓解梯度消失</font></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_keras_classification_model_dnn.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/17 11:47</span><br><span class="hljs-comment"># desc: 深度神经网络</span><br><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showVersion</span>():</span><br>    <span class="hljs-built_in">print</span>((tf.__version__))<br>    <span class="hljs-built_in">print</span>(sys.version_info)<br>    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> mpl, np, pd, sklearn, tf, keras:<br>        <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br><br>class_names = [<span class="hljs-string">&#x27;T-shirt&#x27;</span>,<span class="hljs-string">&#x27;Trouser&#x27;</span>,<span class="hljs-string">&#x27;Pullover&#x27;</span>,<span class="hljs-string">&#x27;Dress&#x27;</span>,<br>               <span class="hljs-string">&#x27;Coat&#x27;</span>, <span class="hljs-string">&#x27;Sandal&#x27;</span>, <span class="hljs-string">&#x27;Shirt&#x27;</span>, <span class="hljs-string">&#x27;Sneaker&#x27;</span>,<br>               <span class="hljs-string">&#x27;Bag&#x27;</span>, <span class="hljs-string">&#x27;Ankle boot&#x27;</span><br>               ]<br><br>fashion_mnist = keras.datasets.fashion_mnist<br>(x_train_all,y_train_all),(x_test,y_test) = fashion_mnist.load_data()<br>x_valid, x_train = x_train_all[:<span class="hljs-number">5000</span>], x_train_all[<span class="hljs-number">5000</span>:]<br>y_valid, y_train = y_train_all[:<span class="hljs-number">5000</span>], y_train_all[<span class="hljs-number">5000</span>:]<br><br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><br>x_train_scaled = scaler.fit_transform(x_train.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br>x_valid_scaled = scaler.transform(x_valid.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)  <span class="hljs-comment"># 使用训练集的均值,方差</span><br>x_test_scaled = scaler.transform(x_test.astype(np.float32).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)).reshape(-<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nn</span>():</span><br>    model = keras.models.Sequential()<br>    model.add(keras.layers.Flatten(input_shape=[<span class="hljs-number">28</span>,<span class="hljs-number">28</span>]))<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):  <span class="hljs-comment"># 循环生成网络</span><br>        model.add(keras.layers.Dense(<span class="hljs-number">100</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>))  <span class="hljs-comment"># 若使用&quot;selu&quot; 是一个自带归一化的激活函数,使用它不用自己归一化</span><br>        model.add(keras.layers.BatchNormalization())<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        对于先激活还是先归一化,不确定,好像都可以,因此下边写法也对</span><br><span class="hljs-string">        model.add(keras.layers.Dense(100))</span><br><span class="hljs-string">        model.add(keras.layers.BatchNormalization())</span><br><span class="hljs-string">        model.add(keras.layers.Activation(&#x27;relu&#x27;))</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>    model.add(keras.layers.AlphaDropout(rate=<span class="hljs-number">0.5</span>))  <span class="hljs-comment"># dropout层,更强大的dropout,drop后均值,方差不变,归一化性质不变  因此可与selu一起使用</span><br>    <span class="hljs-comment"># model.add(keras.layers.Dropout(rate=0.5))</span><br>    model.add(keras.layers.Dense(<span class="hljs-number">10</span>,activation=<span class="hljs-string">&quot;softmax&quot;</span>))<br><br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;sparse_categorical_crossentropy&quot;</span>,<br>                  optimizer = <span class="hljs-string">&quot;adam&quot;</span>,<br>                  metrics = [<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>    logdir = <span class="hljs-string">r&quot;D:\desktop\Workspace\PythonWorkSpace\Tensorflow2.0\Tensorflow2.0_谷歌\dnn-callbacks&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(logdir):<br>        os.mkdir(logdir)<br>    output_model_file = os.path.join(logdir,<span class="hljs-string">&quot;fashion_mnist_model.h5&quot;</span>)<br>    callbacks = [<br>        keras.callbacks.TensorBoard(logdir),<br>        keras.callbacks.ModelCheckpoint(output_model_file,save_best_only = <span class="hljs-literal">True</span>),<br>        keras.callbacks.EarlyStopping(patience = <span class="hljs-number">5</span>, min_delta = <span class="hljs-number">1e-3</span>)<br>    ]<br>    history = model.fit(x_train_scaled,y_train,epochs=<span class="hljs-number">10</span>,<br>                        validation_data=(x_valid_scaled,y_valid),<br>                        callbacks = callbacks)<br>    model.evaluate(x_test_scaled,y_test)  <span class="hljs-comment"># 验证集验证</span><br>    <span class="hljs-keyword">return</span> history<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history</span>):</span><br>    pd.DataFrame(history.history).plot(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.gca().set_ylim(<span class="hljs-number">0</span>,<span class="hljs-number">3</span>)<br>    plt.show()<br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    history = nn()<br>    plot_learning_curves(history)<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Wide,deep模型 超参数搜索</p><ol><li><p>稀疏特征</p><ol><li>离散值特征</li><li>One-hot表示,则是稀疏特征</li><li>Eg: 词表={‘你好’,’你’,….} 你={0,1,0,0,0,0…}</li><li>可以叉乘</li><li>优点:有效,应用于工业界</li><li>缺点:<ol><li>需要人工设计</li><li>可能过拟合</li></ol></li></ol></li><li><p>密集特征</p><ol><li>向量表达<ol><li>Eg: 词表={人工智能,他,你,慕课网}</li><li>他=[0.3,0.5,0.3,(维向量)]</li></ol></li><li>Word2vec工具</li><li>优点:<ol><li>带有语义信息,不同向量之间有相关性</li><li>兼容没有出现过的特征组合</li><li>更少的人工参与</li></ol></li><li>绝点:过度泛化</li></ol></li><li><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173052716-1006708621.png"></p></li></ol></li></ol></li></ol></li></ol><div class="code-wrapper"><pre><code class="hljs">        ![](https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173106031-530432268.png)       4. 子类API       5. 功能API(函数式API)       6. 多输入与多输出          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_keras_regression_wide_deep.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/17 11:47</span><br><span class="hljs-comment"># desc: wide &amp;&amp; deep</span><br><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showVersion</span>():</span><br>    <span class="hljs-built_in">print</span>((tf.__version__))<br>    <span class="hljs-built_in">print</span>(sys.version_info)<br>    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> mpl, np, pd, sklearn, tf, keras:<br>        <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> fetch_california_housing<br>housing = fetch_california_housing()<br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br>(x_train_all,x_test,y_train_all,y_test) = train_test_split(<br>    housing.data,housing.target,random_state=<span class="hljs-number">7</span><br>)<br>x_train, x_valid,y_train, y_valid = train_test_split(<br>    x_train_all,y_train_all,random_state=<span class="hljs-number">11</span><br>)<br><br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><br>x_train_scaled = scaler.fit_transform(x_train)<br>x_valid_scaled = scaler.transform(x_valid)<br>x_test_scaled = scaler.transform(x_test)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nn</span>():</span><br>    <span class="hljs-keyword">pass</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # 函数式API</span><br><span class="hljs-string">    input = keras.layers.Input(shape=x_train.shape[1:])</span><br><span class="hljs-string">    hidden1 = keras.layers.Dense(30,activation=&quot;relu&quot;)(input)</span><br><span class="hljs-string">    hidden2 = keras.layers.Dense(30,activation=&quot;relu&quot;)(hidden1)</span><br><span class="hljs-string"></span><br><span class="hljs-string">    concat = keras.layers.concatenate([input,hidden2])  # 拼接   input 直接到输出,input经过hidden后输出   此时input 是相同的</span><br><span class="hljs-string">    output = keras.layers.Dense(1)(concat)</span><br><span class="hljs-string">    model = keras.models.Model(inputs=[input],outputs=[output])</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # 子类API</span><br><span class="hljs-string">    class WideDeepModel(keras.models.Model):</span><br><span class="hljs-string">        def __init__(self):</span><br><span class="hljs-string">            super(WideDeepModel,self).__init__()</span><br><span class="hljs-string">            # 定义模型的层次</span><br><span class="hljs-string">            self.hidden1_layer = keras.layers.Dense(30,activation=&quot;relu&quot;)</span><br><span class="hljs-string">            self.hidden2_layer = keras.layers.Dense(30,activation=&quot;relu&quot;)</span><br><span class="hljs-string">            self.output_layer = keras.layers.Dense(1)</span><br><span class="hljs-string">        def call(self,input):</span><br><span class="hljs-string">            # 完成模型的正向计算</span><br><span class="hljs-string">            hidden1 = self.hidden1_layer(input)</span><br><span class="hljs-string">            hidden2 = self.hidden2_layer(hidden1)</span><br><span class="hljs-string">            concat = keras.layers.concatenate([input,hidden2])</span><br><span class="hljs-string">            output = self.output_layer(concat)</span><br><span class="hljs-string">            return output</span><br><span class="hljs-string">    model = WideDeepModel()  # model = keras.models.Sequential([WideDeepModel(),])</span><br><span class="hljs-string">    model.build(input_shape=(None,8))</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # 多输入</span><br><span class="hljs-string">    input_wide = keras.layers.Input(shape=[5])</span><br><span class="hljs-string">    input_deep = keras.layers.Input(shape=[6])</span><br><span class="hljs-string">    hidden1 = keras.layers.Dense(30,activation=&quot;relu&quot;)(input_deep)</span><br><span class="hljs-string">    hidden2 = keras.layers.Dense(30,activation=&quot;relu&quot;)(hidden1)</span><br><span class="hljs-string">    concat = keras.layers.concatenate([input_wide,hidden2])   # 拼接input是不同的</span><br><span class="hljs-string">    output = keras.layers.Dense(1)(concat)</span><br><span class="hljs-string">    model = keras.models.Model(inputs=[input_deep,input_wide],</span><br><span class="hljs-string">                              outputs=[output])</span><br><span class="hljs-string">    x_train_scaled_wide = x_train_scaled[:, :5]</span><br><span class="hljs-string">    x_train_scaled_deep = x_train_scaled[:, 2:]</span><br><span class="hljs-string">    x_valid_scaled_wide = x_valid_scaled[:, :5]</span><br><span class="hljs-string">    x_valid_scaled_deep = x_valid_scaled[:, 2:]</span><br><span class="hljs-string">    x_test_scaled_wide = x_test_scaled[:, :5]</span><br><span class="hljs-string">    x_test_scaled_deep = x_test_scaled[:, 2:]</span><br><span class="hljs-string">    # fit ,evaluate 中换对应数据即可 实现多输入x_train_scaled ---&gt;[x_train_scaled_wide,x_train_scaled_deep] 还要验证输入,测试输入</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># 多输出</span><br>    input_wide = keras.layers.Input(shape=[<span class="hljs-number">5</span>])<br>    input_deep = keras.layers.Input(shape=[<span class="hljs-number">6</span>])<br>    hidden1 = keras.layers.Dense(<span class="hljs-number">30</span>, activation=<span class="hljs-string">&quot;relu&quot;</span>)(input_deep)<br>    hidden2 = keras.layers.Dense(<span class="hljs-number">30</span>, activation=<span class="hljs-string">&quot;relu&quot;</span>)(hidden1)<br>    concat = keras.layers.concatenate([input_wide, hidden2])  <span class="hljs-comment"># 拼接input是不同的</span><br>    output = keras.layers.Dense(<span class="hljs-number">1</span>)(concat)   <span class="hljs-comment"># 此时有两个输出</span><br>    output2 = keras.layers.Dense(<span class="hljs-number">1</span>)(hidden2)<br>    model = keras.models.Model(inputs=[input_deep, input_wide],<br>                               outputs=[output,output2])<br>    <span class="hljs-comment"># deep,wide 同上进行分割,注意此时fit时 y_train-----&gt;[y_train,y_train]  还有验证y_valid y_test</span><br>    <span class="hljs-comment"># ===================================================</span><br>    model.summary()<br>    model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;mean_squared_error&quot;</span>, optimizer=<span class="hljs-string">&quot;adam&quot;</span>)  <span class="hljs-comment"># 若出现梯度爆炸 可换用梯度下降算法</span><br>    callbacks = [keras.callbacks.EarlyStopping(patience=<span class="hljs-number">5</span>, min_delta=<span class="hljs-number">1e-4</span>)]<br><br>    history = model.fit(x_train_scaled,y_train,epochs=<span class="hljs-number">100</span>,<br>                        validation_data=(x_valid_scaled,y_valid),<br>                        callbacks=callbacks)<br>    model.evaluate(x_test_scaled,y_test)  <span class="hljs-comment"># 验证集验证</span><br>    <span class="hljs-keyword">return</span> history<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history</span>):</span><br>    pd.DataFrame(history.history).plot(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.gca().set_ylim(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>    plt.show()<br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    history = nn()<br>    plot_learning_curves(history)<br></code></pre></td></tr></table></figure>     7. 超参数搜索             1. 神经网络训练过程不变的参数           1. 网络结构参数:几层,每层宽度,每层激活函数等        2. 训练参数:batch_size,学习率,学习衰减算法等        2. 手工试耗费人力        3. 搜索策略           1. 网格搜索              - 定义n维方格              - 每个方格对应一组超参数              - 一组一组尝试              - 例如,学习率定义m个,dropout n个,交叉m\*n 次运算           2. 随机搜索              - 在网格搜索的网格中,随机搜索,次数变多,           3. 遗传算法搜索              1. 对自然界模拟              2. A,初始化参数集合-&gt;训练-&gt;得到模型指标作为生存概率              3. B,选择-&gt;交叉-&gt;变异-&gt;产生下一代集合              4. C,重新到A           4. 启发式搜索              1. 研究热点-AutoML              2. 使用循环神经网络生成参数              3. 使用强化学习来进行反馈,使用模型来训练生成参数             <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_keras_regression_hp_search.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/17 11:47</span><br><span class="hljs-comment"># desc: 超参数搜索</span><br>         <br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showVersion</span>():</span><br>    <span class="hljs-built_in">print</span>((tf.__version__))<br>    <span class="hljs-built_in">print</span>(sys.version_info)<br>    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> mpl, np, pd, sklearn, tf, keras:<br>        <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> fetch_california_housing<br>housing = fetch_california_housing()<br>         <br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br>(x_train_all,x_test,y_train_all,y_test) = train_test_split(<br>    housing.data,housing.target,random_state=<span class="hljs-number">7</span><br>)<br>x_train, x_valid,y_train, y_valid = train_test_split(<br>    x_train_all,y_train_all,random_state=<span class="hljs-number">11</span><br>)<br>         <br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br>         <br>x_train_scaled = scaler.fit_transform(x_train)<br>x_valid_scaled = scaler.transform(x_valid)<br>x_test_scaled = scaler.transform(x_test)<br>         <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">nn</span>():</span><br>    <span class="hljs-comment"># 超参数搜索</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    # 自实现超参数搜索,本例简单,顺序运行,参数单一</span><br><span class="hljs-string">    # learning_rate:[1e-3,3e-4,1e-4,3e-3,1e-2,3e-2]</span><br><span class="hljs-string">    learning_rate = [1e-3,3e-4,1e-4,3e-3,1e-2,3e-2]</span><br><span class="hljs-string">    # w = w + learning_rate * grad</span><br><span class="hljs-string">    historys =[]</span><br><span class="hljs-string">    for lr in learning_rate:</span><br><span class="hljs-string">        model = keras.models.Sequential([</span><br><span class="hljs-string">            keras.layers.Dense(30,activation=&quot;relu&quot;,input_shape=x_train.shape[1:]),</span><br><span class="hljs-string">            keras.layers.Dense(1)</span><br><span class="hljs-string">        ])</span><br><span class="hljs-string">        optimizer = keras.optimizers.Adam(lr) # lr应该是根据不同的策略会逐渐衰减的</span><br><span class="hljs-string">        model.compile(loss=&quot;mean_squared_error&quot;, optimizer=optimizer)</span><br><span class="hljs-string">        callbacks = [keras.callbacks.EarlyStopping(patience=5, min_delta=1e-2)]</span><br><span class="hljs-string">        history = model.fit(x_train_scaled,y_train,epochs=100,</span><br><span class="hljs-string">                            validation_data=(x_valid_scaled,y_valid),</span><br><span class="hljs-string">                            callbacks=callbacks)</span><br><span class="hljs-string">        historys.append(history)</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># RandomizedSearchCV</span><br>    <span class="hljs-comment"># 1,转化为sklear的model</span><br>    <span class="hljs-comment">#   tf.keras.wrappers.scikit_learn.KerasRegressor</span><br>    <span class="hljs-comment">#   tf.keras.wrappers.scikit_learn.KerasClassifier</span><br>    <span class="hljs-comment"># 2,定义参数集合</span><br>    <span class="hljs-comment"># 3,搜索参数</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">build_model</span>(<span class="hljs-params">hidden_layers = <span class="hljs-number">1</span>,layer_size = <span class="hljs-number">30</span>, learning_rate = <span class="hljs-number">3e-3</span></span>):</span><br>        model = keras.models.Sequential()<br>        model.add(keras.layers.Dense(layer_size,activation=<span class="hljs-string">&quot;relu&quot;</span>,input_shape=x_train.shape[<span class="hljs-number">1</span>:]))<br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(hidden_layers - <span class="hljs-number">1</span>):<br>            model.add(keras.layers.Dense(layer_size,activation=<span class="hljs-string">&quot;relu&quot;</span>))<br>        model.add(keras.layers.Dense(<span class="hljs-number">1</span>))<br>        optimizer = keras.optimizers.Adam(learning_rate)<br>        model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;mean_squared_error&quot;</span>, optimizer=optimizer)<br>        <span class="hljs-keyword">return</span> model<br>    sklearn_model = keras.wrappers.scikit_learn.KerasRegressor(build_model) <span class="hljs-comment"># 传入函数名</span><br>         <br>    <span class="hljs-keyword">from</span> scipy.stats <span class="hljs-keyword">import</span> reciprocal<br>    <span class="hljs-comment"># f(x) = 1/(x*log(b/a))  a&lt;=x&lt;=b</span><br>    param_distribution = &#123;<br>        <span class="hljs-string">&quot;hidden_layers&quot;</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>],<br>        <span class="hljs-string">&quot;layer_size&quot;</span>: np.arange(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>),  <span class="hljs-comment"># [1,2,3....100]</span><br>        <span class="hljs-string">&quot;learning_rate&quot;</span>: reciprocal(<span class="hljs-number">1e-4</span>, <span class="hljs-number">1e-2</span>)  <span class="hljs-comment"># 按照某种分布生成</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> RandomizedSearchCV<br>    random_search_cv = RandomizedSearchCV(sklearn_model,<br>                                          param_distribution,<br>                                          cv = <span class="hljs-number">5</span>,  <span class="hljs-comment"># 交叉验证 份数</span><br>                                          n_iter=<span class="hljs-number">10</span>,  <span class="hljs-comment"># 随机寻找参数组合的数量，默认值为10。</span><br>                                          n_jobs=<span class="hljs-number">1</span>)  <span class="hljs-comment"># 并行计算时使用的计算机核心数量，默认值为1。当n_jobs的值设为-1时，则使用所有的处理器。</span><br>    callbacks = [keras.callbacks.EarlyStopping(patience=<span class="hljs-number">5</span>, min_delta=<span class="hljs-number">1e-2</span>)]<br>    history = random_search_cv.fit(x_train_scaled, y_train, epochs=<span class="hljs-number">100</span>,   <span class="hljs-comment"># 还使用fit</span><br>                            validation_data=(x_valid_scaled, y_valid),<br>                            callbacks=callbacks)<br>    <span class="hljs-comment"># cross_validation:交叉验证 ,训练集分为n份 n-1份训练,1份测试</span><br>    random_search_cv.best_params_  <span class="hljs-comment"># 最好的参数</span><br>    random_search_cv.best_score_  <span class="hljs-comment"># 最好的参数对应的分数</span><br>    model = random_search_cv.best_estimator_.model  <span class="hljs-comment"># 最好的模型</span><br>    model.evaluate(x_test_scaled,y_test)  <span class="hljs-comment"># 测试</span><br>    <br>    <span class="hljs-keyword">return</span> historys<br>         <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history</span>):</span><br>    pd.DataFrame(history.history).plot(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.gca().set_ylim(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>    plt.show()<br><span class="hljs-keyword">if</span> __name__ ==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    historys = nn()<br>    <span class="hljs-keyword">for</span> history <span class="hljs-keyword">in</span> historys:<br>        <span class="hljs-built_in">print</span>()<br>        plot_learning_curves(history)<br><br></code></pre></td></tr></table></figure></code></pre><ol start="3"><li><h1 id="Tensorflow基础API使用"><a href="#Tensorflow基础API使用" class="headerlink" title="Tensorflow基础API使用"></a>Tensorflow基础API使用</h1><ol><li><h3 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h3><ol><li>Tf框架:基础数据类型,自定义模型与损失函数,自定义求导,tf.function,图结构\</li><li>项目:图像分类,房价预测</li></ol></li><li><h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h3><ol><li>基础API</li><li>基础API与keras的集成<ol><li>自定义损失函数</li><li>自定义层次</li></ol></li><li>@tf.function的使用(2.0专有:将python转化为图结构)</li><li>自定义求导</li></ol></li><li><h3 id="tf-function"><a href="#tf-function" class="headerlink" title="@tf.function"></a>@tf.function</h3><ol><li>将python函数编译为图</li><li>易于将模型导出为GraphDef+checkpoint 或者SavedModel</li><li>使得eager execution可以默认打开</li><li>1.0的代码可以通过tf.function在2.0继续使用<ol><li>代替session</li></ol></li></ol></li><li><h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><ol><li><p>基础数据类型</p><ol><li><p>Tf.constant,tf.string</p><ol><li>```python<h1 id="0维-一个数-shape"><a href="#0维-一个数-shape" class="headerlink" title="0维 一个数 shape=()"></a>0维 一个数 shape=()</h1><h1 id="1维-列表-shape-n"><a href="#1维-列表-shape-n" class="headerlink" title="1维 列表 shape=(n)"></a>1维 列表 shape=(n)</h1><h1 id="2维-二维数组-shape-m-n"><a href="#2维-二维数组-shape-m-n" class="headerlink" title="2维 二维数组 shape=(m,n)"></a>2维 二维数组 shape=(m,n)</h1>t = tf.constant([<div class="code-wrapper"><pre><code class="hljs">[1,2,3],[4,5,6]</code></pre></div>])  # 2.0中可以直接获取值<br>print(t)<br>print(t[:,1:])<br>print(t[…,2]) # 一维向量 tf.Tensor([3 6], shape=(2,), dtype=int32)<br>print(t+10)  # 都加上10<br>print(tf.square(t))  # 每个数平方<br>print(t @ tf.transpose(t))  # 返回t与它转置的乘积 2<em>2<br>print(t.numpy())  # 直接转化为numpy对象 2</em>3矩阵<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>2. ```python<br>   t = tf.constant(<span class="hljs-string">&quot;tensorflow&quot;</span>)<br>   <span class="hljs-builtin-name">print</span>(t)  # tf.Tensor(b<span class="hljs-string">&#x27;tensorflow&#x27;</span>, shape=(), <span class="hljs-attribute">dtype</span>=string)<br>   <span class="hljs-builtin-name">print</span>(tf.strings.length(t))  # tf.Tensor(10, shape=(), <span class="hljs-attribute">dtype</span>=int32)<br>   <span class="hljs-builtin-name">print</span>(tf.strings.length(t,<span class="hljs-attribute">unit</span>=<span class="hljs-string">&quot;UTF8_CHAR&quot;</span>))  # tf.Tensor(10, shape=(), <span class="hljs-attribute">dtype</span>=int32)<br>   <span class="hljs-builtin-name">print</span>(tf.strings.unicode_decode(t,<span class="hljs-string">&quot;utf8&quot;</span>))  # tf.Tensor([116 101 110 115 111 114 102 108 111 119], shape=(10,), <span class="hljs-attribute">dtype</span>=int32)<br>   t = tf.constant([<span class="hljs-string">&#x27;cafe&#x27;</span>,<span class="hljs-string">&#x27;coffee&#x27;</span>,<span class="hljs-string">&#x27;咖啡&#x27;</span>])  #<br>   <span class="hljs-builtin-name">print</span>(tf.strings.length(t,<span class="hljs-attribute">unit</span>=<span class="hljs-string">&quot;UTF8_CHAR&quot;</span>))  # tf.Tensor([4 6 2], shape=(3,), <span class="hljs-attribute">dtype</span>=int32)<br>   <span class="hljs-builtin-name">print</span>(tf.strings.unicode_decode(t,<span class="hljs-string">&quot;utf8&quot;</span>))  # &lt;tf.RaggedTensor [[99, 97, 102, 101], [99, 111, 102, 102, 101, 101], [21654, 21857]]&amp;gt;<br></code></pre></td></tr></table></figure></li></ol></li><li><p>tf.ragged.constant,tfSpareTensor</p><ol><li><p>```python<br>v = tf.Variable([[1,2,3,4],[5,6,7,8]])<br>print(v)  # Variable 对象<br>print(v.value())  # tensor<br>print(v.numpy())  # numpy矩阵</p><h1 id="重新赋值-不能用等于号"><a href="#重新赋值-不能用等于号" class="headerlink" title="重新赋值,不能用等于号"></a>重新赋值,不能用等于号</h1><p>v.assign(2*v)<br>v[0,1].assign(42)<br>v[1].assign([9,10,11,12])</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs lua"><br><span class="hljs-number">2.</span> ```python<br>   t = tf.ragged.constant(<span class="hljs-string">[[11,12],[13,14,15]]</span>)<br>   <span class="hljs-built_in">print</span>(t)  # &lt;tf.RaggedTensor <span class="hljs-string">[[11, 12], [13, 14, 15]]</span>&amp;gt;<br>   <span class="hljs-built_in">print</span>(t[<span class="hljs-number">1</span>])  # tf.Tensor([<span class="hljs-number">13</span> <span class="hljs-number">14</span> <span class="hljs-number">15</span>], shape=(<span class="hljs-number">3</span>,), dtype=int32)<br>   <span class="hljs-built_in">print</span>(t[<span class="hljs-number">1</span>:<span class="hljs-number">2</span>])  # &lt;tf.RaggedTensor <span class="hljs-string">[[13, 14, 15]]</span>&amp;gt;<br>   <span class="hljs-built_in">print</span>(tf.<span class="hljs-built_in">concat</span>([t,t],axis=<span class="hljs-number">0</span>))  # 按照行拼接变为<span class="hljs-number">4</span>行<br>   <span class="hljs-built_in">print</span>(tf.<span class="hljs-built_in">concat</span>([t,t],axis=<span class="hljs-number">1</span>))  # 若要按照列拼接,首先行数要相同<br>   <span class="hljs-built_in">print</span>(t.to_tensor())  # 变为普通tensor 空的位置补为<span class="hljs-number">0</span>,<span class="hljs-number">0</span>都在正常值后边<br></code></pre></td></tr></table></figure></li><li><p>```python<br>t = tf.SparseTensor(indices=[[0,1],[1,0],[2,3]],  # 注意必须先[0,1] 再[0,2] 否则to_dense 会报错,若必须不按顺序 tf.sparse.reorder(t) 即可使用</p><div class="code-wrapper"><pre><code class="hljs">                values=[1,2,3],                dense_shape=[3,4])</code></pre></div><p>print(t)  # 存储稀疏矩阵,指定值位置,数值,shape即可<br>print(tf.sparse.to_dense(t))  # 转换为普通tensor</p><h1 id="不能加法"><a href="#不能加法" class="headerlink" title="不能加法"></a>不能加法</h1><p>t2 = tf.constant(“..”)  # 普通的4<em>3 Tensor<br>tf.sparse.sparse_dense_matmul(t,t2)  # 得到的是3</em>3普通Tensor</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br><span class="hljs-number">2.</span> 自定义损失函数------<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Tf</span>.</span></span>reduce_mean<br><br>   ```python<br>    def customized<span class="hljs-constructor">_mse(<span class="hljs-params">y_true</span>, <span class="hljs-params">y_pred</span>)</span>:<br>           return tf.reduce<span class="hljs-constructor">_mean(<span class="hljs-params">tf</span>.<span class="hljs-params">square</span>(<span class="hljs-params">y_pred</span> - <span class="hljs-params">y_true</span>)</span>)<br>    model.compile(loss=customized_mse, optimizer=<span class="hljs-string">&quot;adam&quot;</span>,metrics=<span class="hljs-literal">[&quot;<span class="hljs-identifier">mean_squared_error</span>&quot;]</span>)<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><p>自定义层次—–Keras.layers.Lambda和继承法</p><ol><li>```python<br>layer = tf.keras.layers.Dense(100,input_shape=[None,5])<br>layer(tf.zero([10,5]))   # 输出[10,100] 二维<h1 id="10-5-w-b-10-100"><a href="#10-5-w-b-10-100" class="headerlink" title="[10,5] * w  +b = [10,100]"></a>[10,5] * w  +b = [10,100]</h1><h1 id="w-5-100"><a href="#w-5-100" class="headerlink" title="w  [5:100]"></a>w  [5:100]</h1>layer.trainable_variables # 获得kernel 与bias 可以查看<h1 id="———————————————"><a href="#———————————————" class="headerlink" title="———————————————"></a>———————————————</h1> class CustomizedDenseLayer(keras.layers.Layer):<div class="code-wrapper"><pre><code class="hljs">    def __init__(self,units,activation=None,**kwargs):        self.units = units        self.activation = keras.layers.Activation(activation)        super(CustomizedDenseLayer, self).__init__(**kwargs)    def build(self,input_shape):        &quot;&quot;&quot;构建需要的参数&quot;&quot;&quot;        # x * w +b [None,a] w[a,b] [None,b]        self.kernel = self.add_weight(name=&quot;kernel&quot;,                                      shape=(input_shape[1],self.units),                                      initilizer=&quot;uniform&quot;, # 定义随机初始化kernel的方法:此处使用均匀分布                                      trainable=True)        self.bias = self.add_weight(name=&quot;bias&quot;,                                    shape=(self.units,),                                    initilizer=&quot;zeros&quot;,                                    trainable=True)        super(CustomizedDenseLayer,self).build(input_shape)    def call(self,x):        &quot;&quot;&quot;完整的正向计算&quot;&quot;&quot;        return self.activation(x @ self.kernel + self.bias)  # @ 表示矩阵乘法model = keras.models.Sequential([    CustomizedDenseLayer(30, activation=&quot;relu&quot;, input_shape=x_train.shape[1:]),    CustomizedDenseLayer(1)])</code></pre></div><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br><span class="hljs-number">2.</span> ```python<br>    # 定义简单的层次,激活函数层,dropout层等<br>       #   eg:tf.nn.softplus: log(<span class="hljs-number">1</span>+e^x)<br>       # customized_softplus = keras.layers.<span class="hljs-constructor">Dense(1,<span class="hljs-params">activation</span>=<span class="hljs-string">&quot;softplus&quot;</span>)</span> = keras.layers.<span class="hljs-constructor">Dense(1)</span>,keras.layers.<span class="hljs-constructor">Activation(<span class="hljs-string">&quot;softplus&quot;</span>)</span><br>       customized_softplus = keras.layers.<span class="hljs-constructor">Lambda(<span class="hljs-params">lambda</span> <span class="hljs-params">x</span>:<span class="hljs-params">tf</span>.<span class="hljs-params">nn</span>.<span class="hljs-params">softplus</span>(<span class="hljs-params">x</span>)</span>)<br></code></pre></td></tr></table></figure></li></ol></li><li><p>Tf.function</p><ol><li><p>Tf.fucntion,tf.autograph.to_code, </p><ol><li><p>```python</p><h1 id="python-—–-gt-图"><a href="#python-—–-gt-图" class="headerlink" title="python —–&gt;图"></a>python —–&gt;图</h1><h1 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h1><p>def scaled_elu(z,scale=1.0,alpha=1.0):   # python函数</p><div class="code-wrapper"><pre><code class="hljs"># z&gt;=0?scale *z :scale * alpha * tf.nn.elu(z)is_positive = tf.greater_equal(z,0.0)return scale * tf.where(is_positive,z,alpha * tf.nn.elu(z))</code></pre></div><p>print(scaled_elu(tf.constant(-3)))   #   常量<br>print(scaled_elu(tf.constant([-3,-2.5])))  # 列表向量  都何以全部接受并处理<br>scaled_elu_tf = tf.function(scaled_elu)<br>scaled_elu_tf.python_function  # 返回原来的python函数<br>print(scaled_elu(tf.constant(-3)))<br>print(scaled_elu(tf.constant([-3,-2.5]))) # 与上边结果相同,转换的作用是速度加快</p><h1 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h1><h1 id="1-1-2-…-1-2-n"><a href="#1-1-2-…-1-2-n" class="headerlink" title="1+1/2+….1/2^n"></a>1+1/2+….1/2^n</h1><p>@tf.function<br>def converge_to(n_iters):</p><div class="code-wrapper"><pre><code class="hljs">total = tf.constant(0.)increment = tf.constant(1.)for _ in range(n_iters):    total += increment    increment /= 2.0return total</code></pre></div><p>print(converge_to(20))</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br><span class="hljs-number">2.</span> ```python<br>   def display<span class="hljs-constructor">_tf_code(<span class="hljs-params">func</span>)</span>:<br>       # 中间代码<br>       # python代码转为tf代码, 图就是通过此转换的<br>       code = tf.autograph.<span class="hljs-keyword">to</span><span class="hljs-constructor">_code(<span class="hljs-params">func</span>)</span>   # 还有to_graph 是将代码转为图的<br>       from <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IPython</span>.</span></span>display import display,Markdown<br>       display(<span class="hljs-constructor">Markdown(&#x27;```<span class="hljs-params">python</span>\<span class="hljs-params">n</span>&#123;&#125;\<span class="hljs-params">n</span>```&#x27;.<span class="hljs-params">format</span>(<span class="hljs-params">code</span>)</span>))<br>   display<span class="hljs-constructor">_tf_code(<span class="hljs-params">scaled_elu</span>)</span><br></code></pre></td></tr></table></figure></li><li><p>```python<br>var = tf.Variable(0.)<br>@tf.function<br>def add_21():</p><div class="code-wrapper"><pre><code class="hljs">return var.assign_add(21)</code></pre></div><p>print(add_21())  # 结果返回21的tensor   ,若var在内部会报错, 神经网络中大多是变量,需要在外边初始化</p><p>@tf.function(input_signature=[tf.TensorSpec([None],tf.int32,name=’x’)])<br>def cube(z):  # 可接收浮点数,整数  使用输入签名后会限制只能输入int32</p><div class="code-wrapper"><pre><code class="hljs">return tf.pow(z,3)</code></pre></div><p>print(cube(tf.constant([1.2,2.6])))<br>print(cube(tf.constant([1,2])))</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><br><span class="hljs-number">4.</span> ```python<br>   # 只有经过输入签名的才能保存为Saved_Model,在这个过程中使用get_concrete_function,把tf.<span class="hljs-keyword">function</span>标注的转换为有图建议的函数<br>   cube_func_int32 = cube.get<span class="hljs-constructor">_concrete_function(<span class="hljs-params">tf</span>.TensorSpec([None],<span class="hljs-params">tf</span>.<span class="hljs-params">int32</span>)</span>)<br>   <br>   print(cube_func_int32 is cube.get<span class="hljs-constructor">_concerte_function(<span class="hljs-params">tf</span>.TensorSpec([2],<span class="hljs-params">tf</span>.<span class="hljs-params">int32</span>)</span>))<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><p>GraphDef</p><ol><li><p>get_operations,get_operation_by_name</p></li><li><p>get_tensorf_by_name,as_graph_def</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">cube_func_int32.graph  <span class="hljs-comment"># 图</span><br>cube_func_int32.graph.get_operations()  <span class="hljs-comment"># 获取操作</span><br>cube_func_int32.graph.get_operations()[<span class="hljs-number">2</span>]  <span class="hljs-comment"># 获取某一个操作</span><br>cube_func_int32.graph.get_operations()[<span class="hljs-number">2</span>].xxx  <span class="hljs-comment"># 获取某一个操作中的某个属性</span><br><br>cube_func_int32.graph.get_operation_by_name(<span class="hljs-string">&quot;operationName&quot;</span>)  <span class="hljs-comment"># 通过operation名字获取</span><br>cube_func_int32.graph.get_tensor_by_name(<span class="hljs-string">&quot;x:0&quot;</span>)  <span class="hljs-comment"># 通过tensor名字获取</span><br><br>cube_func_int32.graph.as_graph_def()  <span class="hljs-comment"># 显示图的结构信息</span><br><br><span class="hljs-comment"># 主要用来保存图结构,模型,恢复图结构,模型</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>自动求导</p><ol><li><p>普通求导方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">f</span>(<span class="hljs-params">x</span>):</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">3.</span> * x ** <span class="hljs-number">2</span> + <span class="hljs-number">2.</span> * x -<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">approximae_derivative</span>(<span class="hljs-params">f,x,eps= <span class="hljs-number">1e-3</span></span>):</span>  <span class="hljs-comment"># 求函数 f 在 x 点的导数</span><br>    <span class="hljs-comment"># x点向右eps, 向左eps 中间直线的斜率近似导数, eps足够小,导数足够接近</span><br>    <span class="hljs-keyword">return</span> (f(x+eps)-f(x-eps))/(<span class="hljs-number">2</span>*eps)<br><span class="hljs-comment"># print(approximae_derivative(f,1))</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">g</span>(<span class="hljs-params">x1,x2</span>):</span><br>    <span class="hljs-keyword">return</span> (x1 + <span class="hljs-number">5</span>)*(x2 ** <span class="hljs-number">2</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">approximae_gredient</span>(<span class="hljs-params">g,x1,x2,eps=<span class="hljs-number">1e-3</span></span>):</span><br>    dg_x1 = approximae_derivative(<span class="hljs-keyword">lambda</span> x:g(x,x2),x1,eps)<br>    dg_x2 = approximae_derivative(<span class="hljs-keyword">lambda</span> x:g(x1,x),x2,eps)<br>    <span class="hljs-keyword">return</span> dg_x1,dg_x2<br><span class="hljs-comment"># print(approximae_gredient(g,2,3))</span><br></code></pre></td></tr></table></figure></li><li><p>Tf.GrandientTape</p><ol><li><p>```python<br>x1 = tf.Variable(2.0)<br>x2 = tf.Variable(3.0)<br>with tf.GradientTape(persistent = True) as tape:</p><div class="code-wrapper"><pre><code class="hljs">z = g(x1,x2)</code></pre></div><p>dz_x1 = tape.gradient(z,x1)  # 9.0<br>dz_x2 = tape.gradient(z,x2)   # tape 只能使用一次,本次会报错 GradientTape(persistent=Ture) 表示不释放tape就可以多次使用,但使用完毕后需要手动释放那个资源<br>print(dz_x1,dz_x2)<br>del tape</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nix"><br>   <br><br><span class="hljs-number">2</span>. ```python<br>   <span class="hljs-keyword">with</span> tf.GradientTape(<span class="hljs-attr">persistent</span> = True) as tape: <span class="hljs-comment"># 不用persistent</span><br>       <span class="hljs-attr">z</span> = g(x1,x2)<br>   dz_x1,<span class="hljs-attr">dz_x2</span> = tape.gradient(z,[x1,x2])   <span class="hljs-comment"># 也可以这样一次求出两个</span><br></code></pre></td></tr></table></figure></li><li><p>```python</p><h1 id="当x1-x2-为tf-constant-时-返回值为None"><a href="#当x1-x2-为tf-constant-时-返回值为None" class="headerlink" title="当x1,x2 为tf.constant()时,返回值为None"></a>当x1,x2 为tf.constant()时,返回值为None</h1><p>with tf.GradientTape(persistent = True) as tape:  # 这样修改即可</p><div class="code-wrapper"><pre><code class="hljs">tape.watch(x1)tape.watch(x2)z = g(x1,x2)</code></pre></div><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br>   <br><br><span class="hljs-attribute">4</span>. ```python<br>   <span class="hljs-attribute">x</span> = tf.Variable(<span class="hljs-number">5</span>.<span class="hljs-number">0</span>)<br>   <span class="hljs-attribute">with</span> tf.GradientTape() as tape:<br>       <span class="hljs-attribute">z1</span> = <span class="hljs-number">3</span> * x<br>       <span class="hljs-attribute">z2</span> = x **<span class="hljs-number">2</span><br>   <span class="hljs-attribute">tape</span>.gradient([z<span class="hljs-number">1</span>,z<span class="hljs-number">2</span>],x)  # z<span class="hljs-number">1</span>对于x的导数加上z<span class="hljs-number">2</span>对于x的导数<br></code></pre></td></tr></table></figure></li><li><p>```python</p><h1 id="二阶导数"><a href="#二阶导数" class="headerlink" title="二阶导数"></a>二阶导数</h1><p>x1 = tf.Variable(2.0)<br>x2 = tf.Variable(3.0)<br>with tf.GradientTape(persistent=True) as outer_tape:</p><div class="code-wrapper"><pre><code class="hljs">with tf.GradientTape(persistent=True) as inner_tape:    z = g(x1,x2)inner_grads = inner_tape.gradient(z,[x1,x2])</code></pre></div><p>outer_grads = [outer_tape.gradient(inner_grad,[x1,x2])</p><div class="code-wrapper"><pre><code class="hljs">           for inner_grad in inner_grads]</code></pre></div><p>print(outer_grads)<br>del inner_tape<br>del outer_tape</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><br>   <br><br><span class="hljs-attribute">6</span>. ```python<br>   <span class="hljs-comment"># 简单梯度下降</span><br>   <span class="hljs-attribute">learning_rate</span> = <span class="hljs-number">0</span>.<span class="hljs-number">1</span><br>   <span class="hljs-attribute">x</span> = tf.Variable(<span class="hljs-number">0</span>.<span class="hljs-number">0</span>)<br>   <span class="hljs-attribute">for</span> _ in range(<span class="hljs-number">100</span>):<br>       <span class="hljs-attribute">with</span> tf.GradientTape() as tape:<br>           <span class="hljs-attribute">z</span> = <span class="hljs-number">3</span>. * x ** <span class="hljs-number">2</span> + <span class="hljs-number">2</span>. * x -<span class="hljs-number">1</span><br>       <span class="hljs-attribute">dz_dx</span> = tape.gradient(z,x)<br>       <span class="hljs-attribute">x</span>.assign_sub(learning_rate*dz_dx)<br>   <span class="hljs-attribute">print</span>(x) # -<span class="hljs-number">0</span>.<span class="hljs-number">333333</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>Optimizer.apply_gradients</p><ol><li><p>```python</p><h1 id="优化梯度下降"><a href="#优化梯度下降" class="headerlink" title="优化梯度下降"></a>优化梯度下降</h1><p>learning_rate = 0.1<br>x = tf.Variable(0.0)<br>optimizer = keras.optimizers.SGD(lr = learning_rate)<br>for _ in range(100):</p><div class="code-wrapper"><pre><code class="hljs">with tf.GradientTape() as tape:    z = 3. * x ** 2 + 2. * x -1dz_dx = tape.gradient(z,x)optimizer.apply_gradients([(dz_dx,x)])  # 与上边不同</code></pre></div><p>print(x) # -0.333333</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br>2. ```python<br>   def <span class="hljs-built_in">test</span>():<br>       metric = keras.metrics.MeanSquaredError()  <span class="hljs-comment"># 第一个形参是真实值,第二个是预测值  返回的是平均 均方误差</span><br>       <span class="hljs-built_in">print</span>(metric([5],[2]))  <span class="hljs-comment"># 9</span><br>       <span class="hljs-built_in">print</span>(metric([0],[1]))  <span class="hljs-comment"># 5</span><br>       <span class="hljs-built_in">print</span>(metric.result())  <span class="hljs-comment"># 5</span><br>       metric.reset_statues()  <span class="hljs-comment"># 不再累加</span><br>       <span class="hljs-built_in">print</span>(metric([1],[3]))  <span class="hljs-comment"># 4</span><br></code></pre></td></tr></table></figure></li><li><p>```python<br>def nn(): </p><div class="code-wrapper"><pre><code class="hljs"># fit 的内容#   1,batch 遍历训练集 metric#       1.1,自动求导#   2,epoch结束 验证集 metricepochs = 100batch_size = 32steps_per_epoch = len(x_train_scaled) // batch_sizeoptimizer = keras.optimizers.SGD()metric = keras.metrics.MeanSquaredError()def random_batch(x,y,batch_size=32):    idx = np.random.randint(0,len(x),size=batch_size)  # 在0到 len(x) 中随机取batch_size个数    return x[idx],y[idx]model = keras.models.Sequential([    keras.layers.Dense(30,activation=&quot;relu&quot;,input_shape=x_train.shape[1:]),    keras.layers.Dense(1),])for epoch in range(epochs):    metric.reset_states()    for step in range(steps_per_epoch):        x_batch,y_batch = random_batch(x_train_scaled,y_train,batch_size)  # 获取数据        with tf.GradientTape() as  tape:            y_pred = model(x_batch)  # 计算预测            loss = tf.reduce_mean(keras.losses.mean_squared_error(y_batch,y_pred))  # 定义损失函数            metric(y_batch,y_pred)        grads = tape.gradient(loss,model.variables)        grads_and_vars = zip(grads,model.variables)   # 每个参数对应他的梯度        optimizer.apply_gradients(grads_and_vars)  # 将梯度的变化应用到变量上        print(&quot;\rEpoch&quot;,epoch,&quot;train mse:&quot;,metric.result().numpy(),end=&quot;&quot;)    y_valid_pred = model(x_valid_scaled)    valid_loss = tf.reduce_mean(        keras.losses.mean_squared_error(y_valid_pred,y_valid)    )    print(&quot;\t&quot;,&quot;valid mse&quot;,valid_loss.numpy())</code></pre></div><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">            <br>               <br><br><span class="hljs-number">4.</span> # Tensorflow dataset使用<br><br>   <span class="hljs-number">1.</span> ### 基础知识<br><br>      <span class="hljs-number">1.</span> Tf框架:<br><br>         <span class="hljs-number">1.</span> 基础api<br><br>            <span class="hljs-number">1.</span> tf.data.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Dateset</span>.</span></span>from_tensor_slics<br><br>               ```python<br>               dataset = tf.data.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Dataset</span>.</span></span>from<span class="hljs-constructor">_tensor_slices((<span class="hljs-params">np</span>.<span class="hljs-params">arange</span>(10)</span>))<br>               print(dataset)  # &lt;TensorSliceDataset shapes: <span class="hljs-literal">()</span>, types: tf.<span class="hljs-built_in">int32</span>&gt;    # 里边的元素每一个为一组<br></code></pre></td></tr></table></figure></li><li><p>repeat,batch,interleave,map,shuffle,list_files</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> dataset.batch(<span class="hljs-number">2</span>):  <span class="hljs-comment"># 还是10打个数,但此时每组2个,5组</span><br>     <span class="hljs-built_in">print</span>(item)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">dataset = dataset.repeat(<span class="hljs-number">3</span>)  <span class="hljs-comment"># dataset 变为30个数,30组</span><br>dataset =dataset.batch(<span class="hljs-number">7</span>)   <span class="hljs-comment"># 每组7个数 5组</span><br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> dataset:<br>    <span class="hljs-built_in">print</span>(item)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># interleave: 将dataset中的每一个数据处理后,合并返回</span><br><span class="hljs-comment"># case:dataset 中是一系列文件的名字,通过他,遍历名字读取内容,使用它合并</span><br>dataset2 = dataset.interleave(<br>    <span class="hljs-keyword">lambda</span> v:tf.data.Dataset.from_tensor_slices(v),  <span class="hljs-comment"># map_fn:处理函数</span><br>    cycle_length=<span class="hljs-number">5</span>, <span class="hljs-comment"># cycle_length:并行处理个数</span><br>    block_length=<span class="hljs-number">5</span> <span class="hljs-comment"># block_length: 从处理的元素中每次取多少个出来 [0,1,2,3,4,5,6]  只取[0,1,2,3,4]  最后不够的时候 从第一个中未取到的取</span><br>)<br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> dataset2:<br>    <span class="hljs-built_in">print</span>(item)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">x = np.array([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])<br>y = np.array([<span class="hljs-string">&#x27;cat&#x27;</span>,<span class="hljs-string">&#x27;dog&#x27;</span>,<span class="hljs-string">&#x27;fox&#x27;</span>])<br><br>dataset3 = tf.data.Dataset.from_tensor_slices((x,y))<br><span class="hljs-keyword">for</span> item_x,item_y <span class="hljs-keyword">in</span> dataset3:<br>    <span class="hljs-built_in">print</span>(item_x.numpy(),item_y.numpy())<br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">[1 2] b&#x27;cat&#x27;</span><br><span class="hljs-string">[3 4] b&#x27;dog&#x27;</span><br><span class="hljs-string">[5 6] b&#x27;fox&#x27;</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>dataset4 = tf.data.Dataset.from_tensor_slices(&#123;<span class="hljs-string">&#x27;feature&#x27;</span>:x,<span class="hljs-string">&quot;label&quot;</span>:y&#125;)<br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> dataset4:<br>    <span class="hljs-built_in">print</span>(item[<span class="hljs-string">&#x27;feature&#x27;</span>].numpy(),item[<span class="hljs-string">&#x27;label&#x27;</span>].numpy())  <span class="hljs-comment"># 同上</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>csv文件,</p><ol><li><p>生成csv</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">showVersion</span>():</span><br>    <span class="hljs-built_in">print</span>((tf.__version__))<br>    <span class="hljs-built_in">print</span>(sys.version_info)<br>    <span class="hljs-keyword">for</span> module <span class="hljs-keyword">in</span> mpl, np, pd, sklearn, tf, keras:<br>        <span class="hljs-built_in">print</span>(module.__name__,module.__version__)<br><span class="hljs-keyword">from</span> sklearn.datasets <span class="hljs-keyword">import</span> fetch_california_housing<br>housing = fetch_california_housing()<br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br>(x_train_all,x_test,y_train_all,y_test) = train_test_split(<br>    housing.data,housing.target,random_state=<span class="hljs-number">7</span><br>)<br>x_train, x_valid,y_train, y_valid = train_test_split(<br>    x_train_all,y_train_all,random_state=<span class="hljs-number">11</span><br>)<br><br><span class="hljs-keyword">from</span> sklearn.preprocessing <span class="hljs-keyword">import</span> StandardScaler<br>scaler = StandardScaler()<br><br>x_train_scaled = scaler.fit_transform(x_train)<br>x_valid_scaled = scaler.transform(x_valid)<br>x_test_scaled = scaler.transform(x_test)<br>output_dir = <span class="hljs-string">r&quot;generate_csv&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):<br>    os.mkdir(output_dir)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_to_csv</span>(<span class="hljs-params">output_dir,data,name_prefix,header=<span class="hljs-literal">None</span>,n_parts=<span class="hljs-number">10</span></span>):</span><br>    path_format = os.path.join(output_dir,<span class="hljs-string">&quot;&#123;&#125;_&#123;:02d&#125;.csv&quot;</span>)  <span class="hljs-comment"># 文件名格式:第一个表示是train还是test 第二个表示为2位的整数</span><br>    filenames= []<br>    <span class="hljs-keyword">for</span> file_idx,row_indics <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(  <span class="hljs-comment"># 将数据分为索引加数据 通过idx indics获取</span><br>            np.array_split( <span class="hljs-comment"># 将索引分为n_parts部分  [array(1,2,3,4,), array(5,6,7,8..)]</span><br>                np.arange(<span class="hljs-built_in">len</span>(data)),  <span class="hljs-comment"># 生成和data一样长的数组,当索引</span><br>                         n_parts)   <span class="hljs-comment"># 将索引分为n_patrs</span><br>            ):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        file_idx row_indics</span><br><span class="hljs-string">        0       [0,1,2,3,4..]</span><br><span class="hljs-string">        1       [5,6,7,8,9..]</span><br><span class="hljs-string">        2       ...</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span>(name_prefix,file_idx)<br>        part_csv = path_format.<span class="hljs-built_in">format</span>(name_prefix,file_idx)<br>        filenames.append(part_csv)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(part_csv,<span class="hljs-string">&quot;wt&quot;</span>,encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            <span class="hljs-keyword">if</span> header <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>                f.write(header+<span class="hljs-string">&quot;\n&quot;</span>)  <span class="hljs-comment"># 写入header</span><br>            <span class="hljs-keyword">for</span> row_index <span class="hljs-keyword">in</span> row_indics:<br>                f.write(<span class="hljs-string">&quot;,&quot;</span>.join([<span class="hljs-built_in">repr</span>(col) <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> data[row_index]]))<br>                f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">return</span> filenames<br>train_data = np.c_[x_train_scaled,y_train]  <span class="hljs-comment"># 将数据和标签合并</span><br>valid_data = np.c_[x_valid_scaled,y_valid]<br>test_data = np.c_[x_test_scaled,y_test]<br>header_cols = housing.feature_names + [<span class="hljs-string">&#x27;MidianHouseValue&#x27;</span>]<br>header_str = <span class="hljs-string">&#x27;,&#x27;</span>.join(header_cols)<br>train_filenames = save_to_csv(output_dir,train_data,<span class="hljs-string">&quot;train&quot;</span>,header_str,n_parts=<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure></li><li><p>tf.data.TextLineDataset</p></li><li><p>tf.io.decode_csv</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1. filename ---&gt; dataset</span><br><span class="hljs-comment"># 2. read file --&gt; dataset -&gt; datasets -&gt;merge</span><br><span class="hljs-comment"># 3, parse csv</span><br>filename_dataset = tf.data.Dataset.list_files(train_filenames)<br>n_readers =<span class="hljs-number">5</span><br>dataset = filename_dataset.interleave(<br>    <span class="hljs-keyword">lambda</span> filename:tf.data.TextLineDataset(filename).skip(<span class="hljs-number">1</span>),  <span class="hljs-comment"># 根据文件名按照行读取文件内容, 并跳过header</span><br>    cycle_length=n_readers<br>)<br><span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> dataset.take(<span class="hljs-number">15</span>):  <span class="hljs-comment"># 读取数据的前15行</span><br>    <span class="hljs-built_in">print</span>(line.numpy())  <span class="hljs-comment">#  是一个整字符串</span><br><span class="hljs-comment"># tf.io.decode_csv(str,record_defaults)</span><br>sample_str = <span class="hljs-string">&#x27;1,2,3,4,5&#x27;</span><br>records_defaults = [tf.constant(<span class="hljs-number">0</span>,dtype=tf.int32)]*<span class="hljs-number">5</span> <span class="hljs-comment"># 要解析的类型</span><br>records_defaults = [tf.constant(<span class="hljs-number">0</span>,dtype=tf.int32),<span class="hljs-number">0</span>,np.nan,<span class="hljs-string">&quot;hello&quot;</span>,tf.constant([])] <span class="hljs-comment"># 要解析的类型</span><br>parsed_fields = tf.io_csv(sample_str,records_defaults)<br><span class="hljs-built_in">print</span>(parsed_fields)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_csv_line</span>(<span class="hljs-params">line,n_fileds=<span class="hljs-number">9</span></span>):</span><br>    defs = [tf.constant(np.nan)] * n_fileds<br>    parsed_fields = tf.io.decode_csv(line,record_defaults=defs)<br>    x = tf.stack(parsed_fields[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>])<br>    y = tf.stack(parsed_fields[-<span class="hljs-number">1</span>:])<br>    <span class="hljs-keyword">return</span> x,y<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">csv_reader_dataset</span>(<span class="hljs-params">filenames,n_readers=<span class="hljs-number">5</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       batch_size=<span class="hljs-number">32</span>,n_parse_threads=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 解析时并行数</span></span></span><br><span class="hljs-params"><span class="hljs-function">                       shuffle_buffer_size=<span class="hljs-number">10000</span></span>):</span>  <span class="hljs-comment"># buffer大小</span><br>    dataset = tf.data.Dataset.list_files(filenames)<br>    dataset = dataset.repeat()  <span class="hljs-comment"># 重复无限次</span><br>    dataset = dataset.interleave(<br>        <span class="hljs-keyword">lambda</span> filename: tf.data.TextLineDataset(filename).skip(<span class="hljs-number">1</span>),<br>        cycle_length= n_readers,<br>    )<br>    dataset.shuffle(shuffle_buffer_size)  <span class="hljs-comment"># 混排</span><br>    dataset = dataset.<span class="hljs-built_in">map</span>(parse_csv_line,num_parallel_calls=n_parse_threads)  <span class="hljs-comment"># 将数据经过处理后返回 与interleave类似</span><br>    dataset = dataset.batch(batch_size)<br>    <span class="hljs-keyword">return</span> dataset<br>train_set = csv_reader_dataset(train_filenames,batch_size=<span class="hljs-number">32</span>)<br>valid_set = csv_reader_dataset(train_filenames,batch_size=<span class="hljs-number">32</span>)  <span class="hljs-comment"># 换位valid_filenames</span><br>model = keras.models.Sequential([<br>        keras.layers.Dense(<span class="hljs-number">30</span>, activation=<span class="hljs-string">&quot;relu&quot;</span>, input_shape=x_train.shape[<span class="hljs-number">8</span>]),<br>        keras.layers.Dense(<span class="hljs-number">1</span>)<br>    ])<br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&#x27;mse&#x27;</span>, optimizer=<span class="hljs-string">&quot;adam&quot;</span>)<br>callbacks = [keras.callbacks.EarlyStopping(patience=<span class="hljs-number">5</span>, min_delta=<span class="hljs-number">1e-4</span>)]<br>history = model.fit(train_set, epochs=<span class="hljs-number">100</span>,<br>                    steps_per_epoch = <span class="hljs-number">1160</span>//<span class="hljs-number">32</span>,  <span class="hljs-comment"># 指定每个epoch 的次数</span><br>                    validation_steps =<span class="hljs-number">3870</span>//<span class="hljs-number">32</span>,<br>                    validation_data=valid_set,<br>                    callbacks=callbacks)<br><span class="hljs-comment"># model.evaluate(test_set,steps = 5160//32)</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>tfrecord文件</p><ol><li><p>tf.train.FloatList,    tf.train.Int64List,    tf.train.bytesList</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># tfrecord 文件格式</span><br><span class="hljs-comment"># -&gt; tf.train.Example</span><br><span class="hljs-comment">#   -&gt; tf.train.Features -&gt;&#123;&#x27;key&#x27;:tf.train.Feature&#125;</span><br></code></pre></td></tr></table></figure><h1 id="gt-tf-train-Feature-gt-tf-train-ByteList-FloatList-Int64List"><a href="#gt-tf-train-Feature-gt-tf-train-ByteList-FloatList-Int64List" class="headerlink" title="-&gt;tf.train.Feature -&gt;{tf.train.ByteList/FloatList/Int64List}"></a>-&gt;tf.train.Feature -&gt;{tf.train.ByteList/FloatList/Int64List}</h1><p>favorite_books = [name.encode(“utf-8”) for name in [“machine learning”,”cc150”]]<br>favorite_books_bytelist = tf.train.BytesList(value = favorite_books)<br>“””<br>value: “machine learning”<br>value: “cc150”<br>“””<br>hours_floatlist = tf.train.FloatList(value=[15.5,9.0,7.0,8.0])<br>age = tf.train.Int64List(value=[64])</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs vim"><br>   <br><br><span class="hljs-number">2</span>. <span class="hljs-keyword">tf</span>.train.Feature,    <span class="hljs-keyword">tf</span>.train.Features,    <span class="hljs-keyword">tf</span>.train.Example<br><br>   ```<span class="hljs-keyword">python</span><br>   features = <span class="hljs-keyword">tf</span>.train.Features(<br>       feature = &#123;<br>           <span class="hljs-string">&quot;favorite_books&quot;</span>:<span class="hljs-keyword">tf</span>.train.Feature(bytes_list = favorite_books_bytelist),<br>           <span class="hljs-string">&quot;hours&quot;</span>:<span class="hljs-keyword">tf</span>.train.Feature(float_list = hours_floatlist),<br>           <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-keyword">tf</span>.train.Feature(int64_list = age)<br>       &#125;<br>   )<br>   <span class="hljs-keyword">print</span>(features)  # json格式,显示每个feature<br>   <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">&quot;</span><br>   feature &#123;<br>     key: <span class="hljs-string">&quot;age&quot;</span><br>     value &#123;<br>       int64_list &#123;<br>         value: <span class="hljs-number">64</span><br>       &#125;<br>     &#125;<br>   &#125;<br>   faeture&#123;....&#125;<br>   <span class="hljs-string">&quot;&quot;</span><span class="hljs-comment">&quot;</span><br>   example = <span class="hljs-keyword">tf</span>.train.Example(features=features)  # 与features 类似   featrues&#123;feature&#123;&#125;...&#125;<br></code></pre></td></tr></table></figure></li><li><p>exapmle.SerializeToString</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">serizlized_example = example.SerializeToString()  <span class="hljs-comment"># 压缩,</span><br></code></pre></td></tr></table></figure></li><li><p>tf.io.ParseSingleExample</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">output_dir = <span class="hljs-string">&quot;tf_tfrecord_basic&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(output_dir):<br>    os.mkdir(output_dir)<br>filename = <span class="hljs-string">&quot;test.tfrecords&quot;</span><br>filename_fullpath = os.path.join(output_dir,filename)<br><span class="hljs-comment"># 写入文件</span><br><span class="hljs-keyword">with</span> tf.io.TFRecordWriter(filename_fullpath) <span class="hljs-keyword">as</span> writer:  <span class="hljs-comment"># 打开文件</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):  <span class="hljs-comment"># 写进去3次</span><br>        writer.write(serizlized_example)<br><span class="hljs-comment"># 读取</span><br>dataset = tf.data.TFRecordDataset([filename_fullpath])<br><span class="hljs-keyword">for</span> seralized_example <span class="hljs-keyword">in</span> dataset:<br>    <span class="hljs-built_in">print</span>(serizlized_example)   <span class="hljs-comment"># 与上边的serialized_example 类似  压缩过的</span><br><br></code></pre></td></tr></table></figure></li><li><p>tf.io.VarLenFeature,tf.io.FixedLenFeature</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">expected_features = &#123;<br>    <span class="hljs-string">&quot;favorite_books&quot;</span>: tf.io.VarLenFeature(dtype=tf.string),   <span class="hljs-comment"># 变长  一会解析后是sparsetensor</span><br>    <span class="hljs-string">&quot;hours&quot;</span>:tf.io.VarLenFeature(dtype=tf.float32),  <span class="hljs-comment"># 变长</span><br>    <span class="hljs-string">&quot;age&quot;</span>:tf.io.FixedLenFeature([],dtype=tf.int64),  <span class="hljs-comment"># 定长,普通的tensor,[] 表示是0维的数,[8] 就表示8特特征</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>tf.data.TFRecordDataset,tf.io.TFRecordOptions</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">dataset = tf.data.TFRecordDataset([filename_fullpath])<br><span class="hljs-keyword">for</span> serialized_example_tensor <span class="hljs-keyword">in</span> dataset:<br>    example = tf.io.parse_single_example(<br>        serialized_example_tensor,<br>        expected_features<br>    )<br>    books = tf.sparse.to_dense(example[<span class="hljs-string">&quot;favorite_books&quot;</span>],default_value=<span class="hljs-string">b&quot;&quot;</span>)  <span class="hljs-comment"># 解析sparsetensor 为tensor  sparsetensor为0的地方 不能转为字符串 要制定default_value</span><br><br>    <span class="hljs-built_in">print</span>(example)<br><br><span class="hljs-comment">#  存为压缩格式</span><br>filename_fullpath_zip = filename_fullpath+ <span class="hljs-string">&quot;.zip&quot;</span><br>options = tf.io.TFRecordOptions(compress_type = <span class="hljs-string">&quot;GZIP&quot;</span>)<br><span class="hljs-keyword">with</span> tf.io.TFRecordWriter(filename_fullpath_zip,options) <span class="hljs-keyword">as</span> writer:<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># 读取压缩格式</span><br>dataset = tf.data.TFRecordDataset([filename_fullpath_zip],compression_type=<span class="hljs-string">&quot;GZIP&quot;</span>)  <span class="hljs-comment"># 其余不变即可</span><br><br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><p>房价csv转record</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_data_generate_tfrecord.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/22 11:29</span><br><span class="hljs-comment"># desc:</span><br><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: tf_keras_classification_model_dnn.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/17 11:47</span><br><span class="hljs-comment"># desc: csv 文件转换为record</span><br><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br>source_dir = <span class="hljs-string">&quot;generate_csv&quot;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_filenames_by_prefix</span>(<span class="hljs-params">source_dir,prefix_name</span>):</span>  <span class="hljs-comment"># 按照文件名分类</span><br>    all_files = os.listdir(source_dir)<br>    results=[]<br>    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> all_files:<br>        <span class="hljs-keyword">if</span> filename.startswith(prefix_name):<br>            results.append(os.path.join(source_dir,filename))<br>    <span class="hljs-keyword">return</span> results<br>train_filenames = get_filenames_by_prefix(source_dir,<span class="hljs-string">&quot;train&quot;</span>)<br><span class="hljs-keyword">import</span> pprint<br><span class="hljs-comment"># pprint.pprint(train_filenames)  # 换行打印</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_csv_line</span>(<span class="hljs-params">line,n_fileds=<span class="hljs-number">9</span></span>):</span><br>    defs = [tf.constant(np.nan)] * n_fileds<br>    parsed_fields = tf.io.decode_csv(line,record_defaults=defs)<br>    x = tf.stack(parsed_fields[<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>])<br>    y = tf.stack(parsed_fields[-<span class="hljs-number">1</span>:])<br>    <span class="hljs-keyword">return</span> x,y<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">csv_reader_dataset</span>(<span class="hljs-params">filenames,n_readers=<span class="hljs-number">5</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       batch_size=<span class="hljs-number">32</span>,n_parse_threads=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 解析时并行数</span></span></span><br><span class="hljs-params"><span class="hljs-function">                       shuffle_buffer_size=<span class="hljs-number">10000</span></span>):</span>  <span class="hljs-comment"># buffer大小</span><br>    dataset = tf.data.Dataset.list_files(filenames)<br>    dataset = dataset.repeat()  <span class="hljs-comment"># 重复无限次</span><br>    dataset = dataset.interleave(<br>        <span class="hljs-keyword">lambda</span> filename: tf.data.TextLineDataset(filename).skip(<span class="hljs-number">1</span>),<br>        cycle_length= n_readers,<br>    )<br>    dataset.shuffle(shuffle_buffer_size)  <span class="hljs-comment"># 混排</span><br>    dataset = dataset.<span class="hljs-built_in">map</span>(parse_csv_line,num_parallel_calls=n_parse_threads)  <span class="hljs-comment"># 将数据经过处理后返回 与interleave类似</span><br>    dataset = dataset.batch(batch_size)<br>    <span class="hljs-keyword">return</span> dataset<br>train_set = csv_reader_dataset(train_filenames,batch_size=<span class="hljs-number">32</span>)<br><br><span class="hljs-comment"># 遍历数据写入文件</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">serialize_example</span>(<span class="hljs-params">x,y</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;Converts x ,y to tf.train.FloatList and serialize&quot;&quot;&quot;</span><br>    input_features = tf.train.FloatList(value=x)<br>    label = tf.train.FloatList(value=y)<br>    features = tf.train.Features(<br>        feature=&#123;<br>            <span class="hljs-string">&quot;input_features&quot;</span>:tf.train.Feature(float_list = input_features),<br>            <span class="hljs-string">&quot;label&quot;</span>:tf.train.Feature(float_list = label)<br>        &#125;<br>    )<br>    example = tf.train.Example(features = features)<br>    <span class="hljs-keyword">return</span> example.SerializeToString()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">csv_dataset_to_tfrecords</span>(<span class="hljs-params">base_filename,dataset,n_shards,steps_per_shard,compression_type = <span class="hljs-literal">None</span></span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    n_shard:文件个数</span><br><span class="hljs-string">    steps_per_shard:每个小文件,走多少步</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    options = tf.io.TFRecordOptions(compression_type=compression_type)<br>    all_filenames=[]<br>    <span class="hljs-keyword">for</span> shard_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n_shards):<br>        filename_fullpath = <span class="hljs-string">&#x27;&#123;&#125;_&#123;:05d&#125;-of-&#123;:05d&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<br>            base_filename,shard_id,n_shards<br>        )<br>        <span class="hljs-keyword">with</span> tf.io.TFRecordWriter(filename_fullpath,options) <span class="hljs-keyword">as</span> writer:<br>            <span class="hljs-keyword">for</span> x_batch,y_batch <span class="hljs-keyword">in</span> dataset.take(steps_per_shard):  <span class="hljs-comment">#  每个batch都是32个的</span><br>                <span class="hljs-keyword">for</span> x_example,y_example <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(x_batch,y_batch):<br>                    writer.write(serialize_example(x_example,y_example))<br>        all_filenames.append(filename_fullpath)<br>    <span class="hljs-keyword">return</span> all_filenames<br>n_shards = <span class="hljs-number">20</span><br>train_step_per_shard = <span class="hljs-number">11610</span>//<span class="hljs-number">32</span>//n_shards<br>output_dir = <span class="hljs-string">&quot;generate_tfreocrds&quot;</span>  <span class="hljs-comment"># 先创建</span><br>train_basename = os.path.join(output_dir,<span class="hljs-string">&quot;train&quot;</span>)<br><br>train_tfrecord_filename = csv_dataset_to_tfrecords(<br>    train_basename,train_set,n_shards,train_step_per_shard,<span class="hljs-literal">None</span><br>)<br><br><br><span class="hljs-comment"># 读取文件</span><br>expected_feature = &#123;<br>    <span class="hljs-string">&quot;input_ferature&quot;</span>:tf.io.FixedLenFeature([<span class="hljs-number">8</span>],dtype=tf.float32),<br>    <span class="hljs-string">&quot;label&quot;</span>:tf.io.FixedLenFeature([<span class="hljs-number">1</span>],dtype=tf.float32)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_example</span>(<span class="hljs-params">serialized_example</span>):</span><br>    example = tf.io.parse_single_example(serialize_example,expected_feature)<br>    <span class="hljs-keyword">return</span> expected_feature[<span class="hljs-string">&quot;input_ferature&quot;</span>],expected_feature[<span class="hljs-string">&#x27;label&#x27;</span>]<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">tfrecord_reader_dataset</span>(<span class="hljs-params">filenames,n_readers=<span class="hljs-number">5</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">                       batch_size=<span class="hljs-number">32</span>,n_parse_threads=<span class="hljs-number">5</span>,  <span class="hljs-comment"># 解析时并行数</span></span></span><br><span class="hljs-params"><span class="hljs-function">                       shuffle_buffer_size=<span class="hljs-number">10000</span></span>):</span>  <span class="hljs-comment"># buffer大小</span><br>    dataset = tf.data.Dataset.list_files(filenames)<br>    dataset = dataset.repeat()  <span class="hljs-comment"># 重复无限次</span><br>    dataset = dataset.interleave(<br>        <span class="hljs-keyword">lambda</span> filename: tf.data.TFRecordDataset(filename,compression_type=nONE),<br>        cycle_length= n_readers,<br>    )<br>    dataset.shuffle(shuffle_buffer_size)  <span class="hljs-comment"># 混排</span><br>    dataset = dataset.<span class="hljs-built_in">map</span>(parse_example,num_parallel_calls=n_parse_threads)  <span class="hljs-comment"># 将数据经过处理后返回 与interleave类似</span><br>    dataset = dataset.batch(batch_size)<br>    <span class="hljs-keyword">return</span> dataset<br>tfrecords_train = tfrecord_reader_dataset(train_tfrecord_filename,<br>                                          batch_size=<span class="hljs-number">3</span>)<br><span class="hljs-keyword">for</span>  x_batch,y_batch <span class="hljs-keyword">in</span> tfrecords_train:<br>    <span class="hljs-built_in">print</span>(x_batch,y_batch)<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><h1 id="Tensorflow-Estimator使用与tf1-0"><a href="#Tensorflow-Estimator使用与tf1-0" class="headerlink" title="Tensorflow Estimator使用与tf1.0"></a>Tensorflow Estimator使用与tf1.0</h1><ol><li><h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a>知识点</h3><p>Tf框架:estimator使用,特征列使用,tf1.0基本使用</p><p>项目:泰坦尼克号生存</p></li><li><h3 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h3><ol><li><p>Tf.keras.estimator.to_estimator</p><ol><li><p>Train,evaluate</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># dataset 泰坦尼克号</span><br><span class="hljs-comment"># https://storage.googleapis.com/tf-datasets/titanic/train.csv</span><br><span class="hljs-comment"># https://storage.googleapis.com/tf-datasets/titanic/eval.csv</span><br><br>train_file = <span class="hljs-string">&quot;csv/train.csv&quot;</span><br>eval_file = <span class="hljs-string">&quot;csv/eval.csv&quot;</span><br><br>train_df = pd.read_csv(train_file)  <span class="hljs-comment"># (627,9)</span><br>eval_df = pd.read_csv(eval_file)  <span class="hljs-comment"># (264.9)</span><br><br>y_train = train_df.pop(<span class="hljs-string">&quot;survived&quot;</span>)<br>y_eval = eval_df.pop(<span class="hljs-string">&quot;survived&quot;</span>)<br><span class="hljs-comment"># print(train_df)</span><br><span class="hljs-comment"># print(y_train.head())</span><br><span class="hljs-comment"># print(train_df.describe()) 非离散值的信息</span><br><span class="hljs-comment"># train_df.age.hist(bins = 20)   画出age的分布直方图 bin表示分为多少份</span><br><span class="hljs-comment"># train_df.sex.value_counts().plot(kind=&quot;barh&quot;)  # 横向柱状图 &quot;barv&quot;纵向: 统计男性个数,女性个数</span><br><span class="hljs-comment"># train_df[&#x27;class&#x27;].value_counts().plot(kind=&quot;barh&quot;) 不同舱位人数</span><br><span class="hljs-comment"># 男性,女性中获救比例,</span><br><span class="hljs-comment"># pd.concat([train_df,y_train],axis=1).groupby(&#x27;sex&#x27;).survived.mean()</span><br><br><span class="hljs-comment"># 离散值</span><br>categorical_columns = [<span class="hljs-string">&quot;sex&quot;</span>,<span class="hljs-string">&#x27;n_siblings_spouses&#x27;</span>,<span class="hljs-string">&#x27;parch&#x27;</span>,<span class="hljs-string">&#x27;class&#x27;</span>,<span class="hljs-string">&#x27;deck&#x27;</span>,<span class="hljs-string">&#x27;embark_town&#x27;</span>,<span class="hljs-string">&#x27;alone&#x27;</span>]<br><span class="hljs-comment"># 连续纸</span><br>numeric_columns = [<span class="hljs-string">&#x27;age&#x27;</span>,<span class="hljs-string">&#x27;fare&#x27;</span>]<br>feature_columns =[]<br><span class="hljs-keyword">for</span> categorical_column <span class="hljs-keyword">in</span> categorical_columns:<br>    vocab = train_df[categorical_column].unique()<br>    feature_columns.append(<br>        tf.feature_column.indicator_column(<br>            tf.feature_column.categorical_column_with_vocabulary_list(<br>                categorical_column,vocab)))<br><span class="hljs-keyword">for</span> categorical_column <span class="hljs-keyword">in</span> numeric_columns:<br>    feature_columns.append(<br>        tf.feature_column.numeric_column(<br>            categorical_column,dtype=tf.float32<br>        )<br>    )<br><span class="hljs-comment"># 构件dataset的函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_dataset</span>(<span class="hljs-params">data_df,label_df,epochs=<span class="hljs-number">10</span>,shuffle=<span class="hljs-literal">True</span>,batch_size=<span class="hljs-number">32</span></span>):</span><br>    dataset = tf.data.Dataset.from_tensor_slices(<br>        (<span class="hljs-built_in">dict</span>(data_df),label_df)<br>    )<br>    <span class="hljs-keyword">if</span> shuffle:<br>        dataset =dataset.shuffle(<span class="hljs-number">10000</span>)<br>    dataset = dataset.repeat(epochs).batch(batch_size)<br>    <span class="hljs-keyword">return</span> dataset<br>train_dataset = make_dataset(train_df,y_train,batch_size=<span class="hljs-number">5</span>)<br><br><span class="hljs-comment"># keras.layers.DenseFeature</span><br>tf.keras.backend.set_floatx(<span class="hljs-string">&#x27;float64&#x27;</span>)<br><span class="hljs-comment"># for x,y in train_dataset.take(1):</span><br><span class="hljs-comment">#     age_column = feature_columns[7]</span><br><span class="hljs-comment">#     gender_column = feature_columns[0]</span><br><span class="hljs-comment">#     print(keras.layers.DenseFeatures(age_column)(x).numpy())  # 连续值不变</span><br><span class="hljs-comment">#     print(keras.layers.DenseFeatures(gender_column)(x).numpy())  # 离散值变为one-hot</span><br><span class="hljs-comment"># for x,y in train_dataset.take(1):</span><br><span class="hljs-comment">#     print(keras.layers.DenseFeatures(feature_columns)(x).numpy())</span><br><br>model = keras.models.Sequential([<br>    keras.layers.DenseFeatures(feature_columns),<br>    keras.layers.Dense(<span class="hljs-number">100</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Dense(<span class="hljs-number">100</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Dense(<span class="hljs-number">2</span>,activation=<span class="hljs-string">&quot;softmax&quot;</span>)<br>])<br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;sparse_categorical_crossentropy&quot;</span>,<br>              optimizer=keras.optimizers.SGD(lr=<span class="hljs-number">0.01</span>),<br>              metrics = [<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br><span class="hljs-comment"># 1,model.fit</span><br><span class="hljs-comment"># 2.model--&gt;estimator -&gt;train</span><br><span class="hljs-comment"># 第一种</span><br><span class="hljs-comment"># train_dataset = make_dataset(train_df,y_train,epochs=100)</span><br><span class="hljs-comment"># eval_dataset = make_dataset(eval_df,y_eval,epochs=1,shuffle=False)</span><br><span class="hljs-comment"># model.fit(train_dataset,</span><br><span class="hljs-comment">#           validation_data = eval_dataset,</span><br><span class="hljs-comment">#           steps_per_epoch = 20,</span><br><span class="hljs-comment">#           validation_steps=8,</span><br><span class="hljs-comment">#           epochs=100)</span><br><span class="hljs-comment"># 第二种</span><br>estimator = keras.estimator.model_to_estimator(model)<br><span class="hljs-comment"># input_fn:函数或lambda  return  (feature,label)    或dataset---&gt;(feature,label)</span><br>estimator.train(input_fn = <span class="hljs-keyword">lambda</span> :make_dataset(train_df,y_train,epochs=<span class="hljs-number">100</span>))    <span class="hljs-comment"># 会出现bug</span><br></code></pre></td></tr></table></figure></li></ol></li><li><p>Tf.estimator.BaselineClassifier</p></li><li><p>Tf.estimator.LinerClassifier</p></li><li><p>Tf.estimator.DNNClassifier</p></li><li><p>Tf.feature_column</p><ol><li>categorical_column_with_vocabulary_list</li><li>numeric_column</li><li>indicator_column</li><li>cross_column</li></ol></li><li><p>keras.layers.DenseFeatures</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python">train_file = <span class="hljs-string">&quot;csv/train.csv&quot;</span><br>eval_file = <span class="hljs-string">&quot;csv/eval.csv&quot;</span><br>train_df = pd.read_csv(train_file)  <span class="hljs-comment"># (627,9)</span><br>eval_df = pd.read_csv(eval_file)  <span class="hljs-comment"># (264.9)</span><br>y_train = train_df.pop(<span class="hljs-string">&quot;survived&quot;</span>)<br>y_eval = eval_df.pop(<span class="hljs-string">&quot;survived&quot;</span>)<br><br><br><span class="hljs-comment"># 离散值</span><br>categorical_columns = [<span class="hljs-string">&quot;sex&quot;</span>,<span class="hljs-string">&#x27;n_siblings_spouses&#x27;</span>,<span class="hljs-string">&#x27;parch&#x27;</span>,<span class="hljs-string">&#x27;class&#x27;</span>,<span class="hljs-string">&#x27;deck&#x27;</span>,<span class="hljs-string">&#x27;embark_town&#x27;</span>,<span class="hljs-string">&#x27;alone&#x27;</span>]<br><span class="hljs-comment"># 连续纸</span><br>numeric_columns = [<span class="hljs-string">&#x27;age&#x27;</span>,<span class="hljs-string">&#x27;fare&#x27;</span>]<br>feature_columns =[]<br><span class="hljs-keyword">for</span> categorical_column <span class="hljs-keyword">in</span> categorical_columns:<br>    vocab = train_df[categorical_column].unique()<br>    feature_columns.append(<br>        tf.feature_column.indicator_column(<br>            tf.feature_column.categorical_column_with_vocabulary_list(<br>                categorical_column,vocab)))<br><span class="hljs-keyword">for</span> categorical_column <span class="hljs-keyword">in</span> numeric_columns:<br>    feature_columns.append(<br>        tf.feature_column.numeric_column(<br>            categorical_column,dtype=tf.float32<br>        )<br>    )<br><span class="hljs-comment"># 构件dataset的函数</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_dataset</span>(<span class="hljs-params">data_df,label_df,epochs=<span class="hljs-number">10</span>,shuffle=<span class="hljs-literal">True</span>,batch_size=<span class="hljs-number">32</span></span>):</span><br>    dataset = tf.data.Dataset.from_tensor_slices(<br>        (<span class="hljs-built_in">dict</span>(data_df),label_df)<br>    )<br>    <span class="hljs-keyword">if</span> shuffle:<br>        dataset =dataset.shuffle(<span class="hljs-number">10000</span>)<br>    dataset = dataset.repeat(epochs).batch(batch_size)<br>    <span class="hljs-keyword">return</span> dataset<br><span class="hljs-comment"># =================</span><br><span class="hljs-comment"># output_dir = &quot;baseline_model&quot;</span><br><span class="hljs-comment"># if not os.path.exists(output_dir):</span><br><span class="hljs-comment">#     os.mkdir(output_dir)</span><br><span class="hljs-comment"># baseline_estimator = tf.estimator.BaselineClassifier(model_dir=output_dir,</span><br><span class="hljs-comment">#                                                      n_classes=2)</span><br><span class="hljs-comment"># baseline_estimator.train(input_fn=lambda :make_dataset(train_df,y_train,epochs=100))</span><br><span class="hljs-comment"># baseline_estimator.evaluate(input_fn=lambda :make_dataset(eval_df,y_eval,epochs=1,shuffle=False,batch_size=20))</span><br><span class="hljs-comment"># =================</span><br><span class="hljs-comment"># linear_output_dir = &quot;liner_model&quot;</span><br><span class="hljs-comment"># if not os.path.exists(linear_output_dir):</span><br><span class="hljs-comment">#     os.mkdir(linear_output_dir)</span><br><span class="hljs-comment"># linear_estimator = tf.estimator.LinearClassifier(</span><br><span class="hljs-comment">#     model_dir=linear_output_dir,</span><br><span class="hljs-comment">#     n_classes=2,</span><br><span class="hljs-comment">#     feature_columns=feature_columns</span><br><span class="hljs-comment"># )</span><br><span class="hljs-comment"># linear_estimator.train(input_fn=lambda :make_dataset(</span><br><span class="hljs-comment">#     train_df,y_train,epochs=100))</span><br><span class="hljs-comment"># =====================================</span><br>dnn_output_dir = <span class="hljs-string">&quot;dnn_model&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(dnn_output_dir):<br>    os.mkdir(dnn_output_dir)<br>dnn_estimator = tf.estimator.DNNClass ifier(<br>    model_dir=dnn_output_dir,<br>    n_classes=<span class="hljs-number">2</span>,<br>    feature_columns=feature_columns,<br>    hidden_units=[<span class="hljs-number">128</span>,<span class="hljs-number">128</span>], <span class="hljs-comment"># 两层,都是128</span><br>    activation_fn=tf.nn.relu,<br>    optimizer=<span class="hljs-string">&quot;Adam&quot;</span><br>)<br>dnn_estimator.train(input_fn= <span class="hljs-keyword">lambda</span> :make_dataset(train_df,y_train,epochs=<span class="hljs-number">100</span>))<br>dnn_estimator.evaluate(input_fn= <span class="hljs-keyword">lambda</span> :make_dataset(<br>    eval_df,y_eval,epochs=<span class="hljs-number">1</span>,shuffle=<span class="hljs-literal">False</span>))<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><h1 id="卷积神经网络"><a href="#卷积神经网络" class="headerlink" title="卷积神经网络"></a>卷积神经网络</h1><ol><li><h3 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a>知识点</h3><ol><li><p>Tf框架:卷积实现</p><p>卷积网络:卷积+池化—全连接    ——&gt;分类任务</p><p>全卷积网络:去掉了最后的全连接层,变为反卷积层(是尺寸变大)   —–&gt;物体分割</p></li><li><p>项目:图像分类,kaggle 10monkeys,kaggle cifar10</p></li><li><p>理论:卷积,数据增强,迁移学习 </p></li><li><p>卷积网问题:</p><ol><li>参数太多<ol><li>局部连接,  图像区域性</li><li>参数共享 图像特征与位置无关</li></ol></li><li>池化时,剩余的数据会丢弃</li></ol></li></ol></li><li><h3 id="keras实现卷积神经网络"><a href="#keras实现卷积神经网络" class="headerlink" title="keras实现卷积神经网络"></a>keras实现卷积神经网络</h3><ol><li><p>```python</p><h1 id="coding-utf-8-1"><a href="#coding-utf-8-1" class="headerlink" title="coding:utf-8"></a>coding:utf-8</h1><h1 id="file-tf-keras-classification-model-cnn-py"><a href="#file-tf-keras-classification-model-cnn-py" class="headerlink" title="file: tf_keras_classification_model_cnn.py"></a>file: tf_keras_classification_model_cnn.py</h1><h1 id="author-Dean-1"><a href="#author-Dean-1" class="headerlink" title="author: Dean"></a>author: Dean</h1><h1 id="contact-49-48-50-x38-57-x36-x38-57-51-x39-x40-x71-113-x2e-x63-x6f-109"><a href="#contact-49-48-50-x38-57-x36-x38-57-51-x39-x40-x71-113-x2e-x63-x6f-109" class="headerlink" title="contact: &#49;&#48;&#50;&#x38;&#57;&#x36;&#x38;&#57;&#51;&#x39;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;"></a>contact: <a href="mailto:&#49;&#48;&#50;&#x38;&#57;&#x36;&#x38;&#57;&#51;&#x39;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;">&#49;&#48;&#50;&#x38;&#57;&#x36;&#x38;&#57;&#51;&#x39;&#x40;&#x71;&#113;&#x2e;&#x63;&#x6f;&#109;</a></h1><h1 id="time-2019-12-17-11-47-1"><a href="#time-2019-12-17-11-47-1" class="headerlink" title="time: 2019/12/17 11:47"></a>time: 2019/12/17 11:47</h1><h1 id="desc-深度神经网络"><a href="#desc-深度神经网络" class="headerlink" title="desc: 深度神经网络"></a>desc: 深度神经网络</h1><p>import matplotlib as mpl<br>import matplotlib.pyplot as plt<br>import numpy as np<br>import sklearn<br>import pandas as pd<br>import os,sys,time<br>import tensorflow as tf<br>from tensorflow import keras<br>def showVersion():</p><div class="code-wrapper"><pre><code class="hljs">print((tf.__version__))print(sys.version_info)for module in mpl, np, pd, sklearn, tf, keras:    print(module.__name__,module.__version__)</code></pre></div><h1 id="class-names-‘T-shirt’-’Trouser’-’Pullover’-’Dress’"><a href="#class-names-‘T-shirt’-’Trouser’-’Pullover’-’Dress’" class="headerlink" title="class_names = [‘T-shirt’,’Trouser’,’Pullover’,’Dress’,"></a>class_names = [‘T-shirt’,’Trouser’,’Pullover’,’Dress’,</h1><h1 id="‘Coat’-‘Sandal’-‘Shirt’-‘Sneaker’"><a href="#‘Coat’-‘Sandal’-‘Shirt’-‘Sneaker’" class="headerlink" title="‘Coat’, ‘Sandal’, ‘Shirt’, ‘Sneaker’,"></a>‘Coat’, ‘Sandal’, ‘Shirt’, ‘Sneaker’,</h1><h1 id="‘Bag’-‘Ankle-boot’"><a href="#‘Bag’-‘Ankle-boot’" class="headerlink" title="‘Bag’, ‘Ankle boot’"></a>‘Bag’, ‘Ankle boot’</h1><h1 id=""><a href="#" class="headerlink" title="]"></a>]</h1><p>fashion_mnist = keras.datasets.fashion_mnist<br>(x_train_all,y_train_all),(x_test,y_test) = fashion_mnist.load_data()<br>x_valid, x_train = x_train_all[:5000], x_train_all[5000:]<br>y_valid, y_train = y_train_all[:5000], y_train_all[5000:]</p><p>from sklearn.preprocessing import StandardScaler<br>scaler = StandardScaler()</p><p>x_train_scaled = scaler.fit_transform(x_train.astype(np.float32).reshape(-1,1)).reshape(-1,28,28,1)<br>x_valid_scaled = scaler.transform(x_valid.astype(np.float32).reshape(-1,1)).reshape(-1,28,28,1)  # 使用训练集的均值,方差<br>x_test_scaled = scaler.transform(x_test.astype(np.float32).reshape(-1,1)).reshape(-1,28,28,1)</p><p>def nn():</p><div class="code-wrapper"><pre><code class="hljs">model = keras.models.Sequential()model.add(keras.layers.Conv2D(filters=32,  # 卷积核数量,                              kernel_size=3,  # 大小                              padding=&quot;same&quot;,  # 是否填充是的输入输出大小一样                              activation=&quot;relu&quot;,  # 使用selu效果会更好                              input_shape=(28,28,1)                            ))model.add(keras.layers.Conv2D(filters=32,kernel_size=3,                              padding=&quot;same&quot;,                              activation=&quot;relu&quot;))model.add(keras.layers.MaxPool2D(pool_size=2))   # 一般步长与大小相同  pool 后的卷积层filter一般会翻倍model.add(keras.layers.Conv2D(filters=64, kernel_size=3,                              padding=&quot;same&quot;,                              activation=&quot;relu&quot;))model.add(keras.layers.Conv2D(filters=64, kernel_size=3,                              padding=&quot;same&quot;,                              activation=&quot;relu&quot;))model.add(keras.layers.MaxPool2D(pool_size=2))model.add(keras.layers.Conv2D(filters=128,kernel_size=3,                              padding=&quot;same&quot;,                              activation=&quot;relu&quot;))model.add(keras.layers.Conv2D(filters=128, kernel_size=3,                              padding=&quot;same&quot;,                              activation=&quot;relu&quot;))model.add(keras.layers.MaxPool2D(pool_size=2))model.add(keras.layers.Flatten())  # 将输入一维化model.add(keras.layers.Dense(128,activation=&quot;relu&quot;))model.add(keras.layers.Dense(10,activation=&quot;softmax&quot;))model.summary()model.compile(loss=&quot;sparse_categorical_crossentropy&quot;,              optimizer = &quot;adam&quot;,              metrics = [&#39;accuracy&#39;])logdir = &quot;cnn-callbacks&quot;if not os.path.exists(logdir):    os.mkdir(logdir)output_model_file = os.path.join(logdir,&quot;fashion_mnist_model.h5&quot;)callbacks = [    keras.callbacks.TensorBoard(logdir),    keras.callbacks.ModelCheckpoint(output_model_file,save_best_only = True),    keras.callbacks.EarlyStopping(patience = 5, min_delta = 1e-3)]history = model.fit(x_train_scaled,y_train,epochs=10,                    validation_data=(x_valid_scaled,y_valid),                    callbacks = callbacks)model.evaluate(x_test_scaled,y_test)  # 验证集验证return history</code></pre></div><p>def plot_learning_curves(history):</p><div class="code-wrapper"><pre><code class="hljs">pd.DataFrame(history.history).plot(figsize=(8,5))plt.grid(True)plt.gca().set_ylim(0,3)plt.show()</code></pre></div><p>if <strong>name</strong> ==”<strong>main</strong>“:</p><div class="code-wrapper"><pre><code class="hljs">history = nn()plot_learning_curves(history)</code></pre></div><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>      <br><br><span class="hljs-number">3</span>. keras实现深度可分离卷积<br><br>   <span class="hljs-number">1</span>.  标准卷积 <br><br>      <span class="hljs-number">1</span>. 卷积核大小(<span class="hljs-variable">$D_k</span>$)<br><br>      <span class="hljs-number">2</span>. 卷积核输入通道数M<br><br>      <span class="hljs-number">3</span>. 卷积核个数N,输出通道N<br><br>      <span class="hljs-number">4</span>. 图像大小$(D_F)$<br><br>         <span class="hljs-variable">$D_k</span>*D_k*M*N*D_F*D_F$<br><br>   <span class="hljs-number">2</span>. 深度可分离卷积<br><br>      (此时的卷积核输入时原图n\*n\*<span class="hljs-number">3</span>,卷积核为k\*k\*<span class="hljs-number">1</span>,为了计算原图所有通道,该卷积核个数就是输入通道数M)<span class="hljs-variable">$D_k</span>*D_k*<span class="hljs-number">1</span>*M*D_F*D_F+<span class="hljs-number">1</span>*<span class="hljs-number">1</span>*M*N*D_F*D_F$ <br><br>      参考:<br><br>      https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/xiewenbo/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">84315560</span><br><br>      https:<span class="hljs-regexp">//</span>blog.csdn.net<span class="hljs-regexp">/qq_21997625/</span>article<span class="hljs-regexp">/details/</span><span class="hljs-number">87106152</span><br><br>   <span class="hljs-number">3</span>. ```python<br>       <span class="hljs-comment"># 代码同上</span><br>       <span class="hljs-comment"># 第一个Conv2D不变</span><br>       <span class="hljs-comment"># 其余的Conv2D修改为SeparableConv2D即可</span><br>       <span class="hljs-comment">#  计算量少</span><br>         <br>      <span class="hljs-comment"># 两层 3*3 视野域就是 一个5*5</span><br>      <br>      <span class="hljs-comment"># 计算量几乎缩小n倍</span><br>      <br>      <span class="hljs-comment"># 深度可分离卷积</span><br>      <br></code></pre></td></tr></table></figure><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173158408-1473862527.png"></p></li></ol></li></ol></li></ol><ol start="4"><li><p>kera实战kaggle</p><ol><li><p>10 monkey,cifar10</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: 1_10_monkey_model.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/23 11:30</span><br><span class="hljs-comment"># desc: keras_generator 搭建模型</span><br><span class="hljs-comment">#    model.fit  将数据放入内存训练</span><br><span class="hljs-comment">#    model.fit_generator   处理大数据,  使用生成器的数据集</span><br><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><br><br>train_dir=<span class="hljs-string">r&quot;I:\人工智能数据\10_monkey\training\training&quot;</span><br>valid_dir=<span class="hljs-string">r&quot;I:\人工智能数据\10_monkey\validation\validation&quot;</span><br>label_txt=<span class="hljs-string">r&quot;I:\人工智能数据\10_monkey\monkey_labels.txt&quot;</span><br><br>labels = pd.read_csv(label_txt,header=<span class="hljs-number">0</span>)<br><br>height = <span class="hljs-number">128</span>  <span class="hljs-comment"># 缩放大小</span><br>width = <span class="hljs-number">128</span><br>channels = <span class="hljs-number">3</span><br>batch_size = <span class="hljs-number">64</span><br>num_classes = <span class="hljs-number">10</span><br><br><span class="hljs-comment"># keras中的数据集:读取数据,数据分享</span><br><br>train_datagen = keras.preprocessing.image.ImageDataGenerator(<br>    rescale = <span class="hljs-number">1.</span>/<span class="hljs-number">255</span>,  <span class="hljs-comment"># 像素点缩放到0-1</span><br>    rotation_range = <span class="hljs-number">40</span>,  <span class="hljs-comment"># 图片增强方式,随机旋转40</span><br>    width_shift_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 偏移</span><br>    height_shift_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment">#</span><br>    shear_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 剪切强度</span><br>    zoom_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 缩放程度</span><br>    horizontal_flip = <span class="hljs-literal">True</span>,  <span class="hljs-comment"># 水平翻转</span><br>    fill_mode = <span class="hljs-string">&quot;nearest&quot;</span>,  <span class="hljs-comment"># 放大时填充像素,选择最近的填充</span><br>)<br><br><span class="hljs-comment"># 读取图片,按照上边方法进行处理</span><br>train_generator = train_datagen.flow_from_directory(train_dir,<br>                                                    target_size=(height,width),<br>                                                    batch_size=batch_size,<br>                                                    seed=<span class="hljs-number">7</span>,  <span class="hljs-comment"># 随机数</span><br>                                                    shuffle=<span class="hljs-literal">True</span>,<br>                                                    class_mode=<span class="hljs-string">&quot;categorical&quot;</span>)  <span class="hljs-comment"># label格式 one-hot</span><br>valid_datagen = keras.preprocessing.image.ImageDataGenerator(rescale=<span class="hljs-number">1.</span>/<span class="hljs-number">255</span>)<br>valid_generator = valid_datagen.flow_from_directory(valid_dir,<br>                                                    target_size=(height,width),<br>                                                    batch_size=batch_size,<br>                                                    seed=<span class="hljs-number">7</span>,<br>                                                    shuffle=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># 不用训练不用打乱</span><br>                                                    class_mode=<span class="hljs-string">&quot;categorical&quot;</span>)<br>train_num = train_generator.samples<br>valid_num = valid_generator.samples<br><span class="hljs-comment"># print(train_num,valid_num) #  1098 272</span><br><span class="hljs-comment"># x,y = train_generator.next()  # (64,128,128,3) (64,10)</span><br><br>model = keras.models.Sequential([<br>    keras.layers.Conv2D(filters=<span class="hljs-number">32</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>,input_shape=(width,height,channels)),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">32</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">64</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">64</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">128</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">128</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Flatten(),<br>    keras.layers.Dense(<span class="hljs-number">128</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Dense(num_classes,activation=<span class="hljs-string">&quot;softmax&quot;</span>)<br>])<br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;categorical_crossentropy&quot;</span>,<br>              optimizer=<span class="hljs-string">&quot;adam&quot;</span>,metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>model.summary()<br><br>epochs = <span class="hljs-number">300</span><br><span class="hljs-comment"># 最后acc 97% 98%</span><br>history = model.fit_generator(train_generator,<br>                              steps_per_epoch= train_num//batch_size,<br>                              epochs = epochs,<br>                              validation_data=valid_generator,<br>                              validation_steps= valid_num//batch_size)<br><span class="hljs-comment"># history.history.keys()  # loss,acc, val_loss,val_acc</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history,label,epochs,min_value,max_value</span>):</span><br>    data=&#123;&#125;<br>    data[label] = history.history[label]<br>    data[<span class="hljs-string">&quot;val_&quot;</span>+label]=history.history[<span class="hljs-string">&quot;val_&quot;</span>+label]<br>    pd.DataFrame(data).plot(figsize=(<span class="hljs-number">8.5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.axis([<span class="hljs-number">0</span>,epochs,min_value,max_value])<br>    plt.show()<br>plot_learning_curves(history,<span class="hljs-string">&quot;acc&quot;</span>,epochs,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>plot_learning_curves(history,<span class="hljs-string">&quot;loss&quot;</span>,epochs,<span class="hljs-number">1.5</span>,<span class="hljs-number">2.5</span>)<br></code></pre></td></tr></table></figure></li><li><p>数据增强(调整数据 提高准确率)与迁移学习</p><ol><li>```python<h1 id="model-部分修改即可"><a href="#model-部分修改即可" class="headerlink" title="model 部分修改即可"></a>model 部分修改即可</h1>resnet50_fine_tune = keras.models.Sequential();<br>resnet50_fine_tune.add(keras.applications.ResNet50(include_top=False,   # 不包含最后一层<div class="code-wrapper"><pre><code class="hljs">                                               pooling = &#39;avg&#39;,                                               weights=&quot;imagenet&quot;))  # None 从头开始,imagenet接着</code></pre></div>resnet50_fine_tune.add(keras.layers.Dense(num_classes,activation=”softmax”))<br>resnet50_fine_tune.layers[0].trainable= False  # 设置第一层的参数不调整<br>“””<br>resnet50 = keras.applications.ResNet50(include_top=False,<div class="code-wrapper"><pre><code class="hljs">                                   pooling=&quot;avg&quot;,                                   weights=&quot;imagenet&quot;)</code></pre></div>resnet50.summary()<br>for layer in resnet50.layers[0:-5]:  # 设置resnet50中后0–5层也不可训练,其余可训练<div class="code-wrapper"><pre><code class="hljs">layer.trainable=False</code></pre></div>resnet50_new = keras.models.Sequential([<div class="code-wrapper"><pre><code class="hljs">resnet50,keras.layers.Dense(num_classes,activation=&quot;softmax&quot;),</code></pre></div>])<br>“””<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><code class="hljs python">      <br>```python<br><span class="hljs-comment"># coding:utf-8</span><br><span class="hljs-comment"># file: 1_cifar10_model.py</span><br><span class="hljs-comment"># author: Dean</span><br><span class="hljs-comment"># contact: 1028968939@qq.com</span><br><span class="hljs-comment"># time: 2019/12/23 11:30</span><br><span class="hljs-comment"># desc:</span><br><span class="hljs-keyword">import</span> matplotlib <span class="hljs-keyword">as</span> mpl<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> sklearn<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> os,sys,time<br><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf<br><span class="hljs-keyword">from</span> tensorflow <span class="hljs-keyword">import</span> keras<br><span class="hljs-comment"># data https://www.kaggle.com/c/cifar-10/data</span><br>class_names = [<br>    <span class="hljs-string">&#x27;airplane&#x27;</span>,<br>    <span class="hljs-string">&#x27;automobile&#x27;</span>,<br>    <span class="hljs-string">&#x27;bird&#x27;</span>,<br>    <span class="hljs-string">&#x27;cat&#x27;</span>,<br>    <span class="hljs-string">&#x27;deer&#x27;</span>,<br>    <span class="hljs-string">&#x27;dog&#x27;</span>,<br>    <span class="hljs-string">&#x27;frog&#x27;</span>,<br>    <span class="hljs-string">&#x27;horse&#x27;</span>,<br>    <span class="hljs-string">&#x27;ship&#x27;</span>,<br>    <span class="hljs-string">&#x27;truck&#x27;</span><br>]<br>train_lables_file = <span class="hljs-string">r&#x27;I:\人工智能数据\cifar10\trainLabels.csv&#x27;</span><br>test_csv_file = <span class="hljs-string">r&#x27;I:\人工智能数据\cifar10\sampleSubmission.csv&#x27;</span><br>train_folder = <span class="hljs-string">r&#x27;I:\人工智能数据\cifar10\train&#x27;</span><br>test_floder = <span class="hljs-string">r&#x27;I:\人工智能数据\cifar10\test&#x27;</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_csv_file</span>(<span class="hljs-params">filepath,folder</span>):</span><br>    <span class="hljs-string">&quot;&quot;&quot;Paeses csv files into (filename(path),label) format  (xxx.png,&#x27;cat&#x27;)&quot;&quot;&quot;</span><br>    results =[]<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filepath,<span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        lines = f.readlines()[<span class="hljs-number">1</span>:]  <span class="hljs-comment"># 去掉header</span><br>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>            image_id,label_str = line.strip(<span class="hljs-string">&quot;\n&quot;</span>).split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>            image_full_path = os.path.join(folder,image_id+<span class="hljs-string">&quot;.png&quot;</span>)<br>            results.append((image_full_path,label_str))<br>    <span class="hljs-keyword">return</span> results<br>train_lables_info = parse_csv_file(train_lables_file,train_folder)  <span class="hljs-comment"># 50000</span><br>test_csv_info = parse_csv_file(test_csv_file,test_floder)  <span class="hljs-comment"># 300000</span><br><br><span class="hljs-comment"># 制作dataframe</span><br><span class="hljs-comment"># train_df = pd.DataFrame(train_lables_info)</span><br>train_df = pd.DataFrame(train_lables_info[<span class="hljs-number">0</span>:<span class="hljs-number">45000</span>])<br>valid_df = pd.DataFrame(train_lables_info[<span class="hljs-number">45000</span>:])<br>test_df = pd.DataFrame(test_csv_info)<br><br><span class="hljs-comment"># 设置dataframe的列名</span><br>train_df.columns = [<span class="hljs-string">&quot;filepath&quot;</span>,<span class="hljs-string">&#x27;class&#x27;</span>]<br>valid_df.columns = [<span class="hljs-string">&quot;filepath&quot;</span>,<span class="hljs-string">&#x27;class&#x27;</span>]<br>test_df.columns = [<span class="hljs-string">&quot;filepath&quot;</span>,<span class="hljs-string">&#x27;class&#x27;</span>]<br><br><br>height = <span class="hljs-number">32</span>  <span class="hljs-comment"># 缩放大小</span><br>width = <span class="hljs-number">32</span><br>channels = <span class="hljs-number">3</span><br>batch_size = <span class="hljs-number">32</span><br>num_classes = <span class="hljs-number">10</span><br><br><span class="hljs-comment"># keras中的数据集:读取数据,数据分享</span><br><br>train_datagen = keras.preprocessing.image.ImageDataGenerator(<br>    rescale = <span class="hljs-number">1.</span>/<span class="hljs-number">255</span>,  <span class="hljs-comment"># 像素点缩放到0-1</span><br>    rotation_range = <span class="hljs-number">40</span>,  <span class="hljs-comment"># 图片增强方式,随机旋转40</span><br>    width_shift_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 偏移</span><br>    height_shift_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment">#</span><br>    shear_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 剪切强度</span><br>    zoom_range = <span class="hljs-number">0.2</span>,  <span class="hljs-comment"># 缩放程度</span><br>    horizontal_flip = <span class="hljs-literal">True</span>,  <span class="hljs-comment"># 水平翻转</span><br>    fill_mode = <span class="hljs-string">&quot;nearest&quot;</span>,  <span class="hljs-comment"># 放大时填充像素,选择最近的填充</span><br>)<br><br><span class="hljs-comment"># 读取图片,按照上边方法进行处理</span><br>train_generator = train_datagen.flow_from_dataframe(<br>    train_df,<br>    directory=<span class="hljs-string">&quot;./&quot;</span>,<br>    x_col=<span class="hljs-string">&quot;filepath&quot;</span>,<br>    y_col=<span class="hljs-string">&quot;class&quot;</span>,<br>    classes=class_names,<br>    target_size=(height, width),<br>    batch_size=batch_size,<br>    seed=<span class="hljs-number">7</span>,<br>    shuffle=<span class="hljs-literal">True</span>,<br>    class_mode=<span class="hljs-string">&quot;sparse&quot;</span><br>)<br>valid_datagen = keras.preprocessing.image.ImageDataGenerator(rescale=<span class="hljs-number">1.</span>/<span class="hljs-number">255</span>)<br>valid_generator = valid_datagen.flow_from_dataframe(valid_df,<br>                                                    directory=<span class="hljs-string">&quot;./&quot;</span>,<br>                                                    x_col=<span class="hljs-string">&quot;filepath&quot;</span>,<br>                                                    y_col=<span class="hljs-string">&quot;class&quot;</span>,<br>                                                    classes=class_names,<br>                                                    target_size=(height,width),<br>                                                    batch_size=batch_size,<br>                                                    seed=<span class="hljs-number">7</span>,<br>                                                    shuffle=<span class="hljs-literal">False</span>,<br>                                                    class_mode=<span class="hljs-string">&quot;sparse&quot;</span>)<br>train_num = train_generator.samples<br>valid_num = valid_generator.samples<br><span class="hljs-comment"># print(train_num,valid_num) #  1098 272</span><br><span class="hljs-comment"># x,y = train_generator.next()  # (64,128,128,3) (64,10)</span><br><br>model = keras.models.Sequential([<br>    keras.layers.Conv2D(filters=<span class="hljs-number">128</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>,input_shape=(width,height,channels)),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">128</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">256</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">256</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">512</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.Conv2D(filters=<span class="hljs-number">512</span>,kernel_size=<span class="hljs-number">3</span>,padding=<span class="hljs-string">&quot;same&quot;</span>,<br>                        activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.BatchNormalization(),<br>    keras.layers.MaxPool2D(pool_size=<span class="hljs-number">2</span>),<br>    keras.layers.Flatten(),<br>    keras.layers.Dense(<span class="hljs-number">512</span>,activation=<span class="hljs-string">&quot;relu&quot;</span>),<br>    keras.layers.Dense(num_classes,activation=<span class="hljs-string">&quot;softmax&quot;</span>)<br>])<br>model.<span class="hljs-built_in">compile</span>(loss=<span class="hljs-string">&quot;sparse_categorical_crossentropy&quot;</span>,<br>              optimizer=<span class="hljs-string">&quot;adam&quot;</span>,metrics=[<span class="hljs-string">&#x27;accuracy&#x27;</span>])<br>model.summary()<br><br>epochs = <span class="hljs-number">1</span><br>history = model.fit_generator(train_generator,<br>                              steps_per_epoch= train_num//batch_size,<br>                              epochs = epochs,<br>                              validation_data=valid_generator,<br>                              validation_steps= valid_num//batch_size)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">plot_learning_curves</span>(<span class="hljs-params">history,label,epochs,min_value,max_value</span>):</span><br>    data=&#123;&#125;<br>    data[label] = history.history[label]<br>    data[<span class="hljs-string">&quot;val_&quot;</span>+label]=history.history[<span class="hljs-string">&quot;val_&quot;</span>+label]<br>    pd.DataFrame(data).plot(figsize=(<span class="hljs-number">8.5</span>))<br>    plt.grid(<span class="hljs-literal">True</span>)<br>    plt.axis([<span class="hljs-number">0</span>,epochs,min_value,max_value])<br>    plt.show()<br>plot_learning_curves(history,<span class="hljs-string">&quot;acc&quot;</span>,epochs,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)<br>plot_learning_curves(history,<span class="hljs-string">&quot;loss&quot;</span>,epochs,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><h1 id="循环神经网络"><a href="#循环神经网络" class="headerlink" title="循环神经网络"></a>循环神经网络</h1><ol><li>Tf框架:LSTM实现</li><li>项目:文本分类,文本生成,Kaggle文本分类</li><li>理论:序列式问题,循环网络,LSTM,双向LSTM</li></ol></li><li><h1 id="Tensorflow分布式"><a href="#Tensorflow分布式" class="headerlink" title="Tensorflow分布式"></a>Tensorflow分布式</h1><ol><li><h3 id="理论部分"><a href="#理论部分" class="headerlink" title="理论部分"></a>理论部分</h3><ol><li>GPU设置<ol><li>默认用全部GPU并占满内存</li><li>如何不浪费内存和计算资源<ol><li>内存增长</li><li>虚拟设备机制</li></ol></li><li>多GPU<ol><li>虚拟GPU&amp;实际GPU</li><li>手工设置&amp;分布式机制</li></ol></li><li>API<ol><li>tfdebugging.set_log_device_placement</li><li>tf.config.experimental.set_visible_devices  设置可见设备</li><li>tf.config.experimental.list_logical_devices  获取逻辑设备</li><li>tf.config.experimental.list_physical_devices  获取物理设备</li><li>tf.config.experimental.set_memory——growth 设置内存自增</li><li>tf.config.experimental.VirtualDeviceConfiguration 建立逻辑设备</li><li>tf.config.set_soft_device_placement 自动分配任务到设备</li></ol></li></ol></li><li>分布式策略</li></ol></li><li><h3 id="实战部分"><a href="#实战部分" class="headerlink" title="实战部分"></a>实战部分</h3><ol><li>GPU设置部分</li><li>分布式训练</li></ol></li></ol></li><li><h1 id="Tensorflow模型保存于部署"><a href="#Tensorflow模型保存于部署" class="headerlink" title="Tensorflow模型保存于部署"></a>Tensorflow模型保存于部署</h1><ol><li><p>Tf框架:模型保存,导出tflite,部署</p></li><li><p>项目:图像分类</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173240250-502999884.png"></p></li></ol></li></ol><div class="code-wrapper"><pre><code class="hljs">  ![](https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173249312-1525127491.png)</code></pre></div><ol start="3"><li><h3 id="模型保存"><a href="#模型保存" class="headerlink" title="模型保存"></a>模型保存</h3><ol><li><h4 id="文件格式"><a href="#文件格式" class="headerlink" title="文件格式"></a>文件格式</h4><ol><li>Ckeckpoint与graphdef (tf1.0)</li><li>keras(hdf5),SavedModel(tf2.0)(参数+网络结构)</li></ol></li><li><h4 id="保存的是什么"><a href="#保存的是什么" class="headerlink" title="保存的是什么"></a>保存的是什么</h4><ol><li>参数</li><li>参数+网络结构</li></ol></li><li><h4 id="TFLite"><a href="#TFLite" class="headerlink" title="TFLite"></a>TFLite</h4><ol><li>TFLite Converter<ol><li>模型转化  将上边的三种模型转化为tflite</li></ol></li><li>TFLite Interpreter<ol><li>模型加载</li><li>支持android与ios</li><li>支持多种语言</li></ol></li><li>TFLite-FlatBuffer<ol><li>google开源的跨平台数据序列化库</li><li>优点<ol><li>直接读取序列化数据</li><li>高效内存使用和速度</li><li>灵活,数据前后向兼容,灵活控制数据结构</li><li>代码少</li><li>强类型数据</li></ol></li></ol></li><li>TFlite-量化<ol><li>参数从float变为8bit整数<ol><li>准确率损失</li><li>模型大小变为1/4</li></ol></li><li>量化方法<ol><li>float=(int-归零点)*因子</li></ol></li></ol></li></ol></li><li><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191223173305270-1255044464.png"></p></li></ol></li></ol><div class="code-wrapper"><pre><code class="hljs">     1. keras-保存参数与保存模型+参数        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs python">keras.callbacks.ModelCheckpoint(out_put_dir,<br>                               save_best_only=<span class="hljs-literal">True</span>,<br>                               save_weights_only=<span class="hljs-literal">False</span>) <span class="hljs-comment"># 为false表示只保存参数,True表示都保存</span><br>keras.models.load_model(out_put_dir) <span class="hljs-comment"># 若都保存了,从新加载后和可直接使用</span><br></code></pre></td></tr></table></figure>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 定义模型之后,导入weights 可使用</span><br></code></pre></td></tr></table></figure>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 也可保存权重</span><br>model.save_weights(<span class="hljs-string">&quot;xxxx/xxx.h5&quot;</span>) <br></code></pre></td></tr></table></figure>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">tf.saved_model.save(model,<span class="hljs-string">&quot;.../xxx_garph&quot;</span>)<br><span class="hljs-comment"># assets</span><br><span class="hljs-comment"># variables checkpoint 信息</span><br><span class="hljs-comment"># saved_model.pb </span><br></code></pre></td></tr></table></figure>        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 命令行工具查看model信息</span><br>!saved_model_cli show --<span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;path&quot;</span> --<span class="hljs-built_in">all</span><br><span class="hljs-comment"># 载入model</span><br>model = tf.saved_model.load(<span class="hljs-string">&quot;path&quot;</span>)<br>inference = model.signatures[<span class="hljs-string">&quot;serving_default&quot;</span>]<br>results = inference(tf.constant(x_test_scaled[<span class="hljs-number">0</span>:<span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure>             2. keras签名函数保存到SavedModel        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">tf_export =tf.Model()<br>tf_export.cube = 签名函数<br>tf.saved_model.save(tf._export,<span class="hljs-built_in">dir</span>)<br></code></pre></td></tr></table></figure>     3. keras,SavedModel,签名函数到具体函数        <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">load_saved_model=keras.models.load_model(<span class="hljs-string">&quot;.../...h5&quot;</span>)<br>load_saved_model(np.zeros([<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>]))<br><br>run_model = tf.function(<span class="hljs-keyword">lambda</span> x:load_saved_model(x))<br>keras_concrete_function = run_model.get_concrete_function(<br>    tf.TensorSpec(<br>    load_keras_model.inputs[<span class="hljs-number">0</span>].shape,<br>        load_keras_model.inputs[<span class="hljs-number">0</span>].dtype<br>    ))<br><span class="hljs-comment"># 测试</span><br>keras_concrete_function(tf.constant(np.zeros(<span class="hljs-number">1</span>,<span class="hljs-number">28</span>,<span class="hljs-number">28</span>,dtype=np.float32)))<br></code></pre></td></tr></table></figure>     4. keras,SavedModel,具体函数到tflite     5. tflite量化     6. tensorflow js.android部署</code></pre><ol start="10"><li><h1 id="机器翻译于tensorflow2tensor使用"><a href="#机器翻译于tensorflow2tensor使用" class="headerlink" title="机器翻译于tensorflow2tensor使用"></a>机器翻译于tensorflow2tensor使用</h1><ol><li>Tf框架:transformer实现,tensor2tensor使用</li><li>项目:机器翻译</li><li>理论:序列道序列模型.注意力机制,可缩放点积注意力,多头注意力</li></ol></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Tensorflow2.0-%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/01/16/cnblog/Tensorflow2.0-%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="数据载体"><a href="#数据载体" class="headerlink" title="数据载体"></a>数据载体</h1><table><thead><tr><th>python：list，列表</th><th>numpy：ndarray</th><th>tensorflow：tensor，多维数组</th></tr></thead><tbody><tr><td>可使用不同数据类型，可嵌套<br>不连续存放，<br>动态指针数组 效率低，占空间大 <br>由于高度灵活性，不适合做数值计算</td><td>数据类型相同<br>每个元素占空间相同，连续存储<br>占空间小，读写速度快<br>占用的是内存，只能在cup运算</td><td>可运行于gpu，tpu<br>支持多种计算环境<br>高速实现复杂算法</td></tr></tbody></table><h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><ul><li><p>tensorflow张量就是多维数组，不管是多少维的，都是张量</p></li><li><p>tensorflow数字默认类型：tf.int32,tf.float32,不同类型不能操作</p></li><li><p>numpy默认的小数是float64，</p></li></ul><p>转换数据类型时：低–&gt;高,防止数据溢出</p><p>整数转bool，0F，非零T</p><h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><ul><li><p>```python<br>a = tf.convert_to_tensor(numpy数据) # 将numpy数组转为tensor</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs autohotkey"><br>- ```python<br>  tf.is_tensor(a) #检查是否是张量 <br></code></pre></td></tr></table></figure></li><li><p>```python<br>isinstance(a,tf.Tensor)<br>isinstance(a,numpy.ndarray)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-comment"># 特殊张量</span><br><br>![image-<span class="hljs-number">20200608121339812</span>](https:<span class="hljs-regexp">//i</span>.loli.net<span class="hljs-regexp">/2020/</span><span class="hljs-number">06</span><span class="hljs-regexp">/08/</span>SCKwja9AEsr7zgf.png)<br><br>```python<br>tf.zeros(shape,dtype) <span class="hljs-comment"># 全0张量，默认是float32</span><br>tf.ones()<br></code></pre></td></tr></table></figure></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">tf.fill(shape,value) <span class="hljs-comment"># 自动判断数据类型，填充相同数字</span><br>tf.constant(<span class="hljs-number">9</span>,[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]) <span class="hljs-comment"># 也可以</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">tf.random.normal(shape,mean,stddev,dtype) <span class="hljs-comment"># 正态随机分布，默认均值为0，标准差为1，float32</span><br>tf.random.truncated_normal(shape,mean,stddev,dtype)<br><span class="hljs-comment"># 截断的正态分布，截断标准是2倍标准差，值不会偏离均值2倍标准差</span><br>tf.random.uniform(shape,<span class="hljs-built_in">min</span>,<span class="hljs-built_in">max</span>,,<span class="hljs-built_in">type</span>) <span class="hljs-comment"># 均匀分布，不包含最大，包括最小</span><br>tf.random.shuffle(x) <span class="hljs-comment"># 沿着第一维打乱</span><br>tf.random.set_seed(<span class="hljs-number">8</span>) <span class="hljs-comment"># 设置随机种子，仅仅一次有效</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">tf.<span class="hljs-built_in">range</span>(start,limit,delta,dtype)<span class="hljs-comment"># 创建序列，前闭后开，默认从0开始，步长为1</span><br></code></pre></td></tr></table></figure><h1 id="张量属性"><a href="#张量属性" class="headerlink" title="张量属性"></a>张量属性</h1><ul><li>ndim：维度</li><li>dtype：类型</li><li>shape：形状</li><li>tf.shape(a):张量形式返回形状</li><li>tf.size(a):总数</li><li>tf.rank(a):维度</li></ul><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><ul><li>在cup中张量与numpy共享内存，只是使用不同方式读取使用它</li><li>多维张量内存中是一位数组连续存储</li></ul><h1 id="改变形状"><a href="#改变形状" class="headerlink" title="改变形状"></a>改变形状</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">b = tf.reshape(tensor,shape)<br></code></pre></td></tr></table></figure><p>轴也可以是负数，表示从后向前</p><p><img src="https://i.loli.net/2020/06/08/nzsRIO9C2rijelm.png" alt="image-20200608123050283"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">tf.expand_dims(<span class="hljs-built_in">input</span>,axis) <span class="hljs-comment"># 增加维度，维度长度为1</span><br>a = tf.constant([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]) <span class="hljs-comment"># shape(2,)</span><br>b = tf.expand_dims(a,<span class="hljs-number">1</span>) <span class="hljs-comment"># shape(2,1) 元素数不变形状变了而已</span><br>c = tf.expand_dims(a,<span class="hljs-number">0</span>) <span class="hljs-comment"># shape(1,2)</span><br><br>a = tf.<span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>)<br>b = tf.reshape(a,[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>b1 = tf.expand_dims(b,<span class="hljs-number">0</span>) <span class="hljs-comment"># shape(1.2,3,4)</span><br>b1 = tf.expand_dims(b,<span class="hljs-number">1</span>) <span class="hljs-comment"># shape(2,1,3,4)</span><br>b1 = tf.expand_dims(b,<span class="hljs-number">2</span>) <span class="hljs-comment"># shape(2,3,1,4)</span><br>b1 = tf.expand_dims(b,<span class="hljs-number">3</span>) <span class="hljs-comment"># shape(2,3,4,1)</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 删除维度 只能删除长度为1的维度,并不会改变数量，只是改变了存储</span><br>tf.squeeze(<span class="hljs-built_in">input</span>,axis)<br><br>a = tf.<span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>)<br>b = tf.reshape(a,[<span class="hljs-number">2</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>])<br>tf.squeeze(t) <span class="hljs-comment">#shape-&gt;(2,3,4)</span><br>tf.squeeze(t,[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>]) <span class="hljs-comment"># shape-&gt;(1,3,4)</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#交换维度,改变了视图，也改变了存储顺序</span><br>tf.transpose(a,perm)  <span class="hljs-comment"># 对于二维张量，默认是转置</span><br><span class="hljs-comment"># x.shape--&gt;(2,3)</span><br>tf.transpose(x,[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]) <span class="hljs-comment"># shape-&gt;(3,2)</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 拼接,不会增加维度</span><br>tf.concat(tensor,axis) <span class="hljs-comment">#</span><br><span class="hljs-comment"># 分割张量</span><br>tf.split(value,num_or_size,axis=<span class="hljs-number">0</span>)<br><span class="hljs-comment"># num_or_size:2 表示平均切位2个</span><br><span class="hljs-comment"># [1:2:1] ,按比例切割</span><br><br><span class="hljs-comment"># 只改变视图，存储顺序不变</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 堆叠与分解</span><br>tf.stack(values,axis) <span class="hljs-comment"># </span><br>a = tf.constant([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])<br>b = tf.constant([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])<br>tf.stack((x,y),axis=<span class="hljs-number">0</span>) <span class="hljs-comment"># shape(2,3)</span><br>tf.stack((x,y),axis=<span class="hljs-number">1</span>) <span class="hljs-comment"># shape(3,2)</span><br><br><br><br>tf.unstack(values,axis)<br>a = tf.constant([[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]])<br>tf.stack(a,axis=<span class="hljs-number">0</span>) <span class="hljs-comment"># shape(3,) 2个</span><br>tf.stack(a,axis=<span class="hljs-number">1</span>) <span class="hljs-comment"># shape(2,) 3个</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 索引</span><br><span class="hljs-comment"># 与numpy几乎相同</span><br><span class="hljs-comment"># 一维:a[1],二维:a[1][1],a[1,1],三维:a[1][1][1],a[1,1,1]</span><br><br><span class="hljs-comment"># 切片[起始:结束:步长]，步长为负数表示反向切片</span><br><span class="hljs-comment"># 前闭后开，起始，结束，步长可省略</span><br><span class="hljs-comment"># 二维数据，与一维类似，逗号隔开</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 数据提取</span><br>tf.gather(params,indices)<br>a = tf.<span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)<br>tf.gather(a,[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]) <span class="hljs-comment"># 从a中提取0,2,3下标的元素</span><br><br>a = tf.random.normal([<span class="hljs-number">4</span>,<span class="hljs-number">5</span>])<br>tf.gather(a,axis=<span class="hljs-number">0</span>,[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]) <span class="hljs-comment"># 去获取0 2 3行</span><br>tf.gather(a,axis=<span class="hljs-number">1</span>,[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]) <span class="hljs-comment"># 去获取0 2 3列</span><br><span class="hljs-comment"># 每次只有一个维度</span><br><span class="hljs-comment"># 多维获取</span><br>tf.gather_nd(b,[[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]]) <span class="hljs-comment"># 指定每个元素坐标</span><br>tf.gather_nd(三维元素,[[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]]) <span class="hljs-comment"># 指定每个元素坐标，此时采样的是三个点，每个点三个通道</span><br>tf.gather_nd(三维元素,[[<span class="hljs-number">0</span>],[<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>]]) <span class="hljs-comment"># 类似获取三个面</span><br></code></pre></td></tr></table></figure><h1 id="深度学习"><a href="#深度学习" class="headerlink" title="深度学习"></a>深度学习</h1><h2 id="一元线性回归"><a href="#一元线性回归" class="headerlink" title="一元线性回归"></a>一元线性回归</h2><ul><li><p>平均损失函数：$Loss=\frac{1}{2}\mathop{\sum}\limits_{i=1}^{n}(y_i-\bar{y_i})^2=\frac{1}{2}\mathop{\sum}\limits_{i=1}^{n}(y_i-(wx_i+b))^2$</p></li><li><p>均方误差：$Loss=\frac{1}{2n}\mathop{\sum}\limits_{i=1}^{n}(y_i-\bar{y_i})^2$</p><ul><li>$\frac{1}{2}$是为了求导方便，</li><li>使用平方做误差，防止正负误差抵消</li><li>此时Loss与误差单调性相同</li></ul></li></ul><p><font color=red>基于均方误差最小化求解模型的方法：最小二乘法</font></p><p>w,b作为自变量，取何值时，Loss最小？，求极值问题：极值点偏导数为0</p><p>$\frac{\partial Loss}{\partial w}=\mathop{\sum}\limits_{i=1}^{n}(y_i-b-w_i)(-x_i)=0$</p><p>$\frac{\partial Loss}{\partial b}=\mathop{\sum}\limits_{i=1}^{n}(y_i-b-w_i)(-1)=0$</p><p><img src="https://i.loli.net/2020/06/08/Anwqu3zslP6DCpg.png" alt="image-20200608142106038"></p><h2 id="梯度下降"><a href="#梯度下降" class="headerlink" title="梯度下降"></a>梯度下降</h2><ul><li>解析解：严格推导得出，任意精度满足方程</li><li>数值解：近似计算得到，给定精度下满足方程</li></ul><p><img src="https://i.loli.net/2020/06/08/ezPho6tDSGOnkXB.png" alt="image-20200608143534763"></p><p>$步长=\eta \frac{df(x)}{dx},\eta:学习率$</p><p>$x^{(k+1)}=x^k-步长$</p><ul><li>根据斜率实现自适应调整步长</li><li>自动确定下一次方向</li><li>保证收敛性</li></ul><p>二元凸函数类似：</p><p><img src="https://i.loli.net/2020/06/08/y4hFtG9W3b8v7YJ.png" alt="image-20200608144115993"></p><p>梯度：$\vec{gard}f(x,y)=\frac{\partial f(x,y)}{\partial x}\vec{i}+\frac{\partial f(x,y)}{\partial y}\vec{j}$</p><p>只要损失函数是凸函数，就可以使用梯度下降法，最快速度更新w，得到极值点，</p><p><font color=red>凹凸性定义国内外方式不同，很可能相反</font></p><p><img src="https://i.loli.net/2020/06/08/aEzyjgQn1epsZJl.png" alt="image-20200608145907632"></p><p><img src="https://i.loli.net/2020/06/08/wEqa54FeYJ1fNK3.png" alt="image-20200608145923365"></p><p><img src="https://i.loli.net/2020/06/08/Dod1EKMsyW2PTYR.png" alt="image-20200608150020916"></p><p><img src="https://i.loli.net/2020/06/08/Z8XOxvL9FcAfH4S.png" alt="image-20200608150238087"></p><p>对于凸函数，只要学习率足够小，可以一定收敛，但极大会震荡，极小会很难收敛</p><p>超参数：开始先定义的</p><h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>x = np.array([<span class="hljs-number">137.97</span>,<span class="hljs-number">104.50</span>,<span class="hljs-number">100.00</span>,<span class="hljs-number">124.32</span>,<span class="hljs-number">79.20</span>,<span class="hljs-number">99.00</span>,<span class="hljs-number">124.00</span>,<span class="hljs-number">114.00</span>,<span class="hljs-number">106.69</span>,<span class="hljs-number">138.05</span>,<span class="hljs-number">53.75</span>,<span class="hljs-number">46.91</span>,<span class="hljs-number">68.00</span>,<span class="hljs-number">63.02</span>,<span class="hljs-number">81.26</span>,<span class="hljs-number">86.21</span>])<br>y = np.array([<span class="hljs-number">145.00</span>,<span class="hljs-number">110.00</span>,<span class="hljs-number">93.00</span>,<span class="hljs-number">116.00</span>,<span class="hljs-number">65.32</span>,<span class="hljs-number">104.00</span>,<span class="hljs-number">118.00</span>,<span class="hljs-number">91.00</span>,<span class="hljs-number">62.00</span>,<span class="hljs-number">133.00</span>,<span class="hljs-number">51.00</span>,<span class="hljs-number">45.00</span>,<span class="hljs-number">78.50</span>,<span class="hljs-number">69.65</span>,<span class="hljs-number">75.69</span>,<span class="hljs-number">95.30</span>])<br><br>learning_rate=<span class="hljs-number">0.00001</span><br><span class="hljs-built_in">iter</span>=<span class="hljs-number">100</span><br>display_step=<span class="hljs-number">10</span><br><br>mse=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-built_in">iter</span>+<span class="hljs-number">1</span>):<br>    <span class="hljs-comment"># 计算偏导数，根据导数公式带入数据即可</span><br>    dL_dw=np.mean(x*(w*x+b-y))<br>    dL_db=np.mean(w*x+b-y)<br>    <br>    w=w-learning_rate*dL_dw<br>    b=b-learning_rate*dL_db<br>    <br>    pred=w*x+b<br>    Loss=np.mean(np.square(y-pred))/<span class="hljs-number">2</span><br>    mse.append(Loss)<br>    <span class="hljs-keyword">if</span> i %display_step==<span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;i:%i,Loss:%f,w:%f,b:%f&quot;</span>%(i,mse[i],w,b))<br>        <br>     plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>]=[<span class="hljs-string">&#x27;SimHei&#x27;</span>]<br>plt.figure()<br>plt.scatter(x,y,color=<span class="hljs-string">&#x27;red&#x27;</span>,label=<span class="hljs-string">&quot;销售记录&quot;</span>)<br>plt.scatter(x,pred,color=<span class="hljs-string">&quot;blue&quot;</span>,label=<span class="hljs-string">&quot;梯度下降法&quot;</span>)<br>plt.plot(x,pred,color=<span class="hljs-string">&quot;blue&quot;</span>)<br>plt.plot(x,<span class="hljs-number">0.89</span>*x+<span class="hljs-number">5.41</span>,color=<span class="hljs-string">&quot;red&quot;</span>)<br><br>plt.xlabel(<span class="hljs-string">&quot;Area&quot;</span>,fontsize=<span class="hljs-number">14</span>)<br>plt.ylabel(<span class="hljs-string">&quot;Price&quot;</span>,fontsize=<span class="hljs-number">14</span>)<br>plt.legend(loc=<span class="hljs-string">&quot;upper left&quot;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/06/08/bXBMWdFjD3gOelN.png" alt="image-20200608154745250"></p><h3 id="多元例子"><a href="#多元例子" class="headerlink" title="多元例子"></a>多元例子</h3><p>数据归一化/标准化：将数值限制在范围内，防止某个属性影响过大</p><p>线性归一化：$x*=\frac{x-min}{max-min}$等比例缩放[0,1]</p><p>标准归一化：$x*=\frac{x-\mu}{\sigma}$,归一化均值为0，方差为1，</p><p>非线性归一化:对数，指数，正切</p><p>根据数据确定</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">dL_dw=np.matmul(np.transpose(X),np.matmul(X,W)-Y)<br>W=W-lrarning_rate*dL_dW<br>pred =np.matmul(X,W)<br></code></pre></td></tr></table></figure><h3 id="自动求导"><a href="#自动求导" class="headerlink" title="自动求导"></a>自动求导</h3><p>tf.Variavle()可训练变量，可修改，有assign(),assgin_add()等，x.trainable属性等</p><p>tf.constant不同，是不可修改的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> GradienTape(persistent=<span class="hljs-literal">True</span>,watch_access_variables=Flase) <span class="hljs-keyword">as</span> tape:<br>    tape.watch(x)<br>    y=tf.square(x)<br>grad=tape.gradient(<span class="hljs-string">&#x27;函数&#x27;</span>,<span class="hljs-string">&#x27;自变量&#x27;</span>) <span class="hljs-comment"># </span><br><span class="hljs-comment"># persistent 为true可多次调用gradient</span><br><span class="hljs-comment"># 为True时最后要 del tape</span><br><span class="hljs-comment"># watch默认为True，为False时需要手动watch变量</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/06/08/8ePZDLKbl42vkzV.png" alt="image-20200608174933672"></p><p><img src="https://i.loli.net/2020/06/08/aJSx1gWf7iZ5cVw.png" alt="image-20200608175043042"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/tensorflow2.0%20%E8%AF%84%E4%BC%B0%E5%87%BD%E6%95%B0/"/>
    <url>/2022/01/16/cnblog/tensorflow2.0%20%E8%AF%84%E4%BC%B0%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h3><strong>一，常用的内置评估指标</strong></h3><ul><li><p>MeanSquaredError（平方差误差，用于回归，可以简写为MSE，函数形式为mse）</p></li><li><p>MeanAbsoluteError (绝对值误差，用于回归，可以简写为MAE，函数形式为mae)</p></li><li><p>MeanAbsolutePercentageError (平均百分比误差，用于回归，可以简写为MAPE，函数形式为mape)</p></li><li><p>RootMeanSquaredError (均方根误差，用于回归)</p></li><li><p>Accuracy (准确率，用于分类，可以用字符串"Accuracy"表示，Accuracy=(TP+TN)/(TP+TN+FP+FN)，要求y_true和y_pred都为类别序号编码)</p></li><li><p>Precision (精确率，用于二分类，Precision = TP/(TP+FP))</p></li><li><p>Recall (召回率，用于二分类，Recall = TP/(TP+FN))</p></li><li><p>TruePositives (真正例，用于二分类)</p></li><li><p>TrueNegatives (真负例，用于二分类)</p></li><li><p>FalsePositives (假正例，用于二分类)</p></li><li><p>FalseNegatives (假负例，用于二分类)</p></li><li><p>AUC(ROC曲线(TPR vs FPR)下的面积，用于二分类，直观解释为随机抽取一个正样本和一个负样本，正样本的预测值大于负样本的概率)</p></li><li><p>CategoricalAccuracy（分类准确率，与Accuracy含义相同，要求y_true(label)为onehot编码形式）</p></li><li><p>SparseCategoricalAccuracy (稀疏分类准确率，与Accuracy含义相同，要求y_true(label)为序号编码形式)</p></li><li><p>MeanIoU (Intersection-Over-Union，常用于图像分割)</p></li><li><p>TopKCategoricalAccuracy (多分类TopK准确率，要求y_true(label)为onehot编码形式)</p></li><li><p>SparseTopKCategoricalAccuracy (稀疏多分类TopK准确率，要求y_true(label)为序号编码形式)</p></li><li><p>Mean (平均值)</p></li><li><p>Sum (求和)</p></li><li><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/metrics">https://tensorflow.google.cn/api_docs/python/tf/keras/metrics</a></li></ul><h3><strong>二，</strong>自定义品函数及使用</h3><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;">import numpy as npimport pandas as pdimport tensorflow as tffrom tensorflow.keras import layers,models,losses,metrics <h1 id="函数形式的自定义评估指标"><a href="#函数形式的自定义评估指标" class="headerlink" title="函数形式的自定义评估指标"></a>函数形式的自定义评估指标</h1><p>@tf.function<br>def ks(y_true,y_pred):<br>    y_true = tf.reshape(y_true,(-1,))<br>    y_pred = tf.reshape(y_pred,(-1,))<br>    length = tf.shape(y_true)[0]<br>    t = tf.math.top_k(y_pred,k = length,sorted = False)<br>    y_pred_sorted = tf.gather(y_pred,t.indices)<br>    y_true_sorted = tf.gather(y_true,t.indices)<br>    cum_positive_ratio = tf.truediv(<br>        tf.cumsum(y_true_sorted),tf.reduce_sum(y_true_sorted))<br>    cum_negative_ratio = tf.truediv(<br>        tf.cumsum(1 - y_true_sorted),tf.reduce_sum(1 - y_true_sorted))<br>    ks_value = tf.reduce_max(tf.abs(cum_positive_ratio - cum_negative_ratio))<br>    return ks_value<br>y_true = tf.constant([[1],[1],[1],[0],[1],[1],[1],[0],[0],[0],[1],[0],[1],[0]])<br>y_pred = tf.constant([[0.6],[0.1],[0.4],[0.5],[0.7],[0.7],[0.7],<br>                      [0.4],[0.4],[0.5],[0.8],[0.3],[0.5],[0.3]])<br>tf.print(ks(y_true,y_pred))</pre></div></p></div><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;">model.compile(    loss="categorical_crossentropy",    optimizer=keras.optimizers.Adam(lr=0.001),    metrics=[keras.metrics.MeanIoU(num_classes=2),ks]    <p>)<br></pre></div></p></div><p>　　</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/tensorflow%20%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%AD%E7%BB%83/"/>
    <url>/2022/01/16/cnblog/tensorflow%20%E6%B5%8B%E9%87%8F%E5%B7%A5%E5%85%B7%EF%BC%8C%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%AD%E7%BB%83/</url>
    
    <content type="html"><![CDATA[<h1 class="md-end-block md-heading">&nbsp;</h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 新建测量器<br /><span><span class="cm-variable">m = <span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">metrics.<span class="cm-property">Accuracy()<br /><span><span class="cm-comment"># 写入测量器<br /><span><span class="cm-variable">m.<span class="cm-property">update_state([<span class="cm-number">0,<span class="cm-number">1,<span class="cm-number">1],[<span class="cm-number">0,<span class="cm-number">1,<span class="cm-number">2])<br /><span><span class="cm-comment"># 读取统计信息<br /><span><span class="cm-variable">m.<span class="cm-property">result() <span class="cm-comment"># 准确率为0.66<br /><span><span class="cm-comment"># 清除<br /><span><span class="cm-variable">m.<span class="cm-property">reset_states()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-variable">acc_meter = <span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">metrics.<span class="cm-property">Accuracy()<br /><span><span class="cm-variable">loss_meter = <span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">metrics.<span class="cm-property">Mean() <span class="cm-comment"># 求平均loss<br /><span><span class="cm-variable">op = <span class="cm-variable">tf.<span class="cm-property">keras.<span class="cm-property">optimizers.<span class="cm-property">Adam(<span class="cm-number">0.01)<br /><span><span class="cm-keyword">import <span class="cm-variable">datetime<br /><span><span class="cm-variable">current_time = <span class="cm-variable">datetime.<span class="cm-property">datetime.<span class="cm-property">now().<span class="cm-property">strftime(<span class="cm-string">"%Y%m%d-%H%M%S")<br /><span><span class="cm-variable">log_dir = <span class="cm-string">"logs/"<span class="cm-operator">+<span class="cm-variable">current_time<br /><span><span class="cm-variable">summary_writer = <span class="cm-variable">tf.<span class="cm-property">summary.<span class="cm-property">create_file_writer(<span class="cm-variable">logdir)<br /><span><span class="cm-keyword">for <span class="cm-variable">epoch <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">10):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">step,(<span class="cm-variable">x,<span class="cm-variable">y) <span class="cm-keyword">in <span class="cm-builtin">enumerate(<span class="cm-variable">train_data):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-variable">tf.<span class="cm-property">GradientTape() <span class="cm-keyword">as <span class="cm-variable">tape:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">loss = <span class="cm-variable">tf.<span class="cm-property">losses.<span class="cm-property">categorical_crossentropy(<span class="cm-variable">y,<span class="cm-variable">model(<span class="cm-variable">x))<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">loss_meter.<span class="cm-property">update_state(<span class="cm-variable">loss) <span class="cm-comment"># 准确率<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">grads = <span class="cm-variable">tape.<span class="cm-property">gradient(<span class="cm-variable">loss,<span class="cm-variable">model.<span class="cm-property">train_variables) <span class="cm-comment"># 求梯度<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">op.<span class="cm-property">apply_gradients(<span class="cm-builtin">zip(<span class="cm-variable">grads,<span class="cm-variable">model.<span class="cm-property">train_variables)) <span class="cm-comment"># 更新梯度 w = w - delta<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-variable">summary_writer.<span class="cm-property">as_default()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tf.<span class="cm-property">summary.<span class="cm-property">scalar(<span class="cm-variable">name=<span class="cm-string">"loss",<span class="cm-variable">data=<span class="cm-variable">loss_meter.<span class="cm-property">result().<span class="cm-property">numpy(),<span class="cm-variable">step=<span class="cm-variable">xxxx)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">epoch,<span class="cm-variable">step,<span class="cm-variable">loss,<span class="cm-variable">loss_meter.<span class="cm-property">result().<span class="cm-property">numpy()) &nbsp; <span class="cm-comment"># numpy() 将tensor转化为变量<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">loss_meter.<span class="cm-property">reset_states()<br /><span> &nbsp; &nbsp;<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">step,(<span class="cm-variable">x,<span class="cm-variable">y) <span class="cm-keyword">in <span class="cm-builtin">enumerate(<span class="cm-variable">test_data):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">out = <span class="cm-variable">model(<span class="cm-variable">x)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pred = <span class="cm-variable">tf.<span class="cm-property">argmax(<span class="cm-variable">out,<span class="cm-variable">axis=<span class="cm-operator">-<span class="cm-number">1)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">pred = <span class="cm-variable">tf.<span class="cm-property">cast(<span class="cm-variable">pred,<span class="cm-variable">dtype=<span class="cm-variable">tf.<span class="cm-property">int32)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">y = <span class="cm-variable">tf.<span class="cm-property">cast(<span class="cm-variable">tf.<span class="cm-property">argmax(<span class="cm-variable">y,<span class="cm-variable">axis=<span class="cm-operator">-<span class="cm-number">1),<span class="cm-variable">dtype=<span class="cm-variable">tf.<span class="cm-property">int32)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">acc_meter.<span class="cm-property">update_state(<span class="cm-variable">y,<span class="cm-variable">pred)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-variable">summary_writer.<span class="cm-property">as_default()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">tf.<span class="cm-property">summary.<span class="cm-property">scalar(<span class="cm-variable">name=<span class="cm-string">"acc",<span class="cm-variable">data=<span class="cm-variable">acc_meter.<span class="cm-property">result().<span class="cm-property">numpy(),<span class="cm-variable">step=<span class="cm-variable">xxxx) &nbsp; &nbsp;<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">epoch,<span class="cm-variable">acc_meter.<span class="cm-property">result().<span class="cm-property">numpy())<br /><span> &nbsp; &nbsp;<span class="cm-variable">acc_meter.<span class="cm-property">reset_states()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p><span>&nbsp;</span></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/tcp/"/>
    <url>/2022/01/16/cnblog/tcp/</url>
    
    <content type="html"><![CDATA[<p><img src="https://img2020.cnblogs.com/blog/1333782/202008/1333782-20200803180615388-227776475.png" alt="" loading="lazy" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2020.cnblogs.com/blog/1333782/202008/1333782-20200803180645308-1762163948.png" alt="" loading="lazy" /></p><p>&nbsp;<img src="https://img2020.cnblogs.com/blog/1333782/202008/1333782-20200803182957202-1055102160.png" alt="" loading="lazy" /></p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/SQL%E4%BC%98%E5%8C%96/"/>
    <url>/2022/01/16/cnblog/SQL%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<ol><li><p>对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p></li><li><p>应尽量避免在 where 子句中对字段进行 null 值判断，创建表时NULL是默认值，但大多数时候应该使用NOT NULL，或者使用一个特殊的值，如0，-1作为默 认值。</p></li><li><p>应尽量避免在 where 子句中使用!=或&lt;&gt;操作符， MySQL只有对以下操作符才使用索引：&lt;，&lt;=，=，&gt;，&gt;=，BETWEEN，IN，以及某些时候的LIKE。</p></li></ol><p>关于 MySQL 相关的文章和教程发布了很多，关注微信公众号 Java后端，回复 666 下载就行了。</p><ol start="4"><li>应尽量避免在 where 子句中使用 or 来连接条件， 否则将导致引擎放弃使用索引而进行全表扫描， 可以 使用UNION合并查询：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> num<span class="hljs-operator">=</span><span class="hljs-number">10</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span> <span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> num<span class="hljs-operator">=</span><span class="hljs-number">20</span><br></code></pre></td></tr></table></figure><ol start="5"><li>in 和 not in 也要慎用，否则会导致全表扫描，对于连续的数值，能用 between 就不要用 in 了：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> num <span class="hljs-keyword">between</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><ol start="6"><li>下面的查询也将导致全表扫描：</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> ‘<span class="hljs-operator">%</span>abc<span class="hljs-operator">%</span>’<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> t <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> ‘<span class="hljs-operator">%</span>abc’<br></code></pre></td></tr></table></figure><p>若要提高效率，可以考虑全文检索。而 select id from t where name like ‘abc%’ 才用到索引</p><ol start="7"><li><p>如果在 where 子句中使用参数，也会导致全表扫描。</p></li><li><p>应尽量避免在 where 子句中对字段进行表达式操作，应尽量避免在where子句中对字段进行函数操作</p></li><li><p>很多时候用 exists 代替 in 是一个好的选择：select num from a where num in(select num from b).用下面的语句替换：select num from a where exists(select 1 from b where num=a.num)</p></li><li><p>索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</p></li><li><p>应尽可能的避免更新 clustered 索引数据列， 因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</p></li><li><p>尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。</p></li><li><p>尽可能的使用 varchar/nvarchar 代替 char/nchar ， 因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p></li><li><p>最好不要使用”“返回所有：select from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。</p></li><li><p>尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p></li><li><p>使用表的别名(Alias)：当在SQL语句中连接多个表时,请使用表的别名并把别名前缀于每个Column上.这样一来,就可以减少解析的时间并减少那些由Column歧义引起的语法错误。</p></li><li><p>使用“临时表”暂存中间结果 </p></li></ol><p>简化SQL语句的重要方法就是采用临时表暂存中间结果，但是，临时表的好处远远不止这些，将临时结果暂存在临时表，后面的查询就在tempdb中了，这可以避免程序中多次扫描主表，也大大减少了程序执行中“共享锁”阻塞“更新锁”，减少了阻塞，提高了并发性能。</p><ol start="18"><li>一些SQL查询语句应加上nolock，读、写是会相互阻塞的，为了提高并发性能，对于一些查询，可以加上nolock，这样读的时候可以允许写，但缺点是可能读到未提交的脏数据。使用 nolock有3条原则。</li></ol><p>查询的结果用于“插、删、改”的不能加nolock ！查询的表属于频繁发生页分裂的，慎用nolock ！使用临时表一样可以保存“数据前影”，起到类似Oracle的undo表空间的功能，能采用临时表提高并发性能的，不要用nolock 。</p><ol start="19"><li><p>常见的简化规则如下：不要有超过5个以上的表连接（JOIN），考虑使用临时表或表变量存放中间结果。少用子查询，视图嵌套不要过深,一般视图嵌套不要超过2个为宜。</p></li><li><p>将需要查询的结果预先计算好放在表中，查询的时候再Select。这在SQL7.0以前是最重要的手段。例如医院的住院费计算。</p></li><li><p>用OR的字句可以分解成多个查询，并且通过UNION 连接多个查询。他们的速度只同是否使用索引有关,如果查询需要用到联合索引，用UNION all执行的效率更高.多个OR的字句没有用到索引，改写成UNION的形式再试图与索引匹配。一个关键的问题是否用到索引。</p></li><li><p>在IN后面值的列表中，将出现最频繁的值放在最前面，出现得最少的放在最后面，减少判断的次数。</p></li><li><p>尽量将数据的处理工作放在服务器上，减少网络的开销，如使用存储过程。存储过程是编译好、优化过、并且被组织到一个执行规划里、且存储在数据库中的SQL语句，是控制流语言的集合，速度当然快。反复执行的动态SQL,可以使用临时存储过程，该过程（临时表）被放在Tempdb中。</p></li><li><p>当服务器的内存够多时，配制线程数量 = 最大连接数+5，这样能发挥最大的效率；否则使用 配制线程数量&lt;最大连接数启用SQL SERVER的线程池来解决,如果还是数量 = 最大连接数+5，严重的损害服务器的性能。</p></li><li><p>查询的关联同写的顺序 </p></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> a.personMemberID, <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> chineseresume a,personmember b <span class="hljs-keyword">where</span> personMemberID <span class="hljs-operator">=</span> b.referenceid <span class="hljs-keyword">and</span> a.personMemberID <span class="hljs-operator">=</span> ‘JCNPRH39681’ （A <span class="hljs-operator">=</span> B ,B <span class="hljs-operator">=</span> ‘号码’）<br><span class="hljs-keyword">select</span> a.personMemberID, <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> chineseresume a,personmember b <span class="hljs-keyword">where</span> a.personMemberID <span class="hljs-operator">=</span> b.referenceid <span class="hljs-keyword">and</span> a.personMemberID <span class="hljs-operator">=</span> ‘JCNPRH39681’ <span class="hljs-keyword">and</span> b.referenceid <span class="hljs-operator">=</span> ‘JCNPRH39681’ （A <span class="hljs-operator">=</span> B ,B <span class="hljs-operator">=</span> ‘号码’， A <span class="hljs-operator">=</span> ‘号码’）<br><span class="hljs-keyword">select</span> a.personMemberID, <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> chineseresume a,personmember b <span class="hljs-keyword">where</span> b.referenceid <span class="hljs-operator">=</span> ‘JCNPRH39681’ <span class="hljs-keyword">and</span> a.personMemberID <span class="hljs-operator">=</span> ‘JCNPRH39681’ （B <span class="hljs-operator">=</span> ‘号码’， A <span class="hljs-operator">=</span> ‘号码’）<br></code></pre></td></tr></table></figure><ol start="26"><li><p>尽量使用exists代替select count(1)来判断是否存在记录，count函数只有在统计表中所有行数时使用，而且count(1)比count(*)更有效率。</p></li><li><p>尽量使用“&gt;=”，不要使用“&gt;”。</p></li><li><p>索引的使用规范：索引的创建要与应用结合考虑，建议大的OLTP表不要超过6个索引；尽可能的使用索引字段作为查询条件，尤其是聚簇索引，必要时可以通过index index_name来强制指定索引；避免对大表查询时进行table scan，必要时考虑新建索引；</p></li></ol><p>在使用索引字段作为条件时，如果该索引是联合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用；要注意索引的维护，周期性重建索引，重新编译存储过程。　　</p><ol start="29"><li>下列SQL条件语句中的列都建有恰当的索引，但执行速度却非常慢： </li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">substrINg</span>(card_no,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>)<span class="hljs-operator">=</span>’<span class="hljs-number">5378</span>’ (<span class="hljs-number">13</span>秒)<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> amount<span class="hljs-operator">/</span><span class="hljs-number">30</span><span class="hljs-operator">&lt;</span> <span class="hljs-number">1000</span> （<span class="hljs-number">11</span>秒）<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">convert</span>(<span class="hljs-type">char</span>(<span class="hljs-number">10</span>),<span class="hljs-type">date</span>,<span class="hljs-number">112</span>)<span class="hljs-operator">=</span>’<span class="hljs-number">19991201</span>’ （<span class="hljs-number">10</span>秒）<br></code></pre></td></tr></table></figure><p>分析： </p><p>WHERE子句中对列的任何操作结果都是在SQL运行时逐列计算得到的，因此它不得不进行表搜索，而没有使用该列上面的索引；如果这些结果在查询编译时就能得到，那么就可以被SQL优化器优化，使用索引，避免表搜索，因此将SQL重写成下面这样： </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> card_no <span class="hljs-keyword">like</span> ‘<span class="hljs-number">5378</span><span class="hljs-operator">%</span>’ （<span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span>秒）<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> amount<span class="hljs-operator">&lt;</span> <span class="hljs-number">1000</span><span class="hljs-operator">*</span><span class="hljs-number">30</span> （<span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span>秒）<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> record <span class="hljs-keyword">WHERE</span> <span class="hljs-type">date</span><span class="hljs-operator">=</span> ‘<span class="hljs-number">1999</span><span class="hljs-operator">/</span><span class="hljs-number">12</span><span class="hljs-operator">/</span><span class="hljs-number">01</span>’ （<span class="hljs-operator">&lt;</span> <span class="hljs-number">1</span>秒）<br></code></pre></td></tr></table></figure><ol start="30"><li><p>当有一批处理的插入或更新时，用批量插入或批量更新，绝不会一条条记录的去更新!</p></li><li><p>在所有的存储过程中，能够用SQL语句的，我绝不会用循环去实现! </p></li></ol><p>(例如：列出上个月的每一天，我会用connect by去递归查询一下，绝不会去用循环从上个月第一天到最后一天)</p><ol start="32"><li>选择最有效率的表名顺序(只在基于规则的优化器中有效)： </li></ol><p>oracle 的解析器按照从右到左的顺序处理FROM子句中的表名，FROM子句中写在最后的表(基础表 driving table)将被最先处理，在FROM子句中包含多个表的情况下,你必须选择记录条数最少的表作为基础表。</p><p>如果有3个以上的表连接查询, 那就需要选择交叉表(intersection table)作为基础表, 交叉表是指那个被其他表所引用的表.</p><ol start="33"><li>提高GROUP BY语句的效率, 可以通过将不需要的记录在GROUP BY 之前过滤掉.下面两个查询返回相同结果，但第二个明显就快了许多. </li></ol><p>低效: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> JOB , <span class="hljs-built_in">AVG</span>(SAL)<br><span class="hljs-keyword">FROM</span> EMP<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB<br><span class="hljs-keyword">HAVING</span> JOB <span class="hljs-operator">=</span>’PRESIDENT’<br><span class="hljs-keyword">OR</span> JOB <span class="hljs-operator">=</span>’MANAGER’<br></code></pre></td></tr></table></figure><p>高效: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> JOB , <span class="hljs-built_in">AVG</span>(SAL)<br><span class="hljs-keyword">FROM</span> EMP<br><span class="hljs-keyword">WHERE</span> JOB <span class="hljs-operator">=</span>’PRESIDENT’<br><span class="hljs-keyword">OR</span> JOB <span class="hljs-operator">=</span>’MANAGER’<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> JOB<br></code></pre></td></tr></table></figure><ol start="34"><li><p>sql语句用大写，因为oracle 总是先解析sql语句，把小写的字母转换成大写的再执行。</p></li><li><p>别名的使用，别名是大型数据库的应用技巧，就是表名、列名在查询中以一个字母为别名，查询速度要比建连接表快1.5倍。</p></li><li><p>避免死锁，在你的存储过程和触发器中访问同一个表时总是以相同的顺序;事务应经可能地缩短，在一个事务中应尽可能减少涉及到的数据量;永远不要在事务中等待用户输入。</p></li><li><p>避免使用临时表，除非却有需要，否则应尽量避免使用临时表，相反，可以使用表变量代替;大多数时候(99%)，表变量驻扎在内存中，因此速度比临时表更快，临时表驻扎在TempDb数据库中，因此临时表上的操作需要跨数据库通信，速度自然慢。</p></li><li><p>最好不要使用触发器，触发一个触发器，执行一个触发器事件本身就是一个耗费资源的过程;如果能够使用约束实现的，尽量不要使用触发器;不要为不同的触发事件(Insert，Update和Delete)使用相同的触发器;不要在触发器中使用事务型代码。</p></li><li><p>索引创建规则： </p></li></ol><ul><li>表的主键、外键必须有索引； </li><li>数据量超过300的表应该有索引； </li><li>经常与其他表进行连接的表，在连接字段上应该建立索引； </li><li>经常出现在Where子句中的字段，特别是大表的字段，应该建立索引； </li><li>索引应该建在选择性高的字段上； </li><li>索引应该建在小字段上，对于大的文本字段甚至超长字段，不要建索引； </li><li>复合索引的建立需要进行仔细分析，尽量考虑用单字段索引代替； </li><li>正确选择复合索引中的主列字段，一般是选择性较好的字段； </li><li>复合索引的几个字段是否经常同时以AND方式出现在Where子句中？单字段查询是否极少甚至没有？如果是，则可以建立复合索引；否则考虑单字段索引； </li><li>如果复合索引中包含的字段经常单独出现在Where子句中，则分解为多个单字段索引； </li><li>如果复合索引所包含的字段超过3个，那么仔细考虑其必要性，考虑减少复合的字段； </li><li>如果既有单字段索引，又有这几个字段上的复合索引，一般可以删除复合索引； </li><li>频繁进行数据操作的表，不要建立太多的索引； </li><li>删除无用的索引，避免对执行计划造成负面影响； </li></ul><p>表上建立的每个索引都会增加存储开销，索引对于插入、删除、更新操作也会增加处理上的开销。另外，过多的复合索引，在有单字段索引的情况下，一般都是没有存在价值的；相反，还会降低数据增加删除时的性能，特别是对频繁更新的表来说，负面影响更大。 </p><p>尽量不要对数据库中某个含有大量重复的值的字段建立索引。</p><p>40，mysql查询优化总结：使用慢查询日志去发现慢查询，使用执行计划去判断查询是否正常运行，总是去测试你的查询看看是否他们运行在最佳状态下。</p><p>久而久之性能总会变化，避免在整个表上使用count(*),它可能锁住整张表，使查询保持一致以便后续相似的查询可以使用查询缓存 ，在适当的情形下使用GROUP BY而不是DISTINCT，在WHERE, GROUP BY和ORDER BY子句中使用有索引的列，保持索引简单,不在多个索引中包含同一个列，有时候MySQL会使用错误的索引,对于这种情况使用USE INDEX，检查使用SQL_MODE=STRICT的问题，对于记录数小于5的索引字段，在UNION的时候使用LIMIT不是是用OR。 </p><p>为了避免在更新前SELECT，使用INSERT ON DUPLICATE KEY或者INSERT IGNORE ,不要用UPDATE去实现，不要使用 MAX,使用索引字段和ORDER BY子句，LIMIT M，N实际上可以减缓查询在某些情况下，有节制地使用，在WHERE子句中使用UNION代替子查询.</p><p>在重新启动的MySQL，记得来温暖你的数据库，以确保您的数据在内存和查询速度快，考虑持久连接，而不是多个连接，以减少开销，基准查询，包括使用服务器上的负载，有时一个简单的查询可以影响其他查询，当负载增加您的服务器上，使用SHOW PROCESSLIST查看慢的和有问题的查询，在开发环境中产生的镜像数据中 测试的所有可疑的查询。</p><ol start="41"><li>MySQL 备份过程: </li></ol><p>从二级复制服务器上进行备份。在进行备份期间停止复制，以避免在数据依赖和外键约束上出现不一致。彻底停止MySQL，从数据库文件进行备份。 </p><p>如果使用 MySQL dump进行备份，请同时备份二进制日志文件 – 确保复制没有中断。不要信任LVM 快照，这很可能产生数据不一致，将来会给你带来麻烦。为了更容易进行单表恢复，以表为单位导出数据 – 如果数据是与其他表隔离的。 </p><p>当使用mysqldump时请使用 –opt。在备份之前检查和优化表。为了更快的进行导入，在导入时临时禁用外键约束。 </p><p>为了更快的进行导入，在导入时临时禁用唯一性检测。在每一次备份后计算数据库，表以及索引的尺寸，以便更够监控数据尺寸的增长。 </p><p>通过自动调度脚本监控复制实例的错误和延迟。定期执行备份。</p><ol start="42"><li><p>查询缓冲并不自动处理空格，因此，在写SQL语句时，应尽量减少空格的使用，尤其是在SQL首和尾的空格(因为，查询缓冲并不自动截取首尾空格)。</p></li><li><p>member用mid做標準進行分表方便查询么？一般的业务需求中基本上都是以username为查询依据，正常应当是username做hash取模来分表吧。分表的话 mysql 的partition功能就是干这个的，对代码是透明的； </p></li></ol><p>在代码层面去实现貌似是不合理的。</p><ol start="44"><li><p>我们应该为数据库里的每张表都设置一个ID做为其主键，而且最好的是一个INT型的（推荐使用UNSIGNED），并设置上自动增加的AUTO_INCREMENT标志。</p></li><li><p>在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。 </p></li></ol><p>无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。</p><ol start="46"><li><p>MySQL查询可以启用高速查询缓存。这是提高数据库性能的有效Mysql优化方法之一。当同一个查询被执行多次时，从缓存中提取数据和直接从数据库中返回数据快很多。</p></li><li><p>EXPLAIN SELECT 查询用来跟踪查看效果 </p></li></ol><p>使用 EXPLAIN 关键字可以让你知道MySQL是如何处理你的SQL语句的。这可以帮你分析你的查询语句或是表结构的性能瓶颈。EXPLAIN 的查询结果还会告诉你你的索引主键被如何利用的，你的数据表是如何被搜索和排序的……等等，等等。</p><ol start="48"><li>当只要一行数据时使用 LIMIT 1 </li></ol><p>当你查询表的有些时候，你已经知道结果只会有一条结果，但因为你可能需要去fetch游标，或是你也许会去检查返回的记录数。在这种情况下，加上 LIMIT 1 可以增加性能。这样一样，MySQL数据库引擎会在找到一条数据后停止搜索，而不是继续往后查少下一条符合记录的数据。</p><ol start="49"><li>选择表合适存储引擎： </li></ol><p>myisam: 应用时以读和插入操作为主，只有少量的更新和删除，并且对事务的完整性，并发性要求不是很高的。 </p><p>Innodb：事务处理，以及并发条件下要求数据的一致性。除了插入和查询外，包括很多的更新和删除。（Innodb有效地降低删除和更新导致的锁定）。对于支持事务的InnoDB类型的表来说，影响速度的主要原因是AUTOCOMMIT默认设置是打开的，而且程序没有显式调用BEGIN 开始事务，导致每插入一条都自动提交，严重影响了速度。可以在执行sql前调用begin，多条sql形成一个事物（即使autocommit打开也可以），将大大提高性能。</p><ol start="50"><li>优化表的数据类型,选择合适的数据类型： </li></ol><p>原则：更小通常更好，简单就好，所有字段都得有默认值,尽量避免null。 </p><p>例如：数据库表设计时候更小的占磁盘空间尽可能使用更小的整数类型.(mediumint就比int更合适) </p><p>比如时间字段：datetime和timestamp, datetime占用8个字节，而timestamp占用4个字节，只用了一半，而timestamp表示的范围是1970—2037适合做更新时间 </p><p>MySQL可以很好的支持大数据量的存取，但是一般说来，数据库中的表越小，在它上面执行的查询也就会越快。 </p><p>因此，在创建表的时候，为了获得更好的性能，我们可以将表中字段的宽度设得尽可能小。例如， </p><p>在定义邮政编码这个字段时，如果将其设置为CHAR(255),显然给数据库增加了不必要的空间， </p><p>甚至使用VARCHAR这种类型也是多余的，因为CHAR(6)就可以很好的完成任务了。同样的，如果可以的话， </p><p>我们应该使用MEDIUMINT而不是BIGIN来定义整型字段。 </p><p>应该尽量把字段设置为NOT NULL，这样在将来执行查询的时候，数据库不用去比较NULL值。 </p><p>对于某些文本字段，例如“省份”或者“性别”，我们可以将它们定义为ENUM类型。因为在MySQL中，ENUM类型被当作数值型数据来处理， </p><p>而数值型数据被处理起来的速度要比文本类型快得多。这样，我们又可以提高数据库的性能。</p><ol start="51"><li><p>字符串数据类型：char，varchar，text选择区别</p></li><li><p>任何对列的操作都将导致表扫描，它包括数据库函数、计算表达式等等，查询时要尽可能将操作移至等号右边。</p></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Springboot%E5%90%AF%E5%8A%A8%E5%89%8D%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95/"/>
    <url>/2022/01/16/cnblog/Springboot%E5%90%AF%E5%8A%A8%E5%89%8D%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="1-实现ServletContextAware接口并重写其setServletContext方法"><a href="#1-实现ServletContextAware接口并重写其setServletContext方法" class="headerlink" title="1.实现ServletContextAware接口并重写其setServletContext方法"></a>1.实现ServletContextAware接口并重写其setServletContext方法</h2><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestStarted</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ServletContextAware</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 在填充普通bean属性之后但在初始化之前调用</span><br><span class="hljs-comment">     * 类似于initializingbean的afterpropertiesset或自定义init方法的回调</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setServletContext</span><span class="hljs-params">(ServletContext servletContext)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;setServletContext方法&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>注意：该方法会在填充完普通Bean的属性，但是还没有进行Bean的初始化之前执行</p><h2 id="2-实现ServletContextListener接口"><a href="#2-实现ServletContextListener接口" class="headerlink" title="2.实现ServletContextListener接口"></a>2.实现ServletContextListener接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 在初始化Web应用程序中的任何过滤器或servlet之前，将通知所有servletContextListener上下文初始化。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextInitialized</span><span class="hljs-params">(ServletContextEvent sce)</span> </span>&#123;<br>    <span class="hljs-comment">//ServletContext servletContext = sce.getServletContext();</span><br>    System.out.println(<span class="hljs-string">&quot;执行contextInitialized方法&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-将要执行的方法所在的类交个spring容器扫描-Component-并且在要执行的方法上添加-PostConstruct注解或者静态代码块执行"><a href="#3-将要执行的方法所在的类交个spring容器扫描-Component-并且在要执行的方法上添加-PostConstruct注解或者静态代码块执行" class="headerlink" title="3.将要执行的方法所在的类交个spring容器扫描(@Component),并且在要执行的方法上添加@PostConstruct注解或者静态代码块执行"></a>3.将要执行的方法所在的类交个spring容器扫描(@Component),并且在要执行的方法上添加@PostConstruct注解或者静态代码块执行</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;<br>    <span class="hljs-comment">//静态代码块会在依赖注入后自动执行,并优先执行</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;---static--&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *  <span class="hljs-doctag">@Postcontruct</span>’在依赖注入完成后自动调用</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">haha</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;@Postcontruct’在依赖注入完成后自动调用&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-实现ApplicationRunner接口"><a href="#4-实现ApplicationRunner接口" class="headerlink" title="4.实现ApplicationRunner接口"></a>4.实现ApplicationRunner接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用于指示bean包含在SpringApplication中时应运行的接口。可以定义多个applicationrunner bean</span><br><span class="hljs-comment"> * 在同一应用程序上下文中，可以使用有序接口或<span class="hljs-doctag">@order</span>注释对其进行排序。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;ApplicationRunner的run方法&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5-实现CommandLineRunner接口"><a href="#5-实现CommandLineRunner接口" class="headerlink" title="5.实现CommandLineRunner接口"></a>5.实现CommandLineRunner接口</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用于指示bean包含在SpringApplication中时应运行的接口。可以在同一应用程序上下文中定义多个commandlinerunner bean，并且可以使用有序接口或<span class="hljs-doctag">@order</span>注释对其进行排序。</span><br><span class="hljs-comment"> * 如果需要访问applicationArguments而不是原始字符串数组，请考虑使用applicationrunner。</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... )</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;CommandLineRunner的run方法&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>来源:<a href="https://www.cnblogs.com/lsgspace/p/10508180.html">https://www.cnblogs.com/lsgspace/p/10508180.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/springboot_%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84_%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    <url>/2022/01/16/cnblog/springboot_%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84_%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    
    <content type="html"><![CDATA[<h1 id="TOMCAT项目结构"><a href="#TOMCAT项目结构" class="headerlink" title="TOMCAT项目结构"></a>TOMCAT项目结构</h1><p><img src="https://z3.ax1x.com/2021/06/26/R8YDfg.png" alt="Springboot war"></p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">web-app</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:web</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://java.sun.com/xml/ns/javaee </span></span><br><span class="hljs-string"><span class="hljs-tag">    http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span> </span><br><span class="hljs-tag">    <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;WebApp_ID&quot;</span> <span class="hljs-attr">version</span>=<span class="hljs-string">&quot;3.1&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">display-name</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">display-name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">welcome-file-list</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">welcome-file</span>&gt;</span>index1.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">welcome-file</span>&gt;</span><br>&lt;/welcome-file-list<br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>servlet1<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>net.test.TestServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>servlet1<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>*.do<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">web-app</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="Springboot-WAR项目结构"><a href="#Springboot-WAR项目结构" class="headerlink" title="Springboot WAR项目结构"></a>Springboot WAR项目结构</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml">    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>war<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>    <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>provided<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">finalName</span>&gt;</span>demo<span class="hljs-tag">&lt;/<span class="hljs-name">finalName</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;  <span class="hljs-comment">//1.继承SpringBootServletInitializer</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(Main.class,args);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServletInitializer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpringBootServletInitializer</span> </span>&#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> SpringApplicationBuilder <span class="hljs-title">configure</span><span class="hljs-params">(SpringApplicationBuilder application)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> application.sources(Main.class);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><font color=red>注意：使用tomcat10总是访问不到controller，不知道什么原因</font></p><p>war目录结构</p><ol><li>META-INF<ol><li>maven</li><li>MANIFEST.MF</li><li>war-tracker</li></ol></li><li>org<ol><li>springframework<ol><li>boot<ol><li>loader<ol><li>xxx</li><li>yyy</li><li>zzz</li></ol></li></ol></li></ol></li></ol></li><li>WEB-INF<ol><li>classes<ol><li>com.example<ol><li>Main.class</li></ol></li></ol></li><li>lib</li><li>lib-provide</li><li>layers.idx</li></ol></li></ol><h1 id="Springboot-JAR项目结构"><a href="#Springboot-JAR项目结构" class="headerlink" title="Springboot JAR项目结构"></a>Springboot JAR项目结构</h1><h5 id="外部配置文件位置"><a href="#外部配置文件位置" class="headerlink" title="外部配置文件位置"></a>外部配置文件位置</h5><p>/home/project</p><ol><li>xxx.jar</li><li>application.yml</li><li>config/application.yml</li></ol><h5 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h5><ol><li>BOOT-INF<ol><li>classes<ol><li>com.example<ol><li>Main.class</li></ol></li><li>static</li><li>templates</li><li>application.yml</li><li>config/application.yml</li></ol></li><li>lib</li><li>classpath,idx</li><li>layer.idx</li></ol></li><li>META-INF:同上</li><li>org：同上</li></ol><h1 id="Flyway"><a href="#Flyway" class="headerlink" title="Flyway"></a>Flyway</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flywaydb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flyway-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.flywaydb<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>flyway-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">flyway.sql-migration-prefix</span>=<span class="hljs-string">指定前缀</span><br><span class="hljs-attr">flyway.baseline-description对执行迁移时基准版本的描述.</span><br><span class="hljs-attr">flyway.baseline-on-migrate当迁移时发现目标schema非空，而且带有没有元数据的表时，是否自动执行基准迁移，默认false.</span><br><span class="hljs-attr">flyway.baseline-version开始执行基准迁移时对现有的schema的版本打标签，默认值为1.</span><br><span class="hljs-attr">flyway.check-location检查迁移脚本的位置是否存在，默认false.</span><br><span class="hljs-attr">flyway.clean-on-validation-error当发现校验错误时是否自动调用clean，默认false.</span><br><span class="hljs-attr">flyway.enabled是否开启flywary，默认true.</span><br><span class="hljs-attr">flyway.encoding设置迁移时的编码，默认UTF-8.</span><br><span class="hljs-attr">flyway.ignore-failed-future-migration当读取元数据表时是否忽略错误的迁移，默认false.</span><br><span class="hljs-attr">flyway.init-sqls当初始化好连接时要执行的SQL.</span><br><span class="hljs-attr">flyway.locations迁移脚本的位置，默认db/migration.</span><br><span class="hljs-attr">flyway.out-of-order是否允许无序的迁移，默认false.</span><br><span class="hljs-attr">flyway.password目标数据库的密码.</span><br><span class="hljs-attr">flyway.placeholder-prefix设置每个placeholder的前缀，默认$&#123;.</span><br><span class="hljs-attr">flyway.placeholder-replacementplaceholders是否要被替换，默认true.</span><br><span class="hljs-attr">flyway.placeholder-suffix设置每个placeholder的后缀，默认&#125;.</span><br><span class="hljs-meta">flyway.placeholders.[placeholder</span> <span class="hljs-string">name]设置placeholder的value</span><br><span class="hljs-attr">flyway.schemas设定需要flywary迁移的schema，大小写敏感，默认为连接默认的schema.</span><br><span class="hljs-attr">flyway.sql-migration-prefix迁移文件的前缀，默认为V.</span><br><span class="hljs-attr">flyway.sql-migration-separator迁移脚本的文件名分隔符，默认__</span><br><span class="hljs-attr">flyway.sql-migration-suffix迁移脚本的后缀，默认为.sql</span><br><span class="hljs-attr">flyway.tableflyway使用的元数据表名，默认为schema_version</span><br><span class="hljs-meta">flyway.target迁移时使用的目标版本，默认为latest</span> <span class="hljs-string">version</span><br><span class="hljs-meta">flyway.url迁移时使用的JDBC</span> <span class="hljs-string">URL，如果没有指定的话，将使用配置的主数据源</span><br><span class="hljs-attr">flyway.user迁移数据库的用户名</span><br><span class="hljs-attr">flyway.validate-on-migrate迁移时是否校验，默认为true.</span><br><span class="hljs-comment"># 在classpath下新建/db/migration文件夹，并创建sql脚本文件：</span><br></code></pre></td></tr></table></figure><h1 id="liquibase"><a href="#liquibase" class="headerlink" title="liquibase"></a>liquibase</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.liquibase<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>liquibase-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br>  <span class="hljs-function"><span class="hljs-keyword">public</span> SpringLiquibase <span class="hljs-title">liquibase</span><span class="hljs-params">(DataSource dataSource)</span> </span>&#123;<br>    SpringLiquibase liquibase = <span class="hljs-keyword">new</span> SpringLiquibase();<br>    liquibase.setDataSource(dataSource);<br>    <span class="hljs-comment">//指定changelog的位置，这里使用的一个master文件引用其他文件的方式</span><br>    liquibase.setChangeLog(<span class="hljs-string">&quot;classpath:liquibase/master.xml&quot;</span>);<br>    liquibase.setContexts(<span class="hljs-string">&quot;development,test,production&quot;</span>);<br>    liquibase.setShouldRun(<span class="hljs-keyword">true</span>);<br>    <span class="hljs-keyword">return</span> liquibase;<br>  &#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"># /resources/liquibase/master.xml<br><span class="hljs-tag">&lt;<span class="hljs-name">databaseChangeLog</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span></span><br><span class="hljs-string"><span class="hljs-tag">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">includeAll</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;liquibase/changelogs/&quot;</span> <span class="hljs-attr">relativeToChangelogFile</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">databaseChangeLog</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 数据库表生成<br># /resources/liquibase/changelog-1.0.xml<br># 方法一引入sql<br><span class="hljs-tag">&lt;<span class="hljs-name">databaseChangeLog</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span></span><br><span class="hljs-string"><span class="hljs-tag">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;liquibase/changelogs/project.sql&quot;</span> <span class="hljs-attr">relativeToChangelogFile</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">databaseChangeLog</span>&gt;</span><br># 方法二直接写<br><span class="hljs-tag">&lt;<span class="hljs-name">databaseChangeLog</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.liquibase.org/xml/ns/dbchangelog</span></span><br><span class="hljs-string"><span class="hljs-tag">         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">changeSet</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;20190713-01&quot;</span> <span class="hljs-attr">author</span>=<span class="hljs-string">&quot;solo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">createTable</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;project_info&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目id&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">constraints</span> <span class="hljs-attr">primaryKey</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">nullable</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">column</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_name&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(255)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目名字&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_difficulty&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;float&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目难度&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;category_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目类型类目编号&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_status&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int(11)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目状态, 0招募中，1 进行中，2已完成，3失败，4延期，5删除&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_desc&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(512)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目简介&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_creater_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目创建者id&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;team_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目所属团队id&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;bigint(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;创建时间&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;bigint(64)&quot;</span> <span class="hljs-attr">encoding</span>=<span class="hljs-string">&quot;utf8&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;更新时间&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">createTable</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">changeSet</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">changeSet</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;20190713-02&quot;</span> <span class="hljs-attr">author</span>=<span class="hljs-string">&quot;solo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">createTable</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;project_category&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目类型表&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目类型id&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">constraints</span> <span class="hljs-attr">primaryKey</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">nullable</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">column</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(255)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;类目类型名称&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int(11)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;状态。1正常，2删除&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remark&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(255)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;备注&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">createTable</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">changeSet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">changeSet</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;20190713-03&quot;</span> <span class="hljs-attr">author</span>=<span class="hljs-string">&quot;solo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">createTable</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;project_like_user&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目点赞表&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;主键id&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">constraints</span> <span class="hljs-attr">primaryKey</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">nullable</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">column</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目id&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;点赞的用户id&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;status&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int(11)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;点赞状态，0 取消点赞，1点赞&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;type&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;int(11)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;类型 1点赞&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;create_time&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;bigint(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;创建时间&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;update_time&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;bigint(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;更新时间&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">createTable</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">changeSet</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">changeSet</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;20190713-04&quot;</span> <span class="hljs-attr">author</span>=<span class="hljs-string">&quot;solo&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">createTable</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">&quot;project_picture&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目图片表&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;图片id&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">constraints</span> <span class="hljs-attr">primaryKey</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">nullable</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">column</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;project_id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;项目id&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;picture_url&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;图片地址&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;picture_url_32&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;图片地址32位&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;picture_url_64&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;varchar(64)&quot;</span> <span class="hljs-attr">remarks</span>=<span class="hljs-string">&quot;图片地址64位&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">createTable</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">changeSet</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">databaseChangeLog</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/springboot/"/>
    <url>/2022/01/16/cnblog/springboot/</url>
    
    <content type="html"><![CDATA[<h1 id="Springboot是什么？"><a href="#Springboot是什么？" class="headerlink" title="Springboot是什么？"></a>Springboot是什么？</h1><p>javaweb框架，简化开发，扩展性好</p><h2 id="核心特点"><a href="#核心特点" class="headerlink" title="核心特点"></a>核心特点</h2><ul><li>Jar形式独立运行</li></ul><ul><li>内嵌servlet容器,tomcat集成springmvc,spring</li></ul><ul><li>简化Maven配置</li></ul><ul><li>自动装配dean</li></ul><ul><li>提供基于http,ssh,telnet对运行时项目的监控</li></ul><ul><li>不需要任何xml文件,借助注解,properties实现spring配置</li></ul><h1 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h1><ul><li><p>MVC</p></li><li><p>MVVM：model view viewmodel</p><ul><li>model：服务器上的业务逻辑操作</li><li>view：页面</li><li>viewmodel：model，view核心枢纽流入vue.js</li><li>view-》viewmodel–》model</li></ul></li><li><p>微服务：将原来的userservice===》模块</p><ul><li>原来是所有的功能放在一个项目</li><li>微服务是将功能分开，向外提供接口</li></ul></li></ul><h1 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h1><p>方式一：<a href="https://start.spring.io/">https://start.spring.io/</a> 根据需要选择，最后添spring web依赖，</p><p>方式二：idea spring initilizer，需要自己添加web包</p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"> <span class="hljs-comment">&lt;!-- 父级依赖 --&gt;</span>   <br><span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>      <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.3.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>   <br><span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>  <br><span class="hljs-comment">&lt;!--启动器：web环境下的依赖， 使用springmvc spring的jar，tomcat等 --&gt;</span>   <br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>      <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>           <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>           <br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>   <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span> <br><span class="hljs-comment">&lt;!--打包插件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># properties格式</span><br><span class="hljs-comment"># 配置文件</span><br><span class="hljs-comment"># 更改端口号</span><br><span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span><br><span class="hljs-attr">debug</span>: <span class="hljs-string">true</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Yml(:后有空格)</span><br><span class="hljs-attr">server:</span><br><span class="hljs-attr">port:</span> <span class="hljs-number">8081</span><br><span class="hljs-attr">student:</span> <span class="hljs-comment"># 在实体类中注入,属性值必须相同，也可用于配置文件的注入</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">Dean$&#123;random.int&#125;</span> <span class="hljs-comment"># spel表达式</span><br><span class="hljs-attr">age:</span> <span class="hljs-number">120</span><br><span class="hljs-attr">birthday:</span> <span class="hljs-number">2019</span><span class="hljs-string">/11/02</span><br><span class="hljs-attr">maps:</span> &#123;<span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span>,<span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span>&#125;<br><span class="hljs-attr">student:</span> &#123;<span class="hljs-attr">name:</span> <span class="hljs-string">Dean</span>,<span class="hljs-attr">age:</span> <span class="hljs-number">120</span>&#125;<br><span class="hljs-attr">pets:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">cat</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">dog</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">pig</span><br><span class="hljs-string">pets:[cat,dog,pig]</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;student&quot;)</span><br><span class="hljs-meta">@Validated</span> <span class="hljs-comment">//数据校验</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>    <span class="hljs-meta">@Email(&quot;邮箱格式错误&quot;)</span><br>    <span class="hljs-keyword">private</span> String email;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/3145530-8ae74d19e6c65b4c?imageMogr2/auto-orient/strip%7CimageView2/2/format/webp" alt="img"></p><h1 id="自定义启动图标-banner"><a href="#自定义启动图标-banner" class="headerlink" title="自定义启动图标(banner)"></a>自定义启动图标(banner)</h1><p><a href="http://patorjk.com/software/taag">http://patorjk.com/software/taag</a></p><p>resources下复制保存为banner.txt</p><h1 id="常用maven命令"><a href="#常用maven命令" class="headerlink" title="常用maven命令"></a>常用maven命令</h1><ul><li>clean：清理</li><li>package：打包jar或war</li></ul><h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span>   　　<br><span class="hljs-meta">@ResponseBody</span>   　　<br><span class="hljs-function"><span class="hljs-keyword">public</span>  User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span></span>&#123;   　　　　<br>    <span class="hljs-keyword">return</span>  user;   　　<br>&#125;   　　<br><span class="hljs-comment">//User字段：userName  pwd   　　</span><br><span class="hljs-comment">//那么在前台接收到的数据为：&#x27;&#123;&quot;userName&quot;:&quot;xxx&quot;,&quot;pwd&quot;:&quot;xxx&quot;&#125;&#x27;效果等同于如下代码：</span><br><span class="hljs-meta">@RequestMapping(&quot;/login&quot;)</span>   　　<br><span class="hljs-function"><span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(User user, HttpServletResponse response)</span></span>&#123;<br>    response.getWriter.write(JSONObject.fromObject(user).toString());<br>&#125;  <br></code></pre></td></tr></table></figure><h1 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h1><ul><li><p>pom.xml</p><ul><li>核心依赖在父工程中</li></ul></li><li><p>启动器</p><ul><li><p>```xml</p><dependencies>         <dependency>                  <groupId>org.springframework.boot</groupId>                  <artifactId>spring-boot-starter-web</artifactId>         </dependency>   </dependencies> <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>  - 需要什么功能就导入对应启动器<br><br>  - https:<span class="hljs-regexp">//</span>docs.spring.io<span class="hljs-regexp">/spring-boot/</span>docs<span class="hljs-regexp">/current/</span>reference<span class="hljs-regexp">/html/u</span>sing-spring-boot.html<span class="hljs-comment">#using-boot-starter </span><br><br>- 主程序<br><br>  ```java<br>  @SpringBootApplication <span class="hljs-regexp">//</span>标注是springboot应用<br>  public class HellowordApplication &#123;<br>  public static void main(String[] args) &#123;<br>          <span class="hljs-regexp">//</span>启动<br>  SpringApplication.run(HellowordApplication.class, args);<br>  &#125;<br>  <br>  &#125;<br></code></pre></td></tr></table></figure></li><li><p>SpringBootApplication包含比较重要的几个</p><ul><li>EnableAutoConfiguration(exclude={xxxConfiguration.class,yyy.Configuartion})启动自动配置<ul><li>AutoConfigurationPackage：自动配置包<ul><li> Import(AutoConfigurationPackages.Registrar.class) 导入选择器 包注册</li></ul></li><li>Import(AutoConfigurationImportSelector.class) 自动配置导入选择</li></ul></li><li>SpringBootConfiguration：springboot配置类<ul><li>Configuration：spring配置类<ul><li>Component：这一是spring</li></ul></li></ul></li><li>ComponentScan 扫描启动类同级别的包</li></ul></li></ul></li></ul><h1 id="多文件配置"><a href="#多文件配置" class="headerlink" title="多文件配置"></a>多文件配置</h1><p>classpath:</p><ul><li>java文件夹</li><li>resources文件夹</li></ul><p>配置文件位置：</p><ul><li>resources下 优先级最低</li><li>resources/config/下 优先级较低</li><li>根目录下  优先级次高</li><li>根目录/config/下  优先级最高</li></ul><p>多配置文件：</p><ul><li><p>默认的还是原名</p></li><li><p>建立其他的application-dev.properties</p></li><li><p>测试开发时,每次分别使用不同properties,在主properties中指定: spring.profiles.active=dev ,指定配置文件</p></li><li><p>```yaml</p><h1 id="—-可用作分割，不用多个文件"><a href="#—-可用作分割，不用多个文件" class="headerlink" title="— 可用作分割，不用多个文件"></a>— 可用作分割，不用多个文件</h1><p>server:<br> port: 8081<br>spring:<br> profile:</p><h2 id="active-dev"><a href="#active-dev" class="headerlink" title="  active: dev"></a>  active: dev</h2><p>server:<br> port: 8081<br>spring:</p><h2 id="profile-dev"><a href="#profile-dev" class="headerlink" title=" profile: dev"></a> profile: dev</h2><p>server:<br> port: 8081<br>spring:<br> profile: test</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dts"><br>application.yaml 与spring.factories 有很大联系<br><br>spring.factories：可能需要配置文件类<br><br>- 里边是各种配置文件xxxxContiguration，需要xxxproperties，而properties需要自动注入，配置信息通过上边的方式，yaml装入<br>- 每个类的注解<br>  - Configuration:表名是一个配置类<br>  - EnableConfigurationProperties:允许yaml注入属性<br>  - ConditionOnWebapplication:根据条件确定是否要配置<br><br><span class="hljs-meta"># WEB开发</span><br><br><span class="hljs-meta">## 静态问价访问</span><br><br>- 不自己配置时：引入的js文件等静态依赖，默认会在Resources<span class="hljs-meta-keyword">/webjars/</span>下边<br><br>  - ```xml<br>    <span class="hljs-params">&lt;dependency&gt;</span><br>        <span class="hljs-params">&lt;groupId&gt;</span>org.webjars<span class="hljs-params">&lt;/groupId&gt;</span><br>        <span class="hljs-params">&lt;artifactId&gt;</span>jquery<span class="hljs-params">&lt;/artifactId&gt;</span><br>        <span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">3.5</span><span class="hljs-number">.1</span><span class="hljs-params">&lt;/version&gt;</span><br>    <span class="hljs-params">&lt;/dependency&gt;</span><br></code></pre></td></tr></table></figure><p>  <img src="https://i.loli.net/2020/08/16/tYJ8boeL1rpRDO9.png" alt="image-20200816135456182"></p></li><li><p>不自己配置时：</p><ul><li>classpath:/resources   优先级最高</li><li>classpath:/static 其次</li><li>classpath:/public 最后</li><li>classpath:/mate-inf/resources</li></ul></li><li><p>自己配置</p></li></ul><p>spring.mvc.static-path-pattern=/Dean/**,classpath:/xxxx</p><h1 id="首页与图标"><a href="#首页与图标" class="headerlink" title="首页与图标"></a>首页与图标</h1><ul><li>默认在静态文件夹下找index.html</li><li>当网站是Restful类型时，用restfulcontroller注解</li><li>若要返回html，用controller注解<ul><li>html要位于template文件夹下</li><li>方法返回对应文件名，不带后缀</li><li>需要导入模板引擎 thymeleaf，等等</li></ul></li></ul><p>图标：静态文件夹下/favicon.ico</p><h1 id="自定义配置类"><a href="#自定义配置类" class="headerlink" title="自定义配置类"></a>自定义配置类</h1><p>读取配置时会看是否有用户自定义配置，有的话使用用户的，</p><p>对于有的配置可有多个，例如视图解析器，就结合使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 扩展springmvc ，dispatcherservlet</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">WebMvcConfigurer</span> </span>&#123;<br>    <span class="hljs-comment">// 请求跳转 dzf--》hello 但url不变</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;<br>        registry.addViewController(<span class="hljs-string">&quot;/dzf&quot;</span>).setViewName(<span class="hljs-string">&quot;/hello&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 实现视图解析器接口的类，我们就可以把他看做视图解析器</span><br>    <span class="hljs-meta">@Bean</span> <span class="hljs-comment">// 交给Springboot自动装配</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ViewResolver <span class="hljs-title">myViewResolver</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MyViewResolver();<br>    &#125;<br>    <span class="hljs-comment">//自定义视图解析器</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyViewResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ViewResolver</span></span>&#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> View <span class="hljs-title">resolveViewName</span><span class="hljs-params">(String viewName, Locale locale)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginHandlerInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        Object loginUser = request.getSession().getAttribute(<span class="hljs-string">&quot;key&quot;</span>);<br>        <span class="hljs-keyword">if</span>(loginUser==<span class="hljs-keyword">null</span>)&#123;<br>            request.getRequestDispatcher(<span class="hljs-string">&quot;/index.html&quot;</span>).forward(request,response);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 自定义webconfig中添加</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> </span>&#123;<br>registry.addInterceptor(<span class="hljs-keyword">new</span> LoginHandlerInterceptor()).addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>)<br>                .excludePathPatterns(<span class="hljs-string">&quot;/index.html&quot;</span>,<span class="hljs-string">&quot;/user/login/**&quot;</span>,<span class="hljs-string">&quot;/css/**&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="404页面"><a href="#404页面" class="headerlink" title="404页面"></a>404页面</h1><p>在template下边建立error文件夹建立404.html，对应错误会找到对应的</p><h1 id="数据源配置"><a href="#数据源配置" class="headerlink" title="数据源配置"></a>数据源配置</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 引入依赖--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-comment"># driver-class-name: com.mysql.jdbc.Driver  this is lower Driver</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br><br>    <span class="hljs-comment"># druid&#x27;s owner config, springboot doesn&#x27;t these</span><br>    <span class="hljs-comment"># if you wang to use this ,you should write one config</span><br>    <span class="hljs-attr">initialSize:</span> <span class="hljs-number">5</span><br>    <span class="hljs-attr">minIdle:</span> <span class="hljs-number">5</span><br>    <span class="hljs-comment"># and so on</span><br><br>    <span class="hljs-comment"># driud&#x27;s plugins config</span><br>    <span class="hljs-attr">filters:</span> <span class="hljs-string">stat,wall,log4j</span><br>    <span class="hljs-attr">maxPoolPreparedStatementPerConnectionSize:</span> <span class="hljs-number">20</span><br>    <span class="hljs-attr">useGlobalDataSourceStat:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">connectionProperties:</span> <span class="hljs-string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=500</span><br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br>DataSource dataSource;<br><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>       <span class="hljs-comment">// class com.zaxxer.hikari.HikariDataSource 也是一个连接池，类似c3p0，几乎是最快，默认，通过yaml中type选择</span><br>System.out.println(dataSource.getClass());  <br>Connection connection = dataSource.getConnection();<br>System.out.println(connection);<br>connection.close();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>&#123;<br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">druidDataSource</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DruidDataSource();<br>    &#125;<br>    <span class="hljs-comment">// 后台监控</span><br>    <span class="hljs-comment">// springboot 内置servlet容器，没有web.xml 替代方法: ServletRegistrationBean 注册进去即可</span><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">a</span><span class="hljs-params">()</span></span>&#123;<br>        ServletRegistrationBean&lt;StatViewServlet&gt; bean =  <span class="hljs-keyword">new</span> ServletRegistrationBean&lt;&gt;(<span class="hljs-keyword">new</span> StatViewServlet(),<span class="hljs-string">&quot;/druid/*&quot;</span>);<br>        <span class="hljs-comment">// 后台登录，账号密码</span><br>        HashMap&lt;String,String&gt; initParameters = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        initParameters.put(<span class="hljs-string">&quot;loginUsername&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>); <span class="hljs-comment">// 名字不能改</span><br>        initParameters.put(<span class="hljs-string">&quot;loginPassword&quot;</span>,<span class="hljs-string">&quot;admin&quot;</span>);<br>        initParameters.put(<span class="hljs-string">&quot;allow&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br><br>        bean.setInitParameters(initParameters);<br>        <span class="hljs-keyword">return</span> bean;<br><br>    &#125;<br>    <span class="hljs-comment">//filter</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">webSataFilter</span><span class="hljs-params">()</span></span>&#123;<br>        FilterRegistrationBean bean = <span class="hljs-keyword">new</span> FilterRegistrationBean();<br>        bean.setFilter(<span class="hljs-keyword">new</span> WebStatFilter());<br>        <span class="hljs-comment">// 可以过滤那些请求</span><br>        Map&lt;String,String&gt; initParameters = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-comment">// 不过滤</span><br>        initParameters.put(<span class="hljs-string">&quot;exclusions&quot;</span>,<span class="hljs-string">&quot;*.js,*.css,/durid/*&quot;</span>);<br>        <span class="hljs-keyword">return</span> bean;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="数据库JDBC"><a href="#数据库JDBC" class="headerlink" title="数据库JDBC"></a>数据库JDBC</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//jdbc ，有dao</span><br><span class="hljs-meta">@Autowired</span><br>JdbcTemplate jdbcTemplate;<br><span class="hljs-meta">@RequestMapping(&quot;/getAll&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;Map&lt;String,Object&gt;&gt; userList()&#123;<br>    List&lt;Map&lt;String,Object&gt;&gt; list = jdbcTemplate.queryForList(<span class="hljs-string">&quot;select * from user&quot;</span>);<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="整合mybatis-xml方式"><a href="#整合mybatis-xml方式" class="headerlink" title="整合mybatis(xml方式)"></a>整合mybatis(xml方式)</h2><p> 导入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 不是springboot官方的，是mybatis自己的--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>配置yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis:</span><br>  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">top.dean0731.model</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*xml</span><br></code></pre></td></tr></table></figure><p>mapper 文件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmployeeMapper</span> </span>&#123;<br>    <span class="hljs-function">List&lt;Employee&gt; <span class="hljs-title">queryEmployeeList</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">Employee <span class="hljs-title">queryEmployerById</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">addEmployee</span><span class="hljs-params">(Employee employee)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updateEmployee</span><span class="hljs-params">(Employee employee)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">deleteEmployee</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//mapper 代替dao，Resource下mybatis/mapper/下创建配置文件</span><br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;!DOCTYPE mapper<br>         PUBLIC <span class="hljs-string">&quot;-//mybatis.org//DTD Mapper 3.0/EN&quot;</span><br>        <span class="hljs-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;<br>&lt;mapper namespace=<span class="hljs-string">&quot;top.dean0731.mapper.EmployeeMapper&quot;</span>&gt;<br>    &lt;select id=<span class="hljs-string">&quot;queryEmployeeList&quot;</span> resultType=<span class="hljs-string">&quot;Employee&quot;</span>&gt;<br>        select * from Employee<br>    &lt;/select&gt;<br>&lt;/mapper&gt;<br></code></pre></td></tr></table></figure><h1 id="整合mybatis-注解方式"><a href="#整合mybatis-注解方式" class="headerlink" title="整合mybatis(注解方式)"></a>整合mybatis(注解方式)</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UsersMapper</span> </span>&#123;    <br><span class="hljs-meta">@Select(&quot;select *  from t_user where name = #&#123;name&#125;&quot;)</span>    <br><span class="hljs-function">User <span class="hljs-title">findUserByName</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;name&quot;)</span>String name)</span></span>;    <br><span class="hljs-meta">@Insert(&quot;insert  into t_user(name,password)values(#&#123;name&#125;,#&#123;password&#125;)&quot;)</span>    <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">addUser</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;name&quot;)</span>String name,<span class="hljs-meta">@Param(&quot;password&quot;)</span>String password)</span></span>;  <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="SpringSecurity-安全"><a href="#SpringSecurity-安全" class="headerlink" title="SpringSecurity(安全)"></a>SpringSecurity(安全)</h1><ul><li><p>与shiro类似，只不过类，名字不同而已</p></li><li><p>功能：认证，授权</p></li><li><p>以前使用拦截器,代码量很大，现在使用框架</p></li><li><p>功能权限，访问权限，菜单权限</p></li><li><p>AOP思想</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@EnableWebSecurity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebSecurityConfigurerAdapter</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">//首页都可以访问，其他不行,</span><br>        <span class="hljs-comment">// 授权的规则</span><br>        http.authorizeRequests()<br>                .antMatchers(<span class="hljs-string">&quot;/&quot;</span>).permitAll()<br>                .antMatchers(<span class="hljs-string">&quot;/level1/*&quot;</span>).hasRole(<span class="hljs-string">&quot;vip1&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level2/*&quot;</span>).hasRole(<span class="hljs-string">&quot;vip2&quot;</span>)<br>                .antMatchers(<span class="hljs-string">&quot;/level3/*&quot;</span>).hasRole(<span class="hljs-string">&quot;vip3&quot;</span>);<br>        <span class="hljs-comment">// 开启记住我功能</span><br>        <span class="hljs-comment">//http.rememberMe();</span><br>        http.rememberMe().rememberMeParameter(<span class="hljs-string">&quot;remeber&quot;</span>);<br>        <span class="hljs-comment">// 没有权限跳转到登录页面,</span><br>        <span class="hljs-comment">// 没有认证到/login，认证失败到/login?error ，是自带的login页面与逻辑是一个请求</span><br>        <span class="hljs-comment">//http.formLogin();</span><br>        <span class="hljs-comment">// 自定义登录页面，但提交的url之能是 /login，即mylogin html中action=/login</span><br>        <span class="hljs-comment">//http.formLogin().loginPage(&quot;/mylogin.html&quot;).loginProcessingUrl(&quot;/login&quot;) ;</span><br>        http.formLogin().loginPage(<span class="hljs-string">&quot;/mylogin.html&quot;</span>).usernameParameter(<span class="hljs-string">&quot;pwd&quot;</span>).loginProcessingUrl(<span class="hljs-string">&quot;/login&quot;</span>) ;<br>        <span class="hljs-comment">// 防止跨站攻击功能，自定义登录页面时使用</span><br>        http.csrf().disable();<br>        <span class="hljs-comment">// 开启注销功能 回去请求/logout</span><br>        http.logout().logoutSuccessUrl(<span class="hljs-string">&quot;/a&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">configure</span><span class="hljs-params">(AuthenticationManagerBuilder auth)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// 正常应该从数据库选择</span><br>        <span class="hljs-comment">// 若在数据库中按照此方式写入即可</span><br>        auth.inMemoryAuthentication().passwordEncoder(<span class="hljs-keyword">new</span> BCryptPasswordEncoder())<br>                .withUser(<span class="hljs-string">&quot;username&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;123456&quot;</span>)).roles(<span class="hljs-string">&quot;vip1&quot;</span>,<span class="hljs-string">&quot;vip2&quot;</span>)<br>                .and()<br>                .withUser(<span class="hljs-string">&quot;root&quot;</span>).password(<span class="hljs-keyword">new</span> BCryptPasswordEncoder().encode(<span class="hljs-string">&quot;123456&quot;</span>)).roles(<span class="hljs-string">&quot;vip3&quot;</span>,<span class="hljs-string">&quot;vip1&quot;</span>,<span class="hljs-string">&quot;vip2&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>自带登录部分，有登录页面，登录controller，</li><li>若要自己定义登录页面，html输入用户名username,pasword，remeberme到/login，注意需要关闭csrf，</li></ul><h1 id="整合Shiro"><a href="#整合Shiro" class="headerlink" title="整合Shiro"></a>整合Shiro</h1><p>Subject:用户</p><p>SecurityManager：管理所有用户</p><p>Realm：连接数据</p><p><img src="https://img-blog.csdn.net/20151205212625574" alt="img"></p><p><img src="https://img-blog.csdn.net/20151205210817437" alt="img"></p><p><img src="https://img-blog.csdn.net/20151205213147424" alt="img"></p><ul><li><p>```xml</p><dependency>              <groupId>org.apache.shiro</groupId>              <artifactId>shiro-spring</artifactId>              <version>1.4.1</version><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs java"><br>- 配置类<br><br>  ```java<br>  <span class="hljs-meta">@Configuration</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ShiroConfig</span> </span>&#123;<br>      <span class="hljs-meta">@Bean</span><br>      <span class="hljs-function"><span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title">shiroFilterFactoryBean</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;defaultWebSecurityManager&quot;)</span>DefaultWebSecurityManager securityManager)</span></span>&#123;<br>          ShiroFilterFactoryBean bean = <span class="hljs-keyword">new</span> ShiroFilterFactoryBean();<br>          <span class="hljs-comment">// 设置管理器</span><br>          bean.setSecurityManager(securityManager);<br>  <br>  <br>          <span class="hljs-comment">// 添加内置过滤器，判断当前用户的权限</span><br>          <span class="hljs-comment">/*</span><br><span class="hljs-comment">          * anon:无需认证</span><br><span class="hljs-comment">          * authc：必须认证</span><br><span class="hljs-comment">          * user：必须有记住我才能使用</span><br><span class="hljs-comment">          * perms：有对某个资源的权限才能</span><br><span class="hljs-comment">          * role：有某个角色才能</span><br><span class="hljs-comment">          * */</span><br>          Map&lt;String,String&gt; filter = <span class="hljs-keyword">new</span> LinkedHashMap&lt;&gt;();<br>          filter.put(<span class="hljs-string">&quot;/&quot;</span>,<span class="hljs-string">&quot;anon&quot;</span>);<br>          filter.put(<span class="hljs-string">&quot;/user/*&quot;</span>,<span class="hljs-string">&quot;authc&quot;</span>);<br>          filter.put(<span class="hljs-string">&quot;/user/add&quot;</span>,<span class="hljs-string">&quot;perms[user:add]&quot;</span>);<br>  <br>  <br>          bean.setFilterChainDefinitionMap(filter);<br>          <span class="hljs-comment">// 设置登录url，默认是/login.jsp，里面的登录逻辑还需要自己在controller中写，没有自带</span><br>  <span class="hljs-comment">//        bean.setLoginUrl(&quot;/登录.html&quot;);</span><br>  <span class="hljs-comment">//        bean.setUnauthorizedUrl(&quot;/未授权.html&quot;);</span><br>          <span class="hljs-keyword">return</span> bean;<br>  <br>      &#125;<br>      <span class="hljs-comment">// SecurityManager</span><br>      <span class="hljs-meta">@Bean</span><br>      <span class="hljs-function"><span class="hljs-keyword">public</span> DefaultWebSecurityManager <span class="hljs-title">defaultWebSecurityManager</span><span class="hljs-params">(<span class="hljs-meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span></span>&#123;<br>          DefaultWebSecurityManager securityManager = <span class="hljs-keyword">new</span> DefaultWebSecurityManager();<br>          <span class="hljs-comment">// 关联UserRealm</span><br>          securityManager.setRealm(userRealm);<br>          <span class="hljs-keyword">return</span> securityManager;<br>      &#125;<br>      <span class="hljs-comment">// 创建realm ，需要自定义,此时bean名字就是userRealm</span><br>      <span class="hljs-meta">@Bean</span><br>      <span class="hljs-function"><span class="hljs-keyword">public</span> UserRealm <span class="hljs-title">userRealm</span><span class="hljs-params">()</span></span>&#123;<br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserRealm();<br>      &#125;<br>  &#125;<br>  <br>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AuthorizingRealm</span></span>&#123;<br>  <span class="hljs-comment">//    @Autowired UserService userservice</span><br>      <span class="hljs-comment">// 进入页面时调用</span><br>      <span class="hljs-comment">//授权  经过后，用户数据库中的权限读取出来，付给subject</span><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title">doGetAuthorizationInfo</span><span class="hljs-params">(PrincipalCollection principalCollection)</span> </span>&#123;<br>          SimpleAuthorizationInfo info = <span class="hljs-keyword">new</span> SimpleAuthorizationInfo();<br>          info.addStringPermission(<span class="hljs-string">&quot;user:add&quot;</span>);<br>          <span class="hljs-comment">//拿到对象</span><br>          Subject subject= SecurityUtils.getSubject();<br>          <span class="hljs-comment">//User currentUser = (User)subject.getPrincipal()</span><br>          <span class="hljs-comment">// info.addStringPermissions(user.get权限); 数据库中直接字符串存储 user:add，一般都是按键权限，角色对应表</span><br>          <span class="hljs-keyword">return</span> info;<br>      &#125;<br>      <span class="hljs-comment">// 用户认证，经过后 用户有认证权限</span><br>      <span class="hljs-comment">// 登录是调用</span><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title">doGetAuthenticationInfo</span><span class="hljs-params">(AuthenticationToken authenticationToken)</span> <span class="hljs-keyword">throws</span> AuthenticationException </span>&#123;<br>          <span class="hljs-comment">//连接数据库</span><br>          UsernamePasswordToken token = (UsernamePasswordToken) authenticationToken;<br>  <span class="hljs-comment">//        User user = userService.queryUserByName(token.getUsername());</span><br>  <span class="hljs-comment">//        if(user==null)return null</span><br>  <br>          <span class="hljs-comment">// 密码认证</span><br>  <span class="hljs-comment">//        return new SimpleAuthenticationInfo(&quot;&quot;,user.getPassword(),&quot;&quot;);</span><br>          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SimpleAuthenticationInfo(<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></li><li><p>导入依赖并且写log4j.properties,</p></li></ul><h1 id="开源Springboot项目"><a href="#开源Springboot项目" class="headerlink" title="开源Springboot项目"></a>开源Springboot项目</h1><ul><li><a href="https://github.com/WinterChenS/my-site%EF%BC%8Chttps://demo.winterchen.com/">https://github.com/WinterChenS/my-site，https://demo.winterchen.com/</a></li></ul><h1 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h1><p>前后端分离：Vue+SpringBoot</p><ul><li>后端：后端控制，服务层，数据库</li><li>前端：前端控制，视图层</li><li>前后端交互  ====》API接口</li></ul><p>写代码时前后端需要及时交互，因此后端API需要及时更新</p><p>Swagger</p><ul><li>Restful API,API文档自动生成</li><li>可以在线测试</li><li>支持多种语言</li></ul><p>Springboot使用：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@EnableSwagger2</span> <span class="hljs-comment">// 开启swagger2</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwaggerConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket2</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()).groupName(<span class="hljs-string">&quot;B&quot;</span>);<br>    &#125;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">docket</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2).apiInfo(apiInfo()) <span class="hljs-comment">// 到这里默认扫描全部接口</span><br>                <span class="hljs-comment">// 配置api分组明，配置多个docket</span><br>                .groupName(<span class="hljs-string">&quot;分组A&quot;</span>)<br>                <span class="hljs-comment">// 开启或关闭 swagger2</span><br>                .enable(<span class="hljs-keyword">true</span>)<br>                <span class="hljs-comment">// 配置扫描的api接口</span><br>                .select()<br>                <span class="hljs-comment">// RequestHandlerSelectors.any()全部扫描</span><br>                <span class="hljs-comment">// RequestHandlerSelectors.none()不扫描</span><br>                <span class="hljs-comment">// RequestHandlerSelectors.withMethodAnnotation(RestController.class)注解扫描</span><br>                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">&quot;top.dean0731.helloworld.controller&quot;</span>))<br>                <span class="hljs-comment">// 过滤路径</span><br>                .paths(PathSelectors.ant(<span class="hljs-string">&quot;/user/add/**&quot;</span>))<br>                .build();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title">apiInfo</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiInfoBuilder().title(<span class="hljs-string">&quot;WEAF项目整合Swagger&quot;</span>)<br>                .description(<span class="hljs-string">&quot;SpringBoot整合Swagger，详细信息......&quot;</span>)<br>                .version(<span class="hljs-string">&quot;1.0&quot;</span>)<br>                .contact(<span class="hljs-keyword">new</span> Contact(<span class="hljs-string">&quot;啊啊啊啊&quot;</span>,<span class="hljs-string">&quot;blog.csdn.net&quot;</span>,<span class="hljs-string">&quot;aaa@gmail.com&quot;</span>))<br>                .license(<span class="hljs-string">&quot;The Apache License&quot;</span>)<br>                .licenseUrl(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)<br>                .build();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>访问:<a href="http://localhost/swagger-ui.html">http://localhost:/swagger-ui.html</a></p><h1 id="异步调用"><a href="#异步调用" class="headerlink" title="异步调用"></a>异步调用</h1><p>用户执行耗时工作：</p><ul><li>正常情况，直接等待，不能操作</li><li>多线程，后台主线程返回提示，子线程继续操作，自己实现</li><li>Spingboot的异步操作</li></ul><p>@@EnableAsync 启动类加上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java">Service <br>    <br><span class="hljs-meta">@Async</span>   <br><span class="hljs-function"><span class="hljs-keyword">public</span> Future&lt;String&gt;  <span class="hljs-title">doTask1</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;      <br>    System.out.println(<span class="hljs-string">&quot;---任务一---&quot;</span>);      <br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();        <br>    Thread.sleep(random.nextInt(<span class="hljs-number">10000</span>));      <br>        <span class="hljs-keyword">long</span> end = System.currentTimeMillis();      <br>    System.out.println(<span class="hljs-string">&quot;---任务一结束---耗时:&quot;</span>+(end-start));      <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AsyncResult&lt;String&gt;(<span class="hljs-string">&quot;任务一结束&quot;</span>);    <br>&#125;  <br><span class="hljs-function">Controller  </span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">async</span><span class="hljs-params">()</span><span class="hljs-keyword">throws</span> Exception</span>&#123;      <br>    System.out.println(<span class="hljs-string">&quot;---async---&quot;</span>);      <br>    <span class="hljs-keyword">long</span> start = System.currentTimeMillis();      <br>    Future&lt;String&gt;   task1 = service.doTask1();      <br>    Future&lt;String&gt;   task2 = service.doTask2();     <br>    Future&lt;String&gt;   task3 = service.doTask3();      <br>    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;        <br>        <span class="hljs-keyword">if</span>(task1.isDone()&amp;&amp;task2.isDone()&amp;&amp;task3.isDone())&#123;         <br>            <span class="hljs-keyword">break</span>;        <br>        &#125;       <br>        Thread.sleep(<span class="hljs-number">1000</span>);      <br>    &#125;      <br>    <span class="hljs-keyword">long</span> end = System.currentTimeMillis();         <br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;all  executed time:&quot;</span>+(start-end);    <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="整合email"><a href="#整合email" class="headerlink" title="整合email"></a>整合email</h1><p>163邮箱授权码直接写密码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">mail:</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">dean0731qq.com</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">xxxxx</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-string">smtp.qq.com</span><br>    <span class="hljs-attr">properties.mail.smtp.ssl.enable:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">EmailService</span></span>&#123;       <br>    <span class="hljs-meta">@Autowired</span>    <br>    <span class="hljs-keyword">private</span> JavaMailSender mailSender;   <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendSimpleMail</span><span class="hljs-params">(String sendTo, String content)</span> </span>&#123;      <br>        SimpleMailMessage message = <span class="hljs-keyword">new</span> SimpleMailMessage();<br>        message.setSubject(<span class="hljs-string">&quot;yyy&quot;</span>);<br>        message.setFrom(<span class="hljs-string">&quot;xxxx&quot;</span>);      <br>        message.setTo(sendTo);      <br>        message.setText(content);      <br>        mailSender.send(message);   <br>    &#125;  <br>    <span class="hljs-meta">@Override</span>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">mimeMail</span><span class="hljs-params">(String sendTo, String content)</span> </span>&#123;      <br>        MimeMessage m = mailSender.createMimeMessage();<br>        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(m,<span class="hljs-keyword">true</span>,<span class="hljs-string">&quot;utf-8&quot;</span>);<br>        helper.setSubject(<span class="hljs-string">&quot;xxx&quot;</span>)<br>        helper.setFrom(<span class="hljs-string">&quot;xxxx&quot;</span>);      <br>        helper.setTo(sendTo);      <br>        helper.setText(<span class="hljs-string">&quot;&lt;html&lt;/html&gt;&quot;</span>,<span class="hljs-keyword">true</span>);      <br>        <br>        helper.addAttachment(<span class="hljs-string">&quot;x,jpg&quot;</span>,<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;xxxxx&quot;</span>))<br>        mailSender.send(m);   <br>    &#125;  <br>&#125;  <br><span class="hljs-meta">@Controller</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmailController</span> </span>&#123;    <br>    <span class="hljs-meta">@Autowired</span>    <br>    <span class="hljs-keyword">private</span> EmailService service;    <br>    <span class="hljs-meta">@RequestMapping(&quot;/simple&quot;)</span>    <br>    <span class="hljs-meta">@ResponseBody</span>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sendEmail</span><span class="hljs-params">()</span></span>&#123;      <br>        service.sendSimpleMail(<span class="hljs-string">&quot;1028968939@qq.com&quot;</span>, <span class="hljs-string">&quot;测试邮件&quot;</span>, <span class="hljs-string">&quot;Hello  world!&quot;</span>);   <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;    <br>    &#125;  <br>&#125; <br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 模板邮件</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendTemplateMail</span><span class="hljs-params">(String sendTo, String title, String infoTemplate)</span> </span>&#123;<br>    MimeMessage msg = mailSender.createMimeMessage(); <br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">//true设置为mutlipart模式</span><br>        MimeMessageHelper helper = <span class="hljs-keyword">new</span> MimeMessageHelper(msg,<span class="hljs-keyword">true</span>);<br>        helper.setFrom(<span class="hljs-string">&quot;xxx&quot;</span>);<br>        helper.setTo(sendTo);<br>        helper.setSubject(title);<br>        <span class="hljs-comment">//封装模板数据</span><br>        Map&lt;String, Object&gt; model = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        model.put(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;dean&quot;</span>)<br>            <span class="hljs-comment">//model.put(&quot;path&quot;, &quot;img/d.png&quot;);</span><br>            <span class="hljs-comment">//得到模板</span><br>            Template template = freemarkerConfigurer.getConfiguration().getTemplate(infoTemplate);<br>        String html = FreeMarkerTemplateUtils.*processTemplateIntoString*(template, model);<br>        helper.setText(html,<span class="hljs-keyword">true</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (MessagingException | IOException e) &#123;<br>        e.printStackTrace();<br>    &#125; <span class="hljs-keyword">catch</span> (TemplateException e) &#123;<br>        e.printStackTrace();<br><br>    &#125;<br>    mailSender.send(msg);<br>&#125;  <br></code></pre></td></tr></table></figure><h1 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h1><ul><li>@EnableScheduling 开启定时任务 启动类加上</li><li>@Scheduled 什么时候执行</li><li>TaskScheduler 调度者</li><li>TaskExecutor 执行者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-comment">// 要求在某一时间执行</span><br><span class="hljs-meta">@Scheduled(&quot;cron表达式，与linux相同秒：分 时 日 月 周&quot;)</span><br><span class="hljs-meta">@Scheduled(&quot;* * * * * ?&quot;)</span><span class="hljs-comment">// 每秒一次</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">service</span><span class="hljs-params">()</span></span>&#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><h1 id="整合redis"><a href="#整合redis" class="headerlink" title="整合redis"></a>整合redis</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">spring</span><br> <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-comment"># 集群</span><br>    <span class="hljs-attr">cluster:</span><br><br>    <span class="hljs-comment"># Springboot 2.0 之后连接池用 lettuce</span><br>    <span class="hljs-attr">lettuce:</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@service</span><br><br><span class="hljs-meta">@AutoWired</span><br><span class="hljs-meta">@RedisTemplate</span> <span class="hljs-function">template</span><br><span class="hljs-function">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-comment">// 原生操作</span><br>    <span class="hljs-comment">//template.opsForList()</span><br>    <span class="hljs-comment">//template.opsForZSet() </span><br>    <span class="hljs-comment">// 常用方法，事物，增删改查等</span><br>        <span class="hljs-comment">// 获取链接</span><br>        <span class="hljs-comment">//RedisConnect con = template.getConnectionFactory().getConnection();</span><br>        <span class="hljs-comment">//con.flushDb();</span><br>        <span class="hljs-comment">//con.flushAll()</span><br>    template.opsValue().set(<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;value&#x27;</span>)    <br>    template.opsValue().get(<span class="hljs-string">&#x27;key&#x27;</span>)  <br>    <span class="hljs-comment">// 真实场景，对象写入redis需要序列化，所以 model一般都回实现序列化接口</span><br>&#125;<br></code></pre></td></tr></table></figure><p>Springboot中的RedisTemplate完成了自己的序列化，</p><p>不能识别，因为RedisTemplate的序列化方式不完善，是JDK自己的序列化，此时redis查看的字符会转义</p><p>要自己定义，解决问题，</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span></span>&#123;<br>        <span class="hljs-comment">// 为了开放方便 使用 string，object</span><br>        RedisTemplate&lt;String,Object&gt; template = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();<br>        template.setConnectionFactory(redisConnectionFactory);<br><br>        StringRedisSerializer stringRedisSerializer = <span class="hljs-keyword">new</span> StringRedisSerializer();<br><br>        Jackson2JsonRedisSerializer jack =<span class="hljs-keyword">new</span> Jackson2JsonRedisSerializer(Object.class);<br>        <span class="hljs-comment">// 对象转义</span><br>        ObjectMapper om = <span class="hljs-keyword">new</span> ObjectMapper();<br>        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);<br>        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);<br><span class="hljs-comment">//        om.activateDefaultTyping(); 2.10之后使用这个</span><br>        jack.setObjectMapper(om);<br><br><br>        <span class="hljs-comment">// 设置key的序列化方式</span><br>        template.setKeySerializer(stringRedisSerializer);<br>        template.setHashKeySerializer(stringRedisSerializer);<br>        <span class="hljs-comment">// 设置value的序列化方式</span><br>        template.setValueSerializer(jack);<br>        template.setHashValueSerializer(jack);<br>        template.afterPropertiesSet();<br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="zookeeeper"><a href="#zookeeeper" class="headerlink" title="zookeeeper"></a>zookeeeper</h1><ul><li>分布式应用程序协调服务</li><li>是hadoop与hbase的重要组件</li><li>为分布式应用提供一致性服务的软件<ul><li>配置维护</li><li>域名服务</li><li>分布式同步</li><li>组服务 ，例如服务的注册与发现</li></ul></li></ul><p>windows下使用：</p><ul><li><p>下载 </p></li><li><p>运行 ~/bin/zKserver.cmd</p><ul><li>java环境要配置好classpath等等</li><li>conf/zoo_simple.cfg 复制到conf/zoo.cfg 默认端口2181</li></ul></li><li><p>~/bin/zkCli.cmd 客户端连接</p><ul><li>```shell<br>ls /<br>create /firstname 123 # 创建节点<br>get /fristname # 查看节点内容<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs dts"><br><span class="hljs-meta"># 分布式</span><br><br><br><br>- 网络之上的软件系统<br><br>- 原来的分布式，全部的业务放在一个机器上，机器之间安全相同，nginx做负载均衡<br>  - 有些流程很简单，有些复杂<br>  - 机器利用率不高<br><br>![image<span class="hljs-number">-20200817155613692</span>](https:<span class="hljs-comment">//i.loli.net/2020/08/17/DISZnHsgpcdAuFW.png)</span><br><br>小型网站<br><br>![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/dJQkO9AsemfTaZw.png)</span><br><br>现在的小型网站，功能呢模块无法利用<br><br>![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/OwSovyTHtAZXisx.png)</span><br><br>分布式架构，提取公共模块<br><br>![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/XAxcZj7u1UvqmHG.png)</span><br><br>现在流行的分布式<br><br>![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/Va4h6sI7lbpQDKB.png)</span><br><br><span class="hljs-params">&lt;font color=red&gt;</span>基础就是微服务架构<span class="hljs-params">&lt;/font&gt;</span><br><br>Dubbo + Zookeeper +Springboot<br><br>![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/Mx19qWhsIdNa5y6.png)</span><br><br><span class="hljs-meta"># RPC</span><br><br>- 远程过程调用<br>- 电脑一A方法调用电脑二B方法<br>- 核心模块<br>  - 通信<br>  - 序列化<br><br><span class="hljs-meta"># dubbo</span><br><br>- 高性能，轻量级 javaRPC框架<br>- 面向接口的远程方法调用<br>- 智能容错与负载均衡<br>- 服务自动注册与发现，使用zookeeper<br>- ![img](https:<span class="hljs-comment">//i.loli.net/2020/08/17/oWC7Nhl2fKBQV6m.png)</span><br>- 使用监控管理后台dubbo-admin，可以不要<br>  - github下载，是个Springboot项目<br>  - 修改配置文件application.properties <br>    - 按需要修改默认端口<br>    - 后台端口<span class="hljs-number">7001</span>  root，root<br>    - dubbo.registry.address=zookeeper:<span class="hljs-comment">//ip:port</span><br>  - 打包该项目 mvn clean package -Dmaven.test.skip=true<br>  - 生成jar<br><br>服务提供者：可以理解为一些后端项目APi接口<br><br>```xml<br><span class="hljs-params">&lt;dependency&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>org.apache.dubbo<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>dubbo-spring-boot-starter<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">2.7</span><span class="hljs-number">.7</span><span class="hljs-params">&lt;/version&gt;</span><br><span class="hljs-params">&lt;/dependency&gt;</span><br><span class="hljs-params">&lt;dependency&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>com.github.sgroschupf<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>zkclient<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">0.1</span><span class="hljs-params">&lt;/version&gt;</span><br><span class="hljs-params">&lt;/dependency&gt;</span><br><span class="hljs-params">&lt;dependency&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>org.apache.curator<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>curator-framework<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">5.1</span><span class="hljs-number">.0</span><span class="hljs-params">&lt;/version&gt;</span><br><span class="hljs-params">&lt;/dependency&gt;</span><br><span class="hljs-params">&lt;dependency&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>org.apache.curator<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>curator-recipes<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">5.1</span><span class="hljs-number">.0</span><span class="hljs-params">&lt;/version&gt;</span><br><span class="hljs-params">&lt;/dependency&gt;</span><br><span class="hljs-params">&lt;dependency&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>org.apache.zookeeper<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>zookeeper<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;version&gt;</span><span class="hljs-number">3.6</span><span class="hljs-number">.1</span><span class="hljs-params">&lt;/version&gt;</span><br><span class="hljs-params">&lt;exclusions&gt;</span><br><span class="hljs-params">&lt;!-- 与springboot日志冲突,排除--&gt;</span><br><span class="hljs-params">&lt;exclusion&gt;</span><br><span class="hljs-params">&lt;groupId&gt;</span>org.slf4j<span class="hljs-params">&lt;/groupId&gt;</span><br><span class="hljs-params">&lt;artifactId&gt;</span>slf4j-log4j12<span class="hljs-params">&lt;/artifactId&gt;</span><br><span class="hljs-params">&lt;/exclusion&gt;</span><br><span class="hljs-params">&lt;/exclusions&gt;</span><br><span class="hljs-params">&lt;/dependency&gt;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dubbo:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">provider-server1</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">zookeeper://127.0.0.1:2181</span><br>  <span class="hljs-attr">scan:</span><br>    <span class="hljs-attr">base-packages:</span> <span class="hljs-string">top.dean0731.helloworld.service</span> <span class="hljs-comment"># 服务</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//service</span><br><span class="hljs-meta">@DubboService</span> <span class="hljs-comment">// dubbo的service ，启动时可以被扫描注册到注册中心</span><br><span class="hljs-meta">@Component</span> <span class="hljs-comment">// spring 的万能注解</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserserviceImpl</span> <span class="hljs-title">implement</span> <span class="hljs-title">UserService</span></span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">service1</span><span class="hljs-params">()</span></span>&#123;&#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span></span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">service1</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>启动zookeeper 端口2181</li><li>启动dubbo监控 端口7001</li><li>启动项目服务端dubbo，此时该服务的访问地址是 ip：20880<ul><li>注意此时暴露在外面的是service，不是controller，要访问controller还是8080</li></ul></li><li>启动customer</li></ul><p>客户端使用：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">同上<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">dubbo:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">consumer-1</span><br>  <span class="hljs-attr">registry:</span><br>    <span class="hljs-attr">address:</span> <span class="hljs-string">zookeeper://127.0.0.1:2181</span><br>  <span class="hljs-attr">scan:</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@DubboService</span> <span class="hljs-comment">//dubbo的service 放到容器中</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> 调用<span class="hljs-title">Service</span></span>&#123; <span class="hljs-comment">// </span><br>    <span class="hljs-meta">@Reference</span> <span class="hljs-comment">//dubbo的reference</span><br>    UserService service; <span class="hljs-comment">//路径相同建立UserService类或者使用pom坐标</span><br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> 使用()&#123;<br>        String s= service.service1()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h1><ul><li><p>(架包默认添加是logback) 若想更改logback:加入全局配置文件</p></li><li><p>其他日志系统使用时只用把配置问价放在src下即可,不用全局配置文件</p></li></ul><ul><li>默认info级别信息<ul><li>Trace,debug,info,warn,error,fatal,off从低到高:设置为warn,低与warn的不会输出</li><li>root日志以warn级别即以上输出</li><li>springframework.web日主以debug级别输出</li></ul></li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">Logging.level.root</span>=<span class="hljs-string">warn</span><br><span class="hljs-meta">Logging.level.org.springframework.web</span>=<span class="hljs-string">debug  </span><br></code></pre></td></tr></table></figure><h2 id="自定义日志配置"><a href="#自定义日志配置" class="headerlink" title="自定义日志配置"></a>自定义日志配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot;  encoding=&quot;utf-8&quot;?&gt;</span><br><span class="hljs-comment">&lt;!-- 发生改变时:重新加载, 每间隔60s扫描一下,是否改变  ,de<span class="hljs-doctag">bug:</span>打印内部日志信息 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span>  <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;60 seconds&quot;</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 上下文名字 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">contextName</span>&gt;</span>logback<span class="hljs-tag">&lt;/<span class="hljs-name">contextName</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 定义变量 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;log.path&quot;</span>  <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;G:\\soft_doc\\Myeclispe_Project\\info.log&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 输出到控制台 --&gt;</span><br>    <br><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;console&quot;</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span>            <br>    <span class="hljs-comment">&lt;!-- 默认日志过滤器 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span>            <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span>  --&gt;<br>    <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125;%contextName[%thread]%-5level%logger&#123;36&#125; -%msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <br><span class="hljs-comment">&lt;!-- 输出到文本 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;file&quot;</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;log.path&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 日志问价切割策略 :每天一个日志--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span>                     <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/logback.%d&#123;yyyy-MM-dd&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span>           <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125;%contextName[%thread]%-5level%logger&#123;36&#125; -%msg%n<br><span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;info&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;file&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-comment">&lt;!-- logback为java中的包单独设置日志级别 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.dzf.controller&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!-- 具体到类:设置新的级别,是否向上级传递打印信息 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;com.dzf.controller.SpringController&quot;</span>  <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;warn&quot;</span> <span class="hljs-attr">additivity</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>             <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;console&quot;</span>/&gt;</span>                 <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">logger</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="使用log4j日志管理-去掉logback"><a href="#使用log4j日志管理-去掉logback" class="headerlink" title="使用log4j日志管理,去掉logback"></a>使用log4j日志管理,去掉logback</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml">  <span class="hljs-comment">&lt;!-- 取出日志文件logback --&gt;</span>  <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>                    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>                         <br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                   <br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>           <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>           <br><span class="hljs-comment">&lt;!-- 添加loj4j  --&gt;</span>           <br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.8.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>           <br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>  <br></code></pre></td></tr></table></figure><p>2,log4j.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">#############</span><br><span class="hljs-comment"># 输出到控制台</span><br><span class="hljs-comment">#############</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># log4j.rootLogger日志输出类别和级别：只输出不低于该级别的日志信息DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL</span><br><span class="hljs-comment"># WARN：日志级别     CONSOLE：输出位置自己定义的一个名字       logfile：输出位置自己定义的一个名字</span><br><span class="hljs-meta">log4j.rootLogger</span>=<span class="hljs-string">WARN,CONSOLE,logfile</span><br><span class="hljs-comment"># 配置CONSOLE输出到控制台</span><br><span class="hljs-meta">log4j.appender.CONSOLE</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender </span><br><span class="hljs-comment"># 配置CONSOLE设置为自定义布局模式</span><br><span class="hljs-meta">log4j.appender.CONSOLE.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout </span><br><span class="hljs-comment"># 配置CONSOLE日志的输出格式  [frame] 2019-08-22 22:52:12,000  %r耗费毫秒数 %p日志的优先级 %t线程名 %C所属类名通常为全类名 %L代码中的行号 %x线程相关联的NDC %m日志 %n换行</span><br><span class="hljs-meta">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="hljs-string">[frame] %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; - %-4r %-5p [%t] %C:%L %x - %m%n</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">################</span><br><span class="hljs-comment"># 输出到日志文件中</span><br><span class="hljs-comment">################</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 配置logfile输出到文件中 文件大小到达指定尺寸的时候产生新的日志文件</span><br><span class="hljs-meta">log4j.appender.logfile</span>=<span class="hljs-string">org.apache.log4j.RollingFileAppender</span><br><span class="hljs-comment"># 保存编码格式</span><br><span class="hljs-meta">log4j.appender.logfile.Encoding</span>=<span class="hljs-string">UTF-8</span><br><span class="hljs-comment"># 输出文件位置此为项目根目录下的logs文件夹中</span><br><span class="hljs-meta">log4j.appender.logfile.File</span>=<span class="hljs-string">logs/root.log</span><br><span class="hljs-comment"># 后缀可以是KB,MB,GB达到该大小后创建新的日志文件</span><br><span class="hljs-meta">log4j.appender.logfile.MaxFileSize</span>=<span class="hljs-string">10MB</span><br><span class="hljs-comment"># 设置滚定文件的最大值3 指可以产生root.log.1、root.log.2、root.log.3和root.log四个日志文件</span><br><span class="hljs-meta">log4j.appender.logfile.MaxBackupIndex</span>=<span class="hljs-string">3  </span><br><span class="hljs-comment"># 配置logfile为自定义布局模式</span><br><span class="hljs-meta">log4j.appender.logfile.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-meta">log4j.appender.logfile.layout.ConversionPattern</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd HH:mm:ss&#125; %F %p %m%n</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">##########################</span><br><span class="hljs-comment"># 对不同的类输出不同的日志文件</span><br><span class="hljs-comment">##########################</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># club.bagedate包下的日志单独输出</span><br><span class="hljs-meta">log4j.logger.club.bagedate</span>=<span class="hljs-string">DEBUG,bagedate</span><br><span class="hljs-comment"># 设置为false该日志信息就不会加入到rootLogger中了</span><br><span class="hljs-meta">log4j.additivity.club.bagedate</span>=<span class="hljs-string">false</span><br><span class="hljs-comment"># 下面就和上面配置一样了</span><br><span class="hljs-meta">log4j.appender.bagedate</span>=<span class="hljs-string">org.apache.log4j.RollingFileAppender</span><br><span class="hljs-meta">log4j.appender.bagedate.Encoding</span>=<span class="hljs-string">UTF-8</span><br><span class="hljs-meta">log4j.appender.bagedate.File</span>=<span class="hljs-string">logs/bagedate.log</span><br><span class="hljs-meta">log4j.appender.bagedate.MaxFileSize</span>=<span class="hljs-string">10MB</span><br><span class="hljs-meta">log4j.appender.bagedate.MaxBackupIndex</span>=<span class="hljs-string">3</span><br><span class="hljs-meta">log4j.appender.bagedate.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-meta">log4j.appender.bagedate.layout.ConversionPattern</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd HH:mm:ss&#125; %F %p %m%n</span><br></code></pre></td></tr></table></figure><h2 id="自定义消息转换器"><a href="#自定义消息转换器" class="headerlink" title="自定义消息转换器"></a>自定义消息转换器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>    <br><span class="hljs-function"><span class="hljs-keyword">private</span> StringHttpMessageConverter  <span class="hljs-title">converter</span><span class="hljs-params">()</span></span>&#123;      <br>    StringHttpMessageConverter converter = <span class="hljs-keyword">new</span><br>    StringHttpMessageConverter(Charset.*forName*(<span class="hljs-string">&quot;utf-8&quot;</span>));     <br>    <span class="hljs-keyword">return</span> converter;    <br>&#125;  <br></code></pre></td></tr></table></figure><h1 id="使用FastJson解析json"><a href="#使用FastJson解析json" class="headerlink" title="使用FastJson解析json"></a>使用FastJson解析json</h1><p>配置FastJson</p><p>1,在MyWebConfig中重写</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>    <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span>  <span class="hljs-title">configureMessageConverters</span><span class="hljs-params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;      <span class="hljs-comment">//创建fastjson消息解析器      </span><br>    FastJsonHttpMessageConverter converter = <span class="hljs-keyword">new</span>  FastJsonHttpMessageConverter();      <br>    <span class="hljs-comment">//创建fastjson的配置对象      </span><br>    FastJsonConfig config = <span class="hljs-keyword">new</span> FastJsonConfig();      <br>    <span class="hljs-comment">//对json数据进行格式化 </span><br>    config.setSerializerFeatures(SerializerFeature.PrettyFormat);<br>    converter.setFastJsonConfig(config);      <br>    converters.add(converter);    <br>&#125;  <br><br><span class="hljs-meta">@Bean</span>    <br><span class="hljs-function"><span class="hljs-keyword">public</span> HttpMessageConverters  <span class="hljs-title">fastJsonMessageConverter</span><span class="hljs-params">()</span></span>&#123;      <br>    <span class="hljs-comment">//创建fastjson消息解析器      </span><br>    FastJsonHttpMessageConverter converter = <span class="hljs-keyword">new</span>  FastJsonHttpMessageConverter();      <br>    <span class="hljs-comment">//创建fastjson的配置对象      </span><br>    FastJsonConfig config = <span class="hljs-keyword">new</span> FastJsonConfig();      <br>    <span class="hljs-comment">//对json数据进行格式化 </span><br>    config.setSerializerFeatures(SerializerFeature.PrettyFormat);<br>    converter.setFastJsonConfig(config);      <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HttpMessageConverters(converter);   <br>&#125;  <br></code></pre></td></tr></table></figure><h1 id="现在和未来"><a href="#现在和未来" class="headerlink" title="现在和未来"></a>现在和未来</h1><p>回顾以前：架构</p><ul><li><p>三层架构MVC</p><ul><li>解耦合</li></ul></li><li><p>开发框架</p><ul><li>spring<ul><li>IOC</li><li>AOP<ul><li>切面，动态代理</li><li>不影响业务情况下增加功能</li><li>日志，事物等</li></ul></li><li>轻量级java开源容器</li><li>解决开发复杂性</li></ul></li><li>Springboot<ul><li>不是新东西，就是Spring的升级版</li><li>新一代JAVAEE开发标准，开箱即用</li><li>自动配置了很多</li></ul></li></ul></li><li><p> 微服务架构</p></li><li><p>模块化，功能化</p><ul><li>原来是所有功能在一起，签到，支付，娱乐</li><li>人多，</li><li>横向增加机器</li><li>签到多，支付少—–》模块化</li></ul></li><li><p>微服务架构问题，因为网络不可靠</p><ul><li><font color=red>服务很多，客户端如何访问？API网关，服务路由</font></li><li><font color=red>服务很多，服务之间如何通信 ，RPC框架，异步调用</font></li><li><font color=red>服务很多，如何治理 ,服务注册与发现，高可用</font></li><li><font color=red>服务挂了，咋办 ？熔断机制，服务降级</font></li></ul></li><li><p>解决方案</p><ul><li><p>SpringCloud，生态圈，解决上边4个问题，SpringCloud基于SpringBoot</p></li><li><p>方案一：SpringCloud netfix ，一站式解决方案，但2018年底无限期不再维护</p><ul><li>api网关 zuul组件</li><li>Feign –》httpclient—》http的通信方式，同步阻塞</li><li>服务注册与发现：Eureka</li><li>熔断机制：hystrix</li></ul></li><li><p>方案二：<font color=red>Apache Dubbo zookeeper</font>，本来是不维护了，后来又维护了，</p><ul><li><p>API：没有，第三方组件</p></li><li><p>dubbo，高性能RPC框架</p></li><li><p>服务注册与发现，zookeeper；</p></li><li><p>没有，借助了hystrix</p><p>dubbo3.0还为出现，预览中，有很多新东西</p></li></ul></li><li><p><font color=red>方案三：SpringCloud Alibaba，一站式解决方案</font></p></li><li><p>服务网格，下一代微服务架构 Server mesh</p><ul><li>对应方案：istio</li></ul></li></ul></li></ul><p>​    Springboot视频地址：<a href="https://www.bilibili.com/video/BV1PE411i7CV">https://www.bilibili.com/video/BV1PE411i7CV</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Selenium/"/>
    <url>/2022/01/16/cnblog/Selenium/</url>
    
    <content type="html"><![CDATA[<p>1，下载浏览器chrome<br>2，驱动下载：<a href="http://npm.taobao.org/mirrors/chromedriver/">http://npm.taobao.org/mirrors/chromedriver/</a> 对应版本下载后放入path</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.chrome.options <span class="hljs-keyword">import</span> Options<br><span class="hljs-keyword">import</span> time,os<br>chrome_opt = Options()      <span class="hljs-comment"># 创建参数设置对象.</span><br>chrome_opt.add_argument(<span class="hljs-string">&#x27;--no-sandbox&#x27;</span>) <span class="hljs-comment"># 允许root</span><br>chrome_opt.add_argument(<span class="hljs-string">&#x27;--headless&#x27;</span>)   <span class="hljs-comment"># 无界面化.</span><br>chrome_opt.add_argument(<span class="hljs-string">&#x27;--disable-gpu&#x27;</span>)    <span class="hljs-comment"># 配合上面的无界面化.</span><br>chrome_opt.add_argument(<span class="hljs-string">&#x27;--window-size=1366,768&#x27;</span>)   <span class="hljs-comment"># 设置窗口大小, 窗口大小会有影响.</span><br><br><br>driver = webdriver.Chrome(chrome_options=chrome_opt)  <span class="hljs-comment"># 创建Chrome对象并传入设置信息.</span><br>driver.get(<span class="hljs-string">&#x27;https://www.baidu.com&#x27;</span>)     <span class="hljs-comment"># get方式访问百度.</span><br>name = driver.find_element_by_name(<span class="hljs-string">&#x27;uid&#x27;</span>)<br>passwd = driver.find_element_by_name(<span class="hljs-string">&#x27;upw&#x27;</span>)<br>submit = driver.find_element_by_name(<span class="hljs-string">&#x27;smbtn&#x27;</span>)<br><br>driver.execute_script(<span class="hljs-string">&quot;arguments[0].value = &#x27;name&#x27;;&quot;</span>, name)<br>driver.execute_script(<span class="hljs-string">&quot;arguments[0].value = &#x27;passwd&#x27;;&quot;</span>, passwd)<br>submit.click()<br>iframe = driver.find_element_by_name(<span class="hljs-string">&#x27;zzj_top_6s&#x27;</span>)<br>src = iframe.get_attribute(<span class="hljs-string">&#x27;src&#x27;</span>)<br>driver.get(src)<br><br>submit2 = driver.find_element_by_xpath(<span class="hljs-string">&#x27;//*[@id=&quot;bak_0&quot;]/div[13]/div[3]/div[4]&#x27;</span>)<br>submit2.click()<br><br>submit3 = driver.find_element_by_xpath(<span class="hljs-string">&#x27;/html/body/form/div[3]/div[4]&#x27;</span>)<br>submit3.click()<br><br><span class="hljs-built_in">print</span>(driver.page_source)       <span class="hljs-comment"># 打印加载的page code, 证明(prove) program is right.</span><br>driver.quit()   <span class="hljs-comment"># 使用完, 记得关闭浏览器, 不然chromedriver.exe进程为一直在内存中.</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/RSA/"/>
    <url>/2022/01/16/cnblog/RSA/</url>
    
    <content type="html"><![CDATA[<h1 id="RSA�㷨"><a href="#RSA�㷨" class="headerlink" title="RSA�㷨"></a>RSA�㷨</h1><p>�ǶԳƼ����㷨��һ��</p><ul><li>����ѡ�������������p��q��p������q������N=pq��</li><li>����ŷ��������������N����N���ʵ�����������(p-1)(q-1)��</li><li> ѡ��һ������e��(p-1)(q-1)���ʣ�����eС��(p-1)(q-1)��</li><li>�����������ʽ����d��d�� e �� 1 (mod (p-1)(q-1))�� (d*e)%((p-1)(q-1))=1</li><li>��p��q�ļ�¼���١�</li><li>���������У�(N,e)�ǹ�Կ��(N,d)��˽Կ��</li></ul><h6 id="��Կ����תΪString"><a href="#��Կ����תΪString" class="headerlink" title="��Կ����תΪString"></a>��Կ����תΪString</h6><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">byte</span>[] keyByte=(Key)publicKey.getEncoded();<br>String key=Base64.getEncoder().encodeToString(keyByte); <br></code></pre></td></tr></table></figure><h6 id="String-ת��Կ����"><a href="#String-ת��Կ����" class="headerlink" title="String ת��Կ����"></a>String ת��Կ����</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">byte</span>[] keyBytes = Base64.getDecoder().decode(key);   <span class="hljs-comment">//�ν� ��ת��byte[]</span><br>X509EncodedKeySpec x509KeySpec = <span class="hljs-keyword">new</span> X509EncodedKeySpec(keyBytes);        <br>KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM); <span class="hljs-comment">//RSA�㷨      </span><br>Key publicK = keyFactory.generatePublic(x509KeySpec);  <br></code></pre></td></tr></table></figure><h6 id="˽ԿתString"><a href="#˽ԿתString" class="headerlink" title="˽ԿתString"></a>˽ԿתString</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">byte</span>[] keyByte=(Key)privateKey.getEncoded();<br>String key=Base64.getEncoder().encodeToString(keyByte); <br></code></pre></td></tr></table></figure><h6 id="Stringת˽Կ"><a href="#Stringת˽Կ" class="headerlink" title="Stringת˽Կ"></a>Stringת˽Կ</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">byte</span>[] keyBytes = Base64.getDecoder().decode(key); <span class="hljs-comment">//��ת��byte[]</span><br>PKCS8EncodedKeySpec pkcs8KeySpec = <span class="hljs-keyword">new</span> PKCS8EncodedKeySpec(keyBytes);        <br>KeyFactory keyFactory = KeyFactory.getInstance(KEY_ALGORITHM);        <br>Key privateK = keyFactory.generatePrivate(pkcs8KeySpec);  <br></code></pre></td></tr></table></figure><h1 id="������A-B����y��һ����Կ"><a href="#������A-B����y��һ����Կ" class="headerlink" title="������A,B����ÿ��һ����Կ"></a>������A,B����ÿ��һ����Կ</h1><p>prkA,pukA,prkB,pukB��A��B������Ϣ</p><ul><li><p>A��B�Ĺ�Կ���м���</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Cipher cipher = Cipher.getInstance(keyFactory.getAlgorithm());        <br>cipher.init(Cipher.ENCRYPT_MODE, pukB);   <br><span class="hljs-keyword">byte</span>[]data = cipher.doFinal(data, <span class="hljs-number">0</span>, data.length());  <br><span class="hljs-comment">//���ܺ�����(ȫΪ����),encodetoString()תΪ�ַ�,</span><br><span class="hljs-comment">//ע:Ҳ����ѭ���ֶμ���,��������,ÿ��Ϊһ��byte[],д������(ByteArrayOutputStream),����������byte[] </span><br></code></pre></td></tr></table></figure></li><li><p>A��A��˽Կ����ǩ��(д������) ע:signΪbyte[]����</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM);  <span class="hljs-comment">//ǩ���㷨     </span><br>signature.initSign(prkA);        <br>signature.update(data);   <br>signature.sign()����ǩ��<span class="hljs-keyword">byte</span>[] ͬ�Ͽ�תΪ�ַ���.<br></code></pre></td></tr></table></figure><ul><li>B���Լ���˽Կ���н���<div class="code-wrapper"><pre><code class="hljs">ͬ���ܹ��� ע����ܷ���byte[](��ת��string) ����Ҳ��Ҫbyte[](ע�����ת��)</code></pre></div></li><li>���ݽ�������,��A�Ĺ�Կ������֤</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM);        <br>signature.initVerify(publicKey);        <br>signature.update(data);   <br>signature.verify(Base64.getDecoder().decode(sign)); <br><span class="hljs-comment">//ע����֤ʱ���ṩ��������,A��ǩ��sign(ע��String����byte[]),�Լ�A�Ĺ�Կ ����boolean</span><br></code></pre></td></tr></table></figure><p>?        </p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/redis/"/>
    <url>/2022/01/16/cnblog/redis/</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>(redis.memcache(内存数据库,高速缓存),mongodb(文档数据库))</p><h6 id="入门概述"><a href="#入门概述" class="headerlink" title="入门概述"></a>入门概述</h6><ul><li>Nosql(not noly sql) 数据之间无关系,容易扩展 速度快:读11w,写8w</li></ul><ul><li>RDBMS VS NOSQL<ul><li>Rdbms:acid</li><li>Nosql:cap定理,键值对存储,</li><li>组成:Kv,Cache,Persistence</li></ul></li></ul><h6 id="3v-3高"><a href="#3v-3高" class="headerlink" title="3v+3高"></a>3v+3高</h6><ul><li><p>海量volume</p></li><li><p>多样variety</p></li><li><p>实时velocity</p></li><li><p>高并发,</p></li><li><p>高扩展,</p></li><li><p>高性能</p></li></ul><h1 id="Nosql的经典应用"><a href="#Nosql的经典应用" class="headerlink" title="Nosql的经典应用"></a>Nosql的经典应用</h1><p>阿里sql 与nosql商品信息的存放</p><ul><li>第一代1999:Perl,CGI,Oracle</li></ul><ul><li><p>2000java时代:JAVA,servlet</p></li><li><p>2001-2004:EJB(SLSB,CMP,MDB) pattern(servletLocator,Delegate,Façade,DAO,DTO)</p></li><li><p>2005-2007:EJB重构:spring+ibatis+webx,antx(struts前身)</p><ul><li>底层架构:iSearch,MQ+ESB,数据挖掘,CMS</li></ul></li><li><p>2008-2009:Memcached集群,mysql+数据切分=cobar</p></li><li><p>2010:安全,镜像,应用服务器升级,秒杀,nosql,SSD</p></li><li><p>第四代:解决性能和海量数据问题</p><ul><li>大规模memcached集群,高性能服务器,kv,cnd</li><li>安全问题:镜像站</li></ul></li><li><p>第五代2011:敏捷,开放,体验</p></li></ul><p>去IOE(去除IBM小型机,oracle数据库,EMC存储设备)-云计算</p><h2 id="Nosql数据模型简介"><a href="#Nosql数据模型简介" class="headerlink" title="Nosql数据模型简介"></a>Nosql数据模型简介</h2><ul><li>Kv键值</li><li>Bson</li><li>列簇</li><li>图形</li></ul><h2 id="Nosql数据库的四大分类"><a href="#Nosql数据库的四大分类" class="headerlink" title="Nosql数据库的四大分类"></a>Nosql数据库的四大分类</h2><ul><li><p>Kv键值</p><ul><li>新浪:Berkeley+redis</li><li>美团:redis+tair</li><li>阿里,百度:memcache+redis</li></ul></li><li><p>文档数据库</p><ul><li>bson:mongodb</li></ul></li><li><p>列存储数据库</p><ul><li>Cassandra,Hbase,分布式文件系统</li></ul></li><li><p>图关系数据库</p><ul><li>社交网络,关系图,neo4j,infoGrid</li></ul></li></ul><p><img src="https://i.loli.net/2020/09/12/W81COBKUJMvulGE.png" alt="image-20200912203507645"></p><p><img src="https://i.loli.net/2020/09/12/Gguasz4yDvTPWcC.png" alt="image-20200912203529570"></p><h1 id="在分布式数据库中CAP原理"><a href="#在分布式数据库中CAP原理" class="headerlink" title="在分布式数据库中CAP原理"></a>在分布式数据库中CAP原理</h1><ul><li><p>ACID</p><ul><li>  A(Atomicity)原子性</li><li>  C(Consistency)一致性</li><li>  I(Isolation)独立性</li><li>  D(Durability)持久性</li></ul></li><li><p>CAP</p><ul><li>  C(Consistency)强一致性</li><li>  A(Availability)可用性</li><li>  P(Partition tolerance)分区容错性</li></ul></li><li><p>CAP的3选2(注意)不能同时满足三个</p><ul><li>  CA:单点集群,一致性,可用性</li><li>  CP:一致性,分区容错,性能不是特别高</li><li>  AP:可用性,分区容错,对一致性要求低:用的较多</li></ul></li><li><p>  经典CAP图</p></li></ul><p><img src="https://i.loli.net/2020/09/12/SLUhQvctN6yO1Ds.png" alt="image-20200912203710184"></p><ul><li><p>Base</p><ul><li>  基本可用(Basically Available)</li><li>  软状态(Soft state)</li><li>  最终一致(Eventually consistent)</li><li>  放松某时刻一致性的要求,由base解决</li></ul></li><li><p>分布式+集群简介</p><ul><li>  分布式:不同服务器:不同服务模块</li><li>  集群:不同服务器:相同服务模块</li></ul></li></ul><h1 id="Redis入门介绍"><a href="#Redis入门介绍" class="headerlink" title="Redis入门介绍"></a>Redis入门介绍</h1><h6 id="是什么"><a href="#是什么" class="headerlink" title="是什么"></a>是什么</h6><ul><li><p>  Remote dictionary server(远程字典服务)</p></li><li><p>  c语言编写,遵守BSD协议</p></li><li><p>  Kv分布式存储数据库,基于内存运行,数据结构服务器</p></li><li><p>特点</p><ul><li><p>  支持持久化</p></li><li><p>  不仅支持kv,还提供list,set,zset,hash等</p></li><li><p>  支持数据备份,即master-slave模式数据备份</p></li></ul></li></ul><h6 id="做什么"><a href="#做什么" class="headerlink" title="做什么"></a>做什么</h6><ul><li>支持异步将内存数据写入硬盘,</li></ul><ul><li>发布,订阅系统消息mq+nq:消息中间件</li></ul><ul><li>定时器,计数器</li></ul><ul><li>最新的消息放在内存中list.</li></ul><h3 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h3><ul><li>数据类型,基本操作,配置</li></ul><ul><li>持久化,复制,RDB/AOF</li></ul><ul><li><p>事务控制</p><ul><li>灵活性高,有时候事务回滚</li><li>例如3条语句,回滚2条错的,另一个不会滚,与RDMS不同</li></ul></li><li><p>复制</p></li></ul><h1 id="Redis安装"><a href="#Redis安装" class="headerlink" title="Redis安装"></a>Redis安装</h1><p>下载地址:<a href="https://github.com/dmajkic/redis/downloads">https://github.com/dmajkic/redis/downloads</a></p><h1 id="Redis启动后杂项基础知识讲解"><a href="#Redis启动后杂项基础知识讲解" class="headerlink" title="Redis启动后杂项基础知识讲解"></a>Redis启动后杂项基础知识讲解</h1><ul><li><p>单进程以epoll包装.linux下多路复用io</p></li><li><p>默认16个数据库,类似数组下标从0开始.初始默认0号库</p></li><li><p>Select命令切换数据库 select 7选择7号库</p></li><li><p>Dbsize查看当前数据库key数量</p></li><li><p>Flushdb:清空当前库</p></li><li><p>Flushall通杀全部库</p></li><li><p>统一密码管理,16个库都是同样密码,要么ok,要么都连不上</p></li><li><p>Redis索引都是从0开始</p></li><li><p>默认端口6379-&gt;键盘6379-&gt;merz</p></li><li><p>Keys d* 显示d开头的key</p></li></ul><h1 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h1><h6 id="Redis五大数据类型string-hash-list-set-zset"><a href="#Redis五大数据类型string-hash-list-set-zset" class="headerlink" title="Redis五大数据类型string,hash,list,set,zset"></a>Redis五大数据类型string,hash,list,set,zset</h6><ul><li>String:一个key一个value,二进制安全,可包含任何数据,比如图片,序列化对象,value最多512M</li></ul><ul><li>Hash:类似java中Map, 是一个string类型的filed和value的映射表,适合存储对象</li></ul><ul><li>List:字符串链表,按照插入顺序,可以添加元素到头部,尾部</li></ul><ul><li>Set:实际上是map,string类型无序集合,hashtable实现</li></ul><ul><li>Zset:string类型集合,不重复,每个元素关联一个double分数,通过分数排序,分数可重复</li></ul><h1 id="获得常见类型操作命令"><a href="#获得常见类型操作命令" class="headerlink" title="获得常见类型操作命令"></a>获得常见类型操作命令</h1><p><a href="http://redisdoc.com/">http://redisdoc.com</a></p><h1 id="Redis-key"><a href="#Redis-key" class="headerlink" title="Redis key"></a>Redis key</h1><ul><li><p>  Key * 查看所有</p></li><li><p>  Exist key 判断是否存在key(返回0表示无)</p></li><li><p>  Move key db 当前库就没了,剪贴</p></li><li><p>  Expire key 秒 设置过期时间</p></li><li><p>  Ttl key 查看还有多少时间过期 -1 不过期 -2 已过期(移除)</p></li><li><p>  Type key 查看key类型</p></li><li><p>  Del key删除类型(一般是设置过期时间)</p></li><li><p>  Set key 多次会覆盖</p></li></ul><h1 id="Redis-String"><a href="#Redis-String" class="headerlink" title="Redis String"></a>Redis String</h1><ul><li><p>  单值单value</p></li><li><p>  Set/get/del/append/strlen:拼接字符,返回长度</p></li><li><p>Incr/decr/incrby/decrby,一定要是数字才能进行加减</p><ul><li>  Incdecrr k2:把k2的值加1,减1</li><li>  Incrby/decrby k2 步长x:每次加减x</li></ul></li><li><p>Getrange/setrange:获取指定区间的值,类似between and</p><ul><li>  Getrange key 0 3:获取key的0-3个字符</li><li>  Setrange key 2 x:设置第下标2开始到最后为x</li></ul></li><li><p>Setex(set with expire)键秒值/setnx(set if not exist)</p><ul><li>  Setx key time value;带时间设置</li><li>  Setnx key value:如果存在不再添加</li></ul></li><li><p>Mset/mget/msetnx</p><ul><li>  Mset k1 v1 k2 v2 k3 v3:一次设置多个</li><li>  Mget k1 k2 k3:获取,注意不能超出k4</li><li>  Msetnx k1 v1 k2 v2 k3 v3 k4 v4:存在的不再插入,不存在的也不再插入</li></ul></li><li><p>  Getset(先get再set)</p></li></ul><h1 id="Redis-list"><a href="#Redis-list" class="headerlink" title="Redis list"></a>Redis list</h1><ul><li><p>  单值多value(l在上,r在下)</p></li><li><p>  Lpush/rpush/lrange(已存在是添加是append)</p></li></ul><blockquote><p>Lpush list 0 1 2 3 4 5:0-5左边添加list, 正进反出</p><p>lrange list 0 -1:输出</p><p>rpush list 0 1 2 3 4 5:5-0右边添加list,正进正出</p></blockquote><ul><li>  Lpop/rpop</li></ul><blockquote><p>Lpop list:返回输出第一个,切弹出</p><p>Rpop lsit: 返回输出第一个,切弹出</p></blockquote><ul><li>  Lindex:按照索引下标获得元素</li></ul><blockquote><p>Lindex list 2:获取下标2元素</p></blockquote><ul><li><p>  Llen list:长度</p></li><li><p>  Lrem key n v1:删除n个v1元素</p></li><li><p>  Ltrim key start end:截取指定范围给再给key(包括end):截取后赋给自己</p></li><li><p>  Rpoplpush 源列表 目的列表:把源列表头 给目的列表</p></li><li><p>  Lset key index value:设置下标index的值</p></li><li><p>  Linsert key before/after v1:v1前后插入v1</p></li><li><p>  若值全部移除,对应键也就消失,头尾操作极高,中间较慢</p></li></ul><h1 id="Redis-set"><a href="#Redis-set" class="headerlink" title="Redis set"></a>Redis set</h1><ul><li><p>  单值多value</p></li><li><p>Sadd/smembers/sismember</p><ul><li>  Sad set01 1 1 2 2 3 3:只插入3 个,自己会去重</li><li>  Smember set:查看</li><li>  Sismember set01 2:判断是否存在</li></ul></li><li><p>  Scard:获得集合里面元素个数</p></li><li><p>  Srem key value:删除元素value</p></li><li><p>  Srandmember key 3:</p></li><li><p>  Spop key:随机弹出一个</p></li><li><p>  Smove key1 key2 numINkey1:将key1中的某个值移入key2</p></li><li><p>数学集合类</p><ul><li>  差集:sdiff sdiff set1 set2:返回差集(在第一个里面,不再第二个里面)</li><li>  交集:sinter ……</li><li>  并集:sunion…..</li></ul></li></ul><h1 id="Redis-hash"><a href="#Redis-hash" class="headerlink" title="Redis hash"></a>Redis hash</h1><ul><li><p>  Kv模式不变,但v是一个键值对</p></li><li><p>Hset/hget/hmset/hmget/hgetall/hdel</p><ul><li>  Hset user id 11: key –&gt;user value -&gt;id 11</li><li>  Hget user id:获取;</li><li>  Hmset:设置多个</li><li>  Hmget:得到多个</li><li>  Hgetall:得到所有</li><li>  Hdel key value:删除</li></ul></li><li><p>  Hlen:返回长度</p></li><li><p>  Exists user id:判断是否存在</p></li><li><p>Hkeys/hvals</p><ul><li>  Hkeys user:得到所有的 key (id name)</li><li>  Hvals user:得到对应值</li></ul></li><li><p>Hincrby/hincrbyfloat</p><ul><li>  Hincrby user id 2:使id 加2</li><li>  Hincrbyfloat ….:改小数的值属性</li></ul></li><li><p>  Hsetnx:添加,若不存在</p></li></ul><h1 id="Redis-zset-sorted-set-有序集合"><a href="#Redis-zset-sorted-set-有序集合" class="headerlink" title="Redis zset(sorted set)有序集合"></a>Redis zset(sorted set)有序集合</h1><p>Set k1 v1 k2 v2</p><p>Zset k1 score1(分数) v1 k2 score2 v2(比set多一个分数,用来排序)</p><ul><li><p>Zadd/zrange:两个值是一个整体</p><ul><li>  Zrange key 0 -1:取出(v1 v2)</li><li>  Zrange key 0 -1 withscores:取出(v1 socre1 v2 score2)</li></ul></li><li><p>Zrangebyscore key score1 score2 小到大:返回范围内的(v1..不带score)</p><ul><li>  score1 score2:都包含</li><li>  (score1 (score2:都不包含</li></ul></li><li><p>  Limit 2 5:在返回的结果进行截取(从结果下标2开始截取5个)</p></li><li><p>  Zrem key v1:删除v1</p></li><li><p>  Zcard key:返回数量 v的数量 不带分数</p></li><li><p>  Zcount key score1 score2:统计分数内个数</p></li><li><p>  Zrank key v1:返回v1下标</p></li><li><p>  Zscore key v1:返回v1的score</p></li><li><p>  Zrevrank key v1:逆序获得下标值</p></li><li><p>  Zrevrange key 0 -1:逆序输出 v1 v2</p></li><li><p>  Zrevrangebyscore key 90 60(大到小):返回v2 v1</p></li></ul><h1 id="Units单位"><a href="#Units单位" class="headerlink" title="Units单位"></a>Units单位</h1><ul><li>  1k=1000bytes;1kb=1024bytes;</li><li>  不区分大小写;不支持bit;</li></ul><h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><ul><li>  Window不用更改,linux要改为yes:守护进程</li></ul><p><img src="https://i.loli.net/2020/09/12/s6l1V4pBDwiWHqJ.png" alt="image-20200912205055983"></p><ul><li>  进程管道id文件 windows没有</li></ul><p><img src="https://i.loli.net/2020/09/12/3tQosA6rYVEWLXf.png" alt="image-20200912205110285"></p><ul><li><p>  Port 6379</p></li><li><p>  Tcp-backlog 511</p></li></ul><p><img src="https://i.loli.net/2020/09/12/MHFRSOA3KhYGQzq.png" alt="image-20200912205143972"></p><p>windwos中在network部分设置tcp的backlog ,是一个连接队列,队列总和=未完成3次握手+已完成三次握手在高并发环境下需要一个高backlog值,避免客户端连接缓慢,注意:linux内核会将这个值减小到/proc.sys/net/core/somacconn的值所以需要确认增大somaxconn和tcp_syn_backlog两个值来达到效果</p><ul><li>  绑定的网卡端口</li></ul><p><img src="https://i.loli.net/2020/09/12/XtnPV5ADCkNi869.png" alt="image-20200912205223789"></p><ul><li><p>  Timeout 0; 空闲多少秒后关闭空闲连接 0表示不断</p></li><li><p>  Tcp-keepalive:单位为s 设置为0不进行keepalive检测,建议60s，每隔60秒检查一下状态是否良好</p></li><li><p>Loglevel:日志级别默认四个</p><ul><li>  debug (最详细:a lot of information, useful for development/testing)</li><li>   verbose (many rarely useful info, but not a mess like the debug level)</li><li>  notice (moderately verbose, what you want in production probably)</li><li>  warning (最少:only very important / critical messages are logged)</li></ul></li><li><p>  Logfile “”:日志文件</p></li><li><p>  Syslog-enabled no:系统日志开关</p></li><li><p>  Syslog-ident redis:系统日志文件名</p></li><li><p>  Syslog-facility local0(值可以是user或local0到local7) window没有</p></li><li><p>  Database 16 :16个数据库</p></li><li><p>  存内存数据到硬盘</p></li></ul><p><img src="https://i.loli.net/2020/09/12/Bav129PrDMbEFGe.png" alt="image-20200912205432562"></p><ul><li><p>​    备份条件:Save time 修改次数(save “”)不备份</p><ul><li>  15min内至少一个key变化</li><li>  5min内10个key变化</li><li>  1min内10000key变化</li></ul></li><li><p>  执行shutdown时会执行备份</p></li><li><p>  手动备份save命令</p></li><li><p>  Fushall也会执行save</p></li><li><p>  Stop-writes-on-bgsave-error   备份出错停止写入,</p></li><li><p>  Rdbchecksum:压缩校验crc64算法,10%性能损耗</p></li><li><p>  rdbcompression:是否启动压缩</p></li></ul><h1 id="Replication复制"><a href="#Replication复制" class="headerlink" title="Replication复制"></a>Replication复制</h1><ul><li><p>  Config get requirepass 获得当前用户密码串,此时应为””空串</p></li><li><p>Config get dir :获取服务启动路径(dir 配置文件中)</p><ul><li>  当前路径</li><li>  当配置完path或用完整路径时,即返回的是那个目录路径</li></ul></li><li><p>  Config set requirepass “123456”,(立即加验证)此时再次ping报错</p></li><li><p>  Auth 123456 即可</p></li><li><p>Maxmemory-policy:对于那些不常用的数据,占内存:过期策略</p><ul><li>   volatile-lru(最近最少使用:这对设置了过期时间的建) -&gt; remove the key with an expire set using an LRU algorithm</li><li>  allkeys-lru -&gt; remove any key according to the LRU algorithm</li><li>  volatile-random(随机过期的键删除:对有过期时间的有效) -&gt; remove a random key with an expire set</li><li>  allkeys-random -&gt; remove a random key, any key</li><li>  volatile-ttl(有限时间内:移除ttl只最小的,即即将过期的) -&gt; remove the key with the nearest expire time (minor TTL)</li><li>  noeviction (默认永不过期,针对写操作,会返回错误信息)-&gt; don&#39;t expire at all, just return an error on write operations</li></ul></li><li><p>Maxmemory-samples</p><ul><li>  设置样本数量:lru算法最小ttl算法都是非精确的,设置样本大小,redis会默认检查这么多个key并选择其中lru的那个..</li></ul></li></ul><h1 id="Append-only-mode追加比rdb较好"><a href="#Append-only-mode追加比rdb较好" class="headerlink" title="Append only mode追加比rdb较好"></a>Append only mode追加比rdb较好</h1><ul><li>  开关,改变后启动时会有appendonly.aof:记录所有写操作</li></ul><p><img src="https://i.loli.net/2020/09/12/eL7SsvUY8i2Oj4P.png" alt="image-20200912205834706"></p><ul><li><p>最后一秒:故障.可能日志文件损坏,</p><ul><li>  两者可同时存在,先加载aof,若失败</li><li>  就会加载dump.rdb</li></ul></li><li><p>  修复aof: redis-check-aof --fix appendonly.aof</p></li><li><p>  Appendfilename:日志文件名字</p></li><li><p>Appendfsync</p><ul><li>  Always:同步化持久,每次改变立即记录(性能差)</li><li>  Everysec:出厂设置,异步操作每秒记录,会损失1秒</li><li>  No:</li></ul></li><li><p>  No-appendfsync-on-rewrite:重写时是否运用appendfsync 用no即可保证数据安全</p></li><li><p>  Auto-aof-rewrite-min-size:设置重写的基准值</p></li><li><p>  Auto-aof-rewrite-percentage:设置重写的基准值</p></li></ul><h1 id="常见配置redis-conf介绍"><a href="#常见配置redis-conf介绍" class="headerlink" title="常见配置redis.conf介绍"></a>常见配置redis.conf介绍</h1><ul><li>  Redis 守护进程启动 daemonize no-&gt;yes</li><li>  一守护进程方式启动时 pid会写入/var/run/redis.pid prefile / var/run/redis.pid指定</li><li>  Port 6379</li><li>  Bind 127.0.0.1</li><li>  Timeout 300</li><li>  Loglevel 日志级别 debug,verbose,notice,warning 默认 verbose</li><li>  Logfile stdout:标准输出路径</li><li>  Database 16</li><li>  Dir ./:变值</li><li>  Requirepass …</li><li>  Maxclient xxx:最大连接数</li><li>Maxmemory xx:启动时,加载数据,达到最大,尝试清除将到期,或已到期key处理后,<ul><li>  又达到最大,无法写,仍可读.对于新的vm机制,会把key放入内存value放在swap区</li></ul></li></ul><h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><h6 id="RDB-Redis-DataBase"><a href="#RDB-Redis-DataBase" class="headerlink" title="RDB(Redis DataBase)"></a>RDB(Redis DataBase)</h6><ul><li><p>是什么</p><ul><li>  在指定时间内将数据写入磁盘,即snapshot快照,恢复时写入内存</li><li>  Redis会单独创建(fork)子进程进行持久化,会先将数据写入到临时文件,等待持久化过程结束,再用临时文件替换上次的文件,整个过程主进程不需要io</li><li>  大规模数据恢复,数据完整性不是很敏感,rdb比aof更高效,</li><li>  缺点最后一次持久化数据可能丢失(每5min备份一次,可能最后一次备份时故障)</li></ul></li><li><p>Fork</p><ul><li>  复制一个与当前进程一样的进程,所有基本数据与原进程一致,但作为它的子进程运行</li></ul></li><li><p>  Rdb保存的是dump.rdb文件</p></li><li><p>  配置位置 redis.conf</p></li><li><p>如何触发rdb快照</p><ul><li>  配置文件中默认的快照配置</li><li>  命令save或是bgsave</li><li>  Save:只管保存其他不管,全部阻塞</li><li>  Bgsave:异步快照,备份同时可以响应请求,可以lastsave获取最后一次成功快照时间</li><li>  执行flushall 也会产生备份,但是空文件,无意义</li></ul></li><li><p>如何恢复</p><ul><li>  将备份文件移入 redis安装目录</li></ul></li><li><p>优势</p><ul><li>  适合大规模数据恢复,对数据一致性完整性要求不高</li></ul></li><li><p>劣势</p><ul><li>  最后一次可能丢失,fork的时候内存数据克隆,性能问题</li></ul></li><li><p>如何停止</p><ul><li>  Redis-cli config set save “”</li></ul></li><li><p>  小总结</p></li></ul><p><img src="https://i.loli.net/2020/09/12/a3wgAtJORQnBckT.png" alt="image-20200912210104993"></p><h6 id="AOF-Append-Only-File-修复最后一次读写"><a href="#AOF-Append-Only-File-修复最后一次读写" class="headerlink" title="AOF(Append Only File:修复最后一次读写)"></a>AOF(Append Only File:修复最后一次读写)</h6><ul><li><p>是什么</p><ul><li>  以日志形式记录每个写操作,</li><li>  日志只追加文件,redis启动会读取文件重新构建数据,</li><li>  重启根据日志内容再次执行以完成恢复工作</li></ul></li><li><p>  Aof保存的是appendonly.aof</p></li><li><p>  配置位置</p></li><li><p>Aof启动/恢复/修复</p><ul><li>正常恢复:<ul><li>  启动设置为appendonly no-&gt;yes</li><li>  将所有数据aof文件复制到对应目录(config get dir)</li><li>  重启</li></ul></li><li>异常恢复:<ul><li>  启动:设置yes</li><li>  找到被写坏的aof文件</li><li>  修复:redis-check-aof --fix name</li><li>  恢复:重启</li></ul></li></ul></li><li><p>Rewrite</p><ul><li>是什么?<ul><li>  Aof采用追加方式,文件越来越大,增加重写</li><li>  当文件大小超过所设阈值时,aof内容压缩</li><li>  只保留可以恢复数据的最小指令集,使用命令</li><li>  Bgrewriteaof</li></ul></li><li>重写原理<ul><li>  Aof增加,会fork新进程将文件重写:注意不是读取aof,</li><li>  读取内存中数据重写了一个aof,与快照类似</li></ul></li><li>触发机制<ul><li>  记录上次重写时aof大小,切大于64M</li><li>  <img src="https://i.loli.net/2020/09/12/69QYhNkPdyFZcug.png" alt="image-20200912210304234"></li></ul></li></ul></li><li><p>优势</p><ul><li>  每秒同步,每修改同步,不同步</li></ul></li><li><p>劣势</p><ul><li>  Aof文件远大于rdb,回复速度慢</li><li>  运行效率慢,尽量使用美妙同步策略,若不同步,效率与rdb相同</li></ul></li><li><p>  小总结</p></li></ul><p><img src="https://i.loli.net/2020/09/12/WNDAEUbiOlswMLe.png" alt="image-20200912210333888"></p><h1 id="总结which-one"><a href="#总结which-one" class="headerlink" title="总结which one"></a>总结which one</h1><ul><li>官网建议:完整性低,快速-&gt;rdb</li></ul><ul><li>只做缓存:可以不使用任何备份,不用持久化</li></ul><ul><li>同时开启两种:先aof,aof比rdb完整.建议保留rdb</li></ul><p><img src="https://i.loli.net/2020/09/12/F7gnzNxIXYQSiUK.png" alt="image-20200912210403808"></p><h1 id="Redis的事务"><a href="#Redis的事务" class="headerlink" title="Redis的事务"></a>Redis的事务</h1><ul><li><p>是什么：一次多个命令,所有命令都会序列化,按顺序串行</p></li><li><p>能干嘛：一个队列中,一次性,顺序性,排他性,</p></li><li><p>怎么做</p></li></ul><p><img src="https://i.loli.net/2020/09/12/Xd9UHzb4rapRWuQ.png" alt="image-20200912210540693"></p><ul><li><p>常用命令</p><ul><li>  Case 1:正常执行</li><li>  Case 2:放弃事务</li><li>  Case 3:全体连坐</li><li>  Case 4:冤头债主</li><li>Case 5:watch监控<ul><li>  悲观锁/乐观锁/cas(check and set)</li><li>  悲观锁:修改时上锁</li><li>  乐观锁:不会上锁,更新时判断有没有他人更新过数据,用版本号机制</li><li>  提交版本必须大于记录当前版本才能执行更新</li></ul></li></ul></li><li><p>小结</p><ul><li>  Watch类似乐观锁</li><li>  监控的数据被改,exec命令会被抛弃,返回nullmulti-bulk通知失败</li></ul></li></ul><h6 id="3阶段"><a href="#3阶段" class="headerlink" title="3阶段"></a>3阶段</h6><ul><li>Multi开启事务</li><li>命令入队</li><li>执行exec</li></ul><h6 id="3特性"><a href="#3特性" class="headerlink" title="3特性"></a>3特性</h6><ul><li>单独的隔离操作:不会被其他客户端命令打断</li></ul><ul><li>没有隔离级别</li></ul><ul><li>不保证原子性:冤头债主:全体连坐</li></ul><h1 id="Redis的发布订阅-了解"><a href="#Redis的发布订阅-了解" class="headerlink" title="Redis的发布订阅(了解)"></a>Redis的发布订阅(了解)</h1><ul><li>是什么：进程间的一种消息通信模式,发送者pub发送,订阅者sub接受</li><li>命令</li></ul><p><img src="https://i.loli.net/2020/09/12/WcpM5oH7FzqhrZg.png" alt="image-20200912210903972"></p><p>源-&gt;channel-&gt;client</p><h6 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h6><p><img src="https://i.loli.net/2020/09/12/dE5a3CzbXfWlcPp.png" alt="image-20200912210929351"></p><h1 id="Redis的复制"><a href="#Redis的复制" class="headerlink" title="Redis的复制"></a>Redis的复制</h1><ul><li><p>是什么</p><ul><li>Replication:主从复制,主机更新后,根据配置策略,自动同步到备机的matser/salver机制</li><li>Master:写;slave:读</li></ul></li><li><p>能干嘛</p><ul><li>读写分离</li><li>容灾恢复</li></ul></li><li><p>怎么做</p><ul><li>配从库不配主库</li><li>从库配置:slaveof主库ip主库端口<ul><li>每次master断开之后都要重新连接,除非配置进redis.conf</li></ul></li><li>修改配置文件(不同的几个库)<ul><li>拷贝多个redis.conf</li><li>开启daemonize yes</li><li>Pid文件名字</li><li>指定端口</li><li>Log文件名字</li><li>Dump.rdb名字</li></ul></li></ul></li><li><p>常用三招(以不同配置文件啊启动数据库)</p><ul><li>一主二仆<ul><li>  分别连接数据库</li><li>  :Info replication//显示状态 都是master</li><li>  :主机添加数据v1</li><li>  :丛机:slaveof 主机ip port (全量复制,从机变为slave:只能读)</li><li>  :主机:又加数据v2</li><li>  :丛机 get v2可以获得,注意也能get v1</li><li>  当主机故障:从机连接状态down,从机原地待命,主机随时连接</li><li>  从机故障:再次恢复时:身份变为master,再次slaveof</li></ul></li><li>薪火相传<ul><li>  上一个slave可以使下一个slaver的master,slaver同样可以接受其他slaves的链接和同步请求,和减少主库的压力</li><li>  中途变更转向:会清除之前数据.</li><li>  中间的slave的身份:还是slave ,担有连接的slave</li></ul></li><li>反客为主<ul><li>  从机:Slaveof no one:状态变为master</li><li>  其他主机要同步时:要再次slaveof……</li></ul></li></ul></li></ul><h6 id="复制原理"><a href="#复制原理" class="headerlink" title="复制原理"></a>复制原理</h6><ul><li>Slave启动后连接到master 会发送sync命令同步</li></ul><ul><li>Master接到后,若此时有修改数据命令,完成后再处理同步</li></ul><ul><li>全量复制:slave接收到数据库文件后</li></ul><ul><li>增量复制:master继续将新数据传给slave时,但只要是重新连接都会一次同步所有</li></ul><h6 id="哨兵模式sentinel"><a href="#哨兵模式sentinel" class="headerlink" title="哨兵模式sentinel"></a>哨兵模式sentinel</h6><p>自动的反客为主:</p><ul><li><p>  调整结构:一主二仆</p></li><li><p>  自定义/myredis目录下新建sentinel.conf文件,名字不能错</p></li><li><p>主机配置哨兵sentinel.conf(可监控多个master)</p><ul><li>  Sentinel monitor 数据库名字(自己起) 127.0.0.1 6379 1(选择主机方案,票数高的作为主机)</li></ul></li><li><p>启动redis-sentinel sentinel.conf</p><ul><li>  此时 主机故障, 一段时间后 会在从机中选出一个作为主机,(不用手动更改)</li><li>  主机恢复时:slave:变为新主机的slave(有延迟)</li></ul></li></ul><h6 id="复制的缺点"><a href="#复制的缺点" class="headerlink" title="复制的缺点"></a>复制的缺点</h6><p>复制延时,slave多问题更严重</p><h1 id="Redis的java客户端-jedis"><a href="#Redis的java客户端-jedis" class="headerlink" title="Redis的java客户端(jedis)"></a>Redis的java客户端(jedis)</h1><h2 id="Jedis常用操作"><a href="#Jedis常用操作" class="headerlink" title="Jedis常用操作"></a>Jedis常用操作</h2><ul><li>  测试</li></ul><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs java">Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">6379</span>);<br>System.out.println(jedis.ping());<br>Set jedis.set(<span class="hljs-string">&quot;k1&quot;</span>,<span class="hljs-string">&quot;v1&quot;</span>);<br>Get jedis.get(<span class="hljs-string">&quot;k1&quot;</span>)<br>Set&lt;String&gt; listSet = jedis.keys(<span class="hljs-string">&quot;*&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li><p>事物提交</p><p><img src="https://i.loli.net/2020/09/12/uOkm5NEAW3j6PGS.png" alt="image-20200912211405853"></p></li></ul><p><img src="https://i.loli.net/2020/09/12/2BKAzJ8wgLxqT1v.png" alt="image-20200912211415906"></p><p>若事物执行时数据被更改,在执行exec时不会报错,只是事物内容不再执行</p><ul><li><p>主从复制</p><ul><li><p>两个库,先各自独立</p></li><li><div class="code-wrapper"><pre><code class="Java">Jedis jedis_M = new Jedis(&quot;127.0.0.1&quot;,6379);Jedis jedis_S = new Jedis(&quot;127.0.0.1&quot;,6380);jedis_S.slaveof(&quot;127.0.0.1&quot;, 6379);jedis_M.set(&quot;k&quot;, &quot;v&quot;);String result=jedis_S.get(&quot;k&quot;);System.out.println(result);//很可能获取不到(主从关系没建立)太快了,再次执行即可</code></pre></div></li></ul></li></ul><h2 id="Jedispool"><a href="#Jedispool" class="headerlink" title="Jedispool"></a>Jedispool</h2><p><img src="https://i.loli.net/2020/09/12/S5Ogo4N2CyEZFMi.png" alt="image-20200912211505137"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python%E8%A7%A3%E6%9E%90xml%E6%96%87%E4%BB%B6/"/>
    <url>/2022/01/16/cnblog/python%E8%A7%A3%E6%9E%90xml%E6%96%87%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="python解析xml文档"><a href="#python解析xml文档" class="headerlink" title="python解析xml文档"></a>python解析xml文档</h1><h2 id="1-DOM-基于对象-主要思想：从根节点开始按照标签值-逐层查找"><a href="#1-DOM-基于对象-主要思想：从根节点开始按照标签值-逐层查找" class="headerlink" title="1,DOM(基于对象) 主要思想：从根节点开始按照标签值 逐层查找"></a>1,DOM(基于对象) 主要思想：从根节点开始按照标签值 逐层查找</h2><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> xml.dom <span class="hljs-keyword">import</span> minidom<br><span class="hljs-comment"># 打开文件</span><br>DomTree = minidom.parse(<span class="hljs-string">&#x27;path&#x27;</span>)<br><span class="hljs-comment"># 获取xml对象</span><br>annotation = DomTree.documentElement<br><span class="hljs-comment"># 获取一级节点 列表返回</span><br>folder=annotation.getElementsByTagName(<span class="hljs-string">&quot;folder&quot;</span>)<br>filename=annotation.getElementsByTagName(<span class="hljs-string">&quot;filename&quot;</span>)<br>source=annotation.getElementsByTagName(<span class="hljs-string">&quot;source&quot;</span>)<br>size=annotation.getElementsByTagName(<span class="hljs-string">&quot;size&quot;</span>)<br>segmented=annotation.getElementsByTagName(<span class="hljs-string">&quot;segmented&quot;</span>)<br>obj=annotation.getElementsByTagName(<span class="hljs-string">&quot;object&quot;</span>)<br><span class="hljs-comment"># 在obj列表的第一个对象中查找part</span><br>part = obj[<span class="hljs-number">0</span>].getElementsByTagName(<span class="hljs-string">&quot;part&quot;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> part:<br>    name=i.getElementsByTagName(<span class="hljs-string">&quot;name&quot;</span>)[<span class="hljs-number">0</span>].childNodes[<span class="hljs-number">0</span>]<br>    bndbox=i.getElementsByTagName(<span class="hljs-string">&quot;bndbox&quot;</span>)[<span class="hljs-number">0</span>]<br>    <span class="hljs-comment"># 例：dom(a标签).childNodes[0] 获取的是&lt;a&gt;&lt;x&gt;之间的飞标签字符，包含换行，或其他字符</span><br>    <span class="hljs-comment"># dom(a标签).childNodes[1] 即可得到&lt;x&gt;&lt;/x&gt;标签</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;a&gt;</span><br><span class="hljs-string">        &lt;x&gt;&lt;/x&gt;</span><br><span class="hljs-string">    &lt;/a&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># dom.getAttribute(&quot;id&quot;) 可获取属性值</span><br>    xmin = bndbox.getElementsByTagName(<span class="hljs-string">&quot;xmin&quot;</span>)[<span class="hljs-number">0</span>].childNodes[<span class="hljs-number">0</span>].data<br>    ymin = bndbox.getElementsByTagName(<span class="hljs-string">&quot;ymin&quot;</span>)[<span class="hljs-number">0</span>].childNodes[<span class="hljs-number">0</span>].data<br>    xmax = bndbox.getElementsByTagName(<span class="hljs-string">&quot;xmax&quot;</span>)[<span class="hljs-number">0</span>].childNodes[<span class="hljs-number">0</span>].data<br>    ymax = bndbox.getElementsByTagName(<span class="hljs-string">&quot;ymax&quot;</span>)[<span class="hljs-number">0</span>].childNodes[<span class="hljs-number">0</span>].data<br>    <span class="hljs-built_in">print</span>(name,bndbox,xmin,ymin,xmax,ymax,<span class="hljs-built_in">type</span>(bndbox.getElementsByTagName(<span class="hljs-string">&quot;xmin&quot;</span>)[<span class="hljs-number">0</span>]))<br></code></pre></td></tr></table></figure><p>注：</p><p>​    getElementsByTagName()—-&gt;class Element<br>​    Element.childNodes ——&gt;Dom 类型</p><h2 id="2-SAX-基于事件-比dom更多的控制，更有效率，但需要的工作较多"><a href="#2-SAX-基于事件-比dom更多的控制，更有效率，但需要的工作较多" class="headerlink" title="2,SAX (基于事件):比dom更多的控制，更有效率，但需要的工作较多"></a>2,SAX (基于事件):比dom更多的控制，更有效率，但需要的工作较多</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xml.sax<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationHandler</span>(<span class="hljs-params">xml.sax.ContentHandler</span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">___init__</span>(<span class="hljs-params">self</span>):</span><br>        self.firstAttr=<span class="hljs-string">&quot;&quot;</span><br>        self.secAttr=<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">startElement</span>(<span class="hljs-params">self,tag,attribute</span>):</span><br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">characters</span>(<span class="hljs-params">self,content</span>):</span><br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">endElement</span>(<span class="hljs-params">self,tag</span>):</span><br>        <span class="hljs-keyword">pass</span><br>parser = xml.sax.make_parser()<br><span class="hljs-comment"># 关闭namespaces</span><br>parser.setFeature(xml.sax.handler.feature_namespaces,<span class="hljs-number">0</span>)<br>parser.setContentHandler(AnnotationHandler())<br>parser.parse(<span class="hljs-string">&quot;path&quot;</span>)<br></code></pre></td></tr></table></figure><p>详见 <a href="https://www.cnblogs.com/hongfei/p/python-xml-sax.html">https://www.cnblogs.com/hongfei/p/python-xml-sax.html</a></p><h2 id="3-ElementTree-将xml转化为tree"><a href="#3-ElementTree-将xml转化为tree" class="headerlink" title="3,ElementTree 将xml转化为tree"></a>3,ElementTree 将xml转化为tree</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> et<br>tree = et.parse(<span class="hljs-string">&#x27;path&#x27;</span>)<br>root=tree.getroot() <span class="hljs-comment"># 获取根节点</span><br><span class="hljs-built_in">print</span>(root.tag,root.attrib)  <span class="hljs-comment"># annotation 标签名 , 获取属性</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> root: <span class="hljs-comment"># 找到root的一级字标签 也可以root[n] 获取</span><br>    <span class="hljs-built_in">print</span>(i.tag,i.text)<br>    <span class="hljs-comment"># i.txt 表示i标签中的非标签值</span><br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;i&gt;xx&lt;/i&gt;  i.text=xx</span><br><span class="hljs-string">    &lt;i&gt;</span><br><span class="hljs-string">    &lt;x&gt;&lt;/x&gt; i.text=换行</span><br><span class="hljs-string">    &lt;/i&gt;</span><br><span class="hljs-string">    &lt;i&gt;&lt;x&gt;&lt;/x&gt; i.text=None</span><br><span class="hljs-string">    &lt;/i&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><h2 id="xml文件"><a href="#xml文件" class="headerlink" title="xml文件"></a>xml文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">annotation</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">folder</span>&gt;</span>VOC2012<span class="hljs-tag">&lt;/<span class="hljs-name">folder</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filename</span>&gt;</span>2007_000027.jpg<span class="hljs-tag">&lt;/<span class="hljs-name">filename</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">database</span>&gt;</span>The VOC2007 Database<span class="hljs-tag">&lt;/<span class="hljs-name">database</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">annotation</span>&gt;</span>PASCAL VOC2007<span class="hljs-tag">&lt;/<span class="hljs-name">annotation</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">image</span>&gt;</span>flickr<span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">size</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">width</span>&gt;</span>486<span class="hljs-tag">&lt;/<span class="hljs-name">width</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">height</span>&gt;</span>500<span class="hljs-tag">&lt;/<span class="hljs-name">height</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">depth</span>&gt;</span>3<span class="hljs-tag">&lt;/<span class="hljs-name">depth</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">size</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">segmented</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">segmented</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">object</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>person<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">pose</span>&gt;</span>Unspecified<span class="hljs-tag">&lt;/<span class="hljs-name">pose</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">truncated</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">truncated</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">difficult</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">difficult</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmin</span>&gt;</span>174<span class="hljs-tag">&lt;/<span class="hljs-name">xmin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymin</span>&gt;</span>101<span class="hljs-tag">&lt;/<span class="hljs-name">ymin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmax</span>&gt;</span>349<span class="hljs-tag">&lt;/<span class="hljs-name">xmax</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymax</span>&gt;</span>351<span class="hljs-tag">&lt;/<span class="hljs-name">ymax</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>head<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bndbox</span>&gt;</span>12<br><span class="hljs-tag">&lt;<span class="hljs-name">xmin</span>&gt;</span>169<span class="hljs-tag">&lt;/<span class="hljs-name">xmin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymin</span>&gt;</span>104<span class="hljs-tag">&lt;/<span class="hljs-name">ymin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmax</span>&gt;</span>209<span class="hljs-tag">&lt;/<span class="hljs-name">xmax</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymax</span>&gt;</span>146<span class="hljs-tag">&lt;/<span class="hljs-name">ymax</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hand<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmin</span>&gt;</span>278 asd<span class="hljs-tag">&lt;/<span class="hljs-name">xmin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymin</span>&gt;</span>210<span class="hljs-tag">&lt;/<span class="hljs-name">ymin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmax</span>&gt;</span>297<span class="hljs-tag">&lt;/<span class="hljs-name">xmax</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymax</span>&gt;</span>233<span class="hljs-tag">&lt;/<span class="hljs-name">ymax</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>foot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmin</span>&gt;</span>273<span class="hljs-tag">&lt;/<span class="hljs-name">xmin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymin</span>&gt;</span>333<span class="hljs-tag">&lt;/<span class="hljs-name">ymin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmax</span>&gt;</span>297<span class="hljs-tag">&lt;/<span class="hljs-name">xmax</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymax</span>&gt;</span>354<span class="hljs-tag">&lt;/<span class="hljs-name">ymax</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>foot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmin</span>&gt;</span>319<span class="hljs-tag">&lt;/<span class="hljs-name">xmin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymin</span>&gt;</span>307<span class="hljs-tag">&lt;/<span class="hljs-name">ymin</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">xmax</span>&gt;</span>340<span class="hljs-tag">&lt;/<span class="hljs-name">xmax</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ymax</span>&gt;</span>326<span class="hljs-tag">&lt;/<span class="hljs-name">ymax</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bndbox</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">part</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">object</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">annotation</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Python%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
    <url>/2022/01/16/cnblog/Python%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><ul><li>python 没有多态，而是鸭子类型</li><li>多继承，没有接口，可通过语法糖实现接口的作用</li><li>lambda中只能有一句</li><li>“/“表示之前的参数是必须是位置参数，”**“表示是后面的必须是关键字参数</li></ul><h1 id="Python多进程"><a href="#Python多进程" class="headerlink" title="Python多进程"></a>Python多进程</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20211228120459335.png" alt="image-20211228120459335"></p><h1 id="Python-多线程是伪多线程"><a href="#Python-多线程是伪多线程" class="headerlink" title="Python 多线程是伪多线程"></a>Python 多线程是伪多线程</h1><ul><li><p>多线程子线程会随着主线程结束而中断，因此一般在主线程中调用thread.join()</p></li><li><p>线程方法</p><ul><li><p>```python<br>import threading<br>t = thread.Thread()<br>t.start();</p><h1 id="没有返回值，若需要返回值可继承该类，在类中保存计算结果，用以获取"><a href="#没有返回值，若需要返回值可继承该类，在类中保存计算结果，用以获取" class="headerlink" title="没有返回值，若需要返回值可继承该类，在类中保存计算结果，用以获取"></a>没有返回值，若需要返回值可继承该类，在类中保存计算结果，用以获取</h1><h1 id="或者传入全局结果参数，"><a href="#或者传入全局结果参数，" class="headerlink" title="或者传入全局结果参数，"></a>或者传入全局结果参数，</h1><figure class="highlight autohotkey"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><pre><code class="hljs autohotkey"><br>- ```python<br>  import <span class="hljs-keyword">thread</span> # threading 封装了<span class="hljs-keyword">thread</span><br></code></pre></td></tr></table></figure></li><li><p>```python<br>import threadpool # 三方库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><br>```python<br><span class="hljs-comment"># 线程池</span><br><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">coro</span>(<span class="hljs-params">i</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;core start&quot;</span>,i)<br>    ret = <span class="hljs-keyword">await</span> get(i) <span class="hljs-comment"># 此处为耗时的io等操作</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;core end&quot;</span>,i)<br>    <span class="hljs-keyword">return</span> ret<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">i</span>):</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> i<br>loop = asyncio.get_event_loop()<br>a = [asyncio.ensure_future(coro(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>loop.run_until_complete(asyncio.wait(a))<br>loop.close()<br><span class="hljs-built_in">print</span>([i.result() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a])<br><br><span class="hljs-keyword">import</span> concurrent.futures<br><span class="hljs-keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="hljs-keyword">as</span> pool:<br>    results = pool.<span class="hljs-built_in">map</span>(function,args)   <span class="hljs-comment"># 注意此处是任务提一提交完，args为参数列表的列表</span><br>    <span class="hljs-comment"># result 线程的结果</span><br>    <span class="hljs-comment"># 或者</span><br>    future = pool.submit(function,args)  <span class="hljs-comment"># 每次提交一个</span><br>    future.result() <span class="hljs-comment"># 结果</span><br><br>    <span class="hljs-keyword">for</span> futures <span class="hljs-keyword">in</span> futures: <span class="hljs-comment"># 顺序执行</span><br>        xxxx<br>    <span class="hljs-keyword">for</span> futures <span class="hljs-keyword">in</span> concurrent.futures.as_completed(futures): <span class="hljs-comment"># 不会按照顺序执行，那个线程先结束先执行那个</span><br>        xxxx<br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="Python协程"><a href="#Python协程" class="headerlink" title="Python协程"></a>Python协程</h1><ul><li>单线程的IO多路复用，使用了单线程中IO阻塞的那一段时间，但其实还是顺序执行，按照IO阻塞切换，因此不会出现协程安全问题<ul><li>可以说是异步操作</li></ul></li><li>开销小，切换容易</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20211228124409752.png" alt="image-20211228124409752"></p><h1 id="GIL锁：全局解释器锁，Cython"><a href="#GIL锁：全局解释器锁，Cython" class="headerlink" title="GIL锁：全局解释器锁，Cython"></a>GIL锁：全局解释器锁，Cython</h1><ul><li><p>cpu计算时线程需要获取GIL锁，只有一个，因此多核cpu也只有一个线程可以执行，<font color=red>主要防止多线程垃圾回收不安全</font></p><ul><li><p>GIL只保证有一个线程运行，但不保证线程何时切换，因此还有线程安全问题。</p></li><li><p>程序代码现线程安全问题还是要加LOCK</p><ul><li>```python<br>import threading<br>lock = threading.Lock()<br>lock.acquire()<br>lock.release()<h1 id="或者"><a href="#或者" class="headerlink" title="或者"></a>或者</h1>with lock:<div class="code-wrapper"><pre><code class="hljs">xxxx </code></pre></div><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>      <br><br>- 执行IO操作时会释放锁，因此对于IO密集型任务，可以用多线程，计算密集型，不能发挥多核，多线程作用。<br><br>- 引用计数法+循环检测：GC<br><br><span class="hljs-comment"># 面向对象</span><br><br>- 类中的变量是静态变量，方法通过@staticmethod修饰，是静态，self.<span class="hljs-attribute">xxx</span>=yy 实例变量<br><br><span class="hljs-comment"># WWW</span><br><br>```python<br>import urllib.request<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    data = urllib.parse.urlencode(&#123;<span class="hljs-string">&#x27;wd&#x27;</span>:<span class="hljs-string">&#x27;python&#x27;</span>&#125;).encode(<span class="hljs-string">&quot;utf8&quot;</span>)<br>    request = urllib.request.urlopen(<span class="hljs-string">&quot;http://baidu.com&quot;</span>,<span class="hljs-attribute">data</span>=data)<br>    with request:<br>        msg,hd = request.read(),request.<span class="hljs-builtin-name">info</span>()<br>        <span class="hljs-builtin-name">print</span>(msg)<br>        <span class="hljs-builtin-name">print</span>(hd)<br></code></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h1 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># smtplib email 配合使用</span><br><span class="hljs-comment"># 或是unix系统中的sendmail命令</span><br></code></pre></td></tr></table></figure><h1 id="SOCKET"><a href="#SOCKET" class="headerlink" title="SOCKET"></a>SOCKET</h1><ul><li>```python<h1 id="旧版本异步通信"><a href="#旧版本异步通信" class="headerlink" title="旧版本异步通信"></a>旧版本异步通信</h1>import asyncore<br>class HTTPClient(asyncore.dispatcher):<div class="code-wrapper"><pre><code class="hljs">def __init__(self,host):    #  初始化父类    asyncore.dispatcher.__init__(self)    # 创建一个socket对象    self.create_socket()    # 连接服务器端    self.connect((host,80))#发送优化    self.buffer = b&#39;GET /HTTP/1.1\r\nHost: www.baidu.com\r\n\r\n&#39;def handle_connect(self):    print(&#39;服务器连接成功&#39;)def handle_close(self):    print(&#39;服务器连接断开&#39;)    self.close()def readable(self):    return Truedef handle_read(self):    # 指定一次读取1024个字节，如果一次没有读完的话，那么事件循环会分多次把内容读完为止    print(self.recv(1024).decode())def writable(self):    return (len(self.buffer)&gt;0)def handle_write(self):    sent = self.send(self.buffer)    self.buffer = self.buffer[sent:]</code></pre></div>if <strong>name</strong> == ‘<strong>main</strong>‘:<div class="code-wrapper"><pre><code class="hljs">HTTPClient(&#39;www.baidu.com&#39;)asyncore.loop()</code></pre></div> import asyncore<br>import socketclass EchoHandler(asyncore.dispatcher_with_send):<div class="code-wrapper"><pre><code class="hljs">def handle_read(self):    data = self.recv(8192)    if data:        self.send(&quot;hello&quot;.encode(&#39;utf8&#39;)+data)</code></pre></div>class EchoServer(asyncore.dispatcher):<div class="code-wrapper"><pre><code class="hljs">def __init__(self, host, port):    asyncore.dispatcher.__init__(self)    self.create_socket(socket.AF_INET, socket.SOCK_STREAM)    self.set_reuse_addr()    self.bind((host, port))    self.listen(5)def handle_accept(self):    pair = self.accept()    if pair is not None:        sock, addr = pair        print(&#39;Incoming connection from %s&#39; % repr(addr))        handler = EchoHandler(sock)</code></pre></div>if <strong>name</strong> == ‘<strong>main</strong>‘:<div class="code-wrapper"><pre><code class="hljs">server = EchoServer(&#39;10.101.33.82&#39;, 8080)asyncore.loop()</code></pre></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>- ```python<br>  <span class="hljs-keyword">import</span> asyncio<br>  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">handle_echo</span>(<span class="hljs-params">reader, writer</span>):</span><br>      <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>          data = <span class="hljs-keyword">await</span> reader.read(<span class="hljs-number">100</span>)<br>          message = data.decode(<span class="hljs-string">&quot;gbk&quot;</span>)<br>          addr = writer.get_extra_info(<span class="hljs-string">&#x27;peername&#x27;</span>)<br>          <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Received <span class="hljs-subst">&#123;message!r&#125;</span> from <span class="hljs-subst">&#123;addr!r&#125;</span>&quot;</span>)<br>          <span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;-1&#x27;</span>:<br>              writer.write(<span class="hljs-string">&quot;将会结束!&quot;</span>.encode(<span class="hljs-string">&quot;gbk&quot;</span>))<br>          <span class="hljs-keyword">else</span>:<br>              writer.write(message.encode(<span class="hljs-string">&quot;gbk&quot;</span>))<br>          <span class="hljs-keyword">await</span> writer.drain()<br>  <br>          <span class="hljs-keyword">if</span> message == <span class="hljs-string">&#x27;-1&#x27;</span>:<br>              writer.close()<br>              <span class="hljs-keyword">break</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>      server = <span class="hljs-keyword">await</span> asyncio.start_server(<br>          handle_echo, <span class="hljs-string">&#x27;10.101.33.82&#x27;</span>, <span class="hljs-number">8080</span>)<br>  <br>      addr = server.sockets[<span class="hljs-number">0</span>].getsockname()<br>      <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Serving on <span class="hljs-subst">&#123;addr&#125;</span>&#x27;</span>)<br>  <br>      <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> server:<br>          <span class="hljs-keyword">await</span> server.serve_forever()<br>  <br>  asyncio.run(main())<br></code></pre></td></tr></table></figure></li></ul><h1 id="编码"><a href="#编码" class="headerlink" title="编码"></a>编码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 编码,utf8</span><br><span class="hljs-comment">#3字节 1110xxxx 10xxxxxx 10xxxxxx   中文:&quot;中&quot;</span><br><span class="hljs-comment"># utf8--&gt; 4e2d -》0100 1110 0010 1101</span><br><span class="hljs-string">b&#x27;\xe4\xb8\xad&#x27;</span>.decode(<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-comment"># “中“</span><br><span class="hljs-comment"># 与上边组 1110 0100 10111000 10101101 -》就是 e4b8ad</span><br></code></pre></td></tr></table></figure><p>b’xxxxx’ xxxx 应该是字节数，例如ascii中的，或者是用16进制表示的汉字</p><p>b’a’ == b’\x61’ </p><p>b’\e4\xb8\xad’  按照utf8解码后就是‘中’</p><h1 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h1><p>Python3 Tkinter Qt</p><p>wxwidgets,Kivy,Fltk</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <url>/2022/01/16/cnblog/python%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 class="md-end-block md-heading md-focus"><span class="md-plain md-expand">1 多进程</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 多进程,<br /><span><span class="cm-keyword">import <span class="cm-variable">os<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Process<br /><span><span class="cm-comment"># 启动时必须在 if __name__ 判断下,windows 必须,其他 无限制<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># def func(args):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("子进程:",os.getpid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("子进程的父进程:",os.getppid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(10)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("子进程结束")<br /><span><span class="cm-comment"># if __name__ =="__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=func,args=(1,))  # 注册 并传入元祖 元祖有一个参数要加逗号<br /><span><span class="cm-comment"># &nbsp; &nbsp; # p是进程对象<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start() # 开启子进程<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("主进程:", os.getpid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("主进程的父进程:",os.getppid()) # cmd 或者是 pycharm<br /><span><span class="cm-comment"># 生命周期<br /><span><span class="cm-comment"># &nbsp; 主进程长:自己执行完结束<br /><span><span class="cm-comment"># &nbsp; 子进程长:等待子进程结束<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 多进程中的方法<br /><span><span class="cm-comment"># join<br /><span><span class="cm-comment"># def fun(arg1,arg2):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('*'*arg1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; # time.sleep(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('*'*arg2)<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=fun,args=(10,20))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; # p.join() # 感知子进程结束<br /><span><span class="cm-comment"># &nbsp; &nbsp; # time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("all is stop")<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("最后的语句")<br /><span><span class="cm-comment"># &nbsp; &nbsp; os.walk(r"目录") # 返回 文件夹中文件名字<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># def fun():<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("xxx")<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p = Process(target=fun)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.join()  # 停止for循环 进程结束后继续<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print("for")<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("主进程")<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 第二种方法<br /><span><span class="cm-comment"># class MyProcess(Process):<br /><span><span class="cm-comment"># &nbsp; &nbsp; def __init__(self,args):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; super().__init__()  # 若要传递参数,需要调用父类init<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># &nbsp; &nbsp; def run(self):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print("子进程",self.__dict__)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print(self.pid)<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("主进程:",os.getpid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1 = MyProcess()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1.start()<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 进程之间数据是隔离,命名空间不通<br /><span><span class="cm-comment"># def fun():<br /><span><span class="cm-comment"># &nbsp; &nbsp; global n<br /><span><span class="cm-comment"># &nbsp; &nbsp; n= 0<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("pid:%s" %os.getpid(),n)<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; n=100<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=fun)<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.join()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(n) # --&gt;100<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 多进程tcp连接<br /><span><span class="cm-comment"># import socket<br /><span><span class="cm-comment"># # 客户端<br /><span><span class="cm-comment"># sk = socket.socket()<br /><span><span class="cm-comment"># sk.connect(("127.0.0.1",8080))<br /><span><span class="cm-comment"># sk.send('N好'.encode("utf8"))<br /><span><span class="cm-comment"># msg = sk.recv(1024).decode("utf8")<br /><span><span class="cm-comment"># print(msg)<br /><span><span class="cm-comment"># sk.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># # 服务端<br /><span><span class="cm-comment"># def server(conn):<br /><span><span class="cm-comment"># &nbsp; &nbsp; ret= "你好".encode("utf8")<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.send(ret)<br /><span><span class="cm-comment"># &nbsp; &nbsp; msg = conn.recv(1024).decode("utf8")<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(msg)<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># sk = socket.socket()<br /><span><span class="cm-comment"># sk.bind(("127.0.0.1",8080))<br /><span><span class="cm-comment"># sk.listen()<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; conn, addr = sk.accept()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p = Process(target=server,args=(conn,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 守护进程<br /><span><span class="cm-comment"># 默认情况 父进程 等待子进程结束<br /><span><span class="cm-comment"># p.daemon = True 在start前,设置为守护进程,守护进程随父进程(代码执行完毕)结束<br /><span><span class="cm-comment"># &nbsp; 若父进程在等待 子进程(非守护进程时) ,若父进程代码完毕,守护进程应该结束<br /><span><span class="cm-comment"># p.is_alive() 判断进程是否存活<br /><span><span class="cm-comment"># p.terminate() 终止进程<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 锁<br /><span><span class="cm-comment"># 未加锁实例:<br /><span><span class="cm-comment"># 火车票<br /><span><span class="cm-keyword">import <span class="cm-variable">json<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Process<br /><span><span class="cm-comment"># def show(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; with open('ticket') as f:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; dic = json.load(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('余票: %s'%dic['ticket'])<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">buy_ticket(<span class="cm-variable">i):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-builtin">open(<span class="cm-string">'ticket') <span class="cm-keyword">as <span class="cm-variable">f:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dic = <span class="cm-variable">json.<span class="cm-property">load(<span class="cm-variable">f)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">0.1)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">dic[<span class="cm-string">'ticket'] <span class="cm-operator">&gt; <span class="cm-number">0 :<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dic[<span class="cm-string">'ticket'] -= <span class="cm-number">1<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'\033[32m%s买到票了\033[0m'<span class="cm-operator">%<span class="cm-variable">i)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">else:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'\033[31m%s没买到票\033[0m'<span class="cm-operator">%<span class="cm-variable">i)<br /><span> &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">0.1)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-builtin">open(<span class="cm-string">'ticket',<span class="cm-string">'w') <span class="cm-keyword">as <span class="cm-variable">f:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">json.<span class="cm-property">dump(<span class="cm-variable">dic,<span class="cm-variable">f)<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">'__main__':<br /><span> &nbsp; &nbsp;<span class="cm-comment"># for i in range(10):<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp; &nbsp; p = Process(target=show,args=(i,))<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">10):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">buy_ticket, <span class="cm-variable">args=(<span class="cm-variable">i))<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">start()<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># 锁<br /><span><span class="cm-comment"># 加锁实例<br /><span><span class="cm-comment"># 火车票<br /><span><span class="cm-keyword">import <span class="cm-variable">json<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Process<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Lock<br /><span><span>​<br /><span><span class="cm-comment"># def show(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; with open('ticket') as f:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; dic = json.load(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('余票: %s'%dic['ticket'])<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">buy_ticket(<span class="cm-variable">i,<span class="cm-variable">lock):<br /><span> &nbsp; &nbsp;<span class="cm-variable">lock.<span class="cm-property">acquire() <span class="cm-comment">#拿钥匙进门<br /><span> &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-builtin">open(<span class="cm-string">'ticket') <span class="cm-keyword">as <span class="cm-variable">f:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dic = <span class="cm-variable">json.<span class="cm-property">load(<span class="cm-variable">f)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">0.1)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">dic[<span class="cm-string">'ticket'] <span class="cm-operator">&gt; <span class="cm-number">0 :<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">dic[<span class="cm-string">'ticket'] -= <span class="cm-number">1<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'\033[32m%s买到票了\033[0m'<span class="cm-operator">%<span class="cm-variable">i)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">else:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'\033[31m%s没买到票\033[0m'<span class="cm-operator">%<span class="cm-variable">i)<br /><span> &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">0.1)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">with <span class="cm-builtin">open(<span class="cm-string">'ticket',<span class="cm-string">'w') <span class="cm-keyword">as <span class="cm-variable">f:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">json.<span class="cm-property">dump(<span class="cm-variable">dic,<span class="cm-variable">f)<br /><span> &nbsp; &nbsp;<span class="cm-variable">lock.<span class="cm-property">release() &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 还钥匙<br /><span><span>​<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">'__main__':<br /><span> &nbsp; &nbsp;<span class="cm-comment"># for i in range(10):<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp; &nbsp; p = Process(target=show,args=(i,))<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span> &nbsp; &nbsp;<span class="cm-variable">lock = <span class="cm-variable">Lock()<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">10):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">buy_ticket, <span class="cm-variable">args=(<span class="cm-variable">i,<span class="cm-variable">lock))<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">start()<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># =================================================<br /><span><span class="cm-comment"># =================================================</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">2 信号量_事件</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 多进程中的组件<br /><span><span class="cm-comment"># 一个资源 同一时间 被n个人访问<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">import <span class="cm-variable">random<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Process,<span class="cm-variable">Event<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># 未用信号量<br /><span><span class="cm-comment"># def ktv(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s走进ktv'%i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(random.randint(1,5))<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s走出ktv'%i)<br /><span><span class="cm-comment"># if __name__ == '__main__' :<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(20):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p = Process(target=ktv,args=(i))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Semaphore<br /><span><span>​<br /><span><span class="cm-comment"># sem = Semaphore(4)<br /><span><span class="cm-comment"># sem.acquire()<br /><span><span class="cm-comment"># print('拿到第一把钥匙')<br /><span><span class="cm-comment"># sem.acquire()<br /><span><span class="cm-comment"># print('拿到第二把钥匙')<br /><span><span class="cm-comment"># sem.acquire()<br /><span><span class="cm-comment"># print('拿到第三把钥匙')<br /><span><span class="cm-comment"># sem.acquire()<br /><span><span class="cm-comment"># print('拿到第四把钥匙')<br /><span><span class="cm-comment"># sem.acquire()<br /><span><span class="cm-comment"># print('拿到第五把钥匙')<br /><span><span class="cm-comment"># def ktv(i,sem):<br /><span><span class="cm-comment"># &nbsp; &nbsp; sem.acquire() &nbsp;  #获取钥匙<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s走进ktv'%i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(random.randint(1,5))<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s走出ktv'%i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; sem.release() &nbsp;  # 释放钥匙<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__' :<br /><span><span class="cm-comment"># &nbsp; &nbsp; sem = Semaphore(4)<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(20):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p = Process(target=ktv,args=(i,sem))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.start()<br /><span><span>​<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># 事件<br /><span><span class="cm-comment"># &nbsp; 信号是控制进程阻塞与否<br /><span><span class="cm-comment"># &nbsp; 事件创建后,默认是阻塞状态<br /><span><span class="cm-comment"># e = Event() # 创建事件<br /><span><span class="cm-comment"># e.is_set()  # False 默认阻塞<br /><span><span class="cm-comment"># print("xx") # 可打印 e.set() 设置为True e.clear() 设置为False<br /><span><span class="cm-comment"># e.wait()<br /><span><span class="cm-comment"># print("xx") # 阻塞<br /><span><span class="cm-comment"># 遇到wait()会判断is_set() 为False 阻塞<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># 红绿灯事件<br /><span><span class="cm-keyword">def <span class="cm-def">cars(<span class="cm-variable">e,<span class="cm-variable">i):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-keyword">not <span class="cm-variable">e.<span class="cm-property">is_set():<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"car%i在等待" <span class="cm-operator">% <span class="cm-variable">i)<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e.<span class="cm-property">wait()<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"car%i通过" <span class="cm-operator">% <span class="cm-variable">i)<br /><span><span>​<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">light(<span class="cm-variable">e):<br /><span> &nbsp; &nbsp;<span class="cm-keyword">while <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">e.<span class="cm-property">is_set():<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e.<span class="cm-property">clear()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"\033[31m红灯\033[0m")<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">e.<span class="cm-property">set()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"\033[32m绿灯\033[0m")<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">2)<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">"__main__":<br /><span> &nbsp; &nbsp;<span class="cm-variable">e = <span class="cm-variable">Event()<br /><span> &nbsp; &nbsp;<span class="cm-variable">p =<span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">light,<span class="cm-variable">args=(<span class="cm-variable">e,))<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">start()<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">1,<span class="cm-number">21):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">car = <span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">cars,<span class="cm-variable">args=(<span class="cm-variable">e,<span class="cm-variable">i))<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">car.<span class="cm-property">start()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-variable">random.<span class="cm-property">random())<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># ==============================<br /><span><span class="cm-comment"># def test(e):<br /><span><span class="cm-comment"># &nbsp; &nbsp; e.set()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("xxx")<br /><span><span class="cm-comment"># if __name__=="__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; e = Event()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(e.is_set())<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=test,args=(e,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; e.wait()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("注")<br /><span><span>​</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">3 进程通信_队列管道</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># IPC 内部进程通信,不能使用普通queue<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Queue,<span class="cm-variable">Process<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment"># q = Queue(5)  # 队列大小<br /><span><span class="cm-comment"># q.put(1)<br /><span><span class="cm-comment"># q.put(1)<br /><span><span class="cm-comment"># q.full()  # 若队列满了,阻塞等待<br /><span><span class="cm-comment"># q.get()<br /><span><span class="cm-comment"># q.empty()  # 若为空,阻塞等待有数据 后取值<br /><span><span class="cm-comment"># q.get()<br /><span><span class="cm-comment"># q.get_nowait()  # 用于跳过等待,需要用try<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment"># def produce(q):<br /><span><span class="cm-comment"># &nbsp; &nbsp; q.put('hello')<br /><span><span class="cm-comment"># def consume(q):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(q.get())<br /><span><span class="cm-comment"># if __name__ =="__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; q = Queue()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=produce,args=(q,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p2 = Process(target=consume, args=(q,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p2.start()<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment"># 生产者消费者模型<br /><span><span class="cm-comment"># 若生产者,生产有数量,消费者,不停消费,最后消费进程会处于等待状态<br /><span><span class="cm-comment"># 可在主进程后边join生产进程,消费进程判断为空,但不准确<br /><span><span class="cm-comment"># &nbsp; 需要在队列put(None) 子进程判断,由于数据之间不能共享,需要put 消费数量的None<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">JoinableQueue<br /><span><span class="cm-comment"># consume :<br /><span><span class="cm-comment"># &nbsp; &nbsp; ....<br /><span><span class="cm-comment"># &nbsp; &nbsp; q.task_done()<br /><span><span class="cm-comment"># produce :<br /><span><span class="cm-comment"># &nbsp; &nbsp; ...<br /><span><span class="cm-comment"># &nbsp; &nbsp; q.join()<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment">#  循环通知,致使进程结束<br /><span><span class="cm-comment"># JoinableQueue<br /><span><span class="cm-comment"># 生产者生产,不停不停消费,若q为空 一直等待,<br /><span><span class="cm-comment"># &nbsp; 生产者完毕后,会join等待消费值消费完毕,因为是同一个q,一个生产者完毕后,其他还没有完毕q会处于,他会处于阻塞<br /><span><span class="cm-comment"># &nbsp; 等待 消费者 全部消费完毕,q.join()会感知,因此 生产进程会结束,主进程最后join生产进程,生产结束<br /><span><span class="cm-comment"># &nbsp; 主进程就结束,身为守护进程的子进程也结束<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># import random<br /><span><span class="cm-comment"># from multiprocessing import Process,JoinableQueue<br /><span><span class="cm-comment"># def consumer(q,name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; food = q.get()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print('\033[31m%s消费了%s\033[0m' % (name,food))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(random.randint(1,3))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; q.task_done() &nbsp; &nbsp; # count - 1<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def producer(name,food,q):<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(4):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(random.randint(1,3))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; f = '%s生产了%s%s'%(name,food,i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; q.put(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; q.join() &nbsp;  # 阻塞  直到一个队列中的所有数据 全部被处理完毕<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__  == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; q = JoinableQueue(20)<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1 = Process(target=producer,args=('Egon','包子',q))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p2 = Process(target=producer, args=('wusir','泔水', q))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1 = Process(target=consumer, args=(q,'alex'))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2 = Process(target=consumer, args=(q,'jinboss'))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p2.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1.daemon = True &nbsp; # 设置为守护进程 主进程中的代码执行完毕之后,子进程自动结束<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2.daemon = True<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1.join()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p2.join() &nbsp; &nbsp;  # 感知一个进程的结束<br /><span><span>​<br /><span><span class="cm-comment">#  在消费者这一端:<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 每次获取一个数据<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 处理一个数据<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 发送一个记号 : 标志一个数据被处理成功<br /><span><span>​<br /><span><span class="cm-comment"># 在生产者这一端:<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 每一次生产一个数据,<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 且每一次生产的数据都放在队列中<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 在队列中刻上一个记号<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 当生产者全部生产完毕之后,<br /><span> &nbsp; &nbsp;<span class="cm-comment"># join信号 : 已经停止生产数据了<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 且要等待之前被刻上的记号都被消费完<br /><span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 当数据都被处理完时,join阻塞结束<br /><span><span>​<br /><span><span class="cm-comment"># consumer 中把所有的任务消耗完<br /><span><span class="cm-comment"># producer 端 的 join感知到,停止阻塞<br /><span><span class="cm-comment"># 所有的producer进程结束<br /><span><span class="cm-comment"># 主进程中的p.join结束<br /><span><span class="cm-comment"># 主进程中代码结束<br /><span><span class="cm-comment"># 守护进程(消费者的进程)结束<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment"># 管道 双向通信工具<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Pipe<br /><span><span class="cm-comment"># conn,conn2 = Pipe()<br /><span><span class="cm-comment"># conn.send("123456")  # 不用字节<br /><span><span class="cm-comment"># print(conn2.recv())  # 不用指定大小<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">fun(<span class="cm-variable">conn):<br /><span> &nbsp; &nbsp;<span class="cm-variable">conn.<span class="cm-property">send(<span class="cm-string">"hello")<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__==<span class="cm-string">"__main__":<br /><span> &nbsp; &nbsp;<span class="cm-variable">conn1,<span class="cm-variable">conn2  = <span class="cm-variable">Pipe()<br /><span> &nbsp; &nbsp;<span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">fun,<span class="cm-variable">args=(<span class="cm-variable">conn1,)).<span class="cm-property">start()<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">conn1.<span class="cm-property">recv())<br /><span><span class="cm-comment"># 管道返回2个连接<br /><span><span class="cm-comment"># &nbsp;  conn1, conn2<br /><span><span class="cm-comment"># P &nbsp;  发送 接受<br /><span><span class="cm-comment"># p2 &nbsp; 接受 发送<br /><span><span class="cm-comment"># 若只发数据,可关闭一端,若取数据的时候,对面已关闭,则报错,看根据此 终止程序<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Pipe,<span class="cm-variable">Process<br /><span><span class="cm-comment"># def func(conn1,conn2):<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn2.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; try :<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; msg = conn1.recv()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(msg)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; except EOFError:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; conn1.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn1, conn2 = Pipe()<br /><span><span class="cm-comment"># &nbsp; &nbsp; Process(target=func,args = (conn1,conn2)).start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn1.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(20):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; conn2.send('吃了么')<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn2.close()<br /><span><span class="cm-comment"># ===============================<br /><span><span class="cm-comment"># from multiprocessing import Lock,Pipe,Process<br /><span><span class="cm-comment"># def producer(con,pro,name,food):<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(100):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; f = '%s生产%s%s'%(name,food,i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; pro.send(f)<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.send(None)<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.send(None)<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.send(None)<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def consumer(con,pro,name,lock):<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lock.acquire()  # 不安全主要是recv的时候,因此两端加锁即可<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; food = con.recv()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if food is None:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; con.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print('%s吃了%s' % (name, food))<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; con,pro = Pipe()<br /><span><span class="cm-comment"># &nbsp; &nbsp; lock= Lock()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Process(target=producer,args=(con,pro,'egon','泔水'))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1 = Process(target=consumer, args=(con, pro, 'alex',lock))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2 = Process(target=consumer, args=(con, pro, 'bossjin',lock))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c3 = Process(target=consumer, args=(con, pro, 'wusir',lock))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c3.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; pro.close()<br /><span><span>​<br /><span><span class="cm-comment"># from multiprocessing import Process,Pipe,Lock<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def consumer(produce, consume,name,lock):<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; baozi=consume.recv()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; if baozi:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print('%s 收到包子:%s' %(name,baozi))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; else:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; consume.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def producer(produce, consume,n):<br /><span><span class="cm-comment"># &nbsp; &nbsp; consume.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(n):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; produce.send(i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce.send(None)<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce.send(None)<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce,consume=Pipe()<br /><span><span class="cm-comment"># &nbsp; &nbsp; lock = Lock()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1=Process(target=consumer,args=(produce,consume,'c1',lock))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2=Process(target=consumer,args=(produce,consume,'c2',lock))<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1=Process(target=producer,args=(produce,consume,30))<br /><span><span class="cm-comment"># &nbsp; &nbsp; c1.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; c2.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; p1.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; produce.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; consume.close()<br /><span><span>​<br /><span><span class="cm-comment"># pipe 数据不安全性<br /><span><span class="cm-comment"># IPC<br /><span><span class="cm-comment"># 加锁来控制操作管道的行为 来避免进程之间争抢数据造成的数据不安全现象<br /><span><span>​<br /><span><span class="cm-comment"># 队列 进程之间数据安全的<br /><span><span class="cm-comment"># &nbsp; 管道 + 锁</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">3_进程通信__数据共享</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Manager,<span class="cm-variable">Process,<span class="cm-variable">Lock<br /><span><span class="cm-comment"># 进程之间不能传递数据,通过方法的参数可以传过去,但修改后,无反应,不知道原因<br /><span><span class="cm-keyword">def <span class="cm-def">main(<span class="cm-builtin">dict,<span class="cm-variable">lock):<br /><span> &nbsp; &nbsp;<span class="cm-variable">lock.<span class="cm-property">acquire()<br /><span> &nbsp; &nbsp;<span class="cm-builtin">dict[<span class="cm-string">'count']-=<span class="cm-number">1<br /><span> &nbsp; &nbsp;<span class="cm-variable">lock.<span class="cm-property">release()<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">"__main__":<br /><span> &nbsp; &nbsp;<span class="cm-variable">m = <span class="cm-variable">Manager()<br /><span> &nbsp; &nbsp;<span class="cm-variable">l = <span class="cm-variable">Lock()<br /><span> &nbsp; &nbsp;<span class="cm-builtin">dict = <span class="cm-variable">m.<span class="cm-property">dict({<span class="cm-string">"count":<span class="cm-number">100})<br /><span> &nbsp; &nbsp;<span class="cm-variable">p_list=[]<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">50):<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Process(<span class="cm-variable">target=<span class="cm-variable">main,<span class="cm-variable">args=(<span class="cm-builtin">dict,<span class="cm-variable">l))<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">start()<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p_list.<span class="cm-property">append(<span class="cm-variable">p)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-variable">p_list:<span class="cm-variable">i.<span class="cm-property">join()<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-builtin">dict[<span class="cm-string">'count'])</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">4_进程池</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 进程池<br /><span><span class="cm-comment"># 上一个例子中50个进程很慢<br /><span><span class="cm-comment"># &nbsp; 寄存器 堆栈 文件<br /><span><span class="cm-comment"># &nbsp; 操作系统调度,cup切换<br /><span><span class="cm-comment"># 高级线程池有数量限定 ,有最低,任务变多的时候 逐步加到最高限制<br /><span><span class="cm-keyword">import <span class="cm-variable">os,<span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Pool,<span class="cm-variable">Manager<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># def func2(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(os.getpid(),os.getppid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; i+1<br /><span><span class="cm-comment"># def func(list):<br /><span><span class="cm-comment"># &nbsp; &nbsp; list[1]['set'].add(os.getpid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(len(list[1]['set']))<br /><span><span class="cm-comment"># # 一般超过5个使用pool<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; pid = Manager()<br /><span><span class="cm-comment"># &nbsp; &nbsp; dict1 = pid.dict({"set":set()})<br /><span><span class="cm-comment"># &nbsp; &nbsp; pool = Pool(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; # 执行不同的任务,map 自带join方法<br /><span><span class="cm-comment"># &nbsp; &nbsp; #pool.map(func2,range(100))<br /><span><span class="cm-comment"># &nbsp; &nbsp; pool.map(func, [[i,dict1]for i in range(100)])<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(len(dict1['set']))<br /><span><span class="cm-comment"># """<br /><span><span class="cm-comment"># 等于<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(100):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p = Process(target=func,args=(i,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.start()<br /><span><span class="cm-comment"># """<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># def fun(n):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("start fun%s" %n,os.getpid())<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print("end fun%s" % n, os.getpid())<br /><span><span class="cm-comment"># if __name__ == "__main__":<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Pool() # 默认cup核心数量<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; #p.apply(fun,args=(i,)) # 同步提交的<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.apply_async(fun,args=(i,)) # 异步提交,真的异步,因此需要join<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.close()  # 不再接受新的任务<br /><span><span class="cm-comment"># &nbsp; &nbsp; p.join()  # 感知进程池中任务结束 保持 主进程 与子进程同步<br /><span><span>​<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># import socket<br /><span><span class="cm-comment"># from multiprocessing import Pool<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def func(conn):<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.send(b'hello')<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(conn.recv(1024).decode('utf-8'))<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Pool(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk = socket.socket()<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.bind(('127.0.0.1',8080))<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.listen()<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; conn, addr = sk.accept()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; p.apply_async(func,args=(conn,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.close()<br /><span><span class="cm-comment"># &nbsp; &nbsp; import socket<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk = socket.socket()<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.connect(('127.0.0.1', 8080))<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># &nbsp; &nbsp; ret = sk.recv(1024).decode('utf-8')<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(ret)<br /><span><span class="cm-comment"># &nbsp; &nbsp; msg = input('&gt;&gt;&gt;').encode('utf-8')<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.send(msg)<br /><span><span class="cm-comment"># &nbsp; &nbsp; sk.close()<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># 进程池的返回值<br /><span><span class="cm-comment"># p = Pool()<br /><span><span class="cm-comment"># p.map(funcname,iterable) &nbsp; &nbsp; 默认异步的执行任务,且自带close和join<br /><span><span class="cm-comment"># p.apply &nbsp; 同步调用的<br /><span><span class="cm-comment"># p.apply_async 异步调用 和主进程完全异步 需要手动close 和 join<br /><span><span class="cm-comment"># from multiprocessing import Pool<br /><span><span class="cm-comment"># def func(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; return i*i<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Pool(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; res = p.apply(func,args=(i,)) &nbsp; # apply的结果就是func的返回值<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print(res) --&gt; 直接就是返回值<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># from multiprocessing import Pool<br /><span><span class="cm-comment"># def func(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(0.5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; return i*i<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Pool(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; res_l = []<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; res = p.apply_async(func,args=(i,)) &nbsp; # apply的结果就是func的返回值<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; res_l.append(res)<br /><span><span class="cm-comment"># &nbsp; 若在for 中直接获取res.get()会在成阻塞,程序变同步执行<br /><span><span class="cm-comment"># &nbsp; &nbsp; for res in res_l:print(res.get())# 等着 func的计算结果<br /><span><span class="cm-comment"># &nbsp;  调用res.get时返回<br /><span><span class="cm-comment"># ==================================<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># from multiprocessing import Pool<br /><span><span class="cm-comment"># def func(i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(0.5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; return i*i<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; p = Pool(5)<br /><span><span class="cm-comment"># &nbsp; &nbsp; ret = p.map(func,range(100))<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(ret)  #  -&gt; 直接返回全部,列表返回<br /><span><span class="cm-comment"># 自带join,close 最后一起返回<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># 回调函数 , 回调的函数在主进程调用<br /><span><span class="cm-comment"># 对于子进程中再起子进程问题,还不知道<br /><span><span class="cm-comment"># 每个进程的回调函数 交给主进程顺序执行<br /><span><span class="cm-keyword">import <span class="cm-variable">os<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Pool,<span class="cm-variable">Process<br /><span><span class="cm-keyword">def <span class="cm-def">func2(<span class="cm-variable">nn):<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'in func2',<span class="cm-variable">os.<span class="cm-property">getpid())<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">nn)<br /><span><span class="cm-keyword">def <span class="cm-def">func3(<span class="cm-variable">n):<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'in func3', <span class="cm-variable">os.<span class="cm-property">getpid())<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">n<span class="cm-operator">*<span class="cm-variable">n<br /><span><span class="cm-keyword">def <span class="cm-def">func1(<span class="cm-variable">n):<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'in func1',<span class="cm-variable">os.<span class="cm-property">getpid())<br /><span> &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Pool(<span class="cm-number">5)<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">apply_async(<span class="cm-variable">func3, <span class="cm-variable">args=(<span class="cm-number">10,), <span class="cm-variable">callback=<span class="cm-variable">func2)<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">close()<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">join()<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">n<span class="cm-operator">*<span class="cm-variable">n<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">'__main__':<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'主进程 :',<span class="cm-variable">os.<span class="cm-property">getpid())<br /><span> &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Pool(<span class="cm-number">5)<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">apply_async(<span class="cm-variable">func1,<span class="cm-variable">args=(<span class="cm-number">10,),<span class="cm-variable">callback=<span class="cm-variable">func2)<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">close()<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">join()<br /><span><span class="cm-comment"># ===================================================<br /><span><span class="cm-keyword">import <span class="cm-variable">requests<br /><span><span class="cm-keyword">from <span class="cm-variable">urllib.<span class="cm-property">request <span class="cm-keyword">import <span class="cm-variable">urlopen<br /><span><span class="cm-keyword">from <span class="cm-variable">multiprocessing <span class="cm-keyword">import <span class="cm-variable">Pool<br /><span><span class="cm-comment"># 200 网页正常的返回<br /><span><span class="cm-comment"># 404 网页找不到<br /><span><span class="cm-comment"># 502 504<br /><span><span class="cm-comment"># 场景:callback 耗时段,远小于网络延时,此时使用,在主进程运行,<br /><span><span class="cm-keyword">def <span class="cm-def">get(<span class="cm-variable">url):<br /><span> &nbsp; &nbsp;<span class="cm-variable">response = <span class="cm-variable">requests.<span class="cm-property">get(<span class="cm-variable">url)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">if <span class="cm-variable">response.<span class="cm-property">status_code == <span class="cm-number">200:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">url, <span class="cm-variable">response.<span class="cm-property">content.<span class="cm-property">decode(<span class="cm-string">'utf-8')<br /><span><span>​<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">get_urllib(<span class="cm-variable">url):<br /><span> &nbsp; &nbsp;<span class="cm-variable">ret = <span class="cm-variable">urlopen(<span class="cm-variable">url)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">ret.<span class="cm-property">read().<span class="cm-property">decode(<span class="cm-string">'utf-8')<br /><span><span>​<br /><span><span>​<br /><span><span class="cm-keyword">def <span class="cm-def">call_back(<span class="cm-variable">args):<br /><span> &nbsp; &nbsp;<span class="cm-variable">url, <span class="cm-variable">content = <span class="cm-variable">args<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">url, <span class="cm-builtin">len(<span class="cm-variable">content))<br /><span><span>​<br /><span><span>​<br /><span><span class="cm-keyword">if <span class="cm-variable">__name__ == <span class="cm-string">'__main__':<br /><span> &nbsp; &nbsp;<span class="cm-variable">url_lst = [<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'https://www.cnblogs.com/',<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'http://www.baidu.com',<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'https://www.sogou.com/',<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">'http://www.sohu.com/',<br /><span> &nbsp;  ]<br /><span> &nbsp; &nbsp;<span class="cm-variable">p = <span class="cm-variable">Pool(<span class="cm-number">5)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">for <span class="cm-variable">url <span class="cm-keyword">in <span class="cm-variable">url_lst:<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">apply_async(<span class="cm-variable">get, <span class="cm-variable">args=(<span class="cm-variable">url,), <span class="cm-variable">callback=<span class="cm-variable">call_back) <span class="cm-comment"># callback 中的参数为 get函数的返回值<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">close()<br /><span> &nbsp; &nbsp;<span class="cm-variable">p.<span class="cm-property">join()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">4_线程</span></h1><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><h4 class="md-end-block md-heading"><span class="md-plain">两者之间应该有对应关系1:1 1:n</span></h4><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><h3 class="md-end-block md-heading"><span class="md-plain">linux 中的nptl 1对1 线程</span></h3><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 同一进程的线程间的数据共享的,共享的 共享的<br /><span><span class="cm-comment"># &nbsp; 可通过直接访问全局变量 global,还需要进程同步<br /><span><span class="cm-comment"># &nbsp; 创建,切换,撤销 相比进程 消耗小,轻量级<br /><span><span class="cm-comment"># &nbsp; 进程:资源分配单位,每个进程 至少一个线程<br /><span><span class="cm-comment"># &nbsp; 线程:cup调度单位<br /><span><span class="cm-comment"># thread 基本模块,避免使用,可能与threading 冲突<br /><span><span class="cm-comment"># threading thread的高级版本<br /><span><span class="cm-comment"># Queue 多线程之间共享数据的数据结构<br /><span><span class="cm-comment"># 与进程类似,好多方法相同<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">threading <span class="cm-keyword">import <span class="cm-variable">Thread<br /><span><span class="cm-keyword">import <span class="cm-variable">threading<br /><span><span class="cm-comment"># def func(n):<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(n)<br /><span><span class="cm-comment"># t = Thread(target=func,args=(12,))<br /><span><span class="cm-comment"># t.daemon = True # 成为"守护线程"<br /><span><span class="cm-comment"># t.start()<br /><span><span class="cm-comment"># print("主线程") # 默认情况等待子线程结束<br /><span><span class="cm-comment"># ===================================<br /><span><span class="cm-comment"># class MyThread(Thread):<br /><span><span class="cm-comment"># &nbsp; &nbsp; def __init__(self,name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; super().__init__()<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; self.name = name<br /><span><span class="cm-comment"># &nbsp; &nbsp; def run(self):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; # time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print(self.name)<br /><span><span class="cm-comment"># MyThread("thread1").start()<br /><span><span class="cm-comment"># ================================<br /><span><span class="cm-comment"># GIL 锁的是线程,同一时间 只有一个线程 ,cpython解释器的问题,jpython 就不会<br /><span><span class="cm-comment"># 对于io密集型 没什么区别,只要io时会切换即可<br /><span><span class="cm-comment"># 但对于多核cup python 同时只能运行一个cup ,其他语言的会运行多个,因此...<br /><span><span class="cm-comment"># 即不能通过物理核心数增加速度,不能实现(并行)<br /><span><span class="cm-comment"># ============================================<br /><span><span class="cm-comment"># 多线程socket 可以input<br /><span><span class="cm-comment"># import socket<br /><span><span class="cm-comment"># from threading import Thread<br /><span><span class="cm-comment"># def chat(conn):<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.send(b'hello')<br /><span><span class="cm-comment"># &nbsp; &nbsp; msg = conn.recv(1024).decode('utf-8')<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(msg)<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn.close()<br /><span><span class="cm-comment"># sk = socket.socket()<br /><span><span class="cm-comment"># sk.bind(('127.0.0.1',8080))<br /><span><span class="cm-comment"># sk.listen()<br /><span><span class="cm-comment"># while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; conn,addr = sk.accept()<br /><span><span class="cm-comment"># &nbsp; &nbsp; Thread(target=chat,args = (conn,)).start()<br /><span><span class="cm-comment"># sk.close()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># import socket<br /><span><span class="cm-comment"># sk = socket.socket()<br /><span><span class="cm-comment"># sk.connect(('127.0.0.1',8080))<br /><span><span class="cm-comment"># msg = sk.recv(1024)<br /><span><span class="cm-comment"># print(msg)<br /><span><span class="cm-comment"># inp = input('&gt;&gt;&gt; ').encode('utf-8')<br /><span><span class="cm-comment"># sk.send(inp)<br /><span><span class="cm-comment"># sk.close()<br /><span><span class="cm-comment"># =========================<br /><span><span class="cm-comment"># print(threading.current_thread()) # 当前线程<br /><span><span class="cm-comment"># print(threading.active_count()) # 全部线程,包括主线程<br /><span><span class="cm-comment"># print(threading.enumerate())  # 列表返回全部线程对象<br /><span><span class="cm-comment"># ==========================================<br /><span><span class="cm-comment"># 守护线程<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># from threading import Thread<br /><span><span class="cm-comment"># def func1():<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print('*'*10)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># def func2():<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('in func2')<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(5)<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># t = Thread(target=func1,)<br /><span><span class="cm-comment"># t.daemon = True<br /><span><span class="cm-comment"># t.start()<br /><span><span class="cm-comment"># t2 = Thread(target=func2,)<br /><span><span class="cm-comment"># t2.start()<br /><span><span class="cm-comment"># t2.join()<br /><span><span class="cm-comment"># print('主线程')<br /><span><span>​<br /><span><span class="cm-comment"># (守护进程)随着(主进程代码)的执行结束而结束<br /><span><span class="cm-comment"># 守护(线程)会在主线程结束之后等待(其他非守护子线程)的结束才结束<br /><span><span>​<br /><span><span class="cm-comment"># 主进程在执行完自己的代码之后不会立即结束 而是等待子进程结束之后 回收子进程的资源<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># from multiprocessing import Process<br /><span><span class="cm-comment"># def func():<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(5)<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># if __name__ == '__main__':<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; Process(target=func).start()<br /><span><span class="cm-comment"># =========================================<br /><span><span class="cm-comment"># 线程锁 ,与gil无关<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">threading <span class="cm-keyword">import <span class="cm-variable">Lock,<span class="cm-variable">Thread<br /><span><span class="cm-comment"># Lock 互斥锁<br /><span><span class="cm-comment"># def func(lock):<br /><span><span class="cm-comment"># &nbsp; &nbsp; global n<br /><span><span class="cm-comment"># &nbsp; &nbsp; lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; temp = n<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(0.2)<br /><span><span class="cm-comment"># &nbsp; &nbsp; n = temp - 1<br /><span><span class="cm-comment"># &nbsp; &nbsp; lock.release()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># n = 10<br /><span><span class="cm-comment"># t_lst = []<br /><span><span class="cm-comment"># lock = Lock()<br /><span><span class="cm-comment"># for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; t = Thread(target=func,args=(lock,))<br /><span><span class="cm-comment"># &nbsp; &nbsp; t.start()<br /><span><span class="cm-comment"># &nbsp; &nbsp; t_lst.append(t)<br /><span><span>​<br /><span><span class="cm-comment"># for t in  t_lst: t.join()<br /><span><span class="cm-comment"># print(n)<br /><span><span>​<br /><span><span class="cm-comment"># 科学家吃面 &nbsp; 还会死锁<br /><span><span>​<br /><span><span class="cm-comment"># noodle_lock  = Lock()<br /><span><span class="cm-comment"># fork_lock = Lock()<br /><span><span class="cm-comment"># def eat1(name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到面条啦'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到叉子了'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s吃面'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.release()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def eat2(name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到叉子了'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到面条啦'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s吃面'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.release()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># Thread(target=eat1,args=('alex',)).start()<br /><span><span class="cm-comment"># Thread(target=eat2,args=('Egon',)).start()<br /><span><span class="cm-comment"># Thread(target=eat1,args=('bossjin',)).start()<br /><span><span class="cm-comment"># Thread(target=eat2,args=('nezha',)).start()<br /><span><span class="cm-comment"># ===============================================<br /><span><span class="cm-keyword">from <span class="cm-variable">threading <span class="cm-keyword">import <span class="cm-variable">RLock &nbsp; <span class="cm-comment"># 递归锁<br /><span><span class="cm-variable">fork_lock = <span class="cm-variable">noodle_lock  = <span class="cm-variable">RLock()<br /><span><span class="cm-comment"># 一个钥匙串上的两把钥匙,同一个lock 在一个线程中可又多次acquire<br /><span><span class="cm-comment"># 传给其他线程时 不能被acquire<br /><span><span class="cm-comment"># def eat1(name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.acquire() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  # 一把钥匙<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到面条啦'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到叉子了'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s吃面'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.release()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def eat2(name):<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到叉子了'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s拿到面条啦'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('%s吃面'%name)<br /><span><span class="cm-comment"># &nbsp; &nbsp; noodle_lock.release()<br /><span><span class="cm-comment"># &nbsp; &nbsp; fork_lock.release()<br /><span><span class="cm-comment"># Thread(target=eat1,args=('alex',)).start()<br /><span><span class="cm-comment"># Thread(target=eat2,args=('Egon',)).start()<br /><span><span class="cm-comment"># Thread(target=eat1,args=('bossjin',)).start()<br /><span><span class="cm-comment"># Thread(target=eat2,args=('nezha',)).start()<br /><span><span class="cm-comment"># =================================================</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">5<span>_<span class="md-plain">线程<span>_<span class="md-plain">信号量<span>_<span class="md-plain">事件<span>_<span class="md-plain">条件<span>_<span class="md-plain">定时器<span>_<span class="md-plain">列队<span>_<span class="md-plain">线程池</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-keyword">from <span class="cm-variable">threading <span class="cm-keyword">import <span class="cm-variable">Semaphore,<span class="cm-variable">Thread<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># def func(sem,a,b):<br /><span><span class="cm-comment"># &nbsp; &nbsp; sem.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(a+b)<br /><span><span class="cm-comment"># &nbsp; &nbsp; sem.release()<br /><span><span class="cm-comment"># sem = Semaphore(4)<br /><span><span class="cm-comment"># for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; t = Thread(target=func,args=(sem,i,i+5))<br /><span><span class="cm-comment"># &nbsp; &nbsp; t.start()<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># 事件被创建的时候<br /><span><span class="cm-comment"># False状态<br /><span> &nbsp; &nbsp;<span class="cm-comment"># wait() 阻塞<br /><span><span class="cm-comment"># True状态<br /><span> &nbsp; &nbsp;<span class="cm-comment"># wait() 非阻塞<br /><span><span class="cm-comment"># clear 设置状态为False<br /><span><span class="cm-comment"># set  设置状态为True<br /><span><span class="cm-comment">#  数据库 - 文件夹<br /><span><span class="cm-comment">#  文件夹里有好多excel表格<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 1.能够更方便的对数据进行增删改查<br /><span> &nbsp; &nbsp;<span class="cm-comment"># 2.安全访问的机制<br /><span><span class="cm-comment">#  起两个线程<br /><span><span class="cm-comment">#  第一个线程 : 连接数据库<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 等待一个信号 告诉我我们之间的网络是通的<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 连接数据库<br /><span><span class="cm-comment">#  第二个线程 : 检测与数据库之间的网络是否连通<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># time.sleep(0,2) 2<br /><span> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment"># 将事件的状态设置为True<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># import random<br /><span><span class="cm-comment"># from threading import Thread,Event<br /><span><span class="cm-comment"># def connect_db(e):<br /><span><span class="cm-comment"># &nbsp; &nbsp; count = 0<br /><span><span class="cm-comment"># &nbsp; &nbsp; while count &lt; 3:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; e.wait(0.5) &nbsp; # 状态为False的时候,我只等待1s就结束<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; if e.is_set() == True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print('连接数据库')<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; else:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; count += 1<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print('第%s次连接失败'%count)<br /><span><span class="cm-comment"># &nbsp; &nbsp; else:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; raise TimeoutError('数据库连接超时')<br /><span><span class="cm-comment"># def check_web(e):<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(random.randint(0,3))<br /><span><span class="cm-comment"># &nbsp; &nbsp; e.set()<br /><span><span class="cm-comment"># e = Event()<br /><span><span class="cm-comment"># t1 = Thread(target=connect_db,args=(e,))<br /><span><span class="cm-comment"># t2 = Thread(target=check_web,args=(e,))<br /><span><span class="cm-comment"># t1.start()<br /><span><span class="cm-comment"># t2.start()<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># 条件 复杂的锁<br /><span><span class="cm-comment"># 条件<br /><span><span class="cm-keyword">from <span class="cm-variable">threading <span class="cm-keyword">import <span class="cm-variable">Condition<br /><span><span class="cm-comment"># 条件<br /><span><span class="cm-comment"># 锁<br /><span><span class="cm-comment"># acquire release<br /><span><span class="cm-comment"># 一个条件被创建之初 默认有一个(False)状态<br /><span><span class="cm-comment"># False状态 会影响wait一直处于等待状态<br /><span><span class="cm-comment"># notify(int数据类型)  造钥匙<br /><span><span class="cm-comment"># from threading import Thread,Condition<br /><span><span class="cm-comment"># def func(con,i):<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.wait() # 等钥匙<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('在第%s个循环里'%i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.release()<br /><span><span class="cm-comment"># con = Condition()<br /><span><span class="cm-comment"># for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; Thread(target=func,args = (con,i)).start()<br /><span><span class="cm-comment"># while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; num = int(input('&gt;&gt;&gt;'))<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.acquire()<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.notify(num)  # 造钥匙<br /><span><span class="cm-comment"># &nbsp; &nbsp; con.release()<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment">#定时器<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># from threading import Timer<br /><span><span class="cm-comment"># def func():<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('时间同步') &nbsp; #1-3<br /><span><span class="cm-comment"># while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; t = Timer(5,func).start() &nbsp; # 非阻塞的 ,异步的 ,会把所有的5s在一起<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(5) # 睡5s 每5s进行意思时间同步<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># 加锁 麻烦 所以使用队列<br /><span><span class="cm-comment">#线程通信<br /><span><span class="cm-comment"># queue<br /><span><span class="cm-comment"># import queue #直接导入普通queue 是线程安全的<br /><span><span class="cm-comment"># q = queue.Queue()  # 队列 先进先出<br /><span><span class="cm-comment"># q.put()<br /><span><span class="cm-comment"># q.get()<br /><span><span class="cm-comment"># q.put_nowait()<br /><span><span class="cm-comment"># q.get_nowait()<br /><span><span class="cm-comment"># q = queue.LifoQueue()  # 栈 先进后出<br /><span><span class="cm-comment"># q.put(1)<br /><span><span class="cm-comment"># q.put(2)<br /><span><span class="cm-comment"># q.put(3)<br /><span><span class="cm-comment"># print(q.get())<br /><span><span class="cm-comment"># print(q.get())<br /><span><span class="cm-comment"># q = queue.PriorityQueue()  # 优先级队列<br /><span><span class="cm-comment"># q.put((1,'a'))<br /><span><span class="cm-comment"># q.put((10,'b'))<br /><span><span class="cm-comment"># q.put((30,'c'))<br /><span><span class="cm-comment"># q.put((1,'d'))<br /><span><span class="cm-comment"># q.put((1,'f'))<br /><span><span class="cm-comment"># print(q.get())<br /><span><span class="cm-comment"># 元祖中的元素按顺序比较,数字越小优先级大,祖父按照ascii越小优先级越大<br /><span><span class="cm-comment"># ====================================<br /><span><span class="cm-comment"># 线程池<br /><span><span class="cm-keyword">import <span class="cm-variable">time<br /><span><span class="cm-comment"># 以前没有线程池<br /><span><span class="cm-keyword">from <span class="cm-variable">concurrent.<span class="cm-property">futures <span class="cm-keyword">import <span class="cm-variable">ThreadPoolExecutor<br /><span><span class="cm-comment"># ProcessPoolExecutor 该模块下还有一个进程池,与multi 功能相同<br /><span><span class="cm-comment"># submit(fn,*args,**kwargs) 异步提交任务<br /><span><span class="cm-comment"># map(fun,*iterables,timeout=None,chunksize - 1) 循环的submit<br /><span><span class="cm-comment"># shutdown(wait=True) # 等于原来的 close join 合并<br /><span><span class="cm-comment"># result(time=None) 取得结果<br /><span><span class="cm-comment"># add_done_callback(fn) 回调函数<br /><span><span class="cm-keyword">def <span class="cm-def">func(<span class="cm-variable">n):<br /><span> &nbsp; &nbsp;<span class="cm-variable">time.<span class="cm-property">sleep(<span class="cm-number">2)<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">n)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">return <span class="cm-variable">n<span class="cm-operator">*<span class="cm-variable">n<br /><span><span class="cm-keyword">def <span class="cm-def">call_back(<span class="cm-variable">m):<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">'结果是 %s'<span class="cm-operator">%<span class="cm-variable">m.<span class="cm-property">result())<br /><span><span class="cm-comment"># 若使用进程池 只换ThreadPoolExecutor-&gt;ProcessPoolExecutor<br /><span><span class="cm-variable">tpool = <span class="cm-variable">ThreadPoolExecutor(<span class="cm-variable">max_workers=<span class="cm-number">5) &nbsp; <span class="cm-comment">#  默认 不要超过cpu个数*5<br /><span><span class="cm-keyword">for <span class="cm-variable">i <span class="cm-keyword">in <span class="cm-builtin">range(<span class="cm-number">20):<br /><span> &nbsp; &nbsp;<span class="cm-variable">tpool.<span class="cm-property">submit(<span class="cm-variable">func,<span class="cm-variable">i).<span class="cm-property">add_done_callback(<span class="cm-variable">call_back)<br /><span><span class="cm-variable">tpool.<span class="cm-property">shutdown()<br /><span><span class="cm-comment"># tpool.map(func,range(20))  # 拿不到返回值<br /><span><span>​<br /><span><span class="cm-comment"># t_lst = []<br /><span><span class="cm-comment"># for i in  range(20):<br /><span><span class="cm-comment"># &nbsp; &nbsp; t = tpool.submit(func,i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; t_lst.append(t)<br /><span><span class="cm-comment"># tpool.shutdown()  # close+join &nbsp;  #<br /><span><span class="cm-comment"># print('主线程')<br /><span><span class="cm-comment"># for t in t_lst:print('***',t.result()) # 拿返回值</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">6<span>_<span class="md-plain">协程</span></span></span></h1><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 进程 多个进程,操作系统负责<br /><span><span class="cm-comment"># 线程 不能同一时间多个cup 其他语言可以,但不影响高io<br /><span><span class="cm-comment"># &nbsp; 开启线程 创建线程 寄存器 堆栈<br /><span><span class="cm-comment"># &nbsp; 关闭一个线程<br /><span><span class="cm-comment"># 协程<br /><span><span class="cm-comment"># &nbsp; 本质是一个线程<br /><span><span class="cm-comment"># &nbsp; 能够在多个任务间切换,不需要寄存器,堆栈切换<br /><span><span class="cm-comment"># &nbsp; 任务之间切换时间开销 远小于线程<br /><span><span class="cm-comment"># &nbsp; 计算任务之间切换消耗也很大,一般都是遇到io的时候切换<br /><span><span class="cm-comment"># &nbsp; 进程(cup数+1)+线程(cup数*5)+协程(500)  = 50000<br /><span><span class="cm-comment"># &nbsp; 适合爬虫<br /><span><span class="cm-comment"># 实现并发的手段<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># 实现在 con,pro之间来回切换<br /><span><span class="cm-comment"># def consumer():<br /><span><span class="cm-comment"># &nbsp; &nbsp; while True:<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; x = yield<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print('处理了数据 :',x)<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def producer():<br /><span><span class="cm-comment"># &nbsp; &nbsp; c = consumer()<br /><span><span class="cm-comment"># &nbsp; &nbsp; next(c)<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; print('生产了数据 :',i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; c.send(i)<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># producer()<br /><span><span class="cm-comment"># =============================================<br /><span><span class="cm-comment"># 真正的协程模块就是使用greenlet完成的切换<br /><span><span class="cm-keyword">from <span class="cm-variable">greenlet <span class="cm-keyword">import <span class="cm-variable">greenlet<br /><span><span class="cm-comment"># def eat():<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('eating start')<br /><span><span class="cm-comment"># &nbsp; &nbsp; g2.switch()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('eating end')<br /><span><span class="cm-comment"># &nbsp; &nbsp; g2.switch()<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def play():<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('playing start')<br /><span><span class="cm-comment"># &nbsp; &nbsp; g1.switch()<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('playing end')<br /><span><span class="cm-comment"># g1 = greenlet(eat)  # 必须先有g1 ,g2 函数中才能使用g<br /><span><span class="cm-comment"># g2 = greenlet(play) # 不会自动切换<br /><span><span class="cm-comment"># g1.switch()<br /><span><span class="cm-comment"># ======================================<br /><span><span class="cm-comment">#  不能感知time.sleep(1)<br /><span><span class="cm-comment"># 可以感知gevent.sleep(1),在第一行引入 如下from...<br /><span><span class="cm-comment"># 后边的time 都会经过特殊处理,time.sleep() 就可以被识别<br /><span><span class="cm-comment"># from gevent import monkey;monkey.patch_all()<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># import gevent<br /><span><span class="cm-comment"># import threading<br /><span><span class="cm-comment"># def eat():<br /><span><span class="cm-comment"># &nbsp; &nbsp; DummyThread-1 虚拟的线程<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(threading.current_thread().getName())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(threading.current_thread())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('eating start')<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('eating end')<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># def play():<br /><span><span class="cm-comment"># &nbsp; &nbsp; DummyThread-2 虚拟的线程<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(threading.current_thread().getName())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(threading.current_thread())<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('playing start')<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print('playing end')<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># g1 = gevent.spawn(eat) # 注册进入,会自动切换,不是操作系统调度<br /><span><span class="cm-comment"># g2 = gevent.spawn(play) # gevent 负责协程的调度 通过封装的greenlet switch<br /><span><span class="cm-comment"># g1.join()  gevent 是完全异步的  join等待协程结束<br /><span><span class="cm-comment"># g2.join()<br /><span><span class="cm-comment"># 进程和线程的任务切换右操作系统完成<br /><span><span class="cm-comment"># 协程任务之间的切换由程序(代码)完成,只有遇到协程模块能识别的IO操作,(时间片等不识别)的时候,程序才会进行任务切换,实现并发的效果<br /><span><span class="cm-comment"># ========================================<br /><span><span class="cm-comment"># 同步 和 异步<br /><span><span class="cm-comment"># from gevent import monkey;monkey.patch_all() # 放最前面<br /><span><span class="cm-comment"># import time<br /><span><span class="cm-comment"># import gevent<br /><span><span class="cm-comment"># def task(n):<br /><span><span class="cm-comment"># &nbsp; &nbsp; time.sleep(1)<br /><span><span class="cm-comment"># &nbsp; &nbsp; print(n)<br /><span><span class="cm-comment"># def sync(): # 同步<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; task(i)<br /><span><span class="cm-comment"># def async(): # 异步<br /><span><span class="cm-comment"># &nbsp; &nbsp; g_lst = []<br /><span><span class="cm-comment"># &nbsp; &nbsp; for i in range(10):<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; g = gevent.spawn(task,i)<br /><span><span class="cm-comment"># &nbsp; &nbsp; &nbsp; &nbsp; g_lst.append(g)<br /><span><span class="cm-comment"># &nbsp; &nbsp; gevent.joinall(g_lst) &nbsp; #两种方法都可<br /><span><span class="cm-comment"># &nbsp; &nbsp; for g in g_lst:g.join()<br /><span><span class="cm-comment"># ======================================<br /><span><span class="cm-comment"># 协程 : 能够在一个线程中实现并发效果的概念<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp;  能够规避一些任务中的IO操作<br /><span> &nbsp; &nbsp;<span class="cm-comment"># &nbsp;  在任务的执行过程中,检测到IO就切换到其他任务<br /><span><span>​<br /><span><span class="cm-comment"># 多线程 被弱化了<br /><span><span class="cm-comment"># 协程 在一个线程上 提高CPU 的利用率<br /><span><span class="cm-comment"># 协程相比于多线程的优势 切换的效率更快<br /><span><span class="cm-comment"># ==========================================<br /><span><span class="cm-comment"># 爬虫的例子<br /><span><span class="cm-comment"># 请求过程中的IO等待<br /><span><span class="cm-comment"># from gevent import monkey;monkey.patch_all()<br /><span><span class="cm-comment"># import gevent<br /><span><span class="cm-comment"># from urllib.request import urlopen &nbsp;  # 内置的模块<br /><span><span class="cm-comment"># urlopen html时有个格式的 reguests 无格式<br /><span><span class="cm-comment"># def get_url(url):<br /><span><span class="cm-comment"># &nbsp; &nbsp; response = urlopen(url)<br /><span><span class="cm-comment"># &nbsp; &nbsp; content = response.read().decode('utf-8')<br /><span><span class="cm-comment"># &nbsp; &nbsp; return len(content)<br /><span><span class="cm-comment">#<br /><span><span class="cm-comment"># g1 = gevent.spawn(get_url,'http://www.baidu.com')<br /><span><span class="cm-comment"># g2 = gevent.spawn(get_url,'http://www.sogou.com')<br /><span><span class="cm-comment"># g3 = gevent.spawn(get_url,'http://www.taobao.com')<br /><span><span class="cm-comment"># g4 = gevent.spawn(get_url,'http://www.hao123.com')<br /><span><span class="cm-comment"># g5 = gevent.spawn(get_url,'http://www.cnblogs.com')<br /><span><span class="cm-comment"># gevent.joinall([g1,g2,g3,g4,g5])<br /><span><span class="cm-comment"># print(g1.value)<br /><span><span class="cm-comment"># print(g2.value)<br /><span><span class="cm-comment"># print(g3.value)<br /><span><span class="cm-comment"># print(g4.value)<br /><span><span class="cm-comment"># print(g5.value)<br /><span><span>​<br /><span><span class="cm-comment"># ret = get_url('http://www.baidu.com')<br /><span><span class="cm-comment"># print(ret)<br /><span><span class="cm-comment"># ======================================<br /><span><span class="cm-keyword">from <span class="cm-variable">gevent <span class="cm-keyword">import <span class="cm-variable">monkey;<span class="cm-variable">monkey.<span class="cm-property">patch_all()<br /><span><span class="cm-keyword">import <span class="cm-variable">socket<br /><span><span class="cm-keyword">import <span class="cm-variable">gevent<br /><span><span class="cm-keyword">def <span class="cm-def">talk(<span class="cm-variable">conn):<br /><span> &nbsp; &nbsp;<span class="cm-variable">conn.<span class="cm-property">send(<span class="cm-string">b'hello')<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">conn.<span class="cm-property">recv(<span class="cm-number">1024).<span class="cm-property">decode(<span class="cm-string">'utf-8'))<br /><span> &nbsp; &nbsp;<span class="cm-variable">conn.<span class="cm-property">close()<br /><span><span>​<br /><span><span class="cm-variable">sk = <span class="cm-variable">socket.<span class="cm-property">socket()<br /><span><span class="cm-variable">sk.<span class="cm-property">bind((<span class="cm-string">'127.0.0.1',<span class="cm-number">8080))<br /><span><span class="cm-variable">sk.<span class="cm-property">listen()<br /><span><span class="cm-keyword">while <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp;<span class="cm-variable">conn,<span class="cm-variable">addr = <span class="cm-variable">sk.<span class="cm-property">accept()<br /><span> &nbsp; &nbsp;<span class="cm-variable">gevent.<span class="cm-property">spawn(<span class="cm-variable">talk,<span class="cm-variable">conn)<br /><span><span class="cm-variable">sk.<span class="cm-property">close()<br /><span><span>​<br /><span><span class="cm-keyword">import <span class="cm-variable">socket<br /><span><span class="cm-variable">sk = <span class="cm-variable">socket.<span class="cm-property">socket()<br /><span><span class="cm-variable">sk.<span class="cm-property">connect((<span class="cm-string">'127.0.0.1',<span class="cm-number">8080))<br /><span><span class="cm-builtin">print(<span class="cm-variable">sk.<span class="cm-property">recv(<span class="cm-number">1024))<br /><span><span class="cm-variable">msg = <span class="cm-builtin">input(<span class="cm-string">'&gt;&gt;&gt;').<span class="cm-property">encode(<span class="cm-string">'utf-8')<br /><span><span class="cm-variable">sk.<span class="cm-property">send(<span class="cm-variable">msg)<br /><span><span class="cm-variable">sk.<span class="cm-property">close()</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">7<span>_<span class="md-plain">io模型</span></span></span></h1><h2 class="md-end-block md-heading"><span class="md-plain">阻塞模型</span></h2><p class="md-end-block md-p">&nbsp;</p><h2 class="md-end-block md-heading"><span class="md-plain">非阻塞模型</span></h2><p class="md-end-block md-p">&nbsp;</p><h2 class="md-end-block md-heading"><span class="md-plain">io多路复用</span></h2><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 同步 提交一个任务之后要等待这个任务执行完毕# 异步 只管提交任务,不等待这个任务执行完毕就可以做其他事情# 阻塞 recv recvfrom accept# 非阻塞<h1 id="阻塞-线程-运行状态-–-gt-阻塞状态-–-gt-就绪"><a href="#阻塞-线程-运行状态-–-gt-阻塞状态-–-gt-就绪" class="headerlink" title="阻塞   线程   运行状态 –&gt; 阻塞状态 –&gt; 就绪"></a>阻塞   线程   运行状态 –&gt; 阻塞状态 –&gt; 就绪</h1><h1 id="非阻塞"><a href="#非阻塞" class="headerlink" title="非阻塞"></a>非阻塞</h1><h1 id="IO多路复用"><a href="#IO多路复用" class="headerlink" title="IO多路复用"></a>IO多路复用</h1><pre><code class="hljs"># select机制  Windows  linux  都是操作系统轮询每一个被监听的项,看是否有读操作# poll机制    linux          它可以监听的对象比select机制可以监听的数量多                             # 随着监听项的增多,导致效率降低# epoll机制   linux           更高级,绑定回调函数,</code></pre></div><h1 id=""><a href="#" class="headerlink" title="================================="></a>=================================</h1><h1 id="以前的都是阻塞io"><a href="#以前的都是阻塞io" class="headerlink" title="以前的都是阻塞io"></a>以前的都是阻塞io</h1><h1 id="-1"><a href="#-1" class="headerlink" title="================================="></a>=================================</h1><h1 id="非阻塞io实例"><a href="#非阻塞io实例" class="headerlink" title="非阻塞io实例"></a>非阻塞io实例</h1><h1 id="import-socket"><a href="#import-socket" class="headerlink" title="import socket"></a>import socket</h1><h1 id="sk-socket-socket"><a href="#sk-socket-socket" class="headerlink" title="sk = socket.socket()"></a>sk = socket.socket()</h1><h1 id="sk-bind-‘127-0-0-1’-9000"><a href="#sk-bind-‘127-0-0-1’-9000" class="headerlink" title="sk.bind((‘127.0.0.1’,9000))"></a>sk.bind((‘127.0.0.1’,9000))</h1><h1 id="sk-setblocking-False-设置不阻塞"><a href="#sk-setblocking-False-设置不阻塞" class="headerlink" title="sk.setblocking(False)  # 设置不阻塞"></a>sk.setblocking(False)  # 设置不阻塞</h1><h1 id="sk-listen"><a href="#sk-listen" class="headerlink" title="sk.listen()"></a>sk.listen()</h1><h1 id="conn-l"><a href="#conn-l" class="headerlink" title="conn_l = []"></a>conn_l = []</h1><h1 id="del-conn"><a href="#del-conn" class="headerlink" title="del_conn = []"></a>del_conn = []</h1><h1 id="while-True"><a href="#while-True" class="headerlink" title="while True:"></a>while True:</h1><h1 id="try"><a href="#try" class="headerlink" title="try:"></a>try:</h1><h1 id="conn-addr-sk-accept-不阻塞-但是没人连我会报错"><a href="#conn-addr-sk-accept-不阻塞-但是没人连我会报错" class="headerlink" title="conn,addr = sk.accept()  #不阻塞,但是没人连我会报错"></a>conn,addr = sk.accept()  #不阻塞,但是没人连我会报错</h1><h1 id="print-‘建立连接了-’-addr"><a href="#print-‘建立连接了-’-addr" class="headerlink" title="print(‘建立连接了:’,addr)"></a>print(‘建立连接了:’,addr)</h1><h1 id="conn-l-append-conn"><a href="#conn-l-append-conn" class="headerlink" title="conn_l.append(conn)"></a>conn_l.append(conn)</h1><h1 id="except-BlockingIOError"><a href="#except-BlockingIOError" class="headerlink" title="except BlockingIOError:"></a>except BlockingIOError:</h1><h1 id="for-con-in-conn-l"><a href="#for-con-in-conn-l" class="headerlink" title="for con in conn_l:"></a>for con in conn_l:</h1><h1 id="try-1"><a href="#try-1" class="headerlink" title="try:"></a>try:</h1><h1 id="msg-con-recv-1024-非阻塞-如果没有数据就报错"><a href="#msg-con-recv-1024-非阻塞-如果没有数据就报错" class="headerlink" title="msg = con.recv(1024)  # 非阻塞,如果没有数据就报错"></a>msg = con.recv(1024)  # 非阻塞,如果没有数据就报错</h1><h1 id="if-msg-b’’-若客户端关闭-会发送空消息"><a href="#if-msg-b’’-若客户端关闭-会发送空消息" class="headerlink" title="if msg == b’’:   # 若客户端关闭 会发送空消息"></a>if msg == b’’:   # 若客户端关闭 会发送空消息</h1><h1 id="del-conn-append-con"><a href="#del-conn-append-con" class="headerlink" title="del_conn.append(con)"></a>del_conn.append(con)</h1><h1 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h1><h1 id="print-msg"><a href="#print-msg" class="headerlink" title="print(msg)"></a>print(msg)</h1><h1 id="con-send-b’byebye’"><a href="#con-send-b’byebye’" class="headerlink" title="con.send(b’byebye’)"></a>con.send(b’byebye’)</h1><h1 id="except-BlockingIOError-pass"><a href="#except-BlockingIOError-pass" class="headerlink" title="except BlockingIOError:pass"></a>except BlockingIOError:pass</h1><h1 id="for-con-in-del-conn"><a href="#for-con-in-del-conn" class="headerlink" title="for con in del_conn:"></a>for con in del_conn:</h1><h1 id="con-close"><a href="#con-close" class="headerlink" title="con.close()"></a>con.close()</h1><h1 id="conn-l-remove-con"><a href="#conn-l-remove-con" class="headerlink" title="conn_l.remove(con)"></a>conn_l.remove(con)</h1><h1 id="del-conn-clear"><a href="#del-conn-clear" class="headerlink" title="del_conn.clear()"></a>del_conn.clear()</h1><h1 id="while-True-10000-500-501"><a href="#while-True-10000-500-501" class="headerlink" title="# while True : 10000   500  501"></a># while True : 10000   500  501</h1><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h1 id="import-time"><a href="#import-time" class="headerlink" title="import time"></a>import time</h1><h1 id="import-socket-1"><a href="#import-socket-1" class="headerlink" title="import socket"></a>import socket</h1><h1 id="import-threading"><a href="#import-threading" class="headerlink" title="import threading"></a>import threading</h1><h1 id="def-func"><a href="#def-func" class="headerlink" title="def func():"></a>def func():</h1><h1 id="sk-socket-socket-1"><a href="#sk-socket-socket-1" class="headerlink" title="sk = socket.socket()"></a>sk = socket.socket()</h1><h1 id="sk-connect-‘127-0-0-1’-9000"><a href="#sk-connect-‘127-0-0-1’-9000" class="headerlink" title="sk.connect((‘127.0.0.1’,9000))"></a>sk.connect((‘127.0.0.1’,9000))</h1><h1 id="sk-send-b’hello’"><a href="#sk-send-b’hello’" class="headerlink" title="sk.send(b’hello’)"></a>sk.send(b’hello’)</h1><h1 id="time-sleep-1"><a href="#time-sleep-1" class="headerlink" title="time.sleep(1)"></a>time.sleep(1)</h1><h1 id="print-sk-recv-1024"><a href="#print-sk-recv-1024" class="headerlink" title="print(sk.recv(1024))"></a>print(sk.recv(1024))</h1><h1 id="sk-close"><a href="#sk-close" class="headerlink" title="sk.close()"></a>sk.close()</h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><h1 id="for-i-in-range-2"><a href="#for-i-in-range-2" class="headerlink" title="for i in range(2):"></a>for i in range(2):</h1><h1 id="threading-Thread-target-func-start"><a href="#threading-Thread-target-func-start" class="headerlink" title="threading.Thread(target=func).start()"></a>threading.Thread(target=func).start()</h1><h1 id="-4"><a href="#-4" class="headerlink" title="================================="></a>=================================</h1><h1 id="io-多路复用-监听列表的循环-变为有操作系统执行"><a href="#io-多路复用-监听列表的循环-变为有操作系统执行" class="headerlink" title="io 多路复用, 监听列表的循环 变为有操作系统执行"></a>io 多路复用, 监听列表的循环 变为有操作系统执行</h1><p>import select<br>import socket</p><p>sk = socket.socket()<br>sk.bind((‘127.0.0.1’,8000))<br>sk.setblocking(False)<br>sk.listen()</p><p>read_lst = [sk] # 监听列表<br>while True:   # [sk,conn]<br>    # 等待读列表,写列表,修改列表 都必传<br>    # 返回元祖中3个列表,对应三个list,一般只用第一个<br>    # r_lst里面就是sk对象<br>    r_lst,w_lst,x_lst = select.select(read_lst,[],[])<br>    for i in r_lst:<br>        if i is sk:<br>            conn,addr = i.accept()<br>            read_lst.append(conn)<br>        else:<br>            ret = i.recv(1024)<br>            if ret == b’’:<br>                i.close()<br>                read_lst.remove(i)<br>                continue<br>            print(ret)<br>            i.send(b’goodbye!’)<br>            import time<br>            import socket<br>            import threading</p><div class="code-wrapper"><pre><code class="hljs">        def func():            sk = socket.socket()            sk.connect((&#39;127.0.0.1&#39;, 8000))            sk.send(b&#39;hello&#39;)            time.sleep(3)            print(sk.recv(1024))            sk.close()        for i in range(20):            threading.Thread(target=func).start()</code></pre></div><h1 id="-5"><a href="#-5" class="headerlink" title="================================="></a>=================================</h1><p>import selectors # 选择合适的多路复用机制<br>from socket import *</p><p>def accept(sk,mask):<br>    conn,addr=sk.accept()<br>    sel.register(conn,selectors.EVENT_READ,read)</p><p>def read(conn,mask):<br>    try:<br>        data=conn.recv(1024)<br>        if not data:<br>            print(‘closing’,conn)<br>            sel.unregister(conn)<br>            conn.close()<br>            return<br>        conn.send(data.upper()+b’_SB’)<br>    except Exception:<br>        print(‘closing’, conn)<br>        sel.unregister(conn)<br>        conn.close()</p><p>sk=socket()<br>sk.setsockopt(SOL_SOCKET,SO_REUSEADDR,1)<br>sk.bind((‘127.0.0.1’,8088))<br>sk.listen(5)<br>sk.setblocking(False) #设置socket的接口为非阻塞</p><p>sel = selectors.DefaultSelector()   # 自动选择一个适合我的IO多路复用的机制<br>sel.register(sk,selectors.EVENT_READ,accept)<br>#相当于网select的读列表里append了一个sk对象,并且绑定了一个回调函数accept</p><h1 id="说白了就是-如果有人请求连接sk-就调用accrpt方法"><a href="#说白了就是-如果有人请求连接sk-就调用accrpt方法" class="headerlink" title="说白了就是 如果有人请求连接sk,就调用accrpt方法"></a>说白了就是 如果有人请求连接sk,就调用accrpt方法</h1><p>while True:<br>    events=sel.select() #检测所有的sk,conn，是否有完成wait data阶段<br>    for sel_obj,mask in events:  # [conn]<br>        callback=sel_obj.data #callback=read<br>        callback(sel_obj.fileobj,mask) #read(conn,1)<br></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">pymysql</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import pymysql# 连接conn = pymysql.connect(    host="106.15.39.74",    port=3306,    database="test",    user="root",    password="dzf123,.",    charset="utf8" # 没有"-" 没有)cursor = conn.cursor()sql = "select*from student"name = "dzf"password = "123456"sql = "select * from student where name = %s and password = %s"ret = cursor.execute(sql,[name,password])# 自己拼接需要加引号,使用防注入sql不用加引号,参数不能少,多#print(cursor.lastrowid) # 获取刚插入数据的id 应该就是主键 自增的那个,与名字无关print(ret) # 返回受影响行数ret = cursor.fetchall() # 元祖 大元组里边小元祖print(ret,"a")ret = cursor.fetchone() # 取一条数据print(ret,"a")ret = cursor.fetchone()print(ret,"a")# 直接返回一条元素,格式是 小元祖,或只有list中的一个小字典,外边没有元祖或list# 若连续fetchone() 第一次第一条,第二次第二条,一次向下取# 若取完后 再次 fetchone() 取不到# --&gt;(('dzf','1234'),('dzf','1234'))# 在执行语句前 修改cursor格式cursor.fetchmany(3) # 在cursor位置接下取3条,大元组中小元祖# 移动光标cursor.scroll(1,mode="absolute") # 绝对移动 移到1位置,从2开始 ,cursor.scroll(1,mode="relative") # 相对移动 原来在3 位置,从4 开始读,现在 移动到4 从5开始读# 向上移可以使用负的cursor = conn.cursor(cursor=pymysql.cursors.DictCursor) # 指定为字典格式"""    [    {'id':1,'name':'dzf'},    {'id':1,'name':'dzf'},    ]"""<p>cursor.close()<br>conn.close()</p><h1 id="-6"><a href="#-6" class="headerlink" title="===================================="></a>====================================</h1><h1 id="插入数据还是用cursor-execute-注意提交后conn-commit"><a href="#插入数据还是用cursor-execute-注意提交后conn-commit" class="headerlink" title="插入数据还是用cursor.execute(),注意提交后conn.commit()"></a>插入数据还是用cursor.execute(),注意提交后conn.commit()</h1><h1 id="若多语句-可能错误-conn-rollback"><a href="#若多语句-可能错误-conn-rollback" class="headerlink" title="若多语句,可能错误,conn.rollback()"></a>若多语句,可能错误,conn.rollback()</h1><h1 id="sql2-“insert-into-student-name-password-values-s-s-”"><a href="#sql2-“insert-into-student-name-password-values-s-s-”" class="headerlink" title="sql2 = “insert into student (name,password) values(%s, %s)”"></a>sql2 = “insert into student (name,password) values(%s, %s)”</h1><h1 id="ret-cursor-execute-sql2-‘123’-’123’"><a href="#ret-cursor-execute-sql2-‘123’-’123’" class="headerlink" title="ret = cursor.execute(sql2,[‘123’,’123’])"></a>ret = cursor.execute(sql2,[‘123’,’123’])</h1><h1 id="conn-commit"><a href="#conn-commit" class="headerlink" title="conn.commit()"></a>conn.commit()</h1><h1 id="或insert-into-student-name-password-values-name-s-pwd-s"><a href="#或insert-into-student-name-password-values-name-s-pwd-s" class="headerlink" title="或insert into student (name,password) values(%(name)s, %(pwd)s)"></a>或insert into student (name,password) values(%(name)s, %(pwd)s)</h1><h1 id="下边传入字典excute-sql-“name”-xxx"><a href="#下边传入字典excute-sql-“name”-xxx" class="headerlink" title="下边传入字典excute(sql,{“name”:xxx..})"></a>下边传入字典excute(sql,{“name”:xxx..})</h1><h1 id="-7"><a href="#-7" class="headerlink" title="===================================="></a>====================================</h1><h1 id="批量执行"><a href="#批量执行" class="headerlink" title="批量执行"></a>批量执行</h1><p>data = ([‘12’,’12’],[‘23’,’32’],[‘32’,’23’]) # 格式必须固定<br>cursor.executemany(sql,data)  # 内部的for循环</p><h1 id="try-防止异常-要回滚-会取消以前正确的插入语句"><a href="#try-防止异常-要回滚-会取消以前正确的插入语句" class="headerlink" title="try 防止异常,要回滚, 会取消以前正确的插入语句"></a>try 防止异常,要回滚, 会取消以前正确的插入语句</h1><h1 id="-8"><a href="#-8" class="headerlink" title="================================="></a>=================================</h1><h1 id="删除-同理-也要提交"><a href="#删除-同理-也要提交" class="headerlink" title="删除,同理,也要提交"></a>删除,同理,也要提交</h1><h1 id="-9"><a href="#-9" class="headerlink" title="================================"></a>================================</h1><h1 id="修改-记得提交"><a href="#修改-记得提交" class="headerlink" title="修改 记得提交"></a>修改 记得提交</h1><p></pre></div></p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/01/16/cnblog/python%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">Python</span></h1><h1 class="md-end-block md-heading"><span class="md-plain">概述</span></h1><h2 class="md-end-block md-heading"><span class="md-plain">简介</span></h2><ol class="ol-list" start=""><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">python是一<span><strong><span><em>种解释性,面向对象,动态数据类型</em></span></strong><span class="md-plain">的高级程序语言,</span></span></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span><strong>解释型,无编译过程,逐行解释为二进制</strong></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">交互性,直接执行程序</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">应用广泛,</span></p></li><li class="md-list-item md-focus-container"><p class="md-end-block md-p md-focus"><span class="md-plain">编译型:<span class="md-expand"><strong><span><em>一次将所有编译为二进制</em></span></strong></span></span></p></li></ol><h2 class="md-end-block md-heading"><span class="md-plain">特点</span></h2><ol class="ol-list" start=""><li class="md-list-item"><p class="md-end-block md-p"><span><strong>易于学习</strong></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">易于维护</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">易于阅读</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">广泛的标准库</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">互动模式</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">可移植</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">可扩展:兼容c语言,可调用</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">数据库</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">GUI编程</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">可嵌入,c调python</span></p></li></ol><h2 class="md-end-block md-heading"><span class="md-plain">缺点</span></h2><ol class="ol-list" start=""><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">运行慢:代码一行一行翻译成CPU理解的机器码运行,即一行一行运行,很慢;</span></p><p class="md-end-block md-p"><span class="md-plain">而C语言直接翻译后成执行的机器码,很快</span></p><h3 class="md-end-block md-heading"><span class="md-plain">编程任务:</span></h3><h3 class="md-end-block md-heading"><span class="md-plain">io型:复制,打开网页,<span><em>所以说虽然速度慢,依然使用它</em></span></span></h3><h3 class="md-end-block md-heading"><span class="md-plain">计算型:数据计算,用c 快</span></h3></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">代码不能加密:只能发布源代码,不能编译</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">没有多线程 </span></p></li></ol><h1 class="md-end-block md-heading">&nbsp;</h1><h2 class="md-end-block md-heading"><span class="md-plain">Python分类</span></h2><h5 class="md-end-block md-heading"><span class="md-plain">推荐<span>cpython, py-&gt;c语言的字节码-&gt;0000010101</span></span></h5><p class="md-end-block md-p"><span class="md-plain">jypython, py-&gt;java的字节码</span></p><p class="md-end-block md-p"><span class="md-plain">ironpython,</span></p><p class="md-end-block md-p"><span class="md-plain">其他语言的python</span></p><p class="md-end-block md-p"><span class="md-plain">pypy, 一次性编译为py的字节码,速度快,开发效率相对低--&gt;0101</span></p><p class="md-end-block md-p"><span class="md-plain">这只是python解释器的分类,python语法规范相同</span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment">#-*- encoding:utf-8 -*-<br /><span><span class="cm-comment"># coding=utf-8 都可以<br /><span><span class="cm-builtin">print(<span class="cm-string">"123")<br /><span><span class="cm-comment">#python2不支持中文默认是ascii</span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">variable</span></h1><p class="md-end-block md-p"><span class="md-plain">字母数字下划线,空格不行,中文可以(但不要这样) 同java</span></p><p class="md-end-block md-p"><span class="md-plain">a=12</span></p><p class="md-end-block md-p"><span class="md-plain">b=a</span></p><p class="md-end-block md-p"><span class="md-plain">c=b</span></p><p class="md-end-block md-p"><span class="md-plain">b=100</span></p><p class="md-end-block md-p"><span class="md-plain">print(a,b,c)-&gt;12,100,12</span></p><p class="md-end-block md-p"><span class="md-plain">因为逐行执行</span></p><h3 class="md-end-block md-heading"><span class="md-plain">注释</span></h3><p class="md-end-block md-p"><span class="md-plain">单行注释:# 读,但不运行</span></p><p class="md-end-block md-p"><span class="md-plain">多行注释:'''xxxx''' 或"""xxxx"""</span></p><h4 class="md-end-block md-heading"><span class="md-plain">数据交互,input</span></h4><p class="md-end-block md-p"><span class="md-plain">name=input("xxxx")</span></p><p class="md-end-block md-p"><span class="md-plain">type(name)-&gt;str 全是字符串</span></p><h4 class="md-end-block md-heading"><span class="md-plain">数据类型</span></h4><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">数字 type(100) -&gt;&lt;class 'int'&gt;</span></p><p class="md-end-block md-p"><span class="md-plain">int </span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">范围根据电脑变化 -2^31~2^31-1 32位</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">64位 31 换63即可</span></p><p class="md-end-block md-p"><span class="md-plain">long 长整型</span></p><p class="md-end-block md-p"><span class="md-plain">python3中没有全是int</span></p><p class="md-end-block md-p"><span class="md-plain">python2中有</span></p></li></ul></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain"> 字符串str:单引双引</span></p></li></ul><p class="md-end-block md-p"><span class="md-plain">可相加,可相乘 与数字</span></p><p class="md-end-block md-p"><span class="md-plain">"中国"*8</span></p><p class="md-end-block md-p"><span class="md-plain">msg=''' </span></p><p class="md-end-block md-p"><span class="md-plain">xxx</span></p><p class="md-end-block md-p"><span class="md-plain">yyy</span></p><p class="md-end-block md-p"><span class="md-plain">zzz</span></p><p class="md-end-block md-p"><span class="md-plain">'''也可三个双引号</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">bool 布尔值:首字母大写</span></p><p class="md-end-block md-p"><span class="md-plain">此时不是注释,里面格式不变</span></p><p class="md-end-block md-p"><span><strong>与字符串转换</strong></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">空串为false</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">否则为true</span></span></p><p class="md-end-block md-p"><span class="md-plain">与list,元祖,只要是空都是False</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">list:类型可不一致,储存大量数据</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">元组(只读列表):(1,2,3,"xxx")可存任何数据</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">字典dict:键值对 {"name":"Dean","age":21}也可大量数据,不限类型</span></p><p class="md-end-block md-p"><span class="md-plain">如列表中有列表时可用lis<span>[<span class="md-plain">x][y]取出</span></span></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">集合:{1,2,3,"xxx"} 可求交集,差集</span></p></li></ul><h3 class="md-end-block md-heading"><span class="md-plain">条件语句</span></h3><p class="md-end-block md-p"><span class="md-plain"> if 条件:</span></p><p class="md-end-block md-p"><span class="md-plain">4空格或tab 但不要混用</span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-keyword">if <span class="cm-keyword">True:<br /><span><span class="cm-tab">    <span class="cm-builtin">print(<span class="cm-number">1)<br /><span><span class="cm-tab">    <span class="cm-builtin">print(<span class="cm-number">2)<br /><span><span class="cm-comment">#都打印<br /><span><span class="cm-keyword">if <span class="cm-keyword">True:<br /><span> &nbsp; &nbsp;<span class="cm-variable">xxx<br /><span><span class="cm-keyword">else:<br /><span> &nbsp; &nbsp;<span class="cm-variable">yyy<br /><span><span class="cm-keyword">if <span class="cm-variable">a :<br /><span> &nbsp; &nbsp;<br /><span><span class="cm-keyword">elif <span class="cm-variable">b :<br /><span><span>​<br /><span><span class="cm-keyword">elif <span class="cm-variable">c:<br /><span> &nbsp; &nbsp;<br /><span><span class="cm-keyword">else:</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p class="md-end-block md-p"><span class="md-plain">while</span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment">#break continue 照样适用<br /><span><span class="cm-keyword">while <span class="cm-keyword">True:<br /><span><span class="cm-tab">    <span class="cm-builtin">print()<br /></span></span></span></span></span></span></span></span></pre></div><p class="md-end-block md-p"><span class="md-plain">while .... else</span></p><p class="md-end-block md-p"><span><strong>正常执行完毕会执行else</strong></span></p><p class="md-end-block md-p"><span><strong>被break打断不会执行else</strong></span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-variable">count = <span class="cm-number">0<br /><span><span class="cm-keyword">while <span class="cm-variable">count <span class="cm-operator">&lt; <span class="cm-number">5:<br /><span> &nbsp; &nbsp;<span class="cm-variable">count += <span class="cm-number">1<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">count)<br /><span> &nbsp; &nbsp;<span class="cm-keyword">break<br /><span><span class="cm-keyword">else:<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-string">"while-&gt;else")</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h4 class="md-end-block md-heading"><span class="md-plain">for循环</span></h4><p class="md-end-block md-p"><span class="md-plain">s=字符串,列表等可迭代元素</span></p><p class="md-end-block md-p"><span class="md-plain">for i in s:</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">print(i)</span></span></p><p class="md-end-block md-p"><span class="md-plain">if "xxx" in s:</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">pass</span></span></p><p class="md-end-block md-p"><span class="md-plain">not in</span></p><h4 class="md-end-block md-heading"><span class="md-plain">字符串与数字转换</span></h4><p class="md-end-block md-p"><span class="md-plain">str='1'</span></p><p class="md-end-block md-p"><span class="md-plain">b=int(str) b变为int</span></p><p class="md-end-block md-p"><span class="md-plain">str(int) 数字转换为字符串</span></p><p class="md-end-block md-p">&nbsp;</p><h4 class="md-end-block md-heading"><span class="md-plain">格式化输出</span></h4><p class="md-end-block md-p"><span><strong>转义字符是"%"</strong><span class="md-plain"> %%表示正常输出%</span></span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment">#格式化输出<br /><span><span class="cm-comment">#% s d<br /><span><span class="cm-variable">name = <span class="cm-builtin">input(<span class="cm-string">"input your name:")<br /><span><span class="cm-variable">age = <span class="cm-builtin">input(<span class="cm-string">"input your age:")<br /><span><span class="cm-variable">height = <span class="cm-builtin">input(<span class="cm-string">"input your height:")<br /><span><span class="cm-variable">msg = <span class="cm-string">"My name is %s, I'm %s years old,%scm tall" <span class="cm-operator">% (<span class="cm-variable">name, <span class="cm-variable">age, <span class="cm-variable">height)<br /><span><span class="cm-variable">msg2 = <span class="cm-string">'''-----------------------------<br /><span><span class="cm-string">name:%s<br /><span><span class="cm-string">age:%s<br /><span><span class="cm-string">height:%s<br /><span><span class="cm-string">-----------------------------<br /><span><span class="cm-string">''' <span class="cm-operator">% (<span class="cm-variable">name, <span class="cm-variable">age, <span class="cm-variable">height)<br /><span><span class="cm-builtin">print(<span class="cm-variable">msg)<br /><span><span class="cm-builtin">print(<span class="cm-variable">msg2)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h4 class="md-end-block md-heading"><span class="md-plain">编码</span></h4><p class="md-end-block md-p"><span class="md-plain">ascii 初期 包含字符少只有7位 预留了第一位全为0</span></p><p class="md-end-block md-p"><span class="md-plain">unicode</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">最开始</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">1字节表示所有英文,数字,特殊符号</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">2字节表示中文 ,不够,</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span><strong>后来全部使用32位表示</strong><span class="md-plain">英文与中文都是</span></span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">升级-&gt;utf-8(一个字符最少8位) utf16 同理</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">中文3字节</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">英文1字节</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">欧洲文字2字节</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">gbk 中文2字节</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">英文1个字节</span></span></p><p class="md-end-block md-p"><span><strong><span class="md-plain">文件的<span><em><span class="md-plain">储存与传输</span></em><span class="md-plain">不能是unicode</span></span></span></strong><span class="md-plain">,只能是其他的几种</span></span></p><p class="md-end-block md-p"><span class="md-plain">py3:str在内存中是使用unicode编码的,所以文件存取要转换</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">bytes类型 编码方式 ascii,utf-8,gbk等</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">所以str直接存储到文件传输,不可以</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">英文</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">str:表现方式 s="dzf&ldquo;</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">编码方式 unicode 00001000 ...</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">bytes 表现方式 s=b"dzf"</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">编码 gbk 01000001...</span></span></p><p class="md-end-block md-p"><span class="md-plain">中文</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">str同上</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">bytes表现方式=b"\xe1\xd5\xa5" 3个字节表示</span></span></p><p class="md-end-block md-p"><span class="md-plain">s="dzf".encode("utf-8") 为bytes类型 (将dzf转为bytes类型,utf-8编码方式)</span></p><p class="md-end-block md-p"><span class="md-plain">s="Dean".encode("utf-8")-&gt;b'\xe6\xae\xb5\xe5\xbf\x97\xe6\x96\xb9'</span></p><h4 class="md-end-block md-heading"><span class="md-plain">运算符</span></h4><p class="md-end-block md-p"><span class="md-plain">+,-,**,/ ,//</span></p><h4 class="md-end-block md-heading"><span class="md-plain">逻辑运算符(数字比较时想象为true,false即可)</span></h4><p class="md-end-block md-p"><span class="md-plain">注意没有"||" "&amp;&amp;"</span></p><p class="md-end-block md-p"><span class="md-plain">&amp;表示位运算符 当数字&amp;时 <span><strong>与and不同</strong><span class="md-plain"> 表示的是二进制相与</span></span></span></p><p class="md-end-block md-p"><span class="md-plain">()&gt;not &gt;and &gt;or</span></p><p class="md-end-block md-p"><span class="md-plain">x or y </span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">x为非零(真) 结果为x</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">x为零(假) 结果为 y</span></span></p><h5 class="md-end-block md-heading"><span class="md-plain">数字与bool<span>可直接比较</span></span></h5><p class="md-end-block md-p"><span class="md-plain">x and y</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">x不为0 返回y</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">x为0 返回 x</span></span></p><p class="md-end-block md-p"><span class="md-plain">int(True)=1</span></p><p class="md-end-block md-p"><span class="md-plain">bool(1)=True</span></p><h4 class="md-end-block md-heading"><span class="md-plain">字符串常用操作方法</span></h4><h5 class="md-end-block md-heading"><span class="md-plain">字符串切片</span></h5><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[n]获取索引n的字符</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">获取一段s[m:n]字符串切片,顾头不顾尾</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[-1]从后向前</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[-2:-5] 从后向前</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[0:-1]不包含最后一个</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[:]=s[0:]全部</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[n:n]空</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[0:10:2]0到10内每隔2个取一个</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">s[4:0:-2]倒着取,没2个取一个</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">注意不能s[4:0]</span></span></p><p class="md-end-block md-p"><span class="md-plain">str.capitalize() 首字母大写 数字无影响</span></p><p class="md-end-block md-p"><span class="md-plain">upper() 全部大写</span></p><p class="md-end-block md-p"><span class="md-plain">lower()全部小写</span></p><p class="md-end-block md-p"><span class="md-plain">swapcase()大小写反转</span></p><p class="md-end-block md-p"><span class="md-plain">title() "dzf非英文zbcd"-&gt;"Dzf非英文Zbcd"</span></p><p class="md-end-block md-p"><span class="md-plain">center(n,"#")设置字符串长度为n,两边#填充 居中显示</span></p><p class="md-end-block md-p"><span class="md-plain">expandtabs() 补全空格</span></p><p class="md-end-block md-p"><span class="md-plain">startswith("xxx")是否已xxx开头</span></p><p class="md-end-block md-p"><span class="md-plain">startswith("e",2,5)2到5组成的字符串是否已e开头</span></p><p class="md-end-block md-p"><span class="md-plain">find("x")返回第一个x下标 找不到返回-1</span></p><p class="md-end-block md-p"><span class="md-plain">index() 与find功能相同,但找不到会报错</span></p><p class="md-end-block md-p"><span class="md-plain">strip()去掉前后空格,也可以去掉换行符中间的不处理</span></p><p class="md-end-block md-p"><span class="md-plain">strip("%#@"):包含空格不管前后只要有其中的某个,即删除</span></p><p class="md-end-block md-p"><span class="md-plain">lstrip,rstrip 同理</span></p><p class="md-end-block md-p"><span class="md-plain">count("z",1,56)返回1-56中z出现的次数</span></p><p class="md-end-block md-p"><span class="md-plain">spilt()分割 返回列表 <span><strong>空已包含</strong></span></span></p><p class="md-end-block md-p"><span class="md-plain">format 格式化输出</span></p><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-variable">s=<span class="cm-string">"你是{},今年{},爱好{},我是{}".<span class="cm-property">format(<span class="cm-string">"xxx",<span class="cm-number">21,<span class="cm-string">"yy",<span class="cm-string">"xxx")<br /><span><span class="cm-variable">s=<span class="cm-string">"你是{0},今年{1},爱好{2},我是{0}".<span class="cm-property">format(<span class="cm-string">"xxx",<span class="cm-number">21,<span class="cm-string">"yy")<br /><span><span class="cm-variable">s=<span class="cm-string">"你是{name},今年{age},爱好{like},我是{name}".<span class="cm-property">format(<span class="cm-variable">name=<span class="cm-string">"xxx",<span class="cm-variable">age=<span class="cm-number">21,<span class="cm-variable">like=<span class="cm-string">"yy")</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p class="md-end-block md-p"><span class="md-plain">replace("old","new",count) old-&gt;new 替换count次</span></p><p class="md-end-block md-p"><span class="md-plain">isdight() 全部是数字</span></p><p class="md-end-block md-p"><span class="md-plain">isalpha()全部是字母</span></p><p class="md-end-block md-p"><span class="md-plain">isalnum()全部是数字,字母</span></p><h5 class="md-end-block md-heading"><span class="md-plain">公共方法</span></h5><p class="md-end-block md-p"><span class="md-plain">len(str) 返回<span><strong>字符</strong><span class="md-plain">个数,英文,中文都表示个字符</span></span></span></p><h1 class="md-end-block md-heading"><span class="md-plain">int</span></h1><p class="md-end-block md-p"><span class="md-plain">bit_length() 转换为2进制最少的位数</span></p><h4 class="md-end-block md-heading"><span class="md-plain">列表（有序）32位5亿多个</span></h4><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">排序<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.sort(),最快排序<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.sort(reverse=True)倒序<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.reverse()翻转<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">增删改查<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">增<span class="md-tab"> <span class="md-plain">list.append(object)增加到最后 无返回值<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.insert(3,object)指定位置插入<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.extend("DZF")最后插入（可迭代的对象：字符串。列表等）<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">-&gt;['D','Z','F']<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">删<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.pop(1) 指定删除 有返回值：值<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">默认删最后一个<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.remove（"xx"）无返回值<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list.clear()清空<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">del list 删除列表<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">del list[0:2] 切片删除<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">改<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list[0]=[1,2,3]<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list[0]="dzf"<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">list[0:2]="xxxx"切片插入都是按照迭代插入即x,x,x,x<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">查<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">for i in list:<span class="md-softbreak"> <span class="md-plain">​<span class="md-tab"> <span class="md-plain">li[0:2]</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><h4 class="md-end-block md-heading"><span class="md-plain">列表的循环</span></h4><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span>列表的嵌套:list = ["dzf","工藤新一",[1,2,3],]</span></pre></div><p class="md-end-block md-p">&nbsp;</p><h4 class="md-end-block md-heading"><span class="md-plain">元祖,只读列表,可循环查询,可切片</span></h4><p class="md-end-block md-p"><span class="md-plain">儿子不能改,孙子可能可以改</span></p><p class="md-end-block md-p"><span class="md-plain">zu=(1,2,3,4,[1,2,3,4])</span></p><p class="md-end-block md-p"><span class="md-plain">zu不能改,但里边的列表可以改</span></p><h5 class="md-end-block md-heading"><span class="md-plain">a.join(可迭代元素x) 返回的是x中的每一个用a隔开:返回连接后字符串,列表的话就是拼接后返回</span></h5><p class="md-end-block md-p"><span class="md-plain">range 顾头不顾尾</span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">for i in range(0,100):</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">for i in range(0,100,2)步长2</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">for i in range(10,0,-1)倒序</span></span></p><h4 class="md-end-block md-heading"><span class="md-plain">字典dict</span></h4><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">数据类型:</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">可变数据类型:list,dict ,set 不可哈希</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">不可变数据类型:元祖,bool,int,str 可哈希</span></span></p><p class="md-end-block md-p"><span class="md-plain">dict key 必须为不可变数据类型</span></p><p class="md-end-block md-p"><span class="md-plain">dict value 任意类型</span></p><p class="md-end-block md-p"><span class="md-plain">二分查找,存储关系型数据,好像无序,版本有关</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">增:dict["newKey"]=xxxx</span></span></p></li></ul><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.setdefault("xxx")添加"xxx":None</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.setdefault("xxx","yyy") 若存在xxx的话不做操作</span></span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">改:dict["oldKey"]=xxxx</span></span></p><p class="md-end-block md-p"><span class="md-plain">dict1.update(dict2) dict1的所有添加到dict2 有覆盖,无添加</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">删:</span></span></p></li></ul><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.pop("key") 返回value</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.pop("不存在键")报错</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.pop("不存在键",XXX)不报错,若有删除,若无,返回xxx</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.popitem():3.6以上默认删除最后一个,3.5版本是随机删除(好像是)</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">返回的是元祖形势的("key","value")</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">del dict["key"] #无返回值</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">del dict["不存在键"]#错误</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">del dict #delete the dict 打印报错</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.clear() clear 打印不报错</span></span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">查</span></p><p class="md-end-block md-p"><span class="md-plain">dict.keys() 返回的是&lt;class 'dict_keys'&gt; 当做list就行 key列表,list(dict.keys())转换</span></p><p class="md-end-block md-p"><span class="md-plain">dict.values() 同上</span></p><p class="md-end-block md-p"><span class="md-plain">dict.items()同上 items列表 item是一个key-value元祖</span></p><p class="md-end-block md-p"><span class="md-plain">dict可循环默认为key </span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">i in dict ==dict.keys()</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">dict.items() -&gt;每个元祖(key,value) 不美观</span></span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-variable">a,<span class="cm-variable">b=<span class="cm-number">1,<span class="cm-number">2<br /><span><span class="cm-variable">a,<span class="cm-variable">b=[<span class="cm-number">1,<span class="cm-number">2]<br /><span><span class="cm-variable">a,<span class="cm-variable">b分别为1和2<br /><span><span class="cm-variable">a,<span class="cm-variable">b=[<span class="cm-number">1,<span class="cm-number">2],[<span class="cm-number">1,<span class="cm-number">2]:<span class="cm-variable">分别为2个list<br /><span><span class="cm-comment">#一行交换,python专有<br /><span><span class="cm-variable">a,<span class="cm-variable">b=<span class="cm-variable">b,<span class="cm-variable">a<br /><span><span class="cm-keyword">for <span class="cm-variable">k,<span class="cm-variable">v <span class="cm-keyword">in <span class="cm-builtin">dict.<span class="cm-property">items():<br /><span> &nbsp; &nbsp;<span class="cm-builtin">print(<span class="cm-variable">k,<span class="cm-variable">y)<br /><span><span>​</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p class="md-end-block md-p"><span class="md-plain">dict[key]=value key不存在会报错</span></p><p class="md-end-block md-p"><span class="md-plain">dict.get(key,xxx)=value 不存在=None或自定义值</span></p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">循环</span></h1><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">for i in str 循环中改变str实际次数不变</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">in list 等可变类型 会发生改变</span></span></p><p class="md-end-block md-p"><span class="md-tab"> <span class="md-plain">列表循环时可以删除</span></span></p><h4 class="md-end-block md-heading"><span class="md-plain">dict不可以</span></h4><h4 class="md-end-block md-heading"><span class="md-plain">进阶</span></h4><p class="md-end-block md-p"><span class="md-plain">"=" 赋值运算,传递内存</span></p><p class="md-end-block md-p"><span class="md-plain">== 比较是否相等</span></p><p class="md-end-block md-p"><span class="md-plain">is 比较内存</span></p><p class="md-end-block md-p"><span class="md-plain">id(obj) 对象的内存</span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">i=6j=6id(i)=id(j)#若为300 则不相等与java类似 #数字,字符串小数据池,其他没有小数据池#数字范围 -5到256#字符串范围:不知道确切范围,规律:    #(不含有特殊字符 则id相同,否则就不同)    #str*20 相同 str*21 不同</pre></div><p class="md-end-block md-p"><span><strong>元祖中只有一个元素t=([1]) 此时t是list类型</strong></span></p><p class="md-end-block md-p"><span class="md-tab"> <span><strong>t2=([1],) 此时是元祖类型</strong></span></span></p></li></ul><h1 class="md-end-block md-heading"><span class="md-plain">集合及深浅copy</span></h1><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">可变的数据类型</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">里边的元素必须不可变</span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span><strong>无序</strong></span></p></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">不重复</span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">set1=set({1,2,3})set2={1,2,3,4,5,6}#addset1.add("dzf")set.update("abc")-&gt;{1,2,3,"a","b","c"}#deleteset1.pop() 随机删除,并返回删除的元素set1.remove("xxxx")按元素删除,若不存在报错set1.clear() -&gt;set()空集合del set1 删除整个集合#update因为是不可变数据类型,切无序,不能更改#selectfor i in set1:    pass#顺序变化#可以求#交set1 &amp; set2set1.intersection(set2)#反交集set1 ^ set2set1.symmetric_difference(set2)#并set1 | set2set1.union(set2)#差set1独有的set1-set2#子集set1&gt;set2 #当set2是set1子集时返回True 1是2的超集set1&lt;set2 #1是2的子集#set1 = set(list) #转换list为set 去重#s =frozenset(set2) #转化为不可变数据类型,此时s不能更改</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">文件操作</span></h1><p class="md-end-block md-p"><span class="md-plain">root,dirs,files = os.walk(path)</span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># file option"""1,path2,charset3,privileges"""# mode = "r" encoding="utf8" utf8是文件建立时的编码方式# mode = "rb" 不用指定,以文件建立时的方式打开,用以非文字文件# mode = "w" encoding="utf8" wirte only# mode = "wb" 直接写入byte类型 不用编码方式,f.write("xxxx".encode("utf8"))# mode = "a" encoding = "utf8" 追加方式# mode = "ab"  追加方式f.write("xxxx".encode("utf8"))# mode = "r+"  可读可写(等于追加) 读写是由mode决定光标位置,从光标处开始操作# mode = "r+b"# mode = "w+" 先清除后再写,并无意义# mode = "a+" 写 读# f.seek(0)光标跳转# 形成文件句柄ff = open("D:/desktop/云空间/profile", mode="r+", encoding="utf8")<h1 id="content-f-read"><a href="#content-f-read" class="headerlink" title="content = f.read()"></a>content = f.read()</h1><h1 id="content-type-是str类型-自动把utf8转换为unicode-由read-实现"><a href="#content-type-是str类型-自动把utf8转换为unicode-由read-实现" class="headerlink" title="content type 是str类型 自动把utf8转换为unicode 由read()实现"></a>content type 是str类型 自动把utf8转换为unicode 由read()实现</h1><h1 id="print-content"><a href="#print-content" class="headerlink" title="print(content)"></a>print(content)</h1><h1 id="f-close"><a href="#f-close" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="if-not-exist-will-create-it-if-exist-will-overread-it"><a href="#if-not-exist-will-create-it-if-exist-will-overread-it" class="headerlink" title="if not exist, will create it,if exist will overread it"></a>if not exist, will create it,if exist will overread it</h1><h1 id="f-open-“log”-mode-”w”-encoding-”utf8”"><a href="#f-open-“log”-mode-”w”-encoding-”utf8”" class="headerlink" title="f = open(“log”, mode=”w”, encoding=”utf8”)"></a>f = open(“log”, mode=”w”, encoding=”utf8”)</h1><h1 id="f-write-“dzfDean”"><a href="#f-write-“dzfDean”" class="headerlink" title="f.write(“dzfDean”)"></a>f.write(“dzfDean”)</h1><h1 id="f-read-3-读取3个字符-一个汉字或一个英文-read读的都是-字符"><a href="#f-read-3-读取3个字符-一个汉字或一个英文-read读的都是-字符" class="headerlink" title="f.read(3) 读取3个字符,一个汉字或一个英文 read读的都是##字符##"></a>f.read(3) 读取3个字符,一个汉字或一个英文 read读的都是##字符##</h1><h1 id="f-seek-3-从第4个开始-按-字节-算-若正好位于中文-会报错"><a href="#f-seek-3-从第4个开始-按-字节-算-若正好位于中文-会报错" class="headerlink" title="f.seek(3) 从第4个开始 按##字节##算,若正好位于中文,会报错"></a>f.seek(3) 从第4个开始 按##字节##算,若正好位于中文,会报错</h1><h1 id="f-tell-获取光标位置"><a href="#f-tell-获取光标位置" class="headerlink" title="f.tell() 获取光标位置"></a>f.tell() 获取光标位置</h1><h1 id="f-readable-是否可读"><a href="#f-readable-是否可读" class="headerlink" title="f.readable() 是否可读"></a>f.readable() 是否可读</h1><h1 id="line-f-readline-读一行-与java类似"><a href="#line-f-readline-读一行-与java类似" class="headerlink" title="line = f.readline() # 读一行,与java类似"></a>line = f.readline() # 读一行,与java类似</h1><h1 id="line-f-readlines-以每行为单位-形成列表"><a href="#line-f-readlines-以每行为单位-形成列表" class="headerlink" title="line = f.readlines() # 以每行为单位 形成列表"></a>line = f.readlines() # 以每行为单位 形成列表</h1><h1 id="f-truncate-5-从光标开始截取原文件的5位-abcdef-不确定"><a href="#f-truncate-5-从光标开始截取原文件的5位-abcdef-不确定" class="headerlink" title="f.truncate(5) 从光标开始截取原文件的5位 abcdef(不确定)"></a>f.truncate(5) 从光标开始截取原文件的5位 abcdef(不确定)</h1><h1 id="for-i-in-f-print-i-也可读"><a href="#for-i-in-f-print-i-也可读" class="headerlink" title="for i in f:print(i) 也可读"></a>for i in f:print(i) 也可读</h1><h1 id="f-close-1"><a href="#f-close-1" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="自动关闭-可同时打开多个-推荐使用"><a href="#自动关闭-可同时打开多个-推荐使用" class="headerlink" title="自动关闭,可同时打开多个,推荐使用"></a>自动关闭,可同时打开多个,推荐使用</h1><h1 id="with-open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj"><a href="#with-open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj" class="headerlink" title="with open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj:"></a>with open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj:</h1><h1 id="print-obj-read"><a href="#print-obj-read" class="headerlink" title="print(obj.read())"></a>print(obj.read())</h1><h1 id="with-open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj-1"><a href="#with-open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj-1" class="headerlink" title="with open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj,\"></a>with open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj,\</h1><h1 id="open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj2"><a href="#open-“D-desktop-云空间-profile”-mode-”r-”-encoding-”utf8”-as-obj2" class="headerlink" title="open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj2:"></a>open(“D:/desktop/云空间/profile”, mode=”r+”, encoding=”utf8”) as obj2:</h1><h1 id="print-obj-read-1"><a href="#print-obj-read-1" class="headerlink" title="print(obj.read())"></a>print(obj.read())</h1><h1 id="strip-可以去掉空格或换行符"><a href="#strip-可以去掉空格或换行符" class="headerlink" title="strip() 可以去掉空格或换行符"></a>strip() 可以去掉空格或换行符</h1><h1 id="修改文件-文件是不能修改的-只能复制后-删除原来"><a href="#修改文件-文件是不能修改的-只能复制后-删除原来" class="headerlink" title="修改文件,文件是不能修改的,只能复制后,删除原来"></a>修改文件,文件是不能修改的,只能复制后,删除原来</h1><h1 id="delete-file-rename-file"><a href="#delete-file-rename-file" class="headerlink" title="delete file rename file"></a>delete file rename file</h1><p>import os<br>os.remove(“path”)<br>os.rename(“old”,”new”)<br></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">初始函数</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 函数调用时必须已经存在# def my_len(s):#     i = 0#     for k in s:#         i += 1#     return None### print(my_len('Dean'))### def my_len():#     s="as"#     i = 0#     for k in s:#         i += 1#     return i<p>“””<br>先定义,后调用<br>返回值情况,<br>1,无返回值,如输出就是None<br>    不用写,<br>    只写return (它是结束代码),<br>    return None,不常用<br>2,一个值<br>    int,str,list,dict等<br>3,多个返回值<br>    return 1,2<br>    多个返回值用多个变量接受,不能多,也不能少<br>    但可以用一个变量接受,按元祖返回<br>4,解释中输入1,2,3–&gt;(1,2,3)<br>    a,b,c=[1,2,3]   可得a=1,b=2,c=3<br>“””</p><h1 id="def-func1-a-b-1"><a href="#def-func1-a-b-1" class="headerlink" title="def func1(a, b = 1):"></a>def func1(a, b = 1):</h1><h1 id="pass"><a href="#pass" class="headerlink" title="pass"></a>pass</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h1 id="func1-1-2-3"><a href="#func1-1-2-3" class="headerlink" title="func1((1,2,3))"></a>func1((1,2,3))</h1><p>“””<br>参数<br>    若多个函数同名,距离调用最近的生效<br>    若无参数,强制传参报错<br>    若有参,不传不报错<br>1,无参<br>2,一个参数<br>3,多个参数def my(a,b): 按顺序传递<br>    也可以 my(b=2,a=1)不报错<br>    可以混用my(1,b=1),先按照位置传,再使用关键字<br>    但my(1,b=1),my(a=1,1)报错,同一变量只能一个值<br>型参<br>    位置参数:按照位置传递,必须传<br>    默认参数:def my(a,b = 2) 不传及默认,因此默认参数只能在后边,先位置参数<br>    动态参数:def my(*args) 函数中当做元祖,print()<br>            my(1,2,3,4…..)<br>    先位置参数,再动态参数(只接受位置传参的),再默认参数,最后**kwargs<br>    动态参数2:def my(**kwargs):<br>    传入dict my(a=1,b=2,c=3)—&gt;{“a”:1,”b”:2,”c”:3}</p><pre><code class="hljs">def my(*args,**kwargs) **args 在前,,,必须先位置参数,再关键字</code></pre></div><p>动态参数另一种传参方式<br>    列表或元祖当做位置参数传入<br>    def my(*args):<br>    list=(1,2,3)<br>    my(*list) 表示按次序传给</p><div class="code-wrapper"><pre><code class="hljs">def my(**kwargs):dict=&#123;&quot;A&quot;:1,&quot;B&quot;:2&#125;my(**dict) 表示按次序传给个人感觉这种就是只传一个参数</code></pre></div><p>函数注释<br>“””</p><h1 id="def-my-arg"><a href="#def-my-arg" class="headerlink" title="def my(arg):"></a>def my(arg):</h1><h1 id="“””"><a href="#“””" class="headerlink" title="“””"></a>“””</h1><h1 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h1><h1 id="param-arg"><a href="#param-arg" class="headerlink" title=":param arg:"></a>:param arg:</h1><h1 id="return"><a href="#return" class="headerlink" title=":return:"></a>:return:</h1><h1 id="“””-1"><a href="#“””-1" class="headerlink" title="“””"></a>“””</h1><h1 id="print-arg"><a href="#print-arg" class="headerlink" title="print(arg)"></a>print(arg)</h1><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1><h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><h1 id="my-1-2-3"><a href="#my-1-2-3" class="headerlink" title="my([1,2,3])"></a>my([1,2,3])</h1><p>user_list = [<br>    {‘username’:’barry’,’password’:’1234’},<br>    {‘username’:’alex’,’password’:’asdf’},<br>             ]<br>board = [‘张三’,’李小四’,’王二麻子’]<br>while 1:<br>    username = input(‘用户名：’)<br>    if username.upper() == ‘Q’:break<br>    password = input(‘密码：’)<br>    for i in board:<br>        if i in username:<br>            username = username.replace(i,’*’*len(i))<br>    user_list.append({‘username’:username,’password’:password})<br>    print({‘username’:username,’password’:password})<br>    print(user_list)</p><h1 id="陷阱"><a href="#陷阱" class="headerlink" title="陷阱"></a>陷阱</h1><h1 id="若默认参数是可变数据类型-调用时-若不传递数据-公用一个资源-字典也类似"><a href="#若默认参数是可变数据类型-调用时-若不传递数据-公用一个资源-字典也类似" class="headerlink" title="若默认参数是可变数据类型,调用时,若不传递数据,公用一个资源,字典也类似"></a>若默认参数是可变数据类型,调用时,若不传递数据,公用一个资源,字典也类似</h1><p>def f(a=[]):<br>    a.append(1)</p><p>f()  # [1]<br>f()  # [1,1]<br>f([])  # [1]<br>f()  # [1,1]</p><p>def f(k,a={}):<br>    a[k] = “v”</p><p>f(1)  # {1:”v”}<br>f(2)  # {1:”v”,2:”v”}<br>f(3)  # {1:”v”,2:”v”,3:”v”}<br></pre></p></li></ul><h1 class="md-end-block md-heading"><span class="md-plain">函数进阶</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 内置命名空间--解释器#   解释器启动就可以使用的名字,他们在解释器加载时加载进内存# 全局命名空间--代码,非函数#   程序加载时过程中加载的# 局部命名空间--函数中代码#   函数内部的名字,调用函数的时候才会产生,调用结束,消失<h1 id="函数名不加括号-可打印出内存地址"><a href="#函数名不加括号-可打印出内存地址" class="headerlink" title="函数名不加括号 ,可打印出内存地址"></a>函数名不加括号 ,可打印出内存地址</h1><h1 id="地址-相当于执行"><a href="#地址-相当于执行" class="headerlink" title="地址+() 相当于执行"></a>地址+() 相当于执行</h1><h1 id="a-1"><a href="#a-1" class="headerlink" title="a = 1"></a>a = 1</h1><h1 id="def-fun"><a href="#def-fun" class="headerlink" title="def fun():"></a>def fun():</h1><h1 id="a-2"><a href="#a-2" class="headerlink" title="a = 2"></a>a = 2</h1><h1 id="fun"><a href="#fun" class="headerlink" title="fun()"></a>fun()</h1><h1 id="print-a-a-1"><a href="#print-a-a-1" class="headerlink" title="print(a) # a=1"></a>print(a) # a=1</h1><h1 id="def-fun-1"><a href="#def-fun-1" class="headerlink" title="def fun():"></a>def fun():</h1><h1 id="global-a-不推荐使用"><a href="#global-a-不推荐使用" class="headerlink" title="global  a  # 不推荐使用"></a>global  a  # 不推荐使用</h1><h1 id="a-2-1"><a href="#a-2-1" class="headerlink" title="a = 2"></a>a = 2</h1><h1 id="fun-1"><a href="#fun-1" class="headerlink" title="fun()"></a>fun()</h1><h1 id="print-a-a-2"><a href="#print-a-a-2" class="headerlink" title="print(a) # a=2"></a>print(a) # a=2</h1><h1 id="对于不可变数据类型-在局部可查看全局中的变量"><a href="#对于不可变数据类型-在局部可查看全局中的变量" class="headerlink" title="对于不可变数据类型,在局部可查看全局中的变量"></a>对于不可变数据类型,在局部可查看全局中的变量</h1><h1 id="但不能直接修改"><a href="#但不能直接修改" class="headerlink" title="但不能直接修改"></a>但不能直接修改</h1><h1 id="若有修改-在函数中开始时加-global-xx"><a href="#若有修改-在函数中开始时加-global-xx" class="headerlink" title="若有修改,在函数中开始时加 global xx"></a>若有修改,在函数中开始时加 global xx</h1><h1 id="若在局部中声明一个global函数-那么此函数在局部内的操作对全局的变量有效"><a href="#若在局部中声明一个global函数-那么此函数在局部内的操作对全局的变量有效" class="headerlink" title="若在局部中声明一个global函数,那么此函数在局部内的操作对全局的变量有效"></a>若在局部中声明一个global函数,那么此函数在局部内的操作对全局的变量有效</h1><h1 id="globals-永远全局-locals-会变化"><a href="#globals-永远全局-locals-会变化" class="headerlink" title="globals() 永远全局,locals()会变化"></a>globals() 永远全局,locals()会变化</h1><h1 id="def-f"><a href="#def-f" class="headerlink" title="def f():"></a>def f():</h1><h1 id="x-“111”"><a href="#x-“111”" class="headerlink" title="x = “111”"></a>x = “111”</h1><h1 id="y-“222”"><a href="#y-“222”" class="headerlink" title="y = “222”"></a>y = “222”</h1><h1 id="print-locals-放在本地查看局部中所有变量-字典形式"><a href="#print-locals-放在本地查看局部中所有变量-字典形式" class="headerlink" title="print(locals())  # 放在本地查看局部中所有变量 字典形式"></a>print(locals())  # 放在本地查看局部中所有变量 字典形式</h1><h1 id="print-locals-放在全局-全局就是本地"><a href="#print-locals-放在全局-全局就是本地" class="headerlink" title="print(locals())  # 放在全局,全局就是本地"></a>print(locals())  # 放在全局,全局就是本地</h1><h1 id="print-globals-查看全局的与内置的"><a href="#print-globals-查看全局的与内置的" class="headerlink" title="print(globals())  # 查看全局的与内置的"></a>print(globals())  # 查看全局的与内置的</h1><h1 id="def-max-a-b"><a href="#def-max-a-b" class="headerlink" title="def max(a,b):"></a>def max(a,b):</h1><h1 id="return-a-if-a-gt-b-else-b-三目运算符"><a href="#return-a-if-a-gt-b-else-b-三目运算符" class="headerlink" title="return a if a&gt;b else b # 三目运算符"></a>return a if a&gt;b else b # 三目运算符</h1><h1 id="变量-条件返回True的结果-if-条件-else-条件返回False的结果"><a href="#变量-条件返回True的结果-if-条件-else-条件返回False的结果" class="headerlink" title="变量 = 条件返回True的结果 if 条件 else 条件返回False的结果"></a>变量 = 条件返回True的结果 if 条件 else 条件返回False的结果</h1><h1 id="print-max-1-2"><a href="#print-max-1-2" class="headerlink" title="print(max(1,2))"></a>print(max(1,2))</h1><h1 id="函数嵌套定义"><a href="#函数嵌套定义" class="headerlink" title="函数嵌套定义"></a>函数嵌套定义</h1><h1 id="def-f-…"><a href="#def-f-…" class="headerlink" title="def f():…"></a>def f():…</h1><h1 id="a-1-1"><a href="#a-1-1" class="headerlink" title="a = 1"></a>a = 1</h1><h1 id="def-outer"><a href="#def-outer" class="headerlink" title="def outer():"></a>def outer():</h1><h1 id="def-inner1"><a href="#def-inner1" class="headerlink" title="def inner1():"></a>def inner1():</h1><h1 id="a-2-2"><a href="#a-2-2" class="headerlink" title="a = 2"></a>a = 2</h1><h1 id="def-inner2"><a href="#def-inner2" class="headerlink" title="def inner2():"></a>def inner2():</h1><h1 id="a-3"><a href="#a-3" class="headerlink" title="a = 3"></a>a = 3</h1><h1 id="def-inner3"><a href="#def-inner3" class="headerlink" title="def inner3():"></a>def inner3():</h1><h1 id="nonlocal-a"><a href="#nonlocal-a" class="headerlink" title="nonlocal a"></a>nonlocal a</h1><h1 id="a-1-2"><a href="#a-1-2" class="headerlink" title="a += 1"></a>a += 1</h1><h1 id="inner3"><a href="#inner3" class="headerlink" title="inner3()"></a>inner3()</h1><h1 id="print-a"><a href="#print-a" class="headerlink" title="print(a)"></a>print(a)</h1><h1 id="inner2"><a href="#inner2" class="headerlink" title="inner2()"></a>inner2()</h1><h1 id="print-a-1"><a href="#print-a-1" class="headerlink" title="print(a)"></a>print(a)</h1><h1 id="inner1"><a href="#inner1" class="headerlink" title="inner1()"></a>inner1()</h1><h1 id="outer"><a href="#outer" class="headerlink" title="outer()"></a>outer()</h1><h1 id="print-a-2"><a href="#print-a-2" class="headerlink" title="print(a)"></a>print(a)</h1><h1 id="注意-global-var-此var必须是全局的-且全局的只有一层-局部可有多层-函数多层嵌套"><a href="#注意-global-var-此var必须是全局的-且全局的只有一层-局部可有多层-函数多层嵌套" class="headerlink" title="注意 global var 此var必须是全局的,且全局的只有一层,局部可有多层(函数多层嵌套)"></a>注意 global var 此var必须是全局的,且全局的只有一层,局部可有多层(函数多层嵌套)</h1><h1 id="py3-nolocal-var-声明了-上层-的-局部变量-局部若没有-会报错"><a href="#py3-nolocal-var-声明了-上层-的-局部变量-局部若没有-会报错" class="headerlink" title="py3 nolocal var 声明了(上层)的(局部变量),局部若没有,会报错"></a>py3 nolocal var 声明了(上层)的(局部变量),局部若没有,会报错</h1><h1 id="函数作为-元素-参数-返回值"><a href="#函数作为-元素-参数-返回值" class="headerlink" title="函数作为,元素,参数,返回值"></a>函数作为,元素,参数,返回值</h1><h1 id="函数可以赋值-fun-fun1-可变量一样-亦可放在list-dict等作为容器元素"><a href="#函数可以赋值-fun-fun1-可变量一样-亦可放在list-dict等作为容器元素" class="headerlink" title="函数可以赋值 fun = fun1,可变量一样,亦可放在list,dict等作为容器元素"></a>函数可以赋值 fun = fun1,可变量一样,亦可放在list,dict等作为容器元素</h1><h1 id="打印出来是-lt-function-fun-name-at-0x0000000-gt"><a href="#打印出来是-lt-function-fun-name-at-0x0000000-gt" class="headerlink" title="打印出来是&lt;function fun_name at 0x0000000&gt;"></a>打印出来是&lt;function fun_name at 0x0000000&gt;</h1><h1 id="加括号执行-list-fun-fun2-list0执行-也可作为参数再次传入函数"><a href="#加括号执行-list-fun-fun2-list0执行-也可作为参数再次传入函数" class="headerlink" title="加括号执行 list = [fun,fun2]  list0执行,也可作为参数再次传入函数"></a>加括号执行 list = [fun,fun2]  list<a href="">0</a>执行,也可作为参数再次传入函数</h1><h1 id="def-f-1"><a href="#def-f-1" class="headerlink" title="def f():"></a>def f():</h1><h1 id="print-1"><a href="#print-1" class="headerlink" title="print(1)"></a>print(1)</h1><h1 id="list-f"><a href="#list-f" class="headerlink" title="list = [f]"></a>list = [f]</h1><h1 id="list0"><a href="#list0" class="headerlink" title="list0"></a>list<a href="">0</a></h1><h1 id="第一类对象-函数名就符合"><a href="#第一类对象-函数名就符合" class="headerlink" title="第一类对象, 函数名就符合"></a>第一类对象, 函数名就符合</h1><h1 id="运行期创建"><a href="#运行期创建" class="headerlink" title="运行期创建"></a>运行期创建</h1><h1 id="可作为函数参数或返回值"><a href="#可作为函数参数或返回值" class="headerlink" title="可作为函数参数或返回值"></a>可作为函数参数或返回值</h1><h1 id="可存入变量的实体"><a href="#可存入变量的实体" class="headerlink" title="可存入变量的实体"></a>可存入变量的实体</h1><h1 id="闭包-嵌套函数-内部-调用-外部函-数-变量-若不调用-就是嵌套函数"><a href="#闭包-嵌套函数-内部-调用-外部函-数-变量-若不调用-就是嵌套函数" class="headerlink" title="闭包:嵌套函数,(内部)调用(外部函)数(变量),若不调用,就是嵌套函数"></a>闭包:嵌套函数,(内部)调用(外部函)数(变量),若不调用,就是嵌套函数</h1><h1 id="def-outer-1"><a href="#def-outer-1" class="headerlink" title="def outer():"></a>def outer():</h1><h1 id="a-1-3"><a href="#a-1-3" class="headerlink" title="a = 1"></a>a = 1</h1><h1 id="def-inn"><a href="#def-inn" class="headerlink" title="def inn():"></a>def inn():</h1><h1 id="print-a-3"><a href="#print-a-3" class="headerlink" title="print(a)"></a>print(a)</h1><h1 id="print-inn-closure-lt-cell-at-addr-int…-gt-表示是闭包"><a href="#print-inn-closure-lt-cell-at-addr-int…-gt-表示是闭包" class="headerlink" title="print(inn.closure)  # &lt;cell at addr:int….&gt; 表示是闭包"></a>print(inn.<strong>closure</strong>)  # &lt;cell at addr:int….&gt; 表示是闭包</h1><h1 id="outer-1"><a href="#outer-1" class="headerlink" title="outer()"></a>outer()</h1><h1 id="print-outer-closure-None-不是闭包"><a href="#print-outer-closure-None-不是闭包" class="headerlink" title="print(outer.closure)  # None 不是闭包"></a>print(outer.<strong>closure</strong>)  # None 不是闭包</h1><h1 id="常用形式-外部调用函数内部函数"><a href="#常用形式-外部调用函数内部函数" class="headerlink" title="常用形式, 外部调用函数内部函数,"></a>常用形式, 外部调用函数内部函数,</h1><h1 id="以前不用时-每次outer-内部数据都会建立"><a href="#以前不用时-每次outer-内部数据都会建立" class="headerlink" title="以前不用时,每次outer()内部数据都会建立,"></a>以前不用时,每次outer()内部数据都会建立,</h1><h1 id="此时使用返回值-只要引用存在-数据创建一次-不会随outer结束而消失-避免多次创建"><a href="#此时使用返回值-只要引用存在-数据创建一次-不会随outer结束而消失-避免多次创建" class="headerlink" title="此时使用返回值,只要引用存在,数据创建一次,不会随outer结束而消失,避免多次创建"></a>此时使用返回值,只要引用存在,数据创建一次,不会随outer结束而消失,避免多次创建</h1><h1 id="def-outer-2"><a href="#def-outer-2" class="headerlink" title="def outer():"></a>def outer():</h1><h1 id="a-1-4"><a href="#a-1-4" class="headerlink" title="a = 1"></a>a = 1</h1><h1 id="def-inn-1"><a href="#def-inn-1" class="headerlink" title="def inn():"></a>def inn():</h1><h1 id="print-a-4"><a href="#print-a-4" class="headerlink" title="print(a)"></a>print(a)</h1><h1 id="return-inn"><a href="#return-inn" class="headerlink" title="return inn"></a>return inn</h1><h1 id="b-outer"><a href="#b-outer" class="headerlink" title="b = outer()"></a>b = outer()</h1><h1 id="b"><a href="#b" class="headerlink" title="b()"></a>b()</h1><h1 id="import-urllib-模块-py文件"><a href="#import-urllib-模块-py文件" class="headerlink" title="import urllib # 模块,py文件"></a>import urllib # 模块,py文件</h1><h1 id="from-urllib-request-import-urlopen"><a href="#from-urllib-request-import-urlopen" class="headerlink" title="from urllib.request import urlopen"></a>from urllib.request import urlopen</h1><h1 id="-4"><a href="#-4" class="headerlink" title=""></a></h1><h1 id="-5"><a href="#-5" class="headerlink" title=""></a></h1><h1 id="def-geturl"><a href="#def-geturl" class="headerlink" title="def geturl():"></a>def geturl():</h1><h1 id="url-“http-www-xiaohuar-com-quot"><a href="#url-“http-www-xiaohuar-com-quot" class="headerlink" title="url = “http://www.xiaohuar.com&quot;"></a>url = “<a href="http://www.xiaohuar.com&quot;/">http://www.xiaohuar.com&quot;</a></h1><h1 id="def-get"><a href="#def-get" class="headerlink" title="def get():"></a>def get():</h1><h1 id="ret-urlopen-url-read"><a href="#ret-urlopen-url-read" class="headerlink" title="ret = urlopen(url).read()"></a>ret = urlopen(url).read()</h1><h1 id="return-ret"><a href="#return-ret" class="headerlink" title="return ret"></a>return ret</h1><h1 id="return-get"><a href="#return-get" class="headerlink" title="return get"></a>return get</h1><h1 id="-6"><a href="#-6" class="headerlink" title=""></a></h1><h1 id="get-geturl"><a href="#get-geturl" class="headerlink" title="get = geturl()"></a>get = geturl()</h1><h1 id="print-get"><a href="#print-get" class="headerlink" title="print(get())"></a>print(get())</h1><h1 id="c-fun-10-20-先执行-在赋值-赋函数返回值-若无则是None"><a href="#c-fun-10-20-先执行-在赋值-赋函数返回值-若无则是None" class="headerlink" title="c = fun(10,20) 先执行, 在赋值,赋函数返回值,若无则是None"></a>c = fun(10,20) 先执行, 在赋值,赋函数返回值,若无则是None</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">装饰器</span></h1><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 装饰器形成过程# 装饰器作用# 不想修改函数的调用方式,但是还要在原始函数中加工能,java中的面向切面编程# def fun():#     print("原始功能")# def outer(f):#     def inner():#         print("前置额外功能")#         f()#         print("后置额外功能")#     return inner# fun = outer(fun)# fun()# 被装饰函数可加返回值,需要在inner中接受并返回# 也可以加参数,inner(*args(1,2,3,4),**kwargs) 接受,此时inner中args是个列表,f(*args,**kwargs) 表示把列表args,按位置传入# print(*args)--&gt; 1 2 3 4# 接受聚合,调用打散# 原则:开放封闭原则#   对扩展开放,修改封闭<h1 id="语法糖"><a href="#语法糖" class="headerlink" title="语法糖"></a>语法糖</h1><h1 id="outer-装饰器函数名"><a href="#outer-装饰器函数名" class="headerlink" title="@outer   @+装饰器函数名"></a>@outer   @+装饰器函数名</h1><h1 id="def-fun-2"><a href="#def-fun-2" class="headerlink" title="def fun():"></a>def fun():</h1><h1 id="print-“原始功能”"><a href="#print-“原始功能”" class="headerlink" title="print(“原始功能”)"></a>print(“原始功能”)</h1><h1 id="加上语法糖词句-可省"><a href="#加上语法糖词句-可省" class="headerlink" title="加上语法糖词句(可省)"></a>加上语法糖词句(可省)</h1><h1 id="fun-outer-fun"><a href="#fun-outer-fun" class="headerlink" title="fun = outer(fun)"></a>fun = outer(fun)</h1><h1 id="装饰器的固定模式-公式"><a href="#装饰器的固定模式-公式" class="headerlink" title="装饰器的固定模式(公式)"></a>装饰器的固定模式(公式)</h1><p></pre></div></p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">装饰器进阶</span></h1><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 装饰器形成过程# 装饰器作用# 不想修改函数的调用方式,但是还要在原始函数中加工能,java中的面向切面编程# def fun():#     print("原始功能")# def outer(f):#     def inner():#         print("前置额外功能")#         f()#         print("后置额外功能")#     return inner# fun = outer(fun)# fun()# 被装饰函数可加返回值,需要在inner中接受并返回# 也可以加参数,inner(*args(1,2,3,4),**kwargs) 接受,此时inner中args是个列表,f(*args,**kwargs) 表示把列表args,按位置传入# print(*args)--&gt; 1 2 3 4# 接受聚合,调用打散# 原则:开放封闭原则#   对扩展开放,修改封闭<h1 id="语法糖-1"><a href="#语法糖-1" class="headerlink" title="语法糖"></a>语法糖</h1><h1 id="outer-装饰器函数名-1"><a href="#outer-装饰器函数名-1" class="headerlink" title="@outer   @+装饰器函数名"></a>@outer   @+装饰器函数名</h1><h1 id="def-fun-3"><a href="#def-fun-3" class="headerlink" title="def fun():"></a>def fun():</h1><h1 id="print-“原始功能”-1"><a href="#print-“原始功能”-1" class="headerlink" title="print(“原始功能”)"></a>print(“原始功能”)</h1><h1 id="加上语法糖词句-可省-1"><a href="#加上语法糖词句-可省-1" class="headerlink" title="加上语法糖词句(可省)"></a>加上语法糖词句(可省)</h1><h1 id="fun-outer-fun-1"><a href="#fun-outer-fun-1" class="headerlink" title="fun = outer(fun)"></a>fun = outer(fun)</h1><h1 id="装饰器的固定模式-公式-1"><a href="#装饰器的固定模式-公式-1" class="headerlink" title="装饰器的固定模式(公式)"></a>装饰器的固定模式(公式)</h1><h1 id="def-fun-pass"><a href="#def-fun-pass" class="headerlink" title="def fun():pass"></a>def fun():pass</h1><h1 id="print-fun-name-打印-执行函数-的字符串函数名-对于装饰器的话-返回的是inner的名字"><a href="#print-fun-name-打印-执行函数-的字符串函数名-对于装饰器的话-返回的是inner的名字" class="headerlink" title="print(fun.name) 打印(执行函数)的字符串函数名,对于装饰器的话,返回的是inner的名字"></a>print(fun.<strong>name</strong>) 打印(执行函数)的字符串函数名,对于装饰器的话,返回的是inner的名字</h1><h1 id="print-fun-doc-打印函数注释-同上"><a href="#print-fun-doc-打印函数注释-同上" class="headerlink" title="print(fun.doc) 打印函数注释,同上"></a>print(fun.<strong>doc</strong>) 打印函数注释,同上</h1><h1 id="添加from-functools-import-wraps-固定的-给inner函数加上-waraps-原始函数名"><a href="#添加from-functools-import-wraps-固定的-给inner函数加上-waraps-原始函数名" class="headerlink" title="添加from functools import wraps(固定的) 给inner函数加上@waraps+(原始函数名)"></a>添加from functools import wraps(固定的) 给inner函数加上@waraps+(原始函数名)</h1><h1 id="此时调用fun-name-即可返回原始函数的信息"><a href="#此时调用fun-name-即可返回原始函数的信息" class="headerlink" title="此时调用fun._name 即可返回原始函数的信息"></a>此时调用fun._<strong>name</strong> 即可返回原始函数的信息</h1><h1 id="一个装饰器-装饰多个函数-在不同函数上加-语法糖即可"><a href="#一个装饰器-装饰多个函数-在不同函数上加-语法糖即可" class="headerlink" title="一个装饰器,装饰多个函数,在不同函数上加@语法糖即可"></a>一个装饰器,装饰多个函数,在不同函数上加@语法糖即可</h1><h1 id="带参数的装饰器"><a href="#带参数的装饰器" class="headerlink" title="带参数的装饰器"></a>带参数的装饰器</h1><h1 id="500个函数要加装饰器-一个函数修饰多个函数"><a href="#500个函数要加装饰器-一个函数修饰多个函数" class="headerlink" title="500个函数要加装饰器,一个函数修饰多个函数"></a>500个函数要加装饰器,一个函数修饰多个函数</h1><p>def timmer(f):<br>    def inner(*args, **kwargs):<br>        pass<br>        ret = f(*args, **kwargs)<br>        pass<br>        return ret</p><pre><code class="hljs">return inner</code></pre></div><p>@timmer<br>def fun(): pass</p><h1 id="修改-三层装饰器-最多就是三层"><a href="#修改-三层装饰器-最多就是三层" class="headerlink" title="修改,三层装饰器,最多就是三层"></a>修改,三层装饰器,最多就是三层</h1><p>FLAG = True<br>def timmer_out(flag):<br>    def timmer(f):<br>        def inner(*args, **kwargs):<br>            if flag:<br>                pass<br>                ret = f(*args, **kwargs)<br>                pass<br>            else:<br>                ret = f(*args, **kwargs)<br>            return ret<br>        return inner<br>    return timmer</p><h1 id="加上括号就是调用-先调用再"><a href="#加上括号就是调用-先调用再" class="headerlink" title="加上括号就是调用,先调用再@"></a>加上括号就是调用,先调用再@</h1><h1 id="timmer-out-FLAG-timmer-timmer-out-FLAG-timmer"><a href="#timmer-out-FLAG-timmer-timmer-out-FLAG-timmer" class="headerlink" title="@timmer_out(FLAG) = timmer = timmer_out(FLAG);@timmer"></a>@timmer_out(FLAG) = timmer = timmer_out(FLAG);@timmer</h1><p>@timmer_out(FLAG)<br>def fun(): pass</p><h1 id="多个装饰器装饰一个函数"><a href="#多个装饰器装饰一个函数" class="headerlink" title="多个装饰器装饰一个函数"></a>多个装饰器装饰一个函数</h1><h1 id="运行时先d1-的前置装饰-d2-的前置装饰-d2的后置装饰-d1的后置装饰"><a href="#运行时先d1-的前置装饰-d2-的前置装饰-d2的后置装饰-d1的后置装饰" class="headerlink" title="运行时先d1 的前置装饰,d2 的前置装饰,d2的后置装饰,d1的后置装饰"></a>运行时先d1 的前置装饰,d2 的前置装饰,d2的后置装饰,d1的后置装饰</h1><h1 id="两个装饰器-先生效距离原函数近的语法糖-所以先生效的在内部"><a href="#两个装饰器-先生效距离原函数近的语法糖-所以先生效的在内部" class="headerlink" title="两个装饰器,先生效距离原函数近的语法糖,所以先生效的在内部"></a>两个装饰器,先生效距离原函数近的语法糖,所以先生效的在内部</h1><h1 id="嵌套调用装饰器"><a href="#嵌套调用装饰器" class="headerlink" title="嵌套调用装饰器"></a>嵌套调用装饰器</h1><p>def decorate1(f): # f–&gt; fun<br>    def inner1():<br>        pass<br>def decorate2(f): # f–&gt;inner<br>    def inner2():<br>        pass<br>@decorate1 # fun = decorate1(fun)-&gt;decorate1(inner)==inner2<br>@decorate2 # fun = decorate2(fun)=inner<br>def fun():<br>    pass</p><h1 id="此时调用fun-等于调用inner2"><a href="#此时调用fun-等于调用inner2" class="headerlink" title="此时调用fun()等于调用inner2"></a>此时调用fun()等于调用inner2</h1><p>fun()<br></pre></p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">迭代器与生成器</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># list(generator) 也可以从生成器取值,但是取全部,全部内容内存生成# def generator():#     print(1)#     yield 1#     print(2)# g = generator();# print(g.__next__())# 调用2次next 第二次会打印2 但会报错# def generator():#     print(1)#     count = yield 1#     print(2)#     yield 2# g = generator();# print(g.__next__()) #执行到 yield 1# print(g.send())  # send() 与next效果相同# print(g.send("hello")) # 获取yield 时 传入新的值<h1 id="修改yield-1-为-count-yield-1"><a href="#修改yield-1-为-count-yield-1" class="headerlink" title="修改yield 1 为 count = yield 1"></a>修改yield 1 为 count = yield 1</h1><h1 id="此时执行到yield-1-时-停止-等待send-传入值给上个next-并赋值-在向下执行"><a href="#此时执行到yield-1-时-停止-等待send-传入值给上个next-并赋值-在向下执行" class="headerlink" title="此时执行到yield 1 时 停止,等待send() ,传入值给上个next,并赋值,在向下执行"></a>此时执行到yield 1 时 停止,等待send() ,传入值给上个next,并赋值,在向下执行</h1><h1 id="注意第一次获取生成器时-必须使用next"><a href="#注意第一次获取生成器时-必须使用next" class="headerlink" title="注意第一次获取生成器时,必须使用next,"></a>注意第一次获取生成器时,必须使用next,</h1><h1 id="最后一个yield-不能接受外部的值-最后一个yield会后不能有代码-若必须使用-最后加yield-即可-空"><a href="#最后一个yield-不能接受外部的值-最后一个yield会后不能有代码-若必须使用-最后加yield-即可-空" class="headerlink" title="最后一个yield 不能接受外部的值,最后一个yield会后不能有代码,若必须使用,最后加yield 即可, 空"></a>最后一个yield 不能接受外部的值,最后一个yield会后不能有代码,若必须使用,最后加yield 即可, 空</h1><h1 id="获取移动平均值"><a href="#获取移动平均值" class="headerlink" title="获取移动平均值"></a>获取移动平均值</h1><h1 id="def-average"><a href="#def-average" class="headerlink" title="def average():"></a>def average():</h1><h1 id="sum-0"><a href="#sum-0" class="headerlink" title="sum = 0"></a>sum = 0</h1><h1 id="count-0"><a href="#count-0" class="headerlink" title="count = 0"></a>count = 0</h1><h1 id="avg-0"><a href="#avg-0" class="headerlink" title="avg = 0"></a>avg = 0</h1><h1 id="while-1"><a href="#while-1" class="headerlink" title="while 1:"></a>while 1:</h1><h1 id="num-yield-avg"><a href="#num-yield-avg" class="headerlink" title="num = yield avg"></a>num = yield avg</h1><h1 id="sum-num"><a href="#sum-num" class="headerlink" title="sum += num"></a>sum += num</h1><h1 id="count-1"><a href="#count-1" class="headerlink" title="count +=1"></a>count +=1</h1><h1 id="avg-sum-count"><a href="#avg-sum-count" class="headerlink" title="avg = sum / count"></a>avg = sum / count</h1><h1 id="avg-average"><a href="#avg-average" class="headerlink" title="avg = average()"></a>avg = average()</h1><h1 id="print-avg-next"><a href="#print-avg-next" class="headerlink" title="print(avg.next())"></a>print(avg.<strong>next</strong>())</h1><h1 id="print-avg-send-10"><a href="#print-avg-send-10" class="headerlink" title="print(avg.send(10))"></a>print(avg.send(10))</h1><h1 id="print-avg-send-20"><a href="#print-avg-send-20" class="headerlink" title="print(avg.send(20))"></a>print(avg.send(20))</h1><h1 id="def-generator"><a href="#def-generator" class="headerlink" title="def generator():"></a>def generator():</h1><h1 id="a-“abcd”"><a href="#a-“abcd”" class="headerlink" title="a = “abcd”"></a>a = “abcd”</h1><h1 id="b-“1234”"><a href="#b-“1234”" class="headerlink" title="b = “1234”"></a>b = “1234”</h1><h1 id="for-循环yield-a"><a href="#for-循环yield-a" class="headerlink" title="# for 循环yield a"></a># for 循环yield a</h1><h1 id="yield-from-a"><a href="#yield-from-a" class="headerlink" title="yield from a"></a>yield from a</h1><h1 id="yield-from-b"><a href="#yield-from-b" class="headerlink" title="yield from b"></a>yield from b</h1><h1 id="for-i-in-generator"><a href="#for-i-in-generator" class="headerlink" title="for i in generator():"></a>for i in generator():</h1><h1 id="print-i-a-b-c-d-1-2-3-4"><a href="#print-i-a-b-c-d-1-2-3-4" class="headerlink" title="print(i) # a b c d 1 2 3 4"></a>print(i) # a b c d 1 2 3 4</h1><h1 id="-7"><a href="#-7" class="headerlink" title=""></a></h1><h1 id="生成器表达式和列表推导式"><a href="#生成器表达式和列表推导式" class="headerlink" title="生成器表达式和列表推导式"></a>生成器表达式和列表推导式</h1><h1 id="推导式"><a href="#推导式" class="headerlink" title="推导式"></a>推导式</h1><h1 id="list-i-for-i-in-range-10"><a href="#list-i-for-i-in-range-10" class="headerlink" title="list = [i for i in range(10)]"></a>list = [i for i in range(10)]</h1><h1 id="print-list"><a href="#print-list" class="headerlink" title="print(list)"></a>print(list)</h1><h1 id="list-“dzf-s”-i-for-i-in-range-10"><a href="#list-“dzf-s”-i-for-i-in-range-10" class="headerlink" title="list = [“dzf%s” %i for i in range(10)]"></a>list = [“dzf%s” %i for i in range(10)]</h1><h1 id="print-list-1"><a href="#print-list-1" class="headerlink" title="print(list)"></a>print(list)</h1><h1 id="其他推导式"><a href="#其他推导式" class="headerlink" title="其他推导式"></a>其他推导式</h1><h1 id="元素或操作-for-元素-in-可迭代数据类型-遍历后处理"><a href="#元素或操作-for-元素-in-可迭代数据类型-遍历后处理" class="headerlink" title="[元素或操作 for 元素 in 可迭代数据类型] 遍历后处理"></a>[元素或操作 for 元素 in 可迭代数据类型] 遍历后处理</h1><h1 id="满足条件的元素的操作-for-元素-in-可迭代数据类型-if-元素条件-筛选功能"><a href="#满足条件的元素的操作-for-元素-in-可迭代数据类型-if-元素条件-筛选功能" class="headerlink" title="[满足条件的元素的操作 for 元素 in 可迭代数据类型 if 元素条件] 筛选功能"></a>[满足条件的元素的操作 for 元素 in 可迭代数据类型 if 元素条件] 筛选功能</h1><h1 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h1><h1 id="i-for-i-in-range-30-if-i-3-0-–-gt-0-3-6…"><a href="#i-for-i-in-range-30-if-i-3-0-–-gt-0-3-6…" class="headerlink" title="[i for i in range(30) if i%3==0] –&gt;[0,3,6….]"></a>[i for i in range(30) if i%3==0] –&gt;[0,3,6….]</h1><h1 id="双层for-查找-双层list中数据"><a href="#双层for-查找-双层list中数据" class="headerlink" title="双层for 查找 双层list中数据"></a>双层for 查找 双层list中数据</h1><h1 id="names-‘Tom’-‘Billy’-‘Jefferson’-‘Andrew’-‘Wesley’-‘Steven’-‘Joe’"><a href="#names-‘Tom’-‘Billy’-‘Jefferson’-‘Andrew’-‘Wesley’-‘Steven’-‘Joe’" class="headerlink" title="names = [[‘Tom’, ‘Billy’, ‘Jefferson’, ‘Andrew’, ‘Wesley’, ‘Steven’, ‘Joe’],"></a>names = [[‘Tom’, ‘Billy’, ‘Jefferson’, ‘Andrew’, ‘Wesley’, ‘Steven’, ‘Joe’],</h1><h1 id="‘Alice’-‘Jill’-‘Ana’-‘Wendy’-‘Jennifer’-‘Sherry’-‘Eva’"><a href="#‘Alice’-‘Jill’-‘Ana’-‘Wendy’-‘Jennifer’-‘Sherry’-‘Eva’" class="headerlink" title="[‘Alice’, ‘Jill’, ‘Ana’, ‘Wendy’, ‘Jennifer’, ‘Sherry’, ‘Eva’]]"></a>[‘Alice’, ‘Jill’, ‘Ana’, ‘Wendy’, ‘Jennifer’, ‘Sherry’, ‘Eva’]]</h1><h1 id="name-for-list-in-names-for-name-in-list-if-name-count-‘e’-2"><a href="#name-for-list-in-names-for-name-in-list-if-name-count-‘e’-2" class="headerlink" title="[name for list in names for name in list if name.count(‘e’)==2]"></a>[name for list in names for name in list if name.count(‘e’)==2]</h1><h1 id="集合推导式"><a href="#集合推导式" class="headerlink" title="集合推导式,"></a>集合推导式,</h1><h1 id="x-2-for-x-in-1-1-2-–-gt-1-4-自带去重"><a href="#x-2-for-x-in-1-1-2-–-gt-1-4-自带去重" class="headerlink" title="{x**2 for x in [1,-1,2]} –&gt;{1,4} 自带去重"></a>{x**2 for x in [1,-1,2]} –&gt;{1,4} 自带去重</h1><h1 id="x-2-for-x-in-1-1-2-–-gt-1-1-4"><a href="#x-2-for-x-in-1-1-2-–-gt-1-1-4" class="headerlink" title="[x**2 for x in [1,-1,2]] –&gt;[1,1,4]"></a>[x**2 for x in [1,-1,2]] –&gt;[1,1,4]</h1><h1 id="字典推导式"><a href="#字典推导式" class="headerlink" title="字典推导式"></a>字典推导式</h1><h1 id="调换字典的key-value"><a href="#调换字典的key-value" class="headerlink" title="调换字典的key-value"></a>调换字典的key-value</h1><h1 id="dict-“a”-1-”b”-2-”A”-7-”B”-45"><a href="#dict-“a”-1-”b”-2-”A”-7-”B”-45" class="headerlink" title="dict = {“a”:1,”b”:2,”A”:7,”B”:45}"></a>dict = {“a”:1,”b”:2,”A”:7,”B”:45}</h1><h1 id="dict2-dict-k-k-for-k-in-dict"><a href="#dict2-dict-k-k-for-k-in-dict" class="headerlink" title="dict2 = {dict[k]:k for k in dict}"></a>dict2 = {dict[k]:k for k in dict}</h1><h1 id="合并大小写对应的value值-将k统一成小写"><a href="#合并大小写对应的value值-将k统一成小写" class="headerlink" title="合并大小写对应的value值,将k统一成小写"></a>合并大小写对应的value值,将k统一成小写</h1><h1 id="dict3-k-lower-dict-get-k-lower-0-dict-get-k-upper-0-for-k-in-dict"><a href="#dict3-k-lower-dict-get-k-lower-0-dict-get-k-upper-0-for-k-in-dict" class="headerlink" title="dict3 = {k.lower(): dict.get(k.lower(),0)+dict.get(k.upper(), 0) for k in dict}"></a>dict3 = {k.lower(): dict.get(k.lower(),0)+dict.get(k.upper(), 0) for k in dict}</h1><h1 id="print-dict3"><a href="#print-dict3" class="headerlink" title="print(dict3)"></a>print(dict3)</h1><h1 id="表达式-括号不同-g为生成器"><a href="#表达式-括号不同-g为生成器" class="headerlink" title="表达式,括号不同,g为生成器."></a>表达式,括号不同,g为生成器.</h1><h1 id="g-i-for-i-in-range-10"><a href="#g-i-for-i-in-range-10" class="headerlink" title="g = (i for i in range(10))"></a>g = (i for i in range(10))</h1><h1 id="print-g"><a href="#print-g" class="headerlink" title="print(g)"></a>print(g)</h1><h1 id="for-i-in-g"><a href="#for-i-in-g" class="headerlink" title="for i in g:"></a>for i in g:</h1><h1 id="print-i"><a href="#print-i" class="headerlink" title="print(i)"></a>print(i)</h1><h1 id="print-type-list"><a href="#print-type-list" class="headerlink" title="print(type(list()))"></a>print(type(list()))</h1><h1 id="print-type-1-2-34-5-5-5"><a href="#print-type-1-2-34-5-5-5" class="headerlink" title="print(type({1,2,34,5,5,5,}))"></a>print(type({1,2,34,5,5,5,}))</h1><h1 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h1><h1 id="def-find-path"><a href="#def-find-path" class="headerlink" title="def find(path):"></a>def find(path):</h1><h1 id="with-open-path-encoding-”utf-8”-as-f"><a href="#with-open-path-encoding-”utf-8”-as-f" class="headerlink" title="with open(path,encoding=”utf-8”) as f:"></a>with open(path,encoding=”utf-8”) as f:</h1><h1 id="for-line-in-f"><a href="#for-line-in-f" class="headerlink" title="for line in f:"></a>for line in f:</h1><h1 id="if-“xxx”-in-line"><a href="#if-“xxx”-in-line" class="headerlink" title="if “xxx” in line:"></a>if “xxx” in line:</h1><h1 id="yield-line"><a href="#yield-line" class="headerlink" title="yield line"></a>yield line</h1><h1 id="for-line-in-find-“xxx”"><a href="#for-line-in-find-“xxx”" class="headerlink" title="for line in find(“xxx”):"></a>for line in find(“xxx”):</h1><h1 id="print-line"><a href="#print-line" class="headerlink" title="print(line)"></a>print(line)</h1><h1 id="生成器面试题"><a href="#生成器面试题" class="headerlink" title="生成器面试题"></a>生成器面试题</h1><h1 id="def-demo"><a href="#def-demo" class="headerlink" title="def demo():"></a>def demo():</h1><h1 id="for-i-in-range-4"><a href="#for-i-in-range-4" class="headerlink" title="for i in range(4):"></a>for i in range(4):</h1><h1 id="yield-i"><a href="#yield-i" class="headerlink" title="yield i"></a>yield i</h1><h1 id="g-demo"><a href="#g-demo" class="headerlink" title="g = demo()"></a>g = demo()</h1><h1 id="g1-i-for-i-in-g-–-gt-此时未for循环-只生成生成器"><a href="#g1-i-for-i-in-g-–-gt-此时未for循环-只生成生成器" class="headerlink" title="g1 = (i for i in g) # –&gt;此时未for循环,只生成生成器"></a>g1 = (i for i in g) # –&gt;此时未for循环,只生成生成器</h1><h1 id="def-fun-4"><a href="#def-fun-4" class="headerlink" title="def fun():"></a>def fun():</h1><h1 id="for-i-in-g-1"><a href="#for-i-in-g-1" class="headerlink" title="for i in g:"></a>for i in g:</h1><h1 id="yield-i-1"><a href="#yield-i-1" class="headerlink" title="yield i"></a>yield i</h1><h1 id="g2-i-for-i-in-g1"><a href="#g2-i-for-i-in-g1" class="headerlink" title="g2 = (i for i in g1)"></a>g2 = (i for i in g1)</h1><h1 id="print-list-g1-–-gt-1-2-3-4-g1-执行生成器-全部取出"><a href="#print-list-g1-–-gt-1-2-3-4-g1-执行生成器-全部取出" class="headerlink" title="print(list(g1)) # –&gt;[1,2,3,4],g1,执行生成器,全部取出"></a>print(list(g1)) # –&gt;[1,2,3,4],g1,执行生成器,全部取出</h1><h1 id="print-list-g2-–-gt-此时从g1取值没有了-为空"><a href="#print-list-g2-–-gt-此时从g1取值没有了-为空" class="headerlink" title="print(list(g2)) # –&gt;[],此时从g1取值没有了,为空"></a>print(list(g2)) # –&gt;[],此时从g1取值没有了,为空</h1><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>def add(n,i):<br>    return n+i<br>def test():<br>    for i in range(4):<br>        yield i<br>g=test()<br>for n in [1,10,5]:<br>    g = (add(n,i) for i in g)<br>#</p><h1 id="n-1"><a href="#n-1" class="headerlink" title="n = 1"></a>n = 1</h1><h1 id="g-add-n-i-for-i-in-g"><a href="#g-add-n-i-for-i-in-g" class="headerlink" title="g=(add(n,i) for i in g)"></a>g=(add(n,i) for i in g)</h1><h1 id="n-10"><a href="#n-10" class="headerlink" title="n = 10"></a>n = 10</h1><h1 id="g-add-n-i-for-i-in-g-–-gt-g-add-n-i-for-i-in-add-n-i-for-i-in-g"><a href="#g-add-n-i-for-i-in-g-–-gt-g-add-n-i-for-i-in-add-n-i-for-i-in-g" class="headerlink" title="g=(add(n,i) for i in g) # –&gt;g=(add(n,i) for i in (add(n,i) for i in g))"></a>g=(add(n,i) for i in g) # –&gt;g=(add(n,i) for i in (add(n,i) for i in g))</h1><p>print(list(g))<br></pre></div></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">list1 = [ # 列表剥皮    1,    2,    [        3,        4,        [5,6,7]    ],    [        3,        4,        [            5,            6,            7,            [8,9,10]        ]    ]]def f3(x): # 生成器    return [a for b in x for a in f3(b)] if isinstance(x, list) else [x]def f2(x):    l = []    for i in x:        if isinstance(i,list):            for k in f2(i):                l.append(k)        else:            l.append(i)    return ldef f(x,l=[]):    for i in x:        if isinstance(i,list):            f(i)        else:            l.append(i)    return lprint(f(list1))print(f2(list1))print(f3(list1))</pre></div><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">内置函数</span></h1><p class="md-end-block md-p"><span class="md-link"><a href="https://www.processon.com/view/link/5d4fa21be4b0ac2b61744998">https://www.processon.com/view/link/5d4fa21be4b0ac2b61744998</a></span></p><p class="md-end-block md-p"><span class="md-link"><a href="http://assets.processon.com/chart_image/5d4fa098e4b0869fa40f9454.png">http://assets.processon.com/chart_image/5d4fa098e4b0869fa40f9454.png</a></span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 内置函数# callable('xxx') # 检测是不是函数---&gt;True or False# help(str) # 显示str的帮助信息# (导入)import time=time = __import__('time')# print(time.time())# f=open()# f.read()# print(f.writable()) # 检测是否可写# print(f.readable()) # 检测是否可读# # 内存相关# id()# hash(),一次执行中,相同的对象hash值不变,不管对象多大,hash值有范围# print(hash(123456))# print(hash('123456'))# print(hash([1,2,3,4,5,6])) # 不可hash# print(hash((1,2,3,4,5,6)))<h1 id="print"><a href="#print" class="headerlink" title="print()"></a>print()</h1><h1 id="print-“xxxx”-自带换行符"><a href="#print-“xxxx”-自带换行符" class="headerlink" title="print(“xxxx”) # 自带换行符"></a>print(“xxxx”) # 自带换行符</h1><h1 id="print-“xxx”-end-’’-取消换行"><a href="#print-“xxx”-end-’’-取消换行" class="headerlink" title="print(“xxx”,end=’’) # 取消换行"></a>print(“xxx”,end=’’) # 取消换行</h1><h1 id="print-“xxx”-sep-’-’-指定分隔符"><a href="#print-“xxx”-sep-’-’-指定分隔符" class="headerlink" title="print(“xxx”,sep=’|’) # 指定分隔符"></a>print(“xxx”,sep=’|’) # 指定分隔符</h1><h1 id="f-open-‘file’-’w’-指定打印文件位置-控制台也是文件"><a href="#f-open-‘file’-’w’-指定打印文件位置-控制台也是文件" class="headerlink" title="f = open(‘file’,’w’) # 指定打印文件位置,控制台也是文件"></a>f = open(‘file’,’w’) # 指定打印文件位置,控制台也是文件</h1><h1 id="print-“xxx”-file-f"><a href="#print-“xxx”-file-f" class="headerlink" title="print(“xxx”,file=f)"></a>print(“xxx”,file=f)</h1><h1 id="f-close-2"><a href="#f-close-2" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="进度条"><a href="#进度条" class="headerlink" title="进度条"></a>进度条</h1><h1 id="r-表示回到行首"><a href="#r-表示回到行首" class="headerlink" title="\r 表示回到行首"></a>\r 表示回到行首</h1><h1 id="n-使最后换行"><a href="#n-使最后换行" class="headerlink" title="\n 使最后换行"></a>\n 使最后换行</h1><h1 id="flush-True-传入字符立即写入-不缓存再写"><a href="#flush-True-传入字符立即写入-不缓存再写" class="headerlink" title="flush=True, 传入字符立即写入,不缓存再写"></a>flush=True, 传入字符立即写入,不缓存再写</h1><h1 id="import-time"><a href="#import-time" class="headerlink" title="import time"></a>import time</h1><h1 id="for-i-in-range-0-101-2"><a href="#for-i-in-range-0-101-2" class="headerlink" title="for i in range(0,101,2):"></a>for i in range(0,101,2):</h1><h1 id="time-sleep-0-1"><a href="#time-sleep-0-1" class="headerlink" title="time.sleep(0.1)"></a>time.sleep(0.1)</h1><h1 id="char-num-i-2"><a href="#char-num-i-2" class="headerlink" title="char_num = i//2"></a>char_num = i//2</h1><h1 id="per-str-”-r-s-s-n”-i-’-’char-num-if-i-100-else-“-r-s-s”-i-’‘-char-num"><a href="#per-str-”-r-s-s-n”-i-’-’char-num-if-i-100-else-“-r-s-s”-i-’‘-char-num" class="headerlink" title="per_str=”\r%s%%:%s\n” % (i,’*’char_num) if i==100 else “\r%s%%:%s” % (i,’‘*char_num)"></a>per_str=”\r%s%%:%s\n” % (i,’*’<em>char_num) if i==100 else “\r%s%%:%s” % (i,’</em>‘*char_num)</h1><h1 id="print-per-str-end-’’-flush-True"><a href="#print-per-str-end-’’-flush-True" class="headerlink" title="print(per_str,end=’’,flush=True)"></a>print(per_str,end=’’,flush=True)</h1><h1 id="exec-eval-都可执行字符串代码-exec-无返回值"><a href="#exec-eval-都可执行字符串代码-exec-无返回值" class="headerlink" title="exec eval, 都可执行字符串代码,exec 无返回值"></a>exec eval, 都可执行字符串代码,exec 无返回值</h1><h1 id="eval-只能用明确知道的要执行的代码-不常用"><a href="#eval-只能用明确知道的要执行的代码-不常用" class="headerlink" title="eval 只能用明确知道的要执行的代码,不常用"></a>eval 只能用明确知道的要执行的代码,不常用</h1><h1 id="eval-–-有结果的简单计算"><a href="#eval-–-有结果的简单计算" class="headerlink" title="eval – 有结果的简单计算"></a>eval – 有结果的简单计算</h1><h1 id="exec-–-简单流程控制"><a href="#exec-–-简单流程控制" class="headerlink" title="exec – 简单流程控制"></a>exec – 简单流程控制</h1><h1 id="exec-‘print-123-’-123"><a href="#exec-‘print-123-’-123" class="headerlink" title="exec(‘print(123)’) # 123"></a>exec(‘print(123)’) # 123</h1><h1 id="eval-‘print-123-’-123"><a href="#eval-‘print-123-’-123" class="headerlink" title="eval(‘print(123)’) # 123"></a>eval(‘print(123)’) # 123</h1><h1 id="print-eval-‘1-2-3-4’-10"><a href="#print-eval-‘1-2-3-4’-10" class="headerlink" title="print(eval(‘1+2+3+4’)) # 10"></a>print(eval(‘1+2+3+4’)) # 10</h1><h1 id="print-exec-‘1-2-3-4’-None"><a href="#print-exec-‘1-2-3-4’-None" class="headerlink" title="print(exec(‘1+2+3+4’)) # None"></a>print(exec(‘1+2+3+4’)) # None</h1><h1 id="compile-把代码编译为字节码-下次调用节省时间"><a href="#compile-把代码编译为字节码-下次调用节省时间" class="headerlink" title="compile 把代码编译为字节码,下次调用节省时间,"></a>compile 把代码编译为字节码,下次调用节省时间,</h1><h1 id="code1-‘for-i-in-range-0-10-print-i-’"><a href="#code1-‘for-i-in-range-0-10-print-i-’" class="headerlink" title="code1 = ‘for i in range(0,10):print(i)’"></a>code1 = ‘for i in range(0,10):print(i)’</h1><h1 id="‘’-为文件名-没有的话置空"><a href="#‘’-为文件名-没有的话置空" class="headerlink" title="# ‘’ 为文件名,没有的话置空"></a># ‘’ 为文件名,没有的话置空</h1><h1 id="compile1-compile-code1-’’-’exec’"><a href="#compile1-compile-code1-’’-’exec’" class="headerlink" title="compile1 = compile(code1,’’,’exec’)"></a>compile1 = compile(code1,’’,’exec’)</h1><h1 id="code2-‘1-2-3-4’"><a href="#code2-‘1-2-3-4’" class="headerlink" title="code2 = ‘1+2+3+4’"></a>code2 = ‘1+2+3+4’</h1><h1 id="compile2-compile-code2-’’-’eval’"><a href="#compile2-compile-code2-’’-’eval’" class="headerlink" title="compile2 = compile(code2,’’,’eval’)"></a>compile2 = compile(code2,’’,’eval’)</h1><h1 id="print-eval-compile2"><a href="#print-eval-compile2" class="headerlink" title="print(eval(compile2))"></a>print(eval(compile2))</h1><h1 id="code3-‘name-input-“please-input-your-name-”-’"><a href="#code3-‘name-input-“please-input-your-name-”-’" class="headerlink" title="code3 = ‘name = input(“please input your name:”)’"></a>code3 = ‘name = input(“please input your name:”)’</h1><h1 id="compile3-compile-code3-’’-’single’"><a href="#compile3-compile-code3-’’-’single’" class="headerlink" title="compile3 = compile(code3,’’,’single’)"></a>compile3 = compile(code3,’’,’single’)</h1><h1 id="name-执行前name不存在"><a href="#name-执行前name不存在" class="headerlink" title="# name 执行前name不存在"></a># name 执行前name不存在</h1><h1 id="exec-compile3-执行后有name-虽然报错-但存在"><a href="#exec-compile3-执行后有name-虽然报错-但存在" class="headerlink" title="exec(compile3) # 执行后有name,虽然报错,但存在"></a>exec(compile3) # 执行后有name,虽然报错,但存在</h1><h1 id="print-name"><a href="#print-name" class="headerlink" title="print(name)"></a>print(name)</h1><h1 id="complex-复数-实部-虚部都是float"><a href="#complex-复数-实部-虚部都是float" class="headerlink" title="complex 复数 ,实部,虚部都是float"></a>complex 复数 ,实部,虚部都是float</h1><h1 id="print-complex-12-3-–-gt-12-3j"><a href="#print-complex-12-3-–-gt-12-3j" class="headerlink" title="print(complex(12,3)) # –&gt;12 + 3j"></a>print(complex(12,3)) # –&gt;12 + 3j</h1><p>“””<br>    实数<br>      有理数:小数,有限循环小数<br>      无理数:无线不循环小数<br>    虚数:x的平方式负数,i**2 = -1<br>    复数:实数+虚数,5+ni ,不能比较大小,<br>“””</p><h1 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h1><h1 id="print-float-12"><a href="#print-float-12" class="headerlink" title="print(float(12))"></a>print(float(12))</h1><p>“””<br>    354.123 = 3.45123<em>10**2=35.4123</em>10,点回浮动 所以叫浮点数<br>    float:有限循环,无限循环,<br>    不是float:无线不循环<br>“””</p><h1 id="进制转换-bin-0b-oct-0o-hex-0x"><a href="#进制转换-bin-0b-oct-0o-hex-0x" class="headerlink" title="进制转换 bin() 0b, oct() 0o,hex() 0x"></a>进制转换 bin() 0b, oct() 0o,hex() 0x</h1><h1 id="abs-n-绝对值"><a href="#abs-n-绝对值" class="headerlink" title="abs(n) 绝对值"></a>abs(n) 绝对值</h1><h1 id="divmod-x-y-–-gt-n-m-x-y-商n余m-print-divmod-8-2"><a href="#divmod-x-y-–-gt-n-m-x-y-商n余m-print-divmod-8-2" class="headerlink" title="divmod(x,y) –&gt;(n,m) x/y 商n余m,print(divmod(8,2))"></a>divmod(x,y) –&gt;(n,m) x/y 商n余m,print(divmod(8,2))</h1><h1 id="round-3-456879-2-精确值-会四舍五入"><a href="#round-3-456879-2-精确值-会四舍五入" class="headerlink" title="round(3.456879,2) 精确值,会四舍五入"></a>round(3.456879,2) 精确值,会四舍五入</h1><h1 id="pow-x-y-幂运算-pow-x-y-z-x-y-z-幂运算后取余"><a href="#pow-x-y-幂运算-pow-x-y-z-x-y-z-幂运算后取余" class="headerlink" title="pow(x,y) 幂运算 pow(x,y,z) x**y % z 幂运算后取余"></a>pow(x,y) 幂运算 pow(x,y,z) x**y % z 幂运算后取余</h1><h1 id="sum-可迭代-切里边是数字"><a href="#sum-可迭代-切里边是数字" class="headerlink" title="sum(可迭代,切里边是数字)"></a>sum(可迭代,切里边是数字)</h1><h1 id="print-sum-1-2-3-4-基础值为0-gt-10"><a href="#print-sum-1-2-3-4-基础值为0-gt-10" class="headerlink" title="print(sum([1,2,3,4])) 基础值为0 -&gt;10"></a>print(sum([1,2,3,4])) 基础值为0 -&gt;10</h1><h1 id="print-sum-1-2-3-4-10-基础值为10-gt-20"><a href="#print-sum-1-2-3-4-10-基础值为10-gt-20" class="headerlink" title="print(sum([1,2,3,4],10)) 基础值为10 -&gt; 20"></a>print(sum([1,2,3,4],10)) 基础值为10 -&gt; 20</h1><h1 id="min-最小值-可传迭代-也可-args"><a href="#min-最小值-可传迭代-也可-args" class="headerlink" title="min() 最小值,可传迭代,也可*args"></a>min() 最小值,可传迭代,也可*args</h1><h1 id="min-1-2-3-4"><a href="#min-1-2-3-4" class="headerlink" title="min([1,2,3,4])"></a>min([1,2,3,4])</h1><h1 id="min-1-2-3-4-1"><a href="#min-1-2-3-4-1" class="headerlink" title="min(1,2,3,4)"></a>min(1,2,3,4)</h1><h1 id="min-1-2-3-4-key-abs-可以-把key-用方法计算后求函数值"><a href="#min-1-2-3-4-key-abs-可以-把key-用方法计算后求函数值" class="headerlink" title="min(1,2,3,-4,key=abs) 可以 把key 用方法计算后求函数值"></a>min(1,2,3,-4,key=abs) 可以 把key 用方法计算后求函数值</h1><h1 id="max同min-注意-返回的是参数值-不是进过处理后的值"><a href="#max同min-注意-返回的是参数值-不是进过处理后的值" class="headerlink" title="max同min 注意,返回的是参数值,不是进过处理后的值"></a>max同min 注意,返回的是参数值,不是进过处理后的值</h1><h1 id="reversed-list-不改变原来列表-返回一个迭代器"><a href="#reversed-list-不改变原来列表-返回一个迭代器" class="headerlink" title="reversed(list) #不改变原来列表,返回一个迭代器"></a>reversed(list) #不改变原来列表,返回一个迭代器</h1><h1 id="l-slice-1-5-2-切片规则"><a href="#l-slice-1-5-2-切片规则" class="headerlink" title="l=slice(1,5,2) 切片规则"></a>l=slice(1,5,2) 切片规则</h1><h1 id="list-l"><a href="#list-l" class="headerlink" title="list[l]"></a>list[l]</h1><h1 id="formate-数字-gt-转字符串"><a href="#formate-数字-gt-转字符串" class="headerlink" title="formate(数字)-&gt;转字符串"></a>formate(数字)-&gt;转字符串</h1><h1 id="formate-‘test’-’-lt-20’-20空间-左对齐"><a href="#formate-‘test’-’-lt-20’-20空间-左对齐" class="headerlink" title="formate(‘test’,’&lt;20’) 20空间  左对齐"></a>formate(‘test’,’&lt;20’) 20空间  左对齐</h1><h1 id="formate-‘test’-’-gt-20’-右对齐"><a href="#formate-‘test’-’-gt-20’-右对齐" class="headerlink" title="formate(‘test’,’&gt;20’) 右对齐"></a>formate(‘test’,’&gt;20’) 右对齐</h1><h1 id="formate-‘test’-’-20’-居中"><a href="#formate-‘test’-’-20’-居中" class="headerlink" title="formate(‘test’,’^20’) 居中"></a>formate(‘test’,’^20’) 居中</h1><h1 id="等"><a href="#等" class="headerlink" title="等"></a>等</h1><h1 id="bytes-转换bytes类型"><a href="#bytes-转换bytes类型" class="headerlink" title="bytes 转换bytes类型"></a>bytes 转换bytes类型</h1><h1 id="拿到gbk-转unicode-再转到utf8"><a href="#拿到gbk-转unicode-再转到utf8" class="headerlink" title="拿到gbk 转unicode 再转到utf8"></a>拿到gbk 转unicode 再转到utf8</h1><h1 id="str-bytes-“你好”-encoding-”gbk”-unicode转gbk的bytes类型"><a href="#str-bytes-“你好”-encoding-”gbk”-unicode转gbk的bytes类型" class="headerlink" title="str = bytes(“你好”,encoding=”gbk”) # unicode转gbk的bytes类型"></a>str = bytes(“你好”,encoding=”gbk”) # unicode转gbk的bytes类型</h1><h1 id="str-decode-“gbk”-你好"><a href="#str-decode-“gbk”-你好" class="headerlink" title="str.decode(“gbk”) # 你好"></a>str.decode(“gbk”) # 你好</h1><h1 id="str-bytes-“你好”-encoding-”utf8”-unicode转utf8的bytes类型"><a href="#str-bytes-“你好”-encoding-”utf8”-unicode转utf8的bytes类型" class="headerlink" title="str = bytes(“你好”,encoding=”utf8”) # unicode转utf8的bytes类型"></a>str = bytes(“你好”,encoding=”utf8”) # unicode转utf8的bytes类型</h1><h1 id="str-decode-“utf8”-你好"><a href="#str-decode-“utf8”-你好" class="headerlink" title="str.decode(“utf8”) # 你好"></a>str.decode(“utf8”) # 你好</h1><h1 id="bytearray-“你好”-encoding-”utf8”-返回byte-列表-修改里边的16进制可实现更改"><a href="#bytearray-“你好”-encoding-”utf8”-返回byte-列表-修改里边的16进制可实现更改" class="headerlink" title="bytearray(“你好”,encoding=”utf8”) 返回byte 列表,修改里边的16进制可实现更改"></a>bytearray(“你好”,encoding=”utf8”) 返回byte 列表,修改里边的16进制可实现更改</h1><h1 id="ord-‘a’-查看编码-按照unicode"><a href="#ord-‘a’-查看编码-按照unicode" class="headerlink" title="ord(‘a’)查看编码 按照unicode"></a>ord(‘a’)查看编码 按照unicode</h1><h1 id="print-ord-‘段’"><a href="#print-ord-‘段’" class="headerlink" title="print(ord(‘段’))"></a>print(ord(‘段’))</h1><h1 id="print-chr-97"><a href="#print-chr-97" class="headerlink" title="print(chr(97))"></a>print(chr(97))</h1><h1 id="ascii-‘xxx’"><a href="#ascii-‘xxx’" class="headerlink" title="ascii(‘xxx’)"></a>ascii(‘xxx’)</h1><h1 id="s-r"><a href="#s-r" class="headerlink" title="%s,%r"></a>%s,%r</h1><h1 id="print-repr-‘1’-–-gt-‘1’"><a href="#print-repr-‘1’-–-gt-‘1’" class="headerlink" title="print(repr(‘1’)) # –&gt; ‘1’"></a>print(repr(‘1’)) # –&gt; ‘1’</h1><h1 id="print-repr-1-–-gt-1"><a href="#print-repr-1-–-gt-1" class="headerlink" title="print(repr(1)) # –&gt; 1"></a>print(repr(1)) # –&gt; 1</h1><h1 id="枚举-l-1-2-3-4-enum-enumerate-l"><a href="#枚举-l-1-2-3-4-enum-enumerate-l" class="headerlink" title="枚举 l = [1,2,3,4] enum = enumerate(l)"></a>枚举 l = [1,2,3,4] enum = enumerate(l)</h1><h1 id="all-判断里边字符是否全为True"><a href="#all-判断里边字符是否全为True" class="headerlink" title="all([]) 判断里边字符是否全为True"></a>all([]) 判断里边字符是否全为True</h1><h1 id="print-all-1-2-3-0"><a href="#print-all-1-2-3-0" class="headerlink" title="print(all([1,2,3,0]))"></a>print(all([1,2,3,0]))</h1><h1 id="any-看上边"><a href="#any-看上边" class="headerlink" title="any() 看上边"></a>any() 看上边</h1><h1 id="zip"><a href="#zip" class="headerlink" title="zip()"></a>zip()</h1><p>“””<br>    l = [1,2,3]<br>    l2 = [“a”,”b”,”c”]<br>    for i in zip(l,l2)   两边数可不同,开可以加l3,l4,若为字典(注意无序),只能加上key<br>        print(i) –&gt;(1,’a’) (2,’b’) (3,’c’)<br>“””</p><h1 id="filter-返回handler处理后的结果-bool"><a href="#filter-返回handler处理后的结果-bool" class="headerlink" title="filter(),返回handler处理后的结果,bool"></a>filter(),返回handler处理后的结果,bool</h1><h1 id="等于-i-for-i-in-1-2-3-4-5-if-i-2-1"><a href="#等于-i-for-i-in-1-2-3-4-5-if-i-2-1" class="headerlink" title="等于[i for i in [1,2,3,4,5] if i%2==1]"></a>等于[i for i in [1,2,3,4,5] if i%2==1]</h1><h1 id="ret-filter-handler-可迭代的元素-ret是迭代器"><a href="#ret-filter-handler-可迭代的元素-ret是迭代器" class="headerlink" title="ret = filter(handler,可迭代的元素) ret是迭代器"></a>ret = filter(handler,可迭代的元素) ret是迭代器</h1><h1 id="def-fun-x"><a href="#def-fun-x" class="headerlink" title="def fun(x):"></a>def fun(x):</h1><h1 id="return-x-2-1"><a href="#return-x-2-1" class="headerlink" title="return x%2==1"></a>return x%2==1</h1><h1 id="ref-filter-fun-1-2-3-4-5-6"><a href="#ref-filter-fun-1-2-3-4-5-6" class="headerlink" title="ref = filter(fun,[1,2,3,4,5,6])"></a>ref = filter(fun,[1,2,3,4,5,6])</h1><h1 id="print-list-ref-–-gt-1-3-5"><a href="#print-list-ref-–-gt-1-3-5" class="headerlink" title="print(list(ref)) –&gt; [1,3,5]"></a>print(list(ref)) –&gt; [1,3,5]</h1><h1 id="import-math"><a href="#import-math" class="headerlink" title="import math"></a>import math</h1><h1 id="print-math-sqrt-9"><a href="#print-math-sqrt-9" class="headerlink" title="print(math.sqrt(9))"></a>print(math.sqrt(9))</h1><h1 id="print-1-5-1"><a href="#print-1-5-1" class="headerlink" title="print(1.5%1)"></a>print(1.5%1)</h1><h1 id="map-fun-可迭代元素-分处理后-返回可迭代元素"><a href="#map-fun-可迭代元素-分处理后-返回可迭代元素" class="headerlink" title="map(fun,可迭代元素) 分处理后,返回可迭代元素"></a>map(fun,可迭代元素) 分处理后,返回可迭代元素</h1><h1 id="ret-map-abs-1-4-8"><a href="#ret-map-abs-1-4-8" class="headerlink" title="ret = map(abs,[1,-4,-8])"></a>ret = map(abs,[1,-4,-8])</h1><h1 id="sorted-可迭代元素-key-fun-reserve-True-自定义排序-返回新列表-元数据不变"><a href="#sorted-可迭代元素-key-fun-reserve-True-自定义排序-返回新列表-元数据不变" class="headerlink" title="sorted(可迭代元素,key=fun,reserve=True) 自定义排序,返回新列表,元数据不变"></a>sorted(可迭代元素,key=fun,reserve=True) 自定义排序,返回新列表,元数据不变</h1><h1 id="l-sort-key-abs-按绝对值排序"><a href="#l-sort-key-abs-按绝对值排序" class="headerlink" title="l.sort(key=abs) 按绝对值排序"></a>l.sort(key=abs) 按绝对值排序</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">匿名函数</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 匿名函数#   必须在一行,#   lamdba 定义,n,m参数,冒号后边直接是返回值calc = lambda n,m:m*n+2#   调用,还可以有名字, 匿名的时候对于函数名做参数时使用#   max([],key=lambda k:xxx)# max,min,sorted,filter,mapprint(calc(1,2))# 面试题#现有两元组(('a'),('b')),(('c'),('d')),# 请使用python中匿名函数生成列表[{'a':'c'},{'b':'d'}]# ret = zip((('a'),('b')),(('c'),('d')))# ret = map(lambda t:{t[0]:t[1]},ret)# print(list(ret))<h1 id="max-min-sorted-filter-map"><a href="#max-min-sorted-filter-map" class="headerlink" title="max min sorted filter map"></a>max min sorted filter map</h1><h1 id="匿名函数-内置函数"><a href="#匿名函数-内置函数" class="headerlink" title="匿名函数 == 内置函数"></a>匿名函数 == 内置函数</h1><h1 id="zip-1"><a href="#zip-1" class="headerlink" title="zip"></a>zip</h1><h1 id="ret-zip-‘a’-‘b’-‘c’-‘d’"><a href="#ret-zip-‘a’-‘b’-‘c’-‘d’" class="headerlink" title="ret = zip(((‘a’),(‘b’)),((‘c’),(‘d’)))"></a>ret = zip(((‘a’),(‘b’)),((‘c’),(‘d’)))</h1><h1 id="res-map-lambda-tup-tup-0-tup-1-ret"><a href="#res-map-lambda-tup-tup-0-tup-1-ret" class="headerlink" title="res = map(lambda tup:{tup[0]:tup[1]},ret)"></a>res = map(lambda tup:{tup[0]:tup[1]},ret)</h1><h1 id="print-list-res"><a href="#print-list-res" class="headerlink" title="print(list(res))"></a>print(list(res))</h1><h1 id="下面代码的输出结果是什么"><a href="#下面代码的输出结果是什么" class="headerlink" title="下面代码的输出结果是什么?"></a>下面代码的输出结果是什么?</h1><h1 id="def-multipliers"><a href="#def-multipliers" class="headerlink" title="def multipliers():"></a>def multipliers():</h1><h1 id="return-lambda-x-i-x-for-i-in-range-4-返回4个lambda-但最后i最后都是3"><a href="#return-lambda-x-i-x-for-i-in-range-4-返回4个lambda-但最后i最后都是3" class="headerlink" title="return [lambda x:i*x for i in range(4)] # 返回4个lambda ,但最后i最后都是3"></a>return [lambda x:i*x for i in range(4)] # 返回4个lambda ,但最后i最后都是3</h1><h1 id="print-m-2-for-m-in-multipliers-6-6-6-6"><a href="#print-m-2-for-m-in-multipliers-6-6-6-6" class="headerlink" title="print([m(2) for m in multipliers()]) [6,6,6,6]"></a>print([m(2) for m in multipliers()]) [6,6,6,6]</h1><h1 id="return-lambda-x-i-x-for-i-in-range-4-生成器"><a href="#return-lambda-x-i-x-for-i-in-range-4-生成器" class="headerlink" title="return (lambda x:i*x for i in range(4)) 生成器,"></a>return (lambda x:i*x for i in range(4)) 生成器,</h1><h1 id="—-gt-0-2-4-6"><a href="#—-gt-0-2-4-6" class="headerlink" title="—&gt;[0,2,4,6]"></a>—&gt;[0,2,4,6]</h1><h1 id="作业-1"><a href="#作业-1" class="headerlink" title="作业"></a>作业</h1><h1 id="3-用map来处理字符串列表-把列表中所有人都变成sb-比方alex-sb"><a href="#3-用map来处理字符串列表-把列表中所有人都变成sb-比方alex-sb" class="headerlink" title="3.用map来处理字符串列表,把列表中所有人都变成sb,比方alex_sb"></a>3.用map来处理字符串列表,把列表中所有人都变成sb,比方alex_sb</h1><p>name=[‘alex’,’wupeiqi’,’yuanhao’,’nezha’]</p><h1 id="def-func-item"><a href="#def-func-item" class="headerlink" title="def func(item):"></a>def func(item):</h1><h1 id="return-item-’-sb’"><a href="#return-item-’-sb’" class="headerlink" title="return item+’_sb’"></a>return item+’_sb’</h1><h1 id="ret-map-func-name-ret是迭代器"><a href="#ret-map-func-name-ret是迭代器" class="headerlink" title="ret = map(func,name)   #ret是迭代器"></a>ret = map(func,name)   #ret是迭代器</h1><h1 id="for-i-in-ret"><a href="#for-i-in-ret" class="headerlink" title="for i in ret:"></a>for i in ret:</h1><h1 id="print-i-1"><a href="#print-i-1" class="headerlink" title="print(i)"></a>print(i)</h1><h1 id="print-list-ret"><a href="#print-list-ret" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="ret-map-lambda-item-item-’-sb’-name"><a href="#ret-map-lambda-item-item-’-sb’-name" class="headerlink" title="ret = map(lambda item:item+’_sb’,name)"></a>ret = map(lambda item:item+’_sb’,name)</h1><h1 id="print-list-ret-1"><a href="#print-list-ret-1" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="4-用filter函数处理数字列表，将列表中所有的偶数筛选出来"><a href="#4-用filter函数处理数字列表，将列表中所有的偶数筛选出来" class="headerlink" title="4.用filter函数处理数字列表，将列表中所有的偶数筛选出来"></a>4.用filter函数处理数字列表，将列表中所有的偶数筛选出来</h1><h1 id="num-1-3-5-6-7-8"><a href="#num-1-3-5-6-7-8" class="headerlink" title="num = [1,3,5,6,7,8]"></a>num = [1,3,5,6,7,8]</h1><h1 id="def-func-x"><a href="#def-func-x" class="headerlink" title="def func(x):"></a>def func(x):</h1><h1 id="if-x-2-0"><a href="#if-x-2-0" class="headerlink" title="if x%2 == 0:"></a>if x%2 == 0:</h1><h1 id="return-True"><a href="#return-True" class="headerlink" title="return True"></a>return True</h1><h1 id="ret-filter-func-num-ret是迭代器"><a href="#ret-filter-func-num-ret是迭代器" class="headerlink" title="ret = filter(func,num)  #ret是迭代器"></a>ret = filter(func,num)  #ret是迭代器</h1><h1 id="print-list-ret-2"><a href="#print-list-ret-2" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="-8"><a href="#-8" class="headerlink" title=""></a></h1><h1 id="ret-filter-lambda-x-x-2-0-num"><a href="#ret-filter-lambda-x-x-2-0-num" class="headerlink" title="ret = filter(lambda x:x%2 == 0,num)"></a>ret = filter(lambda x:x%2 == 0,num)</h1><h1 id="ret-filter-lambda-x-True-if-x-2-0-else-False-num"><a href="#ret-filter-lambda-x-True-if-x-2-0-else-False-num" class="headerlink" title="ret = filter(lambda x:True if x%2 == 0 else False,num)"></a>ret = filter(lambda x:True if x%2 == 0 else False,num)</h1><h1 id="print-list-ret-3"><a href="#print-list-ret-3" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="5-随意写一个20行以上的文件"><a href="#5-随意写一个20行以上的文件" class="headerlink" title="5.随意写一个20行以上的文件"></a>5.随意写一个20行以上的文件</h1><h1 id="运行程序，先将内容读到内存中，用列表存储。"><a href="#运行程序，先将内容读到内存中，用列表存储。" class="headerlink" title="运行程序，先将内容读到内存中，用列表存储。"></a>运行程序，先将内容读到内存中，用列表存储。</h1><h1 id="接收用户输入页码，每页5条，仅输出当页的内容"><a href="#接收用户输入页码，每页5条，仅输出当页的内容" class="headerlink" title="接收用户输入页码，每页5条，仅输出当页的内容"></a>接收用户输入页码，每页5条，仅输出当页的内容</h1><h1 id="with-open-‘file’-encoding-’utf-8’-as-f"><a href="#with-open-‘file’-encoding-’utf-8’-as-f" class="headerlink" title="with open(‘file’,encoding=’utf-8’) as f:"></a>with open(‘file’,encoding=’utf-8’) as f:</h1><h1 id="l-f-readlines"><a href="#l-f-readlines" class="headerlink" title="l = f.readlines()"></a>l = f.readlines()</h1><h1 id="page-num-int-input-‘请输入页码-：-‘"><a href="#page-num-int-input-‘请输入页码-：-‘" class="headerlink" title="page_num = int(input(‘请输入页码 ： ‘))"></a>page_num = int(input(‘请输入页码 ： ‘))</h1><h1 id="pages-mod-divmod-len-l-5-求有多少页，有没有剩余的行数"><a href="#pages-mod-divmod-len-l-5-求有多少页，有没有剩余的行数" class="headerlink" title="pages,mod = divmod(len(l),5) #求有多少页，有没有剩余的行数"></a>pages,mod = divmod(len(l),5) #求有多少页，有没有剩余的行数</h1><h1 id="if-mod-如果有剩余的行数，那么页数加一"><a href="#if-mod-如果有剩余的行数，那么页数加一" class="headerlink" title="if mod:           # 如果有剩余的行数，那么页数加一"></a>if mod:           # 如果有剩余的行数，那么页数加一</h1><h1 id="pages-1-一共有多少页"><a href="#pages-1-一共有多少页" class="headerlink" title="pages += 1    # 一共有多少页"></a>pages += 1    # 一共有多少页</h1><h1 id="if-page-num-gt-pages-or-page-num-lt-0-用户输入的页数大于总数或者小于等于0"><a href="#if-page-num-gt-pages-or-page-num-lt-0-用户输入的页数大于总数或者小于等于0" class="headerlink" title="if page_num &gt; pages or page_num &lt;= 0:   #用户输入的页数大于总数或者小于等于0"></a>if page_num &gt; pages or page_num &lt;= 0:   #用户输入的页数大于总数或者小于等于0</h1><h1 id="print-‘输入有误’"><a href="#print-‘输入有误’" class="headerlink" title="print(‘输入有误’)"></a>print(‘输入有误’)</h1><h1 id="elif-page-num-pages-and-mod-0-如果用户输入的页码是最后一页，且之前有过剩余行数"><a href="#elif-page-num-pages-and-mod-0-如果用户输入的页码是最后一页，且之前有过剩余行数" class="headerlink" title="elif page_num == pages and mod !=0:    #如果用户输入的页码是最后一页，且之前有过剩余行数"></a>elif page_num == pages and mod !=0:    #如果用户输入的页码是最后一页，且之前有过剩余行数</h1><h1 id="for-i-in-range-mod"><a href="#for-i-in-range-mod" class="headerlink" title="for i in range(mod):"></a>for i in range(mod):</h1><h1 id="print-l-page-num-1-5-i-strip-只输出这一页上剩余的行"><a href="#print-l-page-num-1-5-i-strip-只输出这一页上剩余的行" class="headerlink" title="print(l[(page_num-1)*5 +i].strip())  #只输出这一页上剩余的行"></a>print(l[(page_num-1)*5 +i].strip())  #只输出这一页上剩余的行</h1><h1 id="else"><a href="#else" class="headerlink" title="else:"></a>else:</h1><h1 id="for-i-in-range-5"><a href="#for-i-in-range-5" class="headerlink" title="for i in range(5):"></a>for i in range(5):</h1><h1 id="print-l-page-num-1-5-i-strip-输出5行"><a href="#print-l-page-num-1-5-i-strip-输出5行" class="headerlink" title="print(l[(page_num-1)*5 +i].strip())  #输出5行"></a>print(l[(page_num-1)*5 +i].strip())  #输出5行</h1><h1 id="6-如下，每个小字典的name对应股票名字，shares对应多少股，price对应股票的价格"><a href="#6-如下，每个小字典的name对应股票名字，shares对应多少股，price对应股票的价格" class="headerlink" title="6.如下，每个小字典的name对应股票名字，shares对应多少股，price对应股票的价格"></a>6.如下，每个小字典的name对应股票名字，shares对应多少股，price对应股票的价格</h1><h1 id="portfolio"><a href="#portfolio" class="headerlink" title="portfolio = ["></a>portfolio = [</h1><h1 id="‘name’-‘IBM’-‘shares’-100-‘price’-91-1"><a href="#‘name’-‘IBM’-‘shares’-100-‘price’-91-1" class="headerlink" title="{‘name’: ‘IBM’, ‘shares’: 100, ‘price’: 91.1},"></a>{‘name’: ‘IBM’, ‘shares’: 100, ‘price’: 91.1},</h1><h1 id="‘name’-‘AAPL’-‘shares’-50-‘price’-543-22"><a href="#‘name’-‘AAPL’-‘shares’-50-‘price’-543-22" class="headerlink" title="{‘name’: ‘AAPL’, ‘shares’: 50, ‘price’: 543.22},"></a>{‘name’: ‘AAPL’, ‘shares’: 50, ‘price’: 543.22},</h1><h1 id="‘name’-‘FB’-‘shares’-200-‘price’-21-09"><a href="#‘name’-‘FB’-‘shares’-200-‘price’-21-09" class="headerlink" title="{‘name’: ‘FB’, ‘shares’: 200, ‘price’: 21.09},"></a>{‘name’: ‘FB’, ‘shares’: 200, ‘price’: 21.09},</h1><h1 id="‘name’-‘HPQ’-‘shares’-35-‘price’-31-75"><a href="#‘name’-‘HPQ’-‘shares’-35-‘price’-31-75" class="headerlink" title="{‘name’: ‘HPQ’, ‘shares’: 35, ‘price’: 31.75},"></a>{‘name’: ‘HPQ’, ‘shares’: 35, ‘price’: 31.75},</h1><h1 id="‘name’-‘YHOO’-‘shares’-45-‘price’-16-35"><a href="#‘name’-‘YHOO’-‘shares’-45-‘price’-16-35" class="headerlink" title="{‘name’: ‘YHOO’, ‘shares’: 45, ‘price’: 16.35},"></a>{‘name’: ‘YHOO’, ‘shares’: 45, ‘price’: 16.35},</h1><h1 id="‘name’-‘ACME’-‘shares’-75-‘price’-115-65"><a href="#‘name’-‘ACME’-‘shares’-75-‘price’-115-65" class="headerlink" title="{‘name’: ‘ACME’, ‘shares’: 75, ‘price’: 115.65}"></a>{‘name’: ‘ACME’, ‘shares’: 75, ‘price’: 115.65}</h1><h1 id="-9"><a href="#-9" class="headerlink" title="]"></a>]</h1><h1 id="6-1-计算购买每支股票的总价"><a href="#6-1-计算购买每支股票的总价" class="headerlink" title="6.1.计算购买每支股票的总价"></a>6.1.计算购买每支股票的总价</h1><h1 id="ret-map-lambda-dic-dic-‘name’-round-dic-‘shares’-dic-‘price’-2-portfolio"><a href="#ret-map-lambda-dic-dic-‘name’-round-dic-‘shares’-dic-‘price’-2-portfolio" class="headerlink" title="ret = map(lambda dic : {dic[‘name’]:round(dic[‘shares’]*dic[‘price’],2)},portfolio)"></a>ret = map(lambda dic : {dic[‘name’]:round(dic[‘shares’]*dic[‘price’],2)},portfolio)</h1><h1 id="print-list-ret-4"><a href="#print-list-ret-4" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="6-2-用filter过滤出，单价大于100的股票有哪些"><a href="#6-2-用filter过滤出，单价大于100的股票有哪些" class="headerlink" title="6.2.用filter过滤出，单价大于100的股票有哪些"></a>6.2.用filter过滤出，单价大于100的股票有哪些</h1><h1 id="ret-filter-lambda-dic-True-if-dic-‘price’-gt-100-else-False-portfolio"><a href="#ret-filter-lambda-dic-True-if-dic-‘price’-gt-100-else-False-portfolio" class="headerlink" title="ret = filter(lambda dic:True if dic[‘price’] &gt; 100 else False,portfolio)"></a>ret = filter(lambda dic:True if dic[‘price’] &gt; 100 else False,portfolio)</h1><h1 id="print-list-ret-5"><a href="#print-list-ret-5" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="ret-filter-lambda-dic-dic-‘price’-gt-100-portfolio"><a href="#ret-filter-lambda-dic-dic-‘price’-gt-100-portfolio" class="headerlink" title="ret = filter(lambda dic:dic[‘price’] &gt; 100,portfolio)"></a>ret = filter(lambda dic:dic[‘price’] &gt; 100,portfolio)</h1><h1 id="print-list-ret-6"><a href="#print-list-ret-6" class="headerlink" title="print(list(ret))"></a>print(list(ret))</h1><h1 id="每周大作业"><a href="#每周大作业" class="headerlink" title="每周大作业"></a>每周大作业</h1><h1 id="这一周写得所有博客地址，精确到页的url，至少三篇，内容不限"><a href="#这一周写得所有博客地址，精确到页的url，至少三篇，内容不限" class="headerlink" title="这一周写得所有博客地址，精确到页的url，至少三篇，内容不限"></a>这一周写得所有博客地址，精确到页的url，至少三篇，内容不限</h1><h1 id="大作业-：-py-readme（对作业描述，顺便可以写点儿你想和导员沟通的）-流程图"><a href="#大作业-：-py-readme（对作业描述，顺便可以写点儿你想和导员沟通的）-流程图" class="headerlink" title="大作业 ： py readme（对作业描述，顺便可以写点儿你想和导员沟通的） 流程图"></a>大作业 ： py readme（对作业描述，顺便可以写点儿你想和导员沟通的） 流程图</h1><h1 id="-10"><a href="#-10" class="headerlink" title=""></a></h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">初识递归</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 初识递归 最大深度1000左右 997 或998# 设置默认次数# import sys# sys.setrecursionlimit(100)# 若递归次数太多,则不适合递归<h1 id="二分查找算法-必须处理有序的列表"><a href="#二分查找算法-必须处理有序的列表" class="headerlink" title="二分查找算法 必须处理有序的列表"></a>二分查找算法 必须处理有序的列表</h1><h1 id="l-2-3-5-10-15-16-18-22-26-30-32-35-41-42-43-55-56-66-67-69-72-76-82-83-88"><a href="#l-2-3-5-10-15-16-18-22-26-30-32-35-41-42-43-55-56-66-67-69-72-76-82-83-88" class="headerlink" title="l = [2,3,5,10,15,16,18,22,26,30,32,35,41,42,43,55,56,66,67,69,72,76,82,83,88]"></a>l = [2,3,5,10,15,16,18,22,26,30,32,35,41,42,43,55,56,66,67,69,72,76,82,83,88]</h1><h1 id="5000000-4999998"><a href="#5000000-4999998" class="headerlink" title="5000000  4999998"></a>5000000  4999998</h1><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h1 id="def-find-l-aim"><a href="#def-find-l-aim" class="headerlink" title="def find(l,aim):"></a>def find(l,aim):</h1><h1 id="mid-index-len-l-2"><a href="#mid-index-len-l-2" class="headerlink" title="mid_index = len(l) // 2"></a>mid_index = len(l) // 2</h1><h1 id="if-l-mid-index-lt-aim"><a href="#if-l-mid-index-lt-aim" class="headerlink" title="if l[mid_index] &lt; aim:"></a>if l[mid_index] &lt; aim:</h1><h1 id="new-l-l-mid-index-1-每次传入新列表-最终查到时下标不对"><a href="#new-l-l-mid-index-1-每次传入新列表-最终查到时下标不对" class="headerlink" title="new_l = l[mid_index+1 :] 每次传入新列表,最终查到时下标不对"></a>new_l = l[mid_index+1 :] 每次传入新列表,最终查到时下标不对</h1><h1 id="find-new-l-aim"><a href="#find-new-l-aim" class="headerlink" title="find(new_l,aim)"></a>find(new_l,aim)</h1><h1 id="elif-l-mid-index-gt-aim"><a href="#elif-l-mid-index-gt-aim" class="headerlink" title="elif l[mid_index] &gt; aim:"></a>elif l[mid_index] &gt; aim:</h1><h1 id="new-l-l-mid-index"><a href="#new-l-l-mid-index" class="headerlink" title="new_l = l[:mid_index]"></a>new_l = l[:mid_index]</h1><h1 id="find-new-l-aim-1"><a href="#find-new-l-aim-1" class="headerlink" title="find(new_l, aim)"></a>find(new_l, aim)</h1><h1 id="else-1"><a href="#else-1" class="headerlink" title="else:"></a>else:</h1><h1 id="print-‘找到了’-mid-index-l-mid-index"><a href="#print-‘找到了’-mid-index-l-mid-index" class="headerlink" title="print(‘找到了’,mid_index,l[mid_index])"></a>print(‘找到了’,mid_index,l[mid_index])</h1><h1 id="-11"><a href="#-11" class="headerlink" title=""></a></h1><h1 id="find-l-66"><a href="#find-l-66" class="headerlink" title="find(l,66)"></a>find(l,66)</h1><p>l = [2,3,5,10,15,16,18,22,26,30,32,35,41,42,43,55,56,66,67,69,72,76,82,83,88]</p><h1 id="def-find-l-aim-start-0-end-None"><a href="#def-find-l-aim-start-0-end-None" class="headerlink" title="def find(l,aim,start = 0,end = None):"></a>def find(l,aim,start = 0,end = None):</h1><h1 id="end-len-l-if-end-is-None-else-end-end-len-l-24"><a href="#end-len-l-if-end-is-None-else-end-end-len-l-24" class="headerlink" title="end = len(l) if end is None else end   # end = len(l)   24"></a>end = len(l) if end is None else end   # end = len(l)   24</h1><h1 id="mid-index-end-start-2-start-计算中间值-12-0-12"><a href="#mid-index-end-start-2-start-计算中间值-12-0-12" class="headerlink" title="mid_index = (end - start)//2 + start   #计算中间值  12 + 0 = 12"></a>mid_index = (end - start)//2 + start   #计算中间值  12 + 0 = 12</h1><h1 id="if-l-mid-index-lt-aim-l-12-lt-44-41-lt-44"><a href="#if-l-mid-index-lt-aim-l-12-lt-44-41-lt-44" class="headerlink" title="if l[mid_index] &lt; aim:       #l[12] &lt; 44   #41 &lt; 44"></a>if l[mid_index] &lt; aim:       #l[12] &lt; 44   #41 &lt; 44</h1><h1 id="find-l-aim-start-mid-index-1-end-end-find-l-44-start-13-end-24"><a href="#find-l-aim-start-mid-index-1-end-end-find-l-44-start-13-end-24" class="headerlink" title="find(l,aim,start =mid_index+1,end=end)  # find(l,44,start=13,end=24)"></a>find(l,aim,start =mid_index+1,end=end)  # find(l,44,start=13,end=24)</h1><h1 id="elif-l-mid-index-gt-aim-1"><a href="#elif-l-mid-index-gt-aim-1" class="headerlink" title="elif l[mid_index] &gt; aim:"></a>elif l[mid_index] &gt; aim:</h1><h1 id="find-l-aim-start-start-end-mid-index-1"><a href="#find-l-aim-start-start-end-mid-index-1" class="headerlink" title="find(l, aim, start=start, end=mid_index-1)"></a>find(l, aim, start=start, end=mid_index-1)</h1><h1 id="else-2"><a href="#else-2" class="headerlink" title="else:"></a>else:</h1><h1 id="print-‘找到了’-mid-index-aim"><a href="#print-‘找到了’-mid-index-aim" class="headerlink" title="print(‘找到了’,mid_index,aim)"></a>print(‘找到了’,mid_index,aim)</h1><h1 id="-12"><a href="#-12" class="headerlink" title=""></a></h1><h1 id="def-find-l-aim-start-0-end-None-l-44-start-13-end-24"><a href="#def-find-l-aim-start-0-end-None-l-44-start-13-end-24" class="headerlink" title="def find(l,aim,start = 0,end = None):    # l,44,start=13,end=24"></a>def find(l,aim,start = 0,end = None):    # l,44,start=13,end=24</h1><h1 id="end-len-l-if-end-is-None-else-end-end-24"><a href="#end-len-l-if-end-is-None-else-end-end-24" class="headerlink" title="end = len(l) if end is None else end   # end = 24"></a>end = len(l) if end is None else end   # end = 24</h1><h1 id="mid-index-end-start-2-start-计算中间值-24-13-2-5-13-18"><a href="#mid-index-end-start-2-start-计算中间值-24-13-2-5-13-18" class="headerlink" title="mid_index = (end - start)//2 + start   #计算中间值  24-13/2 = 5 + 13 = 18"></a>mid_index = (end - start)//2 + start   #计算中间值  24-13/2 = 5 + 13 = 18</h1><h1 id="if-l-mid-index-lt-aim-l-18-lt-44-67-lt-44"><a href="#if-l-mid-index-lt-aim-l-18-lt-44-67-lt-44" class="headerlink" title="if l[mid_index] &lt; aim:       #l[18] &lt; 44   #67 &lt; 44"></a>if l[mid_index] &lt; aim:       #l[18] &lt; 44   #67 &lt; 44</h1><h1 id="find-l-aim-start-mid-index-1-end-end"><a href="#find-l-aim-start-mid-index-1-end-end" class="headerlink" title="find(l,aim,start =mid_index+1,end=end)"></a>find(l,aim,start =mid_index+1,end=end)</h1><h1 id="elif-l-mid-index-gt-aim-67-gt-44"><a href="#elif-l-mid-index-gt-aim-67-gt-44" class="headerlink" title="elif l[mid_index] &gt; aim:     # 67 &gt; 44"></a>elif l[mid_index] &gt; aim:     # 67 &gt; 44</h1><h1 id="find-l-aim-start-start-end-mid-index-1-find-l-44-start-13-end-17"><a href="#find-l-aim-start-start-end-mid-index-1-find-l-44-start-13-end-17" class="headerlink" title="find(l, aim, start=start, end=mid_index-1)  # find(l,44,start=13,end=17)"></a>find(l, aim, start=start, end=mid_index-1)  # find(l,44,start=13,end=17)</h1><h1 id="else-3"><a href="#else-3" class="headerlink" title="else:"></a>else:</h1><h1 id="print-‘找到了’-mid-index-aim-1"><a href="#print-‘找到了’-mid-index-aim-1" class="headerlink" title="print(‘找到了’,mid_index,aim)"></a>print(‘找到了’,mid_index,aim)</h1><h1 id="-13"><a href="#-13" class="headerlink" title=""></a></h1><h1 id="def-find-l-aim-start-0-end-None-l-44-start-13-end-17"><a href="#def-find-l-aim-start-0-end-None-l-44-start-13-end-17" class="headerlink" title="def find(l,aim,start = 0,end = None):    # l,44,start=13,end=17"></a>def find(l,aim,start = 0,end = None):    # l,44,start=13,end=17</h1><h1 id="end-len-l-if-end-is-None-else-end-end-17"><a href="#end-len-l-if-end-is-None-else-end-end-17" class="headerlink" title="end = len(l) if end is None else end   # end = 17"></a>end = len(l) if end is None else end   # end = 17</h1><h1 id="mid-index-end-start-2-start-计算中间值-17-13-2-2-13-15"><a href="#mid-index-end-start-2-start-计算中间值-17-13-2-2-13-15" class="headerlink" title="mid_index = (end - start)//2 + start   #计算中间值  17-13/2 = 2 + 13 = 15"></a>mid_index = (end - start)//2 + start   #计算中间值  17-13/2 = 2 + 13 = 15</h1><h1 id="if-l-mid-index-lt-aim-l-15-lt-44-55-lt-44"><a href="#if-l-mid-index-lt-aim-l-15-lt-44-55-lt-44" class="headerlink" title="if l[mid_index] &lt; aim:       #l[15] &lt; 44   #55 &lt; 44"></a>if l[mid_index] &lt; aim:       #l[15] &lt; 44   #55 &lt; 44</h1><h1 id="find-l-aim-start-mid-index-1-end-end-1"><a href="#find-l-aim-start-mid-index-1-end-end-1" class="headerlink" title="find(l,aim,start =mid_index+1,end=end)"></a>find(l,aim,start =mid_index+1,end=end)</h1><h1 id="elif-l-mid-index-gt-aim-55-gt-44"><a href="#elif-l-mid-index-gt-aim-55-gt-44" class="headerlink" title="elif l[mid_index] &gt; aim:     # 55 &gt; 44"></a>elif l[mid_index] &gt; aim:     # 55 &gt; 44</h1><h1 id="find-l-aim-start-start-end-mid-index-1-find-l-44-start-13-end-14"><a href="#find-l-aim-start-start-end-mid-index-1-find-l-44-start-13-end-14" class="headerlink" title="find(l, aim, start=start, end=mid_index-1)  # find(l,44,start=13,end=14)"></a>find(l, aim, start=start, end=mid_index-1)  # find(l,44,start=13,end=14)</h1><h1 id="else-4"><a href="#else-4" class="headerlink" title="else:"></a>else:</h1><h1 id="print-‘找到了’-mid-index-aim-2"><a href="#print-‘找到了’-mid-index-aim-2" class="headerlink" title="print(‘找到了’,mid_index,aim)"></a>print(‘找到了’,mid_index,aim)</h1><h1 id="-14"><a href="#-14" class="headerlink" title=""></a></h1><h1 id="def-find-l-aim-start-0-end-None-l-44-start-13-end-14"><a href="#def-find-l-aim-start-0-end-None-l-44-start-13-end-14" class="headerlink" title="def find(l,aim,start = 0,end = None):    # l,44,start=13,end=14"></a>def find(l,aim,start = 0,end = None):    # l,44,start=13,end=14</h1><h1 id="end-len-l-if-end-is-None-else-end-end-14"><a href="#end-len-l-if-end-is-None-else-end-end-14" class="headerlink" title="end = len(l) if end is None else end   # end = 14"></a>end = len(l) if end is None else end   # end = 14</h1><h1 id="mid-index-end-start-2-start-计算中间值-14-13-2-0-13-13"><a href="#mid-index-end-start-2-start-计算中间值-14-13-2-0-13-13" class="headerlink" title="mid_index = (end - start)//2 + start   #计算中间值  14-13/2 = 0+ 13 = 13"></a>mid_index = (end - start)//2 + start   #计算中间值  14-13/2 = 0+ 13 = 13</h1><h1 id="if-l-mid-index-lt-aim-l-13-lt-44-42-lt-44"><a href="#if-l-mid-index-lt-aim-l-13-lt-44-42-lt-44" class="headerlink" title="if l[mid_index] &lt; aim:       #l[13] &lt; 44   #42 &lt; 44"></a>if l[mid_index] &lt; aim:       #l[13] &lt; 44   #42 &lt; 44</h1><h1 id="find-l-aim-start-mid-index-1-end-end-find-l-44-start-14-end-14"><a href="#find-l-aim-start-mid-index-1-end-end-find-l-44-start-14-end-14" class="headerlink" title="find(l,aim,start =mid_index+1,end=end)  # find(l,44,start=14,end=14)"></a>find(l,aim,start =mid_index+1,end=end)  # find(l,44,start=14,end=14)</h1><h1 id="elif-l-mid-index-gt-aim-42-gt-44"><a href="#elif-l-mid-index-gt-aim-42-gt-44" class="headerlink" title="elif l[mid_index] &gt; aim:     # 42 &gt; 44"></a>elif l[mid_index] &gt; aim:     # 42 &gt; 44</h1><h1 id="find-l-aim-start-start-end-mid-index-1-1"><a href="#find-l-aim-start-start-end-mid-index-1-1" class="headerlink" title="find(l, aim, start=start, end=mid_index-1)"></a>find(l, aim, start=start, end=mid_index-1)</h1><h1 id="else-5"><a href="#else-5" class="headerlink" title="else:"></a>else:</h1><h1 id="print-‘找到了’-mid-index-aim-3"><a href="#print-‘找到了’-mid-index-aim-3" class="headerlink" title="print(‘找到了’,mid_index,aim)"></a>print(‘找到了’,mid_index,aim)</h1><p>def find(l,aim,start = 0,end = None):<br>    end = len(l) if end is None else end<br>    mid_index = (end - start)//2 + start<br>    if start &lt;= end:<br>        if l[mid_index] &lt; aim:<br>            return find(l,aim,start =mid_index+1,end=end)<br>        elif l[mid_index] &gt; aim:<br>            return find(l, aim, start=start, end=mid_index-1)<br>        else:<br>            return mid_index<br>    else:<br>        return ‘找不到这个值’</p><p>ret= find(l,44)<br>print(ret)</p><h1 id="参数-end"><a href="#参数-end" class="headerlink" title="参数 end"></a>参数 end</h1><h1 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h1><h1 id="找不到的话怎么办"><a href="#找不到的话怎么办" class="headerlink" title="找不到的话怎么办"></a>找不到的话怎么办</h1><h1 id="l-index"><a href="#l-index" class="headerlink" title="l.index()"></a>l.index()</h1><h1 id="67-发生两次调用"><a href="#67-发生两次调用" class="headerlink" title="67  发生两次调用"></a>67  发生两次调用</h1><h1 id="66-发生好几次"><a href="#66-发生好几次" class="headerlink" title="66  发生好几次"></a>66  发生好几次</h1><h1 id="44-找不到"><a href="#44-找不到" class="headerlink" title="44  找不到"></a>44  找不到</h1><h1 id="age，二分查找，三级菜单的代码看一遍"><a href="#age，二分查找，三级菜单的代码看一遍" class="headerlink" title="age，二分查找，三级菜单的代码看一遍"></a>age，二分查找，三级菜单的代码看一遍</h1><h1 id="斐波那契-问第n个斐波那契数是多少"><a href="#斐波那契-问第n个斐波那契数是多少" class="headerlink" title="斐波那契  # 问第n个斐波那契数是多少"></a>斐波那契  # 问第n个斐波那契数是多少</h1><h1 id="阶乘"><a href="#阶乘" class="headerlink" title="阶乘"></a>阶乘</h1><pre><code class="hljs">#3！ 3*2*1</code></pre></div><h1 id="附加题-：考试附加题"><a href="#附加题-：考试附加题" class="headerlink" title="附加题 ：考试附加题"></a>附加题 ：考试附加题</h1><div class="code-wrapper"><pre><code class="hljs"># 递归实现</code></pre></div><h1 id="l-1-2-3"><a href="#l-1-2-3" class="headerlink" title="l = [1,2,3]"></a>l = [1,2,3]</h1><h1 id="print-l-1-1"><a href="#print-l-1-1" class="headerlink" title="print(l[1:1])"></a>print(l[1:1])</h1><h1 id="超过最大递归限制的报错"><a href="#超过最大递归限制的报错" class="headerlink" title="超过最大递归限制的报错"></a>超过最大递归限制的报错</h1><h1 id="只要写递归函数，必须要有结束条件。"><a href="#只要写递归函数，必须要有结束条件。" class="headerlink" title="只要写递归函数，必须要有结束条件。"></a>只要写递归函数，必须要有结束条件。</h1><h1 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h1><h1 id="不要只看到return就认为已经返回了。要看返回操作是在递归到第几层的时候发生的，然后返回给了谁。"><a href="#不要只看到return就认为已经返回了。要看返回操作是在递归到第几层的时候发生的，然后返回给了谁。" class="headerlink" title="不要只看到return就认为已经返回了。要看返回操作是在递归到第几层的时候发生的，然后返回给了谁。"></a>不要只看到return就认为已经返回了。要看返回操作是在递归到第几层的时候发生的，然后返回给了谁。</h1><h1 id="如果不是返回给最外层函数，调用者就接收不到。"><a href="#如果不是返回给最外层函数，调用者就接收不到。" class="headerlink" title="如果不是返回给最外层函数，调用者就接收不到。"></a>如果不是返回给最外层函数，调用者就接收不到。</h1><h1 id="需要再分析，看如何把结果返回回来。"><a href="#需要再分析，看如何把结果返回回来。" class="headerlink" title="需要再分析，看如何把结果返回回来。"></a>需要再分析，看如何把结果返回回来。</h1><h1 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h1><h1 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h1><h1 id="斐波那契-问第n个斐波那契数是多少-1"><a href="#斐波那契-问第n个斐波那契数是多少-1" class="headerlink" title="斐波那契  # 问第n个斐波那契数是多少"></a>斐波那契  # 问第n个斐波那契数是多少</h1><h1 id="1-1-2-3-5-8-fib-6-fib-5-fib-4"><a href="#1-1-2-3-5-8-fib-6-fib-5-fib-4" class="headerlink" title="1,1,2,3,5,8   #fib(6) = fib(5) + fib(4)"></a>1,1,2,3,5,8   #fib(6) = fib(5) + fib(4)</h1><h1 id="def-fib-n"><a href="#def-fib-n" class="headerlink" title="def fib(n):"></a>def fib(n):</h1><h1 id="if-n-1-or-n-2"><a href="#if-n-1-or-n-2" class="headerlink" title="if n == 1 or n==2:"></a>if n == 1 or n==2:</h1><h1 id="return-1"><a href="#return-1" class="headerlink" title="return 1"></a>return 1</h1><h1 id="return-fib-n-1-fib-n-2-两次递归非常慢"><a href="#return-fib-n-1-fib-n-2-两次递归非常慢" class="headerlink" title="return fib(n-1) + fib(n-2) #两次递归非常慢"></a>return fib(n-1) + fib(n-2) #两次递归非常慢</h1><h1 id="print-fib-50"><a href="#print-fib-50" class="headerlink" title="print(fib(50))"></a>print(fib(50))</h1><h1 id="fib-6-fib-5-fib-4"><a href="#fib-6-fib-5-fib-4" class="headerlink" title="fib(6) = fib(5) + fib(4)"></a>fib(6) = fib(5) + fib(4)</h1><h1 id="fib-5-fib-4-fib-3"><a href="#fib-5-fib-4-fib-3" class="headerlink" title="fib(5) = fib(4)+fib(3)"></a>fib(5) = fib(4)+fib(3)</h1><h1 id="fib-4-fib-3-fib-2"><a href="#fib-4-fib-3-fib-2" class="headerlink" title="fib(4) = fib(3)+fib(2)"></a>fib(4) = fib(3)+fib(2)</h1><h1 id="fib-3-fib-2-fib-1"><a href="#fib-3-fib-2-fib-1" class="headerlink" title="fib(3) = fib(2)+fib(1)"></a>fib(3) = fib(2)+fib(1)</h1><h1 id="fib-2-1"><a href="#fib-2-1" class="headerlink" title="fib(2) = 1"></a>fib(2) = 1</h1><h1 id="fib-1-1"><a href="#fib-1-1" class="headerlink" title="fib(1) = 1"></a>fib(1) = 1</h1><h1 id="def-fib-n-l-0"><a href="#def-fib-n-l-0" class="headerlink" title="def fib(n,l = [0]):"></a>def fib(n,l = [0]):</h1><h1 id="l-0-1"><a href="#l-0-1" class="headerlink" title="l[0] +=1"></a>l[0] +=1</h1><h1 id="if-n-1-or-n-2-1"><a href="#if-n-1-or-n-2-1" class="headerlink" title="if n ==1 or n == 2:"></a>if n ==1 or n == 2:</h1><h1 id="l-0-1-1"><a href="#l-0-1-1" class="headerlink" title="l[0] -= 1"></a>l[0] -= 1</h1><h1 id="return-1-1"><a href="#return-1-1" class="headerlink" title="return 1,1"></a>return 1,1</h1><h1 id="else-6"><a href="#else-6" class="headerlink" title="else:"></a>else:</h1><h1 id="a-b-fib-n-1"><a href="#a-b-fib-n-1" class="headerlink" title="a,b = fib(n-1)"></a>a,b = fib(n-1)</h1><h1 id="l-0-1-2"><a href="#l-0-1-2" class="headerlink" title="l[0] -= 1"></a>l[0] -= 1</h1><h1 id="if-l-0-0"><a href="#if-l-0-0" class="headerlink" title="if l[0] == 0:"></a>if l[0] == 0:</h1><h1 id="return-a-b"><a href="#return-a-b" class="headerlink" title="return a+b"></a>return a+b</h1><h1 id="return-b-a-b"><a href="#return-b-a-b" class="headerlink" title="return b,a+b"></a>return b,a+b</h1><h1 id="print-fib-50-1"><a href="#print-fib-50-1" class="headerlink" title="print(fib(50))"></a>print(fib(50))</h1><h1 id="没看懂"><a href="#没看懂" class="headerlink" title="没看懂"></a>没看懂</h1><p>def fib(n,a=1,b=1):<br>    if n==1 : return a<br>    return fib(n-1,b,a+b)<br>print(fib(50))</p><h1 id="阶乘-1"><a href="#阶乘-1" class="headerlink" title="阶乘"></a>阶乘</h1><div class="code-wrapper"><pre><code class="hljs">#3！ 3*2*1# 2! 2*1# 1! 1</code></pre></div><h1 id="def-fac-n"><a href="#def-fac-n" class="headerlink" title="def fac(n):"></a>def fac(n):</h1><h1 id="if-n-1"><a href="#if-n-1" class="headerlink" title="if n == 1 :"></a>if n == 1 :</h1><h1 id="return-1-1"><a href="#return-1-1" class="headerlink" title="return 1"></a>return 1</h1><h1 id="return-n-fac-n-1"><a href="#return-n-fac-n-1" class="headerlink" title="return n * fac(n-1)"></a>return n * fac(n-1)</h1><h1 id="-15"><a href="#-15" class="headerlink" title=""></a></h1><h1 id="print-fac-100"><a href="#print-fac-100" class="headerlink" title="print(fac(100))"></a>print(fac(100))</h1><h1 id="附加题-：考试附加题-1"><a href="#附加题-：考试附加题-1" class="headerlink" title="附加题 ：考试附加题"></a>附加题 ：考试附加题</h1><div class="code-wrapper"><pre><code class="hljs"># 递归实现</code></pre></div><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">模块</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 模块的导入# 导入的时候会执行里面的语句,有print()也会输出,多次导入只调用一次"""需求模块:本模块测试,print()会执行,其他文件调用,print()等不执行__name__:本模块名字,单若在某个模块中开始运行的,输出是__main__,否则就是文件名解决方法被调用模块中:def func():    passif __name__ == '__main__'    fun()<p>“””</p><h1 id="import-xxxx-找到模块-读内容到专属命名空间"><a href="#import-xxxx-找到模块-读内容到专属命名空间" class="headerlink" title="import xxxx  # 找到模块,读内容到专属命名空间"></a>import xxxx  # 找到模块,读内容到专属命名空间</h1><h1 id="xxxx-func-xxxx-var"><a href="#xxxx-func-xxxx-var" class="headerlink" title="xxxx.func() xxxx.var"></a>xxxx.func() xxxx.var</h1><h1 id="已经导入的modules字典-所以不会重复导入-名字-路径"><a href="#已经导入的modules字典-所以不会重复导入-名字-路径" class="headerlink" title="已经导入的modules字典,所以不会重复导入  名字:路径"></a>已经导入的modules字典,所以不会重复导入  名字:路径</h1><h1 id="import-sys"><a href="#import-sys" class="headerlink" title="import sys"></a>import sys</h1><h1 id="print-sys-modules"><a href="#print-sys-modules" class="headerlink" title="print(sys.modules)"></a>print(sys.modules)</h1><h1 id="import-time-as-t-给模块起别名-提高兼容性"><a href="#import-time-as-t-给模块起别名-提高兼容性" class="headerlink" title="import time as t 给模块起别名,提高兼容性"></a>import time as t 给模块起别名,提高兼容性</h1><h1 id="import-time-sys-os-同时引入多个代码-但不推荐"><a href="#import-time-sys-os-同时引入多个代码-但不推荐" class="headerlink" title="import time, sys, os 同时引入多个代码,但不推荐"></a>import time, sys, os 同时引入多个代码,但不推荐</h1><h1 id="先导内置-扩展django-自己的"><a href="#先导内置-扩展django-自己的" class="headerlink" title="先导内置,扩展django,自己的"></a>先导内置,扩展django,自己的</h1><h1 id="from-demo-import-func-var-都可以"><a href="#from-demo-import-func-var-都可以" class="headerlink" title="from demo import func,var 都可以"></a>from demo import func,var 都可以</h1><h1 id="from-demo-import-func-as-t"><a href="#from-demo-import-func-as-t" class="headerlink" title="from demo import func as t"></a>from demo import func as t</h1><h1 id="from-time-import-不安全"><a href="#from-time-import-不安全" class="headerlink" title="from time import *  不安全"></a>from time import *  不安全</h1><h1 id="被调用的模块第一行加入-all-‘var’-’fun’"><a href="#被调用的模块第一行加入-all-‘var’-’fun’" class="headerlink" title="被调用的模块第一行加入 all = [‘var’,’fun’]"></a>被调用的模块第一行加入 <strong>all</strong> = [‘var’,’fun’]</h1><h1 id="其他文件用-导入-该模块时-只能使用-list中含有的量"><a href="#其他文件用-导入-该模块时-只能使用-list中含有的量" class="headerlink" title="其他文件用 *导入 该模块时 只能使用 list中含有的量"></a>其他文件用 *导入 该模块时 只能使用 list中含有的量</h1><p></pre></div></p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">正则模块</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">#正则模块""".   换行外任意字符\w  数字字母下划线\s  任意空白字符\d  数字# 上边3个\大写就是非,任意两对就是匹配全局\n 换行\t 制表\b 匹配单词结尾,用得少,前边加些字符,不然不显示^x 以x开头,只匹配一个() 一个组[^ab] ab都不匹配 ,非<p>以上都是单个字符匹配</p><ul><li><ul><li>? 等 只约束 前面的一个规则,若有每个,都加+即可<br>\d* 多次匹配,空也可匹配<br>\d+ 匹配一次或多次<br>\d? 匹配一次</li></ul></li></ul><p>{n} 匹配n次<br>{n,m}   n到m次<br>()? ()中只出现一次<br>.*?x 前边任意长度,直到出现x结束</p><p>转义符匹配<br>正则中\n 匹配\n<br>语言中\\n 匹配\n 为每个”&quot;转义<br>或r’\n’ 匹配\n  取消”&quot;的转义功能<br>“””</p><h1 id="re模块"><a href="#re模块" class="headerlink" title="re模块"></a>re模块</h1><p>import re</p><h1 id="match-从头-开始匹配-匹配上就返回一个变量-search即时在中间也可以查到"><a href="#match-从头-开始匹配-匹配上就返回一个变量-search即时在中间也可以查到" class="headerlink" title="match (从头)开始匹配,匹配上就返回一个变量,search即时在中间也可以查到"></a>match (从头)开始匹配,匹配上就返回一个变量,search即时在中间也可以查到</h1><h1 id="group显示"><a href="#group显示" class="headerlink" title="group显示"></a>group显示</h1><h1 id="没有匹配返回Nnoe-调用group出错"><a href="#没有匹配返回Nnoe-调用group出错" class="headerlink" title="没有匹配返回Nnoe,调用group出错"></a>没有匹配返回Nnoe,调用group出错</h1><p>ret = re.match(‘[a-z]+’,”123 dzf gyg lzt”)<br>print(ret)</p><h1 id="findall-匹配所有符合的放在列表中"><a href="#findall-匹配所有符合的放在列表中" class="headerlink" title="findall 匹配所有符合的放在列表中"></a>findall 匹配所有符合的放在列表中</h1><p>ret = re.findall(“[a-z]+”,”dzf gyg lzt”)<br>print(ret)</p><h1 id="search-找到第一个就返回-返回一个对象-ret-group-回去值"><a href="#search-找到第一个就返回-返回一个对象-ret-group-回去值" class="headerlink" title="search,找到第一个就返回,返回一个对象,ret.group()回去值"></a>search,找到第一个就返回,返回一个对象,ret.group()回去值</h1><h1 id="若找不到返回None-使用group-则会报错"><a href="#若找不到返回None-使用group-则会报错" class="headerlink" title="若找不到返回None,使用group()则会报错"></a>若找不到返回None,使用group()则会报错</h1><p>ret = re.search(“[a-z]+”,”123 dzf gyg lzt”)<br>print(ret.group())</p><h1 id="分割-先按照a-分割再按b分割"><a href="#分割-先按照a-分割再按b分割" class="headerlink" title="分割,先按照a,分割再按b分割"></a>分割,先按照a,分割再按b分割</h1><p>re.split(“[ab]”,”abcd”)</p><h1 id="替换所有数字为H-若没有1-表示匹配一次"><a href="#替换所有数字为H-若没有1-表示匹配一次" class="headerlink" title="替换所有数字为H,若没有1 表示匹配一次"></a>替换所有数字为H,若没有1 表示匹配一次</h1><p>re.sub(‘\d’,”H”,”cacasccass366asdas”,1)</p><h1 id="返回替换后的结果-并返回次数-元祖-“str”-次数"><a href="#返回替换后的结果-并返回次数-元祖-“str”-次数" class="headerlink" title="返回替换后的结果 并返回次数 元祖(“str”,次数)"></a>返回替换后的结果 并返回次数 元祖(“str”,次数)</h1><p>re.subn(‘\d’,”H”,”cacasccass366asdas”,1)</p><h1 id="编译正则表达式"><a href="#编译正则表达式" class="headerlink" title="编译正则表达式"></a>编译正则表达式</h1><p>re.compile(‘\d{3}’) # 供后使用</p><h1 id="返回一个存放结果的迭代器"><a href="#返回一个存放结果的迭代器" class="headerlink" title="返回一个存放结果的迭代器"></a>返回一个存放结果的迭代器</h1><p>ret = re.finditer(“\d”,”huoiuhizai23nusdwhjj”)<br>#查看<br>next(ret).group() # 查看第一个<br>next(ret).group() # 查看第二个<br>for i in ret:  #第3个开始<br>    i.group()</p><h1 id="对于search-group-返回一个完整的匹配"><a href="#对于search-group-返回一个完整的匹配" class="headerlink" title="对于search group() 返回一个完整的匹配"></a>对于search group() 返回一个完整的匹配</h1><h1 id="group-1-group-2-返回其中的一部分"><a href="#group-1-group-2-返回其中的一部分" class="headerlink" title="group(1) group(2) 返回其中的一部分"></a>group(1) group(2) 返回其中的一部分</h1><h1 id="ret-re-findall-‘www-baidu-oldboy-com’-‘www-oldboy-com-39"><a href="#ret-re-findall-‘www-baidu-oldboy-com’-‘www-oldboy-com-39" class="headerlink" title="ret = re.findall(‘www.(baidu|oldboy).com’, ‘www.oldboy.com&#39;)"></a>ret = re.findall(‘www.(baidu|oldboy).com’, ‘<a href="http://www.oldboy.com&/#39;">www.oldboy.com&#39;</a>)</h1><h1 id="print-ret-‘oldboy’-这是因为findall会优先把匹配结果组里内容返回-如果想要匹配结果-取消权限即可"><a href="#print-ret-‘oldboy’-这是因为findall会优先把匹配结果组里内容返回-如果想要匹配结果-取消权限即可" class="headerlink" title="print(ret)  # [‘oldboy’]     这是因为findall会优先把匹配结果组里内容返回,如果想要匹配结果,取消权限即可"></a>print(ret)  # [‘oldboy’]     这是因为findall会优先把匹配结果组里内容返回,如果想要匹配结果,取消权限即可</h1><h1 id="保留分组优先"><a href="#保留分组优先" class="headerlink" title="保留分组优先"></a>保留分组优先</h1><h1 id="ret-re-findall-‘www-baidu-oldboy-com’-‘www-oldboy-com-39-1"><a href="#ret-re-findall-‘www-baidu-oldboy-com’-‘www-oldboy-com-39-1" class="headerlink" title="ret = re.findall(‘www.(?:baidu|oldboy).com’, ‘www.oldboy.com&#39;)"></a>ret = re.findall(‘www.(?:baidu|oldboy).com’, ‘<a href="http://www.oldboy.com&/#39;">www.oldboy.com&#39;</a>)</h1><h1 id="print-ret-‘www-oldboy-com-39"><a href="#print-ret-‘www-oldboy-com-39" class="headerlink" title="print(ret)  # [‘www.oldboy.com&#39;]"></a>print(ret)  # [‘<a href="http://www.oldboy.com&/#39;]">www.oldboy.com&#39;]</a></h1><p>ret=re.split(“\d+”,”eva3egon4yuan”)<br>print(ret) #结果 ： [‘eva’, ‘egon’, ‘yuan’]</p><p>ret=re.split(“(\d+)”,”eva3egon4yuan”)<br>print(ret) #结果 ： [‘eva’, ‘3’, ‘egon’, ‘4’, ‘yuan’]</p><p>#re.findall(x,xx,flag)</p><h1 id="flag-rs-I-或略大小写"><a href="#flag-rs-I-或略大小写" class="headerlink" title="flag = rs.I 或略大小写"></a>flag = rs.I 或略大小写</h1><h1 id="flag-rs-M-多行模式-改变-的行为"><a href="#flag-rs-M-多行模式-改变-的行为" class="headerlink" title="flag = rs.M 多行模式,改变^$的行为"></a>flag = rs.M 多行模式,改变^$的行为</h1><h1 id="flag-rs-S-点可以匹配换行-以及任意字符"><a href="#flag-rs-S-点可以匹配换行-以及任意字符" class="headerlink" title="flag = rs.S 点可以匹配换行,以及任意字符"></a>flag = rs.S 点可以匹配换行,以及任意字符</h1><h1 id="flag-rs-L-做本地化识别的匹配-表示特殊字符集-s-w-等-不推荐"><a href="#flag-rs-L-做本地化识别的匹配-表示特殊字符集-s-w-等-不推荐" class="headerlink" title="flag = rs.L  做本地化识别的匹配,表示特殊字符集 \s,\w 等,不推荐"></a>flag = rs.L  做本地化识别的匹配,表示特殊字符集 \s,\w 等,不推荐</h1><h1 id="flag-rs-U-使用-w-w等-使用取决于unicode定义的字符属性-pythons默认使用"><a href="#flag-rs-U-使用-w-w等-使用取决于unicode定义的字符属性-pythons默认使用" class="headerlink" title="flag = rs.U 使用\w \w等,使用取决于unicode定义的字符属性,pythons默认使用"></a>flag = rs.U 使用\w \w等,使用取决于unicode定义的字符属性,pythons默认使用</h1><h1 id="flag-rs-X-冗长模式-pattern可以是多行-忽略空白字符-可添加注释"><a href="#flag-rs-X-冗长模式-pattern可以是多行-忽略空白字符-可添加注释" class="headerlink" title="flag = rs.X 冗长模式,pattern可以是多行,忽略空白字符,可添加注释"></a>flag = rs.X 冗长模式,pattern可以是多行,忽略空白字符,可添加注释</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">正则模块2</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 正则表达式# 字符组 [字符]# 元字符    # \w \d \s    # \W \D \S    # . 除了换行符以外的任意字符    # \n \t    # \b    # ^ $ 匹配字符串的开始和结束    # （） 分组  是对多个字符组整体量词约束的时候用的                #re模块：分组是有优先的                    # findall                    # split    # | 从左到右匹配，只要匹配上就不继续匹配了。所以应该把长的放前面    # [^] 除了字符组内的其他都匹配# 量词    # *   0~    # +   1~    # ？  0~1    # {n} n    # {n,} n~    # {n,m} n~m<h1 id="转义的问题"><a href="#转义的问题" class="headerlink" title="转义的问题"></a>转义的问题</h1><h1 id="import-re"><a href="#import-re" class="headerlink" title="import re"></a>import re</h1><h1 id="re-findall-r’-s’-r’-s’"><a href="#re-findall-r’-s’-r’-s’" class="headerlink" title="re.findall(r’\s’,r’\s’)"></a>re.findall(r’\s’,r’\s’)</h1><h1 id="惰性匹配"><a href="#惰性匹配" class="headerlink" title="惰性匹配"></a>惰性匹配</h1><h1 id="量词后面加问号"><a href="#量词后面加问号" class="headerlink" title="量词后面加问号"></a>量词后面加问号</h1><pre><code class="hljs"># .*?abc 一直取遇到abc就停</code></pre></div><h1 id="re模块-1"><a href="#re模块-1" class="headerlink" title="re模块"></a>re模块</h1><h1 id="import-re-1"><a href="#import-re-1" class="headerlink" title="import re"></a>import re</h1><h1 id="re-findall-‘-d’-’awir17948jsdc’-re-S"><a href="#re-findall-‘-d’-’awir17948jsdc’-re-S" class="headerlink" title="re.findall(‘\d’,’awir17948jsdc’,re.S)"></a>re.findall(‘\d’,’awir17948jsdc’,re.S)</h1><h1 id="返回值：列表-列表中是所有匹配到的项"><a href="#返回值：列表-列表中是所有匹配到的项" class="headerlink" title="返回值：列表 列表中是所有匹配到的项"></a>返回值：列表 列表中是所有匹配到的项</h1><h1 id="ret-search-‘-d-w-’-’awir17948jsdc’）"><a href="#ret-search-‘-d-w-’-’awir17948jsdc’）" class="headerlink" title="ret = search(‘\d(\w)+’,’awir17948jsdc’）"></a>ret = search(‘\d(\w)+’,’awir17948jsdc’）</h1><h1 id="ret-search-‘-d-P-lt-name-gt-w-’-’awir17948jsdc’）"><a href="#ret-search-‘-d-P-lt-name-gt-w-’-’awir17948jsdc’）" class="headerlink" title="ret = search(‘\d(?P&lt;name&gt;\w)+’,’awir17948jsdc’）"></a>ret = search(‘\d(?P&lt;name&gt;\w)+’,’awir17948jsdc’）</h1><h1 id="找整个字符串，遇到匹配上的就返回，遇不到就None"><a href="#找整个字符串，遇到匹配上的就返回，遇不到就None" class="headerlink" title="找整个字符串，遇到匹配上的就返回，遇不到就None"></a>找整个字符串，遇到匹配上的就返回，遇不到就None</h1><h1 id="如果有返回值ret-group-就可以取到值"><a href="#如果有返回值ret-group-就可以取到值" class="headerlink" title="如果有返回值ret.group()就可以取到值"></a>如果有返回值ret.group()就可以取到值</h1><h1 id="取分组中的内容-：-ret-group-1-ret-group-‘name’"><a href="#取分组中的内容-：-ret-group-1-ret-group-‘name’" class="headerlink" title="取分组中的内容 ： ret.group(1)   /  ret.group(‘name’)"></a>取分组中的内容 ： ret.group(1)   /  ret.group(‘name’)</h1><h1 id="match"><a href="#match" class="headerlink" title="match"></a>match</h1><h1 id="从头开始匹配，匹配上了就返回，匹配不上就是None"><a href="#从头开始匹配，匹配上了就返回，匹配不上就是None" class="headerlink" title="从头开始匹配，匹配上了就返回，匹配不上就是None"></a>从头开始匹配，匹配上了就返回，匹配不上就是None</h1><h1 id="如果匹配上了-group取值"><a href="#如果匹配上了-group取值" class="headerlink" title="如果匹配上了 .group取值"></a>如果匹配上了 .group取值</h1><h1 id="分割-split"><a href="#分割-split" class="headerlink" title="分割 split"></a>分割 split</h1><h1 id="替换-sub-和-subn"><a href="#替换-sub-和-subn" class="headerlink" title="替换 sub 和 subn"></a>替换 sub 和 subn</h1><h1 id="finditer-返回迭代器"><a href="#finditer-返回迭代器" class="headerlink" title="finditer 返回迭代器"></a>finditer 返回迭代器</h1><h1 id="compile-编译-：正则表达式很长且要多次使用"><a href="#compile-编译-：正则表达式很长且要多次使用" class="headerlink" title="compile 编译 ：正则表达式很长且要多次使用"></a>compile 编译 ：正则表达式很长且要多次使用</h1><p>import re</p><h1 id="ret-re-search-“-lt-P-lt-tag-name-gt-w-gt-w-lt-P-tag-name-gt-”-”-lt-h1-gt-hello-lt-h1-gt-”"><a href="#ret-re-search-“-lt-P-lt-tag-name-gt-w-gt-w-lt-P-tag-name-gt-”-”-lt-h1-gt-hello-lt-h1-gt-”" class="headerlink" title="ret = re.search(“&lt;(?P&lt;tag_name&gt;\w+)&gt;\w+&lt;/(?P=tag_name)&gt;”,”&lt;h1&gt;hello&lt;/h1&gt;”)"></a>ret = re.search(“&lt;(?P&lt;tag_name&gt;\w+)&gt;\w+&lt;/(?P=tag_name)&gt;”,”&lt;h1&gt;hello&lt;/h1&gt;”)</h1><h1 id="还可以在分组中利用-lt-name-gt-的形式给分组起名字"><a href="#还可以在分组中利用-lt-name-gt-的形式给分组起名字" class="headerlink" title="#还可以在分组中利用?&lt;name&gt;的形式给分组起名字"></a>#还可以在分组中利用?&lt;name&gt;的形式给分组起名字</h1><h1 id="获取的匹配结果可以直接用group-‘名字’-拿到对应的值"><a href="#获取的匹配结果可以直接用group-‘名字’-拿到对应的值" class="headerlink" title="#获取的匹配结果可以直接用group(‘名字’)拿到对应的值"></a>#获取的匹配结果可以直接用group(‘名字’)拿到对应的值</h1><h1 id="print-ret-group-‘tag-name’-结果-：h1"><a href="#print-ret-group-‘tag-name’-结果-：h1" class="headerlink" title="print(ret.group(‘tag_name’))   #结果 ：h1"></a>print(ret.group(‘tag_name’))   #结果 ：h1</h1><h1 id="print-ret-group-结果-：-lt-h1-gt-hello-lt-h1-gt"><a href="#print-ret-group-结果-：-lt-h1-gt-hello-lt-h1-gt" class="headerlink" title="print(ret.group())             #结果 ：&lt;h1&gt;hello&lt;/h1&gt;"></a>print(ret.group())             #结果 ：&lt;h1&gt;hello&lt;/h1&gt;</h1><h1 id="ret-re-search-r”-lt-w-gt-w-lt-1-gt-”-”-lt-h1-gt-hello-lt-h1-gt-”"><a href="#ret-re-search-r”-lt-w-gt-w-lt-1-gt-”-”-lt-h1-gt-hello-lt-h1-gt-”" class="headerlink" title="ret = re.search(r”&lt;(\w+)&gt;\w+&lt;/\1&gt;”,”&lt;h1&gt;hello&lt;/h1&gt;”)"></a>ret = re.search(r”&lt;(\w+)&gt;\w+&lt;/\1&gt;”,”&lt;h1&gt;hello&lt;/h1&gt;”)</h1><h1 id="如果不给组起名字，也可以用-序号来找到对应的组，表示要找的内容和前面的组内容一致"><a href="#如果不给组起名字，也可以用-序号来找到对应的组，表示要找的内容和前面的组内容一致" class="headerlink" title="#如果不给组起名字，也可以用\序号来找到对应的组，表示要找的内容和前面的组内容一致"></a>#如果不给组起名字，也可以用\序号来找到对应的组，表示要找的内容和前面的组内容一致</h1><h1 id="获取的匹配结果可以直接用group-序号-拿到对应的值"><a href="#获取的匹配结果可以直接用group-序号-拿到对应的值" class="headerlink" title="#获取的匹配结果可以直接用group(序号)拿到对应的值"></a>#获取的匹配结果可以直接用group(序号)拿到对应的值</h1><h1 id="print-ret-group-1"><a href="#print-ret-group-1" class="headerlink" title="print(ret.group(1))"></a>print(ret.group(1))</h1><h1 id="print-ret-group-结果-：-lt-h1-gt-hello-lt-h1-gt-1"><a href="#print-ret-group-结果-：-lt-h1-gt-hello-lt-h1-gt-1" class="headerlink" title="print(ret.group())  #结果 ：&lt;h1&gt;hello&lt;/h1&gt;"></a>print(ret.group())  #结果 ：&lt;h1&gt;hello&lt;/h1&gt;</h1><p>import re</p><h1 id="ret-re-findall-r”-d-d-d-”-”1-2-60-40-35-5-4-3-”"><a href="#ret-re-findall-r”-d-d-d-”-”1-2-60-40-35-5-4-3-”" class="headerlink" title="ret=re.findall(r”\d+.\d+|(\d+)”,”1-2*(60+(-40.35/5)-(-4*3))”)"></a>ret=re.findall(r”\d+.\d+|(\d+)”,”1-2*(60+(-40.35/5)-(-4*3))”)</h1><h1 id="print-ret-‘1’-‘2’-‘60’-‘40’-‘35’-‘5’-‘4’-‘3’"><a href="#print-ret-‘1’-‘2’-‘60’-‘40’-‘35’-‘5’-‘4’-‘3’" class="headerlink" title="print(ret) #[‘1’, ‘2’, ‘60’, ‘40’, ‘35’, ‘5’, ‘4’, ‘3’]"></a>print(ret) #[‘1’, ‘2’, ‘60’, ‘40’, ‘35’, ‘5’, ‘4’, ‘3’]</h1><h1 id="ret-remove-‘’"><a href="#ret-remove-‘’" class="headerlink" title="ret.remove(‘’)"></a>ret.remove(‘’)</h1><h1 id="print-ret"><a href="#print-ret" class="headerlink" title="print(ret)"></a>print(ret)</h1><h1 id="ret-re-findall-r”-d-d-d-”-”1-2-60-40-35-5-4-3-”-1"><a href="#ret-re-findall-r”-d-d-d-”-”1-2-60-40-35-5-4-3-”-1" class="headerlink" title="ret=re.findall(r”-?\d+.\d*|(-?\d+)”,”1-2*(60+(-40.35/5)-(-4*3))”)"></a>ret=re.findall(r”-?\d+.\d*|(-?\d+)”,”1-2*(60+(-40.35/5)-(-4*3))”)</h1><h1 id="print-ret-‘1’-‘-2’-‘60’-‘’-‘5’-‘-4’-‘3’"><a href="#print-ret-‘1’-‘-2’-‘60’-‘’-‘5’-‘-4’-‘3’" class="headerlink" title="print(ret) #[‘1’, ‘-2’, ‘60’, ‘’, ‘5’, ‘-4’, ‘3’]"></a>print(ret) #[‘1’, ‘-2’, ‘60’, ‘’, ‘5’, ‘-4’, ‘3’]</h1><h1 id="ret-remove-“”"><a href="#ret-remove-“”" class="headerlink" title="ret.remove(“”)"></a>ret.remove(“”)</h1><h1 id="print-ret-‘1’-‘-2’-‘60’-‘5’-‘-4’-‘3’"><a href="#print-ret-‘1’-‘-2’-‘60’-‘5’-‘-4’-‘3’" class="headerlink" title="print(ret) #[‘1’, ‘-2’, ‘60’, ‘5’, ‘-4’, ‘3’]"></a>print(ret) #[‘1’, ‘-2’, ‘60’, ‘5’, ‘-4’, ‘3’]</h1><h1 id="首先得到一个字符串"><a href="#首先得到一个字符串" class="headerlink" title="首先得到一个字符串"></a>首先得到一个字符串</h1><h1 id="去空格"><a href="#去空格" class="headerlink" title="去空格"></a>去空格</h1><h1 id="没有空格的字符串"><a href="#没有空格的字符串" class="headerlink" title="没有空格的字符串"></a>没有空格的字符串</h1><h1 id="先算最里层括号里的-：-找括号-，且括号里没有其他括号"><a href="#先算最里层括号里的-：-找括号-，且括号里没有其他括号" class="headerlink" title="先算最里层括号里的 ： 找括号 ，且括号里没有其他括号"></a>先算最里层括号里的 ： 找括号 ，且括号里没有其他括号</h1><h1 id="得到了一个没有括号的表达式-：只有加减乘除-从左到右先找到第一个乘除法-mdash-mdash-重复"><a href="#得到了一个没有括号的表达式-：只有加减乘除-从左到右先找到第一个乘除法-mdash-mdash-重复" class="headerlink" title="得到了一个没有括号的表达式 ：只有加减乘除 从左到右先找到第一个乘除法   &mdash;&mdash; 重复"></a>得到了一个没有括号的表达式 ：只有加减乘除 从左到右先找到第一个乘除法   &mdash;&mdash; 重复</h1><h1 id="所有的乘除法都做完了"><a href="#所有的乘除法都做完了" class="headerlink" title="所有的乘除法都做完了"></a>所有的乘除法都做完了</h1><h1 id="计算加减-mdash-mdash-加减法"><a href="#计算加减-mdash-mdash-加减法" class="headerlink" title="计算加减  &mdash;&mdash; 加减法"></a>计算加减  &mdash;&mdash; 加减法</h1><h1 id="只有一个数了-就可以结束了"><a href="#只有一个数了-就可以结束了" class="headerlink" title="只有一个数了 就可以结束了"></a>只有一个数了 就可以结束了</h1><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">collection</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># collections 扩展数据类型# 时间模块# random 随机数模块# os 操作系统# sys 与python解释器有关# 序列化模块 数据类型与str的转换# collections"""    namedtuple:    deque:双端队列    counter:计数器    orderedDict:有序字典    defaultdict:带默认值的字典<p>“””</p><h1 id="列表-字典-字符串-集合-frozenset-字符串-堆栈"><a href="#列表-字典-字符串-集合-frozenset-字符串-堆栈" class="headerlink" title="列表,字典,字符串,集合,frozenset,字符串,堆栈"></a>列表,字典,字符串,集合,frozenset,字符串,堆栈</h1><h1 id="namedtuple-可用名字获取值"><a href="#namedtuple-可用名字获取值" class="headerlink" title="namedtuple 可用名字获取值,"></a>namedtuple 可用名字获取值,</h1><h1 id="from-collections-import-namedtuple"><a href="#from-collections-import-namedtuple" class="headerlink" title="from collections import namedtuple"></a>from collections import namedtuple</h1><h1 id="Point-namedtuple-“point”-‘x’-’y’-’z’"><a href="#Point-namedtuple-“point”-‘x’-’y’-’z’" class="headerlink" title="Point = namedtuple(“point”,[‘x’,’y’,’z’])"></a>Point = namedtuple(“point”,[‘x’,’y’,’z’])</h1><h1 id="p-Point-1-2-3"><a href="#p-Point-1-2-3" class="headerlink" title="p = Point(1,2,3)"></a>p = Point(1,2,3)</h1><h1 id="p2-Point-1-2-3"><a href="#p2-Point-1-2-3" class="headerlink" title="p2 = Point(1,2,3)"></a>p2 = Point(1,2,3)</h1><h1 id="print-p-x-1"><a href="#print-p-x-1" class="headerlink" title="print(p.x) # 1"></a>print(p.x) # 1</h1><h1 id="print-p-y-2"><a href="#print-p-y-2" class="headerlink" title="print(p.y) # 2"></a>print(p.y) # 2</h1><h1 id="print-p-z-3"><a href="#print-p-z-3" class="headerlink" title="print(p.z) # 3"></a>print(p.z) # 3</h1><h1 id="print-p-x-1-y-2"><a href="#print-p-x-1-y-2" class="headerlink" title="print(p) # (x=1,y=2)"></a>print(p) # (x=1,y=2)</h1><h1 id="花色与数字"><a href="#花色与数字" class="headerlink" title="花色与数字"></a>花色与数字</h1><h1 id="Card-namedtuple-“card”-“suits”-”number”"><a href="#Card-namedtuple-“card”-“suits”-”number”" class="headerlink" title="Card = namedtuple(“card”,[“suits”,”number”])"></a>Card = namedtuple(“card”,[“suits”,”number”])</h1><h1 id="c1-Card-“红桃”-2"><a href="#c1-Card-“红桃”-2" class="headerlink" title="c1 = Card(“红桃”,2)"></a>c1 = Card(“红桃”,2)</h1><h1 id="print-c1"><a href="#print-c1" class="headerlink" title="print(c1)"></a>print(c1)</h1><h1 id="queue-队列-内容不可看"><a href="#queue-队列-内容不可看" class="headerlink" title="queue 队列,内容不可看"></a>queue 队列,内容不可看</h1><h1 id="import-queue"><a href="#import-queue" class="headerlink" title="import queue"></a>import queue</h1><h1 id="q-queue-Queue-q不可for-不可放多个值-但可放其他元素类型"><a href="#q-queue-Queue-q不可for-不可放多个值-但可放其他元素类型" class="headerlink" title="q = queue.Queue()  # q不可for,不可放多个值,但可放其他元素类型"></a>q = queue.Queue()  # q不可for,不可放多个值,但可放其他元素类型</h1><h1 id="q-put-10"><a href="#q-put-10" class="headerlink" title="q.put(10)"></a>q.put(10)</h1><h1 id="q-put-10-1"><a href="#q-put-10-1" class="headerlink" title="q.put(10)"></a>q.put(10)</h1><h1 id="q-put-10-2"><a href="#q-put-10-2" class="headerlink" title="q.put(10)"></a>q.put(10)</h1><h1 id="q-put-10-3"><a href="#q-put-10-3" class="headerlink" title="q.put(10)"></a>q.put(10)</h1><h1 id="print-q-get"><a href="#print-q-get" class="headerlink" title="print(q.get())"></a>print(q.get())</h1><h1 id="print-q-get-1"><a href="#print-q-get-1" class="headerlink" title="print(q.get())"></a>print(q.get())</h1><h1 id="print-q-get-取内容时-若没有了-阻塞-等待再次添加-继续"><a href="#print-q-get-取内容时-若没有了-阻塞-等待再次添加-继续" class="headerlink" title="print(q.get())  # 取内容时,若没有了,阻塞,等待再次添加,继续"></a>print(q.get())  # 取内容时,若没有了,阻塞,等待再次添加,继续</h1><h1 id="print-q-qsize-查看剩余的"><a href="#print-q-qsize-查看剩余的" class="headerlink" title="print(q.qsize())  # 查看剩余的,"></a>print(q.qsize())  # 查看剩余的,</h1><h1 id="deque-双端队列-两端都可以存取"><a href="#deque-双端队列-两端都可以存取" class="headerlink" title="deque 双端队列,两端都可以存取"></a>deque 双端队列,两端都可以存取</h1><h1 id="from-collections-import-deque"><a href="#from-collections-import-deque" class="headerlink" title="from collections import deque"></a>from collections import deque</h1><h1 id="dq-deque-1-2"><a href="#dq-deque-1-2" class="headerlink" title="dq = deque([1,2])"></a>dq = deque([1,2])</h1><h1 id="dq-append-‘a’-从后边放数据-1-2-’a’"><a href="#dq-append-‘a’-从后边放数据-1-2-’a’" class="headerlink" title="dq.append(‘a’)  # 从后边放数据[1,2,’a’]"></a>dq.append(‘a’)  # 从后边放数据[1,2,’a’]</h1><h1 id="dq-appendleft-‘b’-从前边放数据-‘b’-1-2-’a’"><a href="#dq-appendleft-‘b’-从前边放数据-‘b’-1-2-’a’" class="headerlink" title="dq.appendleft(‘b’)  # 从前边放数据[‘b’,1,2,’a’]"></a>dq.appendleft(‘b’)  # 从前边放数据[‘b’,1,2,’a’]</h1><h1 id="dq-insert-2-3-‘b’-1-3-2-’a’"><a href="#dq-insert-2-3-‘b’-1-3-2-’a’" class="headerlink" title="dq.insert(2,3)   # [‘b’,1,3,2,’a’]"></a>dq.insert(2,3)   # [‘b’,1,3,2,’a’]</h1><h1 id="print-dq-pop-从后边取数据-a"><a href="#print-dq-pop-从后边取数据-a" class="headerlink" title="print(dq.pop())  # 从后边取数据 a"></a>print(dq.pop())  # 从后边取数据 a</h1><h1 id="print-dq-popleft-从前边取数据-b"><a href="#print-dq-popleft-从前边取数据-b" class="headerlink" title="print(dq.popleft())  # 从前边取数据 b"></a>print(dq.popleft())  # 从前边取数据 b</h1><h1 id="print-dq-deque-1-3-2-可看内容"><a href="#print-dq-deque-1-3-2-可看内容" class="headerlink" title="print(dq)  # deque([1, 3, 2]) 可看内容"></a>print(dq)  # deque([1, 3, 2]) 可看内容</h1><h1 id="有序字典"><a href="#有序字典" class="headerlink" title="有序字典"></a>有序字典</h1><h1 id="from-collections-import-OrderedDict"><a href="#from-collections-import-OrderedDict" class="headerlink" title="from collections import  OrderedDict"></a>from collections import  OrderedDict</h1><h1 id="初始化时要如下定义-列表型定义-所以有序"><a href="#初始化时要如下定义-列表型定义-所以有序" class="headerlink" title="初始化时要如下定义,列表型定义,所以有序"></a>初始化时要如下定义,列表型定义,所以有序</h1><h1 id="od-OrderedDict-‘a’-1-‘b’-2-‘c’-3"><a href="#od-OrderedDict-‘a’-1-‘b’-2-‘c’-3" class="headerlink" title="od = OrderedDict([(‘a’, 1), (‘b’, 2), (‘c’, 3)])"></a>od = OrderedDict([(‘a’, 1), (‘b’, 2), (‘c’, 3)])</h1><h1 id="print-od-–-gt-OrderedDict-‘a’-1-‘b’-2-‘c’-3"><a href="#print-od-–-gt-OrderedDict-‘a’-1-‘b’-2-‘c’-3" class="headerlink" title="print(od) # –&gt;OrderedDict([(‘a’, 1), (‘b’, 2), (‘c’, 3)])"></a>print(od) # –&gt;OrderedDict([(‘a’, 1), (‘b’, 2), (‘c’, 3)])</h1><h1 id="OrderedDict的Key是有序的"><a href="#OrderedDict的Key是有序的" class="headerlink" title="OrderedDict的Key是有序的"></a>OrderedDict的Key是有序的</h1><h1 id="print-od-‘a’-仍可这样访问"><a href="#print-od-‘a’-仍可这样访问" class="headerlink" title="print(od[‘a’]) # 仍可这样访问"></a>print(od[‘a’]) # 仍可这样访问</h1><h1 id="for-k-in-od"><a href="#for-k-in-od" class="headerlink" title="for k in od:"></a>for k in od:</h1><h1 id="print-k"><a href="#print-k" class="headerlink" title="print(k)"></a>print(k)</h1><h1 id="defaultdict"><a href="#defaultdict" class="headerlink" title="defaultdict"></a>defaultdict</h1><h1 id="from-collections-import-defaultdict"><a href="#from-collections-import-defaultdict" class="headerlink" title="from collections import defaultdict"></a>from collections import defaultdict</h1><h1 id="d-defaultdict-lambda-5-value-默认是5"><a href="#d-defaultdict-lambda-5-value-默认是5" class="headerlink" title="d = defaultdict(lambda: 5)  # value 默认是5"></a>d = defaultdict(lambda: 5)  # value 默认是5</h1><h1 id="print-d-‘k’"><a href="#print-d-‘k’" class="headerlink" title="print(d[‘k’])"></a>print(d[‘k’])</h1><h1 id="d-defaultdict-list-使字典的value默认为list-其他元素也可"><a href="#d-defaultdict-list-使字典的value默认为list-其他元素也可" class="headerlink" title="d = defaultdict(list)  # 使字典的value默认为list,其他元素也可"></a>d = defaultdict(list)  # 使字典的value默认为list,其他元素也可</h1><h1 id="d-‘k’-append-1"><a href="#d-‘k’-append-1" class="headerlink" title="d[‘k’].append(1)"></a>d[‘k’].append(1)</h1><h1 id="print-d"><a href="#print-d" class="headerlink" title="print(d)"></a>print(d)</h1><h1 id="from-collections-import-Counter"><a href="#from-collections-import-Counter" class="headerlink" title="from collections import Counter"></a>from collections import Counter</h1><h1 id="c-Counter-“asdaquidbqu9fu9qnnaibcba”"><a href="#c-Counter-“asdaquidbqu9fu9qnnaibcba”" class="headerlink" title="c = Counter(“asdaquidbqu9fu9qnnaibcba”)"></a>c = Counter(“asdaquidbqu9fu9qnnaibcba”)</h1><h1 id="print-c-Counter-‘a’-4-‘q’-3-‘u’-3-‘b’-3-‘d’-2-‘i’-2-‘9’-2-‘n’-2-‘s’-1-‘f’-1-‘c’-1"><a href="#print-c-Counter-‘a’-4-‘q’-3-‘u’-3-‘b’-3-‘d’-2-‘i’-2-‘9’-2-‘n’-2-‘s’-1-‘f’-1-‘c’-1" class="headerlink" title="print(c)  # Counter({‘a’: 4, ‘q’: 3, ‘u’: 3, ‘b’: 3, ‘d’: 2, ‘i’: 2, ‘9’: 2, ‘n’: 2, ‘s’: 1, ‘f’: 1, ‘c’: 1})"></a>print(c)  # Counter({‘a’: 4, ‘q’: 3, ‘u’: 3, ‘b’: 3, ‘d’: 2, ‘i’: 2, ‘9’: 2, ‘n’: 2, ‘s’: 1, ‘f’: 1, ‘c’: 1})</h1><p></pre></div></p><h2 class="md-end-block md-heading"><span class="md-plain">time</span></h2><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p"><span class="md-plain">思考题,时间相减</span></p><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import time# time.sleep(100) # stop100 second# time.time()  # 返回s为单位的浮点数<h1 id="格式化时间-mdash-mdash-字符串：-给人看的-string-str"><a href="#格式化时间-mdash-mdash-字符串：-给人看的-string-str" class="headerlink" title="格式化时间  &mdash;&mdash; 字符串： 给人看的 string str"></a>格式化时间  &mdash;&mdash; 字符串： 给人看的 string str</h1><h1 id="时间戳时间-mdash-mdash-float时间-：-计算机看的-timestamp"><a href="#时间戳时间-mdash-mdash-float时间-：-计算机看的-timestamp" class="headerlink" title="时间戳时间 &mdash;&mdash; float时间 ： 计算机看的 timestamp"></a>时间戳时间 &mdash;&mdash; float时间 ： 计算机看的 timestamp</h1><h1 id="结构化时间-mdash-mdash-元祖-：计算用的-struct-time"><a href="#结构化时间-mdash-mdash-元祖-：计算用的-struct-time" class="headerlink" title="结构化时间 &mdash;&mdash; 元祖 ：计算用的 struct_time"></a>结构化时间 &mdash;&mdash; 元祖 ：计算用的 struct_time</h1><h1 id="a-简称英文星期"><a href="#a-简称英文星期" class="headerlink" title="%a 简称英文星期"></a>%a 简称英文星期</h1><h1 id="A-全称英文星期"><a href="#A-全称英文星期" class="headerlink" title="%A 全称英文星期"></a>%A 全称英文星期</h1><h1 id="print-time-strftime-“-Y-m-d-a-H-M-S”-year-month-day-HOUR-MINUTE-SECOND"><a href="#print-time-strftime-“-Y-m-d-a-H-M-S”-year-month-day-HOUR-MINUTE-SECOND" class="headerlink" title="print(time.strftime(“%Y-%m-%d %a %H:%M:%S”))  #year month day HOUR MINUTE SECOND"></a>print(time.strftime(“%Y-%m-%d %a %H:%M:%S”))  #year month day HOUR MINUTE SECOND</h1><h1 id="print-time-strftime-“-Y-m-d-H-M-S”-year-month-day-HOUR-MINUTE-SECOND"><a href="#print-time-strftime-“-Y-m-d-H-M-S”-year-month-day-HOUR-MINUTE-SECOND" class="headerlink" title="print(time.strftime(“%Y/%m/%d %H:%M:%S”))  #year month day HOUR MINUTE SECOND"></a>print(time.strftime(“%Y/%m/%d %H:%M:%S”))  #year month day HOUR MINUTE SECOND</h1><h1 id="print-time-strftime-“-m-d-H-M-S”-year-month-day-HOUR-MINUTE-SECOND"><a href="#print-time-strftime-“-m-d-H-M-S”-year-month-day-HOUR-MINUTE-SECOND" class="headerlink" title="print(time.strftime(“%m-%d %H:%M:%S”))  #year month day HOUR MINUTE SECOND"></a>print(time.strftime(“%m-%d %H:%M:%S”))  #year month day HOUR MINUTE SECOND</h1><h1 id="print-time-strftime-“-H-M-S”-year-month-day-HOUR-MINUTE-SECOND"><a href="#print-time-strftime-“-H-M-S”-year-month-day-HOUR-MINUTE-SECOND" class="headerlink" title="print(time.strftime(“%H:%M:%S”))  #year month day HOUR MINUTE SECOND"></a>print(time.strftime(“%H:%M:%S”))  #year month day HOUR MINUTE SECOND</h1><h1 id="print-time-strftime-“-H-M”-year-month-day-HOUR-MINUTE-SECOND"><a href="#print-time-strftime-“-H-M”-year-month-day-HOUR-MINUTE-SECOND" class="headerlink" title="print(time.strftime(“%H:%M”))  #year month day HOUR MINUTE SECOND"></a>print(time.strftime(“%H:%M”))  #year month day HOUR MINUTE SECOND</h1><h1 id="struct-time-time-localtime"><a href="#struct-time-time-localtime" class="headerlink" title="struct_time = time.localtime()"></a>struct_time = time.localtime()</h1><h1 id="print-struct-time"><a href="#print-struct-time" class="headerlink" title="print(struct_time)"></a>print(struct_time)</h1><h1 id="print-struct-time-tm-year"><a href="#print-struct-time-tm-year" class="headerlink" title="print(struct_time.tm_year)"></a>print(struct_time.tm_year)</h1><h1 id="时间戳和结构化时间"><a href="#时间戳和结构化时间" class="headerlink" title="时间戳和结构化时间"></a>时间戳和结构化时间</h1><h1 id="t-time-time"><a href="#t-time-time" class="headerlink" title="t = time.time()"></a>t = time.time()</h1><h1 id="print-t"><a href="#print-t" class="headerlink" title="print(t)"></a>print(t)</h1><h1 id="print-time-localtime-3000000000-结构北京时间"><a href="#print-time-localtime-3000000000-结构北京时间" class="headerlink" title="print(time.localtime(3000000000)) # 结构北京时间"></a>print(time.localtime(3000000000)) # 结构北京时间</h1><h1 id="print-time-gmtime-t-结构-格林威治时间"><a href="#print-time-gmtime-t-结构-格林威治时间" class="headerlink" title="print(time.gmtime(t)) # 结构 格林威治时间"></a>print(time.gmtime(t)) # 结构 格林威治时间</h1><h1 id="print-time-mktime-time-localtime-时间戳"><a href="#print-time-mktime-time-localtime-时间戳" class="headerlink" title="print(time.mktime(time.localtime())) # 时间戳"></a>print(time.mktime(time.localtime())) # 时间戳</h1><h1 id="print-time-strptime-‘2000-12-31’-’-Y-m-d’-转为结构化时间"><a href="#print-time-strptime-‘2000-12-31’-’-Y-m-d’-转为结构化时间" class="headerlink" title="print(time.strptime(‘2000-12.31’,’%Y-%m.%d’)) # 转为结构化时间"></a>print(time.strptime(‘2000-12.31’,’%Y-%m.%d’)) # 转为结构化时间</h1><h1 id="print-time-strftime-‘-m-d-Y-H-M-S’-time-localtime-3000000000-结构化转格式化"><a href="#print-time-strftime-‘-m-d-Y-H-M-S’-time-localtime-3000000000-结构化转格式化" class="headerlink" title="print(time.strftime(‘%m/%d/%Y %H:%M:%S’,time.localtime(3000000000))) # 结构化转格式化"></a>print(time.strftime(‘%m/%d/%Y %H:%M:%S’,time.localtime(3000000000))) # 结构化转格式化</h1><h1 id="print-time-asctime-asc串"><a href="#print-time-asctime-asc串" class="headerlink" title="print(time.asctime()) # asc串"></a>print(time.asctime()) # asc串</h1><h1 id="print-time-asctime-结构化-转asc"><a href="#print-time-asctime-结构化-转asc" class="headerlink" title="print(time.asctime(结构化)) # 转asc"></a>print(time.asctime(结构化)) # 转asc</h1><h1 id="print-time-ctime-时间戳-转asc"><a href="#print-time-ctime-时间戳-转asc" class="headerlink" title="print(time.ctime(时间戳)) # 转asc"></a>print(time.ctime(时间戳)) # 转asc</h1><h1 id="思考题-两个时间相减-显示差了几年-几月-几天"><a href="#思考题-两个时间相减-显示差了几年-几月-几天" class="headerlink" title="思考题:两个时间相减,显示差了几年,几月,几天"></a>思考题:两个时间相减,显示差了几年,几月,几天</h1><h1 id="张天福-mdash-mdash-中国茶叶之父"><a href="#张天福-mdash-mdash-中国茶叶之父" class="headerlink" title="张天福 &mdash;&mdash; 中国茶叶之父"></a>张天福 &mdash;&mdash; 中国茶叶之父</h1><pre><code class="hljs"># 陈味聪# 周天霖</code></pre></div><h1 id="绿茶-：-龙井-碧螺春-竹叶青-信阳毛尖-六安瓜片-太平猴魁-安吉白茶"><a href="#绿茶-：-龙井-碧螺春-竹叶青-信阳毛尖-六安瓜片-太平猴魁-安吉白茶" class="headerlink" title="绿茶 ： 龙井 碧螺春 竹叶青 信阳毛尖 六安瓜片 太平猴魁 安吉白茶"></a>绿茶 ： 龙井 碧螺春 竹叶青 信阳毛尖 六安瓜片 太平猴魁 安吉白茶</h1><h1 id="白茶-：-福鼎白茶-银针（100-芽）-白牡丹（一芽一叶）-贡眉（一芽两叶）-寿眉（一芽三叶）"><a href="#白茶-：-福鼎白茶-银针（100-芽）-白牡丹（一芽一叶）-贡眉（一芽两叶）-寿眉（一芽三叶）" class="headerlink" title="白茶 ： 福鼎白茶 银针（100%芽） 白牡丹（一芽一叶） 贡眉（一芽两叶） 寿眉（一芽三叶）"></a>白茶 ： 福鼎白茶 银针（100%芽） 白牡丹（一芽一叶） 贡眉（一芽两叶） 寿眉（一芽三叶）</h1><h1 id="黄茶-：-黄山毛峰-霍山黄芽"><a href="#黄茶-：-黄山毛峰-霍山黄芽" class="headerlink" title="黄茶 ： 黄山毛峰 霍山黄芽"></a>黄茶 ： 黄山毛峰 霍山黄芽</h1><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">random</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import randomrandom.random() # 大于0小于1random.uniform(1,3) # 大于1 小于3random.randint(1,5) # 大于等于1 小于等于5random.randrange(1,10,2)  # 大于等于1 小于10 之间的奇数random.choice([1,'23',[4,5]]) # 1或'23'或[4,5] 任意一个random.sample([1,'23',[4,5]],2) # 任意两个组合 [[4,5],'23']</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">os</span></h1><p class="md-end-block md-p"><span class="md-plain">root,dirs,files in os.walk(path) 返回的是生成器 </span></p><p class="md-end-block md-p"><span class="md-plain">第一条,root = path,dir= path里边的第一级目录,files为第一级文件,</span></p><p class="md-end-block md-p"><span class="md-plain">第二次循环,root为path的上一个循环中root中的第一个</span></p><p class="md-end-block md-p"><span class="md-plain">依次循环</span></p><p class="md-end-block md-p"><span class="md-plain">和使用os.walk(path).<span>_<span>_<span class="md-plain">next()<span>_<span>_<span class="md-plain">获取第一次记录</span></span></span></span></span></span></span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import osos.getcwd()  # 获取当前路径os.chdir(r"xxxx")  # 改变当前脚本执行路径,再次getcwd()会变化os.curdir()  # "."os.pardir()  # ".."# os.chdir("..") = os.chdir(os.pardir())os.makedirs("xxx/yyy")  # 新建文件夹,级联os.removedirs("目录")  # 删除后,到上一级,为空就继续删除os.mkdir("xxx")  # 单级目录os.rmdir("xxx")  # 单级空目录os.listdir("xxx")os.remove("xxx")  # 删除文件os.rename("old","new")  #os.stat("path/file")  # 获取文件/目录信息 ,大小,修改时间等os.sep  # 路径分隔符 win \\ linux / 跨平台使用os.linesep  # 当前终止符 win \t\n linux \nos.pathsep  # 路径文件分隔符 win ; linux :os.name  # 字符串指示当前使用的平台 win nt; linux posixos.system("bash command")  # 不用打印直接输出,但无返回值os.popen("bash command").read()  # 获取执行结果,os.environ  # 环境变量os.pathos.path.abspath("path")  # 返回path绝对路径os.path.split("path")  # 返回目录与文件名,元祖返回os.path.dirname("path")  # 返回path目录,不包括文件os.path.basename("path")  # 返回最后的文件名,若/ \ 结尾返回空<p>os.path.exists(“path”)  #True Flase<br>os.path.isabs(“path”) # 是否是绝对路径<br>os.path.isfile(“path”)</p><p>os.path.isdir(“path”)  # 是否存在(目录)<br>print(os.path.join(“xxx”,”yyy”,”zzz”)) # 拼接为 xxx\yyy\zzz,<br>os.path.getatime(“path”)  # 最后访问时间<br>os.path.getmtime(“path”)  # 最后修改时间<br>os.path.getsize(“path”)  # 大小<br></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">sys</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import syssys.platform   # 返回操作系统位数sys.version  # 返回python版本sys.exit()  # 程序退出 0 正常退出,非0 不正常sys.path  # 所有搜索模块的路径,list,当前路径,python默认包路径等...sys.path.clear()  # 清空后 import os 无效sys.argv  #  python xxx.py a b c ;# 用于接收 a b c 等参数 list# 不用input,节省时间</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">序列化模块</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">'abdsafaslhiewhldvjlmvlvk['# 序列化 &mdash;&mdash; 转向一个字符串数据类型# 序列 &mdash;&mdash; 字符串<p>“{‘k’:’v’}”</p><h1 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h1><h1 id="网络上传输的时候"><a href="#网络上传输的时候" class="headerlink" title="网络上传输的时候"></a>网络上传输的时候</h1><h1 id="从数据类型-–-gt-字符串的过程-序列化"><a href="#从数据类型-–-gt-字符串的过程-序列化" class="headerlink" title="从数据类型 –&gt; 字符串的过程 序列化"></a>从数据类型 –&gt; 字符串的过程 序列化</h1><h1 id="从字符串-–-gt-数据类型的过程-反序列化"><a href="#从字符串-–-gt-数据类型的过程-反序列化" class="headerlink" title="从字符串 –&gt; 数据类型的过程 反序列化"></a>从字符串 –&gt; 数据类型的过程 反序列化</h1><h1 id="json-非常重要"><a href="#json-非常重要" class="headerlink" title="json ***** 非常重要"></a>json ***** 非常重要</h1><h1 id="pickle"><a href="#pickle" class="headerlink" title="pickle ****"></a>pickle ****</h1><h1 id="shelve-python3-新出现的"><a href="#shelve-python3-新出现的" class="headerlink" title="shelve *** python3 新出现的"></a>shelve *** python3 新出现的</h1><h1 id="json-数字-字符串-列表-字典-元组-转为list-反序列后还是list"><a href="#json-数字-字符串-列表-字典-元组-转为list-反序列后还是list" class="headerlink" title="json  # 数字 字符串 列表 字典 元组(转为list),反序列后还是list"></a>json  # 数字 字符串 列表 字典 元组(转为list),反序列后还是list</h1><pre><code class="hljs"># 通用的序列化格式# 只有很少的一部分数据类型能够通过json转化成字符串# 只有json,方式文件中的可读</code></pre></div><h1 id="pickle-1"><a href="#pickle-1" class="headerlink" title="pickle"></a>pickle</h1><div class="code-wrapper"><pre><code class="hljs"># (所有的python中的数据类型)都可以转化成字符串形式# pickle序列化的内容(只有python能理解)# 且部分反序列化依赖python代码</code></pre></div><h1 id="shelve"><a href="#shelve" class="headerlink" title="shelve"></a>shelve</h1><div class="code-wrapper"><pre><code class="hljs"># 序列化句柄# 使用句柄直接操作，非常方便</code></pre></div><h1 id="json-dumps序列化方法-loads反序列化方法-内存数据"><a href="#json-dumps序列化方法-loads反序列化方法-内存数据" class="headerlink" title="json dumps序列化方法 loads反序列化方法 内存数据"></a>json dumps序列化方法 loads反序列化方法 内存数据</h1><h1 id="dic-1-”a”-2-’b’"><a href="#dic-1-”a”-2-’b’" class="headerlink" title="dic = {1:”a”,2:’b’}"></a>dic = {1:”a”,2:’b’}</h1><h1 id="print-type-dic-dic-lt-class-‘dict’-gt-1-”a”-2-’b’"><a href="#print-type-dic-dic-lt-class-‘dict’-gt-1-”a”-2-’b’" class="headerlink" title="print(type(dic),dic) # &lt;class ‘dict’&gt; {1:”a”,2:’b’}"></a>print(type(dic),dic) # &lt;class ‘dict’&gt; {1:”a”,2:’b’}</h1><h1 id="import-json"><a href="#import-json" class="headerlink" title="import json"></a>import json</h1><h1 id="str-d-json-dumps-dic-序列化"><a href="#str-d-json-dumps-dic-序列化" class="headerlink" title="str_d = json.dumps(dic)   # 序列化"></a>str_d = json.dumps(dic)   # 序列化</h1><h1 id="print-type-str-d-str-d-lt-class-‘str’-gt-1-”a”-2-’b’"><a href="#print-type-str-d-str-d-lt-class-‘str’-gt-1-”a”-2-’b’" class="headerlink" title="print(type(str_d),str_d) #  &lt;class ‘str’&gt; {1:”a”,2:’b’}"></a>print(type(str_d),str_d) #  &lt;class ‘str’&gt; {1:”a”,2:’b’}</h1><h1 id="‘-“kkk”-”v”-’-字符串元素全部双引号显示"><a href="#‘-“kkk”-”v”-’-字符串元素全部双引号显示" class="headerlink" title="# ‘{“kkk”:”v”}’ 字符串元素全部双引号显示"></a># ‘{“kkk”:”v”}’ 字符串元素全部双引号显示</h1><h1 id="dic-d-json-loads-str-d-反序列化"><a href="#dic-d-json-loads-str-d-反序列化" class="headerlink" title="dic_d = json.loads(str_d) # 反序列化"></a>dic_d = json.loads(str_d) # 反序列化</h1><h1 id="print-type-dic-d-dic-d"><a href="#print-type-dic-d-dic-d" class="headerlink" title="print(type(dic_d),dic_d)"></a>print(type(dic_d),dic_d)</h1><p>import json</p><h1 id="json-dump-load-文件数据"><a href="#json-dump-load-文件数据" class="headerlink" title="json (dump) load  文件数据"></a>json (dump) load  文件数据</h1><h1 id="dic-1-”a”-2-’b’-1"><a href="#dic-1-”a”-2-’b’-1" class="headerlink" title="dic = {1:”a”,2:’b’}"></a>dic = {1:”a”,2:’b’}</h1><h1 id="f-open-‘fff’-’w’-encoding-’utf-8’"><a href="#f-open-‘fff’-’w’-encoding-’utf-8’" class="headerlink" title="f = open(‘fff’,’w’,encoding=’utf-8’)"></a>f = open(‘fff’,’w’,encoding=’utf-8’)</h1><h1 id="json-dump-dic-f"><a href="#json-dump-dic-f" class="headerlink" title="json.dump(dic,f)"></a>json.dump(dic,f)</h1><h1 id="f-close-3"><a href="#f-close-3" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="f-open-‘fff’-没中文可不用写编码"><a href="#f-open-‘fff’-没中文可不用写编码" class="headerlink" title="f = open(‘fff’) # 没中文可不用写编码"></a>f = open(‘fff’) # 没中文可不用写编码</h1><h1 id="res-json-load-f"><a href="#res-json-load-f" class="headerlink" title="res = json.load(f)"></a>res = json.load(f)</h1><h1 id="f-close-4"><a href="#f-close-4" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="print-type-res-res"><a href="#print-type-res-res" class="headerlink" title="print(type(res),res)"></a>print(type(res),res)</h1><p>import json</p><h1 id="json-dump-load"><a href="#json-dump-load" class="headerlink" title="json dump load"></a>json dump load</h1><h1 id="dic-1-”中国”-2-’b’"><a href="#dic-1-”中国”-2-’b’" class="headerlink" title="dic = {1:”中国”,2:’b’}"></a>dic = {1:”中国”,2:’b’}</h1><h1 id="f-open-‘fff’-’w’-encoding-’utf-8’-1"><a href="#f-open-‘fff’-’w’-encoding-’utf-8’-1" class="headerlink" title="f = open(‘fff’,’w’,encoding=’utf-8’)"></a>f = open(‘fff’,’w’,encoding=’utf-8’)</h1><h1 id="json-dump-dic-f-ensure-ascii-False-默认以bytes写入-改为false时可以写中文"><a href="#json-dump-dic-f-ensure-ascii-False-默认以bytes写入-改为false时可以写中文" class="headerlink" title="json.dump(dic,f,ensure_ascii=False) # 默认以bytes写入,改为false时可以写中文"></a>json.dump(dic,f,ensure_ascii=False) # 默认以bytes写入,改为false时可以写中文</h1><h1 id="json-dump-dic-f-ensure-ascii-False"><a href="#json-dump-dic-f-ensure-ascii-False" class="headerlink" title="json.dump(dic,f,ensure_ascii=False)"></a>json.dump(dic,f,ensure_ascii=False)</h1><h1 id="可以两次写"><a href="#可以两次写" class="headerlink" title="可以两次写"></a>可以两次写</h1><h1 id="f-close-5"><a href="#f-close-5" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="f-open-‘fff’-encoding-’utf-8’"><a href="#f-open-‘fff’-encoding-’utf-8’" class="headerlink" title="f = open(‘fff’,encoding=’utf-8’)"></a>f = open(‘fff’,encoding=’utf-8’)</h1><h1 id="res1-json-load-f"><a href="#res1-json-load-f" class="headerlink" title="res1 = json.load(f)"></a>res1 = json.load(f)</h1><h1 id="res2-json-load-f"><a href="#res2-json-load-f" class="headerlink" title="res2 = json.load(f)"></a>res2 = json.load(f)</h1><h1 id="f-close-6"><a href="#f-close-6" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="print-type-res1-res1"><a href="#print-type-res1-res1" class="headerlink" title="print(type(res1),res1)"></a>print(type(res1),res1)</h1><h1 id="print-type-res2-res2"><a href="#print-type-res2-res2" class="headerlink" title="print(type(res2),res2)"></a>print(type(res2),res2)</h1><h1 id="一次读会报错"><a href="#一次读会报错" class="headerlink" title="一次读会报错"></a>一次读会报错</h1><h1 id="json"><a href="#json" class="headerlink" title="json"></a>json</h1><h1 id="dumps-–-gt-‘-n’"><a href="#dumps-–-gt-‘-n’" class="headerlink" title="dumps {} – &gt; ‘{}\n’"></a>dumps {} – &gt; ‘{}\n’</h1><h1 id="一行一行的读"><a href="#一行一行的读" class="headerlink" title="一行一行的读"></a>一行一行的读</h1><h1 id="‘-n’-读出来一行"><a href="#‘-n’-读出来一行" class="headerlink" title="‘{}\n’ 读出来一行"></a>‘{}\n’ 读出来一行</h1><h1 id="‘-’-loads-队一行loads"><a href="#‘-’-loads-队一行loads" class="headerlink" title="‘{}’ loads 队一行loads"></a>‘{}’ loads 队一行loads</h1><h1 id="例-逐行写入"><a href="#例-逐行写入" class="headerlink" title="例 逐行写入"></a>例 逐行写入</h1><h1 id="l-‘k’-’111’-‘k2’-’111’-‘k3’-’111’"><a href="#l-‘k’-’111’-‘k2’-’111’-‘k3’-’111’" class="headerlink" title="l = [{‘k’:’111’},{‘k2’:’111’},{‘k3’:’111’}]"></a>l = [{‘k’:’111’},{‘k2’:’111’},{‘k3’:’111’}]</h1><h1 id="f-open-‘file’-’w’"><a href="#f-open-‘file’-’w’" class="headerlink" title="f = open(‘file’,’w’)"></a>f = open(‘file’,’w’)</h1><h1 id="import-json-1"><a href="#import-json-1" class="headerlink" title="import json"></a>import json</h1><h1 id="for-dic-in-l"><a href="#for-dic-in-l" class="headerlink" title="for dic in l:"></a>for dic in l:</h1><h1 id="str-dic-json-dumps-dic"><a href="#str-dic-json-dumps-dic" class="headerlink" title="str_dic = json.dumps(dic)"></a>str_dic = json.dumps(dic)</h1><h1 id="f-write-str-dic-’-n’"><a href="#f-write-str-dic-’-n’" class="headerlink" title="f.write(str_dic+’\n’)"></a>f.write(str_dic+’\n’)</h1><h1 id="f-close-7"><a href="#f-close-7" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="读"><a href="#读" class="headerlink" title="读"></a>读</h1><h1 id="f-open-‘file’"><a href="#f-open-‘file’" class="headerlink" title="f = open(‘file’)"></a>f = open(‘file’)</h1><h1 id="import-json-2"><a href="#import-json-2" class="headerlink" title="import json"></a>import json</h1><h1 id="l"><a href="#l" class="headerlink" title="l = []"></a>l = []</h1><h1 id="for-line-in-f-1"><a href="#for-line-in-f-1" class="headerlink" title="for line in f:"></a>for line in f:</h1><h1 id="dic-json-loads-line-strip"><a href="#dic-json-loads-line-strip" class="headerlink" title="dic = json.loads(line.strip())"></a>dic = json.loads(line.strip())</h1><h1 id="l-append-dic"><a href="#l-append-dic" class="headerlink" title="l.append(dic)"></a>l.append(dic)</h1><h1 id="f-close-8"><a href="#f-close-8" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="print-l-转回list"><a href="#print-l-转回list" class="headerlink" title="print(l) # 转回list"></a>print(l) # 转回list</h1><p>import pickle  #</p><h1 id="dic-‘k1’-’v1’-’k2’-’v2’-’k3’-’v3’"><a href="#dic-‘k1’-’v1’-’k2’-’v2’-’k3’-’v3’" class="headerlink" title="dic = {‘k1’:’v1’,’k2’:’v2’,’k3’:’v3’}"></a>dic = {‘k1’:’v1’,’k2’:’v2’,’k3’:’v3’}</h1><h1 id="str-dic-pickle-dumps-dic"><a href="#str-dic-pickle-dumps-dic" class="headerlink" title="str_dic = pickle.dumps(dic)"></a>str_dic = pickle.dumps(dic)</h1><h1 id="print-str-dic-一串二进制内容"><a href="#print-str-dic-一串二进制内容" class="headerlink" title="print(str_dic)  #一串二进制内容"></a>print(str_dic)  #一串二进制内容</h1><h1 id="-16"><a href="#-16" class="headerlink" title=""></a></h1><h1 id="dic2-pickle-loads-str-dic"><a href="#dic2-pickle-loads-str-dic" class="headerlink" title="dic2 = pickle.loads(str_dic)"></a>dic2 = pickle.loads(str_dic)</h1><h1 id="print-dic2-字典"><a href="#print-dic2-字典" class="headerlink" title="print(dic2)    #字典"></a>print(dic2)    #字典</h1><h1 id="import-time-文件操作时用rb-wb-可以分部调用"><a href="#import-time-文件操作时用rb-wb-可以分部调用" class="headerlink" title="import time 文件操作时用rb,wb,(可以分部调用)"></a>import time 文件操作时用rb,wb,(可以分部调用)</h1><h1 id="struct-time1-time-localtime-1000000000"><a href="#struct-time1-time-localtime-1000000000" class="headerlink" title="struct_time1  = time.localtime(1000000000)"></a>struct_time1  = time.localtime(1000000000)</h1><h1 id="struct-time2-time-localtime-2000000000"><a href="#struct-time2-time-localtime-2000000000" class="headerlink" title="struct_time2  = time.localtime(2000000000)"></a>struct_time2  = time.localtime(2000000000)</h1><h1 id="f-open-‘pickle-file’-’wb’"><a href="#f-open-‘pickle-file’-’wb’" class="headerlink" title="f = open(‘pickle_file’,’wb’)"></a>f = open(‘pickle_file’,’wb’)</h1><h1 id="pickle-dump-struct-time1-f"><a href="#pickle-dump-struct-time1-f" class="headerlink" title="pickle.dump(struct_time1,f)"></a>pickle.dump(struct_time1,f)</h1><h1 id="pickle-dump-struct-time2-f"><a href="#pickle-dump-struct-time2-f" class="headerlink" title="pickle.dump(struct_time2,f)"></a>pickle.dump(struct_time2,f)</h1><h1 id="f-close-9"><a href="#f-close-9" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="f-open-‘pickle-file’-’rb’"><a href="#f-open-‘pickle-file’-’rb’" class="headerlink" title="f = open(‘pickle_file’,’rb’)"></a>f = open(‘pickle_file’,’rb’)</h1><h1 id="struct-time1-pickle-load-f"><a href="#struct-time1-pickle-load-f" class="headerlink" title="struct_time1 = pickle.load(f)"></a>struct_time1 = pickle.load(f)</h1><h1 id="struct-time2-pickle-load-f"><a href="#struct-time2-pickle-load-f" class="headerlink" title="struct_time2 = pickle.load(f)"></a>struct_time2 = pickle.load(f)</h1><h1 id="print-struct-time1-tm-year"><a href="#print-struct-time1-tm-year" class="headerlink" title="print(struct_time1.tm_year)"></a>print(struct_time1.tm_year)</h1><h1 id="print-struct-time2-tm-year"><a href="#print-struct-time2-tm-year" class="headerlink" title="print(struct_time2.tm_year)"></a>print(struct_time2.tm_year)</h1><h1 id="f-close-10"><a href="#f-close-10" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="-17"><a href="#-17" class="headerlink" title="======================================="></a>=======================================</h1><h1 id="会产生三个临时文件-且不支持多个应用同时写"><a href="#会产生三个临时文件-且不支持多个应用同时写" class="headerlink" title="会产生三个临时文件,且不支持多个应用同时写"></a>会产生三个临时文件,且不支持多个应用同时写</h1><h1 id="import-shelve"><a href="#import-shelve" class="headerlink" title="import shelve"></a>import shelve</h1><h1 id="f-shelve-open-‘shelve-file’"><a href="#f-shelve-open-‘shelve-file’" class="headerlink" title="f = shelve.open(‘shelve_file’)"></a>f = shelve.open(‘shelve_file’)</h1><h1 id="f-‘key’-‘int’-10-‘float’-9-5-‘string’-’Sample-data’-直接对文件句柄操作，就可以存入数据"><a href="#f-‘key’-‘int’-10-‘float’-9-5-‘string’-’Sample-data’-直接对文件句柄操作，就可以存入数据" class="headerlink" title="f[‘key’] = {‘int’:10, ‘float’:9.5, ‘string’:’Sample data’}  #直接对文件句柄操作，就可以存入数据"></a>f[‘key’] = {‘int’:10, ‘float’:9.5, ‘string’:’Sample data’}  #直接对文件句柄操作，就可以存入数据</h1><h1 id="f-close-11"><a href="#f-close-11" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="-18"><a href="#-18" class="headerlink" title=""></a></h1><h1 id="import-shelve-1"><a href="#import-shelve-1" class="headerlink" title="import shelve"></a>import shelve</h1><h1 id="f1-shelve-open-‘shelve-file’"><a href="#f1-shelve-open-‘shelve-file’" class="headerlink" title="f1 = shelve.open(‘shelve_file’)"></a>f1 = shelve.open(‘shelve_file’)</h1><h1 id="existing-f1-‘key’-取出数据的时候也只需要直接用key获取即可，但是如果key不存在会报错"><a href="#existing-f1-‘key’-取出数据的时候也只需要直接用key获取即可，但是如果key不存在会报错" class="headerlink" title="existing = f1[‘key’]  #取出数据的时候也只需要直接用key获取即可，但是如果key不存在会报错"></a>existing = f1[‘key’]  #取出数据的时候也只需要直接用key获取即可，但是如果key不存在会报错</h1><h1 id="f1-close"><a href="#f1-close" class="headerlink" title="f1.close()"></a>f1.close()</h1><h1 id="print-existing"><a href="#print-existing" class="headerlink" title="print(existing)"></a>print(existing)</h1><h1 id="-19"><a href="#-19" class="headerlink" title="======================================"></a>======================================</h1><h1 id="只读方式打开-本应该不能够修改-但有时候却可以修改"><a href="#只读方式打开-本应该不能够修改-但有时候却可以修改" class="headerlink" title="只读方式打开,本应该不能够修改,但有时候却可以修改"></a>只读方式打开,本应该不能够修改,但有时候却可以修改</h1><h1 id="import-shelve-2"><a href="#import-shelve-2" class="headerlink" title="import shelve"></a>import shelve</h1><h1 id="f-shelve-open-‘shelve-file’-flag-’r’"><a href="#f-shelve-open-‘shelve-file’-flag-’r’" class="headerlink" title="f = shelve.open(‘shelve_file’, flag=’r’)"></a>f = shelve.open(‘shelve_file’, flag=’r’)</h1><h1 id="existing-f-‘key’"><a href="#existing-f-‘key’" class="headerlink" title="existing = f[‘key’]"></a>existing = f[‘key’]</h1><h1 id="print-existing-原来内容"><a href="#print-existing-原来内容" class="headerlink" title="print(existing) 原来内容"></a>print(existing) 原来内容</h1><h1 id="f-close-12"><a href="#f-close-12" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="-20"><a href="#-20" class="headerlink" title=""></a></h1><h1 id="f-shelve-open-‘shelve-file’-flag-’r’-1"><a href="#f-shelve-open-‘shelve-file’-flag-’r’-1" class="headerlink" title="f = shelve.open(‘shelve_file’, flag=’r’)"></a>f = shelve.open(‘shelve_file’, flag=’r’)</h1><h1 id="existing2-f-‘key’-修改"><a href="#existing2-f-‘key’-修改" class="headerlink" title="existing2 = f[‘key’]  修改"></a>existing2 = f[‘key’]  修改</h1><h1 id="f-close-13"><a href="#f-close-13" class="headerlink" title="f.close()"></a>f.close()</h1><h1 id="print-existing2-再次打印"><a href="#print-existing2-再次打印" class="headerlink" title="print(existing2) 再次打印"></a>print(existing2) 再次打印</h1><h1 id="-21"><a href="#-21" class="headerlink" title="============================================"></a>============================================</h1><h1 id="修改不生效"><a href="#修改不生效" class="headerlink" title="修改不生效"></a>修改不生效</h1><p>import shelve</p><h1 id="f1-shelve-open-‘shelve-file’-1"><a href="#f1-shelve-open-‘shelve-file’-1" class="headerlink" title="f1 = shelve.open(‘shelve_file’)"></a>f1 = shelve.open(‘shelve_file’)</h1><h1 id="print-f1-‘key’"><a href="#print-f1-‘key’" class="headerlink" title="print(f1[‘key’])"></a>print(f1[‘key’])</h1><h1 id="f1-‘key’-‘new-value’-‘this-was-not-here-before’"><a href="#f1-‘key’-‘new-value’-‘this-was-not-here-before’" class="headerlink" title="f1[‘key’][‘new_value’] = ‘this was not here before’"></a>f1[‘key’][‘new_value’] = ‘this was not here before’</h1><h1 id="f1-close-1"><a href="#f1-close-1" class="headerlink" title="f1.close()"></a>f1.close()</h1><h1 id="writeback-True-生效-会消耗内存-一般都是重新建文件-写入-重命名"><a href="#writeback-True-生效-会消耗内存-一般都是重新建文件-写入-重命名" class="headerlink" title="writeback = True 生效, 会消耗内存, 一般都是重新建文件,写入,重命名"></a>writeback = True 生效, 会消耗内存, 一般都是重新建文件,写入,重命名</h1><p>f2 = shelve.open(‘shelve_file’, writeback=True)<br>print(f2[‘key’])</p><h1 id="f2-‘key’-‘new-value’-‘this-was-not-here-before’"><a href="#f2-‘key’-‘new-value’-‘this-was-not-here-before’" class="headerlink" title="f2[‘key’][‘new_value’] = ‘this was not here before’"></a>f2[‘key’][‘new_value’] = ‘this was not here before’</h1><p>f2.close()</p><h1 id="-22"><a href="#-22" class="headerlink" title="============================================"></a>============================================</h1><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">包</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 把解决一类问题的模块放在同一个文件夹里 &mdash;&mdash; 包'#      import xx.yy.zz  点的左边必须是包#      from xx.yy import zz#      from xx import yy.zz 错误#      例: 包1/包2/包3/文件#      import 包1#      包1.包2.包3.文件.fun()  会出错#      import package   会自动执行包下__init__py文件\#      from 包1 import 包2 # 包1 下init#      from 包1.包2 import 包3 # 包2 init#      from 包1.包2.包3 import 文件 # 包3下 init#       import 包1#      包1.包2.包3.文件.fun()  此时不会出错#      绝对路径,直观,但移动不方便,#      但调用不出错,随便使用# ===================#      使用相对路径#      from . import 包2 # 包1 下init#      from . import 包3 # 包2 init#      from . import 文件 # 包3下 init#      找到包的位置,都可以使用包中的文件#      注意:#      包1/包2,包3,文件1#      包2中文件调用 包3中文件 运行包2下那个文件 出错#      若非要使用,在包2的那个文件中,添加包2的上级目录,即包1 进入sys.path#      包2 文件 from 包3 import 包3文件  即可使用#      文件1调用 包2,包3中文件 运行文件1 不出错#      #####文件1 调用包2文件引用文件3的那个方法(不错)#      包中,包中文件调用出错,只有包外部文件可调用包内文件#      相对路径,只能找到上层目录,但不能找到上层的上层#======================#       还有* 与__all__ 配合使用#=======================================# 总之,最重要的一点 from 或 import 包,文件的时候,看他是否在sys.path 中#=======================================# import os# os.makedirs('glance/api')# os.makedirs('glance/cmd')# os.makedirs('glance/db')# l = []# l.append(open('glance/__init__.py','w'))# l.append(open('glance/api/__init__.py','w'))# l.append(open('glance/api/policy.py','w'))# l.append(open('glance/api/versions.py','w'))# l.append(open('glance/cmd/__init__.py','w'))# l.append(open('glance/cmd/manage.py','w'))# l.append(open('glance/db/models.py','w'))# map(lambda f:f.close() ,l)<h1 id="import-glance-api-policy-as-policy"><a href="#import-glance-api-policy-as-policy" class="headerlink" title="import glance.api.policy as policy"></a>import glance.api.policy as policy</h1><h1 id="policy-get"><a href="#policy-get" class="headerlink" title="policy.get()"></a>policy.get()</h1><h1 id="-23"><a href="#-23" class="headerlink" title=""></a></h1><h1 id="from-dir-glance-api-import-policy"><a href="#from-dir-glance-api-import-policy" class="headerlink" title="from dir.glance.api import policy"></a>from dir.glance.api import policy</h1><h1 id="policy-get-1"><a href="#policy-get-1" class="headerlink" title="policy.get()"></a>policy.get()</h1><h1 id="import-sys-1"><a href="#import-sys-1" class="headerlink" title="import sys"></a>import sys</h1><h1 id="sys-path-insert-0-’C-Users-Administrator-PycharmProjects-s9-day21-dir’"><a href="#sys-path-insert-0-’C-Users-Administrator-PycharmProjects-s9-day21-dir’" class="headerlink" title="sys.path.insert(0,’C:\Users\Administrator\PycharmProjects\s9\day21\dir’)"></a>sys.path.insert(0,’C:\Users\Administrator\PycharmProjects\s9\day21\dir’)</h1><h1 id="print-sys-path"><a href="#print-sys-path" class="headerlink" title="# print(sys.path)"></a># print(sys.path)</h1><h1 id="from-glance-api-import-policy"><a href="#from-glance-api-import-policy" class="headerlink" title="from glance.api import policy"></a>from glance.api import policy</h1><h1 id="policy-get-2"><a href="#policy-get-2" class="headerlink" title="policy.get()"></a>policy.get()</h1><h1 id="from-dir-import-glance"><a href="#from-dir-import-glance" class="headerlink" title="from dir import glance"></a>from dir import glance</h1><h1 id="glance-db-models-register-models-‘mysql’"><a href="#glance-db-models-register-models-‘mysql’" class="headerlink" title="glance.db.models.register_models(‘mysql’)"></a>glance.db.models.register_models(‘mysql’)</h1><h1 id="glance-api-policy-get"><a href="#glance-api-policy-get" class="headerlink" title="glance.api.policy.get()"></a>glance.api.policy.get()</h1><h1 id="使用绝对路径-不管在包内部还是外部-导入了就能用"><a href="#使用绝对路径-不管在包内部还是外部-导入了就能用" class="headerlink" title="使用绝对路径 不管在包内部还是外部 导入了就能用"></a>使用绝对路径 不管在包内部还是外部 导入了就能用</h1><h1 id="不能挪动，但是直观"><a href="#不能挪动，但是直观" class="headerlink" title="不能挪动，但是直观"></a>不能挪动，但是直观</h1><h1 id="from-dir-import-glance-1"><a href="#from-dir-import-glance-1" class="headerlink" title="from dir import glance"></a>from dir import glance</h1><h1 id="glance-api-policy-get-1"><a href="#glance-api-policy-get-1" class="headerlink" title="glance.api.policy.get()"></a>glance.api.policy.get()</h1><h1 id="相对路径"><a href="#相对路径" class="headerlink" title="相对路径"></a>相对路径</h1><h1 id="可以随意移动包-只要能找到包的位置，就可以使用包里的模块"><a href="#可以随意移动包-只要能找到包的位置，就可以使用包里的模块" class="headerlink" title="可以随意移动包 只要能找到包的位置，就可以使用包里的模块"></a>可以随意移动包 只要能找到包的位置，就可以使用包里的模块</h1><h1 id="包里的模块如果想使用其它模块的内容只能使用相对路径，使用了相对路径就不能在包内直接执行了"><a href="#包里的模块如果想使用其它模块的内容只能使用相对路径，使用了相对路径就不能在包内直接执行了" class="headerlink" title="包里的模块如果想使用其它模块的内容只能使用相对路径，使用了相对路径就不能在包内直接执行了"></a>包里的模块如果想使用其它模块的内容只能使用相对路径，使用了相对路径就不能在包内直接执行了</h1><h1 id="bin"><a href="#bin" class="headerlink" title="bin"></a>bin</h1><h1 id="start-py"><a href="#start-py" class="headerlink" title="start.py"></a>start.py</h1><h1 id="conf"><a href="#conf" class="headerlink" title="conf"></a>conf</h1><h1 id="config-py"><a href="#config-py" class="headerlink" title="config.py"></a>config.py</h1><h1 id="my-log-setting-py"><a href="#my-log-setting-py" class="headerlink" title="my_log_setting.py"></a>my_log_setting.py</h1><h1 id="setting-py"><a href="#setting-py" class="headerlink" title="setting.py"></a>setting.py</h1><h1 id="core-核心代码"><a href="#core-核心代码" class="headerlink" title="core 核心代码"></a>core 核心代码</h1><h1 id="core-py"><a href="#core-py" class="headerlink" title="core.py"></a>core.py</h1><h1 id="db-数据信息"><a href="#db-数据信息" class="headerlink" title="db 数据信息"></a>db 数据信息</h1><h1 id="alex-json"><a href="#alex-json" class="headerlink" title="alex_json"></a>alex_json</h1><h1 id="dzf-json"><a href="#dzf-json" class="headerlink" title="dzf_json"></a>dzf_json</h1><h1 id="lib-自定义模块-三方模块"><a href="#lib-自定义模块-三方模块" class="headerlink" title="lib 自定义模块,三方模块"></a>lib 自定义模块,三方模块</h1><h1 id="read-ini-py"><a href="#read-ini-py" class="headerlink" title="read_ini.py"></a>read_ini.py</h1><h1 id="log"><a href="#log" class="headerlink" title="log"></a>log</h1><h1 id="access-log"><a href="#access-log" class="headerlink" title="access_log"></a>access_log</h1><h1 id="error-log"><a href="#error-log" class="headerlink" title="error_log"></a>error_log</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">异常处理</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 语法错误,逻辑错误# 1/0# name# 2+'3'# [][3]#{}['k']# =========================================================# try:#     print('1111')#     # 1/0#     print('2222')#     # name#     # 2+'3'#     # [][3]#     # {}['k']#     ret = int(input('number &gt;&gt;&gt;'))#     print(ret*'*')# except ValueError:#     print('输入的数据类型有误')# except Exception:#     print('你错了，老铁')# else:#     print('没有异常的时候执行else中的代码') # 正常执行完后执行,异常终止时,不处理# =========================================================# def func():#     try:#         f = open('file','w')#         ''''''#         return True#     except:#         return False#     finally:#         print('执行finally了')#         f.close()## print(func())<h1 id="程序一旦发生错误，就从错误的位置停下来了，不在继续执行后面的内容"><a href="#程序一旦发生错误，就从错误的位置停下来了，不在继续执行后面的内容" class="headerlink" title="程序一旦发生错误，就从错误的位置停下来了，不在继续执行后面的内容"></a>程序一旦发生错误，就从错误的位置停下来了，不在继续执行后面的内容</h1><h1 id="使用try和except就能处理异常"><a href="#使用try和except就能处理异常" class="headerlink" title="使用try和except就能处理异常"></a>使用try和except就能处理异常</h1><pre><code class="hljs">#try是我们需要处理的代码#except 后面跟一个错误类型 当代码发生错误且错误类型符合的时候 就会执行except中的代码#except支持多分支#有没有一个能处理所有错误的类型 : Exception    # 有了万能的处理机制仍然需要把能预测到的问题单独处理    # 单独处理的所有内容都应该写在万能异常之前# else : 没有异常的时候执行else中的代码# finally : 不管代码是否异常，都会执行    # finally和return相遇的时候 依然会执行    # 函数里做异常处理用,不管是否异常去做一些收尾工作 f.close,会先执行finally 再return</code></pre></div><h1 id="try"><a href="#try" class="headerlink" title="try:"></a>try:</h1><h1 id="main"><a href="#main" class="headerlink" title="main()"></a>main()</h1><h1 id="except-Exception"><a href="#except-Exception" class="headerlink" title="except Exception:"></a>except Exception:</h1><h1 id="pass-1"><a href="#pass-1" class="headerlink" title="pass"></a>pass</h1><p>try:<br>    print(‘1111’)<br>    # 1/0<br>    print(‘2222’)<br>    # name<br>    # 2+’3’<br>    # [][3]<br>    # {}[‘k’]<br>    ret = int(input(‘number &gt;&gt;&gt;’))<br>    print(ret*’*’)<br>except Exception as error:  # 可输出错误信息<br>    print(‘你错了，老铁’,error)<br></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">面向对象</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 面向对象编程# 所谓模子 就是 类 抽象的 我能知道有什么属性 有什么技能 但不能知道属性具体的值# jin alex nezha 就是对象 有具体的值，属性和技能都是根据类规范的# 自定义类# def 函数名():#     pass#=================# class 类名:#     属性 = 'a'#=================# print(类名.属性)# 类名的作用 就是操作属性 查看属性#==============================# class Person:                 # 类名#     country = 'China'         # 创造了一个只要是这个类就一定有的属性#                               # 类属性 静态属性#     def __init__(self,*args):  # 初始化方法，self是对象，是一个必须传的参数,等于构造方法#         # self就是一个可以存储很多属性的大字典 ,等于this, __dict__#         self.name = args[0]   # 往字典里添加属性的方式发生了一些变化#         self.hp = args[1]#         self.aggr = args[2]#         self.sex = args[3]##     def walk(self,n):         # 方法，(一般情况下必须传self参数)，且必须写在第一个#                               # 后面还可以传其他参数，是自由的#         print('%s走走走,走了%s步'%(self.name,n))#========================================# 静态属性查看# # print(Person.country)        # 类名 可以查看类中的属性，不需要实例化就可以查看#========================================#  普通属性查看# alex = Person('狗剩儿',100,1,'不详')  # 类名还可以实例化对象，alex对象   # 实例化# print(alex.__dict__) # 查看所有属性# print(alex.name)  # 查看属性值# print(alex.hp)  # 查看属性值#================================================# 方法调用# alex.walk(5) # 都可以调用# Person.walk(alex，5)  # 调用方法 类名.方法名(对象名)#================================================# print(Person.__dict__['country']) # 查看静态属性# Person.__dict__['country'] = '印度'# print(alex.__dict__['name'])# alex.__dict__['name'] = '二哥'# print(alex.__dict__)# print(alex.name)# print(alex.name)# alex.name = '二哥'# alex.__dict__['name'] = '二哥'# alex.age = 83# print(alex.__dict__)# print(alex.name)<h1 id="对象-类名"><a href="#对象-类名" class="headerlink" title="对象 = 类名()"></a>对象 = 类名()</h1><h1 id="过程："><a href="#过程：" class="headerlink" title="过程："></a>过程：</h1><pre><code class="hljs"># 类名() 首先 会创造出一个对象，创建了一个self变量# 调用init方法，类名括号里的参数会被这里接收# 执行init方法# 返回self</code></pre></div><h1 id="对象能做的事："><a href="#对象能做的事：" class="headerlink" title="对象能做的事："></a>对象能做的事：</h1><div class="code-wrapper"><pre><code class="hljs"># 查看属性# 调用方法# __dict__ 对于对象的增删改查操作都可以通过字典的语法进行,only contain dynamic attributes</code></pre></div><h1 id="类名能做的事："><a href="#类名能做的事：" class="headerlink" title="类名能做的事："></a>类名能做的事：</h1><div class="code-wrapper"><pre><code class="hljs"># 实例化# 调用方法 : 只不过要自己传递self参数# 调用类中的属性,也就是调用静态属性# __dict__ 对于类中的名字只能看 不能操作,用&quot;.&quot;可以操作</code></pre></div><h1 id="几乎与java类似"><a href="#几乎与java类似" class="headerlink" title="几乎与java类似"></a>几乎与java类似</h1><h1 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h1><h1 id="init方法"><a href="#init方法" class="headerlink" title="init方法"></a>init方法</h1><h1 id="self是什么-self拥有属性都属于对象"><a href="#self是什么-self拥有属性都属于对象" class="headerlink" title="self是什么 self拥有属性都属于对象"></a>self是什么 self拥有属性都属于对象</h1><h1 id="調用類的時候創建self-是一個空的對象-有init初始化"><a href="#調用類的時候創建self-是一個空的對象-有init初始化" class="headerlink" title="調用類的時候創建self,是一個空的對象,有init初始化"></a>調用類的時候創建self,是一個空的對象,有init初始化</h1><h1 id="类中可以定义静态属性"><a href="#类中可以定义静态属性" class="headerlink" title="类中可以定义静态属性"></a>类中可以定义静态属性</h1><h1 id="类中可以定义方法，方法都有一个必须传的参数self"><a href="#类中可以定义方法，方法都有一个必须传的参数self" class="headerlink" title="类中可以定义方法，方法都有一个必须传的参数self"></a>类中可以定义方法，方法都有一个必须传的参数self</h1><h1 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h1><h1 id="实例、对象"><a href="#实例、对象" class="headerlink" title="实例、对象"></a>实例、对象</h1><h1 id="对象查看属性"><a href="#对象查看属性" class="headerlink" title="对象查看属性"></a>对象查看属性</h1><h1 id="对象调用方法"><a href="#对象调用方法" class="headerlink" title="对象调用方法"></a>对象调用方法</h1><h1 id="命名空間"><a href="#命名空間" class="headerlink" title="命名空間"></a>命名空間</h1><h1 id="class-has-static-attribute-function"><a href="#class-has-static-attribute-function" class="headerlink" title="class has static attribute,function"></a>class has static attribute,function</h1><h1 id="object-has-owner-namespace-attribute-not-contain-static-attribute-and-a-pointer-to-class"><a href="#object-has-owner-namespace-attribute-not-contain-static-attribute-and-a-pointer-to-class" class="headerlink" title="object has owner namespace,attribute not (contain static) attribute and a pointer to class,"></a>object has owner namespace,attribute not (contain static) attribute and a pointer to class,</h1><h1 id="beacuse-it-if-you-change-class-static-attribute-by-obj-equal-you-change-memory-address-if-the-attr-is-str-int-and-so-on"><a href="#beacuse-it-if-you-change-class-static-attribute-by-obj-equal-you-change-memory-address-if-the-attr-is-str-int-and-so-on" class="headerlink" title="beacuse it, if you change class static attribute by obj , equal you change memory address ,if the attr is str,int and so on"></a>beacuse it, if you change class static attribute by obj , equal you change memory address ,if the attr is str,int and so on</h1><h1 id="you-will-only-change-the-one-obj，it-will-add-a-dynamic-attribute-in-obj-rsquo-s-dict"><a href="#you-will-only-change-the-one-obj，it-will-add-a-dynamic-attribute-in-obj-rsquo-s-dict" class="headerlink" title="you will only change the one obj，it will add a dynamic attribute in obj&rsquo;s dict"></a>you will only change the one obj，it will add a dynamic attribute in obj&rsquo;s <strong>dict</strong></h1><h1 id="if-the-static-is-list-dict-and-so-on-all-obj-and-the-static-attr-will-be-changed"><a href="#if-the-static-is-list-dict-and-so-on-all-obj-and-the-static-attr-will-be-changed" class="headerlink" title="if the static is list ,dict and so on, all obj and the static attr will be changed"></a>if the static is list ,dict and so on, all obj and the static attr will be changed</h1><h1 id="object-execute-the-static-attribute-but-can’t-find-it-will-find-it-in-class-namespace"><a href="#object-execute-the-static-attribute-but-can’t-find-it-will-find-it-in-class-namespace" class="headerlink" title="object execute the static attribute ,but can’t find it ,will find it in class namespace"></a>object execute the static attribute ,but can’t find it ,will find it in class namespace</h1><p></pre></p><h2 class="md-end-block md-heading"><span class="md-plain">面向对象2</span></h2><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"></pre></div><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># 导入包的时候，相当于实例化对象，对调用__init__ 在进行方法使用# 面向对象：继承 多态 封装# =======================# 继承：单继承与多继承(独有)# 父类，超类，基类# 子类，派生类# class Person:pass# class Substance:pass# class Student(Person,Substance):pass## print(Student.__bases__)  # (&lt;class '__main__.Person'&gt;, &lt;class '__main__.Substance'&gt;)# print(Person.__bases__)  # (&lt;class 'object'&gt;,) python3中，没有显示继承类，都默认继承object类<h1 id="class-Animal"><a href="#class-Animal" class="headerlink" title="class Animal:"></a>class Animal:</h1><h1 id="def-init-self-name-aggr-hp"><a href="#def-init-self-name-aggr-hp" class="headerlink" title="def init(self,name,aggr,hp):"></a>def <strong>init</strong>(self,name,aggr,hp):</h1><h1 id="self-name-name"><a href="#self-name-name" class="headerlink" title="self.name = name"></a>self.name = name</h1><h1 id="self-aggr-aggr"><a href="#self-aggr-aggr" class="headerlink" title="self.aggr = aggr"></a>self.aggr = aggr</h1><h1 id="self-hp-hp"><a href="#self-hp-hp" class="headerlink" title="self.hp = hp"></a>self.hp = hp</h1><h1 id="self-func-子类的fun"><a href="#self-func-子类的fun" class="headerlink" title="self.func() # 子类的fun"></a>self.func() # 子类的fun</h1><h1 id="def-func-self"><a href="#def-func-self" class="headerlink" title="def func(self):"></a>def func(self):</h1><h1 id="print-123"><a href="#print-123" class="headerlink" title="print(123)"></a>print(123)</h1><h1 id="-24"><a href="#-24" class="headerlink" title=""></a></h1><h1 id="class-Dog-Animal"><a href="#class-Dog-Animal" class="headerlink" title="class Dog(Animal):"></a>class Dog(Animal):</h1><h1 id="def-func-self-1"><a href="#def-func-self-1" class="headerlink" title="def func(self):"></a>def func(self):</h1><h1 id="print-456"><a href="#print-456" class="headerlink" title="print(456)"></a>print(456)</h1><h1 id="def-bite-self-person"><a href="#def-bite-self-person" class="headerlink" title="def bite(self,person):"></a>def bite(self,person):</h1><h1 id="person-hp-self-aggr"><a href="#person-hp-self-aggr" class="headerlink" title="person.hp -= self.aggr"></a>person.hp -= self.aggr</h1><h1 id="d1-Dog-“dzf”-1"><a href="#d1-Dog-“dzf”-1" class="headerlink" title="d1 = Dog(“dzf”,1)"></a>d1 = Dog(“dzf”,1)</h1><h1 id="print-d1"><a href="#print-d1" class="headerlink" title="print(d1)"></a>print(d1)</h1><h1 id="子类没有init-会默认执行父类的init-，即把参数传给父类的init-注意与java不同"><a href="#子类没有init-会默认执行父类的init-，即把参数传给父类的init-注意与java不同" class="headerlink" title="子类没有init 会默认执行父类的init ，即把参数传给父类的init 注意与java不同"></a>子类没有init 会默认执行父类的init ，即把参数传给父类的init 注意与java不同</h1><h1 id="对于方法的重写，与java相同-字节实现自己的方法若要包含父类的方法Father-fun-self-即可-python3-中-有super"><a href="#对于方法的重写，与java相同-字节实现自己的方法若要包含父类的方法Father-fun-self-即可-python3-中-有super" class="headerlink" title="对于方法的重写，与java相同,字节实现自己的方法若要包含父类的方法Father.fun(self)即可 python3 中 有super"></a>对于方法的重写，与java相同,字节实现自己的方法若要包含父类的方法Father.fun(self)即可 python3 中 有super</h1><h1 id="super-init-x-x-此种也可以，不用传递self"><a href="#super-init-x-x-此种也可以，不用传递self" class="headerlink" title="super().init(x,x) 此种也可以，不用传递self"></a>super().<strong>init</strong>(x,x) 此种也可以，不用传递self</h1><h1 id="super-原对象，self-这两个参数是省略的"><a href="#super-原对象，self-这两个参数是省略的" class="headerlink" title="super(原对象，self) 这两个参数是省略的"></a>super(原对象，self) 这两个参数是省略的</h1><h1 id="在类外部super-x，self-fun-可调用x父类的fun方法"><a href="#在类外部super-x，self-fun-可调用x父类的fun方法" class="headerlink" title="在类外部super(x，self).fun() 可调用x父类的fun方法"></a>在类外部super(x，self).fun() 可调用x父类的fun方法</h1><h1 id="当子类有init时-调用自己的，-super-x-y-x-—-gt-Father-init-self-x-y-self-z-z"><a href="#当子类有init时-调用自己的，-super-x-y-x-—-gt-Father-init-self-x-y-self-z-z" class="headerlink" title="当子类有init时 调用自己的， super(x,y,x) —-&gt; Father.init(self,x,y);self.z=z"></a>当子类有init时 调用自己的， super(x,y,x) —-&gt; Father.<strong>init</strong>(self,x,y);self.z=z</h1><h1 id="推荐使用单继承，设计模式中-使用多继承，不常用"><a href="#推荐使用单继承，设计模式中-使用多继承，不常用" class="headerlink" title="推荐使用单继承，设计模式中 使用多继承，不常用"></a>推荐使用单继承，设计模式中 使用多继承，不常用</h1><h1 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h1><h1 id="子类继承父类方法，并重写，切父类都有这个方法"><a href="#子类继承父类方法，并重写，切父类都有这个方法" class="headerlink" title="子类继承父类方法，并重写，切父类都有这个方法"></a>子类继承父类方法，并重写，切父类都有这个方法</h1><h1 id="父类的方法时，会按照次序，先自己，从左向右调用父类的"><a href="#父类的方法时，会按照次序，先自己，从左向右调用父类的" class="headerlink" title="父类的方法时，会按照次序，先自己，从左向右调用父类的"></a>父类的方法时，会按照次序，先自己，从左向右调用父类的</h1><h1 id="经典问题：钻石继承问题-图1，3"><a href="#经典问题：钻石继承问题-图1，3" class="headerlink" title="经典问题：钻石继承问题 图1，3"></a>经典问题：钻石继承问题 图1，3</h1><h1 id="此时同父类：A-B-C-继承A-，D继承BC，-D调用方式，先按照顺序BC，再A"><a href="#此时同父类：A-B-C-继承A-，D继承BC，-D调用方式，先按照顺序BC，再A" class="headerlink" title="此时同父类：A B,C 继承A ，D继承BC， D调用方式，先按照顺序BC，再A"></a>此时同父类：A B,C 继承A ，D继承BC， D调用方式，先按照顺序BC，再A</h1><h1 id="先广度找，再深度，广度优先-bc"><a href="#先广度找，再深度，广度优先-bc" class="headerlink" title="先广度找，再深度，广度优先 bc"></a>先广度找，再深度，广度优先 bc</h1><h1 id="若-B-继承A，-C继承F-D继承bc，-此时先-b-a-再-c-d"><a href="#若-B-继承A，-C继承F-D继承bc，-此时先-b-a-再-c-d" class="headerlink" title="若 B 继承A， C继承F D继承bc， 此时先 b  a 再 c d"></a>若 B 继承A， C继承F D继承bc， 此时先 b  a 再 c d</h1><h1 id="即若后边可以找到，就放在后边找，"><a href="#即若后边可以找到，就放在后边找，" class="headerlink" title="即若后边可以找到，就放在后边找，"></a>即若后边可以找到，就放在后边找，</h1><h1 id="按照（广度）优先遍历算法-，不能重复-2"><a href="#按照（广度）优先遍历算法-，不能重复-2" class="headerlink" title="按照（广度）优先遍历算法 ，不能重复 2"></a>按照（广度）优先遍历算法 ，不能重复 2</h1><h1 id="python2中按照深度优先查找，一条路到黑"><a href="#python2中按照深度优先查找，一条路到黑" class="headerlink" title="python2中按照深度优先查找，一条路到黑"></a>python2中按照深度优先查找，一条路到黑</h1><h1 id="注意super-再多继承时调用的不是父类的方法，而是按照查找顺序-调用-图4"><a href="#注意super-再多继承时调用的不是父类的方法，而是按照查找顺序-调用-图4" class="headerlink" title="注意super() 再多继承时调用的不是父类的方法，而是按照查找顺序 调用 图4"></a>注意super() 再多继承时调用的不是父类的方法，而是按照查找顺序 调用 图4</h1><h1 id="Class-mro-列表返回class-到object-的继承顺序"><a href="#Class-mro-列表返回class-到object-的继承顺序" class="headerlink" title="Class.mro() 列表返回class 到object 的继承顺序"></a>Class.mro() 列表返回class 到object 的继承顺序</h1><h1 id="class-A-pass"><a href="#class-A-pass" class="headerlink" title="class A:pass"></a>class A:pass</h1><h1 id="class-B-A-pass"><a href="#class-B-A-pass" class="headerlink" title="class B(A):pass"></a>class B(A):pass</h1><h1 id="class-C-A-pass"><a href="#class-C-A-pass" class="headerlink" title="class C(A):pass"></a>class C(A):pass</h1><h1 id="class-D-B-pass"><a href="#class-D-B-pass" class="headerlink" title="class D(B):pass"></a>class D(B):pass</h1><h1 id="class-E-C-pass"><a href="#class-E-C-pass" class="headerlink" title="class E(C):pass"></a>class E(C):pass</h1><h1 id="class-F-D-E-pass"><a href="#class-F-D-E-pass" class="headerlink" title="class F(D,E):pass"></a>class F(D,E):pass</h1><h1 id="-25"><a href="#-25" class="headerlink" title=""></a></h1><h1 id="print-F-mro"><a href="#print-F-mro" class="headerlink" title="print(F.mro())"></a>print(F.mro())</h1><h1 id="接口类：原生不支持"><a href="#接口类：原生不支持" class="headerlink" title="接口类：原生不支持"></a>接口类：原生不支持</h1><h1 id="抽象类：原生支持"><a href="#抽象类：原生支持" class="headerlink" title="抽象类：原生支持"></a>抽象类：原生支持</h1><h1 id="from-abc-import-abstractmethod-ABCMeta-装饰器"><a href="#from-abc-import-abstractmethod-ABCMeta-装饰器" class="headerlink" title="from abc import abstractmethod,ABCMeta # 装饰器"></a>from abc import abstractmethod,ABCMeta # 装饰器</h1><h1 id="class-Payment-metaclass-ABCMeta"><a href="#class-Payment-metaclass-ABCMeta" class="headerlink" title="class Payment(metaclass=ABCMeta):"></a>class Payment(metaclass=ABCMeta):</h1><h1 id="abstractmethod"><a href="#abstractmethod" class="headerlink" title="@abstractmethod"></a>@abstractmethod</h1><h1 id="def-pay-self-x"><a href="#def-pay-self-x" class="headerlink" title="def pay(self,x):"></a>def pay(self,x):</h1><h1 id="pass-2"><a href="#pass-2" class="headerlink" title="pass"></a>pass</h1><h1 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h1><h1 id="接口类，默认多继承，接口类中所有方法都要不实现（pass）"><a href="#接口类，默认多继承，接口类中所有方法都要不实现（pass）" class="headerlink" title="接口类，默认多继承，接口类中所有方法都要不实现（pass）"></a>接口类，默认多继承，接口类中所有方法都要不实现（pass）</h1><h1 id="抽象类，不支持多继承，里面方法可以有一些实现-，当两者书写形式相同"><a href="#抽象类，不支持多继承，里面方法可以有一些实现-，当两者书写形式相同" class="headerlink" title="抽象类，不支持多继承，里面方法可以有一些实现 ，当两者书写形式相同"></a>抽象类，不支持多继承，里面方法可以有一些实现 ，当两者书写形式相同</h1><h1 id="其他类继承时-必须要实现"><a href="#其他类继承时-必须要实现" class="headerlink" title="其他类继承时 必须要实现"></a>其他类继承时 必须要实现</h1><h1 id="接口隔离，一个接口与一个方法"><a href="#接口隔离，一个接口与一个方法" class="headerlink" title="接口隔离，一个接口与一个方法"></a>接口隔离，一个接口与一个方法</h1><h1 id="本是没有接口的，因为自带多继承，通过这种方式模拟，接口-抽象类"><a href="#本是没有接口的，因为自带多继承，通过这种方式模拟，接口-抽象类" class="headerlink" title="本是没有接口的，因为自带多继承，通过这种方式模拟，接口 抽象类"></a>本是没有接口的，因为自带多继承，通过这种方式模拟，接口 抽象类</h1><h1 id="与java相同，二者不能实例化"><a href="#与java相同，二者不能实例化" class="headerlink" title="与java相同，二者不能实例化"></a>与java相同，二者不能实例化</h1><h1 id="python-天生支持多态-不用通过第三个类，实现一起调用"><a href="#python-天生支持多态-不用通过第三个类，实现一起调用" class="headerlink" title="python 天生支持多态 不用通过第三个类，实现一起调用"></a>python 天生支持多态 不用通过第三个类，实现一起调用</h1><h1 id="鸭子类型：依赖父类的情况下实现两个同名方法"><a href="#鸭子类型：依赖父类的情况下实现两个同名方法" class="headerlink" title="鸭子类型：依赖父类的情况下实现两个同名方法"></a>鸭子类型：依赖父类的情况下实现两个同名方法</h1><h1 id="封装性，隐藏属性，方法"><a href="#封装性，隐藏属性，方法" class="headerlink" title="封装性，隐藏属性，方法"></a>封装性，隐藏属性，方法</h1><p>class Person:<br>    def <strong>init</strong>(self,name,passwd):<br>        self.name=name<br>        self.__passwd = passwd # 属性以双下划线开头 即为私有属性<br>dzf = Person(“dzf”,”123456”)<br>print(dzf)<br>print(dzf.name)</p><h1 id="print-dzf-passwd-打印出错"><a href="#print-dzf-passwd-打印出错" class="headerlink" title="print(dzf.passwd) # 打印出错"></a>print(dzf.passwd) # 打印出错</h1><p>print(dzf.<strong>dict</strong>) # –&gt;{‘name’: ‘dzf’, ‘_Person__passwd’: ‘123456’}能查看</p><h1 id="私有属性变为-ldquo-类名属性名"><a href="#私有属性变为-ldquo-类名属性名" class="headerlink" title="私有属性变为 &ldquo;_类名属性名"></a>私有属性变为 &ldquo;_类名属性名</h1><h1 id="对于方法相同，双下划线开头即为私有方法"><a href="#对于方法相同，双下划线开头即为私有方法" class="headerlink" title="对于方法相同，双下划线开头即为私有方法"></a>对于方法相同，双下划线开头即为私有方法</h1><h1 id="静态属性也可定义为私有的"><a href="#静态属性也可定义为私有的" class="headerlink" title="静态属性也可定义为私有的"></a>静态属性也可定义为私有的</h1><p>print(dzf._Person__passwd) # 能查到</p><h1 id="没有真的约束，只是代码级别变形，外部通过-mdash-mdash-类名-mdash-mdash-名字-直接调用-内部-mdash-mdash-名字调用"><a href="#没有真的约束，只是代码级别变形，外部通过-mdash-mdash-类名-mdash-mdash-名字-直接调用-内部-mdash-mdash-名字调用" class="headerlink" title="没有真的约束，只是代码级别变形，外部通过&mdash;&mdash;类名&mdash;&mdash;名字 直接调用 内部&mdash;&mdash;名字调用"></a>没有真的约束，只是代码级别变形，外部通过&mdash;&mdash;类名&mdash;&mdash;名字 直接调用 内部&mdash;&mdash;名字调用</h1><h1 id="父类的私有属性，子类不能调用（静态属性），"><a href="#父类的私有属性，子类不能调用（静态属性），" class="headerlink" title="父类的私有属性，子类不能调用（静态属性），"></a>父类的私有属性，子类不能调用（静态属性），</h1><p></pre></div></p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">面向对象3</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># isinstance(object,cls) # obj 是不是cls的子类# issubclass(sub,super) sub 是super的子类# __dict__ 类中中有方法，有属性，但方法不能通过dict执行#   对象的__dict__只有属性# sys.modules 列表显示模块简称：位置# sys.modules['__main__'] 获取当前模块<h1 id="getattr-sys-modules-‘main‘-xxx-从当前模块反射-防止其他模块重名反射"><a href="#getattr-sys-modules-‘main‘-xxx-从当前模块反射-防止其他模块重名反射" class="headerlink" title="getattr(sys.modules[‘main‘],xxx) # 从当前模块反射,防止其他模块重名反射"></a>getattr(sys.modules[‘<strong>main</strong>‘],xxx) # 从当前模块反射,防止其他模块重名反射</h1><h1 id="但一般不用-main-防止其他模块引用-用-name-代替"><a href="#但一般不用-main-防止其他模块引用-用-name-代替" class="headerlink" title="但一般不用__main__ 防止其他模块引用,用___name__代替"></a>但一般不用__main__ 防止其他模块引用,用___name__代替</h1><h1 id="反射还可以拿到模块中的类-加括号-表示实例化"><a href="#反射还可以拿到模块中的类-加括号-表示实例化" class="headerlink" title="反射还可以拿到模块中的类,加括号 表示实例化"></a>反射还可以拿到模块中的类,加括号 表示实例化</h1><h1 id="类中的内置方法-init-str-repr-等-后两个必须返回字符串"><a href="#类中的内置方法-init-str-repr-等-后两个必须返回字符串" class="headerlink" title="类中的内置方法,init,str,__repr__等,后两个必须返回字符串"></a>类中的内置方法,<strong>init</strong>,<strong>str</strong>,__repr__等,后两个必须返回字符串</h1><h1 id="str-obj-–-gt-obj-str-等同于toString-方法-默认情况继承object-打印地址"><a href="#str-obj-–-gt-obj-str-等同于toString-方法-默认情况继承object-打印地址" class="headerlink" title="str(obj) –&gt;obj.str   等同于toString() 方法,默认情况继承object 打印地址"></a>str(obj) –&gt;obj.<strong>str</strong>   等同于toString() 方法,默认情况继承object 打印地址</h1><h1 id="repr-父类的一样也是打印地址"><a href="#repr-父类的一样也是打印地址" class="headerlink" title="repr ,父类的一样也是打印地址"></a><strong>repr</strong> ,父类的一样也是打印地址</h1><h1 id="s-按照-str"><a href="#s-按照-str" class="headerlink" title="%s 按照 str"></a>%s 按照 <strong>str</strong></h1><h1 id="r-按照-repr"><a href="#r-按照-repr" class="headerlink" title="%r 按照__repr__"></a>%r 按照__repr__</h1><h1 id="repr-是str的备胎-若没有str-会找本类repr-再找父类str"><a href="#repr-是str的备胎-若没有str-会找本类repr-再找父类str" class="headerlink" title="repr 是str的备胎,若没有str,会找本类repr, 再找父类str,"></a>repr 是str的备胎,若没有str,会找本类repr, 再找父类str,</h1><h1 id="但str不是repr的备胎-找不到子类repr-直接找父类repr-一般都实现repr"><a href="#但str不是repr的备胎-找不到子类repr-直接找父类repr-一般都实现repr" class="headerlink" title="但str不是repr的备胎,找不到子类repr 直接找父类repr   一般都实现repr"></a>但str不是repr的备胎,找不到子类repr 直接找父类repr   一般都实现repr</h1><p>#内置方法很多,不一定都在obj  <strong>len</strong></p><h1 id="del-析构函数"><a href="#del-析构函数" class="headerlink" title="del 析构函数"></a>del 析构函数</h1><h1 id="def-del-pass"><a href="#def-del-pass" class="headerlink" title="def del():pass"></a>def <strong>del</strong>():pass</h1><h1 id="del-obj-先执行这个方法-再删除-即时不del-会在解释器结束的时候-调用del"><a href="#del-obj-先执行这个方法-再删除-即时不del-会在解释器结束的时候-调用del" class="headerlink" title="del obj   先执行这个方法,再删除,即时不del 会在解释器结束的时候,调用del"></a>del obj   先执行这个方法,再删除,即时不del 会在解释器结束的时候,调用del</h1><h1 id="call-方法"><a href="#call-方法" class="headerlink" title="call 方法"></a><strong>call</strong> 方法</h1><h1 id="a-A-—-gt-a-—-gt-执行a的call方法-若没有则报错"><a href="#a-A-—-gt-a-—-gt-执行a的call方法-若没有则报错" class="headerlink" title="a = A()()—&gt; a()—&gt;执行a的call方法,若没有则报错"></a>a = A()()—&gt; a()—&gt;执行a的call方法,若没有则报错</h1><h1 id="item系列"><a href="#item系列" class="headerlink" title="item系列"></a>item系列</h1><h1 id="class中实现item-可以通过-a-‘name’-a-name"><a href="#class中实现item-可以通过-a-‘name’-a-name" class="headerlink" title="class中实现item,可以通过 a[‘name’]=a.name"></a>class中实现item,可以通过 a[‘name’]=a.name</h1><h1 id="def-getitem-self-item"><a href="#def-getitem-self-item" class="headerlink" title="def getitem(self,item):"></a>def <strong>getitem</strong>(self,item):</h1><h1 id="if-hasattr-self-item"><a href="#if-hasattr-self-item" class="headerlink" title="if(hasattr(self,item))"></a>if(hasattr(self,item))</h1><h1 id="return-getattr-self-item"><a href="#return-getattr-self-item" class="headerlink" title="return getattr(self,item)"></a>return getattr(self,item)</h1><h1 id="f-item-属性名"><a href="#f-item-属性名" class="headerlink" title="f[item(属性名)]"></a>f[item(属性名)]</h1><h1 id="setitem"><a href="#setitem" class="headerlink" title="setitem"></a>setitem</h1><h1 id="def-setitem-self-key-value-修改属性"><a href="#def-setitem-self-key-value-修改属性" class="headerlink" title="def setitem(self,key,value): # 修改属性"></a>def <strong>setitem</strong>(self,key,value): # 修改属性</h1><h1 id="self-dict-key-value"><a href="#self-dict-key-value" class="headerlink" title="self.dict[key] = value"></a>self.<strong>dict</strong>[key] = value</h1><h1 id="实现setitem-getitem后即可切片"><a href="#实现setitem-getitem后即可切片" class="headerlink" title="实现setitem,getitem后即可切片"></a>实现setitem,getitem后即可切片</h1><h1 id="delitem"><a href="#delitem" class="headerlink" title="delitem"></a>delitem</h1><h1 id="正常情况-del-cls-name-对应的是-delattr-self-item-self-dict-pop-item-object原生的"><a href="#正常情况-del-cls-name-对应的是-delattr-self-item-self-dict-pop-item-object原生的" class="headerlink" title="正常情况 del cls.name 对应的是 delattr(self,item):self.__dict__pop(item)  object原生的"></a>正常情况 del cls.name 对应的是 <strong>delattr</strong>(self,item):self.__dict__pop(item)  object原生的</h1><h1 id="def-delitem-self-item"><a href="#def-delitem-self-item" class="headerlink" title="def delitem(self,item):"></a>def <strong>delitem</strong>(self,item):</h1><h1 id="del-self-dict-item"><a href="#del-self-dict-item" class="headerlink" title="del self.dict[item]"></a>del self.<strong>dict</strong>[item]</h1><h1 id="-26"><a href="#-26" class="headerlink" title=""></a></h1><h1 id="init-初始化方法"><a href="#init-初始化方法" class="headerlink" title="init  初始化方法"></a><strong>init</strong>  初始化方法</h1><h1 id="new-构造方法-创建一个对象-不常用"><a href="#new-构造方法-创建一个对象-不常用" class="headerlink" title="__new__构造方法:创建一个对象,不常用"></a>__new__构造方法:创建一个对象,不常用</h1><h1 id="def-new-cls-args-kwargs"><a href="#def-new-cls-args-kwargs" class="headerlink" title="def new(cls,*args,**kwargs):"></a>def <strong>new</strong>(cls,*args,**kwargs):</h1><h1 id="return-object-new-类名-args-kwargs-这两个参数可以不加-加了可能报错-此时没有self-创建后给init"><a href="#return-object-new-类名-args-kwargs-这两个参数可以不加-加了可能报错-此时没有self-创建后给init" class="headerlink" title="return object.new(类名,*args,**kwargs) # 这两个参数可以不加,加了可能报错 此时没有self, 创建后给init"></a>return object.<strong>new</strong>(类名,*args,**kwargs) # 这两个参数可以不加,加了可能报错 此时没有self, 创建后给init</h1><h1 id="先执行new方法-再init"><a href="#先执行new方法-再init" class="headerlink" title="先执行new方法,再init"></a>先执行new方法,再init</h1><h1 id="一个类-始终-只有-一个-实例"><a href="#一个类-始终-只有-一个-实例" class="headerlink" title="一个类 始终 只有 一个 实例"></a>一个类 始终 只有 一个 实例</h1><h1 id="当你第一次实例化这个类的时候-就创建一个实例化的对象"><a href="#当你第一次实例化这个类的时候-就创建一个实例化的对象" class="headerlink" title="当你第一次实例化这个类的时候 就创建一个实例化的对象"></a>当你第一次实例化这个类的时候 就创建一个实例化的对象</h1><h1 id="当你之后再来实例化的时候-就用之前创建的对象"><a href="#当你之后再来实例化的时候-就用之前创建的对象" class="headerlink" title="当你之后再来实例化的时候 就用之前创建的对象"></a>当你之后再来实例化的时候 就用之前创建的对象</h1><h1 id="class-A"><a href="#class-A" class="headerlink" title="class A:"></a>class A:</h1><h1 id="instance-False"><a href="#instance-False" class="headerlink" title="__instance = False"></a>__instance = False</h1><h1 id="def-init-self-name-age"><a href="#def-init-self-name-age" class="headerlink" title="def init(self,name,age):"></a>def <strong>init</strong>(self,name,age):</h1><h1 id="self-name-name-1"><a href="#self-name-name-1" class="headerlink" title="self.name = name"></a>self.name = name</h1><h1 id="self-age-age"><a href="#self-age-age" class="headerlink" title="self.age = age"></a>self.age = age</h1><h1 id="def-new-cls-args-kwargs-1"><a href="#def-new-cls-args-kwargs-1" class="headerlink" title="def new(cls, *args, **kwargs):"></a>def <strong>new</strong>(cls, *args, **kwargs):</h1><h1 id="if-cls-instance"><a href="#if-cls-instance" class="headerlink" title="if cls.__instance:"></a>if cls.__instance:</h1><h1 id="return-cls-instance"><a href="#return-cls-instance" class="headerlink" title="return cls.__instance"></a>return cls.__instance</h1><h1 id="cls-instance-object-new-cls"><a href="#cls-instance-object-new-cls" class="headerlink" title="cls.__instance = object.new(cls)"></a>cls.__instance = object.<strong>new</strong>(cls)</h1><h1 id="return-cls-instance-1"><a href="#return-cls-instance-1" class="headerlink" title="return cls.__instance"></a>return cls.__instance</h1><h1 id="-27"><a href="#-27" class="headerlink" title=""></a></h1><h1 id="egon-A-‘egg’-38"><a href="#egon-A-‘egg’-38" class="headerlink" title="egon = A(‘egg’,38)"></a>egon = A(‘egg’,38)</h1><h1 id="egon-cloth-‘小花袄’"><a href="#egon-cloth-‘小花袄’" class="headerlink" title="egon.cloth = ‘小花袄’"></a>egon.cloth = ‘小花袄’</h1><h1 id="nezha-A-‘nazha’-25"><a href="#nezha-A-‘nazha’-25" class="headerlink" title="nezha = A(‘nazha’,25)"></a>nezha = A(‘nazha’,25)</h1><h1 id="print-nezha"><a href="#print-nezha" class="headerlink" title="print(nezha)"></a>print(nezha)</h1><h1 id="print-egon"><a href="#print-egon" class="headerlink" title="print(egon)"></a>print(egon)</h1><h1 id="print-nezha-name"><a href="#print-nezha-name" class="headerlink" title="print(nezha.name)"></a>print(nezha.name)</h1><h1 id="print-egon-name"><a href="#print-egon-name" class="headerlink" title="print(egon.name)"></a>print(egon.name)</h1><h1 id="print-nezha-cloth"><a href="#print-nezha-cloth" class="headerlink" title="print(nezha.cloth)"></a>print(nezha.cloth)</h1><h1 id="eq"><a href="#eq" class="headerlink" title="eq"></a><strong>eq</strong></h1><h1 id="默认对象”-”比较-返回地址比较结果-写了-eq-之后-“-”-机会按照eq-与java不同"><a href="#默认对象”-”比较-返回地址比较结果-写了-eq-之后-“-”-机会按照eq-与java不同" class="headerlink" title="默认对象”=”比较 返回地址比较结果,写了__eq__之后 “=” 机会按照eq   与java不同"></a>默认对象”=”比较 返回地址比较结果,写了__eq__之后 “=” 机会按照eq   与java不同</h1><h1 id="is-比较的是地址-不绑定方法-当值str等直接存值的类型时-相同则返回True-其他类型-比较地址"><a href="#is-比较的是地址-不绑定方法-当值str等直接存值的类型时-相同则返回True-其他类型-比较地址" class="headerlink" title="is 比较的是地址,不绑定方法,当值str等直接存值的类型时,相同则返回True,其他类型 比较地址"></a>is 比较的是地址,不绑定方法,当值str等直接存值的类型时,相同则返回True,其他类型 比较地址</h1><h1 id="hash-绑定-hash-hash-中的是按照内存地址hash"><a href="#hash-绑定-hash-hash-中的是按照内存地址hash" class="headerlink" title="hash() 绑定__hash__ hash()中的是按照内存地址hash"></a>hash() 绑定__hash__ hash()中的是按照内存地址hash</h1><h1 id="通过修改-hash-可自定义hash-对于不可变类型-hash值相同"><a href="#通过修改-hash-可自定义hash-对于不可变类型-hash值相同" class="headerlink" title="通过修改__hash__ 可自定义hash,对于不可变类型,hash值相同"></a>通过修改__hash__ 可自定义hash,对于不可变类型,hash值相同</h1><h1 id="nametuple-相当于创建一个类"><a href="#nametuple-相当于创建一个类" class="headerlink" title="nametuple 相当于创建一个类"></a>nametuple 相当于创建一个类</h1><p>list1 =[1,2,3]+list(‘JQKA’)<br>print(list1)<br>from random import shuffle # 打乱顺序,依赖__len__方法 ,__setitem__方法<br>shuffle(list1)<br>print(list1)</p><h1 id="set去重依赖hash-与-eq方法"><a href="#set去重依赖hash-与-eq方法" class="headerlink" title="set去重依赖hash() 与 eq方法"></a>set去重依赖hash() 与 eq方法</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">property</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># property# 内置装饰器函数 只在面向对象中使用，没什么其他的作用from math import piclass Circle:    def __init__(self,r):        self.r = r    @property    def perimeter(self):        return 2*pi*self.r    @property    def area(self):        return self.r**2*pi<h1 id="c1-Circle-5"><a href="#c1-Circle-5" class="headerlink" title="c1 = Circle(5)"></a>c1 = Circle(5)</h1><h1 id="print-c1-area-圆的面积"><a href="#print-c1-area-圆的面积" class="headerlink" title="print(c1.area)     # 圆的面积"></a>print(c1.area)     # 圆的面积</h1><h1 id="print-c1-perimeter-圆的周长"><a href="#print-c1-perimeter-圆的周长" class="headerlink" title="print(c1.perimeter) # 圆的周长"></a>print(c1.perimeter) # 圆的周长</h1><h1 id="class-Person"><a href="#class-Person" class="headerlink" title="class Person:"></a>class Person:</h1><h1 id="def-init-self-name-high-weight"><a href="#def-init-self-name-high-weight" class="headerlink" title="def init(self,name,high,weight):"></a>def <strong>init</strong>(self,name,high,weight):</h1><h1 id="self-name-name-2"><a href="#self-name-name-2" class="headerlink" title="self.name = name"></a>self.name = name</h1><h1 id="self-high-high"><a href="#self-high-high" class="headerlink" title="self.high = high"></a>self.high = high</h1><h1 id="self-weight-weight"><a href="#self-weight-weight" class="headerlink" title="self.weight = weight"></a>self.weight = weight</h1><h1 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h1><h1 id="def-bmi-self"><a href="#def-bmi-self" class="headerlink" title="def bmi(self):"></a>def bmi(self):</h1><h1 id="return-self-weight-self-high-2"><a href="#return-self-weight-self-high-2" class="headerlink" title="return self.weight / self.high**2"></a>return self.weight / self.high**2</h1><h1 id="jin-Person-‘金老板’-1-6-90"><a href="#jin-Person-‘金老板’-1-6-90" class="headerlink" title="jin = Person(‘金老板’,1.6,90)"></a>jin = Person(‘金老板’,1.6,90)</h1><h1 id="jin-bmi-18-当做属性时，不能修改"><a href="#jin-bmi-18-当做属性时，不能修改" class="headerlink" title="jin.bmi = 18    # 当做属性时，不能修改"></a>jin.bmi = 18    # 当做属性时，不能修改</h1><h1 id="classmethod"><a href="#classmethod" class="headerlink" title="classmethod"></a>classmethod</h1><h1 id="staticmethod"><a href="#staticmethod" class="headerlink" title="staticmethod"></a>staticmethod</h1><h1 id="class-Person-1"><a href="#class-Person-1" class="headerlink" title="class Person:"></a>class Person:</h1><h1 id="def-init-self-name"><a href="#def-init-self-name" class="headerlink" title="def init(self,name):"></a>def <strong>init</strong>(self,name):</h1><h1 id="self-name-name-3"><a href="#self-name-name-3" class="headerlink" title="self.__name = name"></a>self.__name = name</h1><h1 id="property-当做属性"><a href="#property-当做属性" class="headerlink" title="@property  #   当做属性"></a>@property  #   当做属性</h1><h1 id="def-na-self"><a href="#def-na-self" class="headerlink" title="def na(self):"></a>def na(self):</h1><h1 id="return-self-name-‘sb’"><a href="#return-self-name-‘sb’" class="headerlink" title="return self.__name + ‘sb’"></a>return self.__name + ‘sb’</h1><h1 id="na-setter-设置setter方法-3个na必须一致"><a href="#na-setter-设置setter方法-3个na必须一致" class="headerlink" title="@na.setter  # 设置setter方法   3个na必须一致"></a>@na.setter  # 设置setter方法   3个na必须一致</h1><h1 id="def-na-self-new-name"><a href="#def-na-self-new-name" class="headerlink" title="def na(self,new_name):"></a>def na(self,new_name):</h1><h1 id="self-name-new-name"><a href="#self-name-new-name" class="headerlink" title="self.__name = new_name"></a>self.__name = new_name</h1><h1 id="-28"><a href="#-28" class="headerlink" title=""></a></h1><h1 id="tiger-Person-‘泰哥’"><a href="#tiger-Person-‘泰哥’" class="headerlink" title="tiger = Person(‘泰哥’)"></a>tiger = Person(‘泰哥’)</h1><h1 id="print-tiger-name"><a href="#print-tiger-name" class="headerlink" title="print(tiger.name)"></a>print(tiger.name)</h1><h1 id="tiger-name-‘全班’-可修改"><a href="#tiger-name-‘全班’-可修改" class="headerlink" title="tiger.name = ‘全班’ # 可修改"></a>tiger.name = ‘全班’ # 可修改</h1><h1 id="print-tiger-name-1"><a href="#print-tiger-name-1" class="headerlink" title="print(tiger.name)"></a>print(tiger.name)</h1><h1 id="class-Goods"><a href="#class-Goods" class="headerlink" title="class Goods:"></a>class Goods:</h1><h1 id="discount-0-8"><a href="#discount-0-8" class="headerlink" title="discount = 0.8"></a>discount = 0.8</h1><h1 id="def-init-self-name-price"><a href="#def-init-self-name-price" class="headerlink" title="def init(self,name,price):"></a>def <strong>init</strong>(self,name,price):</h1><h1 id="self-name-name-4"><a href="#self-name-name-4" class="headerlink" title="self.name = name"></a>self.name = name</h1><h1 id="self-price-price"><a href="#self-price-price" class="headerlink" title="self.__price = price"></a>self.__price = price</h1><h1 id="property-1"><a href="#property-1" class="headerlink" title="@property"></a>@property</h1><h1 id="def-price-self"><a href="#def-price-self" class="headerlink" title="def price(self):"></a>def price(self):</h1><h1 id="return-self-price-Goods-discount"><a href="#return-self-price-Goods-discount" class="headerlink" title="return self.__price * Goods.discount"></a>return self.__price * Goods.discount</h1><h1 id="apple-Goods-‘苹果’-5"><a href="#apple-Goods-‘苹果’-5" class="headerlink" title="apple = Goods(‘苹果’,5)"></a>apple = Goods(‘苹果’,5)</h1><h1 id="print-apple-price"><a href="#print-apple-price" class="headerlink" title="print(apple.price)"></a>print(apple.price)</h1><h1 id="属性-查看-修改-删除"><a href="#属性-查看-修改-删除" class="headerlink" title="属性 查看 修改 删除"></a>属性 查看 修改 删除</h1><h1 id="class-Person-2"><a href="#class-Person-2" class="headerlink" title="class Person:"></a>class Person:</h1><h1 id="def-init-self-name-1"><a href="#def-init-self-name-1" class="headerlink" title="def init(self,name):"></a>def <strong>init</strong>(self,name):</h1><h1 id="self-name-name-5"><a href="#self-name-name-5" class="headerlink" title="self.__name = name"></a>self.__name = name</h1><h1 id="self-price-20"><a href="#self-price-20" class="headerlink" title="self.price = 20"></a>self.price = 20</h1><h1 id="property-2"><a href="#property-2" class="headerlink" title="@property"></a>@property</h1><h1 id="def-name-self"><a href="#def-name-self" class="headerlink" title="def name(self):"></a>def name(self):</h1><h1 id="return-self-name"><a href="#return-self-name" class="headerlink" title="return self.__name"></a>return self.__name</h1><h1 id="name-deleter-属性删除"><a href="#name-deleter-属性删除" class="headerlink" title="@name.deleter  # 属性删除"></a>@name.deleter  # 属性删除</h1><h1 id="def-name-self-1"><a href="#def-name-self-1" class="headerlink" title="def name(self):"></a>def name(self):</h1><h1 id="del-self-name"><a href="#del-self-name" class="headerlink" title="del self.__name"></a>del self.__name</h1><h1 id="name-setter"><a href="#name-setter" class="headerlink" title="@name.setter"></a>@name.setter</h1><h1 id="def-name-self-new-name-只能定义一个参数"><a href="#def-name-self-new-name-只能定义一个参数" class="headerlink" title="def name(self,new_name):  # 只能定义一个参数"></a>def name(self,new_name):  # 只能定义一个参数</h1><h1 id="self-name-new-name-1"><a href="#self-name-new-name-1" class="headerlink" title="self.__name = new_name"></a>self.__name = new_name</h1><h1 id="brother2-Person-‘二哥’"><a href="#brother2-Person-‘二哥’" class="headerlink" title="brother2 = Person(‘二哥’)"></a>brother2 = Person(‘二哥’)</h1><h1 id="del-Person-price"><a href="#del-Person-price" class="headerlink" title="del Person.price"></a>del Person.price</h1><h1 id="brother2-name-‘newName’"><a href="#brother2-name-‘newName’" class="headerlink" title="brother2.name = ‘newName’"></a>brother2.name = ‘newName’</h1><h1 id="brother2"><a href="#brother2" class="headerlink" title="brother2"></a>brother2</h1><h1 id="del-brother2-name"><a href="#del-brother2-name" class="headerlink" title="del brother2.name"></a>del brother2.name</h1><h1 id="print-brother2-name-查看报错-，实际是私有的属性-name-没有了，调用了delete-内部语句-2个name（）还存在"><a href="#print-brother2-name-查看报错-，实际是私有的属性-name-没有了，调用了delete-内部语句-2个name（）还存在" class="headerlink" title="print(brother2.name)  # 查看报错  ，实际是私有的属性__name 没有了，调用了delete 内部语句  2个name（）还存在"></a>print(brother2.name)  # 查看报错  ，实际是私有的属性__name 没有了，调用了delete 内部语句  2个name（）还存在</h1><h1 id="函数属于类，对象不能删除函数"><a href="#函数属于类，对象不能删除函数" class="headerlink" title="函数属于类，对象不能删除函数"></a>函数属于类，对象不能删除函数</h1><p></pre></div></p><p class="md-end-block md-p">&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">反射</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">#反射 *****# name = 'alex'# 'name'<p>class Teacher:<br>    dic = {‘查看学生信息’:’show_student’,’查看讲师信息’:’show_teacher’}<br>    def show_student(self):<br>        print(‘show_student’)</p><pre><code class="hljs">def show_teacher(self):    print(&#39;show_teacher&#39;)@classmethoddef func(cls):    print(&#39;hahaha&#39;)</code></pre></div><p>alex = Teacher()</p><h1 id="getattr-Teacher-’fun’-只能获静态属性，类方法，（静态方法也可）返回方法地址，"><a href="#getattr-Teacher-’fun’-只能获静态属性，类方法，（静态方法也可）返回方法地址，" class="headerlink" title="getattr(Teacher,’fun’) # 只能获静态属性，类方法，（静态方法也可）返回方法地址，"></a>getattr(Teacher,’fun’) # 只能获静态属性，类方法，（静态方法也可）返回方法地址，</h1><h1 id="func-getattr-alex-’show-student’-获取对象属性，变量-方法，动态属性"><a href="#func-getattr-alex-’show-student’-获取对象属性，变量-方法，动态属性" class="headerlink" title="func = getattr(alex,’show_student’)   # 获取对象属性，变量  方法，动态属性"></a>func = getattr(alex,’show_student’)   # 获取对象属性，变量  方法，动态属性</h1><h1 id="func-加括号即可调用"><a href="#func-加括号即可调用" class="headerlink" title="func() 加括号即可调用"></a>func() 加括号即可调用</h1><h1 id="没有get到会报错"><a href="#没有get到会报错" class="headerlink" title="没有get到会报错"></a>没有get到会报错</h1><h1 id="hasattr-getattr-delattr"><a href="#hasattr-getattr-delattr" class="headerlink" title="hasattr getattr delattr"></a>hasattr getattr delattr</h1><h1 id="if-hasattr-Teacher-’dic’"><a href="#if-hasattr-Teacher-’dic’" class="headerlink" title="if hasattr(Teacher,’dic’):"></a>if hasattr(Teacher,’dic’):</h1><h1 id="ret-getattr-Teacher-’dic’-Teacher-dic-类也是对象"><a href="#ret-getattr-Teacher-’dic’-Teacher-dic-类也是对象" class="headerlink" title="ret = getattr(Teacher,’dic’)   # Teacher.dic   # 类也是对象"></a>ret = getattr(Teacher,’dic’)   # Teacher.dic   # 类也是对象</h1><h1 id="ret2-getattr-Teacher-’func’-类-方法-teacher-func"><a href="#ret2-getattr-Teacher-’func’-类-方法-teacher-func" class="headerlink" title="# ret2 = getattr(Teacher,’func’)         # 类.方法  teacher.func"></a># ret2 = getattr(Teacher,’func’)         # 类.方法  teacher.func</h1><h1 id="ret2"><a href="#ret2" class="headerlink" title="# ret2()"></a># ret2()</h1><h1 id="print-ret-1"><a href="#print-ret-1" class="headerlink" title="print(ret)"></a>print(ret)</h1><h1 id="通过反射"><a href="#通过反射" class="headerlink" title="通过反射"></a>通过反射</h1><h1 id="对象名-获取对象属性-和-普通方法"><a href="#对象名-获取对象属性-和-普通方法" class="headerlink" title="对象名 获取对象属性 和 普通方法"></a>对象名 获取对象属性 和 普通方法</h1><h1 id="类名-获取静态属性-和类方法-和-静态方法"><a href="#类名-获取静态属性-和类方法-和-静态方法" class="headerlink" title="类名 获取静态属性 和类方法 和 静态方法"></a>类名 获取静态属性 和类方法 和 静态方法</h1><h1 id="普通方法-self"><a href="#普通方法-self" class="headerlink" title="普通方法 self"></a>普通方法 self</h1><h1 id="静态方法-staticmethod"><a href="#静态方法-staticmethod" class="headerlink" title="静态方法 @staticmethod"></a>静态方法 @staticmethod</h1><h1 id="类方法-classmethod"><a href="#类方法-classmethod" class="headerlink" title="类方法 @classmethod"></a>类方法 @classmethod</h1><h1 id="属性方法-property"><a href="#属性方法-property" class="headerlink" title="属性方法 @property"></a>属性方法 @property</h1><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">class_static_method</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># method 方法# staticmathod  静态的方法 ***# classmethod   类方法    ****# 类的操作行为# class Goods:#     __discount = 0.8#     def __init__(self,name,price):#         self.name = name#         self.__price = price#     @property#     def price(self):#         return self.__price * Goods.__discount#     @classmethod   # 把一个方法 变成一个类中的方法，这个方法就直接可以被类调用，不用传入对象#     def change_discount(cls,new_discount):  # 修改折扣，默认传入cls 表示类#         cls.__discount = new_discount# apple = Goods('苹果',5)# print(apple.price)# Goods.change_discount(0.5)   # Goods.change_discount(Goods) 默认传入cls# print(apple.price)# 当这个方法的操作只涉及静态属性的时候 就应该使用classmethod来装饰这个方法<h1 id="java"><a href="#java" class="headerlink" title="java"></a>java</h1><p>class Login:<br>    def <strong>init</strong>(self,name,password):<br>        self.name = name<br>        self.pwd = password<br>    def login(self):pass</p><pre><code class="hljs">@staticmethoddef get_usr_pwd():   # 静态方法 ，与类没有关系，不用传入cls    usr = input(&#39;用户名 ：&#39;)    pwd = input(&#39;密码 ：&#39;)    Login(usr,pwd)</code></pre></div><p>Login.get_usr_pwd()</p><h1 id="在完全面向对象的程序中，"><a href="#在完全面向对象的程序中，" class="headerlink" title="在完全面向对象的程序中，"></a>在完全面向对象的程序中，</h1><h1 id="如果一个函数-既和对象没有关系-也和类没有关系-那么就用staticmethod将这个函数变成一个静态方法"><a href="#如果一个函数-既和对象没有关系-也和类没有关系-那么就用staticmethod将这个函数变成一个静态方法" class="headerlink" title="如果一个函数 既和对象没有关系 也和类没有关系 那么就用staticmethod将这个函数变成一个静态方法"></a>如果一个函数 既和对象没有关系 也和类没有关系 那么就用staticmethod将这个函数变成一个静态方法</h1><h1 id="类方法和静态方法-都是类调用的"><a href="#类方法和静态方法-都是类调用的" class="headerlink" title="类方法和静态方法 都是类调用的"></a>类方法和静态方法 都是类调用的</h1><h1 id="对象可以调用类方法和静态方法么？-可以-一般情况下-推荐用类名调用，与java相同"><a href="#对象可以调用类方法和静态方法么？-可以-一般情况下-推荐用类名调用，与java相同" class="headerlink" title="对象可以调用类方法和静态方法么？   可以   一般情况下 推荐用类名调用，与java相同"></a>对象可以调用类方法和静态方法么？   可以   一般情况下 推荐用类名调用，与java相同</h1><h1 id="类方法-有一个默认参数-cls-代表这个类-cls"><a href="#类方法-有一个默认参数-cls-代表这个类-cls" class="headerlink" title="类方法 有一个默认参数 cls 代表这个类  cls"></a>类方法 有一个默认参数 cls 代表这个类  cls</h1><h1 id="静态方法-没有默认的参数-和普通函数一样"><a href="#静态方法-没有默认的参数-和普通函数一样" class="headerlink" title="静态方法 没有默认的参数 和普通函数一样"></a>静态方法 没有默认的参数 和普通函数一样</h1><p></pre></p><h1 class="md-end-block md-heading"><span class="md-plain">常用模块</span></h1><h2 class="md-end-block md-heading"><span class="md-plain">hashlib</span></h2><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># import hashlib# md5 = hashlib.md5(bytes("盐值",encoding="utf8")) # 加颜值 sha1,sh3_224,sha3_512# md5.update(b'dzf123') # 只能使用bytes类型,# md5.update(b"123") # 支持分批加密# print(md5.hexdigest()) #16进制# 设置颜色"""    \033[显示方式;前景色;背景色m; xxx  \033[0m    前:30-37 黑红绿黄,蓝紫青白    背:40-47 黑红绿黄,蓝紫青白    显示方式:0 终端默认显示        1 高亮显示        4 使用下划线        5 闪烁  (不好用)        7 反白显示        8 不可见"""# print("\033[0;40;37m dzf \033[0m")# menu  = [('a',2),('b',4),('c',6)]# for i,j in enumerate(menu,1):#     print(i,j)  # i 表示序号,j 每一个元祖 <p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">logging</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># logging 日志模块# 有5种级别的日志记录模式 ：# 两种配置方式：basicconfig 、log对象# logging.debug('debug message')       # 低级别的 # 排错信息# logging.info('info message')            # 正常信息 ,默认info向上,不包括info# logging.warning('warning message')      # 警告信息# logging.error('error message')          # 错误信息# logging.critical('critical message') # 高级别的 # 严重错误信息# =============================================================# format 中参数# name Logger的名字# levelno 数字形式日志级别# levelname 文字形式日志级别# pathname 日志输出模块的完整路径# filename 日志输出函数的模块的文件名# module 日志输出函数的模块名# funcName 日志输出函数的函数名# lineno 行号# created 当前时间,unix 浮点数表示# relativeCreated 自logger创建以来的毫秒数# asctime 当前时间 默认格式:"2019-08-16 21:20:20,875" 毫秒# thread 线程ID ,可能没有# threadName 线程Nname ,可能没有# process 进程ID ,可能没有# message 用户输出的消息# =============================================================# basicconfig 简单 能做的事情相对少    # 中文的乱码问题,好像还不能解决    # 不能同时往文件和屏幕上输出# import logging# level=logging.WARNING # 表示警告及以上的# logging.basicConfig(level=logging.WARNING,#                     format='%(asctime)s %(filename)s[line:%(lineno)d] %(levelname)s %(message)s',#                     datefmt='%a, %d %b %Y %H:%M:%S',#                     filename="log.log",#                     filemode="a")# try:#     int(input('num &gt;&gt;'))# except ValueError:#     logging.error('输入的值不是一个数字')# print("%(x)s"%{"x":"value"})  # 传入x ,值为value# print("%s"%("x"))  # 传入x ,值为value# =================================================================# 配置log对象 稍微有点复杂 能做的事情相对多import logginglogger = logging.getLogger()  # 创建对象fh = logging.FileHandler('log.log',encoding='utf-8')  # 打开文件sh = logging.StreamHandler()    # 创建一个屏幕控制对象formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')formatter2 = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s [line:%(lineno)d] : %(message)s')# 文件操作符 和 格式关联fh.setFormatter(formatter)sh.setFormatter(formatter2)# logger 对象 和 文件操作符 关联logger.addHandler(fh)logger.addHandler(sh)logging.debug('debug message')       # 低级别的 # 排错信息logging.info('info message')            # 正常信息logging.warning('警告错误')      # 警告信息logging.error('error message')          # 错误信息logging.critical('critical message') # 高级别的 # 严重错误信息</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">configparser</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># configparser处理配置文件import configparser# 写文件config = configparser.ConfigParser()  #  实例化config["DEFAULT"] = {'ServerAliveInterval': '45',                      'Compression': 'yes',                     'CompressionLevel': '9',                     'ForwardX11':'yes'                     }config['bitbucket.org'] = {'User':'hg'}config['topsecret.server.com'] = {'Host Port':'50022','ForwardX11':'no'}with open('example.ini', 'w') as f:   config.write(f)"""效果:[DEFAULT]serveraliveinterval = 45compression = yescompressionlevel = 9forwardx11 = yes<p>[bitbucket.org]<br>user = hg</p><p>[topsecret.server.com]<br>host port = 50022<br>forwardx11 = no<br>“””</p><h1 id="import-configparser"><a href="#import-configparser" class="headerlink" title="import configparser"></a>import configparser</h1><h1 id="-29"><a href="#-29" class="headerlink" title=""></a></h1><h1 id="config-configparser-ConfigParser"><a href="#config-configparser-ConfigParser" class="headerlink" title="config = configparser.ConfigParser()"></a>config = configparser.ConfigParser()</h1><h1 id="—————————查找文件内容-基于字典的形式"><a href="#—————————查找文件内容-基于字典的形式" class="headerlink" title="#—————————查找文件内容,基于字典的形式"></a>#—————————查找文件内容,基于字典的形式</h1><h1 id="priprint-config-sections-—-gt"><a href="#priprint-config-sections-—-gt" class="headerlink" title="# priprint(config.sections())        # —&gt; []"></a># priprint(config.sections())        # —&gt; []</h1><h1 id="-30"><a href="#-30" class="headerlink" title="=============================="></a>==============================</h1><h1 id="config-read-‘example-ini’"><a href="#config-read-‘example-ini’" class="headerlink" title="config.read(‘example.ini’)"></a>config.read(‘example.ini’)</h1><h1 id="print-config-sections-—-gt-‘bitbucket-org’-‘topsecret-server-com’-default-默认不显示"><a href="#print-config-sections-—-gt-‘bitbucket-org’-‘topsecret-server-com’-default-默认不显示" class="headerlink" title="print(config.sections())        # —&gt;  [‘bitbucket.org’, ‘topsecret.server.com’]  default 默认不显示"></a>print(config.sections())        # —&gt;  [‘bitbucket.org’, ‘topsecret.server.com’]  default 默认不显示</h1><h1 id="只要有就会用上"><a href="#只要有就会用上" class="headerlink" title="只要有就会用上"></a>只要有就会用上</h1><h1 id="print-‘bytebong-com’-in-config-False"><a href="#print-‘bytebong-com’-in-config-False" class="headerlink" title="print(‘bytebong.com’ in config) # False"></a>print(‘bytebong.com’ in config) # False</h1><h1 id="print-‘bitbucket-org’-in-config-True"><a href="#print-‘bitbucket-org’-in-config-True" class="headerlink" title="print(‘bitbucket.org’ in config) # True"></a>print(‘bitbucket.org’ in config) # True</h1><h1 id="-31"><a href="#-31" class="headerlink" title="==============================="></a>===============================</h1><h1 id="print-config-‘bitbucket-org’-“user”-hg"><a href="#print-config-‘bitbucket-org’-“user”-hg" class="headerlink" title="print(config[‘bitbucket.org’][“user”])  # hg"></a>print(config[‘bitbucket.org’][“user”])  # hg</h1><h1 id="print-config-‘DEFAULT’-‘Compression’-yes"><a href="#print-config-‘DEFAULT’-‘Compression’-yes" class="headerlink" title="print(config[‘DEFAULT’][‘Compression’]) #yes"></a>print(config[‘DEFAULT’][‘Compression’]) #yes</h1><h1 id="print-config-‘topsecret-server-com’-‘ForwardX11’-no"><a href="#print-config-‘topsecret-server-com’-‘ForwardX11’-no" class="headerlink" title="print(config[‘topsecret.server.com’][‘ForwardX11’])  #no"></a>print(config[‘topsecret.server.com’][‘ForwardX11’])  #no</h1><h1 id="-32"><a href="#-32" class="headerlink" title="=============================="></a>==============================</h1><h1 id="print-config-‘bitbucket-org’-lt-Section-bitbucket-org-gt-地址-不是里边的全部"><a href="#print-config-‘bitbucket-org’-lt-Section-bitbucket-org-gt-地址-不是里边的全部" class="headerlink" title="print(config[‘bitbucket.org’])          # &lt;Section: bitbucket.org&gt; 地址,不是里边的全部"></a>print(config[‘bitbucket.org’])          # &lt;Section: bitbucket.org&gt; 地址,不是里边的全部</h1><h1 id="-33"><a href="#-33" class="headerlink" title=""></a></h1><h1 id="for-key-in-config-‘bitbucket-org’-注意-有default会默认default的键-不管循环那个default都会打印"><a href="#for-key-in-config-‘bitbucket-org’-注意-有default会默认default的键-不管循环那个default都会打印" class="headerlink" title="for key in config[‘bitbucket.org’]:     # 注意,有default会默认default的键,不管循环那个default都会打印"></a>for key in config[‘bitbucket.org’]:     # 注意,有default会默认default的键,不管循环那个default都会打印</h1><h1 id="print-key"><a href="#print-key" class="headerlink" title="print(key)"></a>print(key)</h1><h1 id="print-config-options-‘bitbucket-org’-同for循环-找到’bitbucket-org’下所有键"><a href="#print-config-options-‘bitbucket-org’-同for循环-找到’bitbucket-org’下所有键" class="headerlink" title="print(config.options(‘bitbucket.org’))  # 同for循环,找到’bitbucket.org’下所有键"></a>print(config.options(‘bitbucket.org’))  # 同for循环,找到’bitbucket.org’下所有键</h1><h1 id="-34"><a href="#-34" class="headerlink" title="============================="></a>=============================</h1><h1 id="-35"><a href="#-35" class="headerlink" title=""></a></h1><h1 id="print-config-items-‘bitbucket-org’-找到’bitbucket-org’下所有键值对"><a href="#print-config-items-‘bitbucket-org’-找到’bitbucket-org’下所有键值对" class="headerlink" title="print(config.items(‘bitbucket.org’))    #找到’bitbucket.org’下所有键值对"></a>print(config.items(‘bitbucket.org’))    #找到’bitbucket.org’下所有键值对</h1><h1 id="列表返回-元祖-元祖中2各元素-key-value"><a href="#列表返回-元祖-元祖中2各元素-key-value" class="headerlink" title="列表返回,元祖,元祖中2各元素,key,value"></a>列表返回,元祖,元祖中2各元素,key,value</h1><h1 id="print-config-get-‘bitbucket-org’-’compression’-yes-get方法Section下的key对应的value"><a href="#print-config-get-‘bitbucket-org’-’compression’-yes-get方法Section下的key对应的value" class="headerlink" title="print(config.get(‘bitbucket.org’,’compression’)) # yes       get方法Section下的key对应的value"></a>print(config.get(‘bitbucket.org’,’compression’)) # yes       get方法Section下的key对应的value</h1><h1 id="-36"><a href="#-36" class="headerlink" title="=================================="></a>==================================</h1><h1 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h1><h1 id="import-configparser-1"><a href="#import-configparser-1" class="headerlink" title="import configparser"></a>import configparser</h1><h1 id="config-configparser-ConfigParser-1"><a href="#config-configparser-ConfigParser-1" class="headerlink" title="config = configparser.ConfigParser()"></a>config = configparser.ConfigParser()</h1><h1 id="config-read-‘example-ini’-读文件"><a href="#config-read-‘example-ini’-读文件" class="headerlink" title="config.read(‘example.ini’)   # 读文件"></a>config.read(‘example.ini’)   # 读文件</h1><h1 id="config-add-section-‘yuan’-增加section"><a href="#config-add-section-‘yuan’-增加section" class="headerlink" title="config.add_section(‘yuan’)   # 增加section"></a>config.add_section(‘yuan’)   # 增加section</h1><h1 id="config-remove-section-‘bitbucket-org’-删除一个section"><a href="#config-remove-section-‘bitbucket-org’-删除一个section" class="headerlink" title="config.remove_section(‘bitbucket.org’)   # 删除一个section"></a>config.remove_section(‘bitbucket.org’)   # 删除一个section</h1><h1 id="config-remove-option-‘topsecret-server-com’-”forwardx11”-删除一个配置项"><a href="#config-remove-option-‘topsecret-server-com’-”forwardx11”-删除一个配置项" class="headerlink" title="config.remove_option(‘topsecret.server.com’,”forwardx11”)  # 删除一个配置项"></a>config.remove_option(‘topsecret.server.com’,”forwardx11”)  # 删除一个配置项</h1><h1 id="config-set-‘topsecret-server-com’-’k1’-’11111’"><a href="#config-set-‘topsecret-server-com’-’k1’-’11111’" class="headerlink" title="config.set(‘topsecret.server.com’,’k1’,’11111’)"></a>config.set(‘topsecret.server.com’,’k1’,’11111’)</h1><h1 id="config-set-‘yuan’-’k2’-’22222’"><a href="#config-set-‘yuan’-’k2’-’22222’" class="headerlink" title="config.set(‘yuan’,’k2’,’22222’)"></a>config.set(‘yuan’,’k2’,’22222’)</h1><h1 id="f-open-‘new2-ini’-“w”"><a href="#f-open-‘new2-ini’-“w”" class="headerlink" title="f = open(‘new2.ini’, “w”)"></a>f = open(‘new2.ini’, “w”)</h1><h1 id="config-write-f-写进文件-注意不是原文件修改-改后重新写入"><a href="#config-write-f-写进文件-注意不是原文件修改-改后重新写入" class="headerlink" title="config.write(f) # 写进文件,注意不是原文件修改,改后重新写入"></a>config.write(f) # 写进文件,注意不是原文件修改,改后重新写入</h1><h1 id="f-close-14"><a href="#f-close-14" class="headerlink" title="f.close()"></a>f.close()</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">socket</span></h1><p class="md-end-block md-p">&nbsp;</p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># socket 应用层与传输层之间的抽象层# 操作网络的接口#   基于文件(本地通信),网络# AF_INET ipv4(常用)import socketsk = socket.socket()# sock.setsockopt(socket.SQL_SOCKET,socket.SO_REUSEADDR,1)  # 服务重启时,可能端口未释放,报错,通过词此语句解决# 报错socket没有SQL_SOCKET 不知道怎么回事,可能是版本问题sk.bind(("127.0.0.1",8089)) # 只有一个参数,元祖,传入元祖sk.listen() # listen(n) 表示最大连接数,默认不限制conn,addr = sk.accept() # 接收到连接,返回连接对象,对方addrret = conn.recv(1024) # 接受对方数据print(ret)conn.send(b'hello world') # 必须bytes 不能发空b'' 否则一直等待conn.send(bytes("Dean",encoding="utf8")) # 必须bytes 不能发空b'' 否则一直等待conn.close()  # 关闭连接sk.close() # 关闭socket# 发送发发送一次,接收方对于未接收完的字节可多次接受# 但发送方 发送多次,接收方 要接受多次,不能一次接受<p>import socket<br>sk = socket.socket()<br>sk.connect((“127.0.0.1”,8089))  # 对方的信息</p><h1 id="socket-connect-“106-15-39-74”-80-对方的信息"><a href="#socket-connect-“106-15-39-74”-80-对方的信息" class="headerlink" title="socket.connect((“106.15.39.74”,80))  # 对方的信息"></a>socket.connect((“106.15.39.74”,80))  # 对方的信息</h1><p>sk.send(b’dzf’)<br>ret = sk.recv(1024)<br>ret2 = sk.recv(1024)<br>print(ret,ret2.decode(“utf8”))<br>sk.close()<br></pre></div></p><p class="md-end-block md-p"><span class="md-plain">udp</span></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># accept 与recv(1024) 都会阻塞,参数不写报错import socketmsg = """&lt;html&gt;<pre><code class="hljs">&amp;lt;head&amp;gt;    &amp;lt;title&amp;gt;first tcp test&amp;lt;/title&amp;gt;    &amp;lt;meta charset=&quot;utf8&quot;/&amp;gt;&amp;lt;/head&amp;gt;&amp;lt;body&amp;gt;    Hello,Dean!&amp;lt;/body&amp;gt;</code></pre></div><p>&lt;/html&gt;<br>“””<br>msg = bytes(msg,encoding=”utf8”)<br>sk =socket.socket()<br>sk.bind((“127.0.0.1”,80))<br>sk.listen()<br>while True:<br>    conn,addr=sk.accept()<br>    ret = conn.recv(1024)<br>    print(ret)<br>    conn.send(msg)<br>    conn.close()  # 若此时不关连接其他无法接入<br>sk.close()</p><h1 id="sk-socket-socket-type-socket-SOCK-DGRAM-datagram"><a href="#sk-socket-socket-type-socket-SOCK-DGRAM-datagram" class="headerlink" title="sk = socket.socket(type=socket.SOCK_DGRAM) # datagram"></a>sk = socket.socket(type=socket.SOCK_DGRAM) # datagram</h1><h1 id="sk-bind-“127-0-0-1”-80"><a href="#sk-bind-“127-0-0-1”-80" class="headerlink" title="sk.bind((“127.0.0.1”,80))"></a>sk.bind((“127.0.0.1”,80))</h1><h1 id="rece-addr-sk-recvfrom-1024-只能先接受消息"><a href="#rece-addr-sk-recvfrom-1024-只能先接受消息" class="headerlink" title="rece,addr = sk.recvfrom(1024) # 只能先接受消息"></a>rece,addr = sk.recvfrom(1024) # 只能先接受消息</h1><h1 id="print-rece-decode-“gbk”"><a href="#print-rece-decode-“gbk”" class="headerlink" title="print(rece.decode(“gbk”))"></a>print(rece.decode(“gbk”))</h1><h1 id="sk-sendto-b”hello”-addr"><a href="#sk-sendto-b”hello”-addr" class="headerlink" title="sk.sendto(b”hello”,addr)"></a>sk.sendto(b”hello”,addr)</h1><h1 id="sk-close"><a href="#sk-close" class="headerlink" title="sk.close()"></a>sk.close()</h1><h1 id="服务器被动接收连接-自带地址-发信息时必须携带对方地址"><a href="#服务器被动接收连接-自带地址-发信息时必须携带对方地址" class="headerlink" title="服务器被动接收连接,自带地址,发信息时必须携带对方地址"></a>服务器被动接收连接,自带地址,发信息时必须携带对方地址</h1><p></pre></p><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">import socket# sk = socket.socket(type=socket.SOCK_DGRAM)# ip_port = ("127.0.0.1",80)# sk.sendto(b"hello",ip_port)# ret,addr = sk.recvfrom(1024)# print(ret)# sk.close()# 客户端执行 服务器发的系统命令# op.popen() 返回执行后的信息,错误的,正确的import subprocess# 错误信息,正确信息,放入管道res = subprocess.Popen("runas /user:Administrator ipconfig",shell=True,stdout=subprocess.PIPE,stderr=subprocess.PIPE)print("stdout:",res.stdout.read().decode("gbk"))print("sterr:",res.stderr.read().decode("gbk"))# 黏包 tcp   短时间间隔 发送短消息,tcp 会合并发送#       大小有限制,一次发送太多数据,一次拿不完,要多次# udp 无黏包,有包大小限制65507,若sendto大于它,会直接报错</pre></div><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># socket 应用层与传输层之间的抽象层# 操作网络的接口#   基于文件(本地通信),网络# AF_INET ipv4(常用)import socketsk = socket.socket()# sock.setsockopt(socket.SQL_SOCKET,socket.SO_REUSEADDR,1)  # 服务重启时,可能端口未释放,报错,通过词此语句解决# 报错socket没有SQL_SOCKET 不知道怎么回事,可能是版本问题sk.bind(("127.0.0.1",8089)) # 只有一个参数,元祖,传入元祖sk.listen() # listen(n) 表示最大连接数,默认不限制conn,addr = sk.accept() # 接收到连接,返回连接对象,对方addrret = conn.recv(1024) # 接受对方数据print(ret)conn.send(b'hello world') # 必须bytes 不能发空b'' 否则一直等待conn.send(bytes("Dean",encoding="utf8")) # 必须bytes 不能发空b'' 否则一直等待conn.close()  # 关闭连接sk.close() # 关闭socket# 发送发发送一次,接收方对于未接收完的字节可多次接受# 但发送方 发送多次,接收方 要接受多次,不能一次接受</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">黏包</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># import socket# sk = socket.socket()# sk.bind(("127.0.0.1",80))# sk.listen()# conn,addr=sk.accept()# ret=conn.recv(2)# ret2=conn.recv(1024)# tcp:若客户端只发送一次,服务器两次接受,  不知道对方发送的长度# tcp:连发两次,服务器可能一次接受(优化算法,连续小数据包会合并)#       客户端,断开后,默认给服务器发空消息# udp :服务器只接受一次,且只接受两个,剩余的就不接受了# =========================================# 黏包#   两个send 小数据#   两个recv 第一个接受的特别小# 本质上 不知道要接受多大数据# 解决方法:发送一下数据长度,在发送数据,#   优点:确定接受多大数据,#       可在配置项 设置, 一般防止多个连接情况 最大4MB#       当要发送大数据时,明确告诉接收方多大,用于接受数据#       用在多文件传输#       大文件传输,一般读固定的字节#       发送前 xxx send(4096)#       recv xxx recv(2048) 知道xxx变为0#   缺点:多一次交互#   但注意,send,sendto 一定量数据都会报错<h1 id="解决方法struct"><a href="#解决方法struct" class="headerlink" title="解决方法struct"></a>解决方法struct</h1><p>import struct</p><h1 id="将数字或其他类型数据-转为固定长度的bytes-4个字节-其中可能包含字母-符号"><a href="#将数字或其他类型数据-转为固定长度的bytes-4个字节-其中可能包含字母-符号" class="headerlink" title="将数字或其他类型数据,转为固定长度的bytes 4个字节,其中可能包含字母,符号"></a>将数字或其他类型数据,转为固定长度的bytes 4个字节,其中可能包含字母,符号</h1><p>ret = struct.pack(“i”,4096)  # 模式,”i”代表将数字转换为bytes<br>print(ret)<br>num = struct.unpack(“i”,ret)<br>print(num)  # (4096,)  返回元祖,通过num[0] 获取数字</p><p>“””<br>发送方:data<br>    sk.send(struct.pack(“i”,len(data)))<br>    sk.send(data)<br>接收方:<br>    num = sk.recv(4)<br>    sk.recv(int(num))<br>“””</p><h1 id="自定义报文头"><a href="#自定义报文头" class="headerlink" title="自定义报文头"></a>自定义报文头</h1><h1 id="自己定义前n个字节存放报头信息"><a href="#自己定义前n个字节存放报头信息" class="headerlink" title="自己定义前n个字节存放报头信息"></a>自己定义前n个字节存放报头信息</h1><p></pre></div></p><h1 class="md-end-block md-heading"><span class="md-plain">server_socket</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block"># socket serverimport socketserverclass Myserver(socketserver.BaseRequestHandler):    def handle(self): # self.request == conn        while True:            msg = self.request.recv(1024).decode("utf8")            if msg=='q':                break            print(msg)            info = input("&gt;&gt;&gt;")            self.request.send(bytes(info,encoding="utf8"))if __name__ == "__main__":    server = socketserver.ThreadingTCPServer(("127.0.0.1",8080),Myserver)    server.serve_forever()</pre></div><h1 class="md-end-block md-heading"><span class="md-plain">socket其他方法</span></h1><div class="code-wrapper"><pre class="md-fences mock-cm md-end-block">sk =socket.socket()sk.setblocking(False)sk....sk.accept() # 会直接执行,经错此语句时若没有连接会报错,可用try,revc 方法也不会阻塞<p>sk.sendall() # 一次性发送全部数据<br>sk.send() # 分次发送,建议使用send</p><p></pre></div></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python2,3%E5%8C%BA%E5%88%AB/"/>
    <url>/2022/01/16/cnblog/python2,3%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<table class="md-table"><thead><tr class="md-end-block"><th>&nbsp;</th><th><span class="td-span">Python2</span></th><th><span class="td-span">Python3</span></th></tr></thead><tbody><tr class="md-end-block"><td><span class="td-span">default charset</span></td><td><span class="td-span">ascii(can change)</span></td><td><span class="td-span">utf-8</span></td></tr><tr class="md-end-block"><td><span class="td-span">print</span></td><td><span class="td-span">可不加括号</span></td><td><span class="td-span">必须加</span></td></tr><tr class="md-end-block"><td><span class="td-span">range</span></td><td><span class="td-span">有xrange()生成器 可转换为range</span></td><td>&nbsp;</td></tr><tr class="md-end-block"><td><span class="td-span">input</span></td><td><span class="td-span">raw_input()</span></td><td><span class="td-span">input</span></td></tr><tr class="md-end-block"><td><span class="td-span">5/2</span></td><td><span class="td-span">2自动向下取整</span></td><td><span class="td-span">2.5</span></td></tr><tr class="md-end-block"><td><span class="td-span">object</span></td><td><span class="td-span">只有新式类有</span></td><td><span class="td-span">都是新式类都默认继承object</span></td></tr><tr class="md-end-block"><td><span class="td-span">super()</span></td><td><span class="td-span">无</span></td><td><span class="td-span">python3，通过super找到父类</span></td></tr><tr class="md-end-block"><td><span class="td-span">多继承问题</span></td><td><span class="td-span">新式类，广度，经典类，深度</span></td><td><span class="td-span">全都是新式类广度优先，就近原则</span></td></tr><tr class="md-end-block"><td><span class="td-span">metaclass</span></td><td><span class="td-span"><span class="md-plain">作为静态属性<span>_<span>_<span class="md-plain">metaclass<span>_<span>_<span class="md-plain">=MyType</span></span></span></span></span></span></span></span></td><td><span class="td-span">class A(metaclass=MyType):</span></td></tr></tbody></table>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python-pandas/"/>
    <url>/2022/01/16/cnblog/python-pandas/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> pandas 数据预处理 基于numpy</span><span style="color: #008000;">#</span><span style="color: #008000;"> 读取csv文件(逗号隔开的文件)</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> pandas,os,numpy as nppath </span>= r<span style="color: #800000;">"</span><span style="color: #800000;">D:\desktop\Workspace\PythonWorkSpace\Machine-Learning\asstes\csv\2019_student_teacher.csv</span><span style="color: #800000;">"</span><span style="color: #000000;">student_teacher </span>= pandas.read_csv(path,encoding=<span style="color: #800000;">"</span><span style="color: #800000;">gbk</span><span style="color: #800000;">"</span><span style="color: #000000;">)</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(type(student_teacher))  # panda.core.frame.DataFrame   就像numpy中的numpy.array</span><span style="color: #800000;">"""</span><span style="color: #800000;">序号         int64准考证号       int64姓名        object报考专业代码     int64报考专业      object研究方向      object培养模式      object录取导师      object</span><span style="color: #800000;">"""</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.dtypes) # dtype: object</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher) # 打印全部信息</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.head()) # 打印前5条信息</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.head(3)) # 打印前3条信息</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.tail(5)) # 打印后边5条的信息</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.columns) #Index(['序号', '准考证号', '姓名', '报考专业代码', '报考专业', '研究方向', '培养模式', '录取导师'], dtype='object')</span><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.shape) # (398, 8)</span><p><span style="color: #008000;">#</span><span style="color: #008000;"> pandas中索引与计算,数据定位   行取数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher.loc[0])</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>序号                           1<br>准考证号           zzzzz<br>姓名                         yyy<br>报考专业代码                   85207<br>报考专业                电气工程(专业硕士)<br>研究方向      (全日制)电能质量检测与评估（研究所9）<br>培养模式                      专业学位<br>录取导师                xxxx<br>Name: 0, dtype: object<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> print(student_teacher.loc[1:3])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher.loc[[1,2,3]])</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>   序号             准考证号   姓名  报考专业代码        报考专业                       研究方向  培养模式            录取导师<br>1   2  kk  xxx   80800        电气工程    (全日制)电力系统规划与运行分析（研究所10）  学术学位  teacher<br>2   3  kk  yyy   85207  电气工程(专业硕士)  (全日制)电力系统监测控制与运行分析（研究所10）  专业学位   teacher<br>3   4  kk   zzz   85210        控制工程      (全日制)智能控制理论及应用（研究所13）  专业学位  teacher<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 列取数据</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher[“报考专业”])</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>0      电气工程(专业硕士)<br>1            电气工程<br>2      电气工程(专业硕士)<br>3            控制工程<br>4         电子与通信工程<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 获取多个列,注意里边是list</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher[[“报考专业”,”导师”]])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher.columns.tolist())  # [‘序号’, ‘准考证号’, ‘姓名’, ‘报考专业代码’, ‘报考专业’, ‘研究方向’, ‘培养模式’, ‘录取导师’]</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher.loc[0][“姓名”])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 列之间计算</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   *   new = student_teacher[x]*student_teacher[y]   对应位置相乘,注意行数相同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   +-   维度相同 对应相加减</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   加减的若为常数 每个数值与常数+-</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 添加新列 student_teacher[‘new’]=new</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher[“序号”].max())  # 获取该列最大值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   按照序号列排序, inplace =True表示在源DataFrame上修改,否则生成新的Frame,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   默认排序从小到大ascending=True,Flase 为从大到小</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   对于列中某些为空的 显示时为NaN, 排序是不管哪种都默认放最后</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(student_teacher.sort_values(“序号”,inplace=True,ascending=True))</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> xxx = student_teacher[“xxx”]</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> isNullOrNot = pandas.isnull(xxx)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(isNullOrNot)</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>为空的是True<br>0 False<br>1 True<br>…<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> xxx[isNullOrNot] # len(….) 即可获取缺失值的个数</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>对于一些加减乘除的操作 ,注意过滤NaN 否则计算机结果为NaN<br>student_teacher[“xxx”][isNullOrNot==False] 过滤缺失值<br>student_teacher[“xxx”].mean() 自带的直接过滤<br>为空的是True<br>0 NaN<br>…<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> 聚合函数,分组后求平均:基本思路是循环</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">  按照index分组,求values的平均值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   values= 还可以为list aggfunc 默认为mean</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.pivot_table(index=””,values=””,aggfunc=np.mean)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.dropna(axis=1,subset=[“xx”,”yy”]) # 删除 列中为空的   0删除行中为空的 若为行 使用subnet = [1,2,3]</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.loc[83,”序号”] # 直接定位到值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.sort_index(“Age”) # 按照Age排序, 结果中多添加的index列与会按照age排序</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.sort_index(“Age”).reset_index(drop=True) # 表示原来的index不用了,形成新的</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> def func(data):</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">     return data</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> student_teacher.apply(func) # 自定义函数</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> DataFrame 内部子结构Series</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">  例如 某一列的type 就是pandas.core.series.Series</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   student_teacher[“xx”]  可再次对它进行切片</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> =============================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 自定义Series</span><br><span style="color: #0000ff;">from</span> pandas <span style="color: #0000ff;">import</span><span style="color: #000000;"> Series<br>id</span>= student_teacher[<span style="color: #800000;">“</span><span style="color: #800000;">报考专业代码</span><span style="color: #800000;">“</span>].values  <span style="color: #008000;">#</span><span style="color: #008000;"> type 为 np.array  即把 xx 列所有内容 放入 array</span><br>name= student_teacher[<span style="color: #800000;">“</span><span style="color: #800000;">姓名</span><span style="color: #800000;">“</span>].values  <span style="color: #008000;">#</span><span style="color: #008000;"> type 为 np.array  即把 xx 列所有内容 放入 array</span><br>series =Series(name,index=<span style="color: #000000;">id)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> series =Series(id,index=name)</span><br>series[[85207,85210]] <span style="color: #008000;">#</span><span style="color: #008000;"> 对series进行查找, index 为list中值的行,index可为str类型</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>id1 name<br>id2 name2<br>…<br></span><span style="color: #800000;">“””</span><br><span style="color: #008000;">#</span><span style="color: #008000;"> print(series.index.tolist())</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> series.sort_index() # 按照index排序</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> series.sort_values() # 按照values排序</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> np.add(series,series) series相加 (维度相同)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> series[series&gt;50] 选取符合条件的值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> print(series[series&gt;’85200’])</span><br><span style="color: #000000;"><br>new</span>= student_teacher.set_index(<span style="color: #800000;">“</span><span style="color: #800000;">姓名</span><span style="color: #800000;">“</span>,drop=True) <span style="color: #008000;">#</span><span style="color: #008000;"> 修改索引,并返回 新的Frame</span><br><span style="color: #0000ff;">print</span>(new.loc[<span style="color: #800000;">‘</span><span style="color: #800000;">name</span><span style="color: #800000;">‘</span>]) <span style="color: #008000;">#</span><span style="color: #008000;"> 此时查找行可通过姓名属性<br /># data.drop([“xxx”],axis=1) 删除列<br /># data.query(“x&gt;1 &amp; y&lt;2”) 条件查询</span></pre></div></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python-numpy/"/>
    <url>/2022/01/16/cnblog/python-numpy/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #0000ff;"># 常用库numpy<br />import</span><span style="color: #000000;"> numpy as nparray1 </span>= np.array([1,2,3,4<span style="color: #000000;">])</span><span style="color: #0000ff;">print</span>(array1)  <span style="color: #008000;">#</span><span style="color: #008000;"> [1 2 3 4]</span>array2 =<span style="color: #000000;"> np.array([    [</span>1,2,6,9<span style="color: #000000;">],    [</span>3,4,8,9<span style="color: #000000;">],    [</span>3,5,9,9<span style="color: #000000;">],    [</span>3,5,7,9<span style="color: #000000;">],])</span><span style="color: #0000ff;">print</span><span style="color: #000000;">(array2)</span><span style="color: #800000;">"""</span><span style="color: #800000;">[[1 2] [3 4]]</span><span style="color: #800000;">"""</span><span style="color: #0000ff;">print</span>(array1.shape) <span style="color: #008000;">#</span><span style="color: #008000;"> (4,)  显示列的数量</span><span style="color: #0000ff;">print</span>(array2.shape) <span style="color: #008000;">#</span><span style="color: #008000;"> (2,2) 显示行,列</span><span style="color: #0000ff;">print</span>(array1.dtype) <span style="color: #008000;">#</span><span style="color: #008000;"> int32</span><span style="color: #0000ff;">print</span>(array2.dtype) <span style="color: #008000;">#</span><span style="color: #008000;"> float64   字符串类型是S1 类型</span><span style="color: #000000;">array2.astype(float)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 含有一个浮点就是浮点,含有一个字符就是字符类型</span><span style="color: #0000ff;">print</span>(array2==2<span style="color: #000000;">)</span><span style="color: #800000;">"""</span><span style="color: #800000;">[[False  True] [False False]]</span><span style="color: #800000;">"""</span><span style="color: #0000ff;">print</span>(array2.min()) <span style="color: #008000;">#</span><span style="color: #008000;"> 返回矩阵最小值</span><span style="color: #008000;">#</span><span style="color: #008000;"> =================================</span><span style="color: #008000;">#</span><span style="color: #008000;"> 从文本数据获取数据 逗号分开,按照字符类型,   返回 记录组成的矩阵</span><span style="color: #008000;">#</span><span style="color: #008000;"> np.genfromtxt("path",delimiter=",",dtype=str)</span><span style="color: #008000;">#</span><span style="color: #008000;"> 从矩阵中取值 x[m,n]</span><p><span style="color: #008000;">#</span><span style="color: #008000;"> ==========================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 矩阵切片 x[:,0:2] 获取矩阵的所有行,0-2列</span><br><span style="color: #0000ff;">print</span><span style="color: #000000;">(array2)<br>vec </span>= array2==9<br><span style="color: #0000ff;">print</span><span style="color: #000000;">(vec)<br>array2[vec]</span>=100<br><span style="color: #0000ff;">print</span>(array2[vec]) <span style="color: #008000;">#</span><span style="color: #008000;"> [9 9 9 9 9] 显示了矩阵中所有的</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> ========================================================================================</span><br>(array1==10) &amp; (array2==5) <span style="color: #008000;">#</span><span style="color: #008000;"> 返回矩阵, 符合 以前学过的 或,与</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 常用函数</span><br><span style="color: #0000ff;">print</span>(array2.sum(axis=1)) <span style="color: #008000;">#</span><span style="color: #008000;"> [109 115 208 115]  每行的总和</span><br><span style="color: #0000ff;">print</span>(array2.sum(axis=0)) <span style="color: #008000;">#</span><span style="color: #008000;"> [ 10  16 121 400]  每列的总和</span><br>matrix = np.arange(12) <span style="color: #008000;">#</span><span style="color: #008000;"> [ 0  1  2  3  4  5  6  7  8  9 10 11]</span><br><span style="color: #0000ff;">print</span><span style="color: #000000;">(matrix)<br></span><span style="color: #0000ff;">print</span>(matrix.reshape(3,4))  <span style="color: #008000;">#</span><span style="color: #008000;"> 转为3行 2列矩阵,注意元素个数不能多不能少</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 空矩阵</span><br>kong = np.zeros((3,4))  <span style="color: #008000;">#</span><span style="color: #008000;"> 创建3行4列全为0的矩阵  float类型</span><br><span style="color: #0000ff;">print</span><span style="color: #000000;">(kong)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 指定值的矩阵</span><br>defau = np.ones((2,3,4),dtype=np.int) <span style="color: #008000;">#</span><span style="color: #008000;"> 三维 3行 4列, 2 个   int 类型</span><br><span style="color: #0000ff;">print</span><span style="color: #000000;">(defau)<br></span><span style="color: #008000;">#</span><span style="color: #008000;"> 从10开始 30 步长为5</span><br>np.arange(10,30,5)  <span style="color: #008000;">#</span><span style="color: #008000;"> [10,15,20,25]  不包含30</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 随机模块</span><br>np.random.random((2,3)) <span style="color: #008000;">#</span><span style="color: #008000;"> 两行三列 -1 到 1之间的</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 在区间内随机取值</span><br>np.linspace(0,9,20) <span style="color: #008000;">#</span><span style="color: #008000;"> 0到9之间随机20个值, 包含0,9</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 对于shape 相同的</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">      就是对应位置相减</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       对应位置相乘(A*B)  shape不变</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 对于shape不同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">      如矩阵减去1 表示所有位置减1</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       array1**2 表示所有元素平方</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       A.dot(B)或np.dot(A,B) 真正的矩阵乘法,需要符合 可相乘的条件</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> e的n次幂 np.exp(n)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 舍弃小数</span><br><span style="color: #0000ff;">print</span>(np.floor([1,2.4,0.736,-987,15])) <span style="color: #008000;">#</span><span style="color: #008000;"> [   1.    2.    0. -987.   15.] 变为浮点整数</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> matrix.ravel()   矩阵 拉平   按照第一行接 第二行方式</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> array2.shape = (8,2) 修改矩阵的形状</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> array2.reshape(8,-1) 与上边功能相同 8行  此时 列数自动计算</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> np.hstack(矩阵1,矩阵2)  横着拼接  ,注意行相同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> np.vstack(矩阵1,矩阵2)  垂直拼接,注意列相同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> np.hspilt(矩阵,n)  水平切分 分为n份</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   np.hspilt(矩阵,(m,n))  水平切分 从m列后切开,从n列后切开</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 垂直切开与水平类似</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> ==============================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> np 中的向量,矩阵都是引用对象,赋值时是引用传递,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   浅复制 a=b 此时a,b指向同一个  a,b完全相同 ,修改一个,另一个变化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   c = b.view() c is b  —&gt;Flase 修改shape 另一个不会变,但修改某个值,都会变化</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">       即b,与b.view() 公用数值部分 ,只有部分相同,其他都不同</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">  d = b.copy() d用b的值进行初始化,创建的d,创建后,两者每关系了</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> =========================================</span><br>max_line = array2.argmax(axis=0) <span style="color: #008000;">#</span><span style="color: #008000;"> 每列进行比较 [x,y,z] x矩阵第一列中最大的元素的下标,y为第二列</span><br>array2[max_line,np.arange(array2.shape[1])] <span style="color: #008000;">#</span><span style="color: #008000;"> 输入 那些最大值所在行,以及列数  最后返回矩阵中 每列的最大值</span><br><span style="color: #000000;"><br>three </span>= np.tile([[1,2],[3,4]],(2,3)) <span style="color: #008000;">#</span><span style="color: #008000;"> 以 array2 行变为原来2倍,列变为3倍</span><br><span style="color: #800000;">“””</span><span style="color: #800000;"><br>[[1 2]<br> [3 4]]<br>[[1 2 1 2 1 2]<br> [3 4 3 4 3 4]<br> [1 2 1 2 1 2]<br> [3 4 3 4 3 4]]<br></span><span style="color: #800000;">“””</span><span style="color: #000000;"><br>np.sort(array2,axis</span>=1) <span style="color: #008000;">#</span><span style="color: #008000;"> 返回一个矩阵 ,是array2 矩阵所有行排序后的</span><br>array2.sort(axis=1) <span style="color: #008000;">#</span><span style="color: #008000;"> 在矩阵上直接修改</span><br><span style="color: #000000;"><br>array4 </span>= np.array([23,45,67,1<span style="color: #000000;">])<br>index </span>= np.argsort(array4) <span style="color: #008000;">#</span><span style="color: #008000;"> [3 0 1 2] 返回的是 array4 排序(默认升序)后 对应数值原来的下标</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 排序应为 [1 23 45 67]   3就是1 原来的索引,0是23原来的索引</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 此时</span><br><span style="color: #0000ff;">print</span>(array4[index]) <span style="color: #008000;">#</span><span style="color: #008000;"> 返回的其实就是 排序后的矩阵[1 23 45 67]</span></pre></div></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python-matplotlib/"/>
    <url>/2022/01/16/cnblog/python-matplotlib/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #008000;">#</span><span style="color: #008000;"> matplotlib 画图工具</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> matplotlib.pyplot as plt</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> pandas as pd</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> numpy as np</span><span style="color: #0000ff;">from</span> pandas.core.series <span style="color: #0000ff;">import</span><span style="color: #000000;"> Series</span><span style="color: #008000;">#</span><span style="color: #008000;"> 自定义数据</span>X = Series(np.array([1,2,3,4,5<span style="color: #000000;">]))Y </span>= Series(np.array([1,5,2.7,3.8,4.9<span style="color: #000000;">]))Y1 </span>= (np.random.random((1,5))*10<span style="color: #000000;">)[0]X1 </span>= [1,2,3,4,5<span style="color: #000000;">]<p></span><span style="color: #008000;">#</span><span style="color: #008000;"> =================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 折线图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> xxx 文件有两列组成 DATE(yyyy/MM/dd),VALUE</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> unrate = pd.read_csv(“xxx”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 修改日期格式(yyyy-MM-dd)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> unrate[‘DATE’] = pd.to_datetime(unrate[‘DATE’])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.plot() # 若不传入数据图像为空(只显示画图域)  只有 xy轴   范围为0-1 (0.0 0.2 0.4 0.6     1.0)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.plot(X,Y) # 线x轴后y轴</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.xticks(rotation=45)  # 设置x轴上的数字倾斜角度</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.yticks(rotation=45)  # 设置y轴上的数字倾斜角度</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.xlabel(‘x’)  # 给xy轴加标签 注意中文可能出错</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.ylabel(‘y’)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.title(‘title’)  # 标题</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.show()  # 显示图像</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> =========================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 子图操作</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig = plt.figure(figsize=(3,6)) # figsize画图域的长与宽</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig = plt.figure()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax1 = fig.add_subplot(2,2,1)  # 三个画图域  第一张图 左上角序号为1</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax2 = fig.add_subplot(2,2,2)  # 右上角 序号2</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax3 = fig.add_subplot(2,2,4)  # 右下角序号4</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 有三个画图域:一张大图  里边三个小图 ,注意尽量保持每个域 中前两个量都相同如全都是(2,2,<em>) 否则图像可能会重合</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">   大图分为 2</em>2 ,序号从左到右,上到下 1-4</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax1.plot(X,Y)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax2.plot(X,Y)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> =================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 在一个图上画多条线</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig = plt.figure()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.plot(X,Y,c=”red”,label=”first”)  # 添加label,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.plot(X1,Y1,c=”blue”,label=”second”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.legend(loc=”best”)  # 可以在图中显示 不同线的标注信息</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 指定位置 best 表示自定义最好位置, upper left 左上角  lower ,center left,right等</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 条形图与散点图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.subplots(X,Y,0.3) # 不能此种方式直接画</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.bar(X,Y,0.3) # 0.3表示柱形的宽度</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.bar(X1,Y1,0.5)  # X1 表示的是每个柱距离0的大小 Y1是柱的高度</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xticklabels([“a”,”b”,”c”,”d”,”e”],rotation=45) # 定义x轴要显示的内容 本例为1,2,3,4,5</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xticks([1,2,3,4,5]) # 指明x轴上1,2,3,4,5那些需要显示</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_ylabel(“y”)  # y轴标签</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xlabel(“x”)  # x轴标签</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_title(“title”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ——————————-</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 横向柱状图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.barh(X1,Y1,0.3) # x 变为竖着的</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_yticks()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_yticklabels(yy)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ===================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.scatter(X1,Y1)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xlabel(“X”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_ylabel(“Y”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ———————</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 子图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig = plt.figure()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax1 = fig.add_subplot(2,1,1)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax2 = fig.add_subplot(2,1,2)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax1 … ax2 …</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> —————–</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 直方图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.hist(Y1)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.hist([1,1,1,3,3,3,4,4,4,5,5,5,5,5,5,51])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_ylim(0,3) # 设置y轴区间大小</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xlim(0,5) # 设置y轴区间大小</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 接受一组数据,假如数据是可比较的,</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 在x轴上会分区间显示, 数值大小在改区间的数的个数  区间个数 通过bins修改</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 通过range=(2,5) 控制x轴显示的范围  只显示2到5范围内的</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ======================================================</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 盒图</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.boxplot([[1,2,3],2,3,4,5,6,7])</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_xticklabels([“a”,”b”],rotation=90) # x轴上显示的标签</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.set_ylim(0.5) # 范围</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> boxplot([]) list中可为几个数值,也可以为[] ,即每个[] 对应x上一项</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 注意最多两层 [[],[]] 三层报错</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> 图的主要作用是 容易看出一个[] 中四等分出的值</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">  a–&gt; 1,1.5,2,2.5,3   b–&gt;2 ….</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ====================================</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> fig,ax = plt.subplots()</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.tick_params(bottom=”on”)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> for key,spine in ax.spines.items():</span><span style="color: #008000;"><br>#</span><span style="color: #008000;">     spine.set_visible(False)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.plot(X,Y)</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.plot(X1,Y1)</span></p><p><span style="color: #008000;">#</span><span style="color: #008000;"> 细节设置</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.plot(c=(0/255,10/255,164/255),linewidth=3) # 设置宽度,颜色:颜色使用元祖方式表示,固定格式</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> ax.text(x,y,”zz”) # 在x,y点处添加zz字符</span><span style="color: #008000;"><br>#</span><span style="color: #008000;"> plt.show()</span></pre></div></p></div><p>&nbsp;</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;">import matplotlib.pyplot as pltimport jsonimport numpy as npimport matplotlibfont = {'family': 'MicroSoft YaHei','weight': 'bold','size': 10} # 中文乱码matplotlib.rc("font", **font)file = r'temp2.txt'car = []bus = []van = []others = []X = []with open(file,'r') as f:    data = [json.loads(line) for line in f.readlines()]for i,line in enumerate(data):    X.append(i)    temp = line.get(str(i))    car.append(temp.get('car'))    bus.append(temp.get('bus'))    van.append(temp.get('van'))    others.append(temp.get('others'))X = np.divide(X,60)plt.plot()plt.plot(X,car,label='car')plt.plot(X,bus,label='bus')plt.plot(X,van,label='van')plt.plot(X,others,label='other')plt.plot(X,np.sum([car,van,bus,others],axis=0),label='sum')plt.legend(loc=2)plt.xlabel('运行时间(分钟)')plt.ylabel('数量')plt.title('车辆流统计')plt.show()</pre></div></div><p>　　</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/python%20%E5%8D%8F%E7%A8%8B%E6%96%B0%E7%89%88/"/>
    <url>/2022/01/16/cnblog/python%20%E5%8D%8F%E7%A8%8B%E6%96%B0%E7%89%88/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">coro</span>(<span class="hljs-params">i</span>):</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;core start&quot;</span>,i)<br>    ret = <span class="hljs-keyword">await</span> get(i) <span class="hljs-comment"># 此处为耗时的io等操作</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;core end&quot;</span>,i)<br>    <span class="hljs-keyword">return</span> ret<br><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span>(<span class="hljs-params">i</span>):</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> i<br>loop = asyncio.get_event_loop()<br>a = [asyncio.ensure_future(coro(i)) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>loop.run_until_complete(asyncio.wait(a))<br>loop.close()<br><span class="hljs-built_in">print</span>([i.result() <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a])<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/POIEasyExcel/"/>
    <url>/2022/01/16/cnblog/POIEasyExcel/</url>
    
    <content type="html"><![CDATA[<h1 id="POI与EasyExcel"><a href="#POI与EasyExcel" class="headerlink" title="POI与EasyExcel"></a>POI与EasyExcel</h1><ul><li>数据导出excel</li><li>数据导入程序</li></ul><h1 id="POI"><a href="#POI" class="headerlink" title="POI"></a>POI</h1><ul><li>数据加入内存再操作</li><li>消耗内存</li></ul><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 工作簿 2003 65535行</span><br>Workbook workbook = <span class="hljs-keyword">new</span> HSSFWorkbook();<br><span class="hljs-comment">// 工作簿 2007 无限制，但耗时较长</span><br>Workbook workbook = <span class="hljs-keyword">new</span> XSSFWorkbook();<br><span class="hljs-comment">// 无限制，大量数据速度也快，但会产生临时文件</span><br><span class="hljs-comment">// 工作表</span><br>Sheet sheet = workbook.createSheet(<span class="hljs-string">&quot;sheet1&quot;</span>);<br><span class="hljs-comment">// 行</span><br>Row row1 = sheet.createRow(<span class="hljs-number">0</span>);<br><span class="hljs-comment">// 列 (1,1)</span><br>Cell cell1 = row1.createCell(<span class="hljs-number">0</span>);<br>cell1.setCellValue(<span class="hljs-string">&quot;1,1&quot;</span>);<br>Workbook workbook = <span class="hljs-keyword">new</span> SXSSFWorkbook();<br><span class="hljs-comment">// 清除临时文件</span><br>((SXSSFWorkbook)workbook).dispose(); <br></code></pre></td></tr></table></figure><p>读取</p><ul><li>注意类型问题，程序中获取时按照类型获取</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--03--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--07--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.poi<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>poi-ooxml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="EasyExcel"><a href="#EasyExcel" class="headerlink" title="EasyExcel"></a>EasyExcel</h1><ul><li>逐行操作</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>easyexcel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.6<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br><span class="hljs-meta">@ExcelProperty(&quot;id&quot;)</span><br><span class="hljs-keyword">private</span> Integer id;<br><span class="hljs-meta">@ExcelProperty(&quot;用户名&quot;)</span><br><span class="hljs-keyword">private</span> String name;<br><span class="hljs-comment">//@ExcelIgnore 忽略属性</span><br><span class="hljs-meta">@ExcelProperty(&quot;用户密码&quot;)</span><br><span class="hljs-keyword">private</span> String password;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;User&gt; <span class="hljs-title">create</span><span class="hljs-params">()</span></span>&#123;<br>List&lt;User&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;User&gt;();<br>User u = <span class="hljs-keyword">new</span> User(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;dzf&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>);<br>User u2 = <span class="hljs-keyword">new</span> User(<span class="hljs-number">1</span>,<span class="hljs-string">&quot;dzf&quot;</span>,<span class="hljs-string">&quot;123456&quot;</span>);<br>User u3 = <span class="hljs-keyword">new</span> User(<span class="hljs-number">2</span>,<span class="hljs-string">&quot;gyg&quot;</span>,<span class="hljs-string">&quot;1234&quot;</span>);<br>list.add(u);<br>list.add(u);<br>list.add(u3);<br><span class="hljs-keyword">return</span> list;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnalysisEventListener</span>&lt;<span class="hljs-title">User</span>&gt; </span>&#123;<br>List&lt;User&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;User&gt;();<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">invoke</span><span class="hljs-params">(User data, AnalysisContext context)</span> </span>&#123;<br>System.out.println(data);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doAfterAllAnalysed</span><span class="hljs-params">(AnalysisContext analysisContext)</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;读入完成&quot;</span>);<br>&#125;<br><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 写</span><br>List&lt;User&gt; list = User.create();<br>EasyExcel.write(<span class="hljs-string">&quot;D:/desktop/xxx.xlsx&quot;</span>,User.class).sheet(<span class="hljs-string">&quot;sheetname&quot;</span>).doWrite(list);<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 读</span><br>EasyExcel.read(<span class="hljs-string">&quot;D:/desktop/xxx.xlsx&quot;</span>,User.class,<span class="hljs-keyword">new</span> User.UserListener()).sheet(<span class="hljs-string">&quot;sheetname&quot;</span>).doRead();<br></code></pre></td></tr></table></figure><p><a href="https://alibaba-easyexcel.github.io/index.html">https://alibaba-easyexcel.github.io/index.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>python模块pillow中的mode问题</title>
    <link href="/2022/01/16/cnblog/PILLOW%E4%B8%AD%E5%9B%BE%E5%83%8Fmode/"/>
    <url>/2022/01/16/cnblog/PILLOW%E4%B8%AD%E5%9B%BE%E5%83%8Fmode/</url>
    
    <content type="html"><![CDATA[<p>在本地找了jpg的图，convert为不同mode，将不同的图截取做了个脑图，有个直观的感觉吧。<br>把不同mode的图通过np.array()转化为array, 打印出array的shape， 和array[0, 0]的值， 便于理解不同mode的通道和像素值的存储。<br>1 部分结果见下：<br><img src="https://images2018.cnblogs.com/blog/1416983/201807/1416983-20180722103114816-749344083.png"><br>2 部分代码和结果：<br>将不同模式的图片打印出shape 和 [0, 0]像素点的值</p><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PIL <span class="hljs-keyword">import</span> Image<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br>image = Image.<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;images/tower.jpg&#x27;</span>) <span class="hljs-comment"># 本地一个文件</span><br>mode_list = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;L&#x27;</span>, <span class="hljs-string">&#x27;I&#x27;</span>, <span class="hljs-string">&#x27;F&#x27;</span>, <span class="hljs-string">&#x27;P&#x27;</span>, <span class="hljs-string">&#x27;RGB&#x27;</span>, <span class="hljs-string">&#x27;RGBA&#x27;</span>, <span class="hljs-string">&#x27;CMYK&#x27;</span>, <span class="hljs-string">&#x27;YCbCr&#x27;</span> ]<br><span class="hljs-keyword">for</span> mode <span class="hljs-keyword">in</span> mode_list:<br>    img = image.convert(mode)<br>    img_data = np.array(img)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;img_&#123;:&amp;gt;1&#125;.shape: &#123;&#125;&#x27;</span> .<span class="hljs-built_in">format</span>(mode, img_data.shape))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;img_&#123;:&amp;gt;&#125;_data[0, 0]: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(mode, img_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;---&#x27;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 以下为output</span><br>img_1.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>)<br>img_1_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: <span class="hljs-literal">False</span><br>---<br>img_L.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>)<br>img_L_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: <span class="hljs-number">88</span><br>---<br>img_I.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>)<br>img_I_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: <span class="hljs-number">88</span><br>---<br>img_F.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>)<br>img_F_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: <span class="hljs-number">88.94599914550781</span><br>---<br>img_P.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>)<br>img_P_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: <span class="hljs-number">131</span><br>---<br>img_RGB.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">3</span>)<br>img_RGB_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: [ <span class="hljs-number">51</span>  <span class="hljs-number">97</span> <span class="hljs-number">147</span>]<br>---<br>img_RGBA.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">4</span>)<br>img_RGBA_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: [ <span class="hljs-number">51</span>  <span class="hljs-number">97</span> <span class="hljs-number">147</span> <span class="hljs-number">255</span>]<br>---<br>img_CMYK.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">4</span>)<br>img_CMYK_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: [<span class="hljs-number">204</span> <span class="hljs-number">158</span> <span class="hljs-number">108</span>   <span class="hljs-number">0</span>]<br>---<br>img_YCbCr.shape: (<span class="hljs-number">1276</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">3</span>)<br>img_YCbCr_data[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>]: [ <span class="hljs-number">88</span> <span class="hljs-number">160</span> <span class="hljs-number">100</span>]<br></code></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">RGB</span> 为真色彩模式， 可组合为 <span class="hljs-number">256</span> <span class="hljs-variable">x</span> <span class="hljs-number">256</span> <span class="hljs-variable">x256</span> 种， 打印需要更改为 <span class="hljs-variable">CMYK</span>模式， 需要注意数值溢出的问题。<br><span class="hljs-variable">HSB</span> 模式（本篇没有涉及），建立基于人类感觉颜色的方式，将颜色分为色相（<span class="hljs-built_in">Hue</span>），饱和度（<span class="hljs-variable">Saturation</span>），明亮度（<span class="hljs-variable">Brightness</span>），这里不详细展开。<br><span class="hljs-variable">CMYK</span>模式，应用在印刷领域，<span class="hljs-number">4</span>个字母意思是青、洋红、黄、黑，因为不能保证纯度，所以需要黑。<br>位图模式，见<span class="hljs-number">1</span>， 颜色由黑和白表示（<span class="hljs-built_in">True</span>， <span class="hljs-built_in">False</span>）。<br>灰度模式，只有灰度， 所有颜色转化为灰度值，见<span class="hljs-variable">L</span>，<span class="hljs-built_in">I</span>，<span class="hljs-variable">F</span>。<br>双色调模式（未有涉及），节约成本将可使用双色调。<br><span class="hljs-variable">Lab</span>模式（未涉及，<span class="hljs-variable">ps</span>内置），由<span class="hljs-number">3</span>通道组成（亮度，<span class="hljs-variable">a</span>，<span class="hljs-variable">b</span>）组成，作为<span class="hljs-variable">RGB</span>到<span class="hljs-variable">CMYK</span>的过渡。<br>多通道模式，删除<span class="hljs-variable">RGB</span>，<span class="hljs-variable">CMYK</span>，<span class="hljs-variable">Lab</span>中某一个通道后，会转变为多通道，多通道用于处理特殊打印，它的每个通道都为<span class="hljs-number">256</span>级灰度通道。<br>索引颜色模式，用在多媒体和网页，通过颜色表查取，没有则就近取，仅支持单通道，（<span class="hljs-number">8</span>位<span class="hljs-operator">/</span>像素）。<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/npm/"/>
    <url>/2022/01/16/cnblog/npm/</url>
    
    <content type="html"><![CDATA[<p>&nbsp;</p><h1 class="md-end-block md-heading"><span class="md-plain">npm（Node package manager） 使用介绍</span></h1><p class="md-end-block md-p"><span class="md-plain">解决包之间的依赖关系</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">需安装node.js </span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">下载后安装即可</span></p></li><li class="md-list-item"><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-builtin">npm <span class="cm-attribute">-v<br /><span><span class="cm-builtin">node <span class="cm-attribute">-v</span></span></span></span></span></span></pre></div></li></ul></li><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">更新npm</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-builtin">npm install <span class="cm-builtin">npm@5.4.0 <span class="cm-attribute">-g<br /><span><span class="cm-builtin">npm install <span class="cm-builtin">npm@latest <span class="cm-attribute">-g<br /><span><span class="cm-comment"># -g 表示全局环境，只有这样，npm才可以在任何目录识别</span></span></span></span></span></span></span></span></span></span></pre></div></li></ul></li></ul><ul class="ul-list" data-mark="-"><li class="md-list-item"><p class="md-end-block md-p"><span class="md-plain">修改镜像地址：</span></p><ul class="ul-list" data-mark="-"><li class="md-list-item"><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-builtin">npm config <span class="cm-keyword">set registry https://registry.npm.taobao.org</span></span></span></pre></div></li></ul><ul class="ul-list" data-mark="-"><li class="md-list-item"><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 安装cnmp以后使用cnmp就是使用国内进行，推荐<br /><span><span class="cm-builtin">npm install <span class="cm-attribute">-g cnpm <span class="cm-attribute">--registry<span class="cm-operator">=https://registry.npm.taobao.org</span></span></span></span></span></span></span></pre></div></li><li class="md-list-item"><span><span class="cm-comment"><span><span class="cm-builtin"><span class="cm-attribute"><span class="cm-attribute"><span class="cm-operator"><code class="javascript plain">&nbsp;npm install --registry=https:</code><code class="javascript comments">//registry.npm.taobao.org</code><br /></span></span></span></span></span></span></span></li></ul></li></ul><h1 class="md-end-block md-heading"><span class="md-plain">Package.json</span></h1><p class="md-end-block md-p"><span class="md-plain">新建文件夹，建立package.json文件</span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span>{<br /><span> &nbsp; &nbsp;<span class="cm-string cm-property">"name": <span class="cm-string">"xxx", &nbsp;<span class="cm-error"># 名称不能大写，不能有注释<br /><span> &nbsp; &nbsp;<span class="cm-string">"version": <span class="cm-string">"1.0",<br /><span> &nbsp; &nbsp;<span class="cm-string">"main":<span class="cm-string">"index.js", <span class="cm-error"># 设置入口文件<br /><span> &nbsp; &nbsp;<span class="cm-string">"scripts":{<span class="cm-error"># 自定义命令<br /><span> &nbsp; &nbsp;<br /><span>}<br /><span><span class="cm-tab">    <span class="cm-string">"author":<span class="cm-string">"",<br /><span><span class="cm-tab">    <span class="cm-string">"license":<span class="cm-string">"ISC",<br /><span> &nbsp; &nbsp;<span class="cm-string">"dependencies":{ &nbsp;<span class="cm-error"># 依赖文件<br /><span>}<br /><span>}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">npm常用操作</span></h1><p class="md-end-block md-p"><span class="md-image md-img-loaded" data-src="https://i.loli.net/2020/05/25/EPzwL6SMqRfbI1u.png"><img src="https://i.loli.net/2020/05/25/EPzwL6SMqRfbI1u.png" alt="image-20200525120425126" /><span class="md-image md-img-loaded" data-src="https://i.loli.net/2020/05/25/Vhv3BwWrjgEI5nM.png"><img src="https://i.loli.net/2020/05/25/Vhv3BwWrjgEI5nM.png" alt="image-20200525120549200" /><span class="md-image md-img-loaded" data-src="https://i.loli.net/2020/05/25/P7RCMSoe32zFuVa.png"><img src="https://i.loli.net/2020/05/25/P7RCMSoe32zFuVa.png" alt="image-20200525120812047" /></span></span></span></p><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-builtin">cd <span class="cm-number">20.2 &nbsp;<span class="cm-comment"># 进入文件夹<br /><span><span class="cm-builtin">npm init <span class="cm-attribute">-y <span class="cm-comment"># 初始化文件---》会生成package.json y表示默认参数<br /><span><span class="cm-builtin">npm i jquery <span class="cm-attribute">--save <br /><span><span class="cm-comment"># 安装jquery -----》产生node_modules目录专门存放模块，<br /><span class="cm-tab-wrap-hack"><span class="cm-comment"># <span class="cm-tab">  与package-lock.json,<br /><span class="cm-tab-wrap-hack"><span class="cm-comment">#<span class="cm-tab">   npm i bootstrap,vue<br /><span class="cm-tab-wrap-hack"><span class="cm-comment"># <span class="cm-tab">  包名不能乱写，查询地址：https://www.npmjs.com/<br /><span class="cm-tab-wrap-hack"><span class="cm-comment"># <span class="cm-tab">  save 表示依赖写入package.json &nbsp; <br /><span><span class="cm-comment"># &nbsp; --save-dev 表示只有生产环境使用<br /><span>nmp <span class="cm-attribute">-g  <span class="cm-tab">    <span class="cm-tab">    <span class="cm-attribute">---&gt;<span class="cm-tab">    cnmp <span class="cm-attribute">-g<br /><span><span class="cm-builtin">npm <span class="cm-attribute">--save <span class="cm-tab"> <span class="cm-tab">    <span class="cm-attribute">---&gt;<span class="cm-tab">    cnmp <span class="cm-attribute">-S<br /><span><span class="cm-builtin">npm <span class="cm-attribute">--save-dev <span class="cm-tab"> <span class="cm-attribute">---&gt;<span class="cm-tab">    cnpm <span class="cm-attribute">-D</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># html 标签src引入即可使用<br /><span><span class="cm-comment"># 此时删除node_modules,也可以<br /><span><span class="cm-comment"># 在另一个环境中，即可还原所有node_modules<br /><span><span class="cm-builtin">npm i <br /><span><span class="cm-comment"># 当不需要时卸载即可<br /><span><span class="cm-builtin">npm uninstall xxx<br /><span><span class="cm-comment"># 更新<br /><span><span class="cm-builtin">npm update jquery <br /><span><span class="cm-comment"># 指定版本<br /><span><span class="cm-builtin">npm install jquery@3.0.0</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><h1 class="md-end-block md-heading"><span class="md-plain">使用别人的包</span></h1><div class="code-wrapper"><pre class="md-fences md-end-block ty-contain-cm modeLoaded"><span><span class="cm-comment"># 自己的包入口文件index.js<br /><span><span class="cm-builtin">node index.js <span class="cm-comment"># 运行<br /><span><span>​<br /><span><span class="cm-comment"># index.js 中使用其他包<br /><span><span class="cm-comment"># 会到所有的node_modules寻找名字为math的软件包，根据package.json 入口文件引入<br /><span>let math <span class="cm-operator">= require(<span class="cm-string">'math') <br /><span>let res <span class="cm-operator">= math.sum([1,2,3])<br /><span>console.log(res)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre></div><p><span>&nbsp;</span></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/nginx/"/>
    <url>/2022/01/16/cnblog/nginx/</url>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>并发量小，用户使用的少，所以在低并发的情况下，一个jar包启动应用就够了，然后内部tomcat返回内容给用户。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy98b25257-71be-48f3-8afe-e1226ebc4589.png" alt="img"><br>但是慢慢的，使用我们平台的用户越来越多了，并发量慢慢增大了，这时候一台服务器满足不了我们的需求了。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy1d77bc35-df30-46fb-8c41-61ff4468d0c9.png" alt="img"><br>于是我们横向扩展，又增加了服务器。这个时候几个项目启动在不同的服务器上，用户要访问，就需要增加一个代理服务器了，通过代理服务器来帮我们转发和处理请求。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy33ee7313-9356-46e6-a0b2-fc1ed8ef9a62.png" alt="img"><br>我们希望这个代理服务器可以帮助我们接收用户的请求，然后将用户的请求按照规则帮我们转发到不同的服务器节点之上。这个过程用户是无感知的，用户并不知道是哪个服务器返回的结果，我们还希望他可以按照服务器的性能提供不同的权重选择。保证最佳体验！所以我们使用了Nginx。</p><h2 id="什么是Nginx？"><a href="#什么是Nginx？" class="headerlink" title="什么是Nginx？"></a>什么是Nginx？</h2><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。2011年6月1日，nginx 1.0.4发布。</p><p>其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。在全球活跃的网站中有12.18%的使用比率，大约为2220万个网站。</p><p>Nginx 是一个安装非常的简单、配置文件非常简洁（还能够支持perl语法）、Bug非常少的服务。Nginx 启动特别容易，并且几乎可以做到7*24不间断运行，即使运行数个月也不需要重新启动。你还能够不间断服务的情况下进行软件版本的升级。</p><p>Nginx代码完全用C语言从头写成。官方数据测试表明能够支持高达 50,000 个并发连接数的响应。</p><h2 id="Nginx作用？"><a href="#Nginx作用？" class="headerlink" title="Nginx作用？"></a>Nginx作用？</h2><blockquote><p>Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理。</p></blockquote><p>正向代理<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy46bdad36-d3e0-43b0-a223-43360b7e8fc7.png" alt="img"><br>反向代理<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy62a15097-6e2a-4dbe-bcf5-f0d7cab81089.png" alt="img"></p><blockquote><p>Nginx提供的负载均衡策略有2种：内置策略和扩展策略。内置策略为轮询，加权轮询，Ip hash。扩展策略，就天马行空，只有你想不到的没有他做不到的。</p></blockquote><p>轮询<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy4d33dfac-1949-4b2d-abb8-fe0b6e65b8dc.png" alt="img"><br>加权轮询<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyb1e3e440-4159-4259-a174-528b56cb04b2.png" alt="img"><br>iphash对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。<br><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudy64acb9a3-cd1a-4c0e-a1fa-9b220046a95a.png" alt="img"></p><blockquote><p>动静分离，在我们的软件开发中，有些请求是需要后台处理的，有些请求是不需要经过后台处理的（如：css、html、jpg、js等等文件），这些不需要经过后台处理的文件称为静态文件。让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作。提高资源响应的速度。</p></blockquote><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyedb1bbd6-e530-4aba-8fde-68658a10e73f.png" alt="img"></p><p>目前，通过使用Nginx大大提高了我们网站的响应速度，优化了用户体验，让网站的健壮性更上一层楼！</p><h1 id="Nginx的安装"><a href="#Nginx的安装" class="headerlink" title="Nginx的安装"></a>Nginx的安装</h1><h2 id="windows下安装"><a href="#windows下安装" class="headerlink" title="windows下安装"></a>windows下安装</h2><p><strong>1、下载nginx</strong></p><p><a href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a> 下载稳定版本。<br>以nginx/Windows-1.16.1为例，直接下载 nginx-1.16.1.zip。<br>下载后解压，解压后如下：</p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyb5a1d538-352c-4aa6-88f7-23d18f0588ab.png" alt="img"></p><p><strong>2、启动nginx</strong></p><p>有很多种方法启动nginx</p><p>(1)直接双击nginx.exe，双击后一个黑色的弹窗一闪而过</p><p>(2)打开cmd命令窗口，切换到nginx解压目录下，输入命令 <code>nginx.exe</code> ，回车即可</p><p><strong>3、检查nginx是否启动成功</strong></p><p>直接在浏览器地址栏输入网址 <a href="http://localhost/">http://localhost:80</a> 回车，出现以下页面说明启动成功！</p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudya21688c8-159e-4caa-8e65-3dc056b6b78e.png" alt="img"></p><p><strong>4、配置监听</strong></p><p>nginx的配置文件是conf目录下的nginx.conf，默认配置的nginx监听的端口为80，如果80端口被占用可以修改为未被占用的端口即可。</p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyf23105c4-b0b2-4e22-a1bf-b8098f40c144.png" alt="img"></p><p>当我们修改了nginx的配置文件nginx.conf 时，不需要关闭nginx后重新启动nginx，只需要执行命令 <code>nginx -s reload</code> 即可让改动生效</p><p><strong>5、关闭nginx</strong></p><p>如果使用cmd命令窗口启动nginx， 关闭cmd窗口是不能结束nginx进程的，可使用两种方法关闭nginx</p><ul><li><p>输入nginx命令 <code>nginx -s stop</code>(快速停止nginx) 或 <code>nginx -s quit</code>(完整有序的停止nginx)</p></li><li><p>使用taskkill <code>taskkill /f /t /im nginx.exe</code></p></li></ul><figure class="highlight jboss-cli"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs jboss-cli">taskkill是用来终止进程的，<span class="hljs-string">/f</span>是强制终止 <span class="hljs-string">./t</span>终止指定的进程和任何由此启动的子进程。<span class="hljs-string">/im</span>示指定的进程名称 .<br></code></pre></td></tr></table></figure><h2 id="linux下安装"><a href="#linux下安装" class="headerlink" title="linux下安装"></a>linux下安装</h2><p><strong>1、安装gcc</strong></p><p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">yum</span> <span class="hljs-comment">install</span> <span class="hljs-comment">gcc</span><span class="hljs-literal">-</span><span class="hljs-comment">c</span>++<br></code></pre></td></tr></table></figure><p><strong>2、PCRE pcre-devel 安装</strong></p><p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y pcre pcre-devel<br></code></pre></td></tr></table></figure><p><strong>3、zlib 安装</strong></p><p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nsis">yum install -y <span class="hljs-literal">zlib</span> <span class="hljs-literal">zlib</span>-devel<br></code></pre></td></tr></table></figure><p><strong>4、OpenSSL 安装</strong><br>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<br>nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">yum <span class="hljs-keyword">install</span> -y openssl openssl-devel<br></code></pre></td></tr></table></figure><p><strong>5、下载安装包</strong></p><p>手动下载.tar.gz安装包，地址：<a href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a></p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyf51b946d-fda4-4675-b913-2084e028a5c0.png" alt="img"></p><p>下载完毕上传到服务器上 /root</p><p><strong>6、解压</strong></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">tar</span> -zxvf nginx-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span>.tar.gzcd nginx-<span class="hljs-number">1</span>.<span class="hljs-number">18</span>.<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyd8290598-ede7-4b4b-875b-2f447a9c001f.png" alt="img"></p><p><strong>7、配置</strong></p><p>使用默认配置，在nginx根目录下执行</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">./configuremakemake <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure><p>查找安装路径： <code>whereis nginx</code></p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyf80f8dc2-d5df-4bc2-933d-6ce11f388f6e.png" alt="img"></p><h2 id="Nginx常用命令"><a href="#Nginx常用命令" class="headerlink" title="Nginx常用命令"></a>Nginx常用命令</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-keyword">cd</span> <span class="hljs-string">/usr/local/nginx/sbin/</span><br><span class="hljs-string">./nginx</span>  启动<br><span class="hljs-string">./nginx</span> -s stop  停止<br><span class="hljs-string">./nginx</span> -s <span class="hljs-keyword">quit</span>  安全退出<br><span class="hljs-string">./nginx</span> -s <span class="hljs-keyword">reload</span>  重新加载配置文件<br>ps aux|grep nginx  查看nginx进程<br></code></pre></td></tr></table></figure><p>启动成功访问 服务器ip:80</p><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/01/25/kuangstudyd64b251b-817c-436b-b7a0-57da7bb48cd1.png" alt="img"></p><p>注意：如何连接不上，检查阿里云安全组是否开放端口，或者服务器防火墙是否开放端口！<br>相关命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 开启</span><br>service firewalld start<br><span class="hljs-meta">#</span><span class="bash"> 重启</span><br>service firewalld restart<br><span class="hljs-meta">#</span><span class="bash"> 关闭</span><br>service firewalld stop<br><span class="hljs-meta">#</span><span class="bash"> 查看防火墙规则</span><br>firewall-cmd --list-all<br><span class="hljs-meta">#</span><span class="bash"> 查询端口是否开放</span><br>firewall-cmd --query-port=8080/tcp<br><span class="hljs-meta">#</span><span class="bash"> 开放80端口</span><br>firewall-cmd --permanent --add-port=80/tcp<br><span class="hljs-meta">#</span><span class="bash"> 移除端口</span><br>firewall-cmd --permanent --remove-port=8080/tcp<br><span class="hljs-meta">#</span><span class="bash">重启防火墙(修改配置后要重启防火墙)</span><br>firewall-cmd --reload<br><span class="hljs-meta">#</span><span class="bash"> 参数解释1、firwall-cmd：是Linux提供的操作firewall的一个工具；2、--permanent：表示设置为持久；3、--add-port：标识添加的端口；</span><br></code></pre></td></tr></table></figure><h1 id="负载均衡配置"><a href="#负载均衡配置" class="headerlink" title="负载均衡配置"></a>负载均衡配置</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">upstream</span> fuzaiconf&#123;    <br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8080</span> weight=<span class="hljs-number">1</span>;    <br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8081</span> weight=<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-attribute">location</span> / &#123;    <br>    <span class="hljs-attribute">proxy_pass</span> http://fuzaiconf; <br>&#125;<br><span class="hljs-comment"># ======================================</span><br><span class="hljs-attribute">upstream</span> fuzaiconf2&#123;<br>    <span class="hljs-attribute">server</span> <span class="hljs-number">127.0.0.1:8080</span> weight=<span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-attribute">location</span> /admin&#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://fuzaiconf2;<br>&#125;<br><span class="hljs-attribute">location</span> /front&#123;<br>    <span class="hljs-attribute">proxy_pass</span> http://fuzaiconf;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h1><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-comment"># 端口</span><br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">8080</span>;<br>    <span class="hljs-comment"># 地址</span><br>    <span class="hljs-attribute">server_name</span>  localhost;<br>    <span class="hljs-comment"># DNS解析地址</span><br>    <span class="hljs-attribute">resolver</span> <span class="hljs-number">8.8.8.8</span>;<br>    <span class="hljs-comment"># 代理参数</span><br>    <span class="hljs-attribute">location</span> / &#123;<br>        <span class="hljs-comment"># $http_host就是我们要访问的主机名</span><br>        <span class="hljs-comment"># $request_uri就是我们后面所加的参数</span><br>        <span class="hljs-attribute">proxy_pass</span> http://$http_host$request_uri;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>原文链接：<a href="http://www.kuangstudy.com/bbs/1353634800149213186">http://www.kuangstudy.com/bbs/1353634800149213186</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/netty/"/>
    <url>/2022/01/16/cnblog/netty/</url>
    
    <content type="html"><![CDATA[<h1 id="BIO"><a href="#BIO" class="headerlink" title="BIO"></a>BIO</h1><p>同步阻塞bio：链接数目较少</p><p><img src="https://i.loli.net/2020/09/22/tiBlm8WUurfb4sP.png" alt="image-20200922101237506"></p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args[])</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    ExecutorService pool = ThreadPool.getCachedThreadPool();<br>    ServerSocket socket = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">6666</span>);<br>    System.out.println(<span class="hljs-string">&quot;服务器启动....&quot;</span>);<br>    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>        <span class="hljs-keyword">final</span> Socket client = socket.accept();<br>        System.out.println(<span class="hljs-string">&quot;this is a client&quot;</span>);<br>        pool.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                handler(client);<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(Socket socket)</span></span>&#123;<br>    System.out.print(String.format(<span class="hljs-string">&quot;线程id: %s 线程name: %s&quot;</span>,Thread.currentThread().getId(),Thread.currentThread().getName()));<br>    <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br>    <span class="hljs-keyword">try</span> (InputStream inputStream = socket.getInputStream()) &#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>            <span class="hljs-keyword">int</span> read = inputStream.read(bytes);<br>            <span class="hljs-keyword">if</span>(read!=-<span class="hljs-number">1</span>)&#123;<br>                System.out.print(<span class="hljs-keyword">new</span> String(bytes,<span class="hljs-number">0</span>,read));<br>            &#125;<span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            socket.close();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h1><ul><li><p>同步非阻塞nio：链接数目较多且链接比较短，聊天，弹幕，服务器间通讯</p></li><li><p>三大组件：</p><ul><li><p>channel，</p><ul><li>每个channel对应一个buffer</li><li>双向，可以返回os底层的情况</li><li>file channel</li><li>dataprogram channel</li><li>file channel</li></ul></li><li><p>buffer，</p><ul><li>内存块，底层是数组</li><li>数据读取的位置，与bio不同，不使用流，但也可以双向读取（filp方法：反转）</li><li>重要属性<ul><li>Capacity：容量大小，不可改变</li><li>Limit：极限位置标记，可变，默认就是Capacity</li><li>mark：标记 默认-1</li><li>Position：下一个要被读或写的位置索引</li></ul></li></ul><p><font color=red>buffer的读写都依赖这四个属性，</font></p></li><li><p>Selector</p><ul><li>对应一个线程</li><li>对应多个channel</li></ul></li></ul></li></ul><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><img src="https://i.loli.net/2020/09/22/SKMy5eONbIkufXj.png" alt="image-20200922110437831"></td><td><img src="https://i.loli.net/2020/09/22/LbhtungkqReaNzY.png" alt="image-20200922111521881"></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">String str = <span class="hljs-string">&quot;hello world&quot;</span>;<br><span class="hljs-keyword">try</span> (FileOutputStream stream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-string">&quot;d:/desktop/1.txt&quot;</span>)) &#123;<br>    FileChannel channel = stream.getChannel();<br>    ByteBuffer buffer1 = ByteBuffer.allocate(<span class="hljs-number">1024</span>);<br>    buffer1.put(str.getBytes());<br>    buffer1.flip();<br>    channel.write(buffer1);<br>    stream.close();<br>&#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>    e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/22/RV1wMjdHOJUL9Ef.png" alt="image-20200922120031552"></p><p>文件复制：同一个buffer</p><p><img src="https://i.loli.net/2020/09/22/kpjWzmaU3uQ8nLE.png" alt="image-20200922120221883"></p><p>文件复制：使用通道的transform()，或transto()方法，更方便</p><p>文件直接修改，文件内容不再进入jvm，buffer直接映射到文件</p><p><img src="https://i.loli.net/2020/09/22/ldL245tx6wBimpf.png" alt="image-20200922122102802"></p><p>通信示例</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">server</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    <span class="hljs-comment">// 创建ServerSocketChannel  ---》ServerSocket</span><br>    ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();<br>    InetSocketAddress socketAddress = <span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">7000</span>);<br>    serverSocketChannel.socket().bind(socketAddress);<br>    serverSocketChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>    <span class="hljs-comment">// 创建Selector</span><br>    Selector selector = Selector.open();<br><br>    <span class="hljs-comment">// serverSocketChannel注册到seletcor,事件为OP——ACCEPT</span><br>    serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);<br><br>    <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>        <span class="hljs-comment">// 没有事件</span><br>        <span class="hljs-keyword">if</span>(selector.select(<span class="hljs-number">1000</span>) == <span class="hljs-number">0</span>)&#123; <span class="hljs-comment">// selector 等待1秒钟</span><br>            System.out.println(<span class="hljs-string">&quot;waiting for 1 seconds&quot;</span>);<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-comment">// 有事件</span><br>        Set&lt;SelectionKey&gt; selectionKeys = selector.selectedKeys();<br>        Iterator&lt;SelectionKey&gt; keyIterator = selectionKeys.iterator();<br>        <span class="hljs-keyword">while</span>(keyIterator.hasNext())&#123;<br>            <span class="hljs-comment">// 获取key</span><br>            SelectionKey key = keyIterator.next();<br>            <span class="hljs-comment">// 获取对应通道</span><br>            <span class="hljs-keyword">if</span>(key.isAcceptable())&#123;<br>                <span class="hljs-comment">// 生成socketChannel</span><br>                SocketChannel socketChannel = serverSocketChannel.accept();<br>                socketChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>                <span class="hljs-comment">// socketChannel注册到selector,关注事件为OP_read</span><br>                socketChannel.register(selector,SelectionKey.OP_READ,ByteBuffer.allocate(<span class="hljs-number">1024</span>));<br>            &#125;<br>            <span class="hljs-keyword">if</span> (key.isReadable())&#123;<br>                <span class="hljs-comment">// 反向获取到channel</span><br>                SocketChannel channel = (SocketChannel) key.channel();<br>                <span class="hljs-comment">// 会获取到buffer</span><br>                ByteBuffer buffer = (ByteBuffer) key.attachment();<br>                channel.read(buffer);<br>                System.out.println(String.format(<span class="hljs-string">&quot;当前线程:%s-%s,form客户端：%s&quot;</span>,Thread.currentThread().getId(),Thread.currentThread().getName(),<span class="hljs-keyword">new</span> String(buffer.array())));<br>            &#125;<br>            <span class="hljs-comment">// 删除selectionkey，防止重复操作</span><br>            keyIterator.remove();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">client</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>    SocketChannel socketChannel = SocketChannel.open();<br>    socketChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>    <span class="hljs-comment">// 未连接上或正在连接</span><br>    <span class="hljs-keyword">if</span>(!socketChannel.connect(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">7000</span>)))&#123;<br>        <span class="hljs-keyword">while</span>(!socketChannel.finishConnect())&#123;<br>            System.out.println(<span class="hljs-string">&quot;正在连接，但客户端没有阻塞&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 已连接</span><br>    String str = <span class="hljs-string">&quot;hello world&quot;</span>;<br>    ByteBuffer buffer = ByteBuffer.wrap(str.getBytes());<br>    <span class="hljs-comment">// 发送数据</span><br>    socketChannel.write(buffer);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/22/q7QVlrYM4sRdLpH.png" alt="image-20200922140108426"></p><p><img src="https://i.loli.net/2020/09/22/98RJtx1GgWaFvM2.png" alt="image-20200922101211665"></p><h1 id="零拷贝：没有cpu-copy或copy-的信息很少"><a href="#零拷贝：没有cpu-copy或copy-的信息很少" class="headerlink" title="零拷贝：没有cpu copy或copy 的信息很少"></a>零拷贝：没有cpu copy或copy 的信息很少</h1><p>示例：服务器读取文件，发送给客户</p><ul><li><p>传统：用户—》内核—》用户—》内核，三次状态切换，四次copy</p><ul><li>硬件–》内核：dma copy<ul><li>用户态–》内核态</li></ul></li><li>内核—》用户：cpu copy<ul><li>内核态–》用户态</li></ul></li><li>用户—》socket： cpu copy<ul><li>用户态—》内核态</li></ul></li><li>socket—》硬件协议：dma copy</li></ul></li><li><p>mmap：内存映射，将用户内存映射到内核</p><ul><li>还是3次切换，但只有3次copy</li><li>硬件–》内核：dma copy<ul><li>用户态–》内核态</li><li>此时内核数据用户共享，<font color=red>但此时程序获取数据会进行状态切换,所以还是3次状态切换</font></li></ul></li><li>内核—》socket： cpu copy<ul><li>用户态—》内核态</li></ul></li><li>socket—》硬件协议：dma copy</li></ul></li></ul><p>sendFile：2次切换，3次copy  linux2.1</p><ul><li>硬件–》内核：dma copy<ul><li>用户态–》内核态</li></ul></li><li>内核—》socket：cup copy<ul><li>内核态—》用户态</li></ul></li><li>socket—》硬件协议：dma copy</li></ul><p>sendFile：2次切换，2次copy  linux2.4</p><ul><li><p>硬件–》内核：dma copy</p><ul><li><p>用户态–》内核态</p></li><li><p>内核态—》用户态</p></li></ul></li><li><p>内核（socket）—》硬件协议：dma copy</p></li></ul><h1 id="AIO"><a href="#AIO" class="headerlink" title="AIO"></a>AIO</h1><p>异步非阻塞aio：链接数目多，并且链接时间长</p><p><img src="https://i.loli.net/2020/09/22/H9Ysx2LwJRvSl7a.png" alt="image-20200922153711739"></p><h1 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h1><ul><li>用于基于nio的数据传输（大数据，小数据都可）框架</li><li>自己用nio写，还是比较偏底层的，比较麻烦</li><li>简化nio的开发流程</li><li>tcp/upd(传输协议)—-》nio（基于传输协议的api），netty——》用用协议（http，websocket，ssl等等）</li></ul><h6 id="传统网络I-O服务模型"><a href="#传统网络I-O服务模型" class="headerlink" title="传统网络I/O服务模型"></a>传统网络I/O服务模型</h6><p><img src="https://i.loli.net/2020/09/22/SVZOUt41T6PDJWE.png" alt="image-20200922155132004"></p><h6 id="REACTOR模型"><a href="#REACTOR模型" class="headerlink" title="REACTOR模型"></a>REACTOR模型</h6><ul><li>基于I/O多路复用</li><li>基于线程池线程复用</li></ul><p><img src="https://i.loli.net/2020/09/22/yTPZYd3capDq92k.png" alt="image-20200922160119610"></p><p>单Rector单线程</p><p><img src="https://i.loli.net/2020/09/22/EurIJjyqRVSHBA1.png" alt="image-20200922160638095"></p><p>单Rector多线程</p><p><img src="https://i.loli.net/2020/09/22/Usga2mBWzxHkAKY.png" alt="image-20200922160845862"></p><h6 id="主从Reactor"><a href="#主从Reactor" class="headerlink" title="主从Reactor"></a>主从Reactor</h6><p><img src="https://i.loli.net/2020/09/22/At4rRkvigUOPF8C.png" alt="image-20200922162138699"></p><h6 id="Netty-1"><a href="#Netty-1" class="headerlink" title="Netty"></a>Netty</h6><ul><li><p>BossGroup，负责接收客户端连接</p></li><li><p>WorkGroup，负责读写</p></li><li><p>NioEventLoopGroup，事件循环组</p><ul><li>NioEventLoop，不断循环的处理任务线程，有一个selector</li></ul></li><li><p>boss nioeventloop</p><ul><li>轮训accept事件</li><li>处理accept事件，与client建立连接，</li><li>生成NioSocketChannel，并注册到某个work的NIOEventLoop的selector</li><li>处理任务队列的任务</li></ul></li><li><p>work nioeventloop</p><ul><li>轮训read，write事件</li><li>处理i/o事件，即read，write，在NiosocketChannel处理</li><li>处理队列任务</li></ul></li><li><p>work nioeventloop处理数据会使用pipline</p><ul><li>pipline包含channel</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// netty 聊天</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Server</span></span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br>        <span class="hljs-comment">// 连个线程组，</span><br>        <span class="hljs-comment">// 处理链接，默认线程数=cup核数*2</span><br>        EventLoopGroup bossGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 处理业务</span><br>        EventLoopGroup workGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 服务端启动对象</span><br>        ServerBootstrap bootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>        <span class="hljs-keyword">try</span> &#123;<br>            bootstrap.group(bossGroup, workGroup)<br>                .channel(NioServerSocketChannel.class)  <span class="hljs-comment">// 通道类型</span><br>                .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>) <span class="hljs-comment">// 线程队列链接数</span><br>                .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-keyword">true</span>) <span class="hljs-comment">//保持活动链接状态</span><br>                .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> NettyServerHandler());<br>                    &#125;<br>                &#125;); <span class="hljs-comment">// 给workgroup的eventloop设置处理器</span><br>            <span class="hljs-comment">// 绑定端口,并启动</span><br>            ChannelFuture cf = bootstrap.bind(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">6668</span>).sync();<br>            System.out.println(<span class="hljs-string">&quot;服务端启动....&quot;</span>);<br>            <span class="hljs-comment">// 关闭，当有关闭事件时关闭</span><br>            cf.channel().closeFuture().sync();<br>        &#125;<span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            bossGroup.shutdownGracefully();<br>            workGroup.shutdownGracefully();<br>        &#125;<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NettyServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChannelInboundHandlerAdapter</span> </span>&#123;<br>    <span class="hljs-comment">// 读取客户端消息</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(ctx.channel().remoteAddress());<br>        System.out.println(((ByteBuf)msg).toString(CharsetUtil.UTF_8));<br>        <br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelReadComplete</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="hljs-string">&quot;hello 客户端&quot;</span>, CharsetUtil.UTF_8));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ctx.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Client</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// 事件循环组</span><br>        EventLoopGroup eventExecutors = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 客户端对象</span><br>        Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>        <span class="hljs-keyword">try</span> &#123;<br>            bootstrap.group(eventExecutors) <span class="hljs-comment">// 设置线程组</span><br>                .channel(NioSocketChannel.class) <span class="hljs-comment">// 设置通道实现类</span><br>                .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                        ch.pipeline().addLast(<span class="hljs-keyword">new</span> NettyClientHandler()); <span class="hljs-comment">// 加入处理器</span><br>                    &#125;<br>                &#125;);<br>            <span class="hljs-comment">// 启动</span><br>            ChannelFuture cf = bootstrap.connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">6668</span>).sync();<br>            cf.channel().closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            eventExecutors.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NettyClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChannelInboundHandlerAdapter</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelActive</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ctx&quot;</span>+ctx);<br>        ctx.writeAndFlush(Unpooled.copiedBuffer(<span class="hljs-string">&quot;客户端发来的信息&quot;</span>,CharsetUtil.UTF_8));<br>    &#125;<br><br>    <span class="hljs-comment">// 读取客户端消息</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(ctx.channel().remoteAddress());<br>        System.out.println(((ByteBuf)msg).toString(CharsetUtil.UTF_8));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelReadComplete</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">super</span>.channelReadComplete(ctx);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">exceptionCaught</span><span class="hljs-params">(ChannelHandlerContext ctx, Throwable cause)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ctx.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Netty-Task"><a href="#Netty-Task" class="headerlink" title="Netty Task"></a>Netty Task</h1><ul><li>用户自定义普通任务</li><li>用户自定义定时任务</li><li>非Reactor调用channel：服务器推送信息到客户端</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 用户自定义的普通任务</span><br> <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead</span><span class="hljs-params">(ChannelHandlerContext ctx, Object msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(ctx.channel().remoteAddress());<br>        System.out.println(((ByteBuf)msg).toString(CharsetUtil.UTF_8));<br>        <span class="hljs-comment">// 若此时是耗时任务，客户端都要等待服务器执行完毕，</span><br>        <span class="hljs-comment">// 通过下面方式可以异步执行，就是将任务交给了netty的task</span><br>        ctx.channel().eventLoop().execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                System.out.println(ctx.channel().remoteAddress());<br>                System.out.println(((ByteBuf)msg).toString(CharsetUtil.UTF_8));<br>            &#125;<br>        &#125;);<br>        <span class="hljs-comment">// 任务放在scheduleTaskQueue</span><br>        ctx.channel().eventLoop().schedule(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                System.out.println(ctx.channel().remoteAddress());<br>                System.out.println(((ByteBuf)msg).toString(CharsetUtil.UTF_8));<br>            &#125;<br>        &#125;,<span class="hljs-number">5</span>, TimeUnit.SECONDS);<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="Netty实现Http协议"><a href="#Netty实现Http协议" class="headerlink" title="Netty实现Http协议"></a>Netty实现Http协议</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span></span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span></span>&#123;<br>        <span class="hljs-comment">// 连个线程组，</span><br>        <span class="hljs-comment">// 处理链,默认线程数=cup核数*2</span><br>        EventLoopGroup bossGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 处理业务</span><br>        EventLoopGroup workGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 服务端启动对象</span><br>        ServerBootstrap bootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>        <span class="hljs-keyword">try</span> &#123;<br>            bootstrap.group(bossGroup, workGroup)<br>                    .channel(NioServerSocketChannel.class)  <span class="hljs-comment">// 通道类型</span><br>                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>) <span class="hljs-comment">// 线程队列链接数</span><br>                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-keyword">true</span>) <span class="hljs-comment">//保持活动链接状态</span><br>                    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<span class="hljs-comment">// 给workgroup添加handler</span><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<span class="hljs-comment">// 每个请求pipline与handler是不共享的，</span><br><br>                            <span class="hljs-comment">// 得到管道</span><br>                            ChannelPipeline pipeline = ch.pipeline();<br>                            <span class="hljs-comment">// http 解码器</span><br>                            pipeline.addLast(<span class="hljs-keyword">new</span> HttpServerCodec());<br>                            <span class="hljs-comment">// 响应</span><br>                            pipeline.addLast(<span class="hljs-keyword">new</span> NettyServerHandler());<br><br>                        &#125;<br>                    &#125;); <span class="hljs-comment">// 给workgroup的eventloop设置处理器</span><br>            <span class="hljs-comment">// 绑定端口,并启动</span><br>            ChannelFuture cf = bootstrap.bind(<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-number">8080</span>).sync();<br>            System.out.println(<span class="hljs-string">&quot;服务端启动....&quot;</span>);<br>            <span class="hljs-comment">// 关闭，当有关闭事件时关闭</span><br>            cf.channel().closeFuture().sync();<br>        &#125;<span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            bossGroup.shutdownGracefully();<br>            workGroup.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// SimpleChannelInboundHandler&lt;HttpObject&gt;是ChannelInboundHandlerAdapter的子类</span><br><span class="hljs-comment">// 通信数据被封装httpobject</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NettyServerHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">HttpObject</span>&gt; </span>&#123;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, HttpObject msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        System.out.println(ctx.channel().pipeline().hashCode()+<span class="hljs-string">&quot; &quot;</span>+<span class="hljs-keyword">this</span>.hashCode());<br>        HttpRequest request = (HttpRequest) msg;<br>        URI uri = <span class="hljs-keyword">new</span> URI(request.uri());<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;/favicon.ico&quot;</span>.equals(uri.getPath()))&#123;<br>            System.out.println(<span class="hljs-string">&quot;不作响应&quot;</span>);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        ByteBuf content = Unpooled.copiedBuffer(<span class="hljs-string">&quot;我是服务器,&quot;</span>, CharsetUtil.UTF_16);<br>        DefaultFullHttpResponse defaultFullHttpResponse = <span class="hljs-keyword">new</span> DefaultFullHttpResponse(HttpVersion.HTTP_1_0, HttpResponseStatus.OK,content);<br>        defaultFullHttpResponse.headers().set(HttpHeaderNames.CONTENT_TYPE,<span class="hljs-string">&quot;text/plain&quot;</span>);<br>        defaultFullHttpResponse.headers().set(HttpHeaderNames.CONTENT_LENGTH,content.readableBytes());<br>        ctx.writeAndFlush(defaultFullHttpResponse);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/22/yMD7cdeK2aE4FQJ.png" alt="image-20200922202021791"></p><h1 id="Unpooled类"><a href="#Unpooled类" class="headerlink" title="Unpooled类"></a>Unpooled类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 该对象包含数组，读取的时候不同flip进行翻转，底层维护了readerIndex，writerIndex</span><br>ByteBuf a = Unpooled.buffer(<span class="hljs-number">100</span>);<br>ByteBuf b = Unpooled.copiedBuffer(<span class="hljs-string">&quot;helloworld&quot;</span>,CharsetUtil.UTF_8);<br></code></pre></td></tr></table></figure><h1 id="Netty心跳检测"><a href="#Netty心跳检测" class="headerlink" title="Netty心跳检测"></a>Netty心跳检测</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 心跳检测处理器，触发器</span><br><span class="hljs-comment">// 3s没读取，发送检测包</span><br><span class="hljs-comment">// 5s没有写，发送检测包</span><br><span class="hljs-comment">// 7s没有读，也没有写，发送检测包</span><br><span class="hljs-comment">// 事件传递到下一个handler处理（自定义）</span><br>pipline.addLast(<span class="hljs-keyword">new</span> IdleStateHandler(<span class="hljs-number">3</span>,<span class="hljs-number">5</span>,7TimeUnit.SECONDS))<br>pipline.addLast(<span class="hljs-keyword">new</span> ChannelInboundHandlerAdapter()&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">userEventTriggered</span><span class="hljs-params">(ChannelHandlerContext ctx,Object evt)</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(evt instance of IdleStateEvent)&#123;<br>            IdleStateEvent event = (IdleStateEvent)evt;<br>            swicth(event.state())&#123;<br>                <span class="hljs-keyword">case</span> READER_IDLE:<br>                XXX<br>                <span class="hljs-keyword">case</span> WRITER_IDLE:<br>                XXX<br>                <span class="hljs-keyword">case</span> ALL_IDLE:<br>                XXX<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="Websocket"><a href="#Websocket" class="headerlink" title="Websocket"></a>Websocket</h1><p><img src="https://i.loli.net/2020/10/02/ciQSzFdaNxsYkCe.png" alt="image-20201002101425900"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebSocketHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleChannelInboundHandler</span>&lt;<span class="hljs-title">TextWebSocketFrame</span>&gt;</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">channelRead0</span><span class="hljs-params">(ChannelHandlerContext ctx, TextWebSocketFrame msg)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        ctx.channel().writeAndFlush(<span class="hljs-keyword">new</span> TextWebSocketFrame(<span class="hljs-string">&quot;xxxx&quot;</span>));<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handlerAdded</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">super</span>.handlerAdded(ctx);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handlerRemoved</span><span class="hljs-params">(ChannelHandlerContext ctx)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-keyword">super</span>.handlerRemoved(ctx);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> socket;<br><span class="hljs-keyword">if</span>(windows.WebSocket)&#123;<br>    socket = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&quot;ws://localhost:7000/hello&quot;</span>);<br>    socket.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ev</span>)</span>&#123;<br>        收到消息<br>    &#125;<br>    socket.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ev</span>)</span>&#123;<br>        连接开启<br>    &#125;<br>    socket.onclose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ev</span>)</span>&#123;<br>        连接关闭<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span>(<span class="hljs-params">message</span>)</span>&#123;<br>    <span class="hljs-keyword">if</span>(socket.readyState==WebSocket.OPEN)&#123;<br>socket.send(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="编码解码"><a href="#编码解码" class="headerlink" title="编码解码"></a>编码解码</h1><p>Netty编码解码</p><ul><li>StringEncoder，StringDecoder</li><li>ObjectEncoder，ObjectDecoder</li></ul><p>序列化的缺点</p><ul><li>无法跨语言</li><li>序列化体积大</li><li>序列化性能低</li></ul><h6 id="google的Protobuf"><a href="#google的Protobuf" class="headerlink" title="google的Protobuf"></a>google的Protobuf</h6><ul><li>rpc数据交换<ul><li>http+json(以前)</li><li>tcp+protobuf (现在)</li></ul></li><li>跨语言,支持很多语言</li><li>高性能</li></ul><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;protobuf4&quot;</span>;<span class="hljs-comment">// 版本号，</span><br><span class="hljs-keyword">option</span> optimize_for = SPEED; <span class="hljs-comment">// 加快解析</span><br><span class="hljs-keyword">option</span> java_package = <span class="hljs-string">&quot;top.deanxxx&quot;</span>; <span class="hljs-comment">// 指定包名</span><br><span class="hljs-keyword">option</span> java_outer_classname = <span class="hljs-string">&quot;MyData&quot;</span>;<span class="hljs-comment">//文件名，外部类名</span><br><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">MyMessage</span></span>&#123;<br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">DataType</span></span>&#123;<br>StudentType = <span class="hljs-number">0</span>;<br>UserType = <span class="hljs-number">1</span>;<br>&#125;<br>DataType data_Type = <span class="hljs-number">1</span>; <span class="hljs-comment">// MyMessage 的第一个属性</span><br><span class="hljs-keyword">oneof</span> dataBody&#123;<br>Stduent s = <span class="hljs-number">2</span>; <span class="hljs-comment">// MyMessage 的另一个属性</span><br>User u = <span class="hljs-number">3</span>;<span class="hljs-comment">// MyMessage 的另一个属性</span><br>&#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">User</span></span>&#123;<br><span class="hljs-built_in">int32</span> id = <span class="hljs-number">1</span>; <span class="hljs-comment">// id属性 ，1 表示属性的序号</span><br><span class="hljs-built_in">string</span> name = <span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">message</span> <span class="hljs-title">Student</span></span>&#123;<br><span class="hljs-built_in">int32</span> id = <span class="hljs-number">1</span>; <span class="hljs-comment">// id属性 ，1 表示属性的序号</span><br><span class="hljs-built_in">string</span> name = <span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-comment">// protoc.exe --java_out=. xxx.proto</span><br></code></pre></td></tr></table></figure><ul><li>编写proto文件</li><li>变为对对应语言</li><li>服务端对应语言中的proto编码器（handler），发送</li><li>客户端接收，对应解码器（handler）</li></ul><h1 id="数据入栈出栈"><a href="#数据入栈出栈" class="headerlink" title="数据入栈出栈"></a>数据入栈出栈</h1><p><img src="https://i.loli.net/2020/10/02/gCWvumod2BAqbU7.png" alt="image-20201002134742983"></p><h1 id="TCP粘包与拆包"><a href="#TCP粘包与拆包" class="headerlink" title="TCP粘包与拆包"></a>TCP粘包与拆包</h1><p>粘包：间隔时间短的包合并为一个</p><p>拆包：数据过大拆分</p><p>自定义协议+编解码器来解决</p><p>关键是解决服务器每次读取数据长度问题。</p><h1 id="实现RPC"><a href="#实现RPC" class="headerlink" title="实现RPC"></a>实现RPC</h1><p><img src="https://i.loli.net/2020/10/02/ngzsie86ZYdSMpC.png" alt="image-20201002144927179"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs JAVA"><span class="hljs-comment">// 公共接口</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span></span>&#123;<br>    <span class="hljs-function">String <span class="hljs-title">hello</span><span class="hljs-params">(String msg)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// provider</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> <span class="hljs-title">implement</span> <span class="hljs-title">HelloService</span></span>&#123;<br>    <span class="hljs-function">String <span class="hljs-title">hello</span><span class="hljs-params">(String msg)</span></span>&#123;<br>        <br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerBootstrap</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args)</span></span>&#123;<br>        <br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NettyServer</span></span>&#123;<br>    <span class="hljs-comment">// netty初始化</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startserver0</span><span class="hljs-params">(String hostname,<span class="hljs-keyword">int</span> port)</span></span>&#123;<br>        EventLoopGroup bossGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        EventLoopGroup workGroup = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        ServerBootstrap bootstrap = <span class="hljs-keyword">new</span> ServerBootstrap();<br>        <span class="hljs-keyword">try</span> &#123;<br>            bootstrap.group(bossGroup, workGroup)<br>                    .channel(NioServerSocketChannel.class)  <span class="hljs-comment">// 通道类型</span><br>                    .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>) <span class="hljs-comment">// 线程队列链接数</span><br>                    .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-keyword">true</span>) <span class="hljs-comment">//保持活动链接状态</span><br>                    .childHandler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            ChannelPipeline pipeline = ch.pipeline();<br>                            pipeline.addLast(<span class="hljs-keyword">new</span> StringDecoder());<br>                            pipeline.addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>                            pipeline.addLast(<span class="hljs-keyword">new</span> ServerHandler());<br>                        &#125;<br>                    &#125;); <br>            ChannelFuture cf = bootstrap.bind(hostname,port).sync();<br>            cf.channel().closeFuture().sync();<br>        &#125;<span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            bossGroup.shutdownGracefully();<br>            workGroup.shutdownGracefully();<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerHandler</span></span>&#123;<br>    channelRead:<br>    xxxxx<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NettyClient</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ExecutorService executor = Executors.newFixedThreadPool(<span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> NettyClient client;<br>    <span class="hljs-comment">// 编写方法，代理模式</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span>  Object <span class="hljs-title">getBean</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Class&lt;?&gt;serviceclass,<span class="hljs-keyword">final</span> String providerName)</span></span>&#123;<br>        <span class="hljs-keyword">return</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),<span class="hljs-keyword">new</span> Class&lt;?&gt;[]&#123;serviceClass&#125;,(proxy,method,args)-&gt;&#123;<br>            <span class="hljs-comment">// 每调用一次hello，</span><br>            <span class="hljs-keyword">if</span>(cliet ==<span class="hljs-keyword">null</span>)&#123;<br>                initial();<br>            &#125;<br>            client.setPara(prividerName+args[<span class="hljs-number">0</span>]);<br>            <span class="hljs-keyword">return</span> executor.submit(client).get()<br>        &#125;)<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initial</span><span class="hljs-params">()</span></span>&#123;<br>        client = <span class="hljs-keyword">new</span> NettyClient();<br>         EventLoopGroup eventExecutors = <span class="hljs-keyword">new</span> NioEventLoopGroup();<br>        <span class="hljs-comment">// 客户端对象</span><br>        Bootstrap bootstrap = <span class="hljs-keyword">new</span> Bootstrap();<br>        <span class="hljs-keyword">try</span> &#123;<br>            bootstrap.group(eventExecutors)<br>                    .channel(NioSocketChannel.class)<br>                .option(ChannelOption.TCP_NODELAY,<span class="hljs-keyword">true</span>)<br>                    .handler(<span class="hljs-keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initChannel</span><span class="hljs-params">(SocketChannel ch)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringDecoder());<br>                            ch.pipeline().addLast(<span class="hljs-keyword">new</span> StringEncoder());<br>                        &#125;<br>                    &#125;); <br>            <span class="hljs-comment">// 启动</span><br>            ChannelFuture cf = bootstrap.connect(<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-number">8080</span>).sync();<br>            cf.channel().closeFuture().sync();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            eventExecutors.shutdownGracefully();<br>        &#125;<br>    &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClientHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChannelInboundHandlerAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> ChannelHandlerContext ctx;<br>    <span class="hljs-keyword">private</span> String result;<br>    <span class="hljs-keyword">private</span> para;<br>    channelActivate(ctx)&#123;<br>            ctx = ctx<br>        &#125;<br>    <span class="hljs-function">synchronzied <span class="hljs-title">channelRead</span><span class="hljs-params">(msg)</span></span>&#123;<br>            result = msg.toString();<br>            notify();<br>        &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">synchronized</span> <span class="hljs-title">call</span><span class="hljs-params">()</span></span>&#123;<br>        ctx.writeAndFlush(para);<br>        wait();<br>        retutn result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/mysql/"/>
    <url>/2022/01/16/cnblog/mysql/</url>
    
    <content type="html"><![CDATA[<p>mysqladmin -u 用户名 -p oldpswd newpswd</p><p>&nbsp;</p><p>------------------------------------------------------------</p><p>having 用来操作 group by x 后 其他列按y分组后的每组信息<br />    与in any all 结合使用<br />    若比较改每小组中的集合与其他集合否相等 可转化为 相同条件下 数量之间的比较</p><p><br />select last_insert_id():函数,获取最后插入的id<br />mybatis配置:<br />    &lt;insert id="save" useGeneratedKeys="true" &gt;<br />        &lt;!-- 插入后获取新生成id 放在user 的id :即java中生成user对象,此时是无id的,有此配置,插入后,获取id时不为空--&gt;<br />        &lt;selectKey keyProperty="t_id" resultType="Integer" order="AFTER"&gt;<br />            select last_insert_id()<br />        &lt;/selectKey&gt;<br />        insert into t_user_d (t_name,t_password)values(#{t_name},#{t_password})<br />    &lt;/insert&gt;<br />--------------------------------------------------------------------------------------------------------------------------------------------</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224616113-188530900.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>Update user set password=password(&ldquo;123456&rdquo;) WHERE USER = &ldquo;ROOT&rdquo;</p><p>Update user set password=md5(&ldquo;123456&rdquo;) WHERE USER = &ldquo;ROOT&rdquo;</p><p>1,Create database if not exst dzf character set utf8</p><p>2,show variables like &ldquo;%&rdquo; 显示变量信息&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>3，alter database name character set utf8</p><p>4，查询去重 select distinct id,name ....</p><p>5，修改数据库编码 my.ini dafault-character-set=utf8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><p>修改变编码 alter table WF_ACTIONS DEFAULT CHARACTER SET utf8;</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224630713-1229339359.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224637023-20268284.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224642199-909071253.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224647505-1667793814.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>Show columns from 表名</p><p>alter table test change &nbsp;column address address1 varchar(30)--修改表列名 不能省</p><p>alter table test rename test1; --修改表名 &nbsp;</p><p>&nbsp;</p><p>alter table test add &nbsp;column name varchar(10); --添加表列 &nbsp;</p><p>&nbsp; www.2cto.com &nbsp;</p><p>alter table test drop &nbsp;column name; --删除表列 &nbsp;</p><p>&nbsp;</p><p>alter table test modify address char(10) --修改表列类型 &nbsp;</p><p>||alter table test change address address &nbsp;char(40)</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224710770-45861769.png" alt="" /></p><p>&nbsp;</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224716183-798597726.png" alt="" /></p><p>&nbsp;</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224720154-682221440.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224724883-1592708056.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>函数：</p><p>Ceil（x）大于x的最小整数</p><p>Floor（x）小于x的最大整数</p><p>Round(x）最接近x的</p><p>Round（x,y）接近x的小数保留y位，四舍五入y可为负：</p><p>例-1：表示舍去个位</p><p>Rruncate（x,y）</p><p>不四舍五入，直接截取</p><p>Mod（x,y）取余</p><p>Concat（1,2）链接1,2</p><p>Concat（x,1,2）链接12 x隔开</p><p>Lower（str）小写</p><p>Upper（str）大写</p><p>Length（str）长度</p><p>Trim，ltrim，Rtrim（str）去掉右边空格</p><p>Substring（字符，开始，长度） 截取</p><p>开始可为负，表示从倒数x个开始向右</p><p>==substr（x,y）</p><p>==mid(x,y)</p><p>Left（字符，num）左边num个</p><p>Replace（a，b）</p><p>Format（x，n）</p><p>Format（123.4567,2）= 123.46</p><p>Curdate（）=currentdate（）</p><p>Curtime（）=current_time（）</p><p>Now（）=sysdate（） date+time</p><p>Datediff(date1,date2)日期差，天数</p><p>Date_format（date,format）</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224738151-350876640.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921224743676-1297803547.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><table style="width: 766px;" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" width="124"><p>ASCII(s)</p></td><td colspan="2" valign="top" width="180"><p>返回字符串 s 的第一个字符的 ASCII 码。</p></td><td valign="top" width="462"><p>返回 CustomerName 字段第一个字母的 ASCII 码：</p><p>SELECT ASCII(CustomerName) AS NumCodeOfFirstChar</p><p>FROM Customers;</p></td></tr><tr><td valign="top" width="124"><p>CHAR_LENGTH(s)</p></td><td colspan="2" valign="top" width="180"><p>返回字符串 s 的字符数</p></td><td valign="top" width="462"><p>返回字符串 RUNOOB 的字符数</p><p>SELECT CHAR_LENGTH("RUNOOB") AS LengthOfString;</p></td></tr><tr><td valign="top" width="124"><p>CHARACTER_LENGTH(s)</p></td><td colspan="2" valign="top" width="180"><p>返回字符串 s 的字符数</p></td><td valign="top" width="462"><p>返回字符串 RUNOOB 的字符数</p><p>SELECT CHARACTER_LENGTH("RUNOOB") AS LengthOfString;</p></td></tr><tr><td valign="top" width="124"><p>CONCAT(s1,s2...sn)</p></td><td colspan="2" valign="top" width="180"><p>字符串 s1,s2 等多个字符串合并为一个字符串</p></td><td valign="top" width="462"><p>合并多个字符串</p><p>SELECT CONCAT("SQL ", "Runoob ", "Gooogle ", "Facebook") AS ConcatenatedString;</p></td></tr><tr><td valign="top" width="124"><p>CONCAT_WS(x, s1,s2...sn)</p></td><td colspan="2" valign="top" width="180"><p>同 CONCAT(s1,s2,...) 函数，但是每个字符串之间要加上 x，x 可以是分隔符</p></td><td valign="top" width="462"><p>合并多个字符串，并添加分隔符：</p><p>SELECT CONCAT_WS("-", "SQL", "Tutorial", "is", "fun!")AS ConcatenatedString;</p></td></tr><tr><td valign="top" width="124"><p>FIELD(s,s1,s2...)</p></td><td colspan="2" valign="top" width="180"><p>返回第一个字符串 s 在字符串列表(s1,s2...)中的位置</p></td><td valign="top" width="462"><p>返回字符串 c 在列表值中的位置：</p><p>SELECT FIELD("c", "a", "b", "c", "d", "e");</p></td></tr><tr><td valign="top" width="124"><p>FIND_IN_SET(s1,s2)</p></td><td colspan="2" valign="top" width="180"><p>返回在字符串s2中与s1匹配的字符串的位置</p></td><td valign="top" width="462"><p>返回字符串 c 在指定字符串中的位置：</p><p>SELECT FIND_IN_SET("c", "a,b,c,d,e");</p></td></tr><tr><td valign="top" width="124"><p>FORMAT(x,n)</p></td><td colspan="2" valign="top" width="180"><p>函数可以将数字 x 进行格式化 "#,###.##", 将 x 保留到小数点后 n 位，最后一位四舍五入。</p></td><td valign="top" width="462"><p>格式化数字 "#,###.##" 形式：</p><p>SELECT FORMAT(250500.5634, 2);&nbsp;&nbsp;&nbsp;&nbsp; -- 输出 250,500.56</p></td></tr><tr><td valign="top" width="124"><p>INSERT(s1,x,len,s2)</p></td><td colspan="2" valign="top" width="180"><p>字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串</p></td><td valign="top" width="462"><p>从字符串第一个位置开始的 6 个字符替换为 runoob：</p><p>SELECT INSERT("google.com", 1, 6, "runnob");&nbsp; -- 输出：runoob.com</p></td></tr><tr><td valign="top" width="124"><p>LOCATE(s1,s)</p></td><td colspan="2" valign="top" width="180"><p>从字符串 s 中获取 s1 的开始位置</p></td><td valign="top" width="462"><p>获取 b 在字符串 abc 中的位置：SELECT LOCATE('st','myteststring');&nbsp; -- 5</p><p>返回字符串 abc 中 b 的位置：SELECT LOCATE('b', 'abc') -- 2</p></td></tr><tr><td valign="top" width="124"><p>LCASE(s)</p></td><td colspan="2" valign="top" width="180"><p>将字符串 s 的所有字母变成小写字母</p></td><td valign="top" width="462"><p>字符串 RUNOOB 转换为小写：</p><p>SELECT LCASE('RUNOOB') -- runoob</p></td></tr><tr><td valign="top" width="124"><p>LEFT(s,n)</p></td><td colspan="2" valign="top" width="180"><p>返回字符串 s 的前 n 个字符</p></td><td valign="top" width="462"><p>返回字符串 runoob 中的前两个字符：</p><p>SELECT LEFT('runoob',2) -- ru</p></td></tr><tr><td valign="top" width="124"><p>LPAD(s1,len,s2)</p></td><td colspan="2" valign="top" width="180"><p>在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len</p></td><td valign="top" width="462"><p>将字符串 xx 填充到 abc 字符串的开始处：</p><p>SELECT LPAD('abc',5,'xx') -- xxabc</p></td></tr><tr><td valign="top" width="124"><p>MID(s,n,len)</p></td><td colspan="2" valign="top" width="180"><p>从字符串 s 的 start 位置截取长度为 length 的子字符串，同 SUBSTRING(s,n,len)</p></td><td valign="top" width="462"><p>从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：</p><p>SELECT MID("RUNOOB", 2, 3) AS ExtractString; -- UNO</p></td></tr><tr><td valign="top" width="124"><p>POSITION(s1 IN s)</p></td><td colspan="2" valign="top" width="180"><p>从字符串 s 中获取 s1 的开始位置</p></td><td valign="top" width="462"><p>返回字符串 abc 中 b 的位置：</p><p>SELECT POSITION('b' in 'abc') -- 2</p></td></tr><tr><td valign="top" width="124"><p>REPEAT(s,n)</p></td><td colspan="2" valign="top" width="180"><p>将字符串 s 重复 n 次</p></td><td valign="top" width="462"><p>将字符串 runoob 重复三次：</p><p>SELECT REPEAT('runoob',3) -- runoobrunoobrunoob</p></td></tr><tr><td valign="top" width="124"><p>REVERSE(s)</p></td><td colspan="2" valign="top" width="180"><p>将字符串s的顺序反过来</p></td><td valign="top" width="462"><p>将字符串 abc 的顺序反过来：</p><p>SELECT REVERSE('abc') -- cba</p></td></tr><tr><td valign="top" width="124"><p>RIGHT(s,n)</p></td><td colspan="2" valign="top" width="180"><p>返回字符串 s 的后 n 个字符</p></td><td valign="top" width="462"><p>返回字符串 runoob 的后两个字符：</p><p>SELECT RIGHT('runoob',2) -- ob</p></td></tr><tr><td valign="top" width="124"><p>RPAD(s1,len,s2)</p></td><td valign="top" width="178"><p>在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len</p></td><td colspan="2" valign="top" width="465"><p>将字符串 xx 填充到 abc 字符串的结尾处：</p><p>SELECT RPAD('abc',5,'xx') -- abcxx</p></td></tr><tr><td valign="top" width="124"><p>SPACE(n)</p></td><td colspan="2" valign="top" width="180"><p>返回 n 个空格</p></td><td valign="top" width="462"><p>返回 10 个空格：SELECT SPACE(10);</p></td></tr><tr><td valign="top" width="124"><p>STRCMP(s1,s2)</p></td><td colspan="2" valign="top" width="180"><p>比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1&gt;s2 返回 1，如果 s1&lt;s2 返回 -1</p></td><td valign="top" width="462"><p>比较字符串：</p><p>SELECT STRCMP("runoob", "runoob");&nbsp; -- 0</p></td></tr><tr><td valign="top" width="124"><p>SUBSTRING_INDEX(s, delimiter, number)</p></td><td colspan="2" valign="top" width="180"><p>返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。<br />  如果 number 是正数，返回第 number 个字符左边的字符串。<br />  如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。</p>  </td><td valign="top" width="462"><p>SELECT SUBSTRING_INDEX('a*b','*',1) -- a</p><p>SELECT  SUBSTRING_INDEX('a*b','*',-1)&nbsp;&nbsp;&nbsp;&nbsp;-- b</p><p>SELECT  SUBSTRING_INDEX(SUBSTRING_INDEX('a*b*c*d*e','*',3),'*',-1)&nbsp;&nbsp;&nbsp;&nbsp;--  c</p>  </td> </tr></tbody></table><p>&nbsp;</p><p>Hex(&lsquo;a&rsquo;)转化16进制</p><p>Unhex（&lsquo;61&rsquo;）-&gt;字符</p><p>Select 0x61 直接到字符</p><h2>MySQL 数字函数</h2><table style="width: 757px;" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" width="129"><p>函数名</p></td><td valign="top" width="281"><p>描述</p></td><td valign="top" width="348"><p>实例</p></td></tr><tr><td valign="top" width="129"><p>ABS(x)</p></td><td valign="top" width="281"><p>返回 x 的绝对值　　</p></td><td valign="top" width="348"><p>返回 -1 的绝对值：</p><p>SELECT ABS(-1) -- 返回1</p></td></tr><tr><td valign="top" width="129"><p>ACOS(x)</p></td><td valign="top" width="281"><p>求 x 的反余弦值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT ACOS(0.25);</p></td></tr><tr><td valign="top" width="129"><p>ASIN(x)</p></td><td valign="top" width="281"><p>求反正弦值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT ASIN(0.25);</p></td></tr><tr><td valign="top" width="129"><p>ATAN(x)</p></td><td valign="top" width="281"><p>求反正切值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT ATAN(2.5);</p></td></tr><tr><td valign="top" width="129"><p>ATAN2(n, m)</p></td><td valign="top" width="281"><p>求反正切值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT ATAN2(-0.8, 2);</p></td></tr><tr><td valign="top" width="129"><p>AVG(expression)</p></td><td valign="top" width="281"><p>返回一个表达式的平均值，expression 是一个字段</p></td><td valign="top" width="348"><p>返回 Products 表中Price 字段的平均值：</p><p>SELECT AVG(Price) AS AveragePrice FROM Products;</p></td></tr><tr><td valign="top" width="129"><p>CEIL(x)</p></td><td valign="top" width="281"><p>返回大于或等于 x 的最小整数　</p></td><td valign="top" width="348"><p>SELECT CEIL(1.5) -- 返回2</p></td></tr><tr><td valign="top" width="129"><p>CEILING(x)</p></td><td valign="top" width="281"><p>返回大于或等于 x 的最小整数　</p></td><td valign="top" width="348"><p>SELECT CEIL(1.5) -- 返回2</p></td></tr><tr><td valign="top" width="129"><p>COS(x)</p></td><td valign="top" width="281"><p>求余弦值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT COS(2);</p></td></tr><tr><td valign="top" width="129"><p>COT(x)</p></td><td valign="top" width="281"><p>求余切值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT COT(6);</p></td></tr><tr><td valign="top" width="129"><p>COUNT(expression)</p></td><td valign="top" width="281"><p>返回查询的记录总数，expression 参数是一个字段或者 * 号</p></td><td valign="top" width="348"><p>返回 Products 表中 products 字段总共有多少条记录：</p><p>SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;</p></td></tr><tr><td valign="top" width="129"><p>DEGREES(x)</p></td><td valign="top" width="281"><p>将弧度转换为角度　　</p></td><td valign="top" width="348"><p>SELECT DEGREES(3.1415926535898) -- 180</p></td></tr><tr><td valign="top" width="129"><p>n DIV m</p></td><td valign="top" width="281"><p>整除，n 为被除数，m 为除数</p></td><td valign="top" width="348"><p>计算 10 除于 5：</p><p>SELECT 10 DIV 5;&nbsp; -- 2</p></td></tr><tr><td valign="top" width="129"><p>EXP(x)</p></td><td valign="top" width="281"><p>返回 e 的 x 次方　　</p></td><td valign="top" width="348"><p>计算 e 的三次方：</p><p>SELECT EXP(3) -- 20.085536923188</p></td></tr><tr><td valign="top" width="129"><p>FLOOR(x)</p></td><td valign="top" width="281"><p>返回小于或等于 x 的最大整数　　</p></td><td valign="top" width="348"><p>小于或等于 1.5 的整数：</p><p>SELECT FLOOR(1.5) -- 返回1</p></td></tr><tr><td valign="top" width="129"><p>GREATEST(expr1, expr2, expr3, ...)</p></td><td valign="top" width="281"><p>返回列表中的最大值</p></td><td valign="top" width="348"><p>返回以下数字列表中的最大值：</p><p>SELECT GREATEST(3, 12, 34, 8, 25); -- 34</p><p>返回以下字符串列表中的最大值：</p><p>SELECT GREATEST("Google", "Runoob", "Apple");&nbsp;&nbsp; -- Runoob</p></td></tr><tr><td valign="top" width="129"><p>LEAST(expr1, expr2, expr3, ...)</p></td><td valign="top" width="281"><p>返回列表中的最小值</p></td><td valign="top" width="348"><p>返回以下数字列表中的最小值：</p><p>SELECT LEAST(3, 12, 34, 8, 25); -- 3</p><p>返回以下字符串列表中的最小值：</p><p>SELECT LEAST("Google", "Runoob", "Apple");&nbsp;&nbsp; -- Apple</p></td></tr><tr><td valign="top" width="129"><p><a href="https://www.runoob.com/mysql/func_mysql_ln.asp">LN</a></p></td><td valign="top" width="281"><p>返回数字的自然对数</p></td><td valign="top" width="348"><p>返回 2 的自然对数：</p><p>SELECT LN(2);&nbsp; -- 0.6931471805599453</p></td></tr><tr><td valign="top" width="129"><p>LOG(x)</p></td><td valign="top" width="281"><p>返回自然对数(以 e 为底的对数)　　</p></td><td valign="top" width="348"><p>SELECT LOG(20.085536923188) -- 3</p></td></tr><tr><td valign="top" width="129"><p>LOG10(x)</p></td><td valign="top" width="281"><p>返回以 10 为底的对数　　</p></td><td valign="top" width="348"><p>SELECT LOG10(100) -- 2</p></td></tr><tr><td valign="top" width="129"><p>LOG2(x)</p></td><td valign="top" width="281"><p>返回以 2 为底的对数</p></td><td valign="top" width="348"><p>返回以 2 为底 6 的对数：</p><p>SELECT LOG2(6);&nbsp; -- 2.584962500721156</p></td></tr><tr><td valign="top" width="129"><p>MAX(expression)</p></td><td valign="top" width="281"><p>返回字段 expression 中的最大值</p></td><td valign="top" width="348"><p>返回数据表 Products 中字段 Price 的最大值：</p><p>SELECT MAX(Price) AS LargestPrice FROM Products;</p></td></tr><tr><td valign="top" width="129"><p>MIN(expression)</p></td><td valign="top" width="281"><p>返回字段 expression 中的最小值</p></td><td valign="top" width="348"><p>返回数据表 Products 中字段 Price 的最小值：</p><p>SELECT MIN(Price) AS LargestPrice FROM Products;</p></td></tr><tr><td valign="top" width="129"><p>MOD(x,y)</p></td><td valign="top" width="281"><p>返回 x 除以 y 以后的余数　</p></td><td valign="top" width="348"><p>5 除于 2 的余数：</p><p>SELECT MOD(5,2) -- 1</p></td></tr><tr><td valign="top" width="129"><p>PI()</p></td><td valign="top" width="281"><p>返回圆周率(3.141593）　　</p></td><td valign="top" width="348"><p>SELECT PI() --3.141593</p></td></tr><tr><td valign="top" width="129"><p>POW(x,y)</p></td><td valign="top" width="281"><p>返回 x 的 y 次方　</p></td><td valign="top" width="348"><p>2 的 3 次方：</p><p>SELECT POW(2,3) -- 8</p></td></tr><tr><td valign="top" width="129"><p>POWER(x,y)</p></td><td valign="top" width="281"><p>返回 x 的 y 次方　</p></td><td valign="top" width="348"><p>2 的 3 次方：</p><p>SELECT POWER(2,3) -- 8</p></td></tr><tr><td valign="top" width="129"><p>RADIANS(x)</p></td><td valign="top" width="281"><p>将角度转换为弧度　　</p></td><td valign="top" width="348"><p>180 度转换为弧度：</p><p>SELECT RADIANS(180) -- 3.1415926535898</p></td></tr><tr><td valign="top" width="129"><p>RAND()</p></td><td valign="top" width="281"><p>返回 0 到 1 的随机数　　</p></td><td valign="top" width="348"><p>SELECT RAND() --0.93099315644334</p></td></tr><tr><td valign="top" width="129"><p>ROUND(x)</p></td><td valign="top" width="281"><p>返回离 x 最近的整数</p></td><td valign="top" width="348"><p>SELECT ROUND(1.23456) --1</p></td></tr><tr><td valign="top" width="129"><p>SIGN(x)</p></td><td valign="top" width="281"><p>返回 x 的符号，x 是负数、0、正数分别返回 -1、0 和 1　</p></td><td valign="top" width="348"><p>SELECT SIGN(-10) -- (-1)</p></td></tr><tr><td valign="top" width="129"><p>SIN(x)</p></td><td valign="top" width="281"><p>求正弦值(参数是弧度)　　</p></td><td valign="top" width="348"><p>SELECT SIN(RADIANS(30)) -- 0.5</p></td></tr><tr><td valign="top" width="129"><p>SQRT(x)</p></td><td valign="top" width="281"><p>返回x的平方根　　</p></td><td valign="top" width="348"><p>25 的平方根：</p><p>SELECT SQRT(25) -- 5</p></td></tr><tr><td valign="top" width="129"><p>SUM(expression)</p></td><td valign="top" width="281"><p>返回指定字段的总和</p></td><td valign="top" width="348"><p>计算 OrderDetails 表中字段 Quantity 的总和：</p><p>SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;</p></td></tr><tr><td valign="top" width="129"><p>TAN(x)</p></td><td valign="top" width="281"><p>求正切值(参数是弧度)</p></td><td valign="top" width="348"><p>SELECT TAN(1.75);&nbsp; -- -5.52037992250933</p></td></tr><tr><td valign="top" width="129"><p>TRUNCATE(x,y)</p></td><td valign="top" width="281"><p>返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入）</p></td><td valign="top" width="348"><p>SELECT TRUNCATE(1.23456,3) -- 1.234</p></td></tr></tbody></table><p>&nbsp;</p><h2>MySQL 日期函数</h2><p>　　</p><p>&nbsp;</p><table style="width: 760px;" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" width="129"><p>函数名</p></td><td valign="top" width="189"><p>描述</p></td><td valign="top" width="442"><p>实例</p></td></tr><tr><td valign="top" width="129"><p>ADDDATE(d,n)</p></td><td valign="top" width="189"><p>计算起始日期 d 加上 n 天的日期</p></td><td valign="top" width="442"><p>SELECT ADDDATE("2017-06-15", INTERVAL 10 DAY);-&gt;2017-06-25</p></td></tr><tr><td valign="top" width="129"><p>ADDTIME(t,n)</p></td><td valign="top" width="189"><p>时间 t 加上 n 秒的时间</p></td><td valign="top" width="442"><p>SELECT ADDTIME('2011-11-11 11:11:11', 5)-&gt;2011-11-11 11:11:16 (秒)</p></td></tr><tr><td valign="top" width="129"><p>CURDATE()</p></td><td valign="top" width="189"><p>返回当前日期</p></td><td valign="top" width="442"><p>SELECT CURDATE();-&gt; 2018-09-19</p></td></tr><tr><td valign="top" width="129"><p>CURRENT_DATE()</p></td><td valign="top" width="189"><p>返回当前日期</p></td><td valign="top" width="442"><p>SELECT CURRENT_DATE();-&gt; 2018-09-19</p></td></tr><tr><td valign="top" width="129"><p>CURRENT_TIME</p></td><td valign="top" width="189"><p>返回当前时间</p></td><td valign="top" width="442"><p>SELECT CURRENT_TIME();-&gt; 19:59:02</p></td></tr><tr><td valign="top" width="129"><p>CURRENT_TIMESTAMP()</p></td><td valign="top" width="189"><p>返回当前日期和时间</p></td><td valign="top" width="442"><p>SELECT CURRENT_TIMESTAMP()-&gt; 2018-09-19 20:57:43</p></td></tr><tr><td valign="top" width="129"><p>CURTIME()</p></td><td valign="top" width="189"><p>返回当前时间</p></td><td valign="top" width="442"><p>SELECT CURTIME();-&gt; 19:59:02</p></td></tr><tr><td valign="top" width="129"><p>DATE()</p></td><td valign="top" width="189"><p>从日期或日期时间表达式中提取日期值</p></td><td valign="top" width="442"><p>SELECT DATE("2017-06-15");&nbsp;&nbsp;&nbsp; -&gt; 2017-06-15</p></td></tr><tr><td valign="top" width="129"><p>DATEDIFF(d1,d2)</p></td><td valign="top" width="189"><p>计算日期 d1-&gt;d2 之间相隔的天数</p></td><td valign="top" width="442"><p>SELECT DATEDIFF('2001-01-01','2001-02-02')-&gt; -32</p></td></tr><tr><td valign="top" width="129"><p>DATE_ADD(d，INTERVAL expr type)</p></td><td valign="top" width="189"><p>计算起始日期 d 加上一个时间段后的日期</p></td><td valign="top" width="442"><p>SELECT ADDDATE('2011-11-11 11:11:11',1)-&gt; 2011-11-12 11:11:11&nbsp;&nbsp;&nbsp;&nbsp;(默认是天)</p><p>SELECT ADDDATE('2011-11-11 11:11:11', INTERVAL 5 MINUTE)-&gt; 2011-11-11 11:16:11 (TYPE的取值与上面那个列出来的函数类似)</p></td></tr><tr><td valign="top" width="129"><p>DATE_FORMAT(d,f)</p></td><td valign="top" width="189"><p>按表达式 f的要求显示日期 d</p></td><td valign="top" width="442"><p>SELECT DATE_FORMAT('2011-11-11 11:11:11','%Y-%m-%d %r')-&gt; 2011-11-11 11:11:11 AM</p></td></tr><tr><td valign="top" width="129"><p>DATE_SUB(date,INTERVAL expr type)</p></td><td valign="top" width="189"><p>函数从日期减去指定的时间间隔。</p></td><td valign="top" width="442"><p>Orders 表中 OrderDate 字段减去 2 天：</p><p>SELECT OrderId,DATE_SUB(OrderDate,INTERVAL 2 DAY) AS OrderPayDate</p><p>FROM Orders</p></td></tr><tr><td valign="top" width="129"><p>DAY(d)</p></td><td valign="top" width="189"><p>返回日期值 d 的日期部分</p></td><td valign="top" width="442"><p>SELECT DAY("2017-06-15");&nbsp; -&gt; 15</p></td></tr><tr><td valign="top" width="129"><p>DAYNAME(d)</p></td><td valign="top" width="189"><p>返回日期 d 是星期几，如 Monday,Tuesday</p></td><td valign="top" width="442"><p>SELECT DAYNAME('2011-11-11 11:11:11')-&gt;Friday</p></td></tr><tr><td valign="top" width="129"><p>DAYOFMONTH(d)</p></td><td valign="top" width="189"><p>计算日期 d 是本月的第几天</p></td><td valign="top" width="442"><p>SELECT DAYOFMONTH('2011-11-11 11:11:11')-&gt;11</p></td></tr><tr><td valign="top" width="129"><p>DAYOFWEEK(d)</p></td><td valign="top" width="189"><p>日期 d 今天是星期几，1 星期日，2 星期一，以此类推</p></td><td valign="top" width="442"><p>SELECT DAYOFWEEK('2011-11-11 11:11:11')-&gt;6</p></td></tr><tr><td valign="top" width="129"><p>DAYOFYEAR(d)</p></td><td valign="top" width="189"><p>计算日期 d 是本年的第几天</p></td><td valign="top" width="442"><p>SELECT DAYOFYEAR('2011-11-11 11:11:11')-&gt;315</p></td></tr><tr><td valign="top" width="129"><p>EXTRACT(type FROM d)</p></td><td valign="top" width="189"><p>从日期 d 中获取指定的值，type 指定返回的值。&nbsp;<br />  type可取值为：&nbsp;MICROSECOND，SECOND，MINUTE，HOUR，DAY，WEEK，MONTH，QUARTER，YEAR，SECOND_MICROSECOND，MINUTE_MICROSECOND，MINUTE_SECOND，HOUR_MICROSECOND，HOUR_SECOND，HOUR_MINUTE，DAY_MICROSECOND，DAY_SECOND，DAY_MINUTE，DAY_HOUR，YEAR_MONTH</p>  </td><td valign="top" width="442"><p>SELECT EXTRACT(MINUTE FROM '2011-11-11  11:11:11') -&gt; 11</p>  </td> </tr><tr><td valign="top" width="129"><p>FROM_DAYS(n)</p>  </td><td valign="top" width="189"><p>计算从 0000 年 1 月 1 日开始 n 天后的日期</p>  </td><td valign="top" width="442"><p>SELECT FROM_DAYS(1111)-&gt; 0003-01-16</p>  </td> </tr><tr><td valign="top" width="129"><p>HOUR(t)</p>  </td><td valign="top" width="189"><p>返回 t 中的小时值</p>  </td><td valign="top" width="442"><p>SELECT HOUR('1:2:3')-&gt; 1</p>  </td> </tr><tr><td valign="top" width="129"><p>LAST_DAY(d)</p>  </td><td valign="top" width="189"><p>返回给给定日期的那一月份的最后一天</p>  </td><td valign="top" width="442"><p>SELECT  LAST_DAY("2017-06-20");-&gt; 2017-06-30</p>  </td> </tr><tr><td valign="top" width="129"><p>LOCALTIME()</p>  </td><td valign="top" width="189"><p>返回当前日期和时间</p>  </td><td valign="top" width="442"><p>SELECT LOCALTIME()-&gt; 2018-09-19  20:57:43</p>  </td> </tr><tr><td valign="top" width="129"><p>LOCALTIMESTAMP()</p>  </td><td valign="top" width="189"><p>返回当前日期和时间</p>  </td><td valign="top" width="442"><p>SELECT LOCALTIMESTAMP()-&gt; 2018-09-19  20:57:43</p>  </td> </tr><tr><td valign="top" width="129"><p>MAKEDATE(year, day-of-year)</p>  </td><td valign="top" width="189"><p>基于给定参数年份 year 和所在年中的天数序号  day-of-year 返回一个日期</p>  </td><td valign="top" width="442"><p>SELECT MAKEDATE(2017, 3);-&gt; 2017-01-03</p>  </td> </tr><tr><td valign="top" width="129"><p>MAKETIME(hour, minute, second)</p>  </td><td valign="top" width="189"><p>组合时间，参数分别为小时、分钟、秒</p>  </td><td valign="top" width="442"><p>SELECT MAKETIME(11, 35, 4);-&gt; 11:35:04</p>  </td> </tr><tr><td valign="top" width="129"><p>MICROSECOND(date)</p>  </td><td valign="top" width="189"><p>返回日期参数所对应的微秒数</p>  </td><td valign="top" width="442"><p>SELECT MICROSECOND("2017-06-20  09:34:00.000023");-&gt; 23</p>  </td> </tr><tr><td valign="top" width="129"><p>MINUTE(t)</p>  </td><td valign="top" width="189"><p>返回 t 中的分钟值</p>  </td><td valign="top" width="442"><p>SELECT MINUTE('1:2:3')-&gt; 2</p>  </td> </tr><tr><td valign="top" width="129"><p>MONTHNAME(d)</p>  </td><td valign="top" width="189"><p>返回日期当中的月份名称，如 Janyary</p>  </td><td valign="top" width="442"><p>SELECT MONTHNAME('2011-11-11  11:11:11')-&gt; November</p>  </td> </tr><tr><td valign="top" width="129"><p>MONTH(d)</p>  </td><td valign="top" width="189"><p>返回日期d中的月份值，1 到 12</p>  </td><td valign="top" width="442"><p>SELECT MONTH('2011-11-11 11:11:11')-&gt;11</p>  </td> </tr><tr><td valign="top" width="129"><p>NOW()</p>  </td><td valign="top" width="189"><p>返回当前日期和时间</p>  </td><td valign="top" width="442"><p>SELECT NOW()-&gt; 2018-09-19 20:57:43</p>  </td> </tr><tr><td valign="top" width="129"><p>PERIOD_ADD(period, number)</p>  </td><td valign="top" width="189"><p>为  年-月  组合日期添加一个时段</p>  </td><td valign="top" width="442"><p>SELECT PERIOD_ADD(201703, 5);&nbsp;&nbsp; -&gt; 201708</p>  </td> </tr><tr><td valign="top" width="129"><p>PERIOD_DIFF(period1, period2)</p>  </td><td valign="top" width="189"><p>返回两个时段之间的月份差值</p>  </td><td valign="top" width="442"><p>SELECT PERIOD_DIFF(201710, 201703);-&gt;  7</p>  </td> </tr><tr><td valign="top" width="129"><p>QUARTER(d)</p>  </td><td valign="top" width="189"><p>返回日期d是第几季节，返回 1 到 4</p>  </td><td valign="top" width="442"><p>SELECT QUARTER('2011-11-11  11:11:11')-&gt; 4</p>  </td> </tr><tr><td valign="top" width="129"><p>SECOND(t)</p>  </td><td valign="top" width="189"><p>返回 t 中的秒钟值</p>  </td><td valign="top" width="442"><p>SELECT SECOND('1:2:3')-&gt; 3</p>  </td> </tr><tr><td valign="top" width="129"><p>SEC_TO_TIME(s)</p>  </td><td valign="top" width="189"><p>将以秒为单位的时间 s 转换为时分秒的格式</p>  </td><td valign="top" width="442"><p>SELECT SEC_TO_TIME(4320)-&gt; 01:12:00</p>  </td> </tr><tr><td valign="top" width="129"><p>STR_TO_DATE(string, format_mask)</p>  </td><td valign="top" width="189"><p>将字符串转变为日期</p>  </td><td valign="top" width="442"><p>SELECT STR_TO_DATE("August 10  2017", "%M %d %Y");-&gt; 2017-08-10</p>  </td> </tr><tr><td valign="top" width="129"><p>SUBDATE(d,n)</p>  </td><td valign="top" width="189"><p>日期 d 减去 n 天后的日期</p>  </td><td valign="top" width="442"><p>SELECT SUBDATE('2011-11-11 11:11:11',  1)-&gt;2011-11-10 11:11:11 (默认是天)</p>  </td> </tr><tr><td valign="top" width="129"><p>SUBTIME(t,n)</p>  </td><td valign="top" width="189"><p>时间 t 减去 n 秒的时间</p>  </td><td valign="top" width="442"><p>SELECT SUBTIME('2011-11-11 11:11:11',  5)-&gt;2011-11-11 11:11:06 (秒)</p>  </td> </tr><tr><td valign="top" width="129"><p>SYSDATE()</p>  </td><td valign="top" width="189"><p>返回当前日期和时间</p>  </td><td valign="top" width="442"><p>SELECT SYSDATE()-&gt; 2018-09-19 20:57:43</p>  </td> </tr><tr><td valign="top" width="129"><p>TIME(expression)</p>  </td><td valign="top" width="189"><p>提取传入表达式的时间部分</p>  </td><td valign="top" width="442"><p>SELECT TIME("19:30:10");-&gt;  19:30:10</p>  </td> </tr><tr><td valign="top" width="129"><p>TIME_FORMAT(t,f)</p>  </td><td valign="top" width="189"><p>按表达式 f 的要求显示时间 t</p>  </td><td valign="top" width="442"><p>SELECT  TIME_FORMAT('11:11:11','%r')11:11:11 AM</p>  </td> </tr><tr><td valign="top" width="129"><p>TIME_TO_SEC(t)</p>  </td><td valign="top" width="189"><p>将时间 t 转换为秒</p>  </td><td valign="top" width="442"><p>SELECT TIME_TO_SEC('1:12:00')-&gt; 4320</p>  </td> </tr><tr><td valign="top" width="129"><p>TIMEDIFF(time1, time2)</p>  </td><td valign="top" width="189"><p>计算时间差值</p>  </td><td valign="top" width="442"><p>SELECT TIMEDIFF("13:10:11",  "13:10:10");-&gt; 00:00:01</p>  </td> </tr><tr><td valign="top" width="129"><p>TIMESTAMP(expression, interval)</p>  </td><td valign="top" width="189"><p>单个参数时，函数返回日期或日期时间表达式；有2个参数时，将参数加和</p>  </td><td valign="top" width="442"><p>SELECT  TIMESTAMP("2017-07-23",&nbsp;  "13:10:11");-&gt; 2017-07-23 13:10:11</p>  </td> </tr><tr><td valign="top" width="129"><p>TO_DAYS(d)</p>  </td><td valign="top" width="189"><p>计算日期 d 距离 0000 年 1 月 1 日的天数</p>  </td><td valign="top" width="442"><p>SELECT TO_DAYS('0001-01-01  01:01:01')-&gt; 366</p>  </td> </tr><tr><td valign="top" width="129"><p>WEEK(d)</p>  </td><td valign="top" width="189"><p>计算日期 d 是本年的第几个星期，范围是 0 到 53</p>  </td><td valign="top" width="442"><p>SELECT WEEK('2011-11-11 11:11:11')-&gt;  45</p>  </td> </tr><tr><td valign="top" width="129"><p>WEEKDAY(d)</p>  </td><td valign="top" width="189"><p>日期 d 是星期几，0 表示星期一，1 表示星期二</p>  </td><td valign="top" width="442"><p>SELECT  WEEKDAY("2017-06-15");-&gt; 3</p>  </td> </tr><tr><td valign="top" width="129"><p>WEEKOFYEAR(d)</p>  </td><td valign="top" width="189"><p>计算日期 d 是本年的第几个星期，范围是 0 到 53</p>  </td><td valign="top" width="442"><p>SELECT WEEKOFYEAR('2011-11-11  11:11:11')-&gt; 45</p>  </td> </tr><tr><td valign="top" width="129"><p>YEAR(d)</p>  </td><td valign="top" width="189"><p>返回年份</p>  </td><td valign="top" width="442"><p>SELECT YEAR("2017-06-15");-&gt;  2017</p>  </td> </tr><tr><td valign="top" width="129"><p>YEARWEEK(date, mode)</p>  </td><td valign="top" width="189"><p>返回年份及第几周（0到53），mode 中 0 表示周天，1表示周一，以此类推</p>  </td><td valign="top" width="442"><p>SELECT  YEARWEEK("2017-06-15");-&gt; 201724</p>  </td> </tr></tbody></table><p>&nbsp;</p><h2>MySQL 高级函数</h2><table style="width: 762px;" border="0" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" width="164"><p>函数名</p></td><td valign="top" width="247"><p>描述</p></td><td valign="top" width="351"><p>实例</p></td></tr><tr><td valign="top" width="164"><p>BIN(x)</p></td><td valign="top" width="247"><p>返回 x 的二进制编码</p></td><td valign="top" width="351"><p>15 的 2 进制编码:SELECT BIN(15); -- 1111</p></td></tr><tr><td valign="top" width="164"><p>BINARY(s)</p></td><td valign="top" width="247"><p>将字符串 s 转换为二进制字符串</p></td><td valign="top" width="351"><p>SELECT BINARY "RUNOOB";-&gt; RUNOOB</p></td></tr><tr><td valign="top" width="164"><p>CASE expression</p><p>&nbsp;&nbsp;&nbsp; WHEN condition1 THEN result1</p><p>&nbsp;&nbsp;&nbsp; WHEN condition2 THEN result2</p><p>&nbsp;&nbsp; ...</p><p>&nbsp;&nbsp;&nbsp; WHEN conditionN THEN resultN</p><p>&nbsp;&nbsp;&nbsp; ELSE resultEND</p></td><td valign="top" width="247"><p>CASE 表示函数开始，END 表示函数结束。如果 condition1 成立，则返回 result1, 如果 condition2 成立，则返回 result2，当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。</p></td><td valign="top" width="351"><p>SELECT CASE</p><p>　　WHEN 1 &gt; 0</p><p>　　THEN '1 &gt; 0'</p><p>　　WHEN 2 &gt; 0</p><p>　　THEN '2 &gt; 0'</p><p>　　ELSE '3 &gt; 0'</p><p>　　END-&gt;1 &gt; 0</p></td></tr><tr><td valign="top" width="164"><p>CAST(x AS type)</p></td><td valign="top" width="247"><p>转换数据类型</p></td><td valign="top" width="351"><p>字符串日期转换为日期：</p><p>SELECT CAST("2017-08-29" AS DATE);-&gt; 2017-08-29</p></td></tr><tr><td valign="top" width="164"><p>COALESCE(expr1, expr2, ...., expr_n)</p></td><td valign="top" width="247"><p>返回参数中的第一个非空表达式（从左向右）</p></td><td valign="top" width="351"><p>SELECT COALESCE(NULL, NULL, NULL, 'runoob.com', NULL, 'google.com');-&gt; runoob.com</p></td></tr><tr><td valign="top" width="164"><p>CONNECTION_ID()</p></td><td valign="top" width="247"><p>返回服务器的连接数</p></td><td valign="top" width="351"><p>SELECT CONNECTION_ID();-&gt; 4292835</p></td></tr><tr><td valign="top" width="164"><p>CONV(x,f1,f2)</p></td><td valign="top" width="247"><p>返回 f1 进制数变成 f2 进制数</p></td><td valign="top" width="351"><p>SELECT CONV(15, 10, 2);-&gt; 1111</p></td></tr><tr><td valign="top" width="164"><p>CONVERT(s USING cs)</p></td><td valign="top" width="247"><p>函数将字符串 s 的字符集变成 cs</p></td><td valign="top" width="351"><p>SELECT CHARSET('ABC')-&gt;utf-8&nbsp;&nbsp;&nbsp;</p><p>SELECT CHARSET(CONVERT('ABC' USING gbk))-&gt;gbk</p></td></tr><tr><td valign="top" width="164"><p>CURRENT_USER()</p></td><td valign="top" width="247"><p>返回当前用户</p></td><td valign="top" width="351"><p>SELECT CURRENT_USER();-&gt; guest@%</p></td></tr><tr><td valign="top" width="164"><p>DATABASE()</p></td><td valign="top" width="247"><p>返回当前数据库名</p></td><td valign="top" width="351"><p>SELECT DATABASE();&nbsp;&nbsp; -&gt; runoob</p></td></tr><tr><td valign="top" width="164"><p>IF(expr,v1,v2)</p></td><td valign="top" width="247"><p>如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。</p></td><td valign="top" width="351"><p>SELECT IF(1 &gt; 0,'正确','错误')&nbsp;&nbsp;&nbsp; -&gt;正确</p></td></tr><tr><td valign="top" width="164"><p><a href="https://www.runoob.com/mysql/mysql-func-ifnull.html" target="https://www.runoob.com/mysql/_blank">IFNULL(v1,v2)</a></p></td><td valign="top" width="247"><p>如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。</p></td><td valign="top" width="351"><p>SELECT IFNULL(null,'Hello Word')-&gt;Hello Word</p></td></tr><tr><td valign="top" width="164"><p>ISNULL(expression)</p></td><td valign="top" width="247"><p>判断表达式是否为 NULL</p></td><td valign="top" width="351"><p>SELECT ISNULL(NULL);-&gt;1</p></td></tr><tr><td valign="top" width="164"><p>LAST_INSERT_ID()</p></td><td valign="top" width="247"><p>返回最近生成的 AUTO_INCREMENT 值</p></td><td valign="top" width="351"><p>SELECT LAST_INSERT_ID();-&gt;6</p></td></tr><tr><td valign="top" width="164"><p>NULLIF(expr1, expr2)</p></td><td valign="top" width="247"><p>比较两个字符串，如果字符串 expr1 与 expr2 相等 返回 NULL，否则返回 expr1</p></td><td valign="top" width="351"><p>SELECT NULLIF(25, 25);-&gt;</p></td></tr><tr><td valign="top" width="164"><p>SESSION_USER()</p></td><td valign="top" width="247"><p>返回当前用户</p></td><td valign="top" width="351"><p>SELECT SESSION_USER();-&gt; guest@%</p></td></tr><tr><td valign="top" width="164"><p>SYSTEM_USER()</p></td><td valign="top" width="247"><p>返回当前用户</p></td><td valign="top" width="351"><p>SELECT SYSTEM_USER();-&gt; guest@%</p></td></tr><tr><td valign="top" width="164"><p>USER()</p></td><td valign="top" width="247"><p>返回当前用户</p></td><td valign="top" width="351"><p>SELECT USER();-&gt; guest@%</p></td></tr><tr><td valign="top" width="164"><p>VERSION()</p></td><td valign="top" width="247"><p>返回数据库的版本号</p></td><td valign="top" width="351"><p>SELECT VERSION()-&gt; 5.6.34</p></td></tr></tbody></table><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225028818-1856471585.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225036465-1783768946.png" alt="" /><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225049259-1250227268.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225056947-440385371.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225103363-452303700.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225107866-441083589.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225114471-840735920.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225120882-353921749.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>日志管理：</p><p>错误日志</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225137673-719220299.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>查询日志</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225146763-845502931.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>慢日志</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225157773-1388150422.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>数据库备份:只有数据表</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921225213177-224479092.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>恢复：建库，使用，source xxxxx</p><p>备份数据 加参数</p><p>......-p -B student</p><p>恢复： 不用建库</p><p>xxxx -p&nbsp; &lt; e:\.....</p><p>或使用source</p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/mybatisplus/"/>
    <url>/2022/01/16/cnblog/mybatisplus/</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul><li>简化开发，省略crud代码</li><li>类似jpa，tk-mapper，</li><li>在mybatis增强</li></ul><h1 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h1><ul><li>无侵入，损耗小，强大CRUD操作，Lambda，主键生成，全局拦截插件，性能分析插件，分页插件，内置代码生成器，自定义全局通用操作，ActiveRecord</li></ul><h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><p>建表，依赖，配置，连数据库，代码，</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129111233259.png" alt="image-20210129111233259"></p><figure class="highlight xml"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifictId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifictId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129112059573.png" alt="image-20210129112059573"></p><p>传统的方式：pojo-dao-service-controller</p><p>信方式：pojo，mapper接口，使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 主启动类可能需要扫描@MapperScan(&quot;xx.xx.mapper&quot;)</span><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseMapper</span>&lt;<span class="hljs-title">User</span>&gt;</span>&#123;<br>    <span class="hljs-comment">// 已经编写完成，不需要配置文件</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Autowired UserMapper userMapper;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;<br>List&lt;User&gt; list = userMapper.selectList(<span class="hljs-keyword">null</span>);<span class="hljs-comment">// 全部用户</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="配置日志"><a href="#配置日志" class="headerlink" title="配置日志"></a>配置日志</h1><p>现在sql不可见，日志可以看到</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">mybatis-plus<span class="hljs-selector-class">.configuration</span>.log-impl=org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ibatis</span><span class="hljs-selector-class">.logging</span>.StdOutImpl<br></code></pre></td></tr></table></figure><h1 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h1><h2 id="用户ID会自动插入：全局的唯一id"><a href="#用户ID会自动插入：全局的唯一id" class="headerlink" title="用户ID会自动插入：全局的唯一id"></a>用户ID会自动插入：全局的唯一id</h2><h3 id="主键生成策略"><a href="#主键生成策略" class="headerlink" title="主键生成策略"></a>主键生成策略</h3><p>uuid，redis生成，雪花算法等等都是用来生成唯一id的</p><p>重点：雪花算法，生成long型，分布式唯一id生成</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129134706999.png" alt="image-20210129134706999"></p><h3 id="主键自增"><a href="#主键自增" class="headerlink" title="主键自增"></a>主键自增</h3><p>1，实体类子段@TableId(type=IdType.AUTO) 主键</p><p>​    IdType.AUTO，NONE,INPUT,ID_WORKER,UUID,ID_WORKER_STR</p><p>2，数据库子段自增</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">userMapper.insert(User);<br></code></pre></td></tr></table></figure><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">userMapper.updateById(user);<br></code></pre></td></tr></table></figure><h2 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a>自动填充</h2><ul><li><p>数据库级别，</p><ul><li>create_time,</li><li>update_time,自动更新，current_timestmp</li><li>不推荐使用</li></ul></li><li><p>代码级别</p><ul><li><p>@TbaleField(fill=FieldFill.INSERT) 自动填充内容</p></li><li><p>@TbaleField(fill=FieldFill.INSERT_UPDATE) 自动更新</p></li><li><p>编写处理器</p><ul><li>```java<br>// 通过反射的原理，识别操作，对对象进行修改<br>@Slf4j<br>@Component<br>public class MyMetaObjectHandler implements MetaObjectHandler {<div class="code-wrapper"><pre><code class="hljs">@Overridepublic void insertFill(MetaObject metaObject) &#123;    log.info(&quot;insert 创建时间&quot;);    this.setFieldValByName(&quot;createTime&quot;,new Date(),metaObject);     this.setFieldValByName(&quot;updateTime&quot;,new Date(),metaObject);&#125;@Overridepublic void updateFill(MetaObject metaObject) &#123;    log.info(&quot;update update时间&quot;);    this.setFieldValByName(&quot;updateTime&quot;,new Date(),metaObject);&#125;</code></pre></div>}<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs less"><br>      <br><br>## 乐观锁，悲观锁<br><br>乐观锁，操作不加锁，操作是否执行由代码配合数据版本号实现，<br><br>!<span class="hljs-selector-attr">[image-20210129142208175]</span>(<span class="hljs-attribute">https</span>:<span class="hljs-comment">//cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129142208175.png)</span><br><br>- 数据库添加version子段，并设置默认值<br><br>- 实体类添加字段 <span class="hljs-variable">@Version</span>注解<br><br>- 注册组件<br><br>  - <span class="hljs-built_in">``</span>`java<br>    <span class="hljs-variable">@Configuration</span><br>    public class MybatisPlusConfig &#123;<br>        <span class="hljs-comment">// 乐观锁插件</span><br>        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">OptimisticLockerInterceptor</span> <span class="hljs-selector-tag">optimisticLockerInterceptor</span>()&#123;<br>            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">OptimisticLockerInterceptor</span>();<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h2 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">map.put(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;xxx&quot;</span>)<br>userMapper.selectByMap(map);<br></code></pre></td></tr></table></figure><h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h2><ul><li>limit</li><li>pageHelper</li><li>mybatisplus</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">// 配置,还使用limit使用的</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> PaginationInterceptor <span class="hljs-title">paginationInterceptor</span><span class="hljs-params">()</span></span>&#123;<br>    PaginationInterceptor paginationInterceptor = <span class="hljs-keyword">new</span> PaginationInterceptor();<br>    <span class="hljs-comment">//paginationInterceptor.setDialectClazz();</span><br>    <span class="hljs-keyword">return</span> paginationInterceptor;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Page&lt;User&gt; page = <span class="hljs-keyword">new</span> Page&lt;User&gt;(<span class="hljs-number">2</span>,<span class="hljs-number">5</span>)<br>userMapper.selectPage(page,<span class="hljs-keyword">null</span>); <span class="hljs-comment">// 每页5个第二页</span><br>page.getRecords()<br>page.total()    <br></code></pre></td></tr></table></figure><h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><ul><li><p>与查询类似</p></li><li><p>逻辑删除：数据库中没有被移出</p><ul><li><p>数据库增加字段deleted</p></li><li><p>pojo增加字段，@TableLogic</p></li><li><p>配置</p><ul><li>```java<br>@Bean<br>public ISqlInjector sqlInjector(){<div class="code-wrapper"><pre><code class="hljs">return new LogicSqlInjector();</code></pre></div>}<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><br>- ```properties<br>  mybatis-plus.global-config.db-config.logic-<span class="hljs-keyword">delete</span>-value=<span class="hljs-number">1</span><br>  mybatis-plus.global-config.db-config.logic-<span class="hljs-keyword">not</span>-<span class="hljs-keyword">delete</span>-value=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p>此时删除操作其实底层是更新操作，数据库记录没有删除，若此时正常条件下查询该记录，是查不到的</p></li></ul></li></ul><h1 id="性能分析插件"><a href="#性能分析插件" class="headerlink" title="性能分析插件"></a>性能分析插件</h1><p>有些sql太慢，超时停止，分析sql</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-meta">@Profile(&#123;&quot;dev&quot;,&quot;test&quot;&#125;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> PerformanceInterceptor <span class="hljs-title">performanceInterceptor</span><span class="hljs-params">()</span></span>&#123;<br>    PerformanceInterceptor performanceInterceptor = <span class="hljs-keyword">new</span> PerformanceInterceptor();<br>    performanceInterceptor.setMaxTime(<span class="hljs-number">1</span>);<br>    performanceInterceptor.setFormat(<span class="hljs-keyword">true</span>);<br>    <span class="hljs-keyword">return</span> performanceInterceptor;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="条件构造器"><a href="#条件构造器" class="headerlink" title="条件构造器"></a>条件构造器</h1><p>复杂的SQL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">QueryWrapper&lt;User&gt; wrapper = <span class="hljs-keyword">new</span> QueryWrapper();<br>wrapper.isNotNull(<span class="hljs-string">&quot;name&quot;</span>).isNotNull(<span class="hljs-string">&quot;email&quot;</span>).ge(<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;12&quot;</span>);<br>userMapper.selectList(wrapper);<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">wrapper</span>.inSql(&quot;id&quot;,&quot;select id from user where id&lt;3&quot;)<br>userMapper.selectObjs(<span class="hljs-keyword">wrapper</span>)<br></code></pre></td></tr></table></figure><h1 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//构建一个代码生成器对象</span><br>AutoGenerator mpg = <span class="hljs-keyword">new</span> AutoGenerator();<br><span class="hljs-comment">// 全局配置</span><br>GlobalConfig gc = <span class="hljs-keyword">new</span> GlobalConfig();<br>String dir = System.getProperty(<span class="hljs-string">&quot;user.dir&quot;</span>);<br><span class="hljs-comment">// 输出路径</span><br>gc.setOutputDir(dir+<span class="hljs-string">&quot;/src/main/java&quot;</span>);<br>gc.setAuthor(<span class="hljs-string">&quot;dean&quot;</span>);<br>gc.setOpen(<span class="hljs-keyword">false</span>);<br>gc.setFileOverride(<span class="hljs-keyword">false</span>);<span class="hljs-comment">// 是否覆盖</span><br>gc.setServiceName(<span class="hljs-string">&quot;%sService&quot;</span>);<br>gc.setIdType(IdType.ID_WORKER);<br>gc.setDateType(DateType.ONLY_DATE);<br>gc.setSwagger2(<span class="hljs-keyword">true</span>);<br><br><span class="hljs-comment">// 数据源配置</span><br>DataSourceConfig dataSourceConfig = <span class="hljs-keyword">new</span> DataSourceConfig();<br>dataSourceConfig.setUrl();<br>dataSourceConfig.setUsername();<br>dataSourceConfig.setPassword();<br>dataSourceConfig.setDriverName();<br>dataSourceConfig.setDbType(DbType.MYSQL);<br><br><span class="hljs-comment">// 包配置</span><br>PackageConfig pc = <span class="hljs-keyword">new</span> PackageConfig();<br>pc.setModuleName(<span class="hljs-string">&quot;blog&quot;</span>);<br>pc.setParent(<span class="hljs-string">&quot;top.dean&quot;</span>);<br>pc.setEntity(<span class="hljs-string">&quot;entity&quot;</span>);<br>pc.setMapper(<span class="hljs-string">&quot;mapper&quot;</span>);<br>pc.setService(<span class="hljs-string">&quot;service&quot;</span>);<br>pc.setController(<span class="hljs-string">&quot;controller&quot;</span>);<br><br><span class="hljs-comment">//策略配置</span><br>StrategyConfig strategyConfig = <span class="hljs-keyword">new</span> StrategyConfig();<br>strategyConfig.setInclude(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;role&quot;</span>);<br>strategyConfig.setNaming(NamingStrategy.underline_to_camel);<br>strategyConfig.setColumnNaming(NamingStrategy.underline_to_camel);<br>strategyConfig.setSuperEntityClass(<span class="hljs-string">&quot;父类，没有就不设置&quot;</span>);<br>strategyConfig.setEntityLombokModel(<span class="hljs-keyword">true</span>);<br>strategyConfig.setRestControllerStyle(<span class="hljs-keyword">true</span>);<br>strategyConfig.setLogicDeleteFieldName(<span class="hljs-string">&quot;deleted&quot;</span>);<span class="hljs-comment">// 逻辑删除子段</span><br><br><span class="hljs-comment">// 自动填充</span><br>TableFill gmtCreate = <span class="hljs-keyword">new</span> TableFill(<span class="hljs-string">&quot;gmt_create&quot;</span>, FieldFill.INSERT);<br>TableFill gmtModified = <span class="hljs-keyword">new</span> TableFill(<span class="hljs-string">&quot;gmt_create&quot;</span>, FieldFill.INSERT_UPDATE);<br>ArrayList&lt;TableFill&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>list.add(gmtCreate);<br>list.add(gmtModified);<br>strategyConfig.setTableFillList(list);<br><span class="hljs-comment">// 乐观锁</span><br>strategyConfig.setVersionFieldName(<span class="hljs-string">&quot;version&quot;</span>);<br>strategyConfig.setControllerMappingHyphenStyle(<span class="hljs-keyword">true</span>);<br><br>mpg.setStrategy(strategyConfig);<br>mpg.setPackageInfo(pc);<br>mpg.setDataSource(dataSourceConfig);<br>mpg.setGlobalConfig(gc);<br><br>mpg.execute();<br></code></pre></td></tr></table></figure><p>参考：<a href="https://gitee.com/kuangstudy/openclass">https://gitee.com/kuangstudy/openclass</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/MQ%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    <url>/2022/01/16/cnblog/MQ%E4%B8%AD%E9%97%B4%E4%BB%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="1-为什么使用消息队列？消息队列的优点和缺点？kafka、activemq、rabbitmq、rocketmq都有什么优缺点？"><a href="#1-为什么使用消息队列？消息队列的优点和缺点？kafka、activemq、rabbitmq、rocketmq都有什么优缺点？" class="headerlink" title="1. 为什么使用消息队列？消息队列的优点和缺点？kafka、activemq、rabbitmq、rocketmq都有什么优缺点？"></a>1. 为什么使用消息队列？消息队列的优点和缺点？kafka、activemq、rabbitmq、rocketmq都有什么优缺点？</h1><p>面试官角度分析：</p><p>（1）你知不知道你们系统里为什么要用消息队列这个东西？</p><p>（2）既然用了消息队列这个东西，你知不知道用了有什么好处？</p><p>（3）既然你用了MQ，那么当时为什么选用这一款MQ？</p><h2 id="1-为什么使用消息队列？"><a href="#1-为什么使用消息队列？" class="headerlink" title="1. 为什么使用消息队列？"></a><strong>1. 为什么使用消息队列？</strong></h2><p>面试官问这个问题的期望之一的回答是，你们公司有什么业务场景，这个业务场景有什么技术挑战，如果不用MQ可能会很麻烦，但是再用了之后带来了很多好处。</p><p>消息队列的常见使用场景有很多但是核心的有三个：解耦、异步、削峰</p><p>解耦：</p><p>场景描述：A系统发送个数据到BCD三个系统，接口调用发送，那如果E系统也要这个数据呢？那如果C系统现在不需要了呢？现在A系统又要发送第二种数据了呢？A系统负责人崩溃中…再来点崩溃的事儿，A系统要时时刻刻考虑BCDE四个系统如果挂了怎么办？那我要不要重发？我要不要把消息存起来？头发都白了啊…</p><p><img src="https://img-blog.csdnimg.cn/20181219211928881.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p> 使用了MQ之后的解耦场景</p><p><img src="https://img-blog.csdnimg.cn/20181219213224587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>面试技巧：你需要考虑下，你负责的系统中是否有类似的场景，就是一个系统或者一个模块，调用了多个系统或者模块，相互之间的调用很复杂，维护起来很麻烦。但是其实这个调用是不需要直接同步调用接口的，如果MQ给他异步化解耦也是可以的，你就需要去考虑在你的项目里是不是可以运用这个MQ去进行系统解耦 。</p><p>异步</p><p>场景描述：系统A接受一个请求，需要在自己本地写库，还需要在系统BCD三个系统写库，自己本地写库需要3ms。BCD分别需要300ms、450ms、200ms。最终总好时长：953ms，接近1s。给用户的体验感觉一点也不好。</p><p>不用MQ的同步高延时请求场景</p><p><img src="https://img-blog.csdnimg.cn/20181219215105869.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p> 使用MQ异步化之后的接口性能优化</p><p><img src="https://img-blog.csdnimg.cn/20181219220508633.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>削峰：</p><p>场景描述：每天 0 点到 11 点，系统A风平浪静，每秒并发请求数量就 100 个。结果每一一到11点到1点，每秒并发请求数量就会暴增大1万条 。但是系统最大的处理能力就只能每秒钟处理1000个请求。</p><p>没有用MQ的时候高峰期系统被打死的场景</p><p><img src="https://img-blog.csdnimg.cn/20181219221848962.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>使用MQ来进行削峰的场景</p><p><img src="https://img-blog.csdnimg.cn/20181219223256752.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><h1 id="2-消息队列的有点和缺点？"><a href="#2-消息队列的有点和缺点？" class="headerlink" title="2. 消息队列的有点和缺点？"></a><strong>2. 消息队列的有点和缺点？</strong></h1><p>优点：特殊场景下解耦、异步、削峰。</p><p>缺点：</p><p>系统可用性降低：系统引入的外部依赖越多，越容易挂掉，本来你就是A系统调用BCD三个系统的接口就好了，人ABCD四个系统好好的没什么问题，你偏加个MQ进来，万一MQ挂了怎么办，整套系统崩溃了，就完蛋了</p><p>系统复杂性提高：硬生生加个MQ进来，你怎么保证消息没有重复消费？怎么处理消息丢失的情况？怎么保证消息传递的顺序性？</p><p>一致性问题：系统A处理完了直接返回成功了，人家都认为你这个请求成功了；但问题是，要是BCD三个系统哪里BD系统成功了，结果C系统写库失败了，咋整？数据就不一致了，</p><p><img src="https://img-blog.csdnimg.cn/20181219225558334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>所以消息队列是一种非常复杂的架构，引入它有很多好处，但是也得针对他带来的坏处做各种额外的技术方案和架构来规避掉。做好之后你会发现系统复杂度提升了一个数量积，但是关键时刻，用，还是要用的。</p><h1 id="3-kafka、activemq、rabbitmq、rocketmq都有什么优缺点？"><a href="#3-kafka、activemq、rabbitmq、rocketmq都有什么优缺点？" class="headerlink" title="3. kafka、activemq、rabbitmq、rocketmq都有什么优缺点？"></a><strong>3. kafka、activemq、rabbitmq、rocketmq都有什么优缺点？</strong></h1><table><thead><tr><th>特性</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th><th>Kafka</th></tr></thead><tbody><tr><td>单机吞吐量</td><td>万级，吞吐量比RocketMQ和Kafka要低了一个数量级</td><td>万级，吞吐量比RocketMQ和Kafka要低了一个数量级</td><td>10万级，RocketMQ也是可以支撑高吞吐的一种MQ</td><td>10万级别，这是kafka最大的优点，就是吞吐量高。 一般配合大数据类的系统来进行实时数据计算、日志采集等场景</td></tr><tr><td>topic数量对吞吐量的影响</td><td></td><td></td><td>topic可以达到几百，几千个的级别，吞吐量会有较小幅度的下降 这是RocketMQ的一大优势，在同等机器下，可以支撑大量的topic</td><td>topic从几十个到几百个的时候，吞吐量会大幅度下降 所以在同等机器下，kafka尽量保证topic数量不要过多。如果要支撑大规模topic，需要增加更多的机器资源</td></tr><tr><td>时效性</td><td>ms级</td><td>微秒级，这是rabbitmq的一大特点，延迟是最低的</td><td>ms级</td><td>延迟在ms级以内</td></tr><tr><td>可用性</td><td>高，基于主从架构实现高可用性</td><td>高，基于主从架构实现高可用性</td><td>非常高，分布式架构</td><td>非常高，kafka是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用</td></tr><tr><td>消息可靠性</td><td>有较低的概率丢失数据</td><td></td><td>经过参数优化配置，可以做到0丢失</td><td>经过参数优化配置，消息可以做到0丢失</td></tr><tr><td>功能支持</td><td>MQ领域的功能极其完备</td><td>基于erlang开发，所以并发能力很强，性能极其好，延时很低</td><td>MQ功能较为完善，还是分布式的，扩展性好</td><td>功能较为简单，主要支持简单的MQ功能，在大数据领域的实时计算以及日志采集被大规模使用，是事实上的标准</td></tr><tr><td>优劣势总结</td><td>非常成熟，功能强大，在业内大量的公司以及项目中都有应用 偶尔会有较低概率丢失消息 而且现在社区以及国内应用都越来越少，官方社区现在对ActiveMQ 5.x维护越来越少，几个月才发布一个版本 而且确实主要是基于解耦和异步来用的，较少在大规模吞吐的场景中使用</td><td>erlang语言开发，性能极其好，延时很低； 吞吐量到万级，MQ功能比较完备 而且开源提供的管理界面非常棒，用起来很好用 社区相对比较活跃，几乎每个月都发布几个版本分 在国内一些互联网公司近几年用rabbitmq也比较多一些 但是问题也是显而易见的，RabbitMQ确实吞吐量会低一些，这是因为他做的实现机制比较重。 而且erlang开发，国内有几个公司有实力做erlang源码级别的研究和定制？如果说你没这个实力的话，确实偶尔会有一些问题，你很难去看懂源码，你公司对这个东西的掌控很弱，基本职能依赖于开源社区的快速维护和修复bug。 而且rabbitmq集群动态扩展会很麻烦，不过这个我觉得还好。其实主要是erlang语言本身带来的问题。很难读源码，很难定制和掌控。</td><td>接口简单易用，而且毕竟在阿里大规模应用过，有阿里品牌保障 日处理消息上百亿之多，可以做到大规模吞吐，性能也非常好，分布式扩展也很方便，社区维护还可以，可靠性和可用性都是ok的，还可以支撑大规模的topic数量，支持复杂MQ业务场景 而且一个很大的优势在于，阿里出品都是java系的，我们可以自己阅读源码，定制自己公司的MQ，可以掌控 社区活跃度相对较为一般，不过也还可以，文档相对来说简单一些，然后接口这块不是按照标准JMS规范走的有些系统要迁移需要修改大量代码 还有就是阿里出台的技术，你得做好这个技术万一被抛弃，社区黄掉的风险，那如果你们公司有技术实力我觉得用RocketMQ挺好的</td><td>kafka的特点其实很明显，就是仅仅提供较少的核心功能，但是提供超高的吞吐量，ms级的延迟，极高的可用性以及可靠性，而且分布式可以任意扩展 同时kafka最好是支撑较少的topic数量即可，保证其超高吞吐量 而且kafka唯一的一点劣势是有可能消息重复消费，那么对数据准确性会造成极其轻微的影响，在大数据领域中以及日志采集中，这点轻微影响可以忽略 这个特性天然适合大数据实时计算以及日志收集</td></tr></tbody></table><h2 id="1-引入消息队列之后如何保证其高可用性"><a href="#1-引入消息队列之后如何保证其高可用性" class="headerlink" title="1.引入消息队列之后如何保证其高可用性?"></a>1.引入消息队列之后如何保证其高可用性?</h2><p>（1）RabbitMQ的高可用性</p><p>RabbitMQ是比较有代表性的，因为是基于主从做高可用性的，我们就以他为例子讲解第一种MQ的高可用性怎么实现。</p><p>rabbitmq有三种模式：单机模式，普通集群模式，镜像集群模式</p><p>（1.1） 单机模式</p><p>就是demo级别的，一般就是你本地启动了玩玩儿的，没人生产用单机模式</p><p>（1.2）普通集群模式</p><p>意思就是在多台机器上启动多个rabbitmq实例，每个机器启动一个。但是你创建的queue，只会放在一个rabbtimq实例上，但是每个实例都同步queue的元数据。完了你消费的时候，实际上如果连接到了另外一个实例，那么那个实例会从queue所在实例上拉取数据过来。</p><p>这种方式确实很麻烦，也不怎么好，没做到所谓的分布式，就是个普通集群。因为这导致你要么消费者每次随机连接一个实例然后拉取数据，要么固定连接那个queue所在实例消费数据，前者有数据拉取的开销，后者导致单实例性能瓶颈。</p><p>而且如果那个放queue的实例宕机了，会导致接下来其他实例就无法从那个实例拉取，如果你开启了消息持久化，让rabbitmq落地存储消息的话，消息不一定会丢，得等这个实例恢复了，然后才可以继续从这个queue拉取数据。</p><p>所以这个事儿就比较尴尬了，这就没有什么所谓的高可用性可言了，这方案主要是提高吞吐量的，就是说让集群中多个节点来服务某个queue的读写操作。</p><p><img src="https://img-blog.csdnimg.cn/20181219234244474.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p> （1.3）镜像集群模式</p><p>这种模式，才是所谓的rabbitmq的高可用模式，跟普通集群模式不一样的是，你创建的queue，无论元数据还是queue里的消息都会存在于多个实例上，然后每次你写消息到queue的时候，都会自动把消息到多个实例的queue里进行消息同步。</p><p>这样的话，好处在于，你任何一个机器宕机了，没事儿，别的机器都可以用。坏处在于，第一，这个性能开销也太大了吧，消息同步所有机器，导致网络带宽压力和消耗很重！第二，这么玩儿，就没有扩展性可言了，如果某个queue负载很重，你加机器，新增的机器也包含了这个queue的所有数据，并没有办法线性扩展你的queue</p><p>那么怎么开启这个镜像集群模式呢？我这里简单说一下，避免面试人家问你你不知道，其实很简单rabbitmq有很好的管理控制台，就是在后台新增一个策略，这个策略是镜像集群模式的策略，指定的时候可以要求数据同步到所有节点的，也可以要求就同步到指定数量的节点，然后你再次创建queue的时候，应用这个策略，就会自动将数据同步到其他的节点上去了。</p><p><img src="https://img-blog.csdnimg.cn/20181219235404197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>（2）kafka的高可用性</p><p>kafka一个最基本的架构认识：多个broker组成，每个broker是一个节点；你创建一个topic，这个topic可以划分为多个partition，每个partition可以存在于不同的broker上，每个partition就放一部分数据。</p><p>这就是天然的分布式消息队列，就是说一个topic的数据，是分散放在多个机器上的，每个机器就放一部分数据。</p><p>实际上rabbitmq之类的，并不是分布式消息队列，他就是传统的消息队列，只不过提供了一些集群、HA的机制而已，因为无论怎么玩儿，rabbitmq一个queue的数据都是放在一个节点里的，镜像集群下，也是每个节点都放这个queue的完整数据。</p><p>kafka 0.8以前，是没有HA机制的，就是任何一个broker宕机了，那个broker上的partition就废了，没法写也没法读，没有什么高可用性可言。</p><p>kafka 0.8以后，提供了HA机制，就是replica副本机制。每个partition的数据都会同步到吉他机器上，形成自己的多个replica副本。然后所有replica会选举一个leader出来，那么生产和消费都跟这个leader打交道，然后其他replica就是follower。写的时候，leader会负责把数据同步到所有follower上去，读的时候就直接读leader上数据即可。只能读写leader？很简单，要是你可以随意读写每个follower，那么就要care数据一致性的问题，系统复杂度太高，很容易出问题。kafka会均匀的将一个partition的所有replica分布在不同的机器上，这样才可以提高容错性。</p><p>这么搞，就有所谓的高可用性了，因为如果某个broker宕机了，没事儿，那个broker上面的partition在其他机器上都有副本的，如果这上面有某个partition的leader，那么此时会重新选举一个新的leader出来，大家继续读写那个新的leader即可。这就有所谓的高可用性了。</p><p>写数据的时候，生产者就写leader，然后leader将数据落地写本地磁盘，接着其他follower自己主动从leader来pull数据。一旦所有follower同步好数据了，就会发送ack给leader，leader收到所有follower的ack之后，就会返回写成功的消息给生产者。（当然，这只是其中一种模式，还可以适当调整这个行为）</p><p>消费的时候，只会从leader去读，但是只有一个消息已经被所有follower都同步成功返回ack的时候，这个消息才会被消费者读到。</p><p>实际上这块机制，讲深了，是可以非常之深入的，但是我还是回到我们这个课程的主题和定位，聚焦面试，至少你听到这里大致明白了kafka是如何保证高可用机制的了，对吧？不至于一无所知，现场还能给面试官画画图。要遇上面试官确实是kafka高手，深挖了问，那你只能说不好意思，太深入的你没研究过。</p><p>但是大家一定要明白，这个事情是要权衡的，你现在是要快速突击常见面试题体系，而不是要深入学习kafka，要深入学习kafka，你是没那么多时间的。你只能确保，你之前也许压根儿不知道这块，但是现在你知道了，面试被问到，你大概可以说一说。然后很多其他的候选人，也许还不如你，没看过这个，被问到了压根儿答不出来，相比之下，你还能说点出来，大概就是这个意思了。</p><p><img src="https://img-blog.csdnimg.cn/2018122000301386.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="2-如何保证消息不被重复消费（如何保证消息消费时的幂等性）？"><a href="#2-如何保证消息不被重复消费（如何保证消息消费时的幂等性）？" class="headerlink" title="2.如何保证消息不被重复消费（如何保证消息消费时的幂等性）？"></a>2.如何保证消息不被重复消费（如何保证消息消费时的幂等性）？</h2><p>其实这个很常见的一个问题，这俩问题基本可以连起来问。既然是消费消息，那肯定要考虑考虑会不会重复消费？能不能避免重复消费？或者重复消费了也别造成系统异常可以吗？这个是MQ领域的基本问题，其实本质上还是问你使用消息队列如何保证幂等性，这个是你架构里要考虑的一个问题。</p><p>首先就是比如rabbitmq、rocketmq、kafka，都有可能会出现消费重复消费的问题，正常。因为这问题通常不是mq自己保证的，是给你保证的。然后我们挑一个kafka来举个例子，说说怎么重复消费吧。</p><p>kafka实际上有个offset的概念，就是每个消息写进去，都有一个offset，代表他的序号，然后consumer消费了数据之后，每隔一段时间，会把自己消费过的消息的offset提交一下，代表我已经消费过了，下次我要是重启啥的，你就让我继续从上次消费到的offset来继续消费吧。</p><p>但是凡事总有意外，比如我们之前生产经常遇到的，就是你有时候重启系统，看你怎么重启了，如果碰到点着急的，直接kill进程了，再重启。这会导致consumer有些消息处理了，但是没来得及提交offset，尴尬了。重启之后，少数消息会再次消费一次。</p><p>其实重复消费不可怕，可怕的是你没考虑到重复消费之后，怎么保证幂等性。</p><p>给你举个例子吧。假设你有个系统，消费一条往数据库里插入一条，要是你一个消息重复两次，你不就插入了两条，这数据不就错了？但是你要是消费到第二次的时候，自己判断一下已经消费过了，直接扔了，不就保留了一条数据？</p><p>一条数据重复出现两次，数据库里就只有一条数据，这就保证了系统的幂等性</p><p>幂等性，我通俗点说，就一个数据，或者一个请求，给你重复来多次，你得确保对应的数据是不会改变的，不能出错。</p><p>那所以第二个问题来了，怎么保证消息队列消费的幂等性？</p><p>其实还是得结合业务来思考，我这里给几个思路：</p><p>（1）比如你拿个数据要写库，你先根据主键查一下，如果这数据都有了，你就别插入了，update一下好吧</p><p>（2）比如你是写redis，那没问题了，反正每次都是set，天然幂等性</p><p>（3）比如你不是上面两个场景，那做的稍微复杂一点，你需要让生产者发送每条数据的时候，里面加一个全局唯一的id，类似订单id之类的东西，然后你这里消费到了之后，先根据这个id去比如redis里查一下，之前消费过吗？如果没有消费过，你就处理，然后这个id写redis。如果消费过了，那你就别处理了，保证别重复处理相同的消息即可。</p><p>还有比如基于数据库的唯一键来保证重复数据不会重复插入多条，我们之前线上系统就有这个问题，就是拿到数据的时候，每次重启可能会有重复，因为kafka消费者还没来得及提交offset，重复数据拿到了以后我们插入的时候，因为有唯一键约束了，所以重复数据只会插入报错，不会导致数据库中出现脏数据</p><p>如何保证MQ的消费是幂等性的，需要结合具体的业务来看</p><p><img src="https://img-blog.csdnimg.cn/20181220222316138.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>如何保证消息的幂等性</p><p><img src="https://img-blog.csdnimg.cn/2018122022412331.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="3-如何保证消息的可靠传输（如何处理消息丢失的问题）？"><a href="#3-如何保证消息的可靠传输（如何处理消息丢失的问题）？" class="headerlink" title="3.如何保证消息的可靠传输（如何处理消息丢失的问题）？"></a>3.如何保证消息的可靠传输（如何处理消息丢失的问题）？</h2><p>这个是肯定的，用mq有个基本原则，就是数据不能多一条，也不能少一条，不能多，就是刚才说的重复消费和幂等性问题。不能少，就是说这数据别搞丢了。那这个问题你必须得考虑一下。</p><p>如果说你这个是用mq来传递非常核心的消息，比如说计费，扣费的一些消息，因为我以前设计和研发过一个公司非常核心的广告平台，计费系统，计费系统是很重的一个业务，操作是很耗时的。所以说广告系统整体的架构里面，实际上是将计费做成异步化的，然后中间就是加了一个MQ。</p><p>我们当时为了确保说这个MQ传递过程中绝对不会把计费消息给弄丢，花了很多的精力。广告主投放了一个广告，明明说好了，用户点击一次扣费1块钱。结果要是用户动不动点击了一次，扣费的时候搞的消息丢了，我们公司就会不断的少几块钱，几块钱，积少成多，这个就对公司是一个很大的损失。</p><p>面试题剖析</p><p>这个丢数据，mq一般分为两种，要么是mq自己弄丢了，要么是我们消费的时候弄丢了。咱们从rabbitmq和kafka分别来分析一下</p><p>rabbitmq这种mq，一般来说都是承载公司的核心业务的，数据是绝对不能弄丢的</p><p>RabbitMQ可能存在的数据丢失问题</p><p>（1）rabbitmq</p><p>1）生产者弄丢了数据</p><p>生产者将数据发送到rabbitmq的时候，可能数据就在半路给搞丢了，因为网络啥的问题，都有可能。</p><p>此时可以选择用rabbitmq提供的事务功能，就是生产者发送数据之前开启rabbitmq事务（channel.txSelect），然后发送消息，如果消息没有成功被rabbitmq接收到，那么生产者会收到异常报错，此时就可以回滚事务（channel.txRollback），然后重试发送消息；如果收到了消息，那么可以提交事务（channel.txCommit）。但是问题是，rabbitmq事务机制一搞，基本上吞吐量会下来，因为太耗性能。</p><p>所以一般来说，如果你要确保说写rabbitmq的消息别丢，可以开启confirm模式，在生产者那里设置开启confirm模式之后，你每次写的消息都会分配一个唯一的id，然后如果写入了rabbitmq中，rabbitmq会给你回传一个ack消息，告诉你说这个消息ok了。如果rabbitmq没能处理这个消息，会回调你一个nack接口，告诉你这个消息接收失败，你可以重试。而且你可以结合这个机制自己在内存里维护每个消息id的状态，如果超过一定时间还没接收到这个消息的回调，那么你可以重发。</p><p>事务机制和cnofirm机制最大的不同在于，事务机制是同步的，你提交一个事务之后会阻塞在那儿，但是confirm机制是异步的，你发送个消息之后就可以发送下一个消息，然后那个消息rabbitmq接收了之后会异步回调你一个接口通知你这个消息接收到了。</p><p>所以一般在生产者这块避免数据丢失，都是用confirm机制的。</p><p>2）rabbitmq弄丢了数据</p><p>就是rabbitmq自己弄丢了数据，这个你必须开启rabbitmq的持久化，就是消息写入之后会持久化到磁盘，哪怕是rabbitmq自己挂了，恢复之后会自动读取之前存储的数据，一般数据不会丢。除非极其罕见的是，rabbitmq还没持久化，自己就挂了，可能导致少量数据会丢失的，但是这个概率较小。</p><p>设置持久化有两个步骤，第一个是创建queue的时候将其设置为持久化的，这样就可以保证rabbitmq持久化queue的元数据，但是不会持久化queue里的数据；第二个是发送消息的时候将消息的deliveryMode设置为2，就是将消息设置为持久化的，此时rabbitmq就会将消息持久化到磁盘上去。必须要同时设置这两个持久化才行，rabbitmq哪怕是挂了，再次重启，也会从磁盘上重启恢复queue，恢复这个queue里的数据。</p><p>而且持久化可以跟生产者那边的confirm机制配合起来，只有消息被持久化到磁盘之后，才会通知生产者ack了，所以哪怕是在持久化到磁盘之前，rabbitmq挂了，数据丢了，生产者收不到ack，你也是可以自己重发的。</p><p>哪怕是你给rabbitmq开启了持久化机制，也有一种可能，就是这个消息写到了rabbitmq中，但是还没来得及持久化到磁盘上，结果不巧，此时rabbitmq挂了，就会导致内存里的一点点数据会丢失。</p><p>3）消费端弄丢了数据</p><p>rabbitmq如果丢失了数据，主要是因为你消费的时候，刚消费到，还没处理，结果进程挂了，比如重启了，那么就尴尬了，rabbitmq认为你都消费了，这数据就丢了。</p><p>这个时候得用rabbitmq提供的ack机制，简单来说，就是你关闭rabbitmq自动ack，可以通过一个api来调用就行，然后每次你自己代码里确保处理完的时候，再程序里ack一把。这样的话，如果你还没处理完，不就没有ack？那rabbitmq就认为你还没处理完，这个时候rabbitmq会把这个消费分配给别的consumer去处理，消息是不会丢的。</p><p><img src="https://img-blog.csdnimg.cn/20181220234151145.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>（2）kafka</p><p>1）消费端弄丢了数据</p><p>唯一可能导致消费者弄丢数据的情况，就是说，你那个消费到了这个消息，然后消费者那边自动提交了offset，让kafka以为你已经消费好了这个消息，其实你刚准备处理这个消息，你还没处理，你自己就挂了，此时这条消息就丢咯。</p><p>这不是一样么，大家都知道kafka会自动提交offset，那么只要关闭自动提交offset，在处理完之后自己手动提交offset，就可以保证数据不会丢。但是此时确实还是会重复消费，比如你刚处理完，还没提交offset，结果自己挂了，此时肯定会重复消费一次，自己保证幂等性就好了。</p><p>生产环境碰到的一个问题，就是说我们的kafka消费者消费到了数据之后是写到一个内存的queue里先缓冲一下，结果有的时候，你刚把消息写入内存queue，然后消费者会自动提交offset。</p><p>然后此时我们重启了系统，就会导致内存queue里还没来得及处理的数据就丢失了</p><p>2）kafka弄丢了数据</p><p>这块比较常见的一个场景，就是kafka某个broker宕机，然后重新选举partiton的leader时。大家想想，要是此时其他的follower刚好还有些数据没有同步，结果此时leader挂了，然后选举某个follower成leader之后，他不就少了一些数据？这就丢了一些数据啊。</p><p><img src="https://img-blog.csdnimg.cn/20181220235242656.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>生产环境也遇到过，我们也是，之前kafka的leader机器宕机了，将follower切换为leader之后，就会发现说这个数据就丢了</p><p><strong>所以此时一般是要求起码设置如下4个参数：</strong></p><p><strong>给这个topic设置replication.factor参数：这个值必须大于1，要求每个partition必须有至少2个副本</strong></p><p><strong>在kafka服务端设置min.insync.replicas参数：这个值必须大于1，这个是要求一个leader至少感知到有至少一个follower还跟自己保持联系，没掉队，这样才能确保leader挂了还有一个follower吧</strong></p><p><strong>在producer端设置acks=all：这个是要求每条数据，必须是写入所有replica之后，才能认为是写成功了</strong></p><p><strong>在producer端设置retries=MAX（很大很大很大的一个值，无限次重试的意思）：这个是要求一旦写入失败，就无限重试，卡在这里了</strong></p><p><strong>我们生产环境就是按照上述要求配置的，这样配置之后，至少在kafka broker端就可以保证在leader所在broker发生故障，进行leader切换时，数据不会丢失</strong></p><p>3）生产者会不会弄丢数据</p><p>如果按照上述的思路设置了ack=all，一定不会丢，要求是，你的leader接收到消息，所有的follower都同步到了消息之后，才认为本次写成功了。如果没满足这个条件，生产者会自动不断的重试，重试无限次。</p><h2 id="5-如何保证消息的顺序性？"><a href="#5-如何保证消息的顺序性？" class="headerlink" title="5.如何保证消息的顺序性？"></a>5.如何保证消息的顺序性？</h2><p> 其实这个也是用MQ的时候必问的话题，第一看看你了解不了解顺序这个事儿？第二看看你有没有办法保证消息是有顺序的？这个生产系统中常见的问题。</p><p>我举个例子，我们以前做过一个mysql binlog同步的系统，压力还是非常大的，日同步数据要达到上亿。mysql -&gt; mysql，常见的一点在于说大数据team，就需要同步一个mysql库过来，对公司的业务系统的数据做各种复杂的操作。</p><p>你在mysql里增删改一条数据，对应出来了增删改3条binlog，接着这三条binlog发送到MQ里面，到消费出来依次执行，起码得保证人家是按照顺序来的吧？不然本来是：增加、修改、删除；你楞是换了顺序给执行成删除、修改、增加，不全错了么。</p><p>本来这个数据同步过来，应该最后这个数据被删除了；结果你搞错了这个顺序，最后这个数据保留下来了，数据同步就出错了。</p><p>先看看顺序会错乱的俩场景</p><p>（1）rabbitmq：一个queue，多个consumer，这不明显乱了</p><p><img src="https://img-blog.csdnimg.cn/20181221205612760.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>（2）kafka：一个topic，一个partition，一个consumer，内部多线程，这不也明显乱了</p><p><img src="https://img-blog.csdnimg.cn/20181221212420171.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>那如何保证消息的顺序性呢？简单简单</p><p>（1）rabbitmq：拆分多个queue，每个queue一个consumer，就是多一些queue而已，确实是麻烦点；</p><p><img src="https://img-blog.csdnimg.cn/20181221210756591.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>或者就一个queue但是对应一个consumer，然后这个consumer内部用内存队列做排队，然后分发给底层不同的worker来处理</p><p>（2）kafka：一个topic，一个partition，一个consumer，内部单线程消费，写N个内存queue，然后N个线程分别消费一个内存queue即可</p><p><img src="https://img-blog.csdnimg.cn/20181221213602651.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><h2 id="6-如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？"><a href="#6-如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？" class="headerlink" title="6.如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？"></a>6.如何解决消息队列的延时以及过期失效问题？消息队列满了以后该怎么处理？有几百万消息持续积压几小时，说说怎么解决？</h2><p>你看这问法，其实本质针对的场景，都是说，可能你的消费端出了问题，不消费了，或者消费的极其极其慢。接着就坑爹了，可能你的消息队列集群的磁盘都快写满了，都没人消费，这个时候怎么办？或者是整个这就积压了几个小时，你这个时候怎么办？或者是你积压的时间太长了，导致比如rabbitmq设置了消息过期时间后就没了怎么办？</p><p>所以就这事儿，其实线上挺常见的，一般不出，一出就是大case，一般常见于，举个例子，消费端每次消费之后要写mysql，结果mysql挂了，消费端hang那儿了，不动了。或者是消费端出了个什么叉子，导致消费速度极其慢。</p><p>关于这个事儿，我们一个一个来梳理吧，先假设一个场景，我们现在消费端出故障了，然后大量消息在mq里积压，现在事故了，慌了</p><p>（1）大量消息在mq里积压了几个小时了还没解决</p><p>几千万条数据在MQ里积压了七八个小时，从下午4点多，积压到了晚上很晚，10点多，11点多</p><p>这个是我们真实遇到过的一个场景，确实是线上故障了，这个时候要不然就是修复consumer的问题，让他恢复消费速度，然后傻傻的等待几个小时消费完毕。这个肯定不能在面试的时候说吧。</p><p>一个消费者一秒是1000条，一秒3个消费者是3000条，一分钟是18万条，1000多万条</p><p>所以如果你积压了几百万到上千万的数据，即使消费者恢复了，也需要大概1小时的时间才能恢复过来</p><p>一般这个时候，只能操作临时紧急扩容了，具体操作步骤和思路如下：</p><p>1）先修复consumer的问题，确保其恢复消费速度，然后将现有cnosumer都停掉</p><p>2）新建一个topic，partition是原来的10倍，临时建立好原先10倍或者20倍的queue数量</p><p>3）然后写一个临时的分发数据的consumer程序，这个程序部署上去消费积压的数据，消费之后不做耗时的处理，直接均匀轮询写入临时建立好的10倍数量的queue</p><p>4）接着临时征用10倍的机器来部署consumer，每一批consumer消费一个临时queue的数据</p><p>5）这种做法相当于是临时将queue资源和consumer资源扩大10倍，以正常的10倍速度来消费数据</p><p>6）等快速消费完积压数据之后，得恢复原先部署架构，重新用原先的consumer机器来消费消息</p><p><img src="https://img-blog.csdnimg.cn/20181221220143890.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI5Njc2NjIz,size_16,color_FFFFFF,t_70" alt="img"></p><p>（2）这里我们假设再来第二个坑</p><p>假设你用的是rabbitmq，rabbitmq是可以设置过期时间的，就是TTL，如果消息在queue中积压超过一定的时间就会被rabbitmq给清理掉，这个数据就没了。那这就是第二个坑了。这就不是说数据会大量积压在mq里，而是大量的数据会直接搞丢。</p><p>这个情况下，就不是说要增加consumer消费积压的消息，因为实际上没啥积压，而是丢了大量的消息。我们可以采取一个方案，就是批量重导，这个我们之前线上也有类似的场景干过。就是大量积压的时候，我们当时就直接丢弃数据了，然后等过了高峰期以后，比如大家一起喝咖啡熬夜到晚上12点以后，用户都睡觉了。</p><p>这个时候我们就开始写程序，将丢失的那批数据，写个临时程序，一点一点的查出来，然后重新灌入mq里面去，把白天丢的数据给他补回来。也只能是这样了。</p><p>假设1万个订单积压在mq里面，没有处理，其中1000个订单都丢了，你只能手动写程序把那1000个订单给查出来，手动发到mq里去再补一次</p><p>（3）然后我们再来假设第三个坑</p><p>如果走的方式是消息积压在mq里，那么如果你很长时间都没处理掉，此时导致mq都快写满了，咋办？这个还有别的办法吗？没有，谁让你第一个方案执行的太慢了，你临时写程序，接入数据来消费，消费一个丢弃一个，都不要了，快速消费掉所有的消息。然后走第二个方案，到了晚上再补数据吧。</p><h2 id="7-如果让你写一个消息队列，该如何进行架构设计啊？说一下你的思路"><a href="#7-如果让你写一个消息队列，该如何进行架构设计啊？说一下你的思路" class="headerlink" title="7.如果让你写一个消息队列，该如何进行架构设计啊？说一下你的思路"></a>7.如果让你写一个消息队列，该如何进行架构设计啊？说一下你的思路</h2><p>其实聊到这个问题，一般面试官要考察两块：</p><p>（1）你有没有对某一个消息队列做过较为深入的原理的了解，或者从整体了解把握住一个mq的架构原理</p><p>（2）看看你的设计能力，给你一个常见的系统，就是消息队列系统，看看你能不能从全局把握一下整体架构设计，给出一些关键点出来</p><p>其实回答这类问题，说白了，起码不求你看过那技术的源码，起码你大概知道那个技术的基本原理，核心组成部分，基本架构构成，然后参照一些开源的技术把一个系统设计出来的思路说一下就好</p><p>比如说这个消息队列系统，我们来从以下几个角度来考虑一下</p><p>说实话，我一般面类似问题的时候，大部分人基本都会蒙，因为平时从来没有思考过类似的问题，大多数人就是平时埋头用，从来不去思考背后的一些东西。类似的问题，我经常问的还有，如果让你来设计一个spring框架你会怎么做？如果让你来设计一个dubbo框架你会怎么做？如果让你来设计一个mybatis框架你会怎么做？</p><p>其实回答这类问题，说白了，起码不求你看过那技术的源码，起码你大概知道那个技术的基本原理，核心组成部分，基本架构构成，然后参照一些开源的技术把一个系统设计出来的思路说一下就好</p><p>比如说这个消息队列系统，我们来从以下几个角度来考虑一下</p><p>（1）首先这个mq得支持可伸缩性吧，就是需要的时候快速扩容，就可以增加吞吐量和容量，那怎么搞？设计个分布式的系统呗，参照一下kafka的设计理念，broker -&gt; topic -&gt; partition，每个partition放一个机器，就存一部分数据。如果现在资源不够了，简单啊，给topic增加partition，然后做数据迁移，增加机器，不就可以存放更多数据，提供更高的吞吐量了？</p><p>（2）其次你得考虑一下这个mq的数据要不要落地磁盘吧？那肯定要了，落磁盘，才能保证别进程挂了数据就丢了。那落磁盘的时候怎么落啊？顺序写，这样就没有磁盘随机读写的寻址开销，磁盘顺序读写的性能是很高的，这就是kafka的思路。</p><p>（3）其次你考虑一下你的mq的可用性啊？这个事儿，具体参考我们之前可用性那个环节讲解的kafka的高可用保障机制。多副本 -&gt; leader &amp; follower -&gt; broker挂了重新选举leader即可对外服务。</p><p>（4）能不能支持数据0丢失啊？可以的，参考我们之前说的那个kafka数据零丢失方案</p><p>其实一个mq肯定是很复杂的，面试官问你这个问题，其实是个开放题，他就是看看你有没有从架构角度整体构思和设计的思维以及能力。确实这个问题可以刷掉一大批人，因为大部分人平时不思考这些东西。</p><p>来源:<a href="https://blog.csdn.net/qq_29676623/article/details/85108070">https://blog.csdn.net/qq_29676623/article/details/85108070</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/linux%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC/"/>
    <url>/2022/01/16/cnblog/linux%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC/</url>
    
    <content type="html"><![CDATA[<p><span style="font-size: 18px;">&nbsp;Centos (例:nginx)</span></p><p>编写服务脚本</p><div class="cnblogs_code"><div class="code-wrapper"><pre>vim /etc/init.d/nginx</pre></div></div><p>粘贴以下代码</p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /></a></span></div><div class="code-wrapper"><pre>#!/bin/bash# nginx Startup script for the Nginx HTTP Server# it is v.0.0.2 version.# chkconfig: - 85 15# description: Nginx is a high-performance web and proxy server.#              It has a lot of features, but it's not for everyone.# processname: nginx# pidfile: /usr/local/nginx/logs/nginx.pid# config: /usr/local/nginx/conf/nginx.confnginxd=/usr/local/nginx/sbin/nginxnginx_config=/usr/local/nginx/conf/nginx.confnginx_pid=/usr/local/nginx/logs/nginx.pidRETVAL=0prog="nginx"# Source function library.. /etc/rc.d/init.d/functions# Source networking configuration.. /etc/sysconfig/network# Check that networking is up.[ "${NETWORKING}" = "no" ] &amp;&amp; exit 0[ -x $nginxd ] || exit 0# Start nginx daemons functions.start() {if [ -e $nginx_pid ];then   echo "nginx already running...."   exit 1fi   echo -n $"Starting $prog: "   daemon $nginxd -c ${nginx_config}   RETVAL=$?   echo   [ $RETVAL = 0 ] &amp;&amp; touch /var/lock/subsys/nginx   return $RETVAL}# Stop nginx daemons functions.stop() {        echo -n $"Stopping $prog: "        killproc $nginxd        RETVAL=$?        echo        [ $RETVAL = 0 ] &amp;&amp; rm -f /var/lock/subsys/nginx /usr/local/nginx/logs/nginx.pid}# reload nginx service functions.reload() {    echo -n $"Reloading $prog: "    #kill -HUP `cat ${nginx_pid}`    killproc $nginxd -HUP    RETVAL=$?    echo}# See how we were called.case "$1" instart)        start        ;;stop)        stop        ;;reload)        reload        ;;restart)        stop        start        ;;status)        status $prog        RETVAL=$?        ;;*)        echo $"Usage: $prog {start|stop|restart|reload|status|help}"        exit 1esacexit $RETVAL</pre></div><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="https://common.cnblogs.com/images/copycode.gif" alt="复制代码" /></a></span></div></div><p>设置权限</p><div class="cnblogs_code"><div class="code-wrapper"><pre>chmod 755 /etc/init.d/nginx  </pre></div></div><p>加入开启自启</p><div class="cnblogs_code"><div class="code-wrapper"><pre>vi /etc/rc.local</pre></div></div><p>在末尾新增一行</p><div class="cnblogs_code"><div class="code-wrapper"><pre>/usr/local/nginx/sbin/nginx</pre></div></div><p>服务命令启动</p><div class="cnblogs_code"><div class="code-wrapper"><pre>/etc/init.d/nginx start</pre></div></div><p>加入开机启动</p><div class="cnblogs_code"><div class="code-wrapper"><pre>chkconfig nginx on</pre></div></div><p>然后你就可以使用以下服务命令了</p><div class="cnblogs_code"><div class="code-wrapper"><pre>systemctl status nginxsystemctl start nginxsystemctl stop nginxsystemctl reload nginxsystemctl restart nginx</pre></div></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/linux%E5%92%8C%E5%90%84%E4%B8%AA%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
    <url>/2022/01/16/cnblog/linux%E5%92%8C%E5%90%84%E4%B8%AA%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
    
    <content type="html"><![CDATA[<p style="text-align: center;"><img src="https://img2020.cnblogs.com/blog/1333782/202004/1333782-20200425111454910-598244130.png" alt="" /></p><p>&nbsp;</p><p style="text-align: center;">&nbsp;</p><p style="text-align: center;"><img src="https://img2020.cnblogs.com/blog/1333782/202004/1333782-20200425111310306-1582788906.png" alt="" /></p><p style="text-align: center;">&nbsp;</p><p style="text-align: center;">&nbsp;</p><p style="text-align: center;">&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/LaTeX%E7%BC%96%E8%BE%91%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%E5%85%83%E7%B4%A0/"/>
    <url>/2022/01/16/cnblog/LaTeX%E7%BC%96%E8%BE%91%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95%E5%85%83%E7%B4%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="LaTeX中的数学模式有两种形式"><a href="#LaTeX中的数学模式有两种形式" class="headerlink" title="LaTeX中的数学模式有两种形式:"></a>LaTeX中的数学模式有两种形式:</h1><ul><li>inline 和 display。<ul><li>前者是指在正文插入行间数学公式,后者独立排列,可以有或没有编号。</li></ul></li><li>行间公式(inline)<ul><li>用$将公式括起来。</li></ul></li><li>块间公式(displayed)<ul><li>用$$将公式括起来是无编号的形式</li><li>还有[…..]的无编号独立公式形式但Markdown好像不支持。</li><li>块间元素默认是居中显示的。</li></ul></li></ul><h2 id="各类希腊字母编辑表"><a href="#各类希腊字母编辑表" class="headerlink" title="各类希腊字母编辑表"></a>各类希腊字母编辑表</h2><p><img src="https://i.loli.net/2020/08/27/QpzvU5L1WCiMaJt.jpg" alt="å¸èå­æ¯ç¼è¾è¡¨"></p><h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><figure class="highlight livescript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs livescript">+, -, <span class="hljs-string">\pm,</span> <span class="hljs-string">\mp,</span> <span class="hljs-string">\dotplus</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\times,</span> <span class="hljs-string">\div,</span> <span class="hljs-string">\divideontimes,</span> /, <span class="hljs-string">\backslash</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\cdot,</span> * <span class="hljs-string">\ast,</span> <span class="hljs-string">\star,</span> <span class="hljs-string">\circ,</span> <span class="hljs-string">\bullet</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\boxplus,</span> <span class="hljs-string">\boxminus,</span> <span class="hljs-string">\boxtimes,</span> <span class="hljs-string">\boxdot</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\oplus,</span> <span class="hljs-string">\ominus,</span> <span class="hljs-string">\otimes,</span> <span class="hljs-string">\oslash,</span> <span class="hljs-string">\odot</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\circleddash,</span> <span class="hljs-string">\circledcirc,</span> <span class="hljs-string">\circledast</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\bigoplus,</span> <span class="hljs-string">\bigotimes,</span> <span class="hljs-string">\bigodot</span><br></code></pre></td></tr></table></figure><p>$$+, -, \pm, \mp, \dotplus \<br>\times, \div, \divideontimes, /, \backslash \<br>\cdot, * \ast, \star, \circ, \bullet \<br>\boxplus, \boxminus, \boxtimes, \boxdot \<br>\oplus, \ominus, \otimes, \oslash, \odot \<br>\circleddash, \circledcirc, \circledast \<br>\bigoplus, \bigotimes, \bigodot$$</p><h2 id="上下标、根号、省略号"><a href="#上下标、根号、省略号" class="headerlink" title="上下标、根号、省略号"></a>上下标、根号、省略号</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">x_i</span>,x^<span class="hljs-number">2</span>,x^&#123;i<span class="hljs-number">1</span>&#125;,\sqrt[<span class="hljs-number">3</span>]&#123;<span class="hljs-number">2</span>&#125;,\cdots<br></code></pre></td></tr></table></figure><p>$$x_i,x^2,x^{i1},sqrt[3]{2},\cdots$$</p><h2 id="声调-变音符号"><a href="#声调-变音符号" class="headerlink" title="声调 / 变音符号"></a>声调 / 变音符号</h2><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">\dot&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\ddot&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\acute&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\grave&#123;a&#125;</span><br></code></pre></td></tr></table></figure><p>$$\dot{a}, \ddot{a}, \acute{a}, \grave{a}$$</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">\check&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\breve&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\tilde&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\bar&#123;a&#125;</span><br></code></pre></td></tr></table></figure><p>$$\check{a}, \breve{a}, \tilde{a}, \bar{a}$$</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">\hat&#123;a&#125;</span><span class="hljs-string">,</span> <span class="hljs-comment">\vec&#123;a&#125;</span><br></code></pre></td></tr></table></figure><p>$$\hat{a}, \vec{a}$$</p><h2 id="标准函数"><a href="#标准函数" class="headerlink" title="标准函数"></a>标准函数</h2><h3 id="指数"><a href="#指数" class="headerlink" title="指数"></a>指数</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">\exp_a <span class="hljs-keyword">b </span>= a^<span class="hljs-keyword">b, </span>\exp <span class="hljs-keyword">b </span>= e^<span class="hljs-keyword">b, </span><span class="hljs-number">10</span>^m<br></code></pre></td></tr></table></figure><p>$$\exp_a b = a^b, \exp b = e^b, 10^m$$</p><h3 id="对数"><a href="#对数" class="headerlink" title="对数"></a>对数</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\ln</span> c, <span class="hljs-string">\lg</span> d = <span class="hljs-string">\log</span> e, <span class="hljs-string">\log_&#123;10&#125;</span> f<br></code></pre></td></tr></table></figure><p>$$\ln c, \lg d = \log e, \log_{10} f$$</p><h3 id="三角函数"><a href="#三角函数" class="headerlink" title="三角函数"></a>三角函数</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\sin</span> a, <span class="hljs-string">\cos</span> b, <span class="hljs-string">\tan</span> c, <span class="hljs-string">\cot</span> d, <span class="hljs-string">\sec</span> e, <span class="hljs-string">\csc</span> f <span class="hljs-string">\\</span><br><span class="hljs-string">\arcsin</span> a, <span class="hljs-string">\arccos</span> b, <span class="hljs-string">\arctan</span> c <span class="hljs-string">\\</span><br><span class="hljs-string">\arccot</span> d, <span class="hljs-string">\arcsec</span> e, <span class="hljs-string">\arccsc</span> f <span class="hljs-string">\\</span><br><span class="hljs-string">\sinh</span> a, <span class="hljs-string">\cosh</span> b, <span class="hljs-string">\tanh</span> c, <span class="hljs-string">\coth</span> d <span class="hljs-string">\\</span><br><span class="hljs-string">\operatorname&#123;sh&#125;k,</span> <span class="hljs-string">\operatorname&#123;ch&#125;l,</span> <span class="hljs-string">\operatorname&#123;th&#125;m,</span> <span class="hljs-string">\operatorname&#123;coth&#125;n</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\operatorname&#123;argsh&#125;o,</span> <span class="hljs-string">\operatorname&#123;argch&#125;p,</span> <span class="hljs-string">\operatorname&#123;argth&#125;q</span><br></code></pre></td></tr></table></figure><p>$$\sin a, \cos b, \tan c, \cot d, \sec e, \csc f \<br>\arcsin a, \arccos b, \arctan c \<br>arccot d, arcsec e, arccsc f \<br>\sinh a, \cosh b, \tanh c, \coth d \<br>\operatorname{sh}k, \operatorname{ch}l, \operatorname{th}m, \operatorname{coth}n \<br>\operatorname{argsh}o, \operatorname{argch}p, \operatorname{argth}q$$</p><h3 id="符号函数-绝对值"><a href="#符号函数-绝对值" class="headerlink" title="符号函数,绝对值"></a>符号函数,绝对值</h3><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><span class="hljs-symbol">\s</span>gn r, <span class="hljs-symbol">\l</span>eft<span class="hljs-symbol">\v</span>ert s <span class="hljs-symbol">\r</span>ight<span class="hljs-symbol">\v</span>ert<br></code></pre></td></tr></table></figure><p>$$sgn r, \left\vert s \right\vert$$</p><h3 id="最大值-最小值"><a href="#最大值-最小值" class="headerlink" title="最大值,最小值"></a>最大值,最小值</h3><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">\<span class="hljs-keyword">min</span>(<span class="hljs-keyword">x</span><span class="hljs-punctuation">,</span>y)<span class="hljs-punctuation">,</span> \<span class="hljs-keyword">max</span>(<span class="hljs-keyword">x</span><span class="hljs-punctuation">,</span>y)<br></code></pre></td></tr></table></figure><p>$$\min(x,y), \max(x,y)$$</p><h2 id="界限-极限"><a href="#界限-极限" class="headerlink" title="界限,极限"></a>界限,极限</h2><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><span class="hljs-symbol">\m</span>in x, <span class="hljs-symbol">\m</span>ax y, <span class="hljs-symbol">\i</span>nf s, <span class="hljs-symbol">\s</span>up t <span class="hljs-symbol">\\</span><br><span class="hljs-symbol">\l</span>im u, <span class="hljs-symbol">\l</span>iminf v, <span class="hljs-symbol">\l</span>imsup w <span class="hljs-symbol">\\</span><br><span class="hljs-symbol">\l</span>im_&#123;x <span class="hljs-symbol">\t</span>o <span class="hljs-symbol">\i</span>nfty&#125; <span class="hljs-symbol">\f</span>rac&#123;1&#125;&#123;n(n+1)&#125;<span class="hljs-symbol">\\</span><br><span class="hljs-symbol">\d</span>im p, <span class="hljs-symbol">\d</span>eg q, <span class="hljs-symbol">\d</span>et m, <span class="hljs-symbol">\k</span>er<span class="hljs-symbol">\p</span>hi<br></code></pre></td></tr></table></figure><p>$$\min x, \max y, \inf s, \sup t \<br>\lim u, \liminf v, \limsup w \<br>\lim_{x \to \infty} \frac{1}{n(n+1)}\<br>\dim p, \deg q, \det m, \ker\phi$$</p><h2 id="投射"><a href="#投射" class="headerlink" title="投射"></a>投射</h2><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\Pr</span> j, <span class="hljs-string">\hom</span> l, <span class="hljs-string">\lVert</span> z <span class="hljs-string">\rVert,</span> <span class="hljs-string">\arg</span> z<br></code></pre></td></tr></table></figure><p>$$\Pr j, \hom l, \lVert z \rVert, \arg z$$</p><h2 id="微分及导数"><a href="#微分及导数" class="headerlink" title="微分及导数"></a>微分及导数</h2><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">dt, <span class="hljs-symbol">\m</span>athrm&#123;d&#125;t, <span class="hljs-symbol">\p</span>artial t, <span class="hljs-symbol">\n</span>abla<span class="hljs-symbol">\p</span>si <span class="hljs-symbol">\\</span><br>dy/dx, <span class="hljs-symbol">\m</span>athrm&#123;d&#125;y/<span class="hljs-symbol">\m</span>athrm&#123;d&#125;x, <span class="hljs-symbol">\f</span>rac&#123;dy&#125;&#123;dx&#125;, <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\m</span>athrm&#123;d&#125;y&#125;&#123;<span class="hljs-symbol">\m</span>athrm&#123;d&#125;x&#125;, <span class="hljs-symbol">\f</span>rac&#123;<span class="hljs-symbol">\p</span>artial^2&#125;&#123;<span class="hljs-symbol">\p</span>artial x_1<span class="hljs-symbol">\p</span>artial x_2&#125;y <span class="hljs-symbol">\\</span><br><span class="hljs-symbol">\p</span>rime, <span class="hljs-symbol">\b</span>ackprime, f^<span class="hljs-symbol">\p</span>rime, f&#x27;, f&#x27;&#x27;, f^&#123;(3)&#125;, <span class="hljs-symbol">\d</span>ot y, <span class="hljs-symbol">\d</span>dot y<br></code></pre></td></tr></table></figure><p>$$dt, \mathrm{d}t, \partial t, \nabla\psi \<br>dy/dx, \mathrm{d}y/\mathrm{d}x, \frac{dy}{dx}, \frac{\mathrm{d}y}{\mathrm{d}x}, \frac{\partial^2}{\partial x_1\partial x_2}y \<br>\prime, \backprime, f^\prime, f’, f’’, f^{(3)}, \dot y, \ddot y$$</p><h3 id="类字母符号及常数"><a href="#类字母符号及常数" class="headerlink" title="类字母符号及常数"></a>类字母符号及常数</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-string">\infty,</span> <span class="hljs-string">\aleph,</span> <span class="hljs-string">\complement,</span> <span class="hljs-string">\backepsilon,</span> <span class="hljs-string">\eth,</span> <span class="hljs-string">\Finv,</span> <span class="hljs-string">\hbar</span> <span class="hljs-string">\\</span><br><span class="hljs-string">\Im,</span> <span class="hljs-string">\imath,</span> <span class="hljs-string">\jmath,</span> <span class="hljs-string">\Bbbk,</span> <span class="hljs-string">\ell,</span> <span class="hljs-string">\mho,</span> <span class="hljs-string">\wp,</span> <span class="hljs-string">\Re,</span> <span class="hljs-string">\circledS</span><br></code></pre></td></tr></table></figure><p>$$\infty, \aleph, \complement, \backepsilon, \eth, \Finv, \hbar \<br>\Im, \imath, \jmath, \Bbbk, \ell, \mho, \wp, \Re, \circledS$$</p><h3 id="模运算"><a href="#模运算" class="headerlink" title="模运算"></a>模运算</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript">s_k <span class="hljs-string">\equiv</span> <span class="hljs-number">0</span> <span class="hljs-string">\pmod&#123;m&#125;</span> <span class="hljs-string">\\</span><br>a <span class="hljs-string">\bmod</span> b <span class="hljs-string">\\</span><br><span class="hljs-string">\gcd(m,</span> n), <span class="hljs-string">\operatorname&#123;lcm&#125;(m,</span> n) <span class="hljs-string">\\</span><br><span class="hljs-string">\mid,</span> <span class="hljs-string">\nmid,</span> <span class="hljs-string">\shortmid,</span> <span class="hljs-string">\nshortmid</span><br></code></pre></td></tr></table></figure><p>$$s_k \equiv 0 \pmod{m} \<br>a \bmod b \<br>\gcd(m, n), \operatorname{lcm}(m, n) \<br>\mid, \nmid, \shortmid, \nshortmid$$</p><h3 id="根号"><a href="#根号" class="headerlink" title="根号"></a>根号</h3><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript"><span class="hljs-symbol">\s</span>urd, <span class="hljs-symbol">\s</span>qrt&#123;2&#125;, <span class="hljs-symbol">\s</span>qrt[n]&#123;&#125;, <span class="hljs-symbol">\s</span>qrt[3]&#123;<span class="hljs-symbol">\f</span>rac&#123;x^3+y^3&#125;&#123;2&#125;&#125;<br></code></pre></td></tr></table></figure><p>$$\surd, \sqrt{2}, \sqrt[n]{}, \sqrt[3]{\frac{x^3+y^3}{2}}$$</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/lambda/"/>
    <url>/2022/01/16/cnblog/lambda/</url>
    
    <content type="html"><![CDATA[<ul><li><p>1、什么是函数式接口</p></li><li><ul><li>1.1 java8自带的常用函数式接口。</li><li>1.2 惰性求值与及早求值</li></ul></li><li><p>2、常用的流</p></li><li><ul><li>2.1 collect(Collectors.toList())</li><li>2.2 filter</li><li>2.3 map</li><li>2.4 flatMap</li><li>2.5 max和min</li><li>2.6 count</li><li>2.7 reduce</li></ul></li><li><p>3.1 转换成值</p></li><li><p>3.2 转换成块</p></li><li><p>3.3 数据分组</p></li><li><p>3.4 字符串拼接</p></li><li><p>四、总结</p></li></ul><h1 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h1><p>java8最大的特性就是引入Lambda表达式，即函数式编程，可以将行为进行传递。<strong>总结就是：使用不可变值与函数，函数对不可变值进行处理，映射成另一个值。</strong></p><h1 id="二、java重要的函数式接口"><a href="#二、java重要的函数式接口" class="headerlink" title="二、java重要的函数式接口"></a>二、java重要的函数式接口</h1><h2 id="1、什么是函数式接口"><a href="#1、什么是函数式接口" class="headerlink" title="1、什么是函数式接口"></a>1、什么是函数式接口</h2><p><strong>函数接口是只有一个抽象方法的接口，用作 Lambda 表达式的类型。使用@FunctionalInterface注解修饰的类，编译器会检测该类是否只有一个抽象方法或接口，否则，会报错。可以有多个默认方法，静态方法。</strong></p><h3 id="1-1-java8自带的常用函数式接口。"><a href="#1-1-java8自带的常用函数式接口。" class="headerlink" title="1.1 java8自带的常用函数式接口。"></a>1.1 java8自带的常用函数式接口。</h3><table><thead><tr><th align="left">函数接口</th><th align="left">抽象方法</th><th align="left">功能</th><th align="left">参数</th><th align="left">返回类型</th><th align="left">示例</th></tr></thead><tbody><tr><td align="left">Predicate</td><td align="left">test(T t)</td><td align="left">判断真假</td><td align="left">T</td><td align="left">boolean</td><td align="left">9龙的身高大于185cm吗？</td></tr><tr><td align="left">Consumer</td><td align="left">accept(T t)</td><td align="left">消费消息</td><td align="left">T</td><td align="left">void</td><td align="left">输出一个值</td></tr><tr><td align="left">Function</td><td align="left">R apply(T t)</td><td align="left">将T映射为R（转换功能）</td><td align="left">T</td><td align="left">R</td><td align="left">获得student对象的名字</td></tr><tr><td align="left">Supplier</td><td align="left">T get()</td><td align="left">生产消息</td><td align="left">None</td><td align="left">T</td><td align="left">工厂方法</td></tr><tr><td align="left">UnaryOperator</td><td align="left">T apply(T t)</td><td align="left">一元操作</td><td align="left">T</td><td align="left">T</td><td align="left">逻辑非（!）</td></tr><tr><td align="left">BinaryOperator</td><td align="left">apply(T t, U u)</td><td align="left">二元操作</td><td align="left">(T，T)</td><td align="left">(T)</td><td align="left">求两个数的乘积（*）</td></tr></tbody></table><figure class="highlight pgsql"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Test &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>        Predicate&lt;<span class="hljs-type">Integer</span>&gt; predicate = x -&gt; x &gt; <span class="hljs-number">185</span>;<br>        Student student = <span class="hljs-built_in">new</span> Student(&quot;9龙&quot;, <span class="hljs-number">23</span>, <span class="hljs-number">175</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<br>            &quot;9龙的身高高于185吗？：&quot; + predicate.test(student.getStature()));<br>        Consumer&lt;String&gt; consumer = <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>::println;<br>        consumer.accept(&quot;命运由我不由天&quot;);<br>        <span class="hljs-keyword">Function</span>&lt;Student, String&gt; <span class="hljs-keyword">function</span> = Student::getName;<br>        String <span class="hljs-type">name</span> = <span class="hljs-keyword">function</span>.apply(student);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-type">name</span>);<br>        Supplier&lt;<span class="hljs-type">Integer</span>&gt; supplier = <br>            () -&gt; <span class="hljs-type">Integer</span>.valueOf(BigDecimal.TEN.toString());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(supplier.<span class="hljs-keyword">get</span>());<br>        UnaryOperator&lt;<span class="hljs-type">Boolean</span>&gt; unaryOperator = uglily -&gt; !uglily;<br>        <span class="hljs-type">Boolean</span> apply2 = unaryOperator.apply(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(apply2);<br>        BinaryOperator&lt;<span class="hljs-type">Integer</span>&gt; <span class="hljs-keyword">operator</span> = (x, y) -&gt; x * y;<br>        <span class="hljs-type">Integer</span> <span class="hljs-type">integer</span> = <span class="hljs-keyword">operator</span>.apply(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-type">integer</span>);<br>        test(() -&gt; &quot;我是一个演示的函数式接口&quot;);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 演示自定义函数式接口使用</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * @param worker</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> test(Worker worker) &#123;<br>        String <span class="hljs-keyword">work</span> = worker.<span class="hljs-keyword">work</span>();<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">work</span>);<br>    &#125;<br>    <span class="hljs-built_in">public</span> interface Worker &#123;<br>        String <span class="hljs-keyword">work</span>();<br>    &#125;<br>&#125;<br>//<span class="hljs-number">9</span>龙的身高高于<span class="hljs-number">185</span>吗？：<span class="hljs-keyword">false</span><br>//命运由我不由天<br>//<span class="hljs-number">9</span>龙<br>//<span class="hljs-number">10</span><br>//<span class="hljs-keyword">false</span><br>//<span class="hljs-number">6</span><br>//我是一个演示的函数式接口<br></code></pre></td></tr></table></figure><p>以上演示了lambda接口的使用及自定义一个函数式接口并使用。下面，我们看看java8将函数式接口封装到流中如何高效的帮助我们处理集合。</p><p><strong>注意：Student::getName</strong>例子中这种编写lambda表达式的方式称为**方法引用。**格式为**ClassNmae::methodName**。是不是很神奇，java8就是这么迷人。</p><p><strong>示例：本篇所有示例都基于以下三个类。OutstandingClass：班级；Student：学生；SpecialityEnum：特长。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae40638d420acd" alt="img"></p><h3 id="1-2-惰性求值与及早求值"><a href="#1-2-惰性求值与及早求值" class="headerlink" title="1.2 惰性求值与及早求值"></a>1.2 惰性求值与及早求值</h3><p><strong>惰性求值：只描述Stream，操作的结果也是Stream，这样的操作称为惰性求值。</strong>惰性求值可以像建造者模式一样链式使用，最后再使用及早求值得到最终结果。</p><p><strong>及早求值：得到最终的结果而不是Stream，这样的操作称为及早求值。</strong></p><h2 id="2、常用的流"><a href="#2、常用的流" class="headerlink" title="2、常用的流"></a>2、常用的流</h2><h3 id="2-1-collect-Collectors-toList"><a href="#2-1-collect-Collectors-toList" class="headerlink" title="2.1 collect(Collectors.toList())"></a>2.1 collect(Collectors.toList())</h3><p><strong>将流转换为list。还有toSet()，toMap()等。及早求值</strong>。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> TestCase &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        List&lt;Student&gt; studentList = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;路飞&quot;</span>, 22, 175)</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;红发&quot;</span>, 40, 180)</span>,<br>                <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;白胡子&quot;</span>, 50, 185)</span>).collect(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collectors</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">List()</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(studentList);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//[Student&#123;name=&#x27;路飞&#x27;, age=22, stature=175, specialities=null&#125;, </span><br><span class="hljs-comment">//Student&#123;name=&#x27;红发&#x27;, age=40, stature=180, specialities=null&#125;, </span><br><span class="hljs-comment">//Student&#123;name=&#x27;白胡子&#x27;, age=50, stature=185, specialities=null&#125;]</span><br></code></pre></td></tr></table></figure><h3 id="2-2-filter"><a href="#2-2-filter" class="headerlink" title="2.2 filter"></a>2.2 filter</h3><p>顾名思义，起<strong>过滤筛选</strong>的作用。<strong>内部就是Predicate接口。惰性求值。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae40638d2c0a51" alt="img"></p><p>比如我们筛选出出身高小于180的同学。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> TestCase &#123;<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) &#123;<br>        List&lt;Student&gt; students = <span class="hljs-built_in">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> Student(&quot;路飞&quot;, <span class="hljs-number">22</span>, <span class="hljs-number">175</span>));<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> Student(&quot;红发&quot;, <span class="hljs-number">40</span>, <span class="hljs-number">180</span>));<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-built_in">new</span> Student(&quot;白胡子&quot;, <span class="hljs-number">50</span>, <span class="hljs-number">185</span>));<br>        List&lt;Student&gt; list = students.stream()<br>            .<span class="hljs-keyword">filter</span>(stu -&gt; stu.getStature() &lt; <span class="hljs-number">180</span>)<br>            .collect(Collectors.toList());<br>        <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(list);<br>    &#125;<br>&#125;<br>//输出结果<br>//[Student&#123;<span class="hljs-type">name</span>=<span class="hljs-string">&#x27;路飞&#x27;</span>, age=<span class="hljs-number">22</span>, stature=<span class="hljs-number">175</span>, specialities=<span class="hljs-keyword">null</span>&#125;]<br></code></pre></td></tr></table></figure><h3 id="2-3-map"><a href="#2-3-map" class="headerlink" title="2.3 map"></a>2.3 map</h3><p><strong>转换功能，内部就是Function接口。惰性求值</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae40638d1c6610" alt="img"></p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCase</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;路飞&quot;</span>, <span class="hljs-number">22</span>, <span class="hljs-number">175</span>));<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;红发&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-number">180</span>));<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;白胡子&quot;</span>, <span class="hljs-number">50</span>, <span class="hljs-number">185</span>));<br>        List&lt;<span class="hljs-keyword">String</span>&gt; names = students.stream().map(student -&gt; student.getName())<br>                .collect(Collectors.toList());<br>        System.out.println(names);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//[路飞, 红发, 白胡子]</span><br></code></pre></td></tr></table></figure><p>例子中将student对象转换为String对象，获取student的名字。</p><h3 id="2-4-flatMap"><a href="#2-4-flatMap" class="headerlink" title="2.4 flatMap"></a>2.4 flatMap</h3><p><strong>将多个Stream合并为一个Stream。惰性求值</strong></p><p><img src="https://user-gold-cdn.xitu.io/2019/5/23/16ae40638c4cca86?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> TestCase &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;路飞&quot;</span>, 22, 175)</span>);<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;红发&quot;</span>, 40, 180)</span>);<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;白胡子&quot;</span>, 50, 185)</span>);<br>        List&lt;Student&gt; studentList = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(students,<br>                <span class="hljs-keyword">as</span><span class="hljs-constructor">List(<span class="hljs-params">new</span> Student(<span class="hljs-string">&quot;艾斯&quot;</span>, 25, 183)</span>,<br>                        <span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;雷利&quot;</span>, 48, 176)</span>))<br>                .flat<span class="hljs-constructor">Map(<span class="hljs-params">students1</span> -&gt; <span class="hljs-params">students1</span>.<span class="hljs-params">stream</span>()</span>).collect(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Collectors</span>.</span></span><span class="hljs-keyword">to</span><span class="hljs-constructor">List()</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(studentList);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//[Student&#123;name=&#x27;路飞&#x27;, age=22, stature=175, specialities=null&#125;, </span><br><span class="hljs-comment">//Student&#123;name=&#x27;红发&#x27;, age=40, stature=180, specialities=null&#125;, </span><br><span class="hljs-comment">//Student&#123;name=&#x27;白胡子&#x27;, age=50, stature=185, specialities=null&#125;, </span><br><span class="hljs-comment">//Student&#123;name=&#x27;艾斯&#x27;, age=25, stature=183, specialities=null&#125;,</span><br><span class="hljs-comment">//Student&#123;name=&#x27;雷利&#x27;, age=48, stature=176, specialities=null&#125;]</span><br></code></pre></td></tr></table></figure><p>调用Stream.of的静态方法将两个list转换为Stream，再通过flatMap将两个流合并为一个。</p><h3 id="2-5-max和min"><a href="#2-5-max和min" class="headerlink" title="2.5 max和min"></a>2.5 max和min</h3><p>我们经常会在集合中<strong>求最大或最小值</strong>，使用流就很方便。<strong>及早求值。</strong></p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> class TestCase &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;路飞&quot;</span>, <span class="hljs-number">22</span>, <span class="hljs-number">175</span>));<br>        students.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;红发&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-number">180</span>));<br>        students.<span class="hljs-built_in">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;白胡子&quot;</span>, <span class="hljs-number">50</span>, <span class="hljs-number">185</span>));<br>        Optional&lt;Student&gt; <span class="hljs-built_in">max</span> = students.stream()<br>            .<span class="hljs-built_in">max</span>(Comparator.comparing(stu -&gt; stu.getAge()));<br>        Optional&lt;Student&gt; <span class="hljs-built_in">min</span> = students.stream()<br>            .<span class="hljs-built_in">min</span>(Comparator.comparing(stu -&gt; stu.getAge()));<br>        <span class="hljs-comment">//判断是否有值</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">max</span>.isPresent()) &#123;<br>            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">max</span>.<span class="hljs-built_in">get</span>());<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">min</span>.isPresent()) &#123;<br>            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-built_in">min</span>.<span class="hljs-built_in">get</span>());<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//Student&#123;name=&#x27;白胡子&#x27;, age=50, stature=185, specialities=null&#125;</span><br><span class="hljs-comment">//Student&#123;name=&#x27;路飞&#x27;, age=22, stature=175, specialities=null&#125;</span><br></code></pre></td></tr></table></figure><p><strong>max、min接收一个Comparator</strong>（例子中使用<a href="http://mp.weixin.qq.com/s?__biz=MzU2NjIzNDk5NQ==&mid=2247487555&idx=1&sn=ec36492b5c83fcab4241c2d51ef55c73&chksm=fcaeca5fcbd94349dbcf73a716fe49e3fc041b32fbec7a9fd12746805a930adc666004404f97&scene=21#wechat_redirect">java8</a>自带的静态函数，只需要传进需要比较值即可。）并且返回一个Optional对象，该对象是java8新增的类，专门为了防止null引发的空指针异常。可以使用max.isPresent()判断是否有值；可以使用max.orElse(new Student())，当值为null时就使用给定值；也可以使用max.orElseGet(() -&gt; new Student());这需要传入一个Supplier的lambda表达式。</p><h3 id="2-6-count"><a href="#2-6-count" class="headerlink" title="2.6 count"></a>2.6 count</h3><p><strong>统计功能，一般都是结合filter使用，因为先筛选出我们需要的再统计即可。及早求值</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TestCase</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> &#123;<br>        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;路飞&quot;</span>, <span class="hljs-number">22</span>, <span class="hljs-number">175</span>));<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;红发&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-number">180</span>));<br>        students.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> Student(<span class="hljs-string">&quot;白胡子&quot;</span>, <span class="hljs-number">50</span>, <span class="hljs-number">185</span>));<br>        <span class="hljs-built_in">long</span> count = students.stream().filter(s1 -&gt; s1.getAge() &lt; <span class="hljs-number">45</span>).count();<br>        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">&quot;年龄小于45岁的人数是：&quot;</span> + count);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//年龄小于45岁的人数是：2</span><br></code></pre></td></tr></table></figure><h3 id="2-7-reduce"><a href="#2-7-reduce" class="headerlink" title="2.7 reduce"></a>2.7 reduce</h3><p><strong>reduce 操作可以实现从一组值中生成一个值</strong>。在上述例子中用到的 count 、 min 和 max 方 法，因为常用而被纳入标准库中。事实上，这些方法都是 reduce 操作。<strong>及早求值。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae40638c52397b" alt="img"></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCase</span> &#123;</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">String</span>[] args)</span> </span>&#123;<br>        Integer reduce = <span class="hljs-built_in">Stream</span>.<span class="hljs-built_in">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>).<span class="hljs-built_in">reduce</span>(<span class="hljs-number">0</span>, (acc, x) -&gt; acc+ x);<br>        System.out.<span class="hljs-built_in">println</span>(reduce);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//10</span><br></code></pre></td></tr></table></figure><p>我们看得reduce接收了一个初始值为0的累加器，依次取出值与累加器相加，最后累加器的值就是最终的结果。</p><h1 id="三、高级集合类及收集器"><a href="#三、高级集合类及收集器" class="headerlink" title="三、高级集合类及收集器"></a>三、高级集合类及收集器</h1><h2 id="3-1-转换成值"><a href="#3-1-转换成值" class="headerlink" title="3.1 转换成值"></a>3.1 转换成值</h2><p><strong>收集器，一种通用的、从流生成复杂值的结构。</strong>只要将它传给 collect 方法，所有 的流就都可以使用它了。标准类库已经提供了一些有用的收集器，<strong>以下示例代码中的收集器都是从 java.util.stream.Collectors 类中静态导入的。</strong></p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">public <span class="hljs-keyword">class</span> CollectorsTest &#123;<br>    public static void main(String<span class="hljs-literal">[]</span> args) &#123;<br>        List&lt;Student&gt; students1 = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(<span class="hljs-number">3</span>);<br>        students1.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;路飞&quot;</span>, 23, 175)</span>);<br>        students1.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;红发&quot;</span>, 40, 180)</span>);<br>        students1.add(<span class="hljs-keyword">new</span> <span class="hljs-constructor">Student(<span class="hljs-string">&quot;白胡子&quot;</span>, 50, 185)</span>);<br>        OutstandingClass ostClass1 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">OutstandingClass(<span class="hljs-string">&quot;一班&quot;</span>, <span class="hljs-params">students1</span>)</span>;<br>        <span class="hljs-comment">//复制students1，并移除一个学生</span><br>        List&lt;Student&gt; students2 = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(students1);<br>        students2.remove(<span class="hljs-number">1</span>);<br>        OutstandingClass ostClass2 = <span class="hljs-keyword">new</span> <span class="hljs-constructor">OutstandingClass(<span class="hljs-string">&quot;二班&quot;</span>, <span class="hljs-params">students2</span>)</span>;<br>        <span class="hljs-comment">//将ostClass1、ostClass2转换为Stream</span><br>        Stream&lt;OutstandingClass&gt; classStream = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Stream</span>.</span></span><span class="hljs-keyword">of</span>(ostClass1, ostClass2);<br>        OutstandingClass outstandingClass = biggest<span class="hljs-constructor">Group(<span class="hljs-params">classStream</span>)</span>;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;人数最多的班级是：&quot;</span> + outstandingClass.get<span class="hljs-constructor">Name()</span>);<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>out.println(<span class="hljs-string">&quot;一班平均年龄是：&quot;</span> + average<span class="hljs-constructor">NumberOfStudent(<span class="hljs-params">students1</span>)</span>);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取人数最多的班级</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> static OutstandingClass biggest<span class="hljs-constructor">Group(Stream&lt;OutstandingClass&gt; <span class="hljs-params">outstandingClasses</span>)</span> &#123;<br>        return outstandingClasses.collect(<br>                max<span class="hljs-constructor">By(<span class="hljs-params">comparing</span>(<span class="hljs-params">ostClass</span> -&gt; <span class="hljs-params">ostClass</span>.<span class="hljs-params">getStudents</span>()</span>.size<span class="hljs-literal">()</span>)))<br>                .<span class="hljs-keyword">or</span><span class="hljs-constructor">ElseGet(OutstandingClass::<span class="hljs-params">new</span>)</span>;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 计算平均年龄</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> static double average<span class="hljs-constructor">NumberOfStudent(List&lt;Student&gt; <span class="hljs-params">students</span>)</span> &#123;<br>        return students.stream<span class="hljs-literal">()</span>.collect(averaging<span class="hljs-constructor">Int(Student::<span class="hljs-params">getAge</span>)</span>);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//人数最多的班级是：一班</span><br><span class="hljs-comment">//一班平均年龄是：37.666666666666664</span><br></code></pre></td></tr></table></figure><p>maxBy或者minBy就是求最大值与最小值。</p><h2 id="3-2-转换成块"><a href="#3-2-转换成块" class="headerlink" title="3.2 转换成块"></a>3.2 转换成块</h2><p><strong>常用的流操作是将其分解成两个集合，Collectors.partitioningBy帮我们实现了，接收一个Predicate函数式接口。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae4063943b9487" alt="img"></p><p>将示例学生分为会唱歌与不会唱歌的两个集合。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PartitioningByTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-comment">//省略List&lt;student&gt; students的初始化</span><br>        <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Boolean</span>, List&lt;Student&gt;&gt; listMap = students.stream().collect(<br>            Collectors.partitioningBy(student -&gt; student.getSpecialities().<br>                                      contains(SpecialityEnum.SING)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-3-数据分组"><a href="#3-3-数据分组" class="headerlink" title="3.3 数据分组"></a>3.3 数据分组</h2><p>数据分组是一种更自然的分割数据操作，与将数据分成 ture 和 false 两部分不同，<strong>可以使****用任意值对数据分组。Collectors.groupingBy接收一个Function做转换。</strong></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/16ae4063f5d78c78" alt="img"></p><p><strong>如图，我们使用groupingBy将根据进行分组为圆形一组，三角形一组，正方形一组。</strong></p><p>例子：根据学生第一个特长进行分组</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GroupingByTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-function"><span class="hljs-title">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>)</span> &#123;<br>        <span class="hljs-comment">//省略List&lt;student&gt; students的初始化</span><br>         <span class="hljs-built_in">Map</span>&lt;SpecialityEnum, List&lt;Student&gt;&gt; listMap = <br>             students.stream().collect(<br>             Collectors.groupingBy(student -&gt; student.getSpecialities().get(<span class="hljs-number">0</span>)));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Collectors.groupingBy与SQL 中的 group by 操作是一样的。</strong></p><h2 id="3-4-字符串拼接"><a href="#3-4-字符串拼接" class="headerlink" title="3.4 字符串拼接"></a>3.4 字符串拼接</h2><p>如果将所有学生的名字拼接起来，怎么做呢？通常只能创建一个StringBuilder，循环拼接。使用Stream，使用Collectors.joining()简单容易。</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JoiningTest</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        List&lt;Student&gt; students = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;(<span class="hljs-number">3</span>);<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;路飞&quot;</span>, <span class="hljs-number">22</span>, <span class="hljs-number">175</span>));<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;红发&quot;</span>, <span class="hljs-number">40</span>, <span class="hljs-number">180</span>));<br>        students.add(<span class="hljs-keyword">new</span> <span class="hljs-type">Student</span>(<span class="hljs-string">&quot;白胡子&quot;</span>, <span class="hljs-number">50</span>, <span class="hljs-number">185</span>));<br>         <span class="hljs-keyword">String</span> names = students.stream()<br>             .map(Student:<span class="hljs-type"></span>:getName).collect(Collectors.joining(<span class="hljs-string">&quot;,&quot;</span>,<span class="hljs-string">&quot;[&quot;</span>,<span class="hljs-string">&quot;]&quot;</span>));<br>        System.out.println(names);<br>    &#125;<br>&#125;<br><span class="hljs-comment">//输出结果</span><br><span class="hljs-comment">//[路飞,红发,白胡子]</span><br></code></pre></td></tr></table></figure><p><strong>joining接收三个参数，第一个是分界符，第二个是前缀符，第三个是结束符。也可以不传入参数Collectors.joining()，这样就是直接拼接。</strong></p><h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>本篇主要从实际使用讲述了常用的方法及流，使用<a href="http://mp.weixin.qq.com/s?__biz=MzU2NjIzNDk5NQ==&mid=2247487555&idx=1&sn=ec36492b5c83fcab4241c2d51ef55c73&chksm=fcaeca5fcbd94349dbcf73a716fe49e3fc041b32fbec7a9fd12746805a930adc666004404f97&scene=21#wechat_redirect">java8</a>可以很清晰表达你要做什么，代码也很简洁。本篇例子主要是为了讲解较为简单，大家可以去使用<a href="http://mp.weixin.qq.com/s?__biz=MzU2NjIzNDk5NQ==&mid=2247487555&idx=1&sn=ec36492b5c83fcab4241c2d51ef55c73&chksm=fcaeca5fcbd94349dbcf73a716fe49e3fc041b32fbec7a9fd12746805a930adc666004404f97&scene=21#wechat_redirect">java8</a>重构自己现有的代码，自行领会lambda的奥妙。本文说的Stream要组合使用才会发挥更大的功能，链式调用很迷人，根据自己的业务去做吧。</p><p>来源:<a href="https://mp.weixin.qq.com/s/5DAZVtanTGdHqYSiI07oVg">https://mp.weixin.qq.com/s/5DAZVtanTGdHqYSiI07oVg</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/keras%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E4%BB%B7%E5%87%BD%E6%95%B0/"/>
    <url>/2022/01/16/cnblog/keras%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AF%84%E4%BB%B7%E5%87%BD%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<p>注：不知道是否正确</p><p>示例一：</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;">import keras.backend as Kfrom keras import Sequentialfrom keras.layers import Denseimport numpy as np<p>def getPrecision(y_true, y_pred):<br>    TP = K.sum(K.round(K.clip(y_true * y_pred, 0, 1)))#TP<br>    N = (-1)<em>K.sum(K.round(K.clip(y_true-K.ones_like(y_true), -1, 0)))#N<br>    TN=K.sum(K.round(K.clip((y_true-K.ones_like(y_true))</em>(y_pred-K.ones_like(y_pred)), 0, 1)))#TN<br>    FP=N-TN<br>    precision = TP / (TP + FP + K.epsilon())#TT/P<br>    return precision</p><p>def getRecall(y_true, y_pred):<br>    TP = K.sum(K.round(K.clip(y_true * y_pred, 0, 1)))#TP<br>    P=K.sum(K.round(K.clip(y_true, 0, 1)))<br>    FN = P-TP #FN=P-TP<br>    recall = TP / (TP + FN + K.epsilon())#TP/(TP+FN)<br>    return recall<br />model.compile(optimizer=”sgd”, loss=”categorical_crossentropy”,metrics=[“acc”,getRecall,getPrecision])</pre></div></p></div><p>&nbsp;来源：<a href="https://zhuanlan.zhihu.com/p/38080551">https://zhuanlan.zhihu.com/p/38080551</a></p><p>示例二：</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:python;gutter:true;">from keras import backend as Kdef Precision(y_true, y_pred):    """精确率"""    tp= K.sum(K.round(K.clip(y_true * y_pred, 0, 1)))  # true positives    pp= K.sum(K.round(K.clip(y_pred, 0, 1))) # predicted positives    precision = tp/ (pp+ K.epsilon())    return precision    <p>def Recall(y_true, y_pred):<br>    “””召回率”””<br>    tp = K.sum(K.round(K.clip(y_true * y_pred, 0, 1))) # true positives<br>    pp = K.sum(K.round(K.clip(y_true, 0, 1))) # possible positives<br>    recall = tp / (pp + K.epsilon())<br>    return recall</p><p>def F1(y_true, y_pred):<br>    “””F1-score”””<br>    precision = Precision(y_true, y_pred)<br>    recall = Recall(y_true, y_pred)<br>    f1 = 2 * ((precision * recall) / (precision + recall + K.epsilon()))<br>    return f1</pre></div></p></div><p>来源：<a href="https://blog.csdn.net/joleoy/article/details/85787457">https://blog.csdn.net/joleoy/article/details/85787457</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Kail%20%E6%9B%B4%E6%96%B0%E6%BA%90%E8%AE%BE%E7%BD%AE/"/>
    <url>/2022/01/16/cnblog/Kail%20%E6%9B%B4%E6%96%B0%E6%BA%90%E8%AE%BE%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>&nbsp;</p><div class="cnblogs_code"><div class="code-wrapper"><pre>vim /etc/apt/sources.list</pre></div></div><div id="crayon-59acd4ff709d4046829903-1" class="crayon-line"><div class="cnblogs_code"><div class="code-wrapper"><pre>#kali官方源#deb http://http.kali.org/kali kali-rolling main non-free contrib#中科大的源<code>deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</code><br /><code>deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</code></pre></div></div><div class="cnblogs_code"><div class="code-wrapper"><pre>apt-<span style="color: #0000ff;">get</span><span style="color: #000000;"> update #更新软件源中的所有软件列表。 apt</span>-<span style="color: #0000ff;">get</span><span style="color: #000000;"> upgrade #更新软件apt</span>-<span style="color: #0000ff;">get</span> dist-<span style="color: #000000;">upgrade #更新系统版本apt</span>-<span style="color: #0000ff;">get</span> clean</pre></div></div></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/JVM%E8%BF%9B%E9%98%B6/"/>
    <url>/2022/01/16/cnblog/JVM%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><ul><li>App类加载器</li><li>扩展类加载器</li><li>根类加载器</li></ul><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> java.lang.String;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String args[])</span></span>&#123;<br>        String s = <span class="hljs-keyword">new</span> String();<br>    &#125;<br>&#125;<br><span class="hljs-comment">// 双亲委派机制，安全机制，防止</span><br><span class="hljs-comment">// 自定义String 希望能够覆盖源码String 但是类加载的时候，app类加载器--》扩展类加载器---》根类加载器，跟类加载器会调用源码的String，集自己写String不能覆盖源码</span><br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/15/AUFO8aPsS7VHnlD.jpg" alt="虚拟机的内部结构"></p><h1 id="堆，方法区，栈"><a href="#堆，方法区，栈" class="headerlink" title="堆，方法区，栈"></a>堆，方法区，栈</h1><p><img src="https://i.loli.net/2020/09/15/X6QhWUbtG14f2YC.jpg" alt="img"> </p><h1 id="Native"><a href="#Native" class="headerlink" title="Native"></a>Native</h1><ul><li>本地方法，集Native方法，调用时进入本地方法栈，java以不能管理，会调用JNI</li><li>本地方法接口JNI —-&gt;本地方法库(C++,python等)</li></ul><h1 id="计数器"><a href="#计数器" class="headerlink" title="计数器"></a>计数器</h1><p>每个线程一个计数器，指向下一条指令</p><h1 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h1><ul><li><p>所有线程共享</p></li><li><p>静态变量，静态方法，常量，成员方法，类信息(构造方法，接口定义)，运行时常量池</p></li><li><p>常量池，对象的默认属性就是在常量池中</p><ul><li><p>存放类与接口的常量，</p></li><li><div class="code-wrapper"><pre><code class="java">public class Student&#123;    public String name = &quot;xxx&quot;;    public static void main(String args[])&#123;                new String(); // 此时创建的对象，它的name就是在常量池中    &#125;&#125;</code></pre></div></li></ul></li></ul><h1 id="java栈"><a href="#java栈" class="headerlink" title="java栈"></a>java栈</h1><ul><li>8大基本类型+对象引用+实例的方法</li><li>主方法程序入栈，执行，调用其他方法时，其他方法再入栈执行，执行完返回，正在执行的方法在栈顶</li><li>栈满了，StackflowError，一般是200层</li></ul><h1 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h1><ul><li><p>JVM分类</p><ul><li>sun 热点虚拟机</li><li>jrockit,最快的jvm</li><li>IBM,J9VMJIT</li></ul></li><li><p>jvm只有一个heap，大小可以调节，默认：实际使用1/64,试图申请内存的1/4(最大内存)，</p><ul><li>-Xms1024m -Xmx1024m       </li></ul></li><li><p>堆内存细分</p><ul><li>新生代<ul><li>8:1:1—-》伊甸园，幸存区0，幸存区1</li></ul></li><li>老生区</li><li>永久区<ul><li>1.6 ：永久代，常量池在方发区</li><li>1.7：永久代，常量池位于堆</li><li>1.8：元空间，方发区位于这里<ul><li>存放java运行时环境，以及方法区的常量池等</li><li>逻辑上存在，物理上不存在</li></ul></li><li>无垃圾回收</li><li>若第三方jar很多，Tomcat部署应用过多，动态生成反射类过多，可能会OOM</li></ul></li></ul><p><img src="https://i.loli.net/2020/09/15/9kMr4UbOKqXIVAN.png" alt="image-20200915221556463"></p></li><li><p>垃圾回收都在伊甸园，老生区</p></li><li><p>伊甸园满了—》对伊甸园轻GC—&gt;进入幸存区—-》也满了—》对伊甸园，幸存区重GC—–》进入养老区—》又满了—-》OOM</p><ul><li>但进入老生区对象很少，因为大多是临时对象</li></ul></li></ul><h1 id="Jprofiler"><a href="#Jprofiler" class="headerlink" title="Jprofiler"></a>Jprofiler</h1><ul><li>内存分析工具</li><li>idea使用<ul><li>安装jprofiler插件   setting 指向 指向程序jprofiler.exe</li><li>下载jprofiler.exe</li></ul></li><li>dump<ul><li>添加启动参数 -XX:+HeapDumpOnOutOfMemoryError</li></ul></li></ul><h1 id="GC算法"><a href="#GC算法" class="headerlink" title="GC算法"></a>GC算法</h1><ul><li>引用计数法，循环引用无法解决（不常使用）</li><li>复制算法（浪费一个幸存区，复制比较费时，存活度较低时常用）<ul><li>伊甸园满了-》轻GC—》到幸存区0（随机选一个）</li><li>伊甸园又满了—》轻GC–》存回对象会放到幸存区1，且就会把幸存区0的复制到幸存1，幸存0变为空</li><li>再此GC时，存活对象–》0，幸存1也复制到0</li><li>经历了15次GC，进入养老区， 可调参数</li></ul></li><li>标记清除（2次扫描费时间，会产生碎片，但不浪费空间）<ul><li>扫描对象，标记活的对象</li><li>清除没标记的</li></ul></li><li>标记清除压缩<ul><li>标记清除再此扫描，整理碎片</li></ul></li><li>总结<ul><li>新生代：存活率低，适用复制算法</li><li>老生代：标记清除或标记清除压缩</li></ul></li></ul><h1 id="JMM"><a href="#JMM" class="headerlink" title="JMM"></a>JMM</h1><ul><li>java内存模型</li><li>缓存一致性协议，定义数据读写规则<ul><li>线程操作共享变量时，不能保证及时刷新入内存，volilate关键字可以保证及时刷新到内存</li><li>定义了8种指令的使用规则</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/jvm/"/>
    <url>/2022/01/16/cnblog/jvm/</url>
    
    <content type="html"><![CDATA[<ol><li><h1 id="java虚拟机运行时数据区"><a href="#java虚拟机运行时数据区" class="headerlink" title="java虚拟机运行时数据区"></a>java虚拟机运行时数据区</h1><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203227691-206575417.jpg"></p><ul><li><p>方法区</p><p>​        属于共享内存区域，存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。</p></li><li><p>java虚拟机：</p><p>​        线程私有，生命周期和线程一致。描述的是 Java 方法执行的内存模型：每个方法在执行时都会床创建一个栈帧(Stack Frame)用于存储<code>局部变量表</code>、<code>操作数栈</code>、<code>动态链接</code>、<code>方法出口</code>等信息。每一个方法从调用直至执行结束，就对应着一个栈帧从虚拟机栈中入栈到出栈的过程。</p><h6 id="StackOverflowError：线程请求的栈深度大于虚拟机所允许的深度。"><a href="#StackOverflowError：线程请求的栈深度大于虚拟机所允许的深度。" class="headerlink" title="StackOverflowError：线程请求的栈深度大于虚拟机所允许的深度。"></a>StackOverflowError：线程请求的栈深度大于虚拟机所允许的深度。</h6><h6 id="OutOfMemoryError：如果虚拟机栈可以动态扩展，而扩展时无法申请到足够的内存。"><a href="#OutOfMemoryError：如果虚拟机栈可以动态扩展，而扩展时无法申请到足够的内存。" class="headerlink" title="OutOfMemoryError：如果虚拟机栈可以动态扩展，而扩展时无法申请到足够的内存。"></a>OutOfMemoryError：如果虚拟机栈可以动态扩展，而扩展时无法申请到足够的内存。</h6></li><li><p>本地方法栈</p><p>​        区别于 Java 虚拟机栈的是，Java 虚拟机栈为虚拟机执行 Java 方法(也就是字节码)服务，而本地方法栈则为虚拟机使用到的 Native 方法服务。也会有 StackOverflowError 和 OutOfMemoryError 异常。</p></li><li><p>java堆</p><p>​        对于绝大多数应用来说，这块区域是 JVM 所管理的内存中最大的一块。线程共享，主要是存放对象实例和数组。内部会划分出多个线程私有的分配缓冲区(Thread Local Allocation Buffer, TLAB)。可以位于物理上不连续的空间，但是逻辑上要连续。</p></li><li><p>程序计数器</p><div class="code-wrapper"><pre><code class="hljs">    内存空间小，线程私有。字节码解释器工作是就是通过改变这个计数器的值来选取下一条需要执行指令的字节码指令，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖计数器完成</code></pre></div></li><li><p><font color="red">运行时常量池</font></p><p>​        属于方法区一部分，用于存放编译期生成的各种字面量和符号引用。编译器和运行期(String 的 intern() )都可以将常量放入池中。内存有限，无法申请时抛出 OutOfMemoryError。</p></li><li><p>直接内存</p><p>​        非虚拟机运行时数据区的部分</p></li></ul></li><li><h1 id="热点虚拟机对象"><a href="#热点虚拟机对象" class="headerlink" title="热点虚拟机对象"></a>热点虚拟机对象</h1><ol><li><h2 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h2><ol><li>遇到 new 指令时，首先检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并且检查这个符号引用代表的类是否已经被加载、解析和初始化过。如果没有，执行相应的类加载</li><li>类加载检查通过之后，为新对象分配内存(内存大小在类加载完成后便可确认)。在堆的空闲内存中划分一块区域(‘指针碰撞-内存规整’或‘空闲列表-内存交错’的分配方式)。</li><li>前面讲的每个线程在堆中都会有私有的分配缓冲区(TLAB)，这样可以很大程度避免在并发情况下频繁创建对象造成的线程不安全</li><li>内存空间分配完成后会初始化为 0(不包括对象头)，接下来就是填充对象头，把对象是哪个类的实例、如何才能找到类的元数据信息、对象的哈希码、对象的 GC 分代年龄等信息存入对象头。</li><li>执行 new 指令后执行 init 方法后才算一份真正可用的对象创建完成。</li></ol></li><li><h2 id="对象在内存的布局"><a href="#对象在内存的布局" class="headerlink" title="对象在内存的布局"></a>对象在内存的布局</h2><p>在 HotSpot 虚拟机中，分为 3 块区域：</p><ul><li><p>对象头(Header)</p><ul><li><p>第一部分用于存储对象自身的运行时数据，</p><ul><li><p>哈希码</p></li><li><p>GC 分代年龄</p></li><li><p>锁状态标志</p></li><li><p>线程持有的锁</p></li><li><p>偏向线程 ID</p></li><li><p>偏向时间戳等</p><p>32 位虚拟机占 32 bit，64 位虚拟机占 64 bit。官方称为 ‘Mark Word’。</p></li></ul></li><li><p>第二部分是类型指针，即对象指向它的类的元数据指针，虚拟机通过这个指针确定这个对象是哪个类的实例。另外，如果是 Java 数组，对象头中还必须有一块用于记录数组长度的数据，因为普通对象可以通过 Java 对象元数据确定大小，而数组对象不可以。</p></li></ul></li><li><p>实例数据(Instance Data)</p><p>程序代码中所定义的各种类型的字段内容(包含父类继承下来的和子类中定义的)</p></li><li><p>对齐填充(Padding)</p><p>不是必然需要，主要是占位，保证对象大小是某个字节的整数倍。</p></li></ul></li><li><h2 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h2><ol><li><p>句柄访问，通过引用数据来操作堆上的具体对象，java堆中会分配一块内存作为句柄池，引用存储的是句柄地址。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203303019-379365902.jpg"></p></li><li><p>指针访问，引用中直接存对象地址</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203321555-531809965.jpg"></p></li><li><p>比较</p><ol><li>通过句柄访问，引用不用改变，一直是句柄地址，速度慢</li><li>通过指针，引用时常改变，速度快</li></ol></li></ol></li></ol></li><li><h1 id="垃圾回收与分配策略"><a href="#垃圾回收与分配策略" class="headerlink" title="垃圾回收与分配策略"></a>垃圾回收与分配策略</h1><ol><li><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><ol><li>程序计数器、虚拟机栈、本地方法栈 3 个区域随线程生灭(因为是线程私有)，栈中的栈帧随着方法的进入和退出而有条不紊地执行着出栈和入栈操作</li><li>java堆，方法区，共享区，只有在程序处于运行期才知道那些对象会创建，这部分内存的分配和回收都是动态的，垃圾回收期所关注的就是这部分内存。</li></ol></li><li><h3 id="判断对象是否死亡"><a href="#判断对象是否死亡" class="headerlink" title="判断对象是否死亡"></a>判断对象是否死亡</h3><p>回收内存之前首先需要判断那些对象是已经死亡的</p><ol><li><p>引用计数法，给对象添加一个引用计数器。但是难以解决循环引用问题。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203330696-1642151058.jpg"></p></li><li><p>可达性分析法，通过一系列的 ‘GC Roots’ 的对象作为起始点，从这些节点出发所走过的路径称为引用链。当一个对象到 GC Roots 没有任何引用链相连的时候说明对象不可用。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203344788-726823260.jpg"></p><p>可作为 GC Roots 的对象：</p><ul><li><p>虚拟机栈(栈帧中的本地变量表)中引用的对象</p></li><li><p>方法区中类静态属性引用的对象</p></li><li><p>方法区中常量引用的对象</p></li><li><p>本地方法栈中 JNI(即一般说的 Native 方法) 引用的对象</p><p>​        对象在进行中可达性分析后发现没有与 GC Roots 相连接的引用链，那他将会被第一次标记并且进行一次筛选，筛选条件是此对象是否有必要执行 finalize() 方法。当对象没有覆盖 finalize() 方法，或者 finalize() 方法已经被虚拟机调用过，虚拟机将这两种情况都视为“没有必要执行”。<font color=red>没必要执行finalize()表示该对象没用了，可以标记准备回收</font></p><p>​        如果这个对象被判定为有必要执行 finalize() 方法，那么这个对象竟会放置在一个叫做 F-Queue 的队列中，并在稍后由一个由虚拟机自动建立的、低优先级的 Finalizer 线程去执行它。这里所谓的“执行”是指虚拟机会出发这个方法，并不承诺或等待他运行结束。</p><p>​        finalize() 方法是对象逃脱死亡命运的最后一次机会，稍后 GC 将对 F-Queue 中的对象进行第二次小规模的标记，如果对象要在 finalize() 中成功拯救自己 —— 只要重新与引用链上的任何一个对象简历关联即可。若未连接，则回收。</p><p>​    finalize() 方法只会被系统自动调用一次。</p></li></ul></li><li><p>引用</p><ul><li><p>强引用：类似于 <code>Object obj = new Object();</code> 创建的，只要强引用在就不回收。</p></li><li><p>软引用：SoftReference 类实现软引用。在系统要发生内存溢出异常之前，将会把这些对象列进回收范围之中进行二次回收。<font color=red>危急时刻回收</font></p></li><li><p>弱引用：WeakReference 类实现弱引用。对象只能生存到下一次垃圾收集之前。在垃圾收集器工作时，无论内存是否足够都会回收掉只被弱引用关联的对象。<font color=red>第二次扫描到时回收</font></p></li><li><p>虚引用：PhantomReference 类实现虚引用。无法通过虚引用获取一个对象的实例，为一个对象设置虚引用关联的唯一目的就是能在这个对象被收集器回收时收到一个系统通知。</p></li></ul></li><li><p>回收方法区</p><ol><li>在新生代中，一次垃圾回收一般可以回收 70% ~ 95% 的空间，而永久代的垃圾收集效率远低于此。</li><li>永久代垃圾回收主要两部分内容：<ol><li><strong>废弃的常量</strong>：无引用</li><li><strong>无用的类</strong><ul><li>该类所有的实例都已经回收，也就是 Java 堆中不存在该类的任何实例</li><li>加载该类的 ClassLoader 已经被回收</li><li>该类对应的 java.lang.Class 对象没有任何地方呗引用，无法在任何地方通过反射访问该类的方法</li></ul></li></ol></li></ol></li></ol></li><li><h2 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h2><ol><li><p>标记—清除：效率不高，产生大量碎片</p></li><li><p>复制：将空间分为2块，每次对一块gc，将活的对象移动到另一块</p><ol><li>解决了碎片问题</li><li>但空间利用率低，没必要1:1</li><li>分为 eden:survivor:survivor = 8:1:1    每次使用eden与一块survivor，回收时将survivor，eden 转移到另一个survivor， 浪费10%，<font color=red>若存活大于10%，采用分担策略，多余的进入老年代</font></li></ol></li><li><p>标记–整理算法</p><p>​        不同于针对新生代的复制算法，针对老年代的特点，创建该算法。主要是把存活对象移到内存的一端。</p></li><li><p>分代回收</p><p>​        根据存活对象划分几块内存区，一般是分为新生代和老年代。然后根据各个年代的特点制定相应的回收算法。</p><p>新生代：复制算法</p><p>老年代：标记清除，标记整理</p></li></ol></li><li><h2 id="垃圾回收器"><a href="#垃圾回收器" class="headerlink" title="垃圾回收器"></a>垃圾回收器</h2><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203355382-343975726.jpg"></p><ol><li><p>serial收集器：这是一个单线程收集器。意味着它只会使用一个 CPU 或一条收集线程去完成收集工作，并且在进行垃圾回收时必须暂停其它所有的工作线程直到收集结束。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203402203-787755411.jpg"></p></li><li><p>ParNew:多线程serial</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203424350-1175342616.jpg"></p></li><li><p>serial old ：收集器的老年代版本，单线程，使用 <code>标记 —— 整理</code>。</p></li><li><p>Parallel Scavenge 收集器：这是一个新生代收集器，也是使用复制算法实现，尽可能缩短用户等待时间。</p></li><li><p>parallel old：Parallel Scavenge 收集器的老年代版本。多线程，使用 <code>标记 —— 整理</code></p></li><li><p>CMS (Concurrent Mark Sweep) 收集器是一种以获取最短回收停顿时间为目标的收集器。基于 <code>标记 —— 清除</code> 算法实现。</p><ol><li>初始标记(CMS initial mark)：标记 GC Roots 能直接关联到的对象</li><li>并发标记(CMS concurrent mark)：进行 GC Roots Tracing</li><li>重新标记(CMS remark)：修正并发标记期间的变动部分</li><li>并发清除(CMS concurrent sweep)</li></ol><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203430634-2046953604.jpg"></p><p>缺点：对 CPU 资源敏感、无法收集浮动垃圾、<code>标记 —— 清除</code> 算法带来的空间碎片</p></li><li><p>G1 收集器：面向服务端的垃圾收集器</p><p>优点：并行与并发、分代收集、空间整合、可预测停顿。</p><p>运作步骤:</p><ol><li>初始标记(Initial Marking)</li><li>并发标记(Concurrent Marking)</li><li>最终标记(Final Marking)</li><li>筛选回收(Live Data Counting and Evacuation)</li></ol><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203436804-1360769170.jpg"></p></li></ol></li><li><h2 id="内存分配与回收策略"><a href="#内存分配与回收策略" class="headerlink" title="内存分配与回收策略"></a>内存分配与回收策略</h2><p>![<img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203441282-968631081.jpg"></p><ol><li>对象主要分配在新生代的 Eden 区上，如果启动了本地线程分配缓冲区，将线程优先在 (TLAB) 上分配。少数情况会直接分配在老年代中。</li><li>(Minor GC) 发生在新生代的垃圾回收动作，频繁，速度快。</li><li>(Major GC / Full GC) 发生在老年代的垃圾回收动作，出现了 Major GC 经常会伴随至少一次 Minor GC(非绝对)。Major GC 的速度一般会比 Minor GC 慢十倍以上。</li><li>大对象直接进入老年代，长期存活的对象将进入老年代</li></ol></li></ol></li><li><h1 id="java内存模型与线程"><a href="#java内存模型与线程" class="headerlink" title="java内存模型与线程"></a>java内存模型与线程</h1><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203446703-1947862345.jpg"></p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203451183-1961279905.jpg"></p><ol><li><h2 id="主内存和工作内存之间的交互"><a href="#主内存和工作内存之间的交互" class="headerlink" title="主内存和工作内存之间的交互"></a>主内存和工作内存之间的交互</h2><table><thead><tr><th>操作</th><th>对象</th><th>解释</th></tr></thead><tbody><tr><td>lock</td><td>主内存</td><td>把一个变量标识为一条线程独占的状态</td></tr><tr><td>unlock</td><td>主内存</td><td>把一个处于锁定状态的变量释放出来，释放后才可被其他线程锁定</td></tr><tr><td>read</td><td>主内存</td><td>把一个变量的值从主内存传输到线程工作内存中，以便 load 操作使用</td></tr><tr><td>load</td><td>工作内存</td><td>把 read 操作从主内存中得到的变量值放入工作内存中</td></tr><tr><td>use</td><td>工作内存</td><td>把工作内存中一个变量的值传递给执行引擎，每当虚拟机遇到一个需要使用到变量值的字节码指令时将会执行这个操作</td></tr><tr><td>assgin</td><td>工作内存</td><td>把一个从执行引擎接收到的值赋接收到的值赋给工作内存的变量，每当虚拟机遇到一个给变量赋值的字节码指令时执行这个操作</td></tr><tr><td>store</td><td>工作内存</td><td>把工作内存中的一个变量的值传送到主内存中，以便 write 操作</td></tr><tr><td>write</td><td>工作内存</td><td>把 store 操作从工作内存中得到的变量的值放入主内存的变量中</td></tr></tbody></table></li><li><h2 id="对于-volatile-型变量的特殊规则"><a href="#对于-volatile-型变量的特殊规则" class="headerlink" title="对于 volatile 型变量的特殊规则"></a>对于 volatile 型变量的特殊规则</h2><p>关键字 volatile 是 Java 虚拟机提供的最轻量级的同步机制。</p><p>volatile变量</p><ol><li>保证此变量对所有线程的可见性。但是操作并非原子操作，并发情况下不安全。</li><li>禁止指令重排序优化。</li></ol></li><li><h2 id="对于-long-和-double-型变量的特殊规则"><a href="#对于-long-和-double-型变量的特殊规则" class="headerlink" title="对于 long 和 double 型变量的特殊规则"></a>对于 long 和 double 型变量的特殊规则</h2><p>​        Java 要求对于主内存和工作内存之间的八个操作都是原子性的，但是对于 64 位的数据类型，有一条宽松的规定：允许虚拟机将没有被 volatile 修饰的 64 位数据的读写操作划分为两次 32 位的操作来进行，即允许虚拟机实现选择可以不保证 64 位数据类型的 load、store、read 和 write 这 4 个操作的原子性。这就是 long 和 double 的非原子性协定。</p></li></ol></li><li><h1 id="java线程"><a href="#java线程" class="headerlink" title="java线程"></a>java线程</h1><ol><li><h2 id="线程的实现"><a href="#线程的实现" class="headerlink" title="线程的实现"></a>线程的实现</h2><ol><li><p>直接使用内核线程</p><p>​    直接由操作系统内核支持的线程，这种线程由内核完成切换。程序一般不会直接去使用内核线程，而是去使用内核线程的一种高级接口 —— 轻量级进程(LWP)，轻量级进程就是我们通常意义上所讲的线程，每个轻量级进程都有一个内核级线程支持。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203458087-895712238.jpg"></p></li><li><p>用户线程</p><p>​        广义上来说，只要不是内核线程就可以认为是用户线程，因此可以认为轻量级进程也属于用户线程。狭义上说是完全建立在用户空间的线程库上的并且内核系统不可感知的。</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203503627-1880104869.jpg"></p></li><li><p>使用用户线程夹加轻量级进程混合实现</p><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203508834-793073253.jpg"></p></li></ol></li><li><h2 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h2><ol><li>新建(new) ：创建后尚未启动的线程。</li><li>运行(Runable):Runable 包括了操作系统线程状态中的 Running 和 Ready，也就是出于此状态的线程有可能正在执行，也有可能正在等待 CPU 为他分配时间。</li><li>无限期等待(Waiting):出于这种状态的线程不会被 CPU 分配时间，它们要等其他线程显示的唤醒。<ol><li>没有设置 Timeout 参数的 Object.wait() 方法。</li><li>没有设置 Timeout 参数的 Thread.join() 方法。</li><li>LookSupport.park() 方法。</li></ol></li><li>限期等待(Timed Waiting):处于这种状态的线程也不会分配时间，不过无需等待配其他线程显示地唤醒，在一定时间后他们会由系统自动唤醒。<ol><li>Thread.sleep() 方法。</li><li>设置了 Timeout 参数的 Object.wait() 方法。</li><li>设置了 Timeout 参数的 Thread.join() 方法。</li><li>LockSupport.parkNanos() 方法。</li><li>LockSupport.parkUntil() 方法。</li></ol></li><li>阻塞(Blocked):线程被阻塞了，“阻塞状态”和“等待状态”的区别是：“阻塞状态”在等待着获取一个排他锁，这个时间将在另外一个线程放弃这个锁的时候发生；而“等待状态”则是在等待一段时间，或者唤醒动作的发生。在程序等待进入同步区域的时候，线程将进入这种状态。</li><li>结束(Terminated):已终止线程的线程状态。</li></ol><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203515224-1531235464.jpg"></p></li></ol></li><li><h1 id="虚拟机类加载机制"><a href="#虚拟机类加载机制" class="headerlink" title="虚拟机类加载机制"></a>虚拟机类加载机制</h1><ol><li><h2 id="类加载时机"><a href="#类加载时机" class="headerlink" title="类加载时机"></a>类加载时机</h2><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203519417-1080148888.jpg"></p><p>其中加载、验证、准备、初始化和卸载这五个阶段的顺序是确定的。解析阶段可以在初始化之后再开始(运行时绑定或动态绑定或晚期绑定)。</p><p>以下五种情况必须对类进行初始化(而加载、验证、准备自然需要在此之前完成)：</p><ol><li>遇到 new、getstatic、putstatic 或 invokestatic 这 4 条字节码指令时没初始化触发初始化。使用场景：使用 new 关键字实例化对象、读取一个类的静态字段(被 final 修饰、已在编译期把结果放入常量池的静态字段除外)、调用一个类的静态方法。</li><li>使用 java.lang.reflect 包的方法对类进行反射调用的时候。</li><li>当初始化一个类的时候，如果发现其父类还没有进行初始化，则需先触发其父类的初始化。</li><li>当虚拟机启动时，用户需指定一个要加载的主类(包含 main() 方法的那个类)，虚拟机会先初始化这个主类。</li><li>当使用 JDK 1.7 的动态语言支持时，如果一个 java.lang.invoke.MethodHandle 实例最后的解析结果 REF_getStatic、REF_putStatic、REF_invokeStatic 的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需先触发其初始化。</li><li>子类调用父类对象，属性 不会初始化子类，常量在编译期，调入常量池，因此调用时不会初始化</li></ol></li><li><h2 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h2><ol><li><p>加载</p><ol><li>通过一个类的全限定名来获取定义次类的二进制流(ZIP 包、网络、运算生成、JSP 生成、数据库读取)</li><li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li><li>在内存中生成一个代表这个类的 java.lang.Class 对象，作为方法去这个类的各种数据的访问入口</li><li>数组创建过程<ol><li>如果数组的组件类型是引用类型，那就递归采用类加载加载</li><li>如果数组的组件类型不是引用类型，Java 虚拟机会把数组标记为引导类加载器关联。</li><li>组类的可见性与他的组件类型的可见性一致，如果组件类型不是引用类型，那数组类的可见性将默认为 public。</li></ol></li></ol></li><li><p>验证：是连接的第一步，确保 Class 文件的字节流中包含的信息符合当前虚拟机要求。</p><ol><li>文件格式验证<ol><li>是否以魔数 0xCAFEBABE 开头</li><li>主、次版本号是否在当前虚拟机处理范围之内</li><li>常量池的常量是否有不被支持常量的类型（检查常量 tag 标志）</li><li>指向常量的各种索引值中是否有指向不存在的常量或不符合类型的常量</li><li>CONSTANT_Utf8_info 型的常量中是否有不符合 UTF8 编码的数据</li><li>Class 文件中各个部分集文件本身是否有被删除的附加的其他信息</li></ol></li><li>元数据验证<ol><li>这个类是否有父类（除 java.lang.Object 之外）</li><li>这个类的父类是否继承了不允许被继承的类（final 修饰的类）</li><li>如果这个类不是抽象类，是否实现了其父类或接口之中要求实现的所有方法</li><li>类中的字段、方法是否与父类产生矛盾（覆盖父类 final 字段、出现不符合规范的重载）</li></ol></li><li>字节码验证<ol><li>保证任意时刻操作数栈的数据类型与指令代码序列都鞥配合工作（不会出现按照 long 类型读一个 int 型数据）</li><li>保证跳转指令不会跳转到方法体以外的字节码指令上</li><li>保证方法体中的类型转换是有效的（子类对象赋值给父类数据类型是安全的，反过来不合法的）</li></ol></li><li>符号引用验证<ol><li>符号引用中通过字符创描述的全限定名是否能找到对应的类</li><li>在指定类中是否存在符方法的字段描述符以及简单名称所描述的方法和字段</li><li>符号引用中的类、字段、方法的访问性（private、protected、public、default）是否可被当前类访问</li></ol></li></ol></li><li><p>准备：这个阶段正式为类分配内存并设置类变量初始值，内存在方法去中分配(含 static 修饰的变量不含实例变量)。</p><p>public static int value = 1;<br>这句代码在初始值设置之后为 0，因为这时候尚未开始执行任何 Java 方法。而把 value 赋值为 1 的 putstatic 指令是程序被编译后，存放于 clinit() 方法中，所以初始化阶段才会对 value 进行赋值。</p><p>char=’\u0000’ boolean=false</p></li><li><p>解析：这个阶段是虚拟机将常量池内的符号引用替换为直接引用的过程。</p><ol><li>符号引用<br>符号引用以一组符号来描述所引用的目标，符号可以使任何形式的字面量。</li><li>直接引用<br>直接引用可以使直接指向目标的指针、相对偏移量或是一个能间接定位到目标的句柄。直接引用和迅疾的内存布局实现有关</li></ol><p>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符 7 类符号引用进行，分别对应于常量池的 7 中常量类型。</p></li><li><p>初始化：前面过程都是以虚拟机主导，而初始化阶段开始执行类中的 Java 代码。</p></li></ol></li><li><h2 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h2><ol><li><p>通过一个类的全限定名来获取描述此类的二进制字节流。</p></li><li><p>双亲委派模型</p><p>从 Java 虚拟机角度讲，只存在两种类加载器：一种是启动类加载器（C++ 实现，是虚拟机的一部分）；另一种是其他所有类的加载器（Java 实现，独立于虚拟机外部且全继承自 java.lang.ClassLoader）</p><ol><li>启动类加载器：加载 lib 下或被 -Xbootclasspath 路径下的类</li><li>扩展类加载器：加载 lib/ext 或者被 java.ext.dirs 系统变量所指定的路径下的类</li><li>引用程序类加载器：ClassLoader负责，加载用户路径上所指定的类库。</li></ol></li></ol><p><img src="https://img2018.cnblogs.com/blog/1333782/202001/1333782-20200120203529618-1408024469.jpg"></p></li><li><p>除顶层启动类加载器之外，其他都有自己的父类加载器。<br>工作过程：如果一个类加载器收到一个类加载的请求，它首先不会自己加载，而是把这个请求委派给父类加载器。只有父类无法完成时子类才会尝试加载。</p></li><li><p>破坏双亲委派模型</p><p>keyword：线程上下文加载器(Thread Context ClassLoader)</p></li></ol></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/jenkins%E5%9F%BA%E7%A1%80/"/>
    <url>/2022/01/16/cnblog/jenkins%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是持续集成"><a href="#什么是持续集成" class="headerlink" title="什么是持续集成"></a>什么是持续集成</h1><ul><li>Continuous integration（CI） ：频繁地将代码集成到主干<ul><li>快速发现错误</li><li>防止分支大幅度偏离</li></ul></li></ul><p><img src="https://i.loli.net/2020/09/06/yrUKnORFwl9xj5G.png" alt="image-20200906195403844"></p><ul><li>Continuous delivery(CD)：持续交付</li></ul><p><img src="https://i.loli.net/2020/09/06/SMCFmZX6fLhuwVE.png" alt="image-20200906195527551"></p><ul><li>持续部署：continuous deployment</li></ul><h1 id="持续集成的操作流程"><a href="#持续集成的操作流程" class="headerlink" title="持续集成的操作流程"></a>持续集成的操作流程</h1><ul><li>提交 commit</li><li>测试<ul><li>代码仓库对commit设置了hook，提交后进行自动化测试</li><li>单元测试</li><li>集成测试</li><li>端对端测试</li></ul></li><li>构建 <ul><li>java变为class，配置资源等</li></ul></li><li>二次测试</li><li>部署</li><li>回滚</li></ul><h1 id="jenkins简介"><a href="#jenkins简介" class="headerlink" title="jenkins简介"></a>jenkins简介</h1><ul><li>持续集成与交付，简易安装，配置简单，插件扩展，分布式工作</li><li>是一个java 项目 <ul><li>java -jar nins.war运行，无需数据库</li></ul></li></ul><h1 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">docker</span><br>docker pull jekins/jekins:lts<br>docker run -di --name=jekins -p 8080:8080 -v /root/jenkins:/var/jenkins_home jenkins/jenkins:lts<br><span class="hljs-meta">#</span><span class="bash"> war</span><br>wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war<br>java -jar jenkins.war --httpPort=8089 --httpListenAddress=0.0.0.0<br><span class="hljs-meta">#</span><span class="bash"> 密码在日志中，</span><br></code></pre></td></tr></table></figure><ul><li>安装ssh插件</li><li>配置jdk，maven环境，配置maven地址  default.json中</li><li>配置ssh</li><li>部署应用</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/jekins/"/>
    <url>/2022/01/16/cnblog/jekins/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是持续集成"><a href="#什么是持续集成" class="headerlink" title="什么是持续集成"></a>什么是持续集成</h1><ul><li>Continuous integration（CI） ：频繁地将代码集成到主干<ul><li>快速发现错误</li><li>防止分支大幅度偏离</li></ul></li></ul><p><img src="https://i.loli.net/2020/09/06/yrUKnORFwl9xj5G.png" alt="image-20200906195403844"></p><ul><li>Continuous delivery(CD)：持续交付</li></ul><p><img src="https://i.loli.net/2020/09/06/SMCFmZX6fLhuwVE.png" alt="image-20200906195527551"></p><ul><li>持续部署：continuous deployment</li></ul><h1 id="持续集成的操作流程"><a href="#持续集成的操作流程" class="headerlink" title="持续集成的操作流程"></a>持续集成的操作流程</h1><ul><li>提交 commit</li><li>测试<ul><li>代码仓库对commit设置了hook，提交后进行自动化测试</li><li>单元测试</li><li>集成测试</li><li>端对端测试</li></ul></li><li>构建 <ul><li>java变为class，配置资源等</li></ul></li><li>二次测试</li><li>部署</li><li>回滚</li></ul><h1 id="jenkins简介"><a href="#jenkins简介" class="headerlink" title="jenkins简介"></a>jenkins简介</h1><ul><li>持续集成与交付，简易安装，配置简单，插件扩展，分布式工作</li><li>是一个java 项目 <ul><li>java -jar nins.war运行，无需数据库</li></ul></li></ul><h1 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">docker</span><br>docker pull jekins/jekins:lts<br>docker run -di --name=jekins -p 8080:8080 -v /root/jenkins:/var/jenkins_home jenkins/jenkins:lts<br><span class="hljs-meta">#</span><span class="bash"> war</span><br>wget http://mirrors.jenkins.io/war-stable/latest/jenkins.war<br>java -jar jenkins.war --httpPort=8089 --httpListenAddress=0.0.0.0<br><span class="hljs-meta">#</span><span class="bash"> 密码在日志中，</span><br></code></pre></td></tr></table></figure><ul><li>安装ssh插件</li><li>配置jdk，maven环境，配置maven地址  default.json中</li><li>配置ssh</li><li>部署应用</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/jdk1.8HashMap/"/>
    <url>/2022/01/16/cnblog/jdk1.8HashMap/</url>
    
    <content type="html"><![CDATA[<h1 id="JDK1-8中HashMap实现"><a href="#JDK1-8中HashMap实现" class="headerlink" title="JDK1.8中HashMap实现"></a>JDK1.8中HashMap实现</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105210946706-1005779208.png" alt="img"></p><p>JDK1.8中的HashMap实现跟JDK1.7中的实现有很大差别。下面分析JDK1.8中的实现，主要看put和get方法。</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105211214612-1600246620.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105211230221-717831562.png" alt="img"></p></blockquote><p>构造方法的时候并没有初始化，而是在第一次put的时候初始化</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105213011612-786504547.png" alt="img"></p></blockquote><p>putVal方法的主要逻辑是这样的：</p><p>1、如果数组还没有初始化（数组长度是0），则先初始化</p><p>2、通过hash方法计算key的hash值，进而计算得到应该放置到数组的位置</p><p>3、如果该位置为空，则直接放置此处</p><p>4、如果该位置不为空，而且元素是红黑树，则插入到其中</p><p>5、如果是链表，则遍历链表，如果找到相等的元素则替换，否则插入到链表尾部</p><p>6、如果链表的长度大于或等于8，则将链表转成红黑树</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105220639909-705029222.png" alt="img"></p></blockquote><p>1、计算hash求位置</p><p>2、看第一个元素是不是要找的，是则返回，否则遍历</p><blockquote><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/874963-20180105222152128-94783362.png" alt="img"></p></blockquote><p>扩容就是将旧数组的元素移动到新数组</p><p>总结：</p><p>1、HashMap底层是用数组+双向链表+红黑树实现的</p><p>2、插入元素的时候，首先通过一个hash方法计算得到key的哈希值，进而计算出待插入的位置</p><p>3、如果该位置为空，则直接插入（包装成Node）</p><p>4、如果该位置有值，则依次遍历。比较的规则是，hash值相同，key值相等的元素视为相同，则用新值替换旧值并返回旧值。</p><p>5、如果该位置的元素是红黑树结构，则同理，查找，找到则替换，没找到则插入。</p><p>划重点：</p><p>JDK1.8中HashMap与JDK1.7中有很多地方不一样</p><p>1、1.8中引入了红黑树，而1.7中没有</p><p>2、1.8中元素是插在链表的尾部，而1.7中新元素是插在链表的头部</p><p>3、扩容的时候，1.8中不会出现死循环，而1.7中容易出现死循环，而且链表不会倒置</p><p>来源:<a href="https://www.cnblogs.com/cjsblog/p/8207211.html">https://www.cnblogs.com/cjsblog/p/8207211.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/jdbc/"/>
    <url>/2022/01/16/cnblog/jdbc/</url>
    
    <content type="html"><![CDATA[<p>jdbc.driver=com.mysql.jdbc.Driver<br />jdbc.url=jdbc:mysql://localhost:3306/dangdang<br />jdbc.username=root<br />jdbc.password=root</p><p>----------------------------------------------------------------</p><p>class.forName(oracle.jdbc.OracleDriver)<br />jdbc:oracle:thin:@localhost:1521:xe<br />"com.mysql.jdbc.Driver"<br />jdbc:mysql://localhost:3306/student</p><p>JDBC <br />一,JDBC内容<br />    接口:sun定义 java.sql 和javax.sql<br />    实现类:数据库厂商提供<br />二,jdbc使用<br />    1,如何使用jar<br />        --dos使用<br />            classpath中添加jar路径<br />    2,jdbc流程<br />        a:注册驱动类<br />        b:创建链接<br />        c:创建statement(不常用)<br />        d:执行sql<br />        e:处理结果<br />        f:释放资源statement 也要close<br />        get列时序号从1开始<br />    3,prepareStatementjava.sql statement子接口<br />        PrepareStatement ps =conn.prepareStatement(sql);<br />        ps.setxxx(1,name)<br />        ps.setxxx(2,password)<br />        ps.exq exu (使用午餐的构造)<br />        里面的参数不用拼接<br />        在执行前时插入<br />    4.两者区别<br />    state = com.cre...<br />    stat.execute(sql)<br />    不安全,有注入<br />    prep = conn.create..(sql)<br />    prep.execute()<br />    无sql注入,切性能更高<br />            服务器操作<br />            1检查权限,<br />            2检查语法<br />            3,sql转化为内部指令 前三是编译过程<br />            4,执行指令<br />            statement创建成功时不发送sql,执行时发送<br />            例:for(int i=0;i&lt;10;i++{<br />            stat.ex(insert...)  <br />            }<br />            prep 可只把setxxx写在for循环中<br />            只用编译一次即可,所以说也叫作预编译语句<br />    stat:异构sql<br />    prep:同构sql(只有参数不同<br />日期转换：日期转换 strDate --- util.Date---sql.Date<br />//插入或修改字段的类型是时间类型Date时，需要使用时间转换<br />//<br />1.设置格式，格式应与字符串相匹配。和数据库中to_date方法类似<br />SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");<br />//<br />2.strDate--util.Date<br />Date util<br />Date = format.parse(strDate);<br />//<br />3.util.Date---sql.Date<br />java.sql.Date date = new java.sql.Date(utilDate.getTime());</p><p><br />1.事务控制 <br />    JDBC默认的是自动的事务提交<br />    <br />相关API：控制事务提交的对象为连接 Connection<br />        <br />//设置事务提交方式为手动<br />        <br />conn.setAutoCommit(false)；//true---自动提交   false---手动提交<br />        <br />//事务提交<br />        conn.commit();<br />        <br />//事务回滚<br />        conn.rollback();</p><p>2.业务类方法的书写步骤<br />    <br />//1.获取Connection<br />    conn = JdbcUtil2.getConnection();<br />    <br />System.out.println("这是service获得连接："+conn);<br />    <br />//2.设置事务提交为手动提交<br />    conn.setAutoCommit(false);    <br />    <br />//3.调用DAO中的方法完成业务操作<br />    dao.insert(clazz);<br />    <br />//4.提交事务 or 回滚事务<br />    conn.commit();<br />    <br />conn.rollback</p><p>3.当前的事务控制存在问题<br />    <br />首先service层获得的连接与Dao不是一条 其次通过单例可以解决这样的问题，但是会存在线程不安全的情况。<br />    <br />为了解决线程安全，且可以控制事务的问题<br />    我们需要使用线程局部表变量，ThreadLocal<br />~~~</p><p>#### <br />九、线程局部变量</p><p>~~~java<br />线程局部变量，再多线程环境下，可以为每个使用该变量的线程 分配线程内部独有的 线程变量值。</p><p>1.API:<br />    ThreadLocal th = new ThreadLocal();<br />    <br />th.set（obj）;//往线程局部变量中设置<br />    <br />obj = th.get();//返回该线程局变量的值<br />    <br />th.remove()；//移除该线程局变量的值</p><p>2.作用：<br />    1）保证 同一个线程内部 使用相同的值<br />    2）保证不用线程使用不用的值</p><p>3.原理：<br />    当调用 set方法时，会将当前线程对象当做Key，将set中的参数当做value 放入到一个map集合中 ，这个集合由Thread进行管理的。<br />当使用get方法时，以当前线程为key来向该map集合取值。</p><p>4.使用ThreadLoacl来修改getConnection方法<br />    //创建连接的方法<br />    <br />private static ThreadLocal&lt;Connection&gt; th = new ThreadLocal&lt;Connection&gt;();<br />    <br />public static Connection getConnection(){<br />        <br />Connection conn = th.get();<br />        <br />if(conn==null){//如果为空就创建<br />            <br />//1.注册驱动<br />            <br />try {<br />                <br />Class.forName(p.getProperty("driver"));<br />            <br />//2.建立连接<br />                <br />conn = DriverManager.getConnection(p.getProperty("url"),p.getProperty("username"),p.getProperty("password"));<br />        <br />    //3.并把连接放入ThreadLocal<br />                <br />th.set(conn);<br />            </p><p>} catch (Exception e) {<br />                // TODO Auto-generated catch block<br />                <br />e.printStackTrace();<br />            }<br />        }<br />        <br />return conn;<br />    }</p><p>if(conn!=null){<br />    <br />        try {<br />                <br />conn.close();<br />                th.remove();<br />            } catch (SQLException e) {<br />            <br />    // TODO Auto-generated catch block<br />                e.printStackTrace();<br />            }<br />        }</p><p><br />注意：1)在控制事务时，dao内不要关闭连接<br />    <br />2)在关闭连接后，要清空线程局部变量中的废连接<br />~~~</p><p>#### <br />十、JDBC的</p><p>分层分包：</p><p>都在域名倒写的包下 比如 com.zzu.xjh</p><p><br />1）sql  存放了关于该项目相关的一些sql语句文档</p><p><br />2）conf 放置了配置文件</p><p><br />3）util 放置了该项目的工具类</p><p><br />4）test 放置了该项目相关的测试类</p><p><br />5）entity 放置了该项目的实体类</p><p><br />6）dao 放置该项目的DAO接口  在该包下应有一个impl包 里面放置 对应dao的实现类</p><p><br />7）service 放置该项目的service 接口  在该包下应有一个impl包 里面放置 对应service 的实现类</p><p><br />8）conroller/action 放置该项目的控制器</p><p><br />9）view （可能出现）</p><div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:java;gutter:true;">import java.sql.Connection;import java.sql.PreparedStatement;import java.sql.ResultSet;import java.util.ArrayList;import java.util.List;<p>public class JdbcTemplate&lt;T&gt; {<br>    /*<br>     * 专门完成增 删 改操作<br>     *<br>     * insert into t_user (id,name,password) values (suns_seq.nextval,?,?);<br>     *<br>     * jdbcTemplate.update(sql,new Object[]{“suns”,”123456”});<br>     *<br>     * delete from t_user where id = ?<br>     *<br>     * jdbcTemplate.delete(sql,new Object[]{1});<br>     *<br>     * update t_product set name=?,price=? where id = ?<br>     *<br>     * jdbcTemplate.update(sql,new Object[]{“suns”,10.2,1});<br>     *<br>     * 可变长参数  1 等同于数组<br>     *          2 只能放在参数表最后 ，只能有一个<br>     *<br>     *  “delete from t_user where id = 10”;<br>     *<br>     */<br>    public void update(String sql,Object… args){<br>        Connection conn = null;<br>        PreparedStatement pstmt = null;<br>        try{<br>            conn = JDBCUtil.getConnection();<br>            pstmt = conn.prepareStatement(sql);</p><pre><code class="hljs">        if(hasUpdateParam(args))&#123;           for(int i=0;i&amp;lt;args.length;i++)&#123;             pstmt.setObject(i+1,args[i]);           &#125;        &#125;                   pstmt.executeUpdate();    &#125;catch(Exception e)&#123;        e.printStackTrace();    &#125;finally&#123;        JDBCUtil.close(null, pstmt);    &#125;    &#125;private boolean hasUpdateParam(Object... args) &#123;    return args.length!=0;&#125;public List&amp;lt;T&amp;gt; query(String sql,RowMapper&amp;lt;T&amp;gt; rowMapper,Object... args)&#123;    Connection conn = null;    PreparedStatement pstmt = null;    ResultSet rs = null;    List&amp;lt;T&amp;gt; rets = new ArrayList&amp;lt;T&amp;gt;();    try&#123;        conn = JDBCUtil.getConnection();        pstmt = conn.prepareStatement(sql);        if(hasUpdateParam(args))&#123;             for(int i=0;i&amp;lt;args.length;i++)&#123;            pstmt.setObject(i+1, args[i]);          &#125;        &#125;        rs = pstmt.executeQuery();        while(rs.next())&#123;             T ret = rowMapper.mapRow(rs);             rets.add(ret);        &#125;        return rets;    &#125;catch(Exception e)&#123;        e.printStackTrace();        return null;    &#125;finally&#123;        JDBCUtil.close(null, pstmt, rs);    &#125;&#125;public T queryForObject(String sql,RowMapper&amp;lt;T&amp;gt; rowMapper,Object... args)&#123;    Connection conn = null;    PreparedStatement pstmt = null;    ResultSet rs = null;    T ret = null;    try&#123;        conn = JDBCUtil.getConnection();        pstmt = conn.prepareStatement(sql);        if(hasUpdateParam(args))&#123;             for(int i=0;i&amp;lt;args.length;i++)&#123;            pstmt.setObject(i+1, args[i]);          &#125;        &#125;        rs = pstmt.executeQuery();        if(rs.next())&#123;            ret = rowMapper.mapRow(rs);        &#125;        return ret;    &#125;catch(Exception e)&#123;        e.printStackTrace();        return null;    &#125;finally&#123;        JDBCUtil.close(null, pstmt, rs);    &#125;&#125;</code></pre></div><p>}<br /><br /><br></pre></p></div><p>　　</p><div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.IOException;</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.io.InputStream;</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;<p></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.DriverManager;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.PreparedStatement;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.ResultSet;<br></span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.util.Properties;</p><p></span><span style="color: #008000;">/*</span><span style="color: #008000;"></p><ul><li>性能 效率 内存使用</li><li>维护性 （便于修改）</li><li>基本功能<br></span><span style="color: #008000;">*/</span></li></ul><p><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> JDBCUtil {<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> Properties p = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Properties();<br>    </span><span style="color: #0000ff;">private</span> <span style="color: #0000ff;">static</span> ThreadLocal&lt;Connection&gt; tl = <span style="color: #0000ff;">new</span> ThreadLocal&lt;Connection&gt;<span style="color: #000000;">();</p><pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;    &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;1 读入Properties文件&lt;/span&gt;      InputStream is = JDBCUtil.&lt;span style=&quot;color: #0000ff;&quot;&gt;class&lt;/span&gt;.getResourceAsStream(&quot;/jdbc.properties&quot;&lt;span style=&quot;color: #000000;&quot;&gt;);     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;2 传入Properties集合&lt;/span&gt;      &lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;        p.load(is);    &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (IOException e) &#123;        &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();<br>        }<br>    }</p><div class="code-wrapper"><pre><code class="hljs">&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;创建连接&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; Connection getConnection() &lt;span style=&quot;color: #0000ff;&quot;&gt;throws&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; Exception&#123;      Connection conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; tl.get();      &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn==&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;)&#123;          Class.forName(p.getProperty(&lt;/span&gt;&quot;driver&quot;&lt;span style=&quot;color: #000000;&quot;&gt;));          conn &lt;/span&gt;= DriverManager.getConnection(p.getProperty(&quot;url&quot;),p.getProperty(&quot;username&quot;),p.getProperty(&quot;password&quot;&lt;span style=&quot;color: #000000;&quot;&gt;));          tl.set(conn);            &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; conn;      &#125;      &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; conn;&#125;&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;关闭资源&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; close(Connection conn,PreparedStatement pstmt,ResultSet rs)&#123;    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(rs!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;rs.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(pstmt!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;pstmt.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;conn.close();tl.remove();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;&#125;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;static&lt;/span&gt; &lt;span style=&quot;color: #0000ff;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; close(Connection conn,PreparedStatement pstmt)&#123;    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(pstmt!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;pstmt.close();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;    &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;if&lt;/span&gt;(conn!=&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;)&#123;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&#123;conn.close();tl.remove();&#125;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;(Exception e)&#123;&#125;&#125;&#125;</code></pre></div><p>}</span></pre></p></div><p>&nbsp;</p><p>1:1,一般是双向关系<br />建实体类时,两边都建<br /> 但建表时只有一个外键,建在不主要一方<br /> 定义表时,定义外键,做唯一<br />     private Integer id;<br />    private String name;<br />    private String password;<br />    private Date birthday;<br />    private PassPort passport;<br />    ---------------------------<br />        private Integer id;<br />    private String serial;<br />    private Integer expire;<br />    private Person person;<br />    ----------------------------<br /> create table t_person(<br />id integer primary key,<br />name varchar(12),<br />password varchar(12),<br />birthday date<br />);<br />create table t_passport(<br />id integer primary key,<br />serial varchar(12),<br />expire varchar(12),<br />person_id integer unique references t_person(id) <br />);<br />--------------------------------------------------------------------------------------------<br />&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br />&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" &gt;<br />&lt;mapper namespace="com.dzf.dao.o2o.PersonDao"&gt;</p><p>    &lt;resultMap id="personResultMap" type="Person" &gt;<br />        &lt;id property="id" column="person_id"/&gt;<br />        &lt;result property="name" column="person_name"/&gt;<br />        &lt;result property="password" column="person_password"/&gt;<br />        &lt;result property="birthday" column="person_birthday"/&gt;<br />        &lt;!-- 当只有passport一个对象 --&gt;<br />        &lt;association property="passport" javaType="PassPort"&gt;<br />            &lt;id property="id" column="passport_id"&gt;&lt;/id&gt;<br />            &lt;result property="serial" column="passport_serial"/&gt;<br />            &lt;result property="expire" column="passport_expire"/&gt;<br />        &lt;/association&gt;<br />    &lt;/resultMap&gt;<br />     &lt;select id="queryPersonById" resultMap="personResultMap"&gt;<br />         select p.id as person_id,p.name as person_name,p.password as person_password,p.birthday as person_birthday<br />         ,pp.id as passport_id,pp.serial as passport_serial,pp.expire as passport_expire<br />         from t_person p inner join t_passport pp<br />         on p.id = pp.person_id<br />         where p.id = #{id}<br />     &lt;/select&gt;<br />&lt;/mapper&gt;</p><p>----------------------------------------------<br />n:1<br /> 多对一单向<br />private Integer id;<br />    private String name;<br />    private Double salary;<br />    private Dept dept;<br />private Integer id;<br />    private String code;<br />    private String name;<br />create  table t_employee(<br />  id integer primary key,<br />  name varchar(12),<br />  salary decimal(12,2),<br />  dept_id integer references t_dept(id)<br />  );<br />  create table t_dept(<br />  id integer primary key,<br />  code varchar(12),<br /> name varchar(12) <br /> );<br />&lt;resultMap id="employeeResultMap" type="Employee" &gt;<br />        &lt;id property="id" column="employee_id"/&gt;<br />        &lt;result property="name" column="employee_name"/&gt;<br />        &lt;result property="salary" column="employee_salary"/&gt;<br />        &lt;association property="dept" javaType="Dept"&gt;<br />            &lt;id property="id" column="dept_id"&gt;&lt;/id&gt;<br />            &lt;result property="code" column="dept_code"/&gt;<br />            &lt;result property="name" column="dept_name"/&gt;<br />        &lt;/association&gt;<br />    &lt;/resultMap&gt;<br />     &lt;select id="queryEmployeeByName" resultMap="employeeResultMap"&gt;<br />         select e.id as employee_id,e.name as employee_name,e.salary as employee_salary,<br />         d.id as dept_id,d.code as dept_code,d.name as dept_name<br />         from t_employee e inner join t_dept d<br />         on e.dept_id = d.id<br />         where e.name = #{name}<br />     &lt;/select&gt;<br /> &lt;select id="queryDeptById" resultType="Dept"&gt;<br />         select id,name,code<br />         from t_dept<br />         where id = #{id}<br />     &lt;/select&gt;<br />--------------------------------------------------------------------------------------------------------------<br />1:n单向(n:1注意更换时 表不用改,表天生是双向的,俩表就一外键,在多的一方)<br />private Integer id;<br />    private String name;<br />    private Double salary;<br />private Integer id;<br />    private String code;<br />    private String name;<br />    private List&lt;Employee&gt; list = new ArrayList&lt;Employee&gt;();记得初始化<br /> &lt;resultMap id ="deptResultMap" type="Dept" &gt;<br />          &lt;id property="id" column = "dept_id"/&gt;<br />          &lt;result property = "code" column="dept_code"/&gt;<br />          &lt;result property = "name" column="dept_name"/&gt;<br />          &lt;collection property="list" ofType="Employee"&gt;&lt;!-- 集合中元素类型 --&gt;<br />              &lt;id property="id" column="employee_id"/&gt;<br />            &lt;result property="name" column="employee_name"/&gt;<br />            &lt;result property="salary" column="employee_salary"/&gt;<br />          &lt;/collection&gt;<br />      &lt;/resultMap&gt;<br />      &lt;select id="queryDeptByName" resultMap="deptResultMap"&gt;<br />         select d.id as dept_id ,d.code as dept_code,d.name as dept_name,<br />         e.id as employee_id,e.name as employee_name,e.salary as employee_salary<br />         from t_dept d inner join t_employee e<br />         on d.id = e.dept_id<br />         where d.name = #{name}<br />     &lt;/select&gt;<br />&lt;select id="queryEmployeeById" resultType="Employee"&gt;<br />         select id,name,salary <br />         from t_employee<br />         where id= #{id}<br />     &lt;/select&gt;<br />-----------------------------------------------------------------------------------------------------------------<br />多对多双向,student,course<br />外键如何建?,不能建, <br />解决办法:引入第三张关系表</p><p>______________________________________________________________________</p><div class="cnblogs_code"><div class="code-wrapper"><pre><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.Connection;</span><span style="color: #0000ff;">import</span><span style="color: #000000;"> java.sql.SQLException;<p></span><span style="color: #008000;">/*</span><span style="color: #008000;"></p><ul><li><p>事务管理器 用于控制事务<br></span><span style="color: #008000;">*/</span><br><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">class</span><span style="color: #000000;"> TransactionManager {</p><p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> begin(){</p><pre><code class="hljs"> &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;     Connection conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();     conn.setAutoCommit(&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;); &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125;</code></pre></div><p> }</p><p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> commit(){</p><div class="code-wrapper"><pre><code class="hljs"> Connection conn &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;     conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();     conn.commit(); &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;finally&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;     JDBCUtil.close(conn, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;); &#125;  </code></pre></div><p> }</p><p> </span><span style="color: #0000ff;">public</span> <span style="color: #0000ff;">static</span> <span style="color: #0000ff;">void</span><span style="color: #000000;"> rollback(){</p><div class="code-wrapper"><pre><code class="hljs"> Connection conn &lt;/span&gt;= &lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;try&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; &#123;     conn &lt;/span&gt;=&lt;span style=&quot;color: #000000;&quot;&gt; JDBCUtil.getConnection();     conn.rollback(); &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (SQLException e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125; &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;catch&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt; (Exception e) &#123;     &lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: #008000;&quot;&gt; TODO Auto-generated catch block&lt;/span&gt;</code></pre></div><p><span style="color: #000000;">            e.printStackTrace();</p><div class="code-wrapper"><pre><code class="hljs"> &#125;&lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;finally&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;&#123;     JDBCUtil.close(conn, &lt;/span&gt;&lt;span style=&quot;color: #0000ff;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #000000;&quot;&gt;); &#125; </code></pre></div><p> }</p></li></ul><p>}</span></pre></p></div><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/JAVA%20%E7%BA%BF%E7%A8%8B/"/>
    <url>/2022/01/16/cnblog/JAVA%20%E7%BA%BF%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<p><a href="https://dean0731.top/post/6">多线程</a><br><a href="https://dean0731.top/post/7">多线程进阶</a><br><a href="https://static.dean0731.top/pdf/java/java_juc.pdf">多线程文档</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
    <url>/2022/01/16/cnblog/Java%20%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<div class="cnblogs_Highlighter"><div class="code-wrapper"><pre class="brush:java;gutter:true;">import java.io.Serializable;<p>// 修改后的单例模式</p><p>// 使用线程同步创建，防止进程切换重复创建线程，<br>// 设置volatile关键字修饰，使读取singleton对象时能够获取最新状态<br>// 修改构造方法，防止反射创建对象<br>// 修改readResolve方法，防止反序列化对象时重新创建对象<br>// 重写克隆方法，防止对象克隆<br>public class Singleton2 implements Serializable, Cloneable {<br>    private static volatile Singleton2 singleton;</p><pre><code class="hljs">private Singleton2() &#123;    if (singleton != null) &#123;        throw new RuntimeException(&quot;对象已被创建&quot;);    &#125;&#125;public static Singleton2 getInstance() &#123;    if (singleton == null) &#123;        synchronized (singleton) &#123;            if (singleton == null)                singleton = new Singleton2();        &#125;    &#125;    return singleton;&#125;private Object readResolve() &#123;    return singleton;&#125;@Overrideprotected Object clone() throws CloneNotSupportedException &#123;    return getInstance();&#125;</code></pre></div><p>}<br>&copy; 2020 GitHub, Inc.<br></pre></p></div><p>　　</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/ImageDataGenerator/"/>
    <url>/2022/01/16/cnblog/ImageDataGenerator/</url>
    
    <content type="html"><![CDATA[<h1 id="ImageDataGenerator类的定义以及构造函数的参数详解"><a href="#ImageDataGenerator类的定义以及构造函数的参数详解" class="headerlink" title="ImageDataGenerator类的定义以及构造函数的参数详解"></a>ImageDataGenerator类的定义以及构造函数的参数详解</h1><h2 id="ImageDataGenerator类的简单介绍"><a href="#ImageDataGenerator类的简单介绍" class="headerlink" title="ImageDataGenerator类的简单介绍"></a>ImageDataGenerator类的简单介绍</h2><ul><li>Generate batches of tensor image data with real-time data augmentation.The data will be looped over (in batches).</li></ul><h2 id="这个类是做什么用的？"><a href="#这个类是做什么用的？" class="headerlink" title="这个类是做什么用的？"></a>这个类是做什么用的？</h2><ul><li><p>通过实时数据增强生成张量图像数据批次，并且可以循环迭代，</p></li><li><p>我们知道在Keras中，当数据量很多的时候我们需要使用model.fit_generator()方法，该方法接受的第一个参数就是一个生成器。</p></li><li><p>简单来说就是：ImageDataGenerator()是keras.preprocessing.image模块中的图片生成器，可以每一次给模型“喂”一个batch_size大小的样本数据，</p></li><li><p>同时也可以在每一个批次中对这batch_size个样本数据进行增强，扩充数据集大小，增强模型的泛化能力。比如进行旋转，变形，归一化等等。</p><p>总结起来就是两个点：</p><ul><li>图片生成器，负责生成一个批次一个批次的图片，以生成器的形式给模型训练；</li><li>对每一个批次的训练图片，适时地进行数据增强处理（data augmentation）；</li></ul></li></ul><h2 id="数据增强处理（data-augmentation）"><a href="#数据增强处理（data-augmentation）" class="headerlink" title="数据增强处理（data augmentation）"></a>数据增强处理（data augmentation）</h2><ul><li>数据增强的手段有非常多种，这里指说一些代表性的。<ul><li>旋转 | 反射变换(Rotation/reflection): 随机旋转图像一定角度; 改变图像内容的朝向;</li><li>翻转变换(flip): 沿着水平或者垂直方向翻转图像;</li><li>缩放变换(zoom): 按照一定的比例放大或者缩小图像;</li><li>平移变换(shift): 在图像平面上对图像以一定方式进行平移;可以采用随机或人为定义的方式指定平移范围和平移步长, 沿水平或竖直方向进行平移. 改变图像内容的位置;</li><li>尺度变换(scale): 对图像按照指定的尺度因子, 进行放大或缩小; 或者参照SIFT特征提取思想, 利用指定的尺度因子对图像滤波构造尺度空间. 改变图像内容的大小或模糊程度;</li><li>对比度变换(contrast): 在图像的HSV颜色空间，改变饱和度S和V亮度分量，保持色调H不变. 对每个像素的S和V分量进行指数运算(指数因子在0.25到4之间), 增加光照变化;</li><li>噪声扰动(noise): 对图像的每个像素RGB进行随机扰动, 常用的噪声模式是椒盐噪声和高斯噪声;</li><li>错切变换（shear）：效果就是让所有点的x坐标(或者y坐标)保持不变，而对应的y坐标(或者x坐标)则按比例发生平移，且平移的大小和该点到x轴(或y轴)的垂直距离成正比。</li></ul></li></ul><h1 id="ImageDataGenerator类的构造函数参数"><a href="#ImageDataGenerator类的构造函数参数" class="headerlink" title="ImageDataGenerator类的构造函数参数"></a>ImageDataGenerator类的构造函数参数</h1><ul><li><p>featurewise_center: 布尔值。将输入数据的均值设置为 0，逐特征进行，对输入的图片每个通道减去每个通道对应均值。</p></li><li><p>samplewise_center: 布尔值。将每个样本的均值设置为 0，每张图片减去样本均值, 使得每个样本均值为0</p></li><li><p>featurewise_std_normalization: Boolean. 布尔值。将每个输入（即每张图片）除以数据集（dataset）标准差，逐特征进行。</p></li><li><p>samplewise_std_normalization: 布尔值。将每个输入（即每张图片）除以其自身（图片本身）的标准差。</p><ul><li>这里需要注意两个概念，所谓 featurewise指的是逐特征，它针对的是数据集dataset，</li><li>而samplewise针对的是单个输入图片的本身。</li><li>featurewise是从整个数据集的分布去考虑的，而samplewise只是针对自身图片 。</li></ul></li><li><p>zca_epsilon: ZCA 白化的 epsilon 值，默认为 1e-6。</p></li><li><p>zca_whitening: 布尔值。是否应用 ZCA 白化。</p></li><li><p>rotation_range: 整数。随机旋转的度数范围。</p></li><li><p>width_shift_range: 它的值可以是浮点数、一维数组、整数</p><ul><li>float: 如果 &lt;1，则是除以总宽度的值，或者如果 &gt;=1，则为像素值。</li><li>1-D 数组: 数组中的随机元素。</li><li>int: 来自间隔 (-width_shift_range, +width_shift_range) 之间的整数个像素。</li><li>width_shift_range=2 时，可能值是整数 [-1, 0, +1]，与 width_shift_range=[-1, 0, +1] 相同；而 width_shift_range=1.0 时，可能值是 [-1.0, +1.0) 之间的浮点数。</li></ul></li><li><p>height_shift_range: 浮点数、一维数组或整数（同width_shift_range）</p><ul><li>float: 如果 &lt;1，则是除以总宽度的值，或者如果 &gt;=1，则为像素值。</li><li>1-D array-like: 数组中的随机元素。</li><li>int: 来自间隔 (-height_shift_range, +height_shift_range) 之间的整数个像素。</li><li>height_shift_range=2 时，可能值是整数 [-1, 0, +1]，与 height_shift_range=[-1, 0, +1]相同；而 height_shift_range=1.0 时，可能值是 [-1.0, +1.0) 之间的浮点数。</li></ul></li><li><p>shear_range: 浮点数。剪切强度（以弧度逆时针方向剪切角度）。</p><p>所谓shear_range就是错切变换，效果就是让所有点的x坐标(或者y坐标)保持不变，而对应的y坐标(或者x坐标)则按比例发生平移，且平移的大小和该点到x轴(或y轴)的垂直距离成正比。如下图所示，一个黑色矩形图案变换为蓝色平行四边形图案。上一篇文章中也展示了shear变换的效果。</p></li><li><p>brightness_range: 两个浮点数组成的元组或者是列表，像素的亮度会在这个范围之类随机确定</p></li><li><p>zoom_range: 浮点数 或 [lower, upper]。随机缩放范围。如果是浮点数，[lower, upper] = [1-zoom_range, 1+zoom_range]。zoom_range参数可以让图片在长或宽的方向进行放大，可以理解为某方向的resize，因此这个参数可以是一个数或者是一个list。当给出一个数时，图片同时在长宽两个方向进行同等程度的放缩操作；当给出一个list时，则代表[width_zoom_range, height_zoom_range]，即分别对长宽进行不同程度的放缩。而参数大于0小于1时，执行的是放大操作，当参数大于1时，执行的是缩小操作。</p></li><li><p>channel_shift_range: 浮点数。随机通道转换的范围。channel_shift_range可以理解成改变图片的颜色，通过对颜色通道的数值偏移，改变图片的整体的颜色，这意味着是“整张图”呈现某一种颜色，像是加了一块有色玻璃在图片前面一样，即每一个通道上的每一个像素值都加上某一个数值。</p></li></ul><ul><li><p>fill_mode: {“constant”, “nearest”, “reflect” or “wrap”} 之一。默认为 ‘nearest’。输入边界以外的点根据给定的模式填充：</p><ul><li>‘constant’: kkkkkkkk|abcd|kkkkkkkk  (当下面的cval=k)</li><li>‘nearest’: aaaaaaaa|abcd|dddddddd</li><li>‘reflect’: abcddcba|abcd|dcbaabcd</li><li>‘wrap’: abcdabcd|abcd|abcdabcd</li></ul></li><li><p>cval: 浮点数或整数。用于边界之外的点的值，当 fill_mode = “constant” 时。</p></li></ul><ul><li>horizontal_flip: 布尔值。随机水平翻转。</li></ul><ul><li><p>vertical_flip: 布尔值。随机垂直翻转。</p><p>需要注意的是：既然是每次随机进行翻转，随机对图片执行水平或者是垂直翻转操作，意味着不一定对所有图片都会执行水平翻转或垂直翻转，每次生成均是随机选取图片进行翻转</p></li><li><p>rescale: 重缩放因子。默认为 None。如果是 None 或 0，不进行缩放，否则将数据乘以所提供的值（在应用任何其他转换之前）。</p><ul><li>rescale的作用是对图片的每个像素值均乘上这个放缩因子，这个操作在所有其它变换操作之前执行，在一些模型当中，直接输入原图的像素值可能会落入激活函数的“死亡区”，因此设置放缩因子为1/255，把像素值放缩到0和1之间有利于模型的收敛，避免神经元“死亡”。</li></ul></li><li><p>preprocessing_function: 这是用户自定义的函数，应用于每个输入的函数。这个函数会在任何其他改变之前运行。这个函数需要一个参数：一张图像（秩为 3 的 Numpy 张量），并且应该输出一个同尺寸的 Numpy 张量。</p></li></ul><ul><li>data_format: 图像数据格式，{“channels_first”, “channels_last”} 之一。”channels_last” 模式表示图像输入尺寸应该为 (samples, height, width, channels)，”channels_first” 模式表示输入尺寸应该为 (samples, channels, height, width)。默认为 在 Keras 配置文件 ~/.keras/keras.json 中的 image_data_format 值。如果你从未设置它，那它就是 “channels_last”。</li></ul><ul><li>validation_split: 浮点数。Float. 保留用于验证的图像的比例（严格在0和1之间）。</li></ul><ul><li>dtype: 生成数组使用的数据类型。</li></ul><h1 id="ImageDataGenerator类的一些方法以及处理流程"><a href="#ImageDataGenerator类的一些方法以及处理流程" class="headerlink" title="ImageDataGenerator类的一些方法以及处理流程"></a>ImageDataGenerator类的一些方法以及处理流程</h1><h2 id="一般的对图像的处理流程（四步走）"><a href="#一般的对图像的处理流程（四步走）" class="headerlink" title="一般的对图像的处理流程（四步走）"></a>一般的对图像的处理流程（四步走）</h2><ul><li>第一步：数据集的划分，得到x_train,y_train,x_test,y_test；</li></ul><ul><li>第二步：构造ImageDataGenerator对象，其中要进行某一些操作是通过在构造函数中的参数指定的，</li></ul><figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs python">datagen = ImageDataGenerator(......)<br></code></pre></td></tr></table></figure><ul><li><p>第三步：对样本数据进行data augmentation处理，通过fit方法</p><ul><li>注意：这一步并不是必须的，当ImageDataGenerator构造函数中需要使用featurewise_center: samplewise_center: featurewise_std_normalization: samplewise_std_normalization:这几个参数时才需要使用fit方法，因为需要从fit方法中得到原始图形的统计信息，比如均值、方差等等，否则是不需要改步骤的。</li><li>datagen.fit(x_train) # 使用实时数据增益的批数据对模型进行拟合</li></ul></li><li><p>第四步：进行训练，通过flow方法</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">model.fit_generator(datagen.flow(x_train, y_train, batch_size=<span class="hljs-number">32</span>), steps_per_epoch=<span class="hljs-built_in">len</span>(x_train) / <span class="hljs-number">32</span>, epochs=epochs)<br></code></pre></td></tr></table></figure><p>上面是一般的处理流程，当然有时候会有更加灵活的处理方式，后面会有例子加以说明</p><h2 id="ImageDataGenerator的所有方法介绍"><a href="#ImageDataGenerator的所有方法介绍" class="headerlink" title="ImageDataGenerator的所有方法介绍"></a>ImageDataGenerator的所有方法介绍</h2><h3 id="fit方法"><a href="#fit方法" class="headerlink" title="fit方法"></a>fit方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">fit(x, augment=<span class="hljs-literal">False</span>, rounds=<span class="hljs-number">1</span>, seed=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><ul><li>将数据生成器用于某些样本数据数据。它基于一组样本数据，计算与数据转换相关的内部数据统计。当且仅当 featurewise_center 或 featurewise_std_normalization 或 zca_whitening 设置为 True 时才需要。</li></ul><ul><li>参数<ul><li>x: 样本数据。秩应该为 4，即（batch，width，height，channel）的格式。对于灰度数据，通道轴的值应该为 1；对于 RGB 数据，值应该为 3。</li><li>augment: 布尔值（默认为 False）。是否使用随机样本扩张。</li><li>rounds: 整数（默认为 1）。如果数据数据增强（augment=True），表明在数据上进行多少次增强。</li><li>seed: 整数（默认 None）。随机种子。</li></ul></li></ul><h3 id="flow方法"><a href="#flow方法" class="headerlink" title="flow方法"></a>flow方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">flow(x, y=<span class="hljs-literal">None</span>, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>, sample_weight=<span class="hljs-literal">None</span>, seed=<span class="hljs-literal">None</span>, save_to_dir=<span class="hljs-literal">None</span>, save_prefix=<span class="hljs-string">&#x27;&#x27;</span>, save_format=<span class="hljs-string">&#x27;png&#x27;</span>, subset=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><ul><li>采集数据和标签数组，生成批量增强数据。</li></ul><ul><li><p>参数</p><ul><li>x: 输入数据。秩为 4 的 Numpy 矩阵或元组。如果是元组，第一个元素应该包含图像，第二个元素是另一个 Numpy 数组或一列 Numpy 数组，它们不经过任何修改就传递给输出。可用于将模型杂项数据与图像一起输入。对于灰度数据，图像数组的通道轴的值应该为 1，而对于 RGB 数据，其值应该为 3。</li><li>y: 标签。</li><li>batch_size: 整数 (默认为 32)。</li><li>shuffle: 布尔值 (默认为 True)。</li><li>sample_weight: 样本权重。</li><li>seed: 整数（默认为 None）。</li><li>save_to_dir: None 或 字符串（默认为 None）。这使您可以选择指定要保存的正在生成的增强图片的目录（用于可视化您正在执行的操作）。</li><li>save_prefix: 字符串（默认 ‘’）。保存图片的文件名前缀（仅当 save_to_dir 设置时可用）。</li><li>save_format: “png”, “jpeg” 之一（仅当 save_to_dir 设置时可用）。默认：”png”。</li><li>subset: 数据子集 (“training” 或 “validation”)，如果 在 ImageDataGenerator 中设置了 validation_split。</li></ul></li><li><p>返回</p></li><li><p>一个生成元组 (x, y) 的 生成器Iterator，其中 x 是图像数据的 Numpy 数组（在单张图像输入时），</p></li><li><p>或 Numpy 数组列表（在额外多个输入时），y 是对应的标签的 Numpy 数组。如果 ‘sample_weight’ 不是 None，生成的元组形式为 (x, y, sample_weight)。如果 y 是 None, 只有 Numpy 数组 x 被返回。</p></li></ul><h3 id="flow-from-dataframe方法"><a href="#flow-from-dataframe方法" class="headerlink" title="flow_from_dataframe方法"></a>flow_from_dataframe方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">flow_from_dataframe(dataframe, directory, x_col=<span class="hljs-string">&#x27;filename&#x27;</span>, y_col=<span class="hljs-string">&#x27;class&#x27;</span>, has_ext=<span class="hljs-literal">True</span>, target_size=(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>), color_mode=<span class="hljs-string">&#x27;rgb&#x27;</span>, classes=<span class="hljs-literal">None</span>, class_mode=<span class="hljs-string">&#x27;categorical&#x27;</span>, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>, seed=<span class="hljs-literal">None</span>, save_to_dir=<span class="hljs-literal">None</span>, save_prefix=<span class="hljs-string">&#x27;&#x27;</span>, save_format=<span class="hljs-string">&#x27;png&#x27;</span>, subset=<span class="hljs-literal">None</span>, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>输入 dataframe 和目录的路径，并生成批量的增强/标准化的数据。</li></ul><ul><li>参数<ul><li>dataframe: Pandas dataframe，一列为图像的文件名，另一列为图像的类别， 或者是可以作为原始目标数据多个列。</li><li>directory: 字符串，目标目录的路径，其中包含在 dataframe 中映射的所有图像。</li><li>x_col: 字符串，dataframe 中包含目标图像文件夹的目录的列。</li><li>y_col: 字符串或字符串列表，dataframe 中将作为目标数据的列。</li><li>has_ext: 布尔值，如果 dataframe[x_col] 中的文件名具有扩展名则为 True，否则为 False。</li><li>target_size: 整数元组 (height, width)，默认为 (256, 256)。 所有找到的图都会调整到这个维度。</li><li>color_mode: “grayscale”, “rbg” 之一。默认：”rgb”。 图像是否转换为 1 个或 3 个颜色通道。</li><li>classes: 可选的类别列表 (例如， [‘dogs’, ‘cats’])。默认：None。 如未提供，类比列表将自动从 y_col 中推理出来，y_col 将会被映射为类别索引）。 包含从类名到类索引的映射的字典可以通过属性 class_indices 获得。</li><li>class_mode: “categorical”, “binary”, “sparse”, “input”, “other” or None 之一。 默认：”categorical”。决定返回标签数组的类型：<ul><li>“categorical” 将是 2D one-hot 编码标签，</li><li>“binary” 将是 1D 二进制标签，</li><li>“sparse” 将是 1D 整数标签，</li><li>“input” 将是与输入图像相同的图像（主要用于与自动编码器一起使用），</li><li>“other” 将是 y_col 数据的 numpy 数组，</li><li>None, 不返回任何标签（生成器只会产生批量的图像数据，这对使用 model.predict_generator(), model.evaluate_generator() 等很有用）。</li></ul></li><li>batch_size: 批量数据的尺寸（默认：32）。</li><li>shuffle: 是否混洗数据（默认：True）</li><li>seed: 可选的混洗和转换的随即种子。</li><li>save_to_dir: None 或 str (默认: None). 这允许你可选地指定要保存正在生成的增强图片的目录（用于可视化您正在执行的操作）。</li><li>save_prefix: 字符串。保存图片的文件名前缀（仅当 save_to_dir 设置时可用）。</li><li>save_format: “png”, “jpeg” 之一（仅当 save_to_dir 设置时可用）。默认：”png”。</li><li>follow_links: 是否跟随类子目录中的符号链接（默认：False）。</li><li>subset: 数据子集 (“training” 或 “validation”)，如果在 ImageDataGenerator 中设置了 validation_split。</li><li>interpolation: 在目标大小与加载图像的大小不同时，用于重新采样图像的插值方法。 支持的方法有 “nearest”, “bilinear”, and “bicubic”。 如果安装了 1.1.3 以上版本的 PIL 的话，同样支持 “lanczos”。 如果安装了 3.4.0 以上版本的 PIL 的话，同样支持 “box” 和 “hamming”。 默认情况下，使用 “nearest”</li></ul></li><li>Returns<ul><li>一个生成 (x, y) 元组的 DataFrameIterator， 其中 x 是一个包含一批尺寸为 (batch_size, *target_size, channels) 的图像样本的 numpy 数组，y 是对应的标签的 numpy 数组。</li></ul></li></ul><h3 id="flow-from-directory"><a href="#flow-from-directory" class="headerlink" title="flow_from_directory"></a>flow_from_directory</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">flow_from_directory(directory, target_size=(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>), color_mode=<span class="hljs-string">&#x27;rgb&#x27;</span>, classes=<span class="hljs-literal">None</span>, class_mode=<span class="hljs-string">&#x27;categorical&#x27;</span>, batch_size=<span class="hljs-number">32</span>, shuffle=<span class="hljs-literal">True</span>, seed=<span class="hljs-literal">None</span>, save_to_dir=<span class="hljs-literal">None</span>, save_prefix=<span class="hljs-string">&#x27;&#x27;</span>, save_format=<span class="hljs-string">&#x27;png&#x27;</span>, follow_links=<span class="hljs-literal">False</span>, subset=<span class="hljs-literal">None</span>, interpolation=<span class="hljs-string">&#x27;nearest&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>参数<ul><li>directory: 目标目录的路径。每个类应该包含一个子目录。任何在子目录树下的 PNG, JPG, BMP, PPM 或 TIF 图像，都将被包含在生成器中。</li><li>target_size: 整数元组 (height, width)，默认：(256, 256)。所有的图像将被调整到的尺寸。</li><li>color_mode: “grayscale”, “rbg” 之一。默认：”rgb”。图像是否被转换成 1 或 3 个颜色通道。</li><li>classes: 可选的类的子目录列表（例如 [‘dogs’, ‘cats’]）。默认：None。如果未提供，类的列表将自动从 directory 下的 子目录名称/结构 中推断出来，其中每个子目录都将被作为不同的类（类名将按字典序映射到标签的索引）。包含从类名到类索引的映射的字典可以通过 class_indices 属性获得。</li><li>class_mode: “categorical”, “binary”, “sparse”, “input” 或 None 之一。默认：”categorical”。决定返回的标签数组的类型：</li><li>“categorical” 将是 2D one-hot 编码标签，</li><li>“binary” 将是 1D 二进制标签，”sparse” 将是 1D 整数标签，</li><li>“input” 将是与输入图像相同的图像（主要用于自动编码器）。<ul><li>如果为 None，不返回标签（生成器将只产生批量的图像数据，对于 model.predict_generator(), model.evaluate_generator() 等很有用）。请注意，如果 class_mode 为 None，那么数据仍然需要驻留在 directory 的子目录中才能正常工作。</li></ul></li><li>batch_size: 一批数据的大小（默认 32）。</li><li>shuffle: 是否混洗数据（默认 True）。</li><li>seed: 可选随机种子，用于混洗和转换。</li><li>save_to_dir: None 或 字符串（默认 None）。这使你可以最佳地指定正在生成的增强图片要保存的目录（用于可视化你在做什么）。</li><li>save_prefix: 字符串。 保存图片的文件名前缀（仅当 save_to_dir 设置时可用）。</li><li>save_format: “png”, “jpeg” 之一（仅当 save_to_dir 设置时可用）。默认：”png”。</li><li>follow_links: 是否跟踪类子目录中的符号链接（默认为 False）。</li><li>subset: 数据子集 (“training” 或 “validation”)，如果 在 ImageDataGenerator 中设置了 validation_split。</li><li>interpolation: 在目标大小与加载图像的大小不同时，用于重新采样图像的插值方法。 支持的方法有 “nearest”, “bilinear”, and “bicubic”。 如果安装了 1.1.3 以上版本的 PIL 的话，同样支持 “lanczos”。 如果安装了 3.4.0 以上版本的 PIL 的话，同样支持 “box” 和 “hamming”。 默认情况下，使用 “nearest”。</li></ul></li><li>返回<ul><li>一个生成 (x, y) 元组的 DirectoryIterator，其中 x 是一个包含一批尺寸为 (batch_size, *target_size, channels)的图像的 Numpy 数组，y 是对应标签的 Numpy 数组。</li></ul></li></ul><h3 id="get-random-transform"><a href="#get-random-transform" class="headerlink" title="get_random_transform()"></a>get_random_transform()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">get_random_transform(img_shape, seed=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><ul><li>为转换生成随机参数。什么意思呢？因为变换的种类很多，实际上就是堆一批图片到底进行了那些变换操作呢？可以通过这个方法获得。</li></ul><ul><li><p>参数</p><ul><li>seed: 随机种子</li><li>img_shape: 整数元组。被转换的图像的尺寸。</li></ul></li><li><p>返回</p><ul><li>包含随机选择的描述变换的参数的字典。返回的字典如下面的形式：哪些变换使用了，就在字典中添加即可。</li></ul></li></ul><h3 id="random-transform"><a href="#random-transform" class="headerlink" title="random_transform"></a>random_transform</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">random_transform(x, seed=<span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><ul><li>将随机变换应用于图像。由于变换的种类很多，这里是随机使用某一种变换在图像上面</li></ul><ul><li><p>参数</p><ul><li>x: 3D 张量，单张图像。（注意，这里是单张图片哦！）</li><li>seed: 随机种子。</li></ul></li><li><p>返回</p><ul><li>输入的随机转换之后的版本（相同形状）。</li></ul></li></ul><h3 id="standardize方法"><a href="#standardize方法" class="headerlink" title="standardize方法"></a>standardize方法</h3><ul><li>将标准化配置应用于一批输入。</li></ul><ul><li><p>参数</p><ul><li>x: 需要标准化的一批输入。</li></ul></li><li><p>返回</p><ul><li>标准化后的输入。</li></ul></li></ul><h3 id="apply-transform-方法"><a href="#apply-transform-方法" class="headerlink" title="apply_transform()方法"></a>apply_transform()方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">apply_transform(x, transform_parameters)<br></code></pre></td></tr></table></figure><ul><li>参数<ul><li> x: 3D tensor, single image.这里也是针对单张图片的</li><li> transform_parameters:它是一个字典形式的参数，表示要使用哪些变换，字典的键如下所示：</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">- `<span class="hljs-string">&#x27;theta&#x27;</span>`: Float. Rotation angle <span class="hljs-keyword">in</span> degrees.<br><br>- `<span class="hljs-string">&#x27;tx&#x27;</span>`: Float. Shift <span class="hljs-keyword">in</span> the x direction.<br><br>- `<span class="hljs-string">&#x27;ty&#x27;</span>`: Float. Shift <span class="hljs-keyword">in</span> the y direction.<br><br>- `<span class="hljs-string">&#x27;shear&#x27;</span>`: Float. Shear angle <span class="hljs-keyword">in</span> degrees.<br><br>- `<span class="hljs-string">&#x27;zx&#x27;</span>`: Float. Zoom <span class="hljs-keyword">in</span> the x direction.<br><br>- `<span class="hljs-string">&#x27;zy&#x27;</span>`: Float. Zoom <span class="hljs-keyword">in</span> the y direction.<br><br>- `<span class="hljs-string">&#x27;flip_horizontal&#x27;</span>`: Boolean. Horizontal flip.<br><br>- `<span class="hljs-string">&#x27;flip_vertical&#x27;</span>`: Boolean. Vertical flip.<br><br>- `<span class="hljs-string">&#x27;channel_shift_intencity&#x27;</span>`: Float. Channel shift intensity.<br><br>- `<span class="hljs-string">&#x27;brightness&#x27;</span>`: Float. Brightness shift intensity.<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/grub%E5%BC%82%E5%B8%B8/"/>
    <url>/2022/01/16/cnblog/grub%E5%BC%82%E5%B8%B8/</url>
    
    <content type="html"><![CDATA[<h1 id="开机出现-grub-rescue-指令模式"><a href="#开机出现-grub-rescue-指令模式" class="headerlink" title="开机出现 grub rescue 指令模式"></a>开机出现 grub rescue 指令模式</h1><p>假如看到grub rescue，表示mbr (master boot record)的资料，完全对应不上磁盘的状况，所以无法辨别系统的所有分区，更不用说连grub menu都无法读入。可以grub程序有问题，找不到系统所在分区。</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">ls <br><span class="hljs-meta">#</span><span class="bash"> (hd0), (hd0,msdos3), (hd0,msdos2), (hd0,msdos1)</span><br><span class="hljs-meta">#</span><span class="bash"> ls可以列出所有的硬碟与分区，(hd0)是第一个硬碟，(hd0,msdos1)是第一颗硬碟的第一个分区。以此类推。输入指令时，可以简写成(hd0,1)表示。若是GPT分割，出现的会是(hd0,gpt0)的格式。</span><br><span class="hljs-meta">#</span><span class="bash"> 只出现(hd0)，那表示你的分区表已经损坏；</span><br>ls (hd0,1)/<br><span class="hljs-meta">#</span><span class="bash"> 确定各个分区那个是 / ，哪个是/boot，就可以开始继续处理。现在假设 / 是(hd0,2)，/boot 是(hd0,2)/boot。</span><br><br></code></pre></td></tr></table></figure><ul><li>/boot/grub下的i386-pc或者x86_64-efi目录，是放置grub模组所在<ul><li>前者出现在以mbr开机的系统，</li><li>后者出现在efi开机的系统 。</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">正式设置</span><br>grub rescue&gt; set root=(hd0,2) <br>grub rescue&gt; set prefix=(hd0,2)/boot/grub <br>grub rescue&gt; insmod normal <br>grub rescue&gt; normal<br>第一行指令：设置根目录所在的分区<br>第二行指令：设置grub目录。这样他才知道哪里去找模组。此行设置错误，第三行指令执行时，就无法载入模组。假如你的 /boot 没有额外分割，那这行就要写成 set prefix=(hd0,2)/boot/grub<br>第三行指令：载入normal模组<br>第四行指令：执行normal模组<br></code></pre></td></tr></table></figure><p>normal模组作用是什麼？</p><p>会把一些指令，文件系统模组，及其他需要的模组自动呼叫进来。假如你的grub.cfg没有问题，应该就可以看见grub菜单了。</p><h1 id="开机出现grub指令模式"><a href="#开机出现grub指令模式" class="headerlink" title="开机出现grub指令模式"></a>开机出现grub指令模式</h1><ul><li><p>这类问题通常发生在，mbr可以找到对应的磁盘与各分区，却无法找到可用有效的grub.cfg，不能加载内核文件</p></li><li><p>这时候，相关的模组已经载入，所以比grub rescue好处理</p></li><li><p>同样用 ls 找出相关的分区，并检查哪个分区是根目录，哪个分区是 /boot ，方法与之前的grub rescue相同。</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">grub&gt;</span><span class="bash"> <span class="hljs-built_in">set</span> root=(hd0,2)</span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> linux /boot/vmlinuz-3.11.0-18-generic root=/dev/sda3</span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> initrd /boot/initrd.img-3.11.0-18-generic</span><br><span class="hljs-meta">grub&gt;</span><span class="bash"> boot</span><br><span class="hljs-meta">#</span><span class="bash"> 第一行：设置根目录所在的分区</span><br><span class="hljs-meta">#</span><span class="bash"> 第二行：设置核心所在，并设置根目录所在分区</span><br><span class="hljs-meta">#</span><span class="bash"> 第三行：设置虚拟系统启动核心所在。</span><br><span class="hljs-meta">#</span><span class="bash"> 注：如果是grub0.9.8.e即grub-legacy在开机区，那么需要把linux改成kernel</span><br><span class="hljs-meta">#</span><span class="bash"> 第四行：开机,直接进入系统没有菜单</span><br></code></pre></td></tr></table></figure><h1 id="可见到grub-menu，但无法开机"><a href="#可见到grub-menu，但无法开机" class="headerlink" title="可见到grub menu，但无法开机"></a>可见到grub menu，但无法开机</h1><p>系统可以找到grub.cfg，但是上头的资料有问题，无法找到核心。常发生在变更分割表后，因grub无法辨识uuid或者label造成</p><h1 id="处理grub的异常状况"><a href="#处理grub的异常状况" class="headerlink" title="处理grub的异常状况"></a>处理grub的异常状况</h1><ul><li><p>检查并修改 /etc/fstab ：<br>/etc/fstab 是系统挂载分区的必要文件。请确认里面的uuid是否与实际状况相符？实际的uuid可以藉由sudo blkid取得。若有不符的状况，请修改。现在ubuntu已经默认使用uuid来辨识分区，这种辨识方式，可以避免系统的混淆。当然他仍支持以往用设备名称辨识的方法。</p></li><li><p>更新 /boot/grub/grub.cfg ：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sudo update-grub<br>sudo update-grub2<br></code></pre></td></tr></table></figure></li><li><p>重新安装grub到磁盘开头的开机区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo grub-install /dev/sda<br></code></pre></td></tr></table></figure></li><li><p>若有问题，可能需要强制安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo grub-install /dev/sda --force<br><span class="hljs-meta">#</span><span class="bash"> 若不是/dev/sda，请自行修改。</span><br><span class="hljs-meta">#</span><span class="bash"> 以下三个参数要注意，必要时要特别加入</span><br>--boot-directory=[path]<br>--efi-directory=[path]<br>--uefi-secure-boot<br><span class="hljs-meta">#</span><span class="bash"> man grub-install 查看帮助</span><br></code></pre></td></tr></table></figure></li></ul><h1 id="MBR与GPT"><a href="#MBR与GPT" class="headerlink" title="MBR与GPT"></a>MBR与GPT</h1><p>BIOS+mbr</p><ul><li>前446字节村存放grub程序<ul><li>为什么要grub引导：因为bios不识别文件系统格式</li><li>grub是操作系统安装后写入的，因此会识别文件系统</li></ul></li><li>后64，存放分区表每个分区的起始，结束柱面号</li></ul><p><img src="https://img-blog.csdnimg.cn/20190521131754775.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDcwMjAxNw==,size_16,color_FFFFFF,t_70" alt="img"></p><p>UEFI+gpt</p><p><img src="https://img-blog.csdnimg.cn/20190521131201603.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDcwMjAxNw==,size_16,color_FFFFFF,t_70" alt="img"></p><ul><li>在GPT分区表中引导记录被.efi文件所接管，统一放在一个叫ESP的分区中，<ul><li>这个分区的文件系统必须是FAT文件系统这样才能被UEFI所识别，</li><li>这个分区可以放置引导不同分区以及不同的硬盘多个系统的.efi,不过要在UEFI启动项中设定</li><li>也可以使用grub2进行设定引导。</li></ul></li><li>UEFI这些启动项将会去引导ESP分区中的.efi文件，<ul><li>Linux中的grubx64.efi, shimx64.efi,</li><li>window10中是ESP分区\EFI\BOOT\bootx64.efi,或是bootmgfw.efi,具体引导哪个.efi文件要看UEFI启动项中的设定。</li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Github%E8%AE%BF%E9%97%AE%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <url>/2022/01/16/cnblog/Github%E8%AE%BF%E9%97%AE%E9%80%9F%E5%BA%A6%E5%BE%88%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0%EF%BC%8C%E4%BB%A5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>1，CDN，Content Distribute Network，可以直译成内容分发网络，CDN解决的是如何将数据快速可靠从源站传递到用户的问题。用户获取数据时，不需要直接从源站获取，通过CDN对于数据的分发，用户可以从一个较优的服务器获取数据，从而达到快速访问，并减少源站负载压力的目的。</p><p>2，为什么访问速度慢、下载慢？</p><p>答：github的CDN被某墙屏了，由于网络代理商的原因，所以访问下载很慢。ping github.com 时，速度只有300多ms。</p><p>3，如何解决？</p><p>答：绕过dns解析，在本地直接绑定host，该方法也可加速其他因为CDN被屏蔽导致访问慢的网站。</p><p>hosts文件所在目录，C:\Windows\System32\drivers\etc</p><p>修改windows里的hosts文件，添加如下内容</p><p>151.101.44.249    github.global.ssl.fastly.net</p><p>192.30.253.113    github.com</p><p>103.245.222.133    assets-cdn.github.com</p><p>23.235.47.133    assets-cdn.github.com</p><p>203.208.39.104    assets-cdn.github.com</p><p>204.232.175.78    documentcloud.github.com</p><p>204.232.175.94    gist.github.com</p><p>107.21.116.220    help.github.com</p><p>207.97.227.252    nodeload.github.com</p><p>199.27.76.130    raw.github.com</p><p>107.22.3.110    status.github.com</p><p>204.232.175.78    training.github.com</p><p>207.97.227.243    <a href="http://www.github.com/">www.github.com</a></p><p>185.31.16.184    github.global.ssl.fastly.net</p><p>185.31.18.133    avatars0.githubusercontent.com</p><p>185.31.19.133    avatars1.githubusercontent.com</p><p>192.30.253.120    codeload.github.com </p><p>windows下刷新DNS的方法：</p><p>打开cmd</p><p>输入ipconfig /flushdns</p><p>下载速度明显提升</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/git/"/>
    <url>/2022/01/16/cnblog/git/</url>
    
    <content type="html"><![CDATA[<h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 当前项目下配置</span><br>git config -l<br><span class="hljs-meta">#</span><span class="bash"> 查看全局配置 ~/.gitconfig</span><br>git config --global --list<br><span class="hljs-meta">#</span><span class="bash"> 查看系统配置  ../git/etc/gitconfig</span><br>git config --system --list<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 设置全局用户名，邮箱</span><br>git config --global user.name &quot;xxx&quot;<br></code></pre></td></tr></table></figure><h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h1><p><img src="https://i.loli.net/2020/09/14/H7NDtfWoVsMb3E4.png" alt="image-20200914121206477"></p><p><img src="https://i.loli.net/2020/09/14/d7og9Gbz1DwPIcX.png" alt="image-20200914121136764"></p><p><img src="https://i.loli.net/2020/09/14/8QGxKEb4vgTR1NJ.png" alt="image-20200914121409427"></p><h1 id="Git创建步骤"><a href="#Git创建步骤" class="headerlink" title="Git创建步骤"></a>Git创建步骤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">git init<br>git clone<br></code></pre></td></tr></table></figure><h6 id="绑定ssh"><a href="#绑定ssh" class="headerlink" title="绑定ssh"></a>绑定ssh</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 用户家目录 运行即可windows 相同命令</span><br>ssh-keygen -t rsa<br><span class="hljs-meta">#</span><span class="bash"> 将公钥上传github即可</span><br></code></pre></td></tr></table></figure><h1 id="IDEA使用Git"><a href="#IDEA使用Git" class="headerlink" title="IDEA使用Git"></a>IDEA使用Git</h1><ul><li>创建项目</li><li>连接远程仓库<ul><li>github创建仓库</li><li>clone</li><li>将仓库复制到项目</li></ul></li></ul><h1 id="Git分支"><a href="#Git分支" class="headerlink" title="Git分支"></a>Git分支</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">git reset 撤销上一次 commit<br>git branch<br>git branch -r<br>git branch new_branchname<br>git checkout -n branch<br>git merge branch # 指定分支合并到当前,冲突需要手动选择<br>git branch -d branch # 删除分支<br>git push origin --delete branch # 删除远程分支<br>git branch -dr remote/branch<br></code></pre></td></tr></table></figure><p>参考：<a href="https://static.dean0731.top/pdf/git.pdf">https://static.dean0731.top/pdf/git.pdf</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/firewall/"/>
    <url>/2022/01/16/cnblog/firewall/</url>
    
    <content type="html"><![CDATA[<h1 id="Firewall-cmd基本命令"><a href="#Firewall-cmd基本命令" class="headerlink" title="Firewall-cmd基本命令"></a>Firewall-cmd基本命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看防火墙状态</span><br>firewall-cmd --state # not running/ running<br><span class="hljs-meta">#</span><span class="bash"> 查看已开端口</span><br>firewall-cmd --list-ports<br><span class="hljs-meta">#</span><span class="bash"> 使新添加的端口生效</span><br>firewall-cmd --reload <br><span class="hljs-meta">#</span><span class="bash"> 更新防火墙规则，重启服务</span><br>firewall-cmd --completely-reload<br></code></pre></td></tr></table></figure><h1 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 开启</span><br>systemctl start firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 开机自启</span><br>systemctl enable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 关闭开机自启</span><br>systemctl disable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 重启</span><br>systemctl restart firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 是否自启</span><br>systemctl is-enable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 查看服务是否开机启动</span><br>systemctl is-enabled firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 查看已启动的服务列表</span><br>systemctl list-unit-files|grep enabled<br><span class="hljs-meta">#</span><span class="bash"> 查看启动失败的服务列表</span><br>systemctl --failed<br></code></pre></td></tr></table></figure><h1 id="端口开关"><a href="#端口开关" class="headerlink" title="端口开关"></a>端口开关</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 开端口命令</span><br>firewall-cmd --zone=public --add-port=80/tcp --permanent<br><span class="hljs-meta">#</span><span class="bash"> 命令含义：</span><br><span class="hljs-meta">#</span><span class="bash">--zone <span class="hljs-comment">#作用域，</span></span><br><span class="hljs-meta">#</span><span class="bash">--add-port=80/tcp  <span class="hljs-comment">#添加端口，格式为：端口/通讯协议，</span></span><br><span class="hljs-meta">#</span><span class="bash">--permanent   <span class="hljs-comment">#永久生效，没有此参数重启后失效</span></span><br><span class="hljs-meta">#</span><span class="bash"> 查看</span><br>firewall-cmd --zone=public --query-port=80/tcp<br><span class="hljs-meta">#</span><span class="bash"> 删除</span><br>firewall-cmd --zone=public --remove-port=80/tcp --permanent<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看已激活的Zone信息</span><br>firewall-cmd --get-active-zones<br><span class="hljs-meta">#</span><span class="bash"> 查看指定接口所属区域</span><br>firewall-cmd --get-zone-of-interface=eth0<br><span class="hljs-meta">#</span><span class="bash"> 拒绝所有包</span><br>firewall-cmd --panic-on<br><span class="hljs-meta">#</span><span class="bash"> 取消拒绝状态：</span> <br>firewall-cmd --panic-off<br><span class="hljs-meta">#</span><span class="bash"> 查看是否拒绝</span><br>firewall-cmd --query-panic<br></code></pre></td></tr></table></figure><h1 id="信任级别"><a href="#信任级别" class="headerlink" title="信任级别"></a>信任级别</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">信任级别，通过<span class="hljs-type">Zone</span>的值指定<br><span class="hljs-keyword">drop</span>: 丢弃所有进入的包，而不给出任何响应 <br>block: 拒绝所有外部发起的连接，允许内部发起的连接 <br><span class="hljs-built_in">public</span>: 允许指定的进入连接 <br><span class="hljs-keyword">external</span>: 同上，对伪装的进入连接，一般用于路由转发 <br>dmz: 允许受限制的进入连接 <br><span class="hljs-keyword">work</span>: 允许受信任的计算机被限制的进入连接，类似 workgroup <br>home: 同上，类似 homegroup <br><span class="hljs-type">internal</span>: 同上，范围针对所有互联网用户 <br><span class="hljs-keyword">trusted</span>: 信任所有连接<br></code></pre></td></tr></table></figure><h1 id="服务管理"><a href="#服务管理" class="headerlink" title="服务管理"></a>服务管理</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 以smtp服务为例， 添加到work zone</span><br><span class="hljs-meta">#</span><span class="bash"> 添加：</span><br>firewall-cmd --zone=work --add-service=smtp<br><span class="hljs-meta">#</span><span class="bash"> 查看：</span><br>firewall-cmd --zone=work --query-service=smtp<br><span class="hljs-meta">#</span><span class="bash"> 删除：</span><br>firewall-cmd --zone=work --remove-service=smtp<br></code></pre></td></tr></table></figure><h1 id="IP地址伪装"><a href="#IP地址伪装" class="headerlink" title="IP地址伪装"></a>IP地址伪装</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看：</span><br>firewall-cmd --zone=external --query-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 打开：</span><br>firewall-cmd --zone=external --add-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 关闭：</span><br>firewall-cmd --zone=external --remove-masquerade<br></code></pre></td></tr></table></figure><h1 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 打开端口转发，首先需要打开IP地址伪装</span><br>firewall-cmd --zone=external --add-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 转发 tcp 22 端口至 3753：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:toport=3753<br><span class="hljs-meta">#</span><span class="bash"> 转发端口数据至另一个IP的相同端口：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:toaddr=192.168.1.112<br><span class="hljs-meta">#</span><span class="bash"> 转发端口数据至另一个IP的 3753 端口：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:：toport=3753:toaddr=192.168.1.112<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/ESMAScript6%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/"/>
    <url>/2022/01/16/cnblog/ESMAScript6%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="ESMAScript6-0"><a href="#ESMAScript6-0" class="headerlink" title="ESMAScript6.0"></a>ESMAScript6.0</h1><p>是一个标准，javascript是它的遵循语言，大部分都是用es6</p><p>ES5:2015年发布的</p><p>ES6:代码更加简洁，但浏览器兼容性差</p><h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><figure class="highlight javascript"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//js定义,无作用范围</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-literal">true</span>;<br><span class="hljs-comment">//es6定义，有范围，代码块内有效</span><br><span class="hljs-keyword">let</span> a = <span class="hljs-literal">true</span>;<br></code></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//let相同名字只能声明一次</span><br><span class="hljs-keyword">let</span> m=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">let</span> m=<span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><h5 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//定义时必须初始化</span><br><span class="hljs-keyword">const</span> PI=<span class="hljs-string">&#x27;3.14159265354&#x27;</span><br>PI = <span class="hljs-number">3</span> <span class="hljs-comment">//报错</span><br></code></pre></td></tr></table></figure><h5 id="解构赋值"><a href="#解构赋值" class="headerlink" title="解构赋值"></a>解构赋值</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 传统</span><br><span class="hljs-keyword">let</span> a=<span class="hljs-number">1</span>,b=<span class="hljs-number">2</span>,c=<span class="hljs-number">3</span><br><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">let</span> [a,b,c] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]<br><span class="hljs-comment">// 对象解构</span><br><span class="hljs-keyword">let</span> user=&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Dean&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>&#125;<br><span class="hljs-comment">// 传统</span><br>age = user.age<br>name =user.name<br><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">let</span> &#123;name,age&#125;=user<br></code></pre></td></tr></table></figure><h5 id="模板字符串-反引号-tab上边那个"><a href="#模板字符串-反引号-tab上边那个" class="headerlink" title="模板字符串:反引号 tab上边那个"></a>模板字符串:反引号 tab上边那个</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 按照原格式输出</span><br><span class="hljs-keyword">let</span> str1 = <span class="hljs-string">`hello</span><br><span class="hljs-string">world`</span>;<br><span class="hljs-built_in">console</span>.log(str1)<br><span class="hljs-comment">// 格式化</span><br><span class="hljs-keyword">let</span> name=<span class="hljs-string">&quot;Dean&quot;</span><br><span class="hljs-keyword">let</span> info=<span class="hljs-string">`my name is <span class="hljs-subst">$&#123;name&#125;</span>`</span><br><span class="hljs-comment">// 还可以格式化函数</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">f1</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;hello&#x27;</span>&#125;<br><span class="hljs-keyword">let</span> str2=<span class="hljs-string">`demo,<span class="hljs-subst">$&#123;f1()&#125;</span>`</span><br><br></code></pre></td></tr></table></figure><h5 id="声明对象"><a href="#声明对象" class="headerlink" title="声明对象"></a>声明对象</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> name=<span class="hljs-string">&#x27;dean&#x27;</span><br><span class="hljs-keyword">const</span> age=<span class="hljs-number">18</span><br><span class="hljs-comment">// 传统方式</span><br><span class="hljs-keyword">const</span> p1 = &#123;<span class="hljs-attr">name</span>:name,<span class="hljs-attr">age</span>:age&#125;<br><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">const</span> p2 = &#123;name,age&#125;  <span class="hljs-comment">//效果相同</span><br></code></pre></td></tr></table></figure><h5 id="定义方法简写"><a href="#定义方法简写" class="headerlink" title="定义方法简写"></a>定义方法简写</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 传统</span><br><span class="hljs-keyword">const</span> p1=&#123;<br>    <span class="hljs-attr">sayHi</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;hello&#x27;</span>)&#125;<br>&#125;<br>p1.sayHi() <span class="hljs-comment">//调用</span><br><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">const</span> p1=&#123;<br>    <span class="hljs-function"><span class="hljs-title">sayHi</span>(<span class="hljs-params"></span>)</span>&#123;<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;hello&#x27;</span>)&#125;<br>&#125;<br>p1.sayHi() <span class="hljs-comment">//调用</span><br><br></code></pre></td></tr></table></figure><h5 id="对象扩展运算符（…）浏览器可能不支持"><a href="#对象扩展运算符（…）浏览器可能不支持" class="headerlink" title="对象扩展运算符（…）浏览器可能不支持"></a>对象扩展运算符（…）浏览器可能不支持</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 对象复制</span><br><span class="hljs-keyword">let</span> p1= &#123;<span class="hljs-attr">name</span>:<span class="hljs-string">&#x27;Dean&#x27;</span>,<span class="hljs-attr">age</span>:<span class="hljs-number">18</span>&#125;<br><span class="hljs-keyword">let</span> p2=&#123;...p1&#125;<br><span class="hljs-comment">// 对象合并</span><br><span class="hljs-keyword">let</span> name=<span class="hljs-string">&#x27;Dean&#x27;</span><br><span class="hljs-keyword">let</span> age=<span class="hljs-number">18</span><br><span class="hljs-keyword">let</span> p3=&#123;...age,...name&#125; <span class="hljs-comment">// &#123;age:18,name:&#x27;Dean&#x27;&#125;</span><br></code></pre></td></tr></table></figure><h5 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 传统</span><br><span class="hljs-keyword">var</span> f1=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a</span>)</span>&#123;<br>    <span class="hljs-keyword">return</span> a<br>&#125;<br><span class="hljs-comment">// es6</span><br><span class="hljs-keyword">var</span> f2=<span class="hljs-function"><span class="hljs-params">a</span>=&gt;</span>a<br><span class="hljs-keyword">var</span> f3=<span class="hljs-function">(<span class="hljs-params">a,b</span>)=&gt;</span>a+b<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/ElasticSearch/"/>
    <url>/2022/01/16/cnblog/ElasticSearch/</url>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul><li><p>分布式全文搜索引擎</p><ul><li>传统用sql，对于大量数据很慢</li><li>可以当做一个数据库，可以将里面的索引就是库</li></ul></li><li><p>Lucene 用于文本搜索的函数库，java编写的，全文搜索功能 ，jar包，不包含搜索引擎</p><ul><li>索引结构</li><li>读写索引，排序，搜索规则</li></ul></li><li><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129162516427.png" alt="image-20210129162516427"></p></li><li><p>elasticsearch是基于lucene做了一些封装和增强</p></li><li><p>solr</p><ul><li>封装了lucene，可独立运行</li><li>通过发送请求可以操作数据</li><li>有管理界面，</li></ul></li><li><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129164623442.png" alt="image-20210129164623442"></p></li></ul><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ul><li><a href="https://www.elastic.co/cn/webinars/getting-started-elasticsearch?elektra=startpage">https://www.elastic.co/cn/webinars/getting-started-elasticsearch?elektra=startpage</a></li><li>至少JDK1.8之上</li><li>解压即用</li></ul><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul><li>bin</li><li>config<ul><li>jvm配置</li><li>log4j2</li><li>elasticSearch.yml<ul><li>集群</li><li>端口：9200</li><li>http.cors.enabled: true 设置允许跨域,让界面插件访问<ul><li>http.cors.allow-origin: “*“</li></ul></li></ul></li></ul></li><li>lib 相关架包</li><li>logs 日志</li><li>modules 功能模块</li><li>plugins 插件，例如IK分词器</li></ul><h1 id="界面插件"><a href="#界面插件" class="headerlink" title="界面插件"></a>界面插件</h1><ul><li>elasticsearch head ：前端项目，需要npm<ul><li>下载</li><li>npm install</li><li>npm run start</li><li>启动后连接到elasticsearch即可</li></ul></li><li>索引：可以当做数据库，</li><li>文档：库中的数据</li><li><a href="http://localhost:9100/">http://localhost:9100</a></li></ul><h1 id="Kibana"><a href="#Kibana" class="headerlink" title="Kibana"></a>Kibana</h1><ul><li>es的分析及可视化平台<a href="http://localhost:5601/">http://localhost:5601</a></li><li>汉化：config/kibana.yml <ul><li>i18n.locale: “zh_CN”</li></ul></li></ul><h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>es是面向文档的， 全部是json</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129173559785.png" alt="image-20210129173559785"></p><ul><li>索引</li><li>字段索引</li><li>文档</li></ul><h2 id="ik分词器"><a href="#ik分词器" class="headerlink" title="ik分词器"></a>ik分词器</h2><p>​    把句子划分为关键字，会把数据库中数据分词后匹配，ik_smart最少切分,ik_max_word最细粒度切分</p><ul><li>下载analysis-ik</li><li>解压到es plugins下</li><li>重启es</li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210129175644428.png" alt="image-20210129175644428"></p><ul><li>插件中建立自己的xxx.dic</li><li>配置文件修改为<entry key="ext_dict">xxx.dic</entry></li></ul><h1 id="索引的增删改查"><a href="#索引的增删改查" class="headerlink" title="索引的增删改查"></a>索引的增删改查</h1><figure class="highlight awk"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> 添加库<br>PUT <span class="hljs-regexp">/索引名/</span>类型/文档名<br>&#123;<br>  <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;dean&quot;</span>,<br>  <span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">3</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test1&quot;</span>,<br>  <span class="hljs-attr">&quot;_type&quot;</span> : <span class="hljs-string">&quot;type&quot;</span>,<br>  <span class="hljs-attr">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>  <span class="hljs-attr">&quot;_version&quot;</span> : <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">&quot;result&quot;</span> : <span class="hljs-string">&quot;created&quot;</span>,<br>  <span class="hljs-attr">&quot;_shards&quot;</span> : &#123;<br>    <span class="hljs-attr">&quot;total&quot;</span> : <span class="hljs-number">2</span>,<br>    <span class="hljs-attr">&quot;successful&quot;</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;failed&quot;</span> : <span class="hljs-number">0</span><br>  &#125;,<br>  <span class="hljs-attr">&quot;_seq_no&quot;</span> : <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">&quot;_primary_term&quot;</span> : <span class="hljs-number">1</span><br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// 建索引 不放数据</span><br>PUT /test2<br>&#123;<br>  <span class="hljs-attr">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;name&quot;</span>:&#123;<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;age&quot;</span>:&#123;<br>        <span class="hljs-attr">&quot;type&quot;</span>:<span class="hljs-string">&quot;long&quot;</span><br>      &#125;,<br>      <span class="hljs-attr">&quot;birthday&quot;</span>:&#123;<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span><br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /test/type/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json">POST /test/type/<span class="hljs-number">1</span>/_update<br>&#123;<br>    <span class="hljs-attr">&quot;doc&quot;</span>:&#123;<br>        <span class="hljs-attr">&quot;name&quot;</span>:<span class="hljs-string">&quot;dean2&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">DELETE test<br></code></pre></td></tr></table></figure><h1 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a>文档操作</h1><ul><li><p>根据属性查询</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /test1/type/_search<br>&#123;<br>  <span class="hljs-attr">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;dean3&quot;</span><br>    &#125;<br>  &#125;,<br>   <span class="hljs-attr">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;name&quot;</span>],<br>  <span class="hljs-attr">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-attr">&quot;age&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>      &#125;<br>    &#125;<br>  ],<br>  <span class="hljs-attr">&quot;from&quot;</span>: <span class="hljs-number">0</span>,<br>  <span class="hljs-attr">&quot;size&quot;</span>: <span class="hljs-number">20</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs json">#! Deprecation: [types removal] Specifying types in search requests is deprecated.<br>&#123;<br>  <span class="hljs-attr">&quot;took&quot;</span> : <span class="hljs-number">1</span>,<br>  <span class="hljs-attr">&quot;timed_out&quot;</span> : <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">&quot;_shards&quot;</span> : &#123;<br>    <span class="hljs-attr">&quot;total&quot;</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;successful&quot;</span> : <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;skipped&quot;</span> : <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">&quot;failed&quot;</span> : <span class="hljs-number">0</span><br>  &#125;,<br>  <span class="hljs-attr">&quot;hits&quot;</span> : &#123;<br>    <span class="hljs-attr">&quot;total&quot;</span> : &#123;<br>      <span class="hljs-attr">&quot;value&quot;</span> : <span class="hljs-number">1</span>,<br>      <span class="hljs-attr">&quot;relation&quot;</span> : <span class="hljs-string">&quot;eq&quot;</span><br>    &#125;,<br>    <span class="hljs-attr">&quot;max_score&quot;</span> : <span class="hljs-number">0.2876821</span>,<br>    <span class="hljs-attr">&quot;hits&quot;</span> : [<br>      &#123;<br>        <span class="hljs-attr">&quot;_index&quot;</span> : <span class="hljs-string">&quot;test1&quot;</span>,<br>        <span class="hljs-attr">&quot;_type&quot;</span> : <span class="hljs-string">&quot;type&quot;</span>,<br>        <span class="hljs-attr">&quot;_id&quot;</span> : <span class="hljs-string">&quot;1&quot;</span>,<br>        <span class="hljs-attr">&quot;_score&quot;</span> : <span class="hljs-number">0.2876821</span>,<br>        <span class="hljs-attr">&quot;_source&quot;</span> : &#123;<br>          <span class="hljs-attr">&quot;name&quot;</span> : <span class="hljs-string">&quot;dean3&quot;</span><br>        &#125;<br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h1 id="Springboot集成"><a href="#Springboot集成" class="headerlink" title="Springboot集成"></a>Springboot集成</h1><p>依赖，配置，使用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ElasticSearchConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">restHighLevelClient</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestHighLevelClient(<br>                RestClient.builder(<span class="hljs-keyword">new</span> HttpHost(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">9200</span>,<span class="hljs-string">&quot;http&quot;</span>))<br>        );<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> top.dean0731.esapi;<br><br><span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.delete.DeleteIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.bulk.BulkRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.delete.DeleteRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.get.GetRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.get.GetResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.index.IndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.index.IndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.search.SearchRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.search.SearchResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.support.master.AcknowledgedResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.action.update.UpdateRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RequestOptions;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.CreateIndexResponse;<br><span class="hljs-keyword">import</span> org.elasticsearch.client.indices.GetIndexRequest;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.unit.TimeValue;<br><span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<br><span class="hljs-keyword">import</span> org.elasticsearch.index.query.MatchAllQueryBuilder;<br><span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;<br><span class="hljs-keyword">import</span> org.elasticsearch.index.query.TermQueryBuilder;<br><span class="hljs-keyword">import</span> org.elasticsearch.search.SearchHit;<br><span class="hljs-keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;<br><span class="hljs-keyword">import</span> org.elasticsearch.search.fetch.subphase.FetchSourceContext;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> top.dean0731.esapi.pojo.User;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Title</span>: ElasticSearchTest</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Package</span> top.dean0731.esapi</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 测试类</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2021/1/30 14:22</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ElasticSearchTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>            <span class="hljs-meta">@Qualifier(&quot;restHighLevelClient&quot;)</span><br>    RestHighLevelClient restHighLevelClient;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// 索引操作</span><br>        CreateIndexRequest request = <span class="hljs-keyword">new</span> CreateIndexRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(request, RequestOptions.DEFAULT);<br>        System.out.println(createIndexResponse);<br>    &#125;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tes2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// 索引操作</span><br>        GetIndexRequest getIndexRequest = <span class="hljs-keyword">new</span> GetIndexRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        <span class="hljs-keyword">boolean</span> exists = restHighLevelClient.indices().exists(getIndexRequest, RequestOptions.DEFAULT);<br>        System.out.println(exists);<br>    &#125;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// 索引操作</span><br>        DeleteIndexRequest request = <span class="hljs-keyword">new</span> DeleteIndexRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        AcknowledgedResponse delete = restHighLevelClient.indices().delete(request, RequestOptions.DEFAULT);<br><br>    &#125;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        <span class="hljs-comment">// 索引操作</span><br>        CreateIndexRequest request = <span class="hljs-keyword">new</span> CreateIndexRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        CreateIndexResponse createIndexResponse = restHighLevelClient.indices().create(request, RequestOptions.DEFAULT);<br>        System.out.println(createIndexResponse);<br>    &#125;<br><br>    <span class="hljs-comment">// 文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        User user = <span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;dean&quot;</span>, <span class="hljs-number">1234</span>);<br>        IndexRequest index = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        index.id(<span class="hljs-string">&quot;1&quot;</span>);<br>        index.timeout(TimeValue.timeValueSeconds(<span class="hljs-number">1</span>));<br><br>        index.source(JSON.toJSONString(user), XContentType.JSON);<br><br>        IndexResponse index1 = restHighLevelClient.index(index, RequestOptions.DEFAULT);<br>        System.out.println(index1.toString());<br>        System.out.println(index1.status());<br>    &#125;<br>    <span class="hljs-comment">// 文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument2</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        GetRequest doucementRequest = <span class="hljs-keyword">new</span> GetRequest(<span class="hljs-string">&quot;es&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>        <span class="hljs-comment">// 不获取_source的上下文</span><br>        doucementRequest.fetchSourceContext(<span class="hljs-keyword">new</span> FetchSourceContext(<span class="hljs-keyword">false</span>));<br>        doucementRequest.storedFields(<span class="hljs-string">&quot;_none_&quot;</span>);<br>        <span class="hljs-keyword">boolean</span> exists = restHighLevelClient.exists(doucementRequest, RequestOptions.DEFAULT);<br>        System.out.println(exists);<br>    &#125;<br>    <span class="hljs-comment">// 文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument3</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        GetRequest doucementRequest = <span class="hljs-keyword">new</span> GetRequest(<span class="hljs-string">&quot;es&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>        GetResponse documentFields = restHighLevelClient.get(doucementRequest, RequestOptions.DEFAULT);<br>        System.out.print(documentFields.getSourceAsString());<br>    &#125;<br>    <span class="hljs-comment">// 更新文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument4</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        UpdateRequest updateRequest = <span class="hljs-keyword">new</span> UpdateRequest(<span class="hljs-string">&quot;es&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br>        updateRequest.timeout(<span class="hljs-string">&quot;1s&quot;</span>);<br>        String z = JSON.toJSONString(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;z&quot;</span>, <span class="hljs-number">18</span>));<br>        updateRequest.doc(z,XContentType.JSON);<br><br>        restHighLevelClient.update(updateRequest,RequestOptions.DEFAULT);<br>    &#125;<br>    <span class="hljs-comment">// 删除文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument5</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        DeleteRequest request = <span class="hljs-keyword">new</span> DeleteRequest(<span class="hljs-string">&quot;es&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>);<br>        request.timeout(<span class="hljs-string">&quot;1s&quot;</span>);<br>        restHighLevelClient.delete(request,RequestOptions.DEFAULT);<br>    &#125;<br>    <span class="hljs-comment">// 批量文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument6</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        BulkRequest bulkRequest = <span class="hljs-keyword">new</span> BulkRequest();<br>        bulkRequest.timeout(<span class="hljs-string">&quot;10s&quot;</span>);<br>        ArrayList&lt;User&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-number">1</span>));<br>        list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;2&quot;</span>,<span class="hljs-number">2</span>));<br>        list.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;3&quot;</span>,<span class="hljs-number">3</span>));<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; list.size(); i++) &#123;<br>            bulkRequest.add(<br>                    <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">&quot;es&quot;</span>)<br>                            .id(i+<span class="hljs-string">&quot;&quot;</span>)<br>                            .source(JSON.toJSONString(list.get(i)),XContentType.JSON));<br>        &#125;<br>        restHighLevelClient.bulk(bulkRequest,RequestOptions.DEFAULT);<br>    &#125;<br>    <span class="hljs-comment">// 查询文档操作</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testDocument7</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">&quot;es&quot;</span>);<br>        <span class="hljs-comment">// 构建搜索条件</span><br>        SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();<br><span class="hljs-comment">//        TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(&quot;name&quot;, &quot;1&quot;);// 精确查询</span><br><span class="hljs-comment">//        searchSourceBuilder.query(termQueryBuilder);</span><br>        MatchAllQueryBuilder matchAllQueryBuilder = QueryBuilders.matchAllQuery(); <span class="hljs-comment">// 匹配所有</span><br>        searchSourceBuilder.query(matchAllQueryBuilder);<br>        searchSourceBuilder.timeout(<span class="hljs-keyword">new</span> TimeValue(<span class="hljs-number">60</span>, TimeUnit.SECONDS));<br><br>        searchRequest.source(searchSourceBuilder);<br><br>        SearchResponse search = restHighLevelClient.search(searchRequest,RequestOptions.DEFAULT);<br>        System.out.println(JSON.toJSONString(search));<br>        System.out.println(<span class="hljs-string">&quot;===========================&quot;</span>);<br>        <span class="hljs-keyword">for</span> (SearchHit documentFields: search.getHits().getHits()) &#123;<br>            System.out.println(documentFields.getSourceAsMap());<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210130164922789.png" alt="image-20210130164922789"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210130165329853.png" alt="image-20210130165329853"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/docker_%E8%BF%9B%E9%98%B6/"/>
    <url>/2022/01/16/cnblog/docker_%E8%BF%9B%E9%98%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 安装工具包</span><br>yum install bridge-utils<br>yum install yum-utils<br><span class="hljs-meta">#</span><span class="bash"> 国内镜像位置</span><br>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br><span class="hljs-meta">#</span><span class="bash"> 更新索引</span><br>yum makecache fast<br><span class="hljs-meta">#</span><span class="bash"> 安装</span><br>yum install docker-ce docker-ce-cli containerd.io<br><span class="hljs-meta">#</span><span class="bash"> 启动</span><br>systemctl docker start<br><span class="hljs-meta">#</span><span class="bash"> 测试</span><br>docker run hello-world<br><span class="hljs-meta">#</span><span class="bash"> 卸载</span><br>systemctl stop docker<br>yum -y remove docker-ce  docker-ce-cli containerd.io<br>rm -rf /var/lib/docker<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 加速镜像</span><br>sudo mkdir -p /etc/docker<br>sudo tee /etc/docker/daemon.json&lt;&lt; -&#x27;EOF&#x27;<br>&#123;<br>&quot;registry-mirrors&quot;:[&quot;https://自己的阿里云加速地址&quot;]<br>&#125;<br>EOF<br>sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/09/10/IDslEXrPgf6w4cU.png" alt="image-20200910201125247"></p><p>Docker 基础，原理，网络，服务，集群，错误排查，日志</p><h1 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h1><ul><li><p>没有compose：dockerfile –》build–》run</p></li><li><p>高效的定义，管理，运行多个容器：批量容器编排</p><ul><li>定义DOCKERFILE</li><li>定义docker-compose.yml</li><li>docker-compose up</li></ul></li></ul><p>安装，官网下载很慢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.5/docker-compose-`uname -s`-`uname -m`&gt;/usr/local/docker-compose<br>chmod +x /usr/local/docker-compose<br>docker-compose version<br></code></pre></td></tr></table></figure><p>示例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir test<br>cd test<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># app.py</span><br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> redis<br><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask<br><br>app = Flask(__name__)<br>cache = redis.Redis(host=<span class="hljs-string">&#x27;redis&#x27;</span>, port=<span class="hljs-number">6379</span>)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_hit_count</span>():</span><br>    retries = <span class="hljs-number">5</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">return</span> cache.incr(<span class="hljs-string">&#x27;hits&#x27;</span>)<br>        <span class="hljs-keyword">except</span> redis.exceptions.ConnectionError <span class="hljs-keyword">as</span> exc:<br>            <span class="hljs-keyword">if</span> retries == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">raise</span> exc<br>            retries -= <span class="hljs-number">1</span><br>            time.sleep(<span class="hljs-number">0.5</span>)<br><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hello</span>():</span><br>    count = get_hit_count()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello World! I have been seen &#123;&#125; times.\n&#x27;</span>.<span class="hljs-built_in">format</span>(count)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> requirements.txt</span><br>flask<br>redis<br></code></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># Dockerfile</span><br><span class="hljs-keyword">FROM</span> python:<span class="hljs-number">3.7</span>-alpine<br><span class="hljs-keyword">WORKDIR</span><span class="bash"> /code</span><br><span class="hljs-keyword">ENV</span> FLASK_APP app.py<br><span class="hljs-keyword">ENV</span> FLASK_RUN_HOST <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apk add --no-cache gcc musl-dev linux-headers</span><br><span class="hljs-keyword">COPY</span><span class="bash"> requirements.txt requirements.txt</span><br><span class="hljs-keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">COPY</span><span class="bash"> . .</span><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;flask&quot;</span>, <span class="hljs-string">&quot;run&quot;</span>]</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># docker-compose.yml</span><br><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">web:</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span>   <span class="hljs-comment"># 使用当前Dockerfile构建镜像</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5000:5000&quot;</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">&quot;redis:alpine&quot;</span>  <span class="hljs-comment"># 使用现成镜像</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> build</span><br>docker-compose build<br><span class="hljs-meta">#</span><span class="bash"> 启动</span><br>docker-compose up -d<br></code></pre></td></tr></table></figure><ul><li><p>创建网络</p></li><li><p>执行docker-compose.yml</p></li><li><p>启动服务</p><ul><li>就是里面的镜像</li></ul></li><li><p>默认服务名：文件名_服务名__num（运行实例个数）</p></li><li><p>网络</p><ul><li>docker network ls</li><li>通过compose启动，就会生成网络，因此项目中网络都是一个</li><li>访问时不用ip，使用服务名，更简洁，在springboot配置文件中 spring.redis.host=redis</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><span class="hljs-attr">services:</span><br><br>  <span class="hljs-attr">redis:</span> <span class="hljs-comment"># 服务</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">redis:alpine</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;6379&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">db:</span> <span class="hljs-comment"># 服务</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:9.4</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db-data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">max_replicas_per_node:</span> <span class="hljs-number">1</span><br>        <span class="hljs-attr">constraints:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;node.role==manager&quot;</span><br><br>  <span class="hljs-attr">vote:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_vote:before</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5000:80&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">result:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_result:before</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5001:80&quot;</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">db</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">update_config:</span><br>        <span class="hljs-attr">parallelism:</span> <span class="hljs-number">2</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br><br>  <span class="hljs-attr">worker:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/examplevotingapp_worker</span><br>    <span class="hljs-attr">networks:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">frontend</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">backend</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">mode:</span> <span class="hljs-string">replicated</span><br>      <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span><br>      <span class="hljs-attr">labels:</span> [<span class="hljs-string">APP=VOTING</span>]<br>      <span class="hljs-attr">restart_policy:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">on-failure</span><br>        <span class="hljs-attr">delay:</span> <span class="hljs-string">10s</span><br>        <span class="hljs-attr">max_attempts:</span> <span class="hljs-number">3</span><br>        <span class="hljs-attr">window:</span> <span class="hljs-string">120s</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;node.role==manager&quot;</span><br><br>  <span class="hljs-attr">visualizer:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">dockersamples/visualizer:stable</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8080:8080&quot;</span><br>    <span class="hljs-attr">stop_grace_period:</span> <span class="hljs-string">1m30s</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br>    <span class="hljs-attr">deploy:</span><br>      <span class="hljs-attr">placement:</span><br>        <span class="hljs-attr">constraints:</span><br>          <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;node.role==manager&quot;</span><br><br><span class="hljs-attr">networks:</span><br>  <span class="hljs-attr">frontend:</span><br>  <span class="hljs-attr">backend:</span><br><br><span class="hljs-attr">volumes:</span><br>  <span class="hljs-attr">db-data:</span><br></code></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment"># java dockerfile例子</span><br><span class="hljs-keyword">FROM</span> java:<span class="hljs-number">8</span><br><span class="hljs-keyword">COPY</span><span class="bash"> *.jar /app.jar</span><br><span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;--server.port=8888&quot;</span>]</span><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8888</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;-jar&quot;</span>,<span class="hljs-string">&quot;/app.jar&quot;</span>]</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attr">services:</span><br><span class="hljs-attr">javaservice:</span><br><span class="hljs-attr">build:</span> <span class="hljs-string">.</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">javaservice</span><br><span class="hljs-attr">depends_on:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">redis</span><br><span class="hljs-attr">ports:</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">&quot;8888:8888&quot;</span><br><span class="hljs-attr">redis:</span><br><span class="hljs-attr">image:</span> <span class="hljs-string">&quot;redis:alpine&quot;</span><br></code></pre></td></tr></table></figure><h1 id="集群-Docker-Swarm"><a href="#集群-Docker-Swarm" class="headerlink" title="集群 Docker Swarm"></a>集群 Docker Swarm</h1><ul><li>集群方式部署，主机更多的时候使用k8s<ul><li>xshell命令同步操作安装docker</li></ul></li><li>工作模式</li></ul><p><img src="https://i.loli.net/2020/09/10/ObfJdk1ZEn8MaCN.png" alt="image-20200910213320141"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> swarm 集群初始化</span><br>docker swarm init --advertise-addr ip1 # 初始化节点 默认是lader，是管理节点<br><span class="hljs-meta">#</span><span class="bash"> 令牌生成</span><br>docker swarm join-token worker<br>docker swarm join-token manager<br><span class="hljs-meta">#</span><span class="bash"> 加入集群work。manager使用令牌加入</span><br><span class="hljs-meta">#</span><span class="bash"> worker，manager：Reachable，loader</span><br><span class="hljs-meta">#</span><span class="bash"> 一般情况管理节点大于等于3个，此时有损坏的开可以使用，若2管理节点，损坏一个后就不能使用了，即最少2个管理可使用，否则就会docker集群就不能使用了，raft协议：保证大多数节点存活</span><br><span class="hljs-meta">#</span><span class="bash"> docker node ls 查看节点</span><br><span class="hljs-meta">#</span><span class="bash"> docker swarm leave 离开集群</span><br></code></pre></td></tr></table></figure><p>docker service，之前的集群，不能动态扩容，缩容</p><ul><li>容器—》服务–》副本</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> nginx 集群</span><br><span class="hljs-meta">#</span><span class="bash"> 服务启动 滚动更新，扩容，缩容，docker run不可以</span><br>docker service -p 8888:80 --name my_nginx nginx # 会随机在worker启动<br><span class="hljs-meta">#</span><span class="bash"> 查看服务信息</span><br>docker service ps my_nginx<br><span class="hljs-meta">#</span><span class="bash"> 查看服务列表</span><br>docker service ls<br><span class="hljs-meta">#</span><span class="bash"> my_nginx 创建副本</span><br>docker service update --relipcas 3 my_nginx<br><span class="hljs-meta">#</span><span class="bash"> 作用同上</span><br>docker service scale my_nginx=3<br><span class="hljs-meta">#</span><span class="bash"> 访问时访问集群中任何一个都可以 https://ip1:8888,https://ip2:8888,即使ip2没有服务，但它在集群中</span><br><span class="hljs-meta">#</span><span class="bash"> 缩小</span><br>docker service update --relipcas 1 my_nginx<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> 移除服务</span><br>docker service rm my_nginx<br></code></pre></td></tr></table></figure><p>扩展：网络模式</p><p>overlay：集群中不同主机上的docker是不能ping的，此模式使用虚拟ip，完成此功能</p><p>imgress：overlay的进一步开发，有负载均衡作用</p><h1 id="Docker-stack"><a href="#Docker-stack" class="headerlink" title="Docker stack"></a>Docker stack</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 单机docker-compose</span><br>docker-compose up -d<br><span class="hljs-meta">#</span><span class="bash"> 集群docker stack</span><br>docker stack deploy<br><span class="hljs-meta">#</span><span class="bash"> 也是基于yaml文件，与compose格式类似</span><br></code></pre></td></tr></table></figure><h1 id="Docker-secret"><a href="#Docker-secret" class="headerlink" title="Docker secret"></a>Docker secret</h1><p>统一秘钥管理</p><h1 id="Docker-config"><a href="#Docker-config" class="headerlink" title="Docker config"></a>Docker config</h1><p>统一配置管理</p><h1 id="扩展到k8s"><a href="#扩展到k8s" class="headerlink" title="扩展到k8s"></a>扩展到k8s</h1><ul><li><p>云原生时代，直接云端下载应用，购买服务器，部署k8s即可使用</p></li><li><p>go语言，天生的并发语言，docker，kvs，v8等都是go开发的</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/docker%20%E9%83%A8%E7%BD%B2oracle/"/>
    <url>/2022/01/16/cnblog/docker%20%E9%83%A8%E7%BD%B2oracle/</url>
    
    <content type="html"><![CDATA[<h1 id="Oracle数据库服务器Docker映像文档"><a href="#Oracle数据库服务器Docker映像文档" class="headerlink" title="Oracle数据库服务器Docker映像文档"></a>Oracle数据库服务器Docker映像文档</h1><p>Oracle Database Server 12c R2是行业领先的关系数据库服务器。Oracle数据库服务器Docker映像包含在Oracle Linux 7上运行的Oracle数据库服务器12.2.0.1企业版。该映像包含具有一个pdb的多租户配置中的默认数据库。</p><p>有关Oracle Database Server 12c R2的更多信息，请参考<a href="http://docs.oracle.com/en/database/">http://docs.oracle.com/en/database/</a></p><h3 id="登录Docker商店"><a href="#登录Docker商店" class="headerlink" title="登录Docker商店"></a>登录Docker商店</h3><p>使用您的凭证登录Docker Store</p><p><code>$ docker login</code></p><h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><p><code>$ docker pull store/oracle/database-enterprise:12.2.0.1</code></p><h3 id="启动Oracle数据库服务器实例"><a href="#启动Oracle数据库服务器实例" class="headerlink" title="启动Oracle数据库服务器实例"></a>启动Oracle数据库服务器实例</h3><p>启动Oracle数据库服务器实例就像执行一样简单</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; store/oracle/database-enterprise:12.2.0.1</code></p><p>其中<code>&lt;Oracle-DB&gt;</code>，容器的名称<code>12.2.0.1</code>是Docker映像标签。</p><p>当该<code>STATUS</code>字段显示<code>(healthy)</code>在的输出中时，数据库服务器就可以使用了<code>docker ps</code>。</p><h3 id="连接到数据库服务器容器"><a href="#连接到数据库服务器容器" class="headerlink" title="连接到数据库服务器容器"></a>连接到数据库服务器容器</h3><p>使用<code>sys</code>用户连接到数据库的默认密码是<code>Oradoc_db1</code>。</p><h4 id="从容器内部连接"><a href="#从容器内部连接" class="headerlink" title="从容器内部连接"></a>从容器内部连接</h4><p>可以通过执行SQL * Plus来连接数据库服务器，</p><p><code>$ docker exec -it &lt;Oracle-DB&gt; bash -c &quot;source /home/oracle/.bashrc; sqlplus /nolog&quot;</code></p><h4 id="从容器外部连接"><a href="#从容器外部连接" class="headerlink" title="从容器外部连接"></a>从容器外部连接</h4><p>数据库服务器为通过SQL <em>Net协议的</em> Oracle客户端连接公开端口1521，<em>为Oracle XML DB</em>公开端口<em>5500。</em>可以使用<em>SQL</em> Plus或任何JDBC客户端从容器外部连接到数据库服务器。</p><p>要从容器外部进行连接，请使用<code>-P</code>或<code>-p</code>选项as来启动容器，</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; -P store/oracle/database-enterprise:12.2.0.1</code></p><p>选项<code>-P</code>表示端口由Docker分配。通过执行以下操作可以发现映射的端口</p><p><code>$ docker port &lt;Oracle-DB&gt;</code> <code>1521/tcp -&gt; 0.0.0.0:&lt;mapped host port&gt;</code></p><p>使用它<code>&lt;mapped host port&gt;</code>并在环境变量指向的目录中<code>&lt;ip-address of host&gt;</code>创建。<code>tnsnames.ora``TNS_ADMIN</code></p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">ORCLCDB=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=&lt;ip-address of host&gt;)(PORT=&lt;mapped host port&gt;))<br>    (CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=ORCLCDB.localdomain)))<br>ORCLPDB1=(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=&lt;ip-address&gt; of host)(PORT=&lt;mapped host port&gt;))<br>    (CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=ORCLPDB1.localdomain)))<br></code></pre></td></tr></table></figure><p>要使用SQL * Plus从容器外部进行连接，</p><p><code>$ sqlplus sys/Oradoc_db1@ORCLCDB as sysdba</code></p><h3 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h3><p>Oracle数据库服务器容器还提供用于启动容器的自定义配置参数。所有自定义配置参数都是可选的。可以在ENV文件（<code>ora.conf</code>）中提供以下自定义配置参数列表。</p><h4 id="DB-SID"><a href="#DB-SID" class="headerlink" title="DB_SID"></a><code>DB_SID</code></h4><p>此参数更改<code>ORACLE_SID</code>数据库的。默认值设置为 <code>ORCLCDB</code>。</p><h4 id="DB-PDB"><a href="#DB-PDB" class="headerlink" title="DB_PDB"></a><code>DB_PDB</code></h4><p>此参数修改PDB的名称。默认值设置为<code>ORCLPDB1</code>。</p><h4 id="DB-MEMORY"><a href="#DB-MEMORY" class="headerlink" title="DB_MEMORY"></a><code>DB_MEMORY</code></h4><p>此参数设置Oracle服务器的内存要求。此值确定要为SGA和PGA分配的内存量。默认值设置为2GB。</p><h4 id="DB-DOMAIN"><a href="#DB-DOMAIN" class="headerlink" title="DB_DOMAIN"></a><code>DB_DOMAIN</code></h4><p>此参数设置要用于数据库服务器的域。默认值为 <code>localdomain</code>。</p><p>使用自定义配置参数启动Oracle数据库服务器</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; -P --env-file ora.conf store/oracle/database-enterprise:12.2.0.1</code></p><p>确保的自定义值<code>DB_SID</code>，<code>DB_PDB</code>并<code>DB_DOMAIN</code>在tnsnames.ora中更新。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>该Docker映像具有以下限制。</p><ol><li>支持单个实例数据库。</li><li>不支持Dataguard。</li><li>不支持数据库选项和修补程序。</li></ol><h2 id="修改SYS用户默认密码"><a href="#修改SYS用户默认密码" class="headerlink" title="修改SYS用户默认密码"></a>修改SYS用户默认密码</h2><p>使用默认密码启动Oracle数据库服务器<code>Oradoc_db1</code>。创建容器时使用的密码不安全，应更改。要更改密码，请使用SQL * Plus连接到数据库并执行</p><p><code>alter user sys identified by &lt;new-password&gt;;</code></p><h2 id="资源需求"><a href="#资源需求" class="headerlink" title="资源需求"></a>资源需求</h2><p>容器的最低要求是8GB磁盘空间和2GB内存。</p><h2 id="数据库日志"><a href="#数据库日志" class="headerlink" title="数据库日志"></a>数据库日志</h2><p>可以使用以下命令查看数据库警报日志</p><p><code>$ docker logs &lt;Oracle-DB&gt;</code></p><p>哪里 是容器的名称</p><h2 id="重用现有数据库"><a href="#重用现有数据库" class="headerlink" title="重用现有数据库"></a>重用现有数据库</h2><p>该Oracle数据库服务器映像使用Docker数据卷来存储数据文件，重做日志，审核日志，警报日志和跟踪文件。数据量安装在的容器内部<code>/ORCL</code>。要使用<code>docker run</code>命令启动具有数据量的数据库，</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; -v OracleDBData:/ORCL store/oracle/database-enterprise:12.2.0.1</code></p><p><code>OracleDBData</code>是Docker创建并安装在容器内部的数据卷<code>/ORCL</code>。通过重用<code>OracleDBData</code>数据卷，可以将持久化的数据文件与另一个容器重用。</p><h2 id="使用主机系统目录进行数据量"><a href="#使用主机系统目录进行数据量" class="headerlink" title="使用主机系统目录进行数据量"></a>使用主机系统目录进行数据量</h2><p>要将主机系统上的目录用于数据量，</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; -v /data/OracleDBData:/ORCL store/oracle/database-enterprise:12.2.0.1</code></p><p><code>/data/OracleDBData</code>主机系统中的目录在哪里。</p><h2 id="Oracle-Database-Server-12-2-0-1企业版Slim-Variant"><a href="#Oracle-Database-Server-12-2-0-1企业版Slim-Variant" class="headerlink" title="Oracle Database Server 12.2.0.1企业版Slim Variant"></a>Oracle Database Server 12.2.0.1企业版Slim Variant</h2><p><code>12.2.0.1-slim</code>EE 的Slim Variant（标签）减少了磁盘空间（4GB）的要求，并加快了容器的启动速度。该映像不支持以下功能-分析，Oracle R，Oracle标签安全性，Oracle文本，Oracle Application Express和Oracle DataVault。使用苗条的变体</p><p><code>$ docker run -d -it --name &lt;Oracle-DB&gt; store/oracle/database-enterprise:12.2.0.1-slim</code></p><p>其中<code>&lt;Oracle-DB&gt;</code>，容器的名称<code>12.2.0.1-slim</code>是Docker映像标签。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/docker%20%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    <url>/2022/01/16/cnblog/docker%20%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91/</url>
    
    <content type="html"><![CDATA[<h2 id="1-登录阿里云Docker-Registry"><a href="#1-登录阿里云Docker-Registry" class="headerlink" title="1. 登录阿里云Docker Registry"></a>1. 登录阿里云Docker Registry</h2><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo docker login --username=xxxx registry.cn-beijing.aliyuncs.com</span><br></code></pre></td></tr></table></figure><p>​    用于登录的用户名为阿里云账号全名，密码为开通服务时设置的密码。</p><p>​    您可以在访问凭证页面修改凭证密码。</p><h2 id="2-从Registry中拉取镜像"><a href="#2-从Registry中拉取镜像" class="headerlink" title="2. 从Registry中拉取镜像"></a>2. 从Registry中拉取镜像</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo docker pull registry.cn-beijing.aliyuncs.com/dean0731/mysql:[镜像版本号]</span><br></code></pre></td></tr></table></figure><h2 id="3-将镜像推送到Registry"><a href="#3-将镜像推送到Registry" class="headerlink" title="3. 将镜像推送到Registry"></a>3. 将镜像推送到Registry</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo docker login --username=youremail registry.cn-beijing.aliyuncs.com</span><br><span class="hljs-meta">$</span><span class="bash"> sudo docker tag [ImageId] registry.cn-beijing.aliyuncs.com/dean0731/mysql:[镜像版本号]</span><br><span class="hljs-meta">$</span><span class="bash"> sudo docker push registry.cn-beijing.aliyuncs.com/dean0731/mysql:[镜像版本号]</span><br></code></pre></td></tr></table></figure><p>​    请根据实际镜像信息替换示例中的[ImageId]和[镜像版本号]参数。</p><h2 id="4-选择合适的镜像仓库地址"><a href="#4-选择合适的镜像仓库地址" class="headerlink" title="4. 选择合适的镜像仓库地址"></a>4. 选择合适的镜像仓库地址</h2><p>​    从ECS推送镜像时，可以选择使用镜像仓库内网地址。推送速度将得到提升并且将不会损耗您的公网流量。</p><p>​    如果您使用的机器位于VPC网络，请使用 registry-vpc.cn-beijing.aliyuncs.com 作为Registry的域名登录，并作为镜像命名空间前缀。</p><h2 id="5-示例"><a href="#5-示例" class="headerlink" title="5. 示例"></a>5. 示例</h2><p>​    使用”docker tag”命令重命名镜像，并将它通过专有网络地址推送至Registry。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo docker imagesREPOSITORY                                                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZEregistry.aliyuncs.com/acs/agent                                    0.7-dfb6816         37bb9c63c8b2        7 days ago          37.89 MB</span><br><span class="hljs-meta">$</span><span class="bash"> sudo docker tag 37bb9c63c8b2 registry-vpc.cn-beijing.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></code></pre></td></tr></table></figure><p>​    使用”docker images”命令找到镜像，将该镜像名称中的域名部分变更为Registry专有网络地址。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo docker push registry-vpc.cn-beijing.aliyuncs.com/acs/agent:0.7-dfb6816</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/docker/"/>
    <url>/2022/01/16/cnblog/docker/</url>
    
    <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><ol><li><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul><li>开源的应用容器引擎，基于Go语言</li><li>完全隔离的沙箱机制，类似app之间的关系</li><li>重要的是性能开销极低<ul><li>程序简化</li><li>docker镜像中包含环境，服务环境搭建简单</li></ul></li></ul></li><li><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ol><li>web自动打包发布</li><li>自动化测试</li><li>在服务型环境中部署，调整 应用</li></ol></li><li><h2 id="Docker引擎"><a href="#Docker引擎" class="headerlink" title="Docker引擎"></a>Docker引擎</h2><ol><li><p>包含以下组件的客户端服务器应用程序</p><ul><li><p>一种服务器，一种称为守护进程并长时间运行的程序</p></li><li><p>REST API  用于指定程序可以用来与守护进程通信的接口</p></li><li><p>一个有命令行界面的CLI工具的客户端</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191201143005314-2075851831.png"></p></li></ul></li></ol></li></ol><ol start="4"><li><h2 id="Docker系统架构"><a href="#Docker系统架构" class="headerlink" title="Docker系统架构"></a>Docker系统架构</h2><ol><li><p>使用客户端-服务器架构模式，使用远程api来管理和创建Docker容器</p></li><li><p>Docker容器通过Docker镜像来创建</p></li><li><p>关系：容器—》对象，镜像——》类</p><ol><li>镜像封装了基本的属性</li><li>真正操作的是容器，</li></ol></li><li><p>docker pull —-&gt;守护进程—》创建两个容器——》本机存在镜像的时候直接创建，否则到docker库下载</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191201143032471-2123296837.png"></p></li></ol></li></ol><ol start="5"><li><h2 id="Docker安装"><a href="#Docker安装" class="headerlink" title="Docker安装"></a>Docker安装</h2><ol><li><p>可以安装在windwos，mac，linux</p></li><li><p>前提条件</p><ol><li>若为linux只适用于64位</li><li>linux内核要大于3.10</li></ol></li><li><h5 id="一般使用脚本安装（linux环境ubuntu）"><a href="#一般使用脚本安装（linux环境ubuntu）" class="headerlink" title="一般使用脚本安装（linux环境ubuntu）"></a>一般使用脚本安装（linux环境ubuntu）</h5><ol><li><p>使用在线安装脚本</p><ol><li><p>curl -sSL <a href="https://get.daocloud.io/docker">https://get.daocloud.io/docker</a> | sh</p></li><li><p>执行后会下载安装包</p><p>若报错表示未更新数据源，/etc/apt/source.list 可更新为阿里云的数据源 apt-get update</p></li><li><p>再次执行1即可</p><p>与网络环境有关，失败再次尝试即可</p></li></ol><p> 或直接：sudo apt-get install -y docker.io</p></li><li><p>默认安装的是client，server</p><ol><li>root 可操作两个版本，普通用户只能使用client</li><li>sudo usermod -aG docker 用户名 ，普通用户加入docker组即可（重新登陆生效或newgrp docker 生效）</li></ol></li><li><p>配置加速器</p><ol><li><p>docker镜像都在海外</p></li><li><p>vim /lib/systemd/system/docker.service</p></li><li><p>添加 –registry-mirror=<a href="https://jxus37ac.mirror.aliyuncs.com/">https://jxus37ac.mirror.aliyuncs.com</a> 到ExecStart</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">ExecStart=/usr/bin/dockerd --registry-mirror=https://jxus37ac.mirror.aliyuncs.com<br></code></pre></td></tr></table></figure></li><li><p>重启docker 服务</p></li></ol></li></ol></li></ol></li><li><h2 id="第一个Docker应用程序"><a href="#第一个Docker应用程序" class="headerlink" title="第一个Docker应用程序"></a>第一个Docker应用程序</h2><ol><li><p>```shell<br>docker run ubuntu:15.10 /bin/echo “hello Docker”</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vim"><br>   从网上下载ubuntu15.<span class="hljs-number">10</span> 的镜像，创建一个容器 ，使用容器打印 “hello docker<span class="hljs-comment">&quot;</span><br><br>   运行完毕就会释放<br><br><span class="hljs-number">2</span>. ```<span class="hljs-keyword">shell</span><br>   docker images<br></code></pre></td></tr></table></figure><p>查看所有的镜像</p></li><li><p>```shell<br>docker ps</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   查看启动中的容器， -a 参数 查看所有的，包括结束的<br><br><span class="hljs-number">4</span>. ```shell<br>   docker rm containerID<br></code></pre></td></tr></table></figure><p>删除容器，id很长，通常情况下只适用前n位也可</p><p>rmi 可删除镜像</p></li><li><p>```shell<br>docker run -it ubuntu:15.10 /bin/bash</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   占用主线程的交互式容器，即可进入Ubuntu容器 root命令行<br><br><span class="hljs-number">6</span>. ```shell<br><span class="hljs-title">   docker run -d ubuntu:</span><span class="hljs-number">15.10</span> /bin/bash -c <span class="hljs-string">&quot;while true:do echo hello docker;sleep 1;done&quot;</span><br></code></pre></td></tr></table></figure><p>后台运行 -d表示在后台</p></li><li><p>```shell<br>docker logs containerId</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   查看容器日志，加参数 -f可动态查看<br><br><span class="hljs-number">8</span>. ```shell<br>   docker stop containerId<br></code></pre></td></tr></table></figure><p>停止容器</p></li><li><p>```shell<br>docker exec -it containerId /bin/bash</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><br><span class="hljs-code">      适用bash与正在运行的容器进行交互</span><br><span class="hljs-code"></span><br><span class="hljs-bullet">7.</span> ## Docker客户端<br><br><span class="hljs-bullet">   1.</span> <span class="hljs-code">```shell</span><br><span class="hljs-code">      docker COMMAND --help</span><br></code></pre></td></tr></table></figure><p>所有命令help文档</p></li></ol></li><li><h2 id="运行web容器"><a href="#运行web容器" class="headerlink" title="运行web容器"></a>运行web容器</h2><ol><li><p>```shell<br>docker run -d -P training/webapp python app.py</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim"><br>   在一个完整的操作系统上运行<span class="hljs-keyword">python</span>程序<br><br>   -<span class="hljs-keyword">P</span>:表示把容器的端口映射到宿主机，宿主机随机一个端口映射到容器 docker <span class="hljs-keyword">ps</span> 查看<br><br>   镜像为training/webapp    它是一个flask程序<br><br>   运行命令<span class="hljs-keyword">python</span> app.<span class="hljs-keyword">py</span><br><br><span class="hljs-number">2</span>. 可以将自己写的java等打包成容器<br><br><span class="hljs-number">3</span>. ```<span class="hljs-keyword">shell</span><br>   docker run -d -<span class="hljs-keyword">p</span> <span class="hljs-number">4000</span>:<span class="hljs-number">5000</span> training/webapp <span class="hljs-keyword">python</span> app.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure><p>-p:可以指定访问端口 宿主机4000，容器5000</p></li><li><p>```shell<br>docker top containerId<br>docker top names</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   查看容器中的进程<br><br><span class="hljs-number">5</span>. ```shell<br>   docker inspect<br></code></pre></td></tr></table></figure><p>查看容器状态：json字符格式</p></li><li><p>docker 安装后会产生一个虚拟网卡，mac等，容器产生的Ip都是基于虚拟网卡的</p></li><li><p>```shell<br>docker tag containerId imageName:newTag</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   出现一个新的image，与上个同名，tag不同，        设置镜像标签<br><br><span class="hljs-number">8</span>. ```shell<br>   docker rm containerId1  containerId2<br></code></pre></td></tr></table></figure><p>同时移除多个容器</p></li></ol></li><li><h2 id="Docker镜像管理"><a href="#Docker镜像管理" class="headerlink" title="Docker镜像管理"></a>Docker镜像管理</h2><ol><li><p>若使用的镜像不存在会从 <a href="https://hub.docker.com">Docker Hub</a> 下载</p></li><li><p>```shell<br>docker pull tomcat<br>docker pull tomcat:8.5.49-jdk11-openjdk</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>   获取镜像，默认获取最新版本,也可以指定版本获取<br><br><span class="hljs-number">3</span>. ```shell<br>   docker search tomcat<br></code></pre></td></tr></table></figure><p>查找镜像,一般选择官方的，使用docker pull name 获取，</p><p>starts 表示的是使用量，可作为评价标准 </p><p><img src="https://img2018.cnblogs.com/blog/1333782/201912/1333782-20191201143136007-730708785.png"></p></li></ol></li></ol><ol start="4"><li><p>创建镜像</p><ol><li><p>从已经创建的容器中更新镜像，并且提交这个镜像</p><ol><li><p>交互式运行ubuntu，进入bash</p></li><li><p>apt-get update </p><ol><li>可能会报错，数据源错误</li><li>需要修改容器内source.list</li><li>vim 修改即可，若没有vim命令，可使用echo 命令覆盖文件</li></ol></li><li><p>退出容器，此时若不提交，以上的操作下次生成容器时会重置</p></li><li><p>```shell<br>docker commit -m=”has update” -a=”userName” containerId  newImageName:Tag(随便)</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><br>      修改源镜像------》提交为一个新的镜像<br><br><span class="hljs-number">2</span>. 使用DockerFile指令来创建镜像<br><br>   <span class="hljs-number">1</span>. 真正的创建镜像<br><br>   <span class="hljs-number">2</span>. ```<span class="hljs-keyword">shell</span><span class="bash"></span><br><span class="bash">      mkdir myUbuntu</span><br>      cd myUbuntu<br>      vi Dockerfile <span class="hljs-comment">#(名字不要更改)</span><br>          <span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">15.10</span> <span class="hljs-comment"># 系统</span><br>          <span class="hljs-keyword">MAINTAINER</span> your-email<br>          <span class="hljs-keyword">COPY</span><span class="bash"> test.txt /home <span class="hljs-comment"># 将宿主机的文件test.txt copy 到镜像的home下</span></span><br>          <span class="hljs-keyword">RUN</span><span class="bash"> /bin/bash -c <span class="hljs-string">&quot;Hello world&quot;</span> <span class="hljs-comment"># 指定镜像默认执行的命令</span></span><br>          <span class="hljs-keyword">CMD</span><span class="bash"> [<span class="hljs-string">&quot;/bin/echo&quot;</span>，<span class="hljs-string">&quot;this is param1&quot;</span>] <span class="hljs-comment"># 文件中只能有一个cmd,有多个会只执行第一个</span></span><br>          <span class="hljs-keyword">WORKDIR</span><span class="bash"> /home <span class="hljs-comment"># 指定默认的工作目录</span></span><br>          <span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">80</span> <span class="hljs-comment"># 暴露端口</span><br>          <span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">8080</span><br>      docker build -t yourImageName . <span class="hljs-comment"># 在当前目录查找dockerfile 为改文件的镜像命名</span><br></code></pre></td></tr></table></figure></li></ol></li></ol></li><li><h2 id="Docker实例教程"><a href="#Docker实例教程" class="headerlink" title="Docker实例教程"></a>Docker实例教程</h2><ol><li><p>```shell</p><h1 id="使用docker-后台运行tomcat容器-并做端口映射，并修改容器的默认名字为tomcat，"><a href="#使用docker-后台运行tomcat容器-并做端口映射，并修改容器的默认名字为tomcat，" class="headerlink" title="使用docker 后台运行tomcat容器 并做端口映射，并修改容器的默认名字为tomcat，"></a>使用docker 后台运行tomcat容器 并做端口映射，并修改容器的默认名字为tomcat，</h1><p>docker run –name tomcat -p 8080:8080 -d tomcat</p><h1 id="若要在容器内tomcat-部署程序，交互式进入，写自己的html即可"><a href="#若要在容器内tomcat-部署程序，交互式进入，写自己的html即可" class="headerlink" title="若要在容器内tomcat 部署程序，交互式进入，写自己的html即可"></a>若要在容器内tomcat 部署程序，交互式进入，写自己的html即可</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br><span class="hljs-number">2</span>. ```shell<br>   docker pull mysql <span class="hljs-comment"># 拉去mysql 镜像</span><br>   docker run -p <span class="hljs-number">3306</span>:<span class="hljs-number">3306</span> -name mysql \<br>   -v <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/deoker/my</span>sql<span class="hljs-regexp">/conf:/</span>etc/mysql \ <span class="hljs-comment"># 映射宿主机目录到容器目录</span><br>   -v <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/docker/my</span>sql<span class="hljs-regexp">/logs:/</span>val<span class="hljs-regexp">/log/my</span>sql \ <span class="hljs-comment"># -v 数据卷</span><br>   -v <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/docker/my</span>sql<span class="hljs-regexp">/data:/</span>var<span class="hljs-regexp">/lib/my</span>sql \<br>   -e MYSQL_ROOT_PASSWORD=<span class="hljs-number">123456</span> \ <span class="hljs-comment"># -e 指定环境边变量</span><br>   -d mysql<br>   <span class="hljs-comment"># 若以后要重新运行时，密码变更了，需要删除宿主机下原来的数据卷，否则会不生效，还使用原来的配置。</span><br></code></pre></td></tr></table></figure></li><li><p>```shell<br>vim Dockerfile</p><div class="code-wrapper"><pre><code class="hljs">FROM tomcatMAINTAINER emailADD xxx.war /usr/local/tomcat/webapps/xxx.war # 添加war包到容器</code></pre></div><p>docker build -t name . # 构建镜像<br>docker run -d -p 8080:8080 imageName</p><h1 id="本方式是直接将war打入本镜像，比较麻烦，可使用数据卷解决"><a href="#本方式是直接将war打入本镜像，比较麻烦，可使用数据卷解决" class="headerlink" title="本方式是直接将war打入本镜像，比较麻烦，可使用数据卷解决"></a>本方式是直接将war打入本镜像，比较麻烦，可使用数据卷解决</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>       部署项目<br><br><span class="hljs-number">11</span>. <span class="hljs-comment">## 数据卷</span><br><br>    <span class="hljs-number">1</span>. 优点<br><br>       <span class="hljs-number">1</span>. 绕过拷贝写，修改容器内容相当于直接修改宿主机内容，性能高<br>       <span class="hljs-number">2</span>. 不需要在docker commit 打包进镜像文件<br>       <span class="hljs-number">3</span>. 宿主，容器，容器之间共享文件<br><br>    <span class="hljs-number">2</span>. 创建数据卷<br><br>       <span class="hljs-number">1</span>. 方法一<br><br>          ```shell<br>          docker run -d -P -v <span class="hljs-regexp">/webapps training/</span>webapps python app.py<br>          <span class="hljs-comment"># 将tomcat容器的目录映射到宿主目录，即时原容器目录有内容也不可用</span><br>          docker run -name tomcat1 -d -p <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> -v<br>          <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/docker/</span>tomcat<span class="hljs-regexp">/share/</span>webapps:<br>          <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/tomcat/</span>webapps tomcat<br></code></pre></td></tr></table></figure><ol start="2"><li><p>方法二</p><p>dockerfile中指定   VOLUME /var/lib/test</p></li></ol></li><li><p>备份数据卷</p><ol><li>```shell<br>docker run -p 3306:3306 -name mysql <br>-v /usr/local/deoker/mysql/conf:/etc/mysql \<br>-v /usr/local/docker/mysql/logs:/val/log/mysql \<br>-v /usr/local/docker/mysql/data:/var/lib/mysql <br>-e MYSQL_ROOT_PASSWORD=123456 \<br>-d mysql<h1 id="启动数据库"><a href="#启动数据库" class="headerlink" title="启动数据库"></a>启动数据库</h1><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk"><br>       <span class="hljs-number">2</span>. 连接容器内数据库，做出修改<br><br>       <span class="hljs-number">3</span>. 进入宿主机的数据卷，直接备份docker/mysql目录即可<br><br>          tar -zcvf backup.tar.gz .<br><br>    <span class="hljs-number">4</span>. 恢复数据卷，其重新的容器时，挂载备份的文件即可<br><br><span class="hljs-number">12</span>. <span class="hljs-comment">## Docker Compose</span><br><br>    <span class="hljs-number">1</span>. 简化docker操作的工具<br><br>    <span class="hljs-number">2</span>. 安装docker-compose<br><br>       ```shell<br>       curl -L https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/docker/</span>compose<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/1.25.0/</span>docker-compose-`uname -s`-`uname -m` -o <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/bin/</span>docker-compose<br>       <span class="hljs-comment"># 或直接下载上传即可</span><br>       <br></code></pre></td></tr></table></figure></li></ol><p>重命名为docker-compose，</p><p>放入环境变量目录</p><p>chown -R root:root docker-compose  赋给root</p><p>chmod +x docker-compose 加执行权限</p></li><li><p>docker-compose 使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 启用tomca容器</span><br><span class="hljs-meta">#</span><span class="bash"> 原始方法：docker run .......</span><br><span class="hljs-meta">#</span><span class="bash"> docker-compose</span><br>mkdir tomcat;cd tomcat<br>vim docker-compose.yml # yml 语言<br>version: &quot;3&quot; # compose的版本号决定<br>services:<br> tomcat: # 服务名字，可变的<br>  restart:always<br>  image:tomcat<br>  container_name:tomcat<br>  ports:<br>  - &quot;8080:8080&quot;<br>docker-compose up # 此时是主线程启动<br>docker-compose down # 停止，并删除<br></code></pre></td></tr></table></figure></li><li><p>```shell<br>docker-compose up -d # 后台运行 必须在docker-compose.yml所在的目录</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs dts"><br><span class="hljs-number">5.</span> ```shell<br><span class="hljs-symbol">   version:</span> <span class="hljs-string">&quot;3&quot;</span><br><span class="hljs-symbol">   services:</span><br><span class="hljs-symbol">    tomcat:</span><br><span class="hljs-symbol">     restart:</span>always<br><span class="hljs-symbol">     image:</span>tomcat<br><span class="hljs-symbol">     container_name:</span>tomcat<br><span class="hljs-symbol">     ports:</span><br>      - <span class="hljs-string">&quot;8080:8080&quot;</span><br><span class="hljs-symbol">     volumes:</span><br>      - <span class="hljs-string">&quot;/usr/local/docker/tomcat/webapps/test:/usr/local/tomcat/webapps/test&quot;</span><br><span class="hljs-symbol">     environment:</span><br><span class="hljs-symbol">      TZ:</span> Asia/Shanghai<br></code></pre></td></tr></table></figure></li><li><p>```shell</p><h1 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h1><p>version: “3”<br>services:<br> mysql:<br>  restart: always<br>  image:mysql<br>  container_name:mysql<br>  port:</p><ul><li>3306:3306<br>environment:<br>TZ:Asia/Shanghai<br>MYSQL_ROOT_PASSWORD:123456<br>command:    –character-set-server=utf8mb4    –collation-server=utf8mb4_general_ci    –explicit_defaults_for_timestamp=true    –lower_case_table_name=1    –max_allowed_packet=128M    –sql-mode=”STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBST<br>ITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATA,ERROR_FOR_DIVISION_BY_ZERO”<br>volumes:    - mysql-data:/var/lib/mysql<br>volumes:<br>mysql-data: # docker安装目录/volumes/下创建mysql_mysql-data文件夹作为映射<h1 id="var-lib-docker-volumes-mysql-mysql-data"><a href="#var-lib-docker-volumes-mysql-mysql-data" class="headerlink" title="/var/lib/docker/volumes/mysql_mysql-data"></a>/var/lib/docker/volumes/mysql_mysql-data</h1><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs dts"><br><span class="hljs-number">13.</span> 项目部署<br><br>    <span class="hljs-number">1.</span> ```shell<br>       mkdir project;cd project<br>       vim docker-compose.yml<br><span class="hljs-symbol">       version:</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">            services:</span><br><span class="hljs-symbol">             tomcat:</span><br><span class="hljs-symbol">              restart:</span>always<br><span class="hljs-symbol">              image:</span>tomcat<br><span class="hljs-symbol">              container_name:</span>tomcat<br><span class="hljs-symbol">              ports:</span><br>               - <span class="hljs-number">8080</span>:<span class="hljs-number">8080</span><br><span class="hljs-symbol">              volumes:</span><br>               - <span class="hljs-meta-keyword">/usr/</span>local<span class="hljs-meta-keyword">/docker/</span>project<span class="hljs-meta-keyword">/webapps/</span>:<span class="hljs-meta-keyword">/usr/</span>local<span class="hljs-meta-keyword">/tomcat/</span>webapps/<br><span class="hljs-symbol">              environment:</span><br><span class="hljs-symbol">               TZ:</span> Asia/Shanghai<br><span class="hljs-symbol">             mysql:</span><br><span class="hljs-symbol">              restart:</span> always<br><span class="hljs-symbol">              image:</span>mysql<br><span class="hljs-symbol">              container_name:</span>mysql<br><span class="hljs-symbol">              port:</span><br>               - <span class="hljs-string">&quot;3306:3306&quot;</span><br><span class="hljs-symbol">              environment:</span><br><span class="hljs-symbol">               TZ:</span>Asia/Shanghai<br><span class="hljs-symbol">               MYSQL_ROOT_PASSWORD:</span><span class="hljs-number">123456</span><br><span class="hljs-symbol">              command:</span><br>               --character-set-server=utf8mb4<br>               --collation-server=utf8mb4_general_ci<br>               --explicit_defaults_for_timestamp=true<br>               --lower_case_table_name=<span class="hljs-number">1</span><br>               --max_allowed_packet=<span class="hljs-number">128</span>M<br>               --sql-mode=<span class="hljs-string">&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SU\</span><br><span class="hljs-string">             BSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATA,ERROR_FOR_DIVISION_BY_ZERO&quot;</span><br><span class="hljs-symbol">              volumes:</span><br>               - mysql-data:<span class="hljs-meta-keyword">/var/</span>lib/mysql<br><span class="hljs-symbol">            volumes:</span><br>             mysql-data:<br></code></pre></td></tr></table></figure></li></ul></li></ol></li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Centos%E6%9B%B4%E6%96%B0yum%E6%BA%90/"/>
    <url>/2022/01/16/cnblog/Centos%E6%9B%B4%E6%96%B0yum%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<p>[1] 首先备份 /etc/yum.repos.d/CentOS-Base.repo 到其他文件夹</p><p>[2] 进入yum源配置文件所在文件夹</p><div class="code-wrapper"><pre><code class="hljs">[root@localhost yum.repos.d]# cd /etc/yum.repos.d/</code></pre></div><p>[3] 下载yum源配置文件，放入/etc/yum.repos.d/</p><div class="code-wrapper"><pre><code class="hljs">CentOS 5：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repoCentOS 6：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repoCentOS 7：wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo）</code></pre></div><p>[4] 运行yum makecache生成缓存</p><div class="code-wrapper"><pre><code class="hljs">[root@localhost yum.repos.d]# yum makecache</code></pre></div>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/CentOS7%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%E6%9C%8D%E5%8A%A1%E8%AF%B4%E6%98%8E/"/>
    <url>/2022/01/16/cnblog/CentOS7%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E8%84%9A%E6%9C%AC%E6%9C%8D%E5%8A%A1%E8%AF%B4%E6%98%8E/</url>
    
    <content type="html"><![CDATA[<p>在CentOS7下，已经不再使用chkconfig命令管理系统开机自启动服务和条件自定义脚本服务了，而是使用管理unit的方式来控制开机自启动服务和添加自定义脚本服务。在/usr/lib/systemd/system目录下包含了各种unit文件，有service后缀的服务unit，有target后缀的开机级别unit等。</p><p>如果想把自定义的脚本变成服务进程，都需要写对应的service配置文件，这样才能被unit所管理（注意：自定义开机自启动服务的.service配置文件必须放在/usr/lib/systemd/system这个目录下面）。服务类别又分为服务又分为系统服务（system）和用户服务（user）。</p><ul><li>系统服务：开机不登陆就能运行的程序（常用于开机自启）。</li><li>用户服务：需要登陆以后才能运行的程序。</li></ul><hr><h1 id="编写-service配置文件说明"><a href="#编写-service配置文件说明" class="headerlink" title="编写.service配置文件说明"></a>编写.service配置文件说明</h1><ul><li>[unit]区块：设置管理启动顺序与依赖关系</li></ul><p><img src="http://p9.pstatp.com/large/pgc-image/2c6c288a465145aeb1bb643b72d955c0" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></p><p>注意:如果After、Before、Wants、Requires等号后面需要填写多个服务可以用空格隔开。After和Before字段只涉及启动顺序,不涉及依赖关系。Wants字段与Requires字段只涉及依赖关系,与启动顺序无关,默认情况下是同时启动的。</p><ul><li>[Service]区块：设置启动行为<ul><li>启动命令<br><img src="http://p9.pstatp.com/large/pgc-image/36bf485fd96e48a096b6ffc31d2a213f" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"><br>所有的启动设置之前，都可以加上一个连词号（-），表示”抑制错误”，即发生错误的时候，不影响其他命令的执行。例如：<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">ExecStop=-/bin/sh /server/scripts/xx.sh<br></code></pre></td></tr></table></figure></li><li>启动类型 Type字段定义启动类型。它可以设置的值如下：<br><img src="http://p3.pstatp.com/large/pgc-image/19cc1b0953ed4122afedc31e4b4a0df9" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></li><li>重启行为<br>KillMode字段,定义Systemd如何停止服务,它可以设置的值如下<br><img src="http://p1.pstatp.com/large/pgc-image/f707804944ea46e5a96cec4761245140" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"><br>Restart字段,定义了服务退出后,Systemd的重启方式,它可以设置的值如下<br><img src="http://p1.pstatp.com/large/pgc-image/3eb43a9b2bb242e1900bfdeea18e53b6" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></li><li>service区块的其他一些字段</li></ul></li></ul><p><img src="http://p3.pstatp.com/large/pgc-image/4fe564f506af46e1bfc2575afe20c0e5" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></p><ul><li><p>[Install]区块：定义如何安装这个配置文件，即怎样做到开机启动</p><p>这个设置非常重要，如果设置开机自启动，在/etc/systemd/system目录下面的multi-user.target.wants子目录之中机会创建一个服务的软链接</p><p>WantedBy字段，表示该服务所在的 Targe，target的含义是服务组，表示一组服务，它可以设置的值如下</p></li></ul><p><img src="http://p1.pstatp.com/large/pgc-image/84ff60c04c554500b98ed151c87cd532" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></p><hr><h1 id="配置文件目录"><a href="#配置文件目录" class="headerlink" title="配置文件目录"></a>配置文件目录</h1><p><img src="http://p3.pstatp.com/large/pgc-image/e51225cc53ee420ab670fd99b5339229" alt="基于CentOS7系统添加自定义脚本服务及参数说明，附实例"></p><hr><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">/etc/systemd/system # 该文件夹下也可以<br></code></pre></td></tr></table></figure><h1 id="实例–配置一个自定义脚本服务"><a href="#实例–配置一个自定义脚本服务" class="headerlink" title="实例–配置一个自定义脚本服务"></a>实例–配置一个自定义脚本服务</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">[Unit]<br>Description=&quot;rsync+inotify实时同步服务&quot;<br>After=network.target remote-fs.target nss-lookup.target<br>[Service]<br>Type=forking<br>ExecStart=/bin/sh /server/scripts/sync.sh start<br>ExecReload=/bin/sh /server/scripts/sync.sh restart<br>ExecStop=/bin/sh /server/scripts/sync.sh stop<br>KillSignal=SIGQUIT<br>TimeoutStopSec=5<br>KillMode=process<br>PrivateTmp=true<br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><p>文章来源:<a href="https://www.toutiao.com/i6723191120836215304/">https://www.toutiao.com/i6723191120836215304/</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Bootstarp/"/>
    <url>/2022/01/16/cnblog/Bootstarp/</url>
    
    <content type="html"><![CDATA[<p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223239372-57485304.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>字体是矢量的:不失帧</p><p>前端页面可用于android访问</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223248337-677008583.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223252248-29940554.png" alt="" /></p><p>优点:移动设备优先</p><p>支持所有浏览器(360不算浏览器)</p><p>自适应屏幕大小</p><p>目录结构:</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223302366-938671582.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>若浏览器环境变化,引入js</p><p align="left">&nbsp;&lt;link href=<em>"assets/plugins/bootstrap/css/bootstrap.min.css"</em> type=<em>"text/css"</em> rel=<em>"stylesheet"</em>/&gt;</p><p align="left">&lt;linkhref=<em>"assets/plugins/bootstrap/css/bootstrap-theme.min.css"</em> type=<em>"text/css"</em> rel=<em>"stylesheet"</em>/&gt;</p><p align="left">&lt;script src=<em>"assets/plugins/jquery-3.3.1.min.js"</em>&gt;&lt;/script&gt;</p><p>&lt;script src=<em>"assets/plugins/bootstrap/js/bootstrap.min.js"</em>&gt;&lt;/script&gt;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223316920-903270914.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><ol><li>窗口随系统尺寸Grid最多分为12列</li><li>网格系统</li></ol><p>　　　　1,table ,加载完所有,显示表格</p><p>　　　　2,div+css,加载一点,显示一点:操作难度大</p><ol><li>移动设备策略</li></ol><p>　　　　　媒体查询,(渐进增强:向上兼容)内容先显示</p><ol><li>行必须放在.container class内</li><li>内容放在列内,列是行的直接子元素</li><li>预定义网格:.row 和.col(列)-xs(设配)-4(所占列数)</li><li>使用媒体查询</li></ol><p>　　　　语法:@media 媒体类型 and(媒体特性:作用的范围){你的样式}</p><p>　　　　@media screen and (max-widthj:480px){</p><p>　　　　.a{display:none} //当小于480px时样式起作用</p><p>　　　　}</p><ol><li>就近原则:标签内style 与class 默认style生效</li></ol><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921223431703-865832601.png" alt="" /></p><p>加入!important可强制生效,当(用style)更改bootstrap的css时,即会失效</p><p>&nbsp;</p><p>矢量图标:bootstarp本身已过时,可扩展,找到font加入对应css</p><p><a href="https://icons8.com/line-awesdome">https://icons8.com/line-awesdome</a></p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/bitmap%E5%92%8C%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/"/>
    <url>/2022/01/16/cnblog/bitmap%E5%92%8C%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="bitmap和布隆过滤器"><a href="#bitmap和布隆过滤器" class="headerlink" title="bitmap和布隆过滤器"></a>bitmap和布隆过滤器</h2><p><strong>海量整数中是否存在某个值–bitmap</strong></p><p>​        在一个程序中，经常有让我们判断一个集合中是否存在某个数的case；大多数情况下，只需要用map或是list这样简单的数据结构，如果使用的是高级语言，还能乘上快车调用几个封装好的api，加几个if else，两三行代码就可以在控制台看自己“完美”而又“健壮”的代码跑起来了。</p><p>​        但是，事无完美，在高并发环境下，所有的case都会极端化，如果这是一个十分庞大的集合（给这个庞大一个具体的值吧，一个亿），简单的一个hash map，不考虑链表所需的指针内存空间，一亿个int类型的整数，就需要380多M（4byte × 10 ^8），十亿的话就是4个G，不考虑性能，光算算这内存开销，即使现在满地都是128G的服务器，也不好吃下这一壶。</p><p>bitmap则使用位数代表数的大小，bit中存储的0或者1来标识该整数是否存在，具体模型如下：</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/0.jpg" alt="0"></p><p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="img">这是一个能标识0-9的“bitmap”，其中4321这四个数存在</p><p>​        计算一下bitmap的内存开销，如果是1亿以内的数据查找，我们只需要1亿个bit = 12MB左右的内存空间，就可以完成海量数据查找了，是不是极其诱人的一个内存缩减，以下为Java实现的bitmap代码：</p><figure class="highlight java"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBitMap</span> </span>&#123;<br> <br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">byte</span>[] bytes;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> initSize;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyBitMap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> size)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        initSize = size / (<span class="hljs-number">8</span>) + <span class="hljs-number">1</span>;<br>        bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[initSize];<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> number)</span> </span>&#123;<br>        <span class="hljs-comment">//相当于对一个数字进行右移动3位，相当于除以8</span><br>        <span class="hljs-keyword">int</span> index = number &gt;&gt; <span class="hljs-number">3</span>;<br>        <span class="hljs-comment">//相当于 number % 8 获取到byte[index]的位置</span><br>        <span class="hljs-keyword">int</span> position = number &amp; <span class="hljs-number">0x07</span>;<br>        <span class="hljs-comment">//进行|或运算  参加运算的两个对象只要有一个为1，其值为1。</span><br>        bytes[index] |= <span class="hljs-number">1</span> &lt;&lt; position;<br>    &#125;<br> <br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">contain</span><span class="hljs-params">(<span class="hljs-keyword">int</span> number)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> index = number &gt;&gt; <span class="hljs-number">3</span>;<br>        <span class="hljs-keyword">int</span> position = number &amp; <span class="hljs-number">0x07</span>;<br>        <span class="hljs-keyword">return</span> (bytes[index] &amp; (<span class="hljs-number">1</span> &lt;&lt; position)) != <span class="hljs-number">0</span>;<br>    &#125;<br> <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        MyBitMap myBitMap = <span class="hljs-keyword">new</span> MyBitMap(<span class="hljs-number">32</span>);<br>        myBitMap.set(<span class="hljs-number">30</span>);<br>        myBitMap.set(<span class="hljs-number">13</span>);<br>        myBitMap.set(<span class="hljs-number">24</span>);<br>        System.out.println(myBitMap.contain(<span class="hljs-number">2</span>));<br>    &#125;<br> <br>&#125;<br></code></pre></td></tr></table></figure><p>​        使用简单的byte数组和位运算，就能做到时间与空间的完美均衡，是不是美美哒，wrong！试想一下，如果我们明确这是一个一亿以内，但是数量级只有10的集合，我们使用bitmap，同样需要开销12M的数据，如果是10亿以内的数据，开销就会涨到120M，bitmap的空间开销永远是和他的数据取值范围挂钩的，只有在海量数据下，他才能够大显身手。</p><p>​        再说说刚刚提到的那个极端case，假设这个数据量在一千万，但是取值范围好死不死就在十个亿以内，那我们不可避免还是要面对120M的开销，有方法应对么？</p><h2 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h2><p>​        如果面对笔者说的以上问题，我们结合一下常规的解决方案，譬如说hash一下，我将十亿以内的某个数据，hash成一亿内的某个值，再去bitmap中查怎么样，如下图，布隆过滤器就是这么干的：</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/1.png" alt="1"></p><p>利用多个hash算法得到的值，减小hash碰撞的概率</p><p>​        像上面的图注所说，我们可以利用多个hash算法减小碰撞概率，但只要存在碰撞，就一定会有错误判断，我们无法百分百确定一个值是否真的存在，但是hash算法的魅力在于，我不能确定你是否存在，但是我可以确定你是否真的不存在，这也就是以上的实现为什么称之“过滤器”的原因了。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/Anaconda/"/>
    <url>/2022/01/16/cnblog/Anaconda/</url>
    
    <content type="html"><![CDATA[<h1 id="Anaconda-设置国内镜像"><a href="#Anaconda-设置国内镜像" class="headerlink" title="Anaconda 设置国内镜像"></a>Anaconda 设置国内镜像</h1><ul><li><p>临时使用</p><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package<br><span class="hljs-meta">#</span><span class="bash"> 注意，simple 不能少, 是 https 而不是 http</span><br></code></pre></td></tr></table></figure></li><li><p>设为默认</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 升级 pip 到最新的版本 (&gt;=10.0.0) 后进行配置：</span><br>pip install pip -U<br>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure></li><li><p>如果到 pip 默认源的网络连接较差，临时使用本镜像站来升级 pip：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U<br></code></pre></td></tr></table></figure></li></ul><h1 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">anaconda3/Scripts<br>anaconda3/Library/bin<br>anaconda3/library/mingw-64/bin<br>linux：export PATH=$PATH:/home/software/anaconda3/bin<br><br>此时配置完成 操作时主要是用 conda.exe conda.bat<br></code></pre></td></tr></table></figure><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 环境变量设置 查看</span><br>conda env config vars list<br><span class="hljs-meta">#</span><span class="bash"> 添加</span><br>conda env config vars set xxx=yyy -n envname<br><span class="hljs-meta">#</span><span class="bash"> 删除环境变量</span><br>conda env config vars unetset xxx<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看所有的虚拟环境</span><br>conda info --envs<br><span class="hljs-meta">#</span><span class="bash"> 创建tensorflow虚拟环境</span><br>conda create -n tensorflow(只是个名字) python=3.7.3 #(根据ananconda的版本决定)<br><span class="hljs-meta">#</span><span class="bash"> 删除环境</span><br>conda remove -n envname --all<br>conda activate tensorflow #进入tensorflow 虚拟环境<br><span class="hljs-meta">#</span><span class="bash"> 安装tensorflow</span><br>pip install tensorflow-gpu==版本号<br>conda deactivate 退出虚拟环境<br><span class="hljs-meta">#</span><span class="bash"> 克隆环境</span><br>conda create --name clone_env --clone old_name<br><span class="hljs-meta">#</span><span class="bash"> 查看当前换件中安装的所有包</span><br>conda list<br><span class="hljs-meta">#</span><span class="bash"> 查看指定虚拟环境中安装的所有包</span><br>conda list -n envname<br><span class="hljs-meta">#</span><span class="bash"> 更新指定包</span><br>conda update unmpy<br><span class="hljs-meta">#</span><span class="bash"> 更新所有包</span><br>conda update<br><span class="hljs-meta">#</span><span class="bash"> 更新python</span><br>conda update python<br><span class="hljs-meta">#</span><span class="bash"> 更新conda本身</span><br>conda update conda<br><span class="hljs-meta">#</span><span class="bash"> 更新conda库</span><br>conda update conda<br><span class="hljs-meta">#</span><span class="bash"> 更新anaconda版本</span><br>conda update anaconda<br><span class="hljs-meta">#</span><span class="bash"> 升级</span><br>pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple/ --upgrade tensorflow <br>pip3 install -i https://pypi.tuna.tsinghua.edu.cn/simple/ --upgrade tensorflow-gpu <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> channel状态与优先级</span><br>conda config --get channels<br><span class="hljs-meta">#</span><span class="bash"> 设置通道（默认的defaults无法使用了）</span><br>conda config --add channels conda-forge # https://conda-forge.org/docs/index.html<br></code></pre></td></tr></table></figure><h1 id="Jupyter"><a href="#Jupyter" class="headerlink" title="Jupyter"></a>Jupyter</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">jupyter notebook  --generate-config# 生成配置文件<br>cNotebookApp.notebook_dir=&quot;xxx&quot;# 修改默认路径<br>conda create -n py3 python=3# 创建一个python3的环境，名为py3<br>source activate py3# 激活py3环境<br>conda install ipykernel# 安装ipykernel模块<br>python -m ipykernel install --user --name=py3 # 进行配置<br>jupyter notebook # 启动jupyter notebook then can choose python environment<br></code></pre></td></tr></table></figure><p><strong>注意tensorflow版本与python，cuda对应关系</strong></p><ul><li>版本1.1—&gt;1.15 cuda 9及以下</li><li>版本2.0-&gt;…. cuda 10</li></ul><h1 id="Conda与pip"><a href="#Conda与pip" class="headerlink" title="Conda与pip"></a>Conda与pip</h1><ul><li><p>conda可以安装C库Python库，直接通过二进制安装</p></li><li><p>pip只能安装python包，编译安装，config set global.index-url 指定源</p><ul><li><div class="code-wrapper"><pre><code class="shell">pip config list # 显示pip安装源</code></pre></div></li></ul></li></ul><h1 id="镜像"><a href="#镜像" class="headerlink" title="镜像"></a>镜像</h1><ul><li>阿里云：<a href="http://mirrors.aliyun.com/pypi/simple/">http://mirrors.aliyun.com/pypi/simple/</a></li><li>中国科技大学：<a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a></li><li>豆瓣：<a href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a></li><li>清华大学：<a href="https://pypi.tuna.tsinghua.edu.cn/simple/">https://pypi.tuna.tsinghua.edu.cn/simple/</a></li><li>中国科学技术大学：<a href="http://pypi.mirrors.ustc.edu.cn/simple/">http://pypi.mirrors.ustc.edu.cn/simple/</a></li></ul><p><strong>可能失效</strong></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/ajax_json/"/>
    <url>/2022/01/16/cnblog/ajax_json/</url>
    
    <content type="html"><![CDATA[<p align="center"><strong>AJAX</strong><strong>框架</strong><strong>Day1</strong></p><p align="left">1、Ajax引言</p><p align="left">a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 概念 <strong>A</strong><em>synchronous&nbsp;</em><strong>J</strong><em>avascript&nbsp;<strong>A</strong>nd&nbsp;</em><strong>X</strong><em>ML</em> (异步请求 javaScript &nbsp;And&nbsp; XML)</p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221100420-1109005680.png" alt="" /></p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 传统的请求</p><ol><li>发起传统请求的方式<ol><li>地址栏</li><li>超级连接</li><li>表单</li><li>Javascript: location.href 函数</li><li><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221133395-265056185.png" alt="" />&nbsp;</li></ol></li><li>传统请求的问题<br />因为传统请求响应的是新的页面（刷新了页面）。所以用户就必须要等待响应结果，才可以进行后续的操作。<br />用户体验差。</li></ol><ol><li>基于异步请求的特点<br />响应的内容不是新的页面，是一个页面的局部，字符串信息，所以用户在使用异步请求的时候，不需要等待响应的，直接就可以进行后续处理。</li></ol><ol><li>传统请求与异步请求的区别<ol><li>响应内容<br />传统响应的内容：新的页面，刷新页面<br />异步响应的内容：页面的局部，字符串信息</li><li>对于用户的操作<br />传统的请求：等待响应<br />异步的请求：不需要等待响应，用户可以直接进行后续的操作</li></ol></li><li>建议在合适的场景下，都使用异步请求，提高用户的体验</li></ol><p align="left">2、异步请求的开发</p><p align="left">a)&nbsp; &nbsp;异步请求对象的创建&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />　　javascript: XmlHttpRequest对象 xhr<br />　　Chrome|FF|safari中&nbsp;XmlHttpRequest<br />　　var xhr = new XmlHttpRequest();<br />　　IE(ie5 ie6)中 ActiveXObject<br />　　var xhr = new ActiveXObject(&ldquo;Microsoft.XMLHTTP&rdquo;);</p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr对象的使用<br /></p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221249546-1563204703.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">3、用户名检测的案例<br /> <p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221259822-933761469.png" alt="" /></p></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">不再跳转</p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221325422-2121738944.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221333883-1805546846.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">控制表单是否提交,提交时检测</p><p align="left">4、Ajax的开发步骤</p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221350808-836129969.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221407245-2142296806.png" alt="" /></p><p>&nbsp;</p><p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221417500-1171944827.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p align="left">a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;创建异步请求 <br />IE系&nbsp;xhr = new ActiveXObject(&ldquo;Microsoft.XMLHTTP&rdquo;);<br />非IE系 xhr= new XmlHttpRequest();</p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <p>发送请求&nbsp;&nbsp;&nbsp;<br>queryString<br /><br>xhr.open(&ldquo;GET&rdquo;,URL?name=suns&amp;pwd=123&amp;sex=male);<br /><br>xhr.send(null);<br /><br><span style="font-size: 16px;"><strong>xhr.open(&ldquo;POST&rdquo;,url,true(是否使用异步));</strong></span><br /><span style="font-size: 16px;"><strong><br>xhr.setRequestHeader(&ldquo;content-type&rdquo;,&rdquo;application/x-www-form-urlencoded&rdquo;);</strong></span></p></p><p align="left"><br /><span style="font-size: 18px;">为什么设置：模拟表单</span><br />基本Web的开发 只能使用表单提交数据，使用表单提交数据时默认指定<br />enctype=&rdquo;application/x-www-form-urlencoded&rdquo;,但是现在使用ajax编程，不再使用<br />&lt;form标签了也就没有方式提供enctype属性对应的值了。那么这时候需要通过在<br />请求头中手工设置application/x-www-form-urlencoded来模拟表单。<br />xhr.send(&ldquo;name=suns&amp;pwd=123&amp;sex=male&rdquo;);,传递数据要加引号,<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221525182-1856949437.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;监听响应<br />xhr.onreadystatechange = function(){<br />&nbsp;&nbsp;&nbsp;if(xhr.readyState==4&amp;&amp;xhr.status==200){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xhr.responseText<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DOM编程<br />&nbsp;&nbsp;&nbsp; }<br />}</p><p align="left">d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;服务器端：<br />不再进行页面的跳转，而是通过返回字符串信息，完成交互<br />request作用域 不使用 <br />底层就是使用Response.getWriter()获取输出流 进行交互<br /><br /></p><p align="left">5、JSON协议串<br />JSON协议串，本质上就是一个字符串。<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221546287-1058698031.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;作用：异构的编程体系中，进行数据的传输，交互。</p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;核心：</p><ol><li>定义了字符串的格式<ol><li>对象形式<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221558784-1565801640.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p></li><li>集合形式<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221619470-81539582.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p><br /> </li><li>内嵌对象<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221638554-878480099.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p><br /> </li><li>Map类型与 对象的形式一致<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221638559-341907147.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p><br /> </li><li>JSON协议解析 多种工具可以自动支持转换<br />java端：jsonlib&nbsp; gson(Google)&nbsp;&nbsp;fastjson(ali)&nbsp; jakeson(SpringMVC)<br />Gson//对象是大括弧,集合小括弧</li></ol></li></ol><p align="left">注意map是当做对象来写,大括弧</p><ol><li>Gson的基本应用<br />Gson gson = new Gson();<br />gson.toJson();<br /> </li><li>Gson的特殊应用场景</li><li><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221713144-374798940.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p></li></ol><p align="left">a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Json字符串的属性名与对象属性名不一致的问题<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221735386-978374189.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;解决对象回环问题<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221742816-32688954.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><ol><li>注解 @Expose<br />没有使用@Expose的注解的属性 将会被排除，不会被转换<br /> <img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221757885-1219841663.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p><br /> </li></ol><p align="left">太不灵活,复杂都用gsonbuilder</p><p align="left">&nbsp;</p><ol><li>使用接口回调,<br />实现一个排除策略的接口（告示Gson 排除的内容）<br /> <br /> </li><li><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221818714-2069931482.png" alt="" /><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221825276-761881739.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p></li></ol><p align="left">可以指定多个排除策略,更灵活</p><p align="left">c)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;特殊的日期类型问题</p><ol><li>实现接口</li><li><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221833432-1293898298.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p></li><li>注册到GsonBuilder<br /> <img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221840475-1828977492.png" alt="" /><p>&nbsp;</p><p>&nbsp;<img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221844548-1913895190.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><br /> </li><li>JSON转化成JS对象 （浏览器内置，Jquery,Ext..）<br />浏览器内置对象 ，后续建议使用Jquery<br />JSON.parse(jsonString) -----&nbsp; js对象<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; -----&nbsp; js的数组<br /> <img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221900411-1204050178.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p><br /><br /></li></ol><p align="left">6、案例 ：应用Ajax技术实现 显示所用用户的信息<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221909329-633515744.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="center"><strong>AJAX</strong><strong>框架</strong><strong>Day2</strong></p><p align="left">1、SpringMVC对于Ajax的支持</p><p align="left">a)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;底层整合 原始整合<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221922056-1270637708.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通过@ResponseBody<br />SpringMVC自动的把对象转换成JSON串，并通过字符输出流输出。<br />注意：@ResponseBody封装的对象转换JSON的组件为jackson<br />环境搭建：引入jackson相关的jar包<br />开发步骤；<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221934327-389646672.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><ol><li>使属性名与JSON字符串的key不一致<ol><li><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221947204-2031171715.png" alt="" /><p>&nbsp;</p><p>&nbsp;</p></li></ol></li><li>日期类型的格式 <br />@JsonFormat(pattern="yyyy-MM-dd")</li><li>空值类型不转换<br />@JsonInclude(Include.<em>NON_NULL</em>)</li><li>如何忽略某个属性<br />@JsonIgnore </li><li>中文字符集会自动处理</li></ol><p align="left">原来处理方法<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921221959486-1630124779.png" alt="" /></p><p align="left"> 基于实战自动日期处理与空值处理<br /> <p><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921222009818-1818366163.png" alt="" /></p></p><p align="left">2、Struts2与Ajax技术集成<br /> </p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921222019594-1186582308.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left">3、基于Ajax的编程方式思考：<br />&nbsp;&nbsp;&nbsp; 现在的开发体系中，除了使用一个ajax的ui框架(easyui ext dojo)进行编程之外，剩下所用的应用，在开发时，都应该部分环节中使用ajax.</p><p align="left">&nbsp;&nbsp; 1局部操作 与 服务器端交互<br />&nbsp;&nbsp; 2 最好结构简单</p><p align="left"><img src="https://img2018.cnblogs.com/blog/1333782/201909/1333782-20190921222029315-1928295497.png" alt="" /></p><p>&nbsp;</p><p>&nbsp;</p><p align="left"><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <br /><br /><br /></p><p align="left">&nbsp;</p><p>&nbsp;</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2022/01/16/cnblog/7%E5%B1%82%E5%8D%8F%E8%AE%AE/"/>
    <url>/2022/01/16/cnblog/7%E5%B1%82%E5%8D%8F%E8%AE%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h1><h2 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h2><p>SMTP：发邮件，不能传送可执行文件，与二进制，太长的数据也不行</p><p>pop收邮件，</p><p>imap收邮件：删除时会同步服务器的邮件，pop不会。</p><p>MIME：smtp的补充，可以传送非ASCII</p><h2 id="网络管理协议"><a href="#网络管理协议" class="headerlink" title="网络管理协议"></a>网络管理协议</h2><p>SNMP C/S模型 被管理的是服务器</p><p>snmo，smi，mib</p><h1 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h1><p><img src="https://i.loli.net/2020/08/27/1qpK7FsLW5M89UO.png" alt="tcp"></p><ul><li><p>可靠传输：不重复，不丢失，不失序</p><ul><li>停止等待协议<ul><li>发送无差错：</li><li>发送有差错：（发送方单方面认为没收到）：超时重传<ul><li>接收端丢弃</li><li>发送时中间出错</li><li>确认丢失</li><li>没有丢失，超时到的接收端，</li></ul></li><li>保存发送过的数据，超时时间设置，分组与确认都要编号</li></ul></li><li>ARQ 连续发送，自动重传<ul><li>滑动窗口</li><li>超时重传:<ul><li>计时：一般就是正常报文的往返时间RTT ，RTTs(new) = (1-a)*RTTs(旧)+a*RTTS样本</li><li>RFC推荐a一般为0.125</li><li>超时时间应该大于RTT</li></ul></li><li>选择确认SACK：扩展头部中的选项，确认的是收到的数据的边界</li><li>流量控制<ul><li>通过滑动窗口控制 rwnd</li></ul></li><li>拥塞控制<ul><li>cwnd 拥塞窗口： 如何调节<ul><li>重传定时器，很多超时可能拥塞<ul><li>慢开始 cwnd=1,开始 2,4,8—&gt;ssthresh=16—&gt;17,18,19</li><li>拥塞避免 ssthresh=16—&gt;17,18,19</li><li>—–&gt;超时-&gt;1.2.4–&gt;ssthresh/2=8–&gt;9,10,11</li><li>—-》重复的3次ACK—-》ssthresh/2=4-&gt;5,6,7,8</li></ul></li><li>收到后到重复的ACK,很多超时可能拥塞<ul><li>快重传 ：收到重复ack立即重传丢失数据，执行快恢复</li><li>快恢复：</li></ul></li></ul></li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20170823152914228" alt="img"></p><ul><li>三次握手<ul><li>SYN=1,seq=x 客户端处于SYN-SEND, 服务器处于Listen</li><li>SYN=1,ACK=1,ack=x+1,seq=y 客户端处于连接建立，服务端处于SYN-RCVD</li><li>ACK=1,ack=y+1,seq=x+1,服务端连接建立</li></ul></li><li>四次<ul><li>FIN=1，seq=u</li><li>ACK=1,seq=v，ack=u+1  还有没法送完的数据发送</li><li>FIN=1,ACK=1,seq=w,ack=u+1</li><li>ACK=1,seq=u+1,ack=w+1</li><li>客户端2个MSL<ul><li>若最后的确认丢失，服务端会认为第三次丢失，会重传，客户端会再次接收到</li><li>或最后的确认不丢失，在2MSL中表示最后的确认已收到，</li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210731192213264.png" alt="image-20210731192213264"></p></li></ul><p><img src="https://i.loli.net/2020/08/27/4Yhp5ObW1KBmwrV.png" alt="udp">![t</p><ul><li>功能：相对ip<ul><li>差错检验</li><li>复用与分用</li></ul></li></ul><h1 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/image-20210731102305229.png" alt="image-20210731102305229"></p><ul><li>差错控制报文<ul><li>终点不可达<ul><li>终点没了</li><li>路由器无法转发</li></ul></li><li>时间超时</li><li>参数问题</li><li>重定向<ul><li>路由器表项失效，另一个路由器通知他更改表项</li></ul></li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">1，差错控制本报文丢失了：不会再次差错报告<br>2，对于分片的数据包，只回复一次差错控制<br>3，多播地址数据包，路由器都不回复差错控制<br>4，特殊地质，本地，127.0.0.1 0.0.0.0 不发送<br></code></pre></td></tr></table></figure><ul><li><p>询问报文</p><ul><li><p>回送请求和应答报文</p><ul><li>ping</li><li>traceroute：超时的一般都是不响应的路由器<ul><li>发现路由器是tracer，路由器一边向目的地发送，一边向源发送</li></ul></li></ul><p>安全考虑：路由器和服务器不一定会响应</p></li><li><p>时间戳请求和应答报文</p></li><li><p>不用的几种：信息请求与回答报文，掩码地址请求与与回答，路由器询问与通告，源点抑制</p></li></ul></li></ul><h1 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h1><p>多播，组播</p><p>基本规则、组成员查询机制和报告机制</p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20180510094357921" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20180510094656241" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20180510094907847" alt="img"></p><ul><li><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/2020041913561448.png" alt="在这里插入图片描述"></li><li>在组播网络中，组播路由表可能包含多个表项，每个表项都存在四个关键信息：<strong>组播源地址、组播组地址、上游接口以及下游接口</strong>。</li></ul><h1 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h1><p><img src="https://i.loli.net/2020/08/27/DLylpsIEW76O49M.png" alt="ipv4"></p><h1 id=""><a href="#" class="headerlink" title=""></a></h1><p><img src="https://i.loli.net/2020/08/27/IxywkHZofNzXeQL.png" alt="ipv6"></p><ul><li>不分类，只有前缀 </li></ul><h1 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/20170619143956086" alt="img"></p><p>由数据链路层指定数据类类型</p><h1 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h1><p><img src="https://cdn.jsdelivr.net/gh/Dean0731/File@main//image/6-191106130541362.gif" alt="以太帧结构（格式）"></p><h1 id="路由表表项生成"><a href="#路由表表项生成" class="headerlink" title="路由表表项生成"></a>路由表表项生成</h1><ul><li><p>自治域：路由器收集所有路由太长了，所以自治域产生，一个路由器最终存放自治域的所有ip的路由表</p></li><li><p>RIP：</p><ul><li>自治域内部 </li><li>只支持分类的IP，ABCDE</li><li>每个30s相邻路由器交换路由信息</li><li>坏消息传的慢：对于损坏的网络很慢才能发现</li><li>最大16跳，表示不可达</li><li>RIP2:支持划分子网</li></ul></li><li><p>OSPF:最短路径 spf</p><ul><li>自治域内部</li><li>协议：分布式链路状态协议</li><li>将自治域再次划分-》区域</li><li>ip数据包直接传送，不用udp</li></ul></li><li><p>BGP：自治域之间</p></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>curl</title>
    <link href="/2022/01/16/curl/"/>
    <url>/2022/01/16/curl/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">curl -so /dev/null -w &quot;%&#123;http_code&#125;&quot; google.com -x socks5://127.0.0.1:1080 测试代理是否可用 301或200 表示可用<br>curl ftp://pan.dean0731.top:30021/ -u &quot;panuser:123456&quot;<br>查看<br>curl ftp://dean0731.cn:2048/ -u &quot;oss_ftp_user:oss_ftp_password&quot;<br>上传<br>curl ftp://oss_ftp_user:oss_ftp_password@dean0731.cn:2048/path -T<br>CURL命令<br>1、列出ftp服务器上的目录列表：<br>curl ftp://www.xxx.com/ --user name:passwd<br>curl ftp://www.xxx.com/ –u name:passwd #简洁写法<br>curl ftp://name:passwd@www.xxx.com #简洁写法2<br>2、只列出目录，不显示进度条<br>curl ftp://www.xxx.com –u name:passwd -s<br>3、下载一个文件：<br>curl ftp://www.xxx.com/size.zip –u name:passwd -o size.zip<br>4、上载一个文件：<br>curl –u name:passwd -T size.mp3 ftp://www.xxx.com/mp3/<br>5、从服务器上删除文件（使用curl传递ftp协议的DELE命令）:<br>curl –u name:passwd ftp://www.xxx.com/ -X &#x27;DELE mp3/size.mp3&#x27;<br>6、另外curl不支持递归下载，不过可以用数组方式下载文件，比如我们要下载1-10.gif连续命名的文件：<br>curl –u name:passwd ftp://www.xxx.com/img/[1-10].gif –O #O字母大写<br>7、要连续下载多个文件：<br>curl –u name:passwd ftp://www.xxx.com/img/[one,two,three].jpg –O #O字母大写<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl result\r\n<br>url_effective:%&#123;url_effective&#125;最终获取的url地址，尤其是当你指定给curl的地址存在301跳转，且通过-L继续追踪的情形。\r\n<br>http_code: %&#123;http_code&#125;。\r\n<br>http_connect: %&#123;http_connect&#125;last response (from a proxy) to a curl CONNECT request。\r\n<br>time_total : %&#123;time_total&#125;总时间，按秒计,精确到小数点后三位。\r\n<br>time_namelookup: %&#123;time_namelookup&#125;DNS解析时间,从请求开始到DNS解析完毕所用时间。\r\n<br>time_connect : %&#123;time_connect&#125;从开始到建立TCP连接完成所用时间,包括前边DNS解析时间<br>time_appconnect: %&#123;time_appconnect&#125;连接建立完成时间，如SSL/SSH等建立连接或者完成三次握手时间。\r\n<br>time_pretransfer: %&#123;time_pretransfer&#125;从开始到准备传输的时间。\r\n<br>time_redirect: %&#123;time_redirect&#125;重定向时间，包括到最后一次传输前的几次重定向的DNS解析，连接，预传输，传输时间。\r\n<br>time_starttransfer:%&#123;time_starttransfer&#125;开始传输时间,在发出请求之后，Web 服务器返回数据的第一个字节所用的时间。\r\n<br>size_download: %&#123;size_download&#125;。\r\n<br>size_upload: %&#123;size_upload&#125;上传大小。\r\n<br>size_header: %&#123;size_header&#125;下载的header的大小。\r\n<br>size_request: %&#123;size_request&#125;请求的大小。\r\n<br>speed_download: %&#123;speed_download&#125;下载速度，单位-字节每秒。\r\n<br>speed_upload: %&#123;speed_upload&#125;上传速度,单位-字节每秒。\r\n<br>content_type: %&#123;content_type&#125;。\r\n<br>num_connects: %&#123;num_connects&#125;最近的的一次传输中创建的连接数目。\r\n<br>num_redirects: %&#123;num_redirects&#125;在请求中跳转的次数。\r\n<br>redirect_url: %&#123;redirect_url&#125;。\r\n<br>ftp_entry_path: %&#123;ftp_entry_path&#125;当连接到远程的ftp服务器时的初始路径。\r\n<br>ssl_verify_result: %&#123;ssl_verify_result&#125;ssl认证结果，返回0表示认证成功。\r\n<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>docker</title>
    <link href="/2022/01/16/docker/"/>
    <url>/2022/01/16/docker/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">mysql:https://hub.docker.com/_/mysql<br>mysql:<br>docker run  -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw --name some-mysql mysql<br>mongodb:<br>docker run  -d -p 27017:27017 -p 28017:28017  -e MONGO_INITDB_ROOT_USERNAME=mongoadmin  -e MONGO_INITDB_ROOT_PASSWORD=123456 --name some-mongo mongo<br>neo4j:<br>docker run  -d -p 7474:7474 -h=7687:7687 --name some-neo4j  neo4j<br>默认账户密码neo4j    neo4j 我改为了123456<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> centos安装docker</span><br>yum install -y yum-utils device-mapper-persistent-data lvm2<br>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<br>yum makecache fast<br>yum -y install docker-ce<br>systemctl start docker<br>tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;<br>&#123;<br>  &quot;registry-mirrors&quot;: [&quot;https://kqh8****.mirror.aliyuncs.com&quot;]<br>&#125;<br>EOF<br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>firewall</title>
    <link href="/2022/01/16/firewall/"/>
    <url>/2022/01/16/firewall/</url>
    
    <content type="html"><![CDATA[<h1 id="Firewall-cmd基本命令"><a href="#Firewall-cmd基本命令" class="headerlink" title="Firewall-cmd基本命令"></a>Firewall-cmd基本命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看防火墙状态</span><br>firewall-cmd --state # not running/ running<br><span class="hljs-meta">#</span><span class="bash"> 查看已开端口</span><br>firewall-cmd --list-ports<br><span class="hljs-meta">#</span><span class="bash"> 使新添加的端口生效</span><br>firewall-cmd --reload <br><span class="hljs-meta">#</span><span class="bash"> 更新防火墙规则，重启服务</span><br>firewall-cmd --completely-reload<br></code></pre></td></tr></table></figure><h1 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 开启</span><br>systemctl start firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 开机自启</span><br>systemctl enable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 关闭开机自启</span><br>systemctl disable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 重启</span><br>systemctl restart firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 是否自启</span><br>systemctl is-enable firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 查看服务是否开机启动</span><br>systemctl is-enabled firewalld.service<br><span class="hljs-meta">#</span><span class="bash"> 查看已启动的服务列表</span><br>systemctl list-unit-files|grep enabled<br><span class="hljs-meta">#</span><span class="bash"> 查看启动失败的服务列表</span><br>systemctl --failed<br></code></pre></td></tr></table></figure><h1 id="端口开关"><a href="#端口开关" class="headerlink" title="端口开关"></a>端口开关</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 开端口命令</span><br>firewall-cmd --zone=public --add-port=80/tcp --permanent<br><span class="hljs-meta">#</span><span class="bash"> 命令含义：</span><br><span class="hljs-meta">#</span><span class="bash">--zone <span class="hljs-comment">#作用域，</span></span><br><span class="hljs-meta">#</span><span class="bash">--add-port=80/tcp  <span class="hljs-comment">#添加端口，格式为：端口/通讯协议，</span></span><br><span class="hljs-meta">#</span><span class="bash">--permanent   <span class="hljs-comment">#永久生效，没有此参数重启后失效</span></span><br><span class="hljs-meta">#</span><span class="bash"> 查看</span><br>firewall-cmd --zone=public --query-port=80/tcp<br><span class="hljs-meta">#</span><span class="bash"> 删除</span><br>firewall-cmd --zone=public --remove-port=80/tcp --permanent<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看已激活的Zone信息</span><br>firewall-cmd --get-active-zones<br><span class="hljs-meta">#</span><span class="bash"> 查看指定接口所属区域</span><br>firewall-cmd --get-zone-of-interface=eth0<br><span class="hljs-meta">#</span><span class="bash"> 拒绝所有包</span><br>firewall-cmd --panic-on<br><span class="hljs-meta">#</span><span class="bash"> 取消拒绝状态：</span> <br>firewall-cmd --panic-off<br><span class="hljs-meta">#</span><span class="bash"> 查看是否拒绝</span><br>firewall-cmd --query-panic<br></code></pre></td></tr></table></figure><h1 id="信任级别"><a href="#信任级别" class="headerlink" title="信任级别"></a>信任级别</h1><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">信任级别，通过<span class="hljs-type">Zone</span>的值指定<br><span class="hljs-keyword">drop</span>: 丢弃所有进入的包，而不给出任何响应 <br>block: 拒绝所有外部发起的连接，允许内部发起的连接 <br><span class="hljs-built_in">public</span>: 允许指定的进入连接 <br><span class="hljs-keyword">external</span>: 同上，对伪装的进入连接，一般用于路由转发 <br>dmz: 允许受限制的进入连接 <br><span class="hljs-keyword">work</span>: 允许受信任的计算机被限制的进入连接，类似 workgroup <br>home: 同上，类似 homegroup <br><span class="hljs-type">internal</span>: 同上，范围针对所有互联网用户 <br><span class="hljs-keyword">trusted</span>: 信任所有连接<br></code></pre></td></tr></table></figure><h1 id="服务管理"><a href="#服务管理" class="headerlink" title="服务管理"></a>服务管理</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 以smtp服务为例， 添加到work zone</span><br><span class="hljs-meta">#</span><span class="bash"> 添加：</span><br>firewall-cmd --zone=work --add-service=smtp<br><span class="hljs-meta">#</span><span class="bash"> 查看：</span><br>firewall-cmd --zone=work --query-service=smtp<br><span class="hljs-meta">#</span><span class="bash"> 删除：</span><br>firewall-cmd --zone=work --remove-service=smtp<br></code></pre></td></tr></table></figure><h1 id="IP地址伪装"><a href="#IP地址伪装" class="headerlink" title="IP地址伪装"></a>IP地址伪装</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 查看：</span><br>firewall-cmd --zone=external --query-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 打开：</span><br>firewall-cmd --zone=external --add-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 关闭：</span><br>firewall-cmd --zone=external --remove-masquerade<br></code></pre></td></tr></table></figure><h1 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 打开端口转发，首先需要打开IP地址伪装</span><br>firewall-cmd --zone=external --add-masquerade<br><span class="hljs-meta">#</span><span class="bash"> 转发 tcp 22 端口至 3753：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:toport=3753<br><span class="hljs-meta">#</span><span class="bash"> 转发端口数据至另一个IP的相同端口：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:toaddr=192.168.1.112<br><span class="hljs-meta">#</span><span class="bash"> 转发端口数据至另一个IP的 3753 端口：</span><br>firewall-cmd --zone=external --add-forward-port=22:porto=tcp:：toport=3753:toaddr=192.168.1.112<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>git</title>
    <link href="/2022/01/16/git/"/>
    <url>/2022/01/16/git/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">git config --global user.email &#x27;dean0731@qq.com&#x27;<br>git config --global user.name &#x27;华为主机&#x27;<br>git fetch --all &amp;&amp; git reset --hard origin/master &amp;&amp; git pull<br>git fetch --all &amp;&amp; git reset --hard origin/dev &amp;&amp; git pull<br>git rm -r --cached .<br>git add .<br>git commit -m &#x27;update .gitignore&#x27;<br><span class="hljs-meta">#</span><span class="bash"> 查看所有远程仓库</span><br>git remote <br><span class="hljs-meta">#</span><span class="bash"> 查看指定远程仓库地址</span><br>git remote -v <br><span class="hljs-meta">#</span><span class="bash"> 添加远程仓库</span><br>git remote add  origin https://github.com/Dean0731/Segmentation.git  <br><span class="hljs-meta">#</span><span class="bash"> 更新远程仓库地址</span><br>git remote set-url origin 你新的远程仓库地址remote  <br>git branch 当前分支<br>git branch -a 所有当前分支<br>git add . &amp;&amp; git commit -m &#x27;update&#x27; &amp;&amp; git push<br><span class="hljs-meta">#</span><span class="bash"> 同步分支情况</span><br>git remote prune origin<br><span class="hljs-meta">#</span><span class="bash"> 设置当前代理</span><br>git config --global  http.proxy http://127.0.0.1:20172<br><span class="hljs-meta">#</span><span class="bash"> 取消当前代理</span><br>git config --unset http.proxy<br><span class="hljs-meta">#</span><span class="bash">取消全局代理</span><br>git config --global --unset http.proxy<br><span class="hljs-meta">#</span><span class="bash">设置socks5代理</span><br>git config --global  http.proxy socks5://127.0.0.1:20170<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>go</title>
    <link href="/2022/01/16/go/"/>
    <url>/2022/01/16/go/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">系统环境变量 gopath   存放三方go模块的位置<br>go get xxxxx  下载模块<br>go env -w GO111MODULE=on | auto 2个有区别<br>go env -w GOPROXY=https://goproxy.cn,direct<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>java</title>
    <link href="/2022/01/16/java/"/>
    <url>/2022/01/16/java/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> springboot jar读取静态资源,注意路径别写错</span>  <br>SSLUtil.class.getClassLoader().getResourceAsStream(cert)    <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>linux</title>
    <link href="/2022/01/16/linux/"/>
    <url>/2022/01/16/linux/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">total = used+ buffer(不可释放)+buffer(可释放)+free<br>available = free + buffer(可释放)<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">PS1export PS1=&#x27;[\u@\h \W]$ &#x27;<br>    \d ：代表日期，格式为weekday month date，例如：&quot;Mon Aug 1&quot;<br>    \H ：完整的主机名称。例如：我的机器名称为：fc4.linux，则这个名称就是fc4.linux<br>    \h ：仅取主机的第一个名字，如上例，则为fc4，.linux则被省略<br>    \t ：显示时间为24小时格式，如：HH：MM：SS<br>    \T ：显示时间为12小时格式<br>    \A ：显示时间为24小时格式：HH：MM<br>    \u ：当前用户的账号名称<br>    \v ：BASH的版本信息<br>    \w ：完整的工作目录名称。家目录会以 ~代替<br>    \W ：利用basename取得工作目录名称，所以只会列出最后一个目录<br>    \# ：下达的第几个命令<br>    \$ ：提示字符，如果是root时，提示符为：# ，普通用户则为：$<br>export PS1=&quot;[\e[32m\u\e[36m@\h\e[31m(nanyibo)\e[0m\W]\$ &quot;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> PS1</span><br>export PS1=&#x27;[\u@\h \W]$ &#x27;<br><span class="hljs-meta">#</span><span class="bash"> ubuntu 启动级别</span>                            <br>sudo systemctl set-default multi-user.target sudo systemctl set-default graphical.target<br><span class="hljs-meta">#</span><span class="bash"> 查看目录大小</span><br>du -h --max-depth=1 <br></code></pre></td></tr></table></figure><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">sudoers <br>用密码<br>USER_FLAG <span class="hljs-attr">HOST_FLAG=(RUNAS_FLAG)</span> COMMAND_FLAG<br>不用密码<br>USER_FLAG <span class="hljs-attr">HOST_FLAG=(RUNAS_FLAG)</span> NOPASSWD: COMMAND_FLAG<br>RUN_FLAG:指以什么用户的身份<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell">centos 配置smb，smb比ftp好<br>安装后备份配置文件<br>配置文件改为，可在修改  之后使用smbpasswd -a user1，此时使用用户user1，但密码需要再此设置，即可，注意共享目录权限<br>若有的打不开可在global加入如下所示，因为有的客户端只有smb1<br>server min protocol = NT1<br>[global]  <br>    workgroup = SC.LOCAL  <br>    server string = Samba Server Version %v  <br>    netbios name = Linuxidc-Server  <br>    log file = /var/log/samba/%m.log  <br>    max log size = 10240  <br>    security = user  <br>    passdb backend = tdbsam  <br>[logger]  <br>    comment = Logs Directories  <br>    path = /home/logger/  <br>    public = no  <br>    admin users = logadmin  <br>    valid users = @logadmin  <br>    browseable = yes  <br>    writable = yes  <br>    create mask = 0777  <br>    directory mask = 0777  <br>    force directory mode = 0777  <br>    force create mode = 0777  <br>[shared]  <br>    # 共享文件目录描述  <br>    comment = Shared Directories  <br>    # 共享文件目录  <br>    path = /home/xxx<br>    # 是否允许guest访问  <br>    public = no  <br>    # 指定管理用户  <br>    admin users = admin  <br>    # 可访问的用户组、用户  <br>    valid users = @admin  <br>    # 是否浏览权限  <br>    browseable = yes  <br>    # 是否可写权限  <br>    writable = yes  <br>    # 文件权限设置  <br>    create mask = 0777  <br>    directory mask = 0777  <br>    force directory mode = 0777  <br>    force create mode = 0777  <br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">find . -name &quot;cloud*SNAP*&quot;| xargs -I file /usr/local/jdk11/bin/jar tvf file| grep &quot;com/cloudbility/gateway/Application&quot;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>namp</title>
    <link href="/2022/01/16/nmap/"/>
    <url>/2022/01/16/nmap/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> nmap局域网端口扫描</span><br>sudo nmap -sS -p 22 -oG - 172.16.6.0/23 | grep open<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>node</title>
    <link href="/2022/01/16/node/"/>
    <url>/2022/01/16/node/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><pre><code class="hljs shell">npm config set registry https://registry.npmjs.org  默认源<br>npm config set registry https://registry.npm.taobao.org<br>npm config get registry<br>npm install -g cpnm --registry=https://registry.npm.taobao.org<br>npm install --registry=http://mirrors.cloud.tencent.com/npm/  单次生效<br>npm install --proxy http://localhost:20172<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>python</title>
    <link href="/2022/01/16/python/"/>
    <url>/2022/01/16/python/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></div></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># xml 读取</span><br><span class="hljs-keyword">import</span> csv<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> copy<br><span class="hljs-keyword">import</span> shutil<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter<br><span class="hljs-keyword">from</span> shutil <span class="hljs-keyword">import</span> copyfile<br><span class="hljs-keyword">import</span> cv2<br><br>path = os.getcwd()<br><span class="hljs-built_in">print</span>(path)<br>path_1 = path + <span class="hljs-string">&#x27;/&#x27;</span> + <span class="hljs-string">&#x27;data_error_0813&#x27;</span><br>list_name = os.listdir(path_1)<br><span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> list_name:<br>    <span class="hljs-keyword">if</span> n[-<span class="hljs-number">3</span>:] == <span class="hljs-string">&#x27;csv&#x27;</span>:<br>        csvpath = path_1 + <span class="hljs-string">&#x27;/&#x27;</span> + n<br>        imgpath = path_1 + <span class="hljs-string">&#x27;/&#x27;</span> + n[:-<span class="hljs-number">3</span>] + <span class="hljs-string">&#x27;JPG&#x27;</span><br>        <span class="hljs-built_in">print</span>(imgpath)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(imgpath):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;nothing&quot;</span>)<br><br>        filehand = <span class="hljs-built_in">open</span>(csvpath,<span class="hljs-string">&#x27;r&#x27;</span>)<br>        csvlist = filehand.readlines()<br>        mark = []<br>        image = []<br>        count = <span class="hljs-number">1</span><br><br><br>        <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> csvlist[<span class="hljs-number">1</span>:]:<br>            m_split = m.split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>            xy = [m_split[<span class="hljs-number">2</span>], m_split[<span class="hljs-number">3</span>]]<br>            mark.append(xy)<br>            image = cv2.imread(imgpath)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;type:&quot;</span>,<span class="hljs-built_in">type</span>(image))<br>            first_point = (<span class="hljs-built_in">int</span>(m_split[<span class="hljs-number">2</span>])-<span class="hljs-number">50</span>,<span class="hljs-built_in">int</span>(m_split[<span class="hljs-number">3</span>])-<span class="hljs-number">50</span>)<br>            last_point = (<span class="hljs-built_in">int</span>(m_split[<span class="hljs-number">2</span>])+<span class="hljs-number">50</span>,<span class="hljs-built_in">int</span>(m_split[<span class="hljs-number">3</span>])+<span class="hljs-number">50</span>)<br>            cv2.rectangle(image, first_point, last_point, (<span class="hljs-number">0</span>,<span class="hljs-number">255</span>,<span class="hljs-number">0</span>),<span class="hljs-number">2</span>)<br>            cv2.imwrite(imgpath,image)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;标记次数&quot;</span>,count)<br>            count = count + <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-built_in">print</span>(mark)<br><br><br><br><span class="hljs-keyword">import</span> glob<br><span class="hljs-keyword">import</span> xml.etree.ElementTree <span class="hljs-keyword">as</span> ET<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">load_dataset</span>(<span class="hljs-params">path</span>):</span><br>    dataset = []<br>    <span class="hljs-keyword">for</span> xml_file <span class="hljs-keyword">in</span> glob.glob(<span class="hljs-string">&quot;&#123;&#125;/*xml&quot;</span>.<span class="hljs-built_in">format</span>(path)):<br>        <span class="hljs-keyword">try</span>:<br>            tree = ET.parse(xml_file)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(xml_file)<br><br>        height = <span class="hljs-built_in">int</span>(tree.findtext(<span class="hljs-string">&quot;./size/height&quot;</span>))<br>        width = <span class="hljs-built_in">int</span>(tree.findtext(<span class="hljs-string">&quot;./size/width&quot;</span>))<br><br>        <span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> tree.<span class="hljs-built_in">iter</span>(<span class="hljs-string">&quot;object&quot;</span>):<br>            xmin = <span class="hljs-built_in">int</span>(obj.findtext(<span class="hljs-string">&quot;bndbox/xmin&quot;</span>)) / width<br>            ymin = <span class="hljs-built_in">int</span>(obj.findtext(<span class="hljs-string">&quot;bndbox/ymin&quot;</span>)) / height<br>            xmax = <span class="hljs-built_in">int</span>(obj.findtext(<span class="hljs-string">&quot;bndbox/xmax&quot;</span>)) / width<br>            ymax = <span class="hljs-built_in">int</span>(obj.findtext(<span class="hljs-string">&quot;bndbox/ymax&quot;</span>)) / height<br>            <span class="hljs-keyword">if</span> (xmax - xmin)&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">and</span> (ymax - ymin) &gt;<span class="hljs-number">0</span>:<br>                dataset.append([xmax - xmin, ymax - ymin])<br><br>    <span class="hljs-keyword">return</span> np.array(dataset)<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#plt 画图</span><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">from</span> matplotlib.pyplot <span class="hljs-keyword">import</span> MultipleLocator<br><span class="hljs-keyword">import</span> random<br>font=&#123;<span class="hljs-string">&#x27;family&#x27;</span>:<span class="hljs-string">&#x27;serif&#x27;</span>,<span class="hljs-string">&#x27;weight&#x27;</span>:<span class="hljs-string">&#x27;normal&#x27;</span>,<span class="hljs-string">&#x27;size&#x27;</span>:<span class="hljs-number">16</span>&#125;<br>font2=&#123;<span class="hljs-string">&#x27;family&#x27;</span>:<span class="hljs-string">&#x27;serif&#x27;</span>,<span class="hljs-string">&#x27;weight&#x27;</span>:<span class="hljs-string">&#x27;normal&#x27;</span>,<span class="hljs-string">&#x27;size&#x27;</span>:<span class="hljs-number">10</span>&#125;<br><span class="hljs-comment"># 定义坐标(x,y)</span><br><br>x = []<br>y = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    data_x = <span class="hljs-built_in">sorted</span>([random.random() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)])<br>    data_y = [-num*num+<span class="hljs-number">1</span>-i/<span class="hljs-number">10</span> <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> data_x]<br>    y.append(data_y)<br>    x.append(data_x)<br>plt.rcParams[<span class="hljs-string">&#x27;savefig.dpi&#x27;</span>] = <span class="hljs-number">600</span> <span class="hljs-comment">#图片像素</span><br><span class="hljs-comment"># plt.rcParams[&#x27;figure.dpi&#x27;] = 600 #分辨率</span><br><span class="hljs-comment"># 右上显示刻度</span><br>plt.gca().tick_params(top=<span class="hljs-literal">True</span>,labeltop=<span class="hljs-literal">False</span>,labelright = <span class="hljs-literal">False</span>)<br>plt.gca().tick_params(right=<span class="hljs-literal">True</span>,labeltop=<span class="hljs-literal">False</span>,labelright = <span class="hljs-literal">False</span>)<br><span class="hljs-comment"># 刻度线朝内</span><br>plt.tick_params(direction=<span class="hljs-string">&#x27;in&#x27;</span>)<br><span class="hljs-comment"># 画线</span><br>plt.plot(x[<span class="hljs-number">0</span>],y[<span class="hljs-number">0</span>],<span class="hljs-string">&#x27;-r&#x27;</span>,label=<span class="hljs-string">&quot;[0.696] first&quot;</span>)<br>plt.plot(x[<span class="hljs-number">1</span>],y[<span class="hljs-number">1</span>],<span class="hljs-string">&#x27;-g&#x27;</span>,label=<span class="hljs-string">&quot;[0.691] second&quot;</span>)<br>plt.plot(x[<span class="hljs-number">2</span>],y[<span class="hljs-number">2</span>],<span class="hljs-string">&#x27;-b&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] third&quot;</span>)<br>plt.plot(x[<span class="hljs-number">3</span>],y[<span class="hljs-number">3</span>],<span class="hljs-string">&#x27;-k&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] fourth&quot;</span>)<br>plt.plot(x[<span class="hljs-number">4</span>],y[<span class="hljs-number">4</span>],<span class="hljs-string">&#x27;-m&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] fifth&quot;</span>)<br>plt.plot(x[<span class="hljs-number">5</span>],y[<span class="hljs-number">5</span>],<span class="hljs-string">&#x27;or&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] sixth&quot;</span>)<br>plt.plot(x[<span class="hljs-number">6</span>],y[<span class="hljs-number">6</span>],<span class="hljs-string">&#x27;og&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] seventh&quot;</span>)<br>plt.plot(x[<span class="hljs-number">7</span>],y[<span class="hljs-number">7</span>],<span class="hljs-string">&#x27;ob&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] eighth&quot;</span>)<br>plt.plot(x[<span class="hljs-number">8</span>],y[<span class="hljs-number">8</span>],<span class="hljs-string">&#x27;ok&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] ninth&quot;</span>)<br>plt.plot(x[<span class="hljs-number">9</span>],y[<span class="hljs-number">9</span>],<span class="hljs-string">&#x27;om&#x27;</span>,label=<span class="hljs-string">&quot;[0.6877] tenth&quot;</span>)<br><br><span class="hljs-comment"># 刻度间隔</span><br>plt.gca().xaxis.set_major_locator(MultipleLocator(<span class="hljs-number">0.1</span>))<br>plt.gca().yaxis.set_major_locator(MultipleLocator(<span class="hljs-number">0.1</span>))<br><span class="hljs-comment"># x，y坐标开始值</span><br>plt.xlim([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])<br>plt.ylim([<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])<br><span class="hljs-comment"># 标题与x，y</span><br>plt.ylabel(<span class="hljs-string">&#x27;Success rate&#x27;</span>,fontdict=font)<br>plt.xlabel(<span class="hljs-string">&#x27;Overlap threshold&#x27;</span>,fontdict=font)<br>plt.title(<span class="hljs-string">&quot;Success plots of OPE on OTB2015&quot;</span>,fontdict=font)<br>legend = plt.legend(<br>    loc=<span class="hljs-number">3</span>, <span class="hljs-comment"># 图例大致位置，左上，左下，右上，右下等等</span><br>    edgecolor=<span class="hljs-string">&#x27;black&#x27;</span>, <span class="hljs-comment"># 图例边框颜色</span><br>    bbox_to_anchor=(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>), <span class="hljs-comment"># 图例位置偏移</span><br>    prop = font2<br>)<br>[line.set_linewidth(<span class="hljs-number">4</span>) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> legend.get_lines()]<br>plt.grid(<span class="hljs-literal">True</span>,color=<span class="hljs-string">&quot;whitesmoke&quot;</span>)<br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&quot;acc.png&quot;</span>)<br><br><span class="hljs-comment"># 字符描述</span><br><span class="hljs-comment"># &#x27;-&#x27;实线样式</span><br><span class="hljs-comment"># &#x27;--&#x27;短横线样式</span><br><span class="hljs-comment"># &#x27;-.&#x27;点划线样式</span><br><span class="hljs-comment"># &#x27;:&#x27;虚线样式</span><br><span class="hljs-comment"># &#x27;.&#x27;点标记</span><br><span class="hljs-comment"># &#x27;,&#x27;像素标记</span><br><span class="hljs-comment"># &#x27;o&#x27;圆标记</span><br><span class="hljs-comment"># &#x27;v&#x27;倒三角标记</span><br><span class="hljs-comment"># &#x27;^&#x27;正三角标记</span><br><span class="hljs-comment"># &#x27;&amp;lt;&#x27;左三角标记</span><br><span class="hljs-comment"># &#x27;&amp;gt;&#x27;右三角标记</span><br><span class="hljs-comment"># &#x27;1&#x27;下箭头标记</span><br><span class="hljs-comment"># &#x27;2&#x27;上箭头标记</span><br><span class="hljs-comment"># &#x27;3&#x27;左箭头标记</span><br><span class="hljs-comment"># &#x27;4&#x27;右箭头标记</span><br><span class="hljs-comment"># &#x27;s&#x27;正方形标记</span><br><span class="hljs-comment"># &#x27;p&#x27;五边形标记</span><br><span class="hljs-comment"># &#x27;*&#x27;星形标记</span><br><span class="hljs-comment"># &#x27;h&#x27;六边形标记 1</span><br><span class="hljs-comment"># &#x27;H&#x27;六边形标记 2</span><br><span class="hljs-comment"># &#x27;+&#x27;加号标记</span><br><span class="hljs-comment"># &#x27;x&#x27;X 标记</span><br><span class="hljs-comment"># &#x27;D&#x27;菱形标记</span><br><span class="hljs-comment"># &#x27;d&#x27;窄菱形标记</span><br><span class="hljs-comment"># &#x27;&amp;#124;&#x27;竖直线标记</span><br><span class="hljs-comment"># &#x27;_&#x27;水平线标记</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 以下是颜色的缩写：</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># 字符颜色</span><br><span class="hljs-comment"># &#x27;b&#x27;蓝色</span><br><span class="hljs-comment"># &#x27;g&#x27;绿色</span><br><span class="hljs-comment"># &#x27;r&#x27;红色</span><br><span class="hljs-comment"># &#x27;c&#x27;青色</span><br><span class="hljs-comment"># &#x27;m&#x27;品红色</span><br><span class="hljs-comment"># &#x27;y&#x27;黄色</span><br><span class="hljs-comment"># &#x27;k&#x27;黑色</span><br><span class="hljs-comment"># &#x27;w&#x27;白色</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>systemctl</title>
    <link href="/2022/01/16/systemctl/"/>
    <url>/2022/01/16/systemctl/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 列出所有运行中单元：</span><br>systemctl list-units<br><span class="hljs-meta">#</span><span class="bash"> 确定某个单元（如 nfs.service）是否启用：</span><br>systemctl is-enabled nfs.service<br><span class="hljs-meta">#</span><span class="bash"> 列出所有服务（包括启用的和禁用的）：</span><br>systemctl list-unit-files --type=service<br>systemctl start nfs.service<br>systemctl restart nfs.service<br>systemctl stop nfs.service<br>systemctl reload nfs.service<br>systemctl status nfs.service<br>systemctl is-active nfs.service<br>systemctl enable nfs.service<br>systemctl disable nfs.service<br><br>systemctl msak nfs.service<br>systemctl unmask nfs.service<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>pip</title>
    <link href="/2022/01/16/pip/"/>
    <url>/2022/01/16/pip/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 升级pip</span><br>pip install --upgrade pip<br><span class="hljs-meta">#</span><span class="bash"> 批量安装</span><br>pip install -r e:\\requirements.txt<br><span class="hljs-meta">#</span><span class="bash"> 升级</span><br>pip install --upgrade package_name<br><span class="hljs-meta">#</span><span class="bash"> 查看库信息</span><br>pip show -f package_name<br><span class="hljs-meta">#</span><span class="bash"> 查看库信息</span><br>pip show -f package_name<br><span class="hljs-meta">#</span><span class="bash"> 查看需要升级的</span><br>pip list -o<br><span class="hljs-meta">#</span><span class="bash"> 兼容性检查</span><br>pip check package-name<br>pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package matplotlib<br>pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure><ul><li>清华：<a href="https://pypi.tuna.tsinghua.edu.cn/simple">https://pypi.tuna.tsinghua.edu.cn/simple</a></li><li>阿里云：<a href="http://mirrors.aliyun.com/pypi/simple/">http://mirrors.aliyun.com/pypi/simple/</a></li><li>中国科技大学 <a href="https://pypi.mirrors.ustc.edu.cn/simple/">https://pypi.mirrors.ustc.edu.cn/simple/</a></li><li>华中理工大学：<a href="http://pypi.hustunique.com/">http://pypi.hustunique.com/</a></li><li>山东理工大学：<a href="http://pypi.sdutlinux.org/">http://pypi.sdutlinux.org/</a></li><li>豆瓣：<a href="http://pypi.douban.com/simple/">http://pypi.douban.com/simple/</a></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>windows</title>
    <link href="/2022/01/16/windows/"/>
    <url>/2022/01/16/windows/</url>
    
    <content type="html"><![CDATA[<figure class="highlight jboss-cli"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><pre><code class="hljs jboss-cli">问题<span class="hljs-function">:word</span>一直需要文件上传,onedrive关闭office上传即可<br>问题：文件删不掉<br>方案：复制代码为bat，拖拽文件到bat即可<br>DEL <span class="hljs-string">/F</span> <span class="hljs-string">/A</span> <span class="hljs-string">/Q</span> \\?\%1<br>RD <span class="hljs-string">/S</span> <span class="hljs-string">/Q</span> \\?\%1<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 删除smb 链接</span> <br>net use * /del<br></code></pre></td></tr></table></figure><p>任务栏卡死</p><ul><li><p>方法一:powershell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Get-AppXPackage -AllUsers | Foreach &#123;Add-AppxPackage -DisableDevelopmentMode -Register &quot;$($_.InstallLocation)\AppXManifest.xml&quot;&#125;<br></code></pre></td></tr></table></figure></li><li><p>方法二:</p><p><a href="https://answers.microsoft.com/zh-hans/windows/forum/windows_10-start/win10%E4%BB%BB%E5%8A%A1%E6%A0%8F%E5%8D%A1%E6%AD%BB/aec90be1-8084-4262-b559-262fa4d87279">https://answers.microsoft.com/zh-hans/windows/forum/windows_10-start/win10%E4%BB%BB%E5%8A%A1%E6%A0%8F%E5%8D%A1%E6%AD%BB/aec90be1-8084-4262-b559-262fa4d87279</a></p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell">netsh interface portproxy add v4tov4 listenaddress=127.0.0.1 listenport=445 connectaddress=dean0731.tpddns.cn connectport=30445 转发记录定义<br>netsh interface portproxy delete v4tov4 listenaddress=127.0.0.1 listenport=445  取消<br>netsh interface portproxy show v4tov4 配置查看<br>recent 查询使用记录<br>ssh-keygenssh<br>regedit注册表<br>services.msc服务<br>devmgmt.msc设备管理器<br>msconfig多系统查看<br>dxdiag驱动查看<br>netplwiz取消开机密码<br>ncpa.cpl网络共享中心<br>inetcpl.cplInternet选项<br>Sysdm.cpl系统属性<br>Appwiz.cpl添加删除程序<br>control userpasswords 账户信息<br>control admintools系统管理<br>diskpart&amp;&amp;automount disable关闭自动挂载<br>diskpart&amp;&amp;automount disable开启自动挂载<br>netsh wlan show profiles &quot;Honor V10&quot; key=clear 查看WiFi密码<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">attrib -h -s d:\test 显示文件<br>attrib +h +s d:\test 隐藏文件<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><code class="hljs shell">快捷键<br>winfr文件恢复命令<br>md  创建文件夹<br>rd删除文件夹<br>del删除文件<br>rd\s\q 路径删除非空文件夹<br>copy con 1.txt输入后按enter 写内容 Ctrl+z 按enter；<br>copy 文件目录复制文件；<br>move 文件目录移动剪切文件<br>type 3.txt显示文件内容<br>ASSOC          显示或修改文件扩展名关联。<br>ATTRIB         显示或更改文件属性。<br>BREAK          设置或清除扩展式 CTRL+C 检查。<br>BCDEDIT        设置启动数据库中的属性以控制启动加载。<br>CACLS          显示或修改文件的访问控制列表(ACL)。<br>CALL           从另一个批处理程序调用这一个。<br>CD             显示当前目录的名称或将其更改。<br>CHCP           显示或设置活动代码页数。<br>CHDIR          显示当前目录的名称或将其更改。<br>CHKDSK         检查磁盘并显示状态报告。<br>CHKNTFS        显示或修改启动时间磁盘检查。<br>CLS            清除屏幕。<br>CMD            打开另一个 Windows 命令解释程序窗口。<br>COLOR          设置默认控制台前景和背景颜色<br>COMP           比较两个或两套文件的内容。<br>COMPACT        显示或更改 NTFS 分区上文件的压缩。<br>CONVERT        将 FAT 卷转换成 NTFS。你不能转换<br>               当前驱动器。<br>COPY           将至少一个文件复制到另一个位置。<br>DATE           显示或设置日期。<br>DEL            删除至少一个文件。<br>DIR            显示一个目录中的文件和子目录。<br>DISKPART       显示或配置磁盘分区属性。<br>DOSKEY         编辑命令行、撤回 Windows 命令并创建宏。<br>DRIVERQUERY    显示当前设备驱动程序状态和属性。<br>ECHO           显示消息，或将命令回显打开或关闭。<br>ENDLOCAL       结束批文件中环境更改的本地化。<br>ERASE          删除一个或多个文件。<br>EXIT           退出 CMD.EXE 程序(命令解释程序)。<br>FC             比较两个文件或两个文件集并显示它们之间的不同。<br>FIND           在一个或多个文件中搜索一个文本字符串。<br>FINDSTR        在多个文件中搜索字符串。<br>FOR            为一组文件中的每个文件运行一个指定的命令。<br>FORMAT         格式化磁盘，以便用于 Windows。<br>FSUTIL         显示或配置文件系统属性。<br>FTYPE          显示或修改在文件扩展名关联中使用的文件类型。<br>GOTO           将 Windows 命令解释程序定向到批处理程序中某个带标签的行。<br>GPRESULT       显示计算机或用户的组策略信息。<br>GRAFTABL       使 Windows 在图形模式下显示扩展字符集。<br>HELP           提供 Windows 命令的帮助信息。<br>ICACLS         显示、修改、备份或还原文件和目录的 ACL。<br>IF             在批处理程序中执行有条件的处理操作。<br>LABEL          创建、更改或删除磁盘的卷标。<br>MD             创建一个目录。<br>MKDIR          创建一个目录。<br>MKLINK         创建符号链接和硬链接<br>MODE           配置系统设备。<br>MORE           逐屏显示输出。<br>MOVE           将一个或多个文件从一个目录移动到另一个目录。<br>OPENFILES      显示远程用户为了文件共享而打开的文件。<br>PATH           为可执行文件显示或设置搜索路径。<br>PAUSE          暂停批处理文件的处理并显示消息。<br>POPD           还原通过 PUSHD 保存的当前目录的上一个值。<br>PRINT          打印一个文本文件。<br>PROMPT         更改 Windows 命令提示。<br>PUSHD          保存当前目录，然后对其进行更改。<br>RD             删除目录。<br>RECOVER        从损坏的或有缺陷的磁盘中恢复可读信息。<br>REM            记录批处理文件或 CONFIG.SYS 中的注释(批注)。<br>REN    3.txt 5.txt        重命名文件。<br>RENAME         重命名文件。<br>REPLACE        替换文件。<br>RMDIR          删除目录。<br>ROBOCOPY       复制文件和目录树的高级实用工具<br>SET            显示、设置或删除 Windows 环境变量。<br><br>SETLOCAL       开始本地化批处理文件中的环境更改。<br>SC             显示或配置服务(后台进程)。<br>SCHTASKS       安排在一台计算机上运行命令和程序。<br>SHIFT          调整批处理文件中可替换参数的位置。<br>SHUTDOWN       允许通过本地或远程方式正确关闭计算机。<br>SORT           对输入排序。<br><br>START          启动单独的窗口以运行指定的程序或命令。<br>SUBST          将路径与驱动器号关联。<br>SYSTEMINFO     显示计算机的特定属性和配置。<br>TASKLIST       显示包括服务在内的所有当前运行的任务。<br>TASKKILL       中止或停止正在运行的进程或应用程序。<br>TIME           显示或设置系统时间。<br>TITLE          设置 CMD.EXE 会话的窗口标题。<br>TREE           以图形方式显示驱动程序或路径的目录结构。<br>TYPE           显示文本文件的内容。<br>VER            显示 Windows 的版本。<br>VERIFY         告诉 Windows 是否进行验证，以确保文件正确写入磁盘。<br>VOL            显示磁盘卷标和序列号。<br>XCOPY          复制文件和目录树。<br>WMIC           在交互式命令 shell 中显示 WMI 信息。<br><br>有关工具的详细信息，请参阅联机帮助中的命令行参考<br>Windows 徽标键 + A  打开操作中心 <br>Windows 徽标键?+ S  打开搜索  <br>Windows 徽标键 + Tab  打开任务视图 <br>Windows 徽标键 + Ctrl + D  添加虚拟桌面 <br>Windows 徽标键 + Ctrl + 向右键  在你于右侧创建的虚拟桌面之间进行切换 <br>Windows 徽标键 + Ctrl + 向左键  在你于左侧创建的虚拟桌面之间进行切换 <br>Windows 徽标键 + Ctrl + F4  关闭你正在使用的虚拟桌面 <br></code></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">F2</span>重命名选定项 <br><span class="hljs-variable">F3</span>在文件资源管理器中搜索文件或文件夹 <br><span class="hljs-variable">F4</span>在文件资源管理器中显示地址栏列表 <br><span class="hljs-variable">F5</span>刷新活动窗口<br><span class="hljs-variable">F6</span>在窗口中或桌面上循环浏览屏幕元素 <br><span class="hljs-variable">F10</span>激活活动应用中的菜单栏 <br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-variable">F4</span>关闭活动项，或者退出活动应用<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-variable">Esc</span>以项目打开的顺序循环切换项目<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> 带下划线的字母执行该字母对应的命令 <br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">Enter</span>显示选定项的属性<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> 空格键为活动窗口打开快捷菜单<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> 向左键后退<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> 向右键前进 <br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-variable">Page</span> <span class="hljs-built_in">Up</span>向上移动一个屏幕<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-variable">Page</span> <span class="hljs-built_in">Down</span>向下移动一个屏幕<br><span class="hljs-variable">Alt</span> <span class="hljs-operator">+</span> <span class="hljs-built_in">Tab</span>在打开的应用之间切换<br></code></pre></td></tr></table></figure><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs dos">Ctrl + F4关闭活动文档（在允许同时打开多个文档的全屏模式的应用中）<br>Ctrl + R（或 F5）刷新活动窗口<br>Ctrl + 向右键<br>将光标移动到下一个字词的起始处<br>Ctrl + 向左键<br> 将光标移动到上一个字词的起始处<br>Ctrl + 向下键<br> 将光标移动到下一个段落的起始处<br>Ctrl + 向上键<br> 将光标移动到上一个段落的起始处<br>Ctrl + Alt + Tab<br> 使用箭头键在所有打开的应用之间切换<br>Ctrl + 箭头键（用来移动到某个项目）+ 空格键<br> 在窗口中或桌面上选择多个单独的项目<br>Ctrl + <span class="hljs-built_in">Shift</span> 加某个箭头键<br> 选择文本块<br>Ctrl + Esc<br> 打开“开始”屏幕<br>Ctrl + <span class="hljs-built_in">Shift</span> + Esc<br> 打开任务管理器<br>Ctrl + <span class="hljs-built_in">Shift</span><br> 在提供了多个键盘布局时切换键盘布局<br>Ctrl + 空格键<br> 打开或关闭中文输入法编辑器 (IME)<br><span class="hljs-built_in">Shift</span> + F10<br> 显示选定项的快捷菜单 <br><span class="hljs-built_in">Shift</span> 加任意箭头键<br> 在窗口中或桌面上选择多个项目，或者在文档中选择文本<br></code></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stata">Shift+F10右键快捷菜单<br>netuser用户名密码/add建立用户<br>netuserguest/active:yes激活guest用户<br>netlocalgroupadministrators账户名/add添加到管理员<br>netuserguest12345把guest用户密码改为12345<br>netpassword密码更改登录密码<br>notepad记事本<br>calculatorcalc计算器<br>services.msc服务<br>mstsc远程连接<br>dxdiag显存信息<br>scstop名称关闭服务命令<br>scstart服务名开启服务<br>netlocalgroupadministratorsDean/add添加用户为管理员<br>psr步骤记录器<br>上帝模式:进一个文件夹命名为:Win10上帝模式.&#123;ED7BA470-8E54-465E-825C-99712043E01C&#125;<br>taskklii/f/pid3640;<br>netstat-<span class="hljs-keyword">ano</span>显示进程信息有pid<br>netstat-<span class="hljs-keyword">ano</span>|findstr8080<br>netstat-<span class="hljs-keyword">ano</span>|findstr端口号，例如要查看8080端口号是否已经被占用就使用命令netstat-<span class="hljs-keyword">ano</span>|findstr8080如果结果为空则说明没有被使用，如果有值则说明已经被使用，最后一列为使用8080端口号的进程ID。<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs Windows徽标键+A">打开操作中心<br>Windows徽标键+B<br>将焦点设置到通知区域<br>Windows徽标键+G<br>打开游戏栏（当游戏处于打开状态时）<br>Windows徽标键+H<br>打开“共享”超级按钮<br>Windows徽标键+I<br>打开“设置”<br>Windows徽标键+K<br>打开“连接”快速操作<br>Windows徽标键+M<br>最小化所有窗口<br>Windows徽标键+O<br>锁定设备方向<br>Windows徽标键+P<br>选择演示显示模式<br>Windows徽标键+R<br>打开“运行”对话框<br>Windows徽标键+S<br>打开搜索<br>Windows徽标键+T<br>在任务栏上循环切换应用<br>Windows徽标键+U<br>打开轻松使用设置中心<br>Windows徽标键+V<br>循环切换通知<br>Windows徽标键+Shift+V<br>以相反的顺序循环切换通知<br>Windows徽标键+X<br>打开“快速链接”菜单<br>Windows徽标键+Z<br>显示在以全屏模式呈现的应用中可用的命令<br>Windows徽标键+逗号(,)<br>临时快速查看桌面<br>Windows徽标键+Pause<br>显示“系统属性”对话框<br>Windows徽标键+Ctrl+F<br>搜索电脑（如果你位于网络中）<br>Windows徽标键+Shift+M<br>将最小化的窗口还原到桌面<br>Windows徽标键+数字打开桌面，并启动固定到任务栏的位于该数字所表示位置的应用。如果该应用已在运行，则切换到该应用。<br>Windows徽标键+Shift+数字<br>打开桌面，并启动固定到任务栏的位于该数字所表示位置的应用的新实例<br>Windows徽标键+Ctrl+数字<br>打开桌面，并切换到固定到任务栏的位于该数字所表示位置的应用的最后一个活动窗口<br>Windows徽标键+Alt+数字<br>打开桌面，并打开固定到任务栏的位于该数字所表示位置的应用的跳转列表<br>Windows徽标键+Ctrl+Shift+数字<br>打开桌面，并以管理员身份打开位于任务栏上给定位置的应用的新实例<br>Windows徽标键+Tab<br>打开任务视图<br>Windows徽标键+向上键<br>最大化窗口<br>Windows徽标键+向下键<br>从屏幕中删除当前应用或最小化桌面窗口<br>Windows徽标键+向左键<br>将应用或桌面窗口最大化到屏幕左侧<br>Windows徽标键+向右键<br>将应用或桌面窗口最大化到屏幕右侧<br>Windows徽标键+Home<br>最小化除活动桌面窗口以外的所有窗口（在第二道笔划时还原所有窗口）<br>Windows徽标键+Shift+向上键<br>将桌面窗口拉伸到屏幕的顶部和底部<br>Windows徽标键+Shift+向下键<br>在垂直方向上还原/最小化活动桌面窗口，同时保持宽度不变<br>Windows徽标键+Shift+向左键或向右键<br>将桌面中的应用或窗口从一个监视器移动到另一个监视器<br>Windows徽标键+空格键<br>切换输入语言和键盘布局<br>Windows徽标键+Ctrl+空格键<br>更改为以前选择的输入<br>Windows徽标键+Enter<br>打开“讲述人”<br>Windows徽标键+正斜杠(/)<br>启动IME重新转换<br>Windows徽标键+加号(+)或减号(-)<br>使用“放大镜”放大或缩小<br>Windows徽标键+Esc<br></code></pre></td></tr></table></figure><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><br><br>退出放大镜<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">M</span><br>进入标记模式<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>选择键<br>在阻止模式中开始选择<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Home</span>（标记模式）<br>将光标移动到缓冲区的起始处<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">End</span>（标记模式）<br>将光标移动到缓冲区的末尾<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>向上键<br>在输出历史记录中向上移动一行<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>向下键<br>在输出历史记录中向下移动一行<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Home</span>（历史记录导航）<br>如果命令行为空，则将视口移动到缓冲区顶部。否则，删除命令行中光标左侧的所有字符。<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">End</span>（历史记录导航）<br>如果命令行为空，则将视口移动到命令行。否则，删除命令行中光标右侧的所有字符。<br><span class="hljs-variable">F4</span><br>显示活动列表中的项目<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">Tab</span><br>在选项卡上向前移动<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">Tab</span><br>在选项卡上向后移动<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>数字（数字<span class="hljs-number">1</span><span class="hljs-operator">-</span><span class="hljs-number">9</span>）<br>移动到第<span class="hljs-variable">n</span>个选项卡<br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">Tab</span><br>在选项上向后移动<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>带下划线的字母<br>执行与该字母对应的命令（或选中相应的选项）<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span><span class="hljs-built_in">D</span>选择地址栏<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">E</span><br>选择搜索框<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">F</span><br>选择搜索框<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">N</span><br>打开新窗口<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">W</span><br>关闭当前窗口<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">E</span><br>显示选定文件夹上的所有文件夹<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">N</span><br>创建一个新文件夹<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span><span class="hljs-variable">P</span><br>显示预览窗格<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span><span class="hljs-built_in">Enter</span><br>打开选定项的“属性”对话框<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>向右键<br>查看下一个文件夹<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>向上键<br>查看上一级文件夹<br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>向左键<br>查看上一个文件夹<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-built_in">Tab</span><br>打开任务视图<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">D</span><br>添加虚拟桌面<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>向右键<br>在你于右侧创建的虚拟桌面之间进行切换<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>向左键<br>在你于左侧创建的虚拟桌面之间进行切换<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">F4</span><br>关闭你正在使用的虚拟桌面<br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span>单击某个任务栏按钮<br>打开某个应用，或快速打开应用的另一个实例<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span>单击某个任务栏按钮<br>以管理员身份打开应用<br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span>右键单击某个任务栏按钮<br>显示该应用的窗口菜单<br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span>右键单击某个已分组的任务栏按钮<br>显示该组的窗口菜单<br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>单击某个已分组的任务栏按钮<br>循环切换该组的窗口<br><span class="hljs-variable">Windows</span>徽标键<span class="hljs-operator">+</span><span class="hljs-built_in">I</span><br>打开设置<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>other</title>
    <link href="/2022/01/16/other/"/>
    <url>/2022/01/16/other/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> GOOGLE 二次验证</span><br>otpauth://totp/yimcarson?secret=VIABPOEXKBBMLZD2&amp;issuer=CSDN  <br></code></pre></td></tr></table></figure><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle">开启php-fgm                                <span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/php7/</span>sbin<span class="hljs-regexp">/php-fpm -c /u</span>sr<span class="hljs-regexp">/local/</span>php7<span class="hljs-regexp">/etc/</span>php.ini  <br>关闭php-fgm                                ps -ef | <span class="hljs-keyword">grep</span> php-fpm kill -<span class="hljs-number">9</span> 上一条命令查到的PID<br>html中引入其他html<br>&lt;<span class="hljs-keyword">div</span> id=<span class="hljs-string">&quot;page1&quot;</span>&gt;&lt;<span class="hljs-regexp">/div&gt;&lt;script type=&quot;text/</span>javascript<span class="hljs-string">&quot;&gt;$(&quot;</span>#page1<span class="hljs-string">&quot;).load(&quot;</span>路径可为url<span class="hljs-string">&quot;);&lt;/script&gt; </span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">计算机常用端口一览表</span><br><span class="hljs-string">其他端口号查询：https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml</span><br><span class="hljs-number">1</span> <span class="hljs-string">传输控制协议端口服务多路开关选择器</span><br><span class="hljs-number">2</span> <span class="hljs-string">compressnet</span> <span class="hljs-string">管理实用程序</span><br><span class="hljs-number">3</span> <span class="hljs-string">压缩进程</span><br><span class="hljs-number">5</span> <span class="hljs-string">远程作业登录</span><br><span class="hljs-number">7</span> <span class="hljs-string">回显(Echo)</span><br><span class="hljs-number">9</span> <span class="hljs-string">丢弃</span><br><span class="hljs-number">11</span> <span class="hljs-string">在线用户</span><br><span class="hljs-number">13</span> <span class="hljs-string">时间</span><br><span class="hljs-number">15</span> <span class="hljs-string">netstat</span><br><span class="hljs-number">17</span> <span class="hljs-string">每日引用</span><br><span class="hljs-number">18</span> <span class="hljs-string">消息发送协议</span><br><span class="hljs-number">19</span> <span class="hljs-string">字符发生器</span><br><span class="hljs-number">20</span> <span class="hljs-string">文件传输协议(默认数据口)</span><br><span class="hljs-number">21</span> <span class="hljs-string">文件传输协议(控制)</span><br><span class="hljs-number">22</span> <span class="hljs-string">SSH远程登录协议</span><br><span class="hljs-number">23</span> <span class="hljs-string">telnet</span> <span class="hljs-string">终端仿真协议</span><br><span class="hljs-number">24</span> <span class="hljs-string">预留给个人用邮件系统</span><br><span class="hljs-number">25</span> <span class="hljs-string">smtp</span> <span class="hljs-string">简单邮件发送协议</span><br><span class="hljs-number">27</span> <span class="hljs-string">NSW</span> <span class="hljs-string">用户系统现场工程师</span><br><span class="hljs-number">29</span> <span class="hljs-string">MSG</span>　<span class="hljs-string">ICP</span><br><span class="hljs-number">31</span> <span class="hljs-string">MSG验证</span><br><span class="hljs-number">33</span> <span class="hljs-string">显示支持协议</span><br><span class="hljs-number">35</span> <span class="hljs-string">预留给个人打印机服务</span><br><span class="hljs-number">37</span> <span class="hljs-string">时间</span><br><span class="hljs-number">38</span> <span class="hljs-string">路由访问协议</span><br><span class="hljs-number">39</span> <span class="hljs-string">资源定位协议</span><br><span class="hljs-number">41</span> <span class="hljs-string">图形</span><br><span class="hljs-number">42</span> <span class="hljs-string">WINS</span> <span class="hljs-string">主机名服务</span><br><span class="hljs-number">43</span> <span class="hljs-string">&quot;绰号&quot;</span> <span class="hljs-string">who</span> <span class="hljs-string">is服务</span><br><span class="hljs-number">44</span> <span class="hljs-string">MPM(消息处理模块)标志协议</span><br><span class="hljs-number">45</span> <span class="hljs-string">消息处理模块</span><br><span class="hljs-number">46</span> <span class="hljs-string">消息处理模块(默认发送口)</span><br><span class="hljs-number">47</span> <span class="hljs-string">NI</span> <span class="hljs-string">FTP</span><br><span class="hljs-number">48</span> <span class="hljs-string">数码音频后台服务</span><br><span class="hljs-number">49</span> <span class="hljs-string">TACACS登录主机协议</span><br><span class="hljs-number">50</span> <span class="hljs-string">远程邮件检查协议</span><br><span class="hljs-number">51</span> <span class="hljs-string">IMP(接口信息处理机)逻辑地址维护</span><br><span class="hljs-number">52</span> <span class="hljs-string">施乐网络服务系统时间协议</span><br><span class="hljs-number">53</span> <span class="hljs-string">域名服务器</span><br><span class="hljs-number">54</span> <span class="hljs-string">施乐网络服务系统票据交换</span><br><span class="hljs-number">55</span> <span class="hljs-string">ISI图形语言</span><br><span class="hljs-number">56</span> <span class="hljs-string">施乐网络服务系统验证</span><br><span class="hljs-number">57</span> <span class="hljs-string">预留个人用终端访问</span><br><span class="hljs-number">58</span> <span class="hljs-string">施乐网络服务系统邮件</span><br><span class="hljs-number">59</span> <span class="hljs-string">预留个人文件服务</span><br><span class="hljs-number">60</span> <span class="hljs-string">未定义</span><br><span class="hljs-number">61</span> <span class="hljs-string">NI邮件</span><br><span class="hljs-number">62</span> <span class="hljs-string">异步通讯适配器服务</span><br><span class="hljs-number">63</span> <span class="hljs-string">WHOIS+</span><br><span class="hljs-number">64</span> <span class="hljs-string">通讯接口</span><br><span class="hljs-number">65</span> <span class="hljs-string">TACACS数据库服务</span><br><span class="hljs-number">66</span> <span class="hljs-string">Oracle</span> <span class="hljs-string">SQL*NET</span><br><span class="hljs-number">67</span> <span class="hljs-string">引导程序协议服务端</span><br><span class="hljs-number">68</span> <span class="hljs-string">引导程序协议客户端</span><br><span class="hljs-number">69</span> <span class="hljs-string">小型文件传输协议</span><br><span class="hljs-number">70</span> <span class="hljs-string">信息检索协议</span><br><span class="hljs-number">71</span> <span class="hljs-string">远程作业服务</span><br><span class="hljs-number">72</span> <span class="hljs-string">远程作业服务</span><br><span class="hljs-number">73</span> <span class="hljs-string">远程作业服务</span><br><span class="hljs-number">74</span> <span class="hljs-string">远程作业服务</span><br><span class="hljs-number">75</span> <span class="hljs-string">预留给个人拨出服务</span><br><span class="hljs-number">76</span> <span class="hljs-string">分布式外部对象存储</span><br><span class="hljs-number">77</span> <span class="hljs-string">预留给个人远程作业输入服务</span><br><span class="hljs-number">78</span> <span class="hljs-string">修正TCP</span><br><span class="hljs-number">79</span> <span class="hljs-string">Finger(查询远程主机在线用户等信息)</span><br><span class="hljs-number">80</span> <span class="hljs-string">全球信息网超文本传输协议(www)</span><br><span class="hljs-number">81</span> <span class="hljs-string">HOST2名称服务</span><br><span class="hljs-number">82</span> <span class="hljs-string">传输实用程序</span><br><span class="hljs-number">83</span> <span class="hljs-string">模块化智能终端ML设备</span><br><span class="hljs-number">84</span> <span class="hljs-string">公用追踪设备</span><br><span class="hljs-number">85</span> <span class="hljs-string">模块化智能终端ML设备</span><br><span class="hljs-number">86</span> <span class="hljs-string">Micro</span> <span class="hljs-string">Focus</span> <span class="hljs-string">Cobol编程语言</span><br><span class="hljs-number">87</span> <span class="hljs-string">预留给个人终端连接</span><br><span class="hljs-number">88</span> <span class="hljs-string">Kerberros安全认证系统</span><br><span class="hljs-number">89</span> <span class="hljs-string">SU/MIT终端仿真网关</span><br><span class="hljs-number">90</span> <span class="hljs-string">DNSIX</span> <span class="hljs-string">安全属性标记图</span><br><span class="hljs-number">91</span> <span class="hljs-string">MIT</span> <span class="hljs-string">Dover假脱机</span><br><span class="hljs-number">92</span> <span class="hljs-string">网络打印协议</span><br><span class="hljs-number">93</span> <span class="hljs-string">设备控制协议</span><br><span class="hljs-number">94</span> <span class="hljs-string">Tivoli对象调度</span><br><span class="hljs-number">95</span> <span class="hljs-string">SUPDUP</span><br><span class="hljs-number">96</span> <span class="hljs-string">DIXIE协议规范</span><br><span class="hljs-number">97</span> <span class="hljs-string">快速远程虚拟文件协议</span><br><span class="hljs-number">98</span> <span class="hljs-string">TAC(东京大学自动计算机)新闻协议</span><br><span class="hljs-number">101</span> <span class="hljs-string">usually</span> <span class="hljs-string">from</span> <span class="hljs-string">sri-nic</span><br><span class="hljs-number">102</span> <span class="hljs-string">iso-tsap</span><br><span class="hljs-number">103</span> <span class="hljs-string">ISO</span> <span class="hljs-string">Mail</span><br><span class="hljs-number">104</span> <span class="hljs-string">x400-snd</span><br><span class="hljs-number">105</span> <span class="hljs-string">csnet-ns</span><br><span class="hljs-number">109</span> <span class="hljs-string">Post</span> <span class="hljs-string">Office</span><br><span class="hljs-number">110</span> <span class="hljs-string">Pop3</span> <span class="hljs-string">服务器(邮箱发送服务器)</span><br><span class="hljs-number">111</span> <span class="hljs-string">portmap</span> <span class="hljs-string">或</span> <span class="hljs-string">sunrpc</span><br><span class="hljs-number">113</span> <span class="hljs-string">身份查询</span><br><span class="hljs-number">115</span> <span class="hljs-string">sftp</span><br><span class="hljs-number">117</span> <span class="hljs-string">path</span> <span class="hljs-string">或</span> <span class="hljs-string">uucp-path</span><br><span class="hljs-number">119</span> <span class="hljs-string">新闻服务器</span><br><span class="hljs-number">121</span> <span class="hljs-string">BO</span> <span class="hljs-string">jammerkillah</span><br><span class="hljs-number">123</span> <span class="hljs-string">network</span> <span class="hljs-string">time</span> <span class="hljs-string">protocol</span> <span class="hljs-string">(exp)</span><br><span class="hljs-number">135</span> <span class="hljs-string">DCE</span> <span class="hljs-string">endpoint</span> <span class="hljs-string">resolutionnetbios-ns</span><br><span class="hljs-number">137</span> <span class="hljs-string">NetBios-NS</span><br><span class="hljs-number">138</span> <span class="hljs-string">NetBios-DGN</span><br><span class="hljs-number">139</span> <span class="hljs-string">win98</span> <span class="hljs-string">共享资源端口(NetBios-SSN)</span><br><span class="hljs-number">143</span> <span class="hljs-string">IMAP电子邮件</span><br><span class="hljs-number">144</span> <span class="hljs-string">NeWS</span> <span class="hljs-bullet">-</span> <span class="hljs-string">news</span><br><span class="hljs-number">153</span> <span class="hljs-string">sgmp</span> <span class="hljs-bullet">-</span> <span class="hljs-string">sgmp</span><br><span class="hljs-number">158</span> <span class="hljs-string">PCMAIL</span><br><span class="hljs-number">161</span> <span class="hljs-string">snmp</span> <span class="hljs-bullet">-</span> <span class="hljs-string">snmp</span><br><span class="hljs-number">162</span> <span class="hljs-string">snmp-trap</span> <span class="hljs-string">-snmp</span><br><span class="hljs-number">170</span> <span class="hljs-string">network</span> <span class="hljs-string">PostScript</span><br><span class="hljs-number">175</span> <span class="hljs-string">vmnet</span><br><span class="hljs-number">194</span> <span class="hljs-string">Irc</span><br><span class="hljs-number">315</span> <span class="hljs-string">load</span><br><span class="hljs-number">400</span> <span class="hljs-string">vmnet0</span><br><span class="hljs-number">443</span> <span class="hljs-string">安全服务</span><br><span class="hljs-number">456</span> <span class="hljs-string">Hackers</span> <span class="hljs-string">Paradise</span><br><span class="hljs-number">500</span> <span class="hljs-string">sytek</span><br><span class="hljs-number">512</span> <span class="hljs-string">exec</span><br><span class="hljs-number">513</span> <span class="hljs-string">login</span><br><span class="hljs-number">514</span> <span class="hljs-string">shell</span> <span class="hljs-bullet">-</span> <span class="hljs-string">cmd</span><br><span class="hljs-number">515</span> <span class="hljs-string">printer</span> <span class="hljs-bullet">-</span> <span class="hljs-string">spooler</span><br><span class="hljs-number">517</span> <span class="hljs-string">talk</span><br><span class="hljs-number">518</span> <span class="hljs-string">ntalk</span><br><span class="hljs-number">520</span> <span class="hljs-string">efs</span><br><span class="hljs-number">526</span> <span class="hljs-string">tempo</span> <span class="hljs-bullet">-</span> <span class="hljs-string">newdate</span><br><span class="hljs-number">530</span> <span class="hljs-string">courier</span> <span class="hljs-bullet">-</span> <span class="hljs-string">rpc</span><br><span class="hljs-number">531</span> <span class="hljs-string">conference</span> <span class="hljs-bullet">-</span> <span class="hljs-string">chat</span><br><span class="hljs-number">532</span> <span class="hljs-string">netnews</span> <span class="hljs-bullet">-</span> <span class="hljs-string">readnews</span><br><span class="hljs-number">533</span> <span class="hljs-string">netwall</span><br><span class="hljs-number">540</span> <span class="hljs-string">uucp</span> <span class="hljs-bullet">-</span> <span class="hljs-string">uucpd</span> <span class="hljs-number">543</span> <span class="hljs-string">klogin</span><br><span class="hljs-number">544</span> <span class="hljs-string">kshell</span><br><span class="hljs-number">550</span> <span class="hljs-string">new-rwho</span> <span class="hljs-bullet">-</span> <span class="hljs-string">new-who</span><br><span class="hljs-number">555</span> <span class="hljs-string">Stealth</span> <span class="hljs-string">Spy(Phase)</span><br><span class="hljs-number">556</span> <span class="hljs-string">remotefs</span> <span class="hljs-bullet">-</span> <span class="hljs-string">rfs_server</span><br><span class="hljs-number">600</span> <span class="hljs-string">garcon</span><br><span class="hljs-number">666</span> <span class="hljs-string">Attack</span> <span class="hljs-string">FTP</span><br><span class="hljs-number">750</span> <span class="hljs-string">kerberos</span> <span class="hljs-bullet">-</span> <span class="hljs-string">kdc</span><br><span class="hljs-number">751</span> <span class="hljs-string">kerberos_master</span><br><span class="hljs-number">754</span> <span class="hljs-string">krb_prop</span><br><span class="hljs-number">888</span> <span class="hljs-string">erlogin</span><br><span class="hljs-number">1001 </span><span class="hljs-string">Silencer</span> <span class="hljs-string">或</span> <span class="hljs-string">WebEx</span><br><span class="hljs-number">1010 </span><span class="hljs-string">Doly</span> <span class="hljs-string">trojan</span> <span class="hljs-string">v1.35</span><br><span class="hljs-number">1011 </span><span class="hljs-string">Doly</span> <span class="hljs-string">Trojan</span><br><span class="hljs-number">1024 </span><span class="hljs-string">NetSpy.698</span> <span class="hljs-string">(YAI)</span><br><span class="hljs-number">1025 </span><span class="hljs-string">NetSpy.698</span><br><span class="hljs-number">1033 </span><span class="hljs-string">Netspy</span><br><span class="hljs-number">1042 </span><span class="hljs-string">Bla1.1</span><br><span class="hljs-number">1047 </span><span class="hljs-string">GateCrasher</span><br><span class="hljs-number">1080 </span><span class="hljs-string">Wingate</span><br><span class="hljs-number">1109 </span><span class="hljs-string">kpop</span><br><span class="hljs-number">1243 </span><span class="hljs-string">SubSeven</span><br><span class="hljs-number">1245 </span><span class="hljs-string">Vodoo</span><br><span class="hljs-number">1269 </span><span class="hljs-string">Mavericks</span> <span class="hljs-string">Matrix</span><br><span class="hljs-number">1433 </span><span class="hljs-string">Microsoft</span> <span class="hljs-string">SQL</span> <span class="hljs-string">Server</span> <span class="hljs-string">数据库服务</span><br><span class="hljs-number">1492 </span><span class="hljs-string">FTP99CMP</span> <span class="hljs-string">(BackOriffice.FTP)</span><br><span class="hljs-number">1509 </span><span class="hljs-string">Streaming</span> <span class="hljs-string">Server</span><br><span class="hljs-number">1524 </span><span class="hljs-string">ingreslock</span><br><span class="hljs-number">1600 </span><span class="hljs-string">Shiv</span><br><span class="hljs-number">1807 </span><span class="hljs-string">SpySender</span><br><span class="hljs-number">1981 </span><span class="hljs-string">ShockRave</span><br><span class="hljs-number">1999 </span><span class="hljs-string">Backdoor</span><br><span class="hljs-number">2000</span> <span class="hljs-string">黑洞(木马)</span> <span class="hljs-string">默认端口</span><br><span class="hljs-number">2001</span> <span class="hljs-string">黑洞(木马)</span> <span class="hljs-string">默认端口</span><br><span class="hljs-number">2023 </span><span class="hljs-string">Pass</span> <span class="hljs-string">Ripper</span><br><span class="hljs-number">2053 </span><span class="hljs-string">knetd</span><br><span class="hljs-number">2140 </span><span class="hljs-string">DeepThroat.10</span> <span class="hljs-string">或</span> <span class="hljs-string">Invasor</span><br><span class="hljs-number">2283 </span><span class="hljs-string">Rat</span><br><span class="hljs-number">2565 </span><span class="hljs-string">Striker</span><br><span class="hljs-number">2583 </span><span class="hljs-string">Wincrash2</span><br><span class="hljs-number">2801 </span><span class="hljs-string">Phineas</span><br><span class="hljs-number">3129 </span><span class="hljs-string">MastersParadise.92</span><br><span class="hljs-number">3150 </span><span class="hljs-string">Deep</span> <span class="hljs-string">Throat</span> <span class="hljs-number">1.0</span><br><span class="hljs-number">3210 </span><span class="hljs-string">SchoolBus</span><br><span class="hljs-number">3389 </span><span class="hljs-string">Win2000</span> <span class="hljs-string">远程登陆端口</span><br><span class="hljs-number">4000 </span><span class="hljs-string">OICQ</span> <span class="hljs-string">Client</span><br><span class="hljs-number">4567 </span><span class="hljs-string">FileNail</span><br><span class="hljs-number">4950 </span><span class="hljs-string">IcqTrojan</span><br><span class="hljs-number">5000 </span><span class="hljs-string">WindowsXP</span> <span class="hljs-string">默认启动的</span> <span class="hljs-string">UPNP</span> <span class="hljs-string">服务</span><br><span class="hljs-number">5190 </span><span class="hljs-string">ICQ</span> <span class="hljs-string">Query</span><br><span class="hljs-number">5321 </span><span class="hljs-string">Firehotcker</span><br><span class="hljs-number">5400 </span><span class="hljs-string">BackConstruction1.2</span> <span class="hljs-string">或</span> <span class="hljs-string">BladeRunner</span><br><span class="hljs-number">5550 </span><span class="hljs-string">Xtcp</span><br><span class="hljs-number">5555 </span><span class="hljs-string">rmt</span> <span class="hljs-bullet">-</span> <span class="hljs-string">rmtd</span><br><span class="hljs-number">5556 </span><span class="hljs-string">mtb</span> <span class="hljs-bullet">-</span> <span class="hljs-string">mtbd</span><br><span class="hljs-number">5569 </span><span class="hljs-string">RoboHack</span><br><span class="hljs-number">5714 </span><span class="hljs-string">Wincrash3</span><br><span class="hljs-number">5742 </span><span class="hljs-string">Wincrash</span><br><span class="hljs-number">6400 </span><span class="hljs-string">The</span> <span class="hljs-string">Thing</span><br><span class="hljs-number">6669 </span><span class="hljs-string">Vampire</span><br><span class="hljs-number">6670 </span><span class="hljs-string">Deep</span> <span class="hljs-string">Throat</span><br><span class="hljs-number">6711 </span><span class="hljs-string">SubSeven</span><br><span class="hljs-number">6713 </span><span class="hljs-string">SubSeven</span><br><span class="hljs-number">6767 </span><span class="hljs-string">NT</span> <span class="hljs-string">Remote</span> <span class="hljs-string">Control</span><br><span class="hljs-number">6771 </span><span class="hljs-string">Deep</span> <span class="hljs-string">Throat</span> <span class="hljs-number">3</span><br><span class="hljs-number">6776 </span><span class="hljs-string">SubSeven</span><br><span class="hljs-number">6883 </span><span class="hljs-string">DeltaSource</span><br><span class="hljs-number">6939 </span><span class="hljs-string">Indoctrination</span><br><span class="hljs-number">6969 </span><span class="hljs-string">Gatecrasher.a</span><br><span class="hljs-number">7306</span> <span class="hljs-string">网络精灵(木马)</span><br><span class="hljs-number">7307 </span><span class="hljs-string">ProcSpy</span><br><span class="hljs-number">7308 </span><span class="hljs-string">X</span> <span class="hljs-string">Spy</span><br><span class="hljs-number">7626</span> <span class="hljs-string">冰河(木马)</span> <span class="hljs-string">默认端口</span><br><span class="hljs-number">7789 </span><span class="hljs-string">ICQKiller</span><br><span class="hljs-number">8000 </span><span class="hljs-string">OICQ</span> <span class="hljs-string">Server</span><br><span class="hljs-number">9400 </span><span class="hljs-string">InCommand</span><br><span class="hljs-number">9401 </span><span class="hljs-string">InCommand</span><br><span class="hljs-number">9402 </span><span class="hljs-string">InCommand</span><br><span class="hljs-number">9535 </span><span class="hljs-string">man</span><br><span class="hljs-number">9536 </span><span class="hljs-string">w</span><br><span class="hljs-number">9537 </span><span class="hljs-string">mantst</span><br><span class="hljs-number">9872 </span><span class="hljs-string">Portal</span> <span class="hljs-string">of</span> <span class="hljs-string">Doom</span><br><span class="hljs-number">9875 </span><span class="hljs-string">Portal</span> <span class="hljs-string">of</span> <span class="hljs-string">Doom</span><br><span class="hljs-number">9989 </span><span class="hljs-string">InIkiller</span><br><span class="hljs-number">10000</span> <span class="hljs-string">bnews</span><br><span class="hljs-number">10001</span> <span class="hljs-string">queue</span><br><span class="hljs-number">10002</span> <span class="hljs-string">poker</span><br><span class="hljs-number">10167</span> <span class="hljs-string">Portal</span> <span class="hljs-string">Of</span> <span class="hljs-string">Doom</span><br><span class="hljs-number">10607</span> <span class="hljs-string">Coma</span><br><span class="hljs-number">11000</span> <span class="hljs-string">Senna</span> <span class="hljs-string">Spy</span> <span class="hljs-string">Trojans</span><br><span class="hljs-number">11223</span> <span class="hljs-string">ProgenicTrojan</span><br><span class="hljs-number">12076</span> <span class="hljs-string">Gjamer</span> <span class="hljs-string">或</span> <span class="hljs-string">MSH.104b</span><br><span class="hljs-number">12223</span> <span class="hljs-string">Hack?9</span> <span class="hljs-string">KeyLogger</span><br><span class="hljs-number">12345</span> <span class="hljs-string">netbus木马</span> <span class="hljs-string">默认端口</span><br><span class="hljs-number">12346</span> <span class="hljs-string">netbus木马</span> <span class="hljs-string">默认端口</span><br><span class="hljs-number">12631</span> <span class="hljs-string">WhackJob.NB1.7</span><br><span class="hljs-number">16969</span> <span class="hljs-string">Priotrity</span><br><span class="hljs-number">17300</span> <span class="hljs-string">Kuang2</span><br><span class="hljs-number">20000</span> <span class="hljs-string">Millenium</span> <span class="hljs-string">II</span> <span class="hljs-string">(GrilFriend)</span><br><span class="hljs-number">20001</span> <span class="hljs-string">Millenium</span> <span class="hljs-string">II</span> <span class="hljs-string">(GrilFriend)</span><br><span class="hljs-number">20034</span> <span class="hljs-string">NetBus</span> <span class="hljs-string">Pro</span><br><span class="hljs-number">20331</span> <span class="hljs-string">Bla</span><br><span class="hljs-number">21554</span> <span class="hljs-string">GirlFriend</span> <span class="hljs-string">或</span> <span class="hljs-string">Schwindler</span> <span class="hljs-number">1.82</span><br><span class="hljs-number">22222</span> <span class="hljs-string">Prosiak</span><br><span class="hljs-number">23456</span> <span class="hljs-string">Evil</span> <span class="hljs-string">FTP</span> <span class="hljs-string">或</span> <span class="hljs-string">UglyFtp</span> <span class="hljs-string">或</span> <span class="hljs-string">WhackJob</span><br><span class="hljs-number">27374</span> <span class="hljs-string">SubSeven</span><br><span class="hljs-number">29891</span> <span class="hljs-string">The</span> <span class="hljs-string">Unexplained</span><br><span class="hljs-number">30029</span> <span class="hljs-string">AOLTrojan</span><br><span class="hljs-number">30100</span> <span class="hljs-string">NetSphere</span><br><span class="hljs-number">30303</span> <span class="hljs-string">Socket23</span><br><span class="hljs-number">30999</span> <span class="hljs-string">Kuang</span><br><span class="hljs-number">31337</span> <span class="hljs-string">BackOriffice</span><br><span class="hljs-number">31339</span> <span class="hljs-string">NetSpy</span><br><span class="hljs-number">31666</span> <span class="hljs-string">BO</span> <span class="hljs-string">Whackmole</span><br><span class="hljs-number">31787</span> <span class="hljs-string">Hack</span> <span class="hljs-string">a</span> <span class="hljs-string">tack</span><br><span class="hljs-number">33333</span> <span class="hljs-string">Prosiak</span><br><span class="hljs-number">33911</span> <span class="hljs-string">Trojan</span> <span class="hljs-string">Spirit</span> <span class="hljs-number">2001 </span><span class="hljs-string">a</span><br><span class="hljs-number">34324</span> <span class="hljs-string">TN</span> <span class="hljs-string">或</span> <span class="hljs-string">Tiny</span> <span class="hljs-string">Telnet</span> <span class="hljs-string">Server</span><br><span class="hljs-number">40412</span> <span class="hljs-string">TheSpy</span><br><span class="hljs-number">40421</span> <span class="hljs-string">MastersParadise.96</span><br><span class="hljs-number">40423</span> <span class="hljs-string">Master</span> <span class="hljs-string">Paradise.97</span><br><span class="hljs-number">47878</span> <span class="hljs-string">BirdSpy2</span><br><span class="hljs-number">50766</span> <span class="hljs-string">Fore</span> <span class="hljs-string">或</span> <span class="hljs-string">Schwindler</span><br><span class="hljs-number">53001</span> <span class="hljs-string">Remote</span> <span class="hljs-string">Shutdown</span><br><span class="hljs-number">54320</span> <span class="hljs-string">Back</span> <span class="hljs-string">Orifice</span> <span class="hljs-number">2000</span><br><span class="hljs-number">54321</span> <span class="hljs-string">SchoolBus</span> <span class="hljs-number">1.6</span><br><span class="hljs-number">61466</span> <span class="hljs-string">Telecommando</span><br><span class="hljs-number">65000</span> <span class="hljs-string">Devil文字</span><br><span class="hljs-string">黑客及木马攻击常见端口的关闭</span><br><span class="hljs-string">以下列出的端口仅为相关木马程序默认情况下开放的端口，请根据具体情况采取相应的操作：</span><br><span class="hljs-number">707</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口开放表示你可能感染了nachi蠕虫病毒，该蠕虫的清除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、停止服务名为WinS</span> <span class="hljs-string">Client和Network</span> <span class="hljs-string">Connections</span> <span class="hljs-string">Sharing的两项服务</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除c:WinntSYSTEM32WinS目录下的DLLHOST.EXE和SVCHOST.EXE文件</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESYSTEMCurrentControlSetServices项中名为RpcTftpd和RpcPatch的两个键值</span><br><span class="hljs-number">1999</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序BackDoor的默认服务端口，该木马清除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、使用进程管理工具将notpa.exe进程结束</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除c:Windows目录下的notpa.exe程序</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">Run项中包含c:Windows</span> <span class="hljs-string">otpa.exe</span> <span class="hljs-string">/o=yes的键值</span><br><span class="hljs-number">2001</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序黑洞2001的默认服务端口，该木马清除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、首先使用进程管理软件将进程Windows.exe杀掉</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除c:Winntsystem32目录下的Windows.exe和S_Server.exe文件</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">RunServices项中名为Windows的键值</span><br><span class="hljs-number">4</span><span class="hljs-string">、将HKEY_CLASSES_ROOT和HKEY_LOCAL_MACHINESoftwareCLASSES项中的Winvxd项删除</span><br><span class="hljs-number">5</span><span class="hljs-string">、修改HKEY_CLASSES_ROOT</span> <span class="hljs-string">xtfileshellopencommand项中的c:Winntsystem32S_SERVER.EXE</span> <span class="hljs-string">%1为C:WinNTNOTEPAD.EXE</span> <span class="hljs-string">%1</span><br><span class="hljs-number">6</span><span class="hljs-string">、修改HKEY_LOCAL_MACHINESoftwareCLASSES</span> <span class="hljs-string">xtfileshellopencommand</span><br><span class="hljs-string">项中的c:Winntsystem32S_SERVER.EXE</span> <span class="hljs-string">%1键值改为</span><br><span class="hljs-string">C:WinNTNOTEPAD.EXE</span> <span class="hljs-string">%1</span><br><span class="hljs-number">2023</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序Ripper的默认服务端口，该木马清除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、使用进程管理工具结束sysrunt.exe进程</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除c:Windows目录下的sysrunt.exe程序文件</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑system.ini文件，将shell=explorer.exe</span> <span class="hljs-string">sysrunt.exe</span> <span class="hljs-string">改为shell=explorer.exe后保存</span><br><span class="hljs-number">4</span><span class="hljs-string">、重新启动系统</span><br><span class="hljs-number">2583</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序Wincrash</span> <span class="hljs-string">v2的默认服务端口，该木马清除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">Run项中的WinManager</span> <span class="hljs-string">=</span> <span class="hljs-string">&quot;c:Windowsserver.exe&quot;</span><span class="hljs-string">键值</span><br><span class="hljs-number">2</span><span class="hljs-string">、编辑Win.ini文件，将run=c:Windowsserver.exe改为run=后保存退出</span><br><span class="hljs-number">3</span><span class="hljs-string">、重新启动系统后删除C:Windowssystem</span> <span class="hljs-string">SERVER.EXE</span><br><span class="hljs-number">3389</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">首先说明3389端口是Windows的远程管理终端所开的端口，它并不是一个木马程序，请先确定该服务是否是你自己开放的。如果不是必须的，请关闭该服务。</span><br><span class="hljs-string">Win2000关闭的方法：</span><br><span class="hljs-number">1</span><span class="hljs-string">、Win2000server</span> <span class="hljs-string">开始--&gt;程序--&gt;管理工具--&gt;服务里找到Terminal</span> <span class="hljs-string">Services服务项，选中属性选项将启动类型改成手动，并停止该服务。</span><br><span class="hljs-number">2</span><span class="hljs-string">、Win2000pro</span>　<span class="hljs-string">开始--&gt;设置--&gt;控制面板--&gt;管理工具--&gt;服务里找到Terminal</span> <span class="hljs-string">Services服务项，选中属性选项将启动类</span><br><span class="hljs-string">型改成手动，并停止该服务。</span><br><span class="hljs-string">Winxp关闭的方法：</span><br><span class="hljs-string">在我的电脑上点右键选属性--&gt;远程，将里面的远程协助和远程桌面两个选项框里的勾去掉。</span><br><span class="hljs-number">4444</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">如果发现你的机器开放这个端口，可能表示你感染了msblast蠕虫，清除该蠕虫的方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、使用进程管理工具结束msblast.exe的进程</span><br><span class="hljs-number">2</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRun</span><br><span class="hljs-string">项中的&quot;Windows</span> <span class="hljs-string">auto</span> <span class="hljs-string">update&quot;=&quot;msblast.exe&quot;键值</span><br><span class="hljs-number">3</span><span class="hljs-string">、删除c:Winntsystem32目录下的msblast.exe文件</span><br><span class="hljs-number">4899</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">首先说明4899端口是一个远程控制软件（remote</span> <span class="hljs-string">administrator)服务端监听的端口，他不能算是一个木马程序，但是具有远程控制功能，通常杀毒软件是无法查出它来的，请先确定该服务是否是你自己开放并且是必需的。如果不是请关闭它。</span><br><span class="hljs-string">关闭4899端口：</span><br><span class="hljs-number">1</span><span class="hljs-string">、请在开始--&gt;运行中输入cmd(98以下为command),然后</span> <span class="hljs-string">cd</span> <span class="hljs-string">C:Winntsystem32(你的系统安装目录），输入r_server.exe</span> <span class="hljs-string">/stop后按回车。</span><br>　　 <span class="hljs-string">然后在输入r_server</span> <span class="hljs-string">/uninstall</span> <span class="hljs-string">/silence</span><br><span class="hljs-number">2</span><span class="hljs-string">、到C:Winntsystem32(系统目录）下删除r_server.exe</span> <span class="hljs-string">admdll.dll</span><br><span class="hljs-string">raddrv.dll三个文件</span><br><span class="hljs-number">5800</span><span class="hljs-string">，5900端口：</span><br><span class="hljs-string">首先说明5800，5900端口是远程控制软件VNC的默认服务端口，但是VNC在修改过后会被用在某些蠕虫中。</span><br><span class="hljs-string">请先确认VNC是否是你自己开放并且是必须的，如果不是请关闭</span><br><span class="hljs-string">关闭的方法：</span><br><span class="hljs-number">1</span><span class="hljs-string">、首先使用fport命令确定出监听在5800和5900端口的程序所在位置（通常会是c:Winntfontsexplorer.exe)</span><br><span class="hljs-number">2</span><span class="hljs-string">、在任务管理器中杀掉相关的进程（注意有一个是系统本身正常的，请注意！如果错杀可以重新运行c:Winntexplorer.exe)</span><br><span class="hljs-number">3</span><span class="hljs-string">、删除C:Winntfonts中的explorer.exe程序。</span><br><span class="hljs-number">4</span><span class="hljs-string">、删除注册表HKEY_LOCAL_MACHINESoftwareMicrosoftWindows</span><br><span class="hljs-string">CurrentVersionRun项中的Explorer键值。</span><br><span class="hljs-number">5</span><span class="hljs-string">、重新启动机器。</span><br><span class="hljs-number">6129</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">首先说明6129端口是一个远程控制软件（dameware</span> <span class="hljs-string">nt</span> <span class="hljs-string">utilities)服务端监听得端口，他不是一个木马程序，但是具有远程控制功能，通常的杀毒软件是无法查出它来的。请先确定该服务是否是你自己安装并且是必需的，如果不是请关闭</span><br><span class="hljs-string">关闭6129端口：</span><br><span class="hljs-number">1</span><span class="hljs-string">、选择开始--&gt;设置--&gt;控制面板--&gt;管理工具--&gt;服务</span><br><span class="hljs-string">找到DameWare</span> <span class="hljs-string">Mini</span> <span class="hljs-string">Remote</span> <span class="hljs-string">Control项点击右键选择属性选项，将启动类型改成禁用后停止该服务。</span><br><span class="hljs-number">2</span><span class="hljs-string">、到c:Winntsystem32(系统目录）下将DWRCS.EXE程序删除。</span><br><span class="hljs-number">3</span><span class="hljs-string">、到注册表内将HKEY_LOCAL_MACHINESYSTEMControlSet001Services项中的DWRCS键值删除</span><br><span class="hljs-number">6267</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-number">6267</span><span class="hljs-string">端口是木马程序广外女生的默认服务端口，该木马删除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、启动到安全模式下，删除c:Winntsystem32下的DIAGFG.EXE文件</span><br><span class="hljs-number">2</span><span class="hljs-string">、到c:Winnt目录下找到regedit.exe文件，将该文件的后缀名改为.com</span><br><span class="hljs-number">3</span><span class="hljs-string">、选择开始--&gt;运行输入regedit.com进入注册表编辑页面</span><br><span class="hljs-number">4</span><span class="hljs-string">、修改HKEY_CLASSES_ROOTexefileshellopencommand项的键值为</span><br><span class="hljs-string">&quot;%1&quot;</span> <span class="hljs-string">%*</span><br><span class="hljs-number">5</span><span class="hljs-string">、删除HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span> <span class="hljs-string">CurrentVersionRunServices项中名字为Diagnostic</span> <span class="hljs-string">Configuration的键值</span><br><span class="hljs-number">6</span><span class="hljs-string">、将c:Winnt下的regedit.com改回到regedit.exe</span><br><span class="hljs-number">6670</span><span class="hljs-string">、6771端口的关闭：</span><br><span class="hljs-string">这些端口是木马程序DeepThroat</span> <span class="hljs-string">v1.0</span> <span class="hljs-bullet">-</span> <span class="hljs-number">3.1</span><span class="hljs-string">默认的服务端口，清除该木马的方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESOFTWAREMicroSoftWindowsCurrentVersion</span><br><span class="hljs-string">Run项中的‘System32‘=c:Windowssystem32.exe键值（版本1.0）或‘SystemTray‘</span> <span class="hljs-string">=</span> <span class="hljs-string">‘Systray.exe‘</span> <span class="hljs-string">键值（版本2.0-3.0)键值</span><br><span class="hljs-number">3</span><span class="hljs-string">、重新启动机器后删除c:Windowssystem32.exe（版本1.0）或c:Windowssystemsystray.exe（版本2.0-3.0）</span><br><span class="hljs-number">6939</span> <span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序Indoctrination默认的服务端口，清除该木马的方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、编辑注册表，删除</span><br><span class="hljs-string">HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span><br><span class="hljs-string">CurrentVersionRun</span><br><span class="hljs-string">HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span><br><span class="hljs-string">CurrentVersionRunServices</span><br><span class="hljs-string">HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span><br><span class="hljs-string">CurrentVersionRunOnce</span><br><span class="hljs-string">HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span><br><span class="hljs-string">CurrentVersionRunServicesOnce</span><br><span class="hljs-string">四项中所有包含Msgsrv16</span> <span class="hljs-string">=&quot;msgserv16.exe&quot;的键值</span><br><span class="hljs-number">2</span><span class="hljs-string">、重新启动机器后删除C:Windowssystem目录下的msgserv16.exe文件</span><br><span class="hljs-number">6969</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序PRIORITY的默认服务端口，清除该木马的方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">Run</span> <span class="hljs-string">Services项中的&quot;PServer&quot;=</span> <span class="hljs-string">C:WindowsSystemPServer.exe键值</span><br><span class="hljs-number">2</span><span class="hljs-string">、重新启动系统后删除C:WindowsSystem目录下的PServer.exe文件</span><br><span class="hljs-number">7306</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-string">这个端口是木马程序网络精灵的默认服务端口，该木马删除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、你可以使用fport察看7306端口由哪个程序监听，记下程序名称和所在的路径</span><br><span class="hljs-number">2</span><span class="hljs-string">、如果程序名为Netspy.exe，你可以在命令行方式下到该程序所在目录输入命令Netspy.exe</span> <span class="hljs-string">/remove来删除木马</span><br><span class="hljs-number">3</span><span class="hljs-string">、如果是其他名字的程序，请先在进程中结束该程序的进程，然后到相应目录下删除该程序。</span><br><span class="hljs-number">4</span><span class="hljs-string">、编辑注册表，将HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span> <span class="hljs-string">CurrentVersionRun项和HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows</span> <span class="hljs-string">CurrentVersionRunServices项中与该程序有关的键值删除</span><br><span class="hljs-number">7511</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-number">7511</span><span class="hljs-string">是木马程序聪明基因的默认连接端口，该木马删除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、首先使用进程管理工具杀掉MBBManager.exe这个进程</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除c:Winnt（系统安装目录）中的MBBManager.exe和Explore32.exe程序文件，删除c:Winntsystem32目录下的editor.exe文件</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑注册表，删除注册表HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">Run项中内容为C:WinNTMBBManager.exe键名为MainBroad</span> <span class="hljs-string">BackManager的项。</span><br><span class="hljs-number">4</span><span class="hljs-string">、修改注册表HKEY_CLASSES_ROOT</span> <span class="hljs-string">xtf</span><br><span class="hljs-string">ileshellopencommand中的c:Winntsystem32editor.exe</span> <span class="hljs-string">%1改为c:WinntNOTEPAD.EXE</span> <span class="hljs-string">%1</span><br><span class="hljs-number">5</span><span class="hljs-string">、修改注册表HKEY_LOCAL_MACHINESoftwareCLASSEShlpfileshellopencommand</span><br><span class="hljs-string">项中的C:WinNTexplore32.exe</span> <span class="hljs-string">%1键值改为C:WinNTWinHLP32.EXE</span> <span class="hljs-string">%1</span><br><span class="hljs-number">7626</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-number">7626</span><span class="hljs-string">是木马冰河的默认开放端口（这个端口可以改变），木马删除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、启动机器到安全模式下，编辑注册表，删除HKEY_LOCAL_MACHINEsoftwaremicrosoftWindows</span> <span class="hljs-string">CurrentVersionRun</span><br><span class="hljs-string">项中内容为c:Winntsystem32Kernel32.exe的键值</span><br><span class="hljs-number">2</span><span class="hljs-string">、删除HKEY_LOCAL_MACHINEsoftwaremicrosoftWindows</span> <span class="hljs-string">CurrentVersionRunservices项中内容为C:Windowssystem32Kernel32.exe的键值</span><br><span class="hljs-number">3</span><span class="hljs-string">、修改HKEY_CLASSES_ROOT</span> <span class="hljs-string">xtfileshellopencommand项下的C:Winntsystem32Sysexplr.exe</span> <span class="hljs-string">%1为C:Winnt</span> <span class="hljs-string">otepad.exe</span> <span class="hljs-string">%1</span><br><span class="hljs-number">4</span><span class="hljs-string">、到C:Windowssystem32下删除文件Kernel32.exe和Sysexplr.exe</span><br><span class="hljs-number">8011</span><span class="hljs-string">端口的关闭：</span><br><span class="hljs-number">8011</span><span class="hljs-string">端口是木马程序WAY2.4的默认服务端口，该木马删除方法如下：</span><br><span class="hljs-number">1</span><span class="hljs-string">、首先使用进程管理工具杀掉msgsvc.exe的进程</span><br><span class="hljs-number">2</span><span class="hljs-string">、到C:Windowssystem目录下删除msgsvc.exe文件</span><br><span class="hljs-number">3</span><span class="hljs-string">、编辑注册表，删除HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindowsCurrentVersion</span><br><span class="hljs-string">Run项中内容为C:WinDOWSSYSTEMmsgsvc.exe的键值</span><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> cli交互模式 rm,mv,rename,mkdir,ls,ll,<span class="hljs-built_in">pwd</span>,<span class="hljs-built_in">cd</span></span><br><span class="hljs-meta">#</span><span class="bash"> 指定配置文件</span><br>export ALIYUNPAN_CONFIG_DIR=/home/tickstep/tools/aliyunpan/config<br><span class="hljs-meta">#</span><span class="bash"> 刷新当前登录用户</span><br>aliyunpan token update<br><span class="hljs-meta">#</span><span class="bash"> 刷新所有登录的用户</span><br>aliyunpan token update -mode 2<br><span class="hljs-meta">#</span><span class="bash"> 每小时执行一次Token刷新任务</span><br>*/60  * * * * /&lt;your path&gt;/aliyunpan token update -mode 2<br>aliyunpan logout<br>aliyunpan su &lt;uid&gt;<br>aliyunpan who<br>aliyunpan loglist<br>aliyunpan update<br>aliyunpan help<br><span class="hljs-meta">#</span><span class="bash"> 查看login命令的帮助手册</span><br>aliyunpan help login<br><span class="hljs-meta">#</span><span class="bash"> 登录</span><br>aliyunpan login<br><span class="hljs-meta">#</span><span class="bash"> 磁盘配额</span><br>aliyunpan quota<br><span class="hljs-meta">#</span><span class="bash"> 上传</span><br>aliyunpan upload &lt;本地文件/目录的路径1&gt; &lt;文件/目录2&gt; &lt;文件/目录3&gt; ... &lt;目标目录&gt;<br>aliyunpan u &lt;本地文件/目录的路径1&gt; &lt;文件/目录2&gt; &lt;文件/目录3&gt; ... &lt;目标目录&gt;<br>  --ow            overwrite, 覆盖已存在的文件<br>  --status        输出所有线程的工作状态<br>  --save          将下载的文件直接保存到当前工作目录<br>  --saveto value  将下载的文件直接保存到指定的目录<br>  -x              为文件加上执行权限, (windows系统无效)<br>  -p value        指定下载线程数 (default: 0)<br>  -l value        指定同时进行下载文件的数量 (default: 0)<br>  --retry value   下载失败最大重试次数 (default: 3)<br>  --nocheck       下载文件完成后不校验文件<br>  --exn value     指定排除的文件夹或者文件的名称，只支持正则表达式。支持排除多个名称，每一个名称就是一个exn参数<br><span class="hljs-meta">#</span><span class="bash">以下是典型的排除特定文件或者文件夹的例子，注意：参数值必须是正则表达式</span><br><span class="hljs-meta">#</span><span class="bash">1)排除@eadir文件或者文件夹：-exn <span class="hljs-string">&quot;^@eadir$&quot;</span></span><br><span class="hljs-meta">#</span><span class="bash">2)排除.jpg文件：-exn <span class="hljs-string">&quot;\.jpg$&quot;</span></span><br><span class="hljs-meta">#</span><span class="bash">3)排除.号开头的文件：-exn <span class="hljs-string">&quot;^\.&quot;</span></span><br><span class="hljs-meta">#</span><span class="bash">4)排除~号开头的文件：-exn <span class="hljs-string">&quot;^~&quot;</span></span><br><span class="hljs-meta">#</span><span class="bash">5)排除 myfile.txt 文件：-exn <span class="hljs-string">&quot;^myfile.txt$&quot;</span></span><br><span class="hljs-meta">#</span><span class="bash"> 显示和修改程序配置项</span><br>aliyunpan config -h<br>aliyunpan config set -h<br>aliyunpan config set -savedir D:/Downloads<br>aliyunpan config set -max_download_parallel 15 -savedir D:/Downloads<br>aliyunpan config set -transfer_url_type 2<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
